(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function a2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ob={exports:{}},vp={},Vb={exports:{}},it={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ih=Symbol.for("react.element"),l2=Symbol.for("react.portal"),c2=Symbol.for("react.fragment"),u2=Symbol.for("react.strict_mode"),d2=Symbol.for("react.profiler"),h2=Symbol.for("react.provider"),f2=Symbol.for("react.context"),g2=Symbol.for("react.forward_ref"),p2=Symbol.for("react.suspense"),m2=Symbol.for("react.memo"),y2=Symbol.for("react.lazy"),kx=Symbol.iterator;function _2(n){return n===null||typeof n!="object"?null:(n=kx&&n[kx]||n["@@iterator"],typeof n=="function"?n:null)}var Fb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jb=Object.assign,Ub={};function Mc(n,e,t){this.props=n,this.context=e,this.refs=Ub,this.updater=t||Fb}Mc.prototype.isReactComponent={};Mc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Mc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function $b(){}$b.prototype=Mc.prototype;function qv(n,e,t){this.props=n,this.context=e,this.refs=Ub,this.updater=t||Fb}var Wv=qv.prototype=new $b;Wv.constructor=qv;jb(Wv,Mc.prototype);Wv.isPureReactComponent=!0;var Nx=Array.isArray,Bb=Object.prototype.hasOwnProperty,Gv={current:null},zb={key:!0,ref:!0,__self:!0,__source:!0};function qb(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Bb.call(e,r)&&!zb.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:ih,type:n,key:i,ref:o,props:s,_owner:Gv.current}}function v2(n,e){return{$$typeof:ih,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Hv(n){return typeof n=="object"&&n!==null&&n.$$typeof===ih}function w2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Px=/\/+/g;function Qm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?w2(""+n.key):e.toString(36)}function Df(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case ih:case l2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+Qm(o,0):r,Nx(s)?(t="",n!=null&&(t=n.replace(Px,"$&/")+"/"),Df(s,e,t,"",function(u){return u})):s!=null&&(Hv(s)&&(s=v2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Px,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Nx(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+Qm(i,a);o+=Df(i,e,t,l,s)}else if(l=_2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+Qm(i,a++),o+=Df(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Zh(n,e,t){if(n==null)return n;var r=[],s=0;return Df(n,r,"","",function(i){return e.call(t,i,s++)}),r}function I2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var gr={current:null},Lf={transition:null},x2={ReactCurrentDispatcher:gr,ReactCurrentBatchConfig:Lf,ReactCurrentOwner:Gv};function Wb(){throw Error("act(...) is not supported in production builds of React.")}it.Children={map:Zh,forEach:function(n,e,t){Zh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Zh(n,function(){e++}),e},toArray:function(n){return Zh(n,function(e){return e})||[]},only:function(n){if(!Hv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};it.Component=Mc;it.Fragment=c2;it.Profiler=d2;it.PureComponent=qv;it.StrictMode=u2;it.Suspense=p2;it.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x2;it.act=Wb;it.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=jb({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Gv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Bb.call(e,l)&&!zb.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:ih,type:n.type,key:s,ref:i,props:r,_owner:o}};it.createContext=function(n){return n={$$typeof:f2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:h2,_context:n},n.Consumer=n};it.createElement=qb;it.createFactory=function(n){var e=qb.bind(null,n);return e.type=n,e};it.createRef=function(){return{current:null}};it.forwardRef=function(n){return{$$typeof:g2,render:n}};it.isValidElement=Hv;it.lazy=function(n){return{$$typeof:y2,_payload:{_status:-1,_result:n},_init:I2}};it.memo=function(n,e){return{$$typeof:m2,type:n,compare:e===void 0?null:e}};it.startTransition=function(n){var e=Lf.transition;Lf.transition={};try{n()}finally{Lf.transition=e}};it.unstable_act=Wb;it.useCallback=function(n,e){return gr.current.useCallback(n,e)};it.useContext=function(n){return gr.current.useContext(n)};it.useDebugValue=function(){};it.useDeferredValue=function(n){return gr.current.useDeferredValue(n)};it.useEffect=function(n,e){return gr.current.useEffect(n,e)};it.useId=function(){return gr.current.useId()};it.useImperativeHandle=function(n,e,t){return gr.current.useImperativeHandle(n,e,t)};it.useInsertionEffect=function(n,e){return gr.current.useInsertionEffect(n,e)};it.useLayoutEffect=function(n,e){return gr.current.useLayoutEffect(n,e)};it.useMemo=function(n,e){return gr.current.useMemo(n,e)};it.useReducer=function(n,e,t){return gr.current.useReducer(n,e,t)};it.useRef=function(n){return gr.current.useRef(n)};it.useState=function(n){return gr.current.useState(n)};it.useSyncExternalStore=function(n,e,t){return gr.current.useSyncExternalStore(n,e,t)};it.useTransition=function(){return gr.current.useTransition()};it.version="18.3.1";Vb.exports=it;var L=Vb.exports;const S2=a2(L);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E2=L,T2=Symbol.for("react.element"),b2=Symbol.for("react.fragment"),A2=Object.prototype.hasOwnProperty,C2=E2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R2={key:!0,ref:!0,__self:!0,__source:!0};function Gb(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)A2.call(e,r)&&!R2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:T2,type:n,key:i,ref:o,props:s,_owner:C2.current}}vp.Fragment=b2;vp.jsx=Gb;vp.jsxs=Gb;Ob.exports=vp;var d=Ob.exports,Jy={},Hb={exports:{}},Hr={},Qb={exports:{}},Kb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(K,Se){var Te=K.length;K.push(Se);e:for(;0<Te;){var je=Te-1>>>1,be=K[je];if(0<s(be,Se))K[je]=Se,K[Te]=be,Te=je;else break e}}function t(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var Se=K[0],Te=K.pop();if(Te!==Se){K[0]=Te;e:for(var je=0,be=K.length,D=be>>>1;je<D;){var z=2*(je+1)-1,ce=K[z],_e=z+1,Ne=K[_e];if(0>s(ce,Te))_e<be&&0>s(Ne,ce)?(K[je]=Ne,K[_e]=Te,je=_e):(K[je]=ce,K[z]=Te,je=z);else if(_e<be&&0>s(Ne,Te))K[je]=Ne,K[_e]=Te,je=_e;else break e}}return Se}function s(K,Se){var Te=K.sortIndex-Se.sortIndex;return Te!==0?Te:K.id-Se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,g=3,y=!1,_=!1,C=!1,N=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(K){for(var Se=t(u);Se!==null;){if(Se.callback===null)r(u);else if(Se.startTime<=K)r(u),Se.sortIndex=Se.expirationTime,e(l,Se);else break;Se=t(u)}}function P(K){if(C=!1,k(K),!_)if(t(l)!==null)_=!0,ue($);else{var Se=t(u);Se!==null&&ye(P,Se.startTime-K)}}function $(K,Se){_=!1,C&&(C=!1,T(S),S=-1),y=!0;var Te=g;try{for(k(Se),f=t(l);f!==null&&(!(f.expirationTime>Se)||K&&!w());){var je=f.callback;if(typeof je=="function"){f.callback=null,g=f.priorityLevel;var be=je(f.expirationTime<=Se);Se=n.unstable_now(),typeof be=="function"?f.callback=be:f===t(l)&&r(l),k(Se)}else r(l);f=t(l)}if(f!==null)var D=!0;else{var z=t(u);z!==null&&ye(P,z.startTime-Se),D=!1}return D}finally{f=null,g=Te,y=!1}}var j=!1,R=null,S=-1,I=5,A=-1;function w(){return!(n.unstable_now()-A<I)}function b(){if(R!==null){var K=n.unstable_now();A=K;var Se=!0;try{Se=R(!0,K)}finally{Se?v():(j=!1,R=null)}}else j=!1}var v;if(typeof x=="function")v=function(){x(b)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,Ee=te.port2;te.port1.onmessage=b,v=function(){Ee.postMessage(null)}}else v=function(){N(b,0)};function ue(K){R=K,j||(j=!0,v())}function ye(K,Se){S=N(function(){K(n.unstable_now())},Se)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(K){K.callback=null},n.unstable_continueExecution=function(){_||y||(_=!0,ue($))},n.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<K?Math.floor(1e3/K):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(K){switch(g){case 1:case 2:case 3:var Se=3;break;default:Se=g}var Te=g;g=Se;try{return K()}finally{g=Te}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(K,Se){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var Te=g;g=K;try{return Se()}finally{g=Te}},n.unstable_scheduleCallback=function(K,Se,Te){var je=n.unstable_now();switch(typeof Te=="object"&&Te!==null?(Te=Te.delay,Te=typeof Te=="number"&&0<Te?je+Te:je):Te=je,K){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=Te+be,K={id:h++,callback:Se,priorityLevel:K,startTime:Te,expirationTime:be,sortIndex:-1},Te>je?(K.sortIndex=Te,e(u,K),t(l)===null&&K===t(u)&&(C?(T(S),S=-1):C=!0,ye(P,Te-je))):(K.sortIndex=be,e(l,K),_||y||(_=!0,ue($))),K},n.unstable_shouldYield=w,n.unstable_wrapCallback=function(K){var Se=g;return function(){var Te=g;g=Se;try{return K.apply(this,arguments)}finally{g=Te}}}})(Kb);Qb.exports=Kb;var k2=Qb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N2=L,zr=k2;function Y(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Yb=new Set,hd={};function Ga(n,e){nc(n,e),nc(n+"Capture",e)}function nc(n,e){for(hd[n]=e,n=0;n<e.length;n++)Yb.add(e[n])}var vi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xy=Object.prototype.hasOwnProperty,P2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Dx={},Lx={};function D2(n){return Xy.call(Lx,n)?!0:Xy.call(Dx,n)?!1:P2.test(n)?Lx[n]=!0:(Dx[n]=!0,!1)}function L2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function M2(n,e,t,r){if(e===null||typeof e>"u"||L2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function pr(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Kn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Kn[n]=new pr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Kn[e]=new pr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Kn[n]=new pr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Kn[n]=new pr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Kn[n]=new pr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Kn[n]=new pr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Kn[n]=new pr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Kn[n]=new pr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Kn[n]=new pr(n,5,!1,n.toLowerCase(),null,!1,!1)});var Qv=/[\-:]([a-z])/g;function Kv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Qv,Kv);Kn[e]=new pr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Qv,Kv);Kn[e]=new pr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Qv,Kv);Kn[e]=new pr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Kn[n]=new pr(n,1,!1,n.toLowerCase(),null,!1,!1)});Kn.xlinkHref=new pr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Kn[n]=new pr(n,1,!1,n.toLowerCase(),null,!0,!0)});function Yv(n,e,t,r){var s=Kn.hasOwnProperty(e)?Kn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(M2(e,t,s,r)&&(t=null),r||s===null?D2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ki=N2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ef=Symbol.for("react.element"),Al=Symbol.for("react.portal"),Cl=Symbol.for("react.fragment"),Jv=Symbol.for("react.strict_mode"),Zy=Symbol.for("react.profiler"),Jb=Symbol.for("react.provider"),Xb=Symbol.for("react.context"),Xv=Symbol.for("react.forward_ref"),e_=Symbol.for("react.suspense"),t_=Symbol.for("react.suspense_list"),Zv=Symbol.for("react.memo"),Gi=Symbol.for("react.lazy"),Zb=Symbol.for("react.offscreen"),Mx=Symbol.iterator;function lu(n){return n===null||typeof n!="object"?null:(n=Mx&&n[Mx]||n["@@iterator"],typeof n=="function"?n:null)}var cn=Object.assign,Km;function bu(n){if(Km===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Km=e&&e[1]||""}return`
`+Km+n}var Ym=!1;function Jm(n,e){if(!n||Ym)return"";Ym=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Ym=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?bu(n):""}function O2(n){switch(n.tag){case 5:return bu(n.type);case 16:return bu("Lazy");case 13:return bu("Suspense");case 19:return bu("SuspenseList");case 0:case 2:case 15:return n=Jm(n.type,!1),n;case 11:return n=Jm(n.type.render,!1),n;case 1:return n=Jm(n.type,!0),n;default:return""}}function n_(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Cl:return"Fragment";case Al:return"Portal";case Zy:return"Profiler";case Jv:return"StrictMode";case e_:return"Suspense";case t_:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Xb:return(n.displayName||"Context")+".Consumer";case Jb:return(n._context.displayName||"Context")+".Provider";case Xv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Zv:return e=n.displayName||null,e!==null?e:n_(n.type)||"Memo";case Gi:e=n._payload,n=n._init;try{return n_(n(e))}catch{}}return null}function V2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return n_(e);case 8:return e===Jv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function To(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function eA(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function F2(n){var e=eA(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function tf(n){n._valueTracker||(n._valueTracker=F2(n))}function tA(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=eA(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function cg(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function r_(n,e){var t=e.checked;return cn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Ox(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=To(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function nA(n,e){e=e.checked,e!=null&&Yv(n,"checked",e,!1)}function s_(n,e){nA(n,e);var t=To(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?i_(n,e.type,t):e.hasOwnProperty("defaultValue")&&i_(n,e.type,To(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Vx(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function i_(n,e,t){(e!=="number"||cg(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Au=Array.isArray;function $l(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+To(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function o_(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Y(91));return cn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Fx(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Y(92));if(Au(t)){if(1<t.length)throw Error(Y(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:To(t)}}function rA(n,e){var t=To(e.value),r=To(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function jx(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function sA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function a_(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?sA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var nf,iA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(nf=nf||document.createElement("div"),nf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=nf.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function fd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Fu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},j2=["Webkit","ms","Moz","O"];Object.keys(Fu).forEach(function(n){j2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Fu[e]=Fu[n]})});function oA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Fu.hasOwnProperty(n)&&Fu[n]?(""+e).trim():e+"px"}function aA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=oA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var U2=cn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function l_(n,e){if(e){if(U2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Y(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Y(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Y(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Y(62))}}function c_(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var u_=null;function e0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var d_=null,Bl=null,zl=null;function Ux(n){if(n=lh(n)){if(typeof d_!="function")throw Error(Y(280));var e=n.stateNode;e&&(e=Ep(e),d_(n.stateNode,n.type,e))}}function lA(n){Bl?zl?zl.push(n):zl=[n]:Bl=n}function cA(){if(Bl){var n=Bl,e=zl;if(zl=Bl=null,Ux(n),e)for(n=0;n<e.length;n++)Ux(e[n])}}function uA(n,e){return n(e)}function dA(){}var Xm=!1;function hA(n,e,t){if(Xm)return n(e,t);Xm=!0;try{return uA(n,e,t)}finally{Xm=!1,(Bl!==null||zl!==null)&&(dA(),cA())}}function gd(n,e){var t=n.stateNode;if(t===null)return null;var r=Ep(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Y(231,e,typeof t));return t}var h_=!1;if(vi)try{var cu={};Object.defineProperty(cu,"passive",{get:function(){h_=!0}}),window.addEventListener("test",cu,cu),window.removeEventListener("test",cu,cu)}catch{h_=!1}function $2(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var ju=!1,ug=null,dg=!1,f_=null,B2={onError:function(n){ju=!0,ug=n}};function z2(n,e,t,r,s,i,o,a,l){ju=!1,ug=null,$2.apply(B2,arguments)}function q2(n,e,t,r,s,i,o,a,l){if(z2.apply(this,arguments),ju){if(ju){var u=ug;ju=!1,ug=null}else throw Error(Y(198));dg||(dg=!0,f_=u)}}function Ha(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function fA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function $x(n){if(Ha(n)!==n)throw Error(Y(188))}function W2(n){var e=n.alternate;if(!e){if(e=Ha(n),e===null)throw Error(Y(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return $x(s),n;if(i===r)return $x(s),e;i=i.sibling}throw Error(Y(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(Y(189))}}if(t.alternate!==r)throw Error(Y(190))}if(t.tag!==3)throw Error(Y(188));return t.stateNode.current===t?n:e}function gA(n){return n=W2(n),n!==null?pA(n):null}function pA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=pA(n);if(e!==null)return e;n=n.sibling}return null}var mA=zr.unstable_scheduleCallback,Bx=zr.unstable_cancelCallback,G2=zr.unstable_shouldYield,H2=zr.unstable_requestPaint,mn=zr.unstable_now,Q2=zr.unstable_getCurrentPriorityLevel,t0=zr.unstable_ImmediatePriority,yA=zr.unstable_UserBlockingPriority,hg=zr.unstable_NormalPriority,K2=zr.unstable_LowPriority,_A=zr.unstable_IdlePriority,wp=null,qs=null;function Y2(n){if(qs&&typeof qs.onCommitFiberRoot=="function")try{qs.onCommitFiberRoot(wp,n,void 0,(n.current.flags&128)===128)}catch{}}var ws=Math.clz32?Math.clz32:Z2,J2=Math.log,X2=Math.LN2;function Z2(n){return n>>>=0,n===0?32:31-(J2(n)/X2|0)|0}var rf=64,sf=4194304;function Cu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function fg(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Cu(a):(i&=o,i!==0&&(r=Cu(i)))}else o=t&~s,o!==0?r=Cu(o):i!==0&&(r=Cu(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-ws(e),s=1<<t,r|=n[t],e&=~s;return r}function eL(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tL(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-ws(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=eL(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function g_(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function vA(){var n=rf;return rf<<=1,!(rf&4194240)&&(rf=64),n}function Zm(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function oh(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ws(e),n[e]=t}function nL(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-ws(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function n0(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-ws(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var bt=0;function wA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var IA,r0,xA,SA,EA,p_=!1,of=[],co=null,uo=null,ho=null,pd=new Map,md=new Map,Qi=[],rL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zx(n,e){switch(n){case"focusin":case"focusout":co=null;break;case"dragenter":case"dragleave":uo=null;break;case"mouseover":case"mouseout":ho=null;break;case"pointerover":case"pointerout":pd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":md.delete(e.pointerId)}}function uu(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=lh(e),e!==null&&r0(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function sL(n,e,t,r,s){switch(e){case"focusin":return co=uu(co,n,e,t,r,s),!0;case"dragenter":return uo=uu(uo,n,e,t,r,s),!0;case"mouseover":return ho=uu(ho,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return pd.set(i,uu(pd.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,md.set(i,uu(md.get(i)||null,n,e,t,r,s)),!0}return!1}function TA(n){var e=ua(n.target);if(e!==null){var t=Ha(e);if(t!==null){if(e=t.tag,e===13){if(e=fA(t),e!==null){n.blockedOn=e,EA(n.priority,function(){xA(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Mf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=m_(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);u_=r,t.target.dispatchEvent(r),u_=null}else return e=lh(t),e!==null&&r0(e),n.blockedOn=t,!1;e.shift()}return!0}function qx(n,e,t){Mf(n)&&t.delete(e)}function iL(){p_=!1,co!==null&&Mf(co)&&(co=null),uo!==null&&Mf(uo)&&(uo=null),ho!==null&&Mf(ho)&&(ho=null),pd.forEach(qx),md.forEach(qx)}function du(n,e){n.blockedOn===e&&(n.blockedOn=null,p_||(p_=!0,zr.unstable_scheduleCallback(zr.unstable_NormalPriority,iL)))}function yd(n){function e(s){return du(s,n)}if(0<of.length){du(of[0],n);for(var t=1;t<of.length;t++){var r=of[t];r.blockedOn===n&&(r.blockedOn=null)}}for(co!==null&&du(co,n),uo!==null&&du(uo,n),ho!==null&&du(ho,n),pd.forEach(e),md.forEach(e),t=0;t<Qi.length;t++)r=Qi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Qi.length&&(t=Qi[0],t.blockedOn===null);)TA(t),t.blockedOn===null&&Qi.shift()}var ql=ki.ReactCurrentBatchConfig,gg=!0;function oL(n,e,t,r){var s=bt,i=ql.transition;ql.transition=null;try{bt=1,s0(n,e,t,r)}finally{bt=s,ql.transition=i}}function aL(n,e,t,r){var s=bt,i=ql.transition;ql.transition=null;try{bt=4,s0(n,e,t,r)}finally{bt=s,ql.transition=i}}function s0(n,e,t,r){if(gg){var s=m_(n,e,t,r);if(s===null)cy(n,e,r,pg,t),zx(n,r);else if(sL(s,n,e,t,r))r.stopPropagation();else if(zx(n,r),e&4&&-1<rL.indexOf(n)){for(;s!==null;){var i=lh(s);if(i!==null&&IA(i),i=m_(n,e,t,r),i===null&&cy(n,e,r,pg,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else cy(n,e,r,null,t)}}var pg=null;function m_(n,e,t,r){if(pg=null,n=e0(r),n=ua(n),n!==null)if(e=Ha(n),e===null)n=null;else if(t=e.tag,t===13){if(n=fA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return pg=n,null}function bA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Q2()){case t0:return 1;case yA:return 4;case hg:case K2:return 16;case _A:return 536870912;default:return 16}default:return 16}}var to=null,i0=null,Of=null;function AA(){if(Of)return Of;var n,e=i0,t=e.length,r,s="value"in to?to.value:to.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Of=s.slice(n,1<r?1-r:void 0)}function Vf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function af(){return!0}function Wx(){return!1}function Qr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?af:Wx,this.isPropagationStopped=Wx,this}return cn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=af)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=af)},persist:function(){},isPersistent:af}),e}var Oc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},o0=Qr(Oc),ah=cn({},Oc,{view:0,detail:0}),lL=Qr(ah),ey,ty,hu,Ip=cn({},ah,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:a0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==hu&&(hu&&n.type==="mousemove"?(ey=n.screenX-hu.screenX,ty=n.screenY-hu.screenY):ty=ey=0,hu=n),ey)},movementY:function(n){return"movementY"in n?n.movementY:ty}}),Gx=Qr(Ip),cL=cn({},Ip,{dataTransfer:0}),uL=Qr(cL),dL=cn({},ah,{relatedTarget:0}),ny=Qr(dL),hL=cn({},Oc,{animationName:0,elapsedTime:0,pseudoElement:0}),fL=Qr(hL),gL=cn({},Oc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),pL=Qr(gL),mL=cn({},Oc,{data:0}),Hx=Qr(mL),yL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_L={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wL(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=vL[n])?!!e[n]:!1}function a0(){return wL}var IL=cn({},ah,{key:function(n){if(n.key){var e=yL[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Vf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?_L[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:a0,charCode:function(n){return n.type==="keypress"?Vf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Vf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),xL=Qr(IL),SL=cn({},Ip,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qx=Qr(SL),EL=cn({},ah,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:a0}),TL=Qr(EL),bL=cn({},Oc,{propertyName:0,elapsedTime:0,pseudoElement:0}),AL=Qr(bL),CL=cn({},Ip,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),RL=Qr(CL),kL=[9,13,27,32],l0=vi&&"CompositionEvent"in window,Uu=null;vi&&"documentMode"in document&&(Uu=document.documentMode);var NL=vi&&"TextEvent"in window&&!Uu,CA=vi&&(!l0||Uu&&8<Uu&&11>=Uu),Kx=String.fromCharCode(32),Yx=!1;function RA(n,e){switch(n){case"keyup":return kL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Rl=!1;function PL(n,e){switch(n){case"compositionend":return kA(e);case"keypress":return e.which!==32?null:(Yx=!0,Kx);case"textInput":return n=e.data,n===Kx&&Yx?null:n;default:return null}}function DL(n,e){if(Rl)return n==="compositionend"||!l0&&RA(n,e)?(n=AA(),Of=i0=to=null,Rl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return CA&&e.locale!=="ko"?null:e.data;default:return null}}var LL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jx(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!LL[n.type]:e==="textarea"}function NA(n,e,t,r){lA(r),e=mg(e,"onChange"),0<e.length&&(t=new o0("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var $u=null,_d=null;function ML(n){BA(n,0)}function xp(n){var e=Pl(n);if(tA(e))return n}function OL(n,e){if(n==="change")return e}var PA=!1;if(vi){var ry;if(vi){var sy="oninput"in document;if(!sy){var Xx=document.createElement("div");Xx.setAttribute("oninput","return;"),sy=typeof Xx.oninput=="function"}ry=sy}else ry=!1;PA=ry&&(!document.documentMode||9<document.documentMode)}function Zx(){$u&&($u.detachEvent("onpropertychange",DA),_d=$u=null)}function DA(n){if(n.propertyName==="value"&&xp(_d)){var e=[];NA(e,_d,n,e0(n)),hA(ML,e)}}function VL(n,e,t){n==="focusin"?(Zx(),$u=e,_d=t,$u.attachEvent("onpropertychange",DA)):n==="focusout"&&Zx()}function FL(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return xp(_d)}function jL(n,e){if(n==="click")return xp(e)}function UL(n,e){if(n==="input"||n==="change")return xp(e)}function $L(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Es=typeof Object.is=="function"?Object.is:$L;function vd(n,e){if(Es(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Xy.call(e,s)||!Es(n[s],e[s]))return!1}return!0}function eS(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function tS(n,e){var t=eS(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=eS(t)}}function LA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?LA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function MA(){for(var n=window,e=cg();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=cg(n.document)}return e}function c0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function BL(n){var e=MA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&LA(t.ownerDocument.documentElement,t)){if(r!==null&&c0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=tS(t,i);var o=tS(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var zL=vi&&"documentMode"in document&&11>=document.documentMode,kl=null,y_=null,Bu=null,__=!1;function nS(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;__||kl==null||kl!==cg(r)||(r=kl,"selectionStart"in r&&c0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Bu&&vd(Bu,r)||(Bu=r,r=mg(y_,"onSelect"),0<r.length&&(e=new o0("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=kl)))}function lf(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Nl={animationend:lf("Animation","AnimationEnd"),animationiteration:lf("Animation","AnimationIteration"),animationstart:lf("Animation","AnimationStart"),transitionend:lf("Transition","TransitionEnd")},iy={},OA={};vi&&(OA=document.createElement("div").style,"AnimationEvent"in window||(delete Nl.animationend.animation,delete Nl.animationiteration.animation,delete Nl.animationstart.animation),"TransitionEvent"in window||delete Nl.transitionend.transition);function Sp(n){if(iy[n])return iy[n];if(!Nl[n])return n;var e=Nl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in OA)return iy[n]=e[t];return n}var VA=Sp("animationend"),FA=Sp("animationiteration"),jA=Sp("animationstart"),UA=Sp("transitionend"),$A=new Map,rS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jo(n,e){$A.set(n,e),Ga(e,[n])}for(var oy=0;oy<rS.length;oy++){var ay=rS[oy],qL=ay.toLowerCase(),WL=ay[0].toUpperCase()+ay.slice(1);jo(qL,"on"+WL)}jo(VA,"onAnimationEnd");jo(FA,"onAnimationIteration");jo(jA,"onAnimationStart");jo("dblclick","onDoubleClick");jo("focusin","onFocus");jo("focusout","onBlur");jo(UA,"onTransitionEnd");nc("onMouseEnter",["mouseout","mouseover"]);nc("onMouseLeave",["mouseout","mouseover"]);nc("onPointerEnter",["pointerout","pointerover"]);nc("onPointerLeave",["pointerout","pointerover"]);Ga("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ga("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ga("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ga("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ga("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ga("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ru="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ru));function sS(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,q2(r,e,void 0,n),n.currentTarget=null}function BA(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;sS(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;sS(s,a,u),i=l}}}if(dg)throw n=f_,dg=!1,f_=null,n}function Wt(n,e){var t=e[S_];t===void 0&&(t=e[S_]=new Set);var r=n+"__bubble";t.has(r)||(zA(e,n,2,!1),t.add(r))}function ly(n,e,t){var r=0;e&&(r|=4),zA(t,n,r,e)}var cf="_reactListening"+Math.random().toString(36).slice(2);function wd(n){if(!n[cf]){n[cf]=!0,Yb.forEach(function(t){t!=="selectionchange"&&(GL.has(t)||ly(t,!1,n),ly(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[cf]||(e[cf]=!0,ly("selectionchange",!1,e))}}function zA(n,e,t,r){switch(bA(e)){case 1:var s=oL;break;case 4:s=aL;break;default:s=s0}t=s.bind(null,e,t,n),s=void 0,!h_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function cy(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=ua(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}hA(function(){var u=i,h=e0(t),f=[];e:{var g=$A.get(n);if(g!==void 0){var y=o0,_=n;switch(n){case"keypress":if(Vf(t)===0)break e;case"keydown":case"keyup":y=xL;break;case"focusin":_="focus",y=ny;break;case"focusout":_="blur",y=ny;break;case"beforeblur":case"afterblur":y=ny;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=Gx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=uL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=TL;break;case VA:case FA:case jA:y=fL;break;case UA:y=AL;break;case"scroll":y=lL;break;case"wheel":y=RL;break;case"copy":case"cut":case"paste":y=pL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Qx}var C=(e&4)!==0,N=!C&&n==="scroll",T=C?g!==null?g+"Capture":null:g;C=[];for(var x=u,k;x!==null;){k=x;var P=k.stateNode;if(k.tag===5&&P!==null&&(k=P,T!==null&&(P=gd(x,T),P!=null&&C.push(Id(x,P,k)))),N)break;x=x.return}0<C.length&&(g=new y(g,_,null,t,h),f.push({event:g,listeners:C}))}}if(!(e&7)){e:{if(g=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",g&&t!==u_&&(_=t.relatedTarget||t.fromElement)&&(ua(_)||_[wi]))break e;if((y||g)&&(g=h.window===h?h:(g=h.ownerDocument)?g.defaultView||g.parentWindow:window,y?(_=t.relatedTarget||t.toElement,y=u,_=_?ua(_):null,_!==null&&(N=Ha(_),_!==N||_.tag!==5&&_.tag!==6)&&(_=null)):(y=null,_=u),y!==_)){if(C=Gx,P="onMouseLeave",T="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(C=Qx,P="onPointerLeave",T="onPointerEnter",x="pointer"),N=y==null?g:Pl(y),k=_==null?g:Pl(_),g=new C(P,x+"leave",y,t,h),g.target=N,g.relatedTarget=k,P=null,ua(h)===u&&(C=new C(T,x+"enter",_,t,h),C.target=k,C.relatedTarget=N,P=C),N=P,y&&_)t:{for(C=y,T=_,x=0,k=C;k;k=pl(k))x++;for(k=0,P=T;P;P=pl(P))k++;for(;0<x-k;)C=pl(C),x--;for(;0<k-x;)T=pl(T),k--;for(;x--;){if(C===T||T!==null&&C===T.alternate)break t;C=pl(C),T=pl(T)}C=null}else C=null;y!==null&&iS(f,g,y,C,!1),_!==null&&N!==null&&iS(f,N,_,C,!0)}}e:{if(g=u?Pl(u):window,y=g.nodeName&&g.nodeName.toLowerCase(),y==="select"||y==="input"&&g.type==="file")var $=OL;else if(Jx(g))if(PA)$=UL;else{$=FL;var j=VL}else(y=g.nodeName)&&y.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&($=jL);if($&&($=$(n,u))){NA(f,$,t,h);break e}j&&j(n,g,u),n==="focusout"&&(j=g._wrapperState)&&j.controlled&&g.type==="number"&&i_(g,"number",g.value)}switch(j=u?Pl(u):window,n){case"focusin":(Jx(j)||j.contentEditable==="true")&&(kl=j,y_=u,Bu=null);break;case"focusout":Bu=y_=kl=null;break;case"mousedown":__=!0;break;case"contextmenu":case"mouseup":case"dragend":__=!1,nS(f,t,h);break;case"selectionchange":if(zL)break;case"keydown":case"keyup":nS(f,t,h)}var R;if(l0)e:{switch(n){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Rl?RA(n,t)&&(S="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(S="onCompositionStart");S&&(CA&&t.locale!=="ko"&&(Rl||S!=="onCompositionStart"?S==="onCompositionEnd"&&Rl&&(R=AA()):(to=h,i0="value"in to?to.value:to.textContent,Rl=!0)),j=mg(u,S),0<j.length&&(S=new Hx(S,n,null,t,h),f.push({event:S,listeners:j}),R?S.data=R:(R=kA(t),R!==null&&(S.data=R)))),(R=NL?PL(n,t):DL(n,t))&&(u=mg(u,"onBeforeInput"),0<u.length&&(h=new Hx("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=R))}BA(f,e)})}function Id(n,e,t){return{instance:n,listener:e,currentTarget:t}}function mg(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=gd(n,t),i!=null&&r.unshift(Id(n,i,s)),i=gd(n,e),i!=null&&r.push(Id(n,i,s))),n=n.return}return r}function pl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function iS(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=gd(t,i),l!=null&&o.unshift(Id(t,l,a))):s||(l=gd(t,i),l!=null&&o.push(Id(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var HL=/\r\n?/g,QL=/\u0000|\uFFFD/g;function oS(n){return(typeof n=="string"?n:""+n).replace(HL,`
`).replace(QL,"")}function uf(n,e,t){if(e=oS(e),oS(n)!==e&&t)throw Error(Y(425))}function yg(){}var v_=null,w_=null;function I_(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var x_=typeof setTimeout=="function"?setTimeout:void 0,KL=typeof clearTimeout=="function"?clearTimeout:void 0,aS=typeof Promise=="function"?Promise:void 0,YL=typeof queueMicrotask=="function"?queueMicrotask:typeof aS<"u"?function(n){return aS.resolve(null).then(n).catch(JL)}:x_;function JL(n){setTimeout(function(){throw n})}function uy(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),yd(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);yd(e)}function fo(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function lS(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Vc=Math.random().toString(36).slice(2),Fs="__reactFiber$"+Vc,xd="__reactProps$"+Vc,wi="__reactContainer$"+Vc,S_="__reactEvents$"+Vc,XL="__reactListeners$"+Vc,ZL="__reactHandles$"+Vc;function ua(n){var e=n[Fs];if(e)return e;for(var t=n.parentNode;t;){if(e=t[wi]||t[Fs]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=lS(n);n!==null;){if(t=n[Fs])return t;n=lS(n)}return e}n=t,t=n.parentNode}return null}function lh(n){return n=n[Fs]||n[wi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Pl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Y(33))}function Ep(n){return n[xd]||null}var E_=[],Dl=-1;function Uo(n){return{current:n}}function Ht(n){0>Dl||(n.current=E_[Dl],E_[Dl]=null,Dl--)}function Ut(n,e){Dl++,E_[Dl]=n.current,n.current=e}var bo={},lr=Uo(bo),Sr=Uo(!1),Ea=bo;function rc(n,e){var t=n.type.contextTypes;if(!t)return bo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Er(n){return n=n.childContextTypes,n!=null}function _g(){Ht(Sr),Ht(lr)}function cS(n,e,t){if(lr.current!==bo)throw Error(Y(168));Ut(lr,e),Ut(Sr,t)}function qA(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Y(108,V2(n)||"Unknown",s));return cn({},t,r)}function vg(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||bo,Ea=lr.current,Ut(lr,n),Ut(Sr,Sr.current),!0}function uS(n,e,t){var r=n.stateNode;if(!r)throw Error(Y(169));t?(n=qA(n,e,Ea),r.__reactInternalMemoizedMergedChildContext=n,Ht(Sr),Ht(lr),Ut(lr,n)):Ht(Sr),Ut(Sr,t)}var li=null,Tp=!1,dy=!1;function WA(n){li===null?li=[n]:li.push(n)}function eM(n){Tp=!0,WA(n)}function $o(){if(!dy&&li!==null){dy=!0;var n=0,e=bt;try{var t=li;for(bt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}li=null,Tp=!1}catch(s){throw li!==null&&(li=li.slice(n+1)),mA(t0,$o),s}finally{bt=e,dy=!1}}return null}var Ll=[],Ml=0,wg=null,Ig=0,Xr=[],Zr=0,Ta=null,di=1,hi="";function ea(n,e){Ll[Ml++]=Ig,Ll[Ml++]=wg,wg=n,Ig=e}function GA(n,e,t){Xr[Zr++]=di,Xr[Zr++]=hi,Xr[Zr++]=Ta,Ta=n;var r=di;n=hi;var s=32-ws(r)-1;r&=~(1<<s),t+=1;var i=32-ws(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,di=1<<32-ws(e)+s|t<<s|r,hi=i+n}else di=1<<i|t<<s|r,hi=n}function u0(n){n.return!==null&&(ea(n,1),GA(n,1,0))}function d0(n){for(;n===wg;)wg=Ll[--Ml],Ll[Ml]=null,Ig=Ll[--Ml],Ll[Ml]=null;for(;n===Ta;)Ta=Xr[--Zr],Xr[Zr]=null,hi=Xr[--Zr],Xr[Zr]=null,di=Xr[--Zr],Xr[Zr]=null}var jr=null,Fr=null,Zt=!1,ys=null;function HA(n,e){var t=ts(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function dS(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,jr=n,Fr=fo(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,jr=n,Fr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ta!==null?{id:di,overflow:hi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ts(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,jr=n,Fr=null,!0):!1;default:return!1}}function T_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function b_(n){if(Zt){var e=Fr;if(e){var t=e;if(!dS(n,e)){if(T_(n))throw Error(Y(418));e=fo(t.nextSibling);var r=jr;e&&dS(n,e)?HA(r,t):(n.flags=n.flags&-4097|2,Zt=!1,jr=n)}}else{if(T_(n))throw Error(Y(418));n.flags=n.flags&-4097|2,Zt=!1,jr=n}}}function hS(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;jr=n}function df(n){if(n!==jr)return!1;if(!Zt)return hS(n),Zt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!I_(n.type,n.memoizedProps)),e&&(e=Fr)){if(T_(n))throw QA(),Error(Y(418));for(;e;)HA(n,e),e=fo(e.nextSibling)}if(hS(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Y(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Fr=fo(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Fr=null}}else Fr=jr?fo(n.stateNode.nextSibling):null;return!0}function QA(){for(var n=Fr;n;)n=fo(n.nextSibling)}function sc(){Fr=jr=null,Zt=!1}function h0(n){ys===null?ys=[n]:ys.push(n)}var tM=ki.ReactCurrentBatchConfig;function fu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Y(309));var r=t.stateNode}if(!r)throw Error(Y(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(Y(284));if(!t._owner)throw Error(Y(290,n))}return n}function hf(n,e){throw n=Object.prototype.toString.call(e),Error(Y(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function fS(n){var e=n._init;return e(n._payload)}function KA(n){function e(T,x){if(n){var k=T.deletions;k===null?(T.deletions=[x],T.flags|=16):k.push(x)}}function t(T,x){if(!n)return null;for(;x!==null;)e(T,x),x=x.sibling;return null}function r(T,x){for(T=new Map;x!==null;)x.key!==null?T.set(x.key,x):T.set(x.index,x),x=x.sibling;return T}function s(T,x){return T=yo(T,x),T.index=0,T.sibling=null,T}function i(T,x,k){return T.index=k,n?(k=T.alternate,k!==null?(k=k.index,k<x?(T.flags|=2,x):k):(T.flags|=2,x)):(T.flags|=1048576,x)}function o(T){return n&&T.alternate===null&&(T.flags|=2),T}function a(T,x,k,P){return x===null||x.tag!==6?(x=_y(k,T.mode,P),x.return=T,x):(x=s(x,k),x.return=T,x)}function l(T,x,k,P){var $=k.type;return $===Cl?h(T,x,k.props.children,P,k.key):x!==null&&(x.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Gi&&fS($)===x.type)?(P=s(x,k.props),P.ref=fu(T,x,k),P.return=T,P):(P=qf(k.type,k.key,k.props,null,T.mode,P),P.ref=fu(T,x,k),P.return=T,P)}function u(T,x,k,P){return x===null||x.tag!==4||x.stateNode.containerInfo!==k.containerInfo||x.stateNode.implementation!==k.implementation?(x=vy(k,T.mode,P),x.return=T,x):(x=s(x,k.children||[]),x.return=T,x)}function h(T,x,k,P,$){return x===null||x.tag!==7?(x=_a(k,T.mode,P,$),x.return=T,x):(x=s(x,k),x.return=T,x)}function f(T,x,k){if(typeof x=="string"&&x!==""||typeof x=="number")return x=_y(""+x,T.mode,k),x.return=T,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ef:return k=qf(x.type,x.key,x.props,null,T.mode,k),k.ref=fu(T,null,x),k.return=T,k;case Al:return x=vy(x,T.mode,k),x.return=T,x;case Gi:var P=x._init;return f(T,P(x._payload),k)}if(Au(x)||lu(x))return x=_a(x,T.mode,k,null),x.return=T,x;hf(T,x)}return null}function g(T,x,k,P){var $=x!==null?x.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return $!==null?null:a(T,x,""+k,P);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case ef:return k.key===$?l(T,x,k,P):null;case Al:return k.key===$?u(T,x,k,P):null;case Gi:return $=k._init,g(T,x,$(k._payload),P)}if(Au(k)||lu(k))return $!==null?null:h(T,x,k,P,null);hf(T,k)}return null}function y(T,x,k,P,$){if(typeof P=="string"&&P!==""||typeof P=="number")return T=T.get(k)||null,a(x,T,""+P,$);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case ef:return T=T.get(P.key===null?k:P.key)||null,l(x,T,P,$);case Al:return T=T.get(P.key===null?k:P.key)||null,u(x,T,P,$);case Gi:var j=P._init;return y(T,x,k,j(P._payload),$)}if(Au(P)||lu(P))return T=T.get(k)||null,h(x,T,P,$,null);hf(x,P)}return null}function _(T,x,k,P){for(var $=null,j=null,R=x,S=x=0,I=null;R!==null&&S<k.length;S++){R.index>S?(I=R,R=null):I=R.sibling;var A=g(T,R,k[S],P);if(A===null){R===null&&(R=I);break}n&&R&&A.alternate===null&&e(T,R),x=i(A,x,S),j===null?$=A:j.sibling=A,j=A,R=I}if(S===k.length)return t(T,R),Zt&&ea(T,S),$;if(R===null){for(;S<k.length;S++)R=f(T,k[S],P),R!==null&&(x=i(R,x,S),j===null?$=R:j.sibling=R,j=R);return Zt&&ea(T,S),$}for(R=r(T,R);S<k.length;S++)I=y(R,T,S,k[S],P),I!==null&&(n&&I.alternate!==null&&R.delete(I.key===null?S:I.key),x=i(I,x,S),j===null?$=I:j.sibling=I,j=I);return n&&R.forEach(function(w){return e(T,w)}),Zt&&ea(T,S),$}function C(T,x,k,P){var $=lu(k);if(typeof $!="function")throw Error(Y(150));if(k=$.call(k),k==null)throw Error(Y(151));for(var j=$=null,R=x,S=x=0,I=null,A=k.next();R!==null&&!A.done;S++,A=k.next()){R.index>S?(I=R,R=null):I=R.sibling;var w=g(T,R,A.value,P);if(w===null){R===null&&(R=I);break}n&&R&&w.alternate===null&&e(T,R),x=i(w,x,S),j===null?$=w:j.sibling=w,j=w,R=I}if(A.done)return t(T,R),Zt&&ea(T,S),$;if(R===null){for(;!A.done;S++,A=k.next())A=f(T,A.value,P),A!==null&&(x=i(A,x,S),j===null?$=A:j.sibling=A,j=A);return Zt&&ea(T,S),$}for(R=r(T,R);!A.done;S++,A=k.next())A=y(R,T,S,A.value,P),A!==null&&(n&&A.alternate!==null&&R.delete(A.key===null?S:A.key),x=i(A,x,S),j===null?$=A:j.sibling=A,j=A);return n&&R.forEach(function(b){return e(T,b)}),Zt&&ea(T,S),$}function N(T,x,k,P){if(typeof k=="object"&&k!==null&&k.type===Cl&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case ef:e:{for(var $=k.key,j=x;j!==null;){if(j.key===$){if($=k.type,$===Cl){if(j.tag===7){t(T,j.sibling),x=s(j,k.props.children),x.return=T,T=x;break e}}else if(j.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Gi&&fS($)===j.type){t(T,j.sibling),x=s(j,k.props),x.ref=fu(T,j,k),x.return=T,T=x;break e}t(T,j);break}else e(T,j);j=j.sibling}k.type===Cl?(x=_a(k.props.children,T.mode,P,k.key),x.return=T,T=x):(P=qf(k.type,k.key,k.props,null,T.mode,P),P.ref=fu(T,x,k),P.return=T,T=P)}return o(T);case Al:e:{for(j=k.key;x!==null;){if(x.key===j)if(x.tag===4&&x.stateNode.containerInfo===k.containerInfo&&x.stateNode.implementation===k.implementation){t(T,x.sibling),x=s(x,k.children||[]),x.return=T,T=x;break e}else{t(T,x);break}else e(T,x);x=x.sibling}x=vy(k,T.mode,P),x.return=T,T=x}return o(T);case Gi:return j=k._init,N(T,x,j(k._payload),P)}if(Au(k))return _(T,x,k,P);if(lu(k))return C(T,x,k,P);hf(T,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,x!==null&&x.tag===6?(t(T,x.sibling),x=s(x,k),x.return=T,T=x):(t(T,x),x=_y(k,T.mode,P),x.return=T,T=x),o(T)):t(T,x)}return N}var ic=KA(!0),YA=KA(!1),xg=Uo(null),Sg=null,Ol=null,f0=null;function g0(){f0=Ol=Sg=null}function p0(n){var e=xg.current;Ht(xg),n._currentValue=e}function A_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Wl(n,e){Sg=n,f0=Ol=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(vr=!0),n.firstContext=null)}function is(n){var e=n._currentValue;if(f0!==n)if(n={context:n,memoizedValue:e,next:null},Ol===null){if(Sg===null)throw Error(Y(308));Ol=n,Sg.dependencies={lanes:0,firstContext:n}}else Ol=Ol.next=n;return e}var da=null;function m0(n){da===null?da=[n]:da.push(n)}function JA(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,m0(e)):(t.next=s.next,s.next=t),e.interleaved=t,Ii(n,r)}function Ii(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Hi=!1;function y0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function XA(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function yi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function go(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ft&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ii(n,t)}return s=r.interleaved,s===null?(e.next=e,m0(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ii(n,t)}function Ff(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,n0(n,t)}}function gS(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Eg(n,e,t,r){var s=n.updateQueue;Hi=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var g=a.lane,y=a.eventTime;if((r&g)===g){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var _=n,C=a;switch(g=e,y=t,C.tag){case 1:if(_=C.payload,typeof _=="function"){f=_.call(y,f,g);break e}f=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=C.payload,g=typeof _=="function"?_.call(y,f,g):_,g==null)break e;f=cn({},f,g);break e;case 2:Hi=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,g=s.effects,g===null?s.effects=[a]:g.push(a))}else y={eventTime:y,lane:g,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,o|=g;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;g=a,a=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Aa|=o,n.lanes=o,n.memoizedState=f}}function pS(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(Y(191,s));s.call(r)}}}var ch={},Ws=Uo(ch),Sd=Uo(ch),Ed=Uo(ch);function ha(n){if(n===ch)throw Error(Y(174));return n}function _0(n,e){switch(Ut(Ed,e),Ut(Sd,n),Ut(Ws,ch),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:a_(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=a_(e,n)}Ht(Ws),Ut(Ws,e)}function oc(){Ht(Ws),Ht(Sd),Ht(Ed)}function ZA(n){ha(Ed.current);var e=ha(Ws.current),t=a_(e,n.type);e!==t&&(Ut(Sd,n),Ut(Ws,t))}function v0(n){Sd.current===n&&(Ht(Ws),Ht(Sd))}var on=Uo(0);function Tg(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var hy=[];function w0(){for(var n=0;n<hy.length;n++)hy[n]._workInProgressVersionPrimary=null;hy.length=0}var jf=ki.ReactCurrentDispatcher,fy=ki.ReactCurrentBatchConfig,ba=0,ln=null,Tn=null,Pn=null,bg=!1,zu=!1,Td=0,nM=0;function er(){throw Error(Y(321))}function I0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Es(n[t],e[t]))return!1;return!0}function x0(n,e,t,r,s,i){if(ba=i,ln=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,jf.current=n===null||n.memoizedState===null?oM:aM,n=t(r,s),zu){i=0;do{if(zu=!1,Td=0,25<=i)throw Error(Y(301));i+=1,Pn=Tn=null,e.updateQueue=null,jf.current=lM,n=t(r,s)}while(zu)}if(jf.current=Ag,e=Tn!==null&&Tn.next!==null,ba=0,Pn=Tn=ln=null,bg=!1,e)throw Error(Y(300));return n}function S0(){var n=Td!==0;return Td=0,n}function Ls(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pn===null?ln.memoizedState=Pn=n:Pn=Pn.next=n,Pn}function os(){if(Tn===null){var n=ln.alternate;n=n!==null?n.memoizedState:null}else n=Tn.next;var e=Pn===null?ln.memoizedState:Pn.next;if(e!==null)Pn=e,Tn=n;else{if(n===null)throw Error(Y(310));Tn=n,n={memoizedState:Tn.memoizedState,baseState:Tn.baseState,baseQueue:Tn.baseQueue,queue:Tn.queue,next:null},Pn===null?ln.memoizedState=Pn=n:Pn=Pn.next=n}return Pn}function bd(n,e){return typeof e=="function"?e(n):e}function gy(n){var e=os(),t=e.queue;if(t===null)throw Error(Y(311));t.lastRenderedReducer=n;var r=Tn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((ba&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,ln.lanes|=h,Aa|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Es(r,e.memoizedState)||(vr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,ln.lanes|=i,Aa|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function py(n){var e=os(),t=e.queue;if(t===null)throw Error(Y(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Es(i,e.memoizedState)||(vr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function eC(){}function tC(n,e){var t=ln,r=os(),s=e(),i=!Es(r.memoizedState,s);if(i&&(r.memoizedState=s,vr=!0),r=r.queue,E0(sC.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Pn!==null&&Pn.memoizedState.tag&1){if(t.flags|=2048,Ad(9,rC.bind(null,t,r,s,e),void 0,null),Mn===null)throw Error(Y(349));ba&30||nC(t,e,s)}return s}function nC(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=ln.updateQueue,e===null?(e={lastEffect:null,stores:null},ln.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function rC(n,e,t,r){e.value=t,e.getSnapshot=r,iC(e)&&oC(n)}function sC(n,e,t){return t(function(){iC(e)&&oC(n)})}function iC(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Es(n,t)}catch{return!0}}function oC(n){var e=Ii(n,1);e!==null&&Is(e,n,1,-1)}function mS(n){var e=Ls();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bd,lastRenderedState:n},e.queue=n,n=n.dispatch=iM.bind(null,ln,n),[e.memoizedState,n]}function Ad(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=ln.updateQueue,e===null?(e={lastEffect:null,stores:null},ln.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function aC(){return os().memoizedState}function Uf(n,e,t,r){var s=Ls();ln.flags|=n,s.memoizedState=Ad(1|e,t,void 0,r===void 0?null:r)}function bp(n,e,t,r){var s=os();r=r===void 0?null:r;var i=void 0;if(Tn!==null){var o=Tn.memoizedState;if(i=o.destroy,r!==null&&I0(r,o.deps)){s.memoizedState=Ad(e,t,i,r);return}}ln.flags|=n,s.memoizedState=Ad(1|e,t,i,r)}function yS(n,e){return Uf(8390656,8,n,e)}function E0(n,e){return bp(2048,8,n,e)}function lC(n,e){return bp(4,2,n,e)}function cC(n,e){return bp(4,4,n,e)}function uC(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function dC(n,e,t){return t=t!=null?t.concat([n]):null,bp(4,4,uC.bind(null,e,n),t)}function T0(){}function hC(n,e){var t=os();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&I0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function fC(n,e){var t=os();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&I0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function gC(n,e,t){return ba&21?(Es(t,e)||(t=vA(),ln.lanes|=t,Aa|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,vr=!0),n.memoizedState=t)}function rM(n,e){var t=bt;bt=t!==0&&4>t?t:4,n(!0);var r=fy.transition;fy.transition={};try{n(!1),e()}finally{bt=t,fy.transition=r}}function pC(){return os().memoizedState}function sM(n,e,t){var r=mo(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},mC(n))yC(e,t);else if(t=JA(n,e,t,r),t!==null){var s=hr();Is(t,n,r,s),_C(t,e,r)}}function iM(n,e,t){var r=mo(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(mC(n))yC(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Es(a,o)){var l=e.interleaved;l===null?(s.next=s,m0(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=JA(n,e,s,r),t!==null&&(s=hr(),Is(t,n,r,s),_C(t,e,r))}}function mC(n){var e=n.alternate;return n===ln||e!==null&&e===ln}function yC(n,e){zu=bg=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function _C(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,n0(n,t)}}var Ag={readContext:is,useCallback:er,useContext:er,useEffect:er,useImperativeHandle:er,useInsertionEffect:er,useLayoutEffect:er,useMemo:er,useReducer:er,useRef:er,useState:er,useDebugValue:er,useDeferredValue:er,useTransition:er,useMutableSource:er,useSyncExternalStore:er,useId:er,unstable_isNewReconciler:!1},oM={readContext:is,useCallback:function(n,e){return Ls().memoizedState=[n,e===void 0?null:e],n},useContext:is,useEffect:yS,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Uf(4194308,4,uC.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Uf(4194308,4,n,e)},useInsertionEffect:function(n,e){return Uf(4,2,n,e)},useMemo:function(n,e){var t=Ls();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ls();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=sM.bind(null,ln,n),[r.memoizedState,n]},useRef:function(n){var e=Ls();return n={current:n},e.memoizedState=n},useState:mS,useDebugValue:T0,useDeferredValue:function(n){return Ls().memoizedState=n},useTransition:function(){var n=mS(!1),e=n[0];return n=rM.bind(null,n[1]),Ls().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=ln,s=Ls();if(Zt){if(t===void 0)throw Error(Y(407));t=t()}else{if(t=e(),Mn===null)throw Error(Y(349));ba&30||nC(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,yS(sC.bind(null,r,i,n),[n]),r.flags|=2048,Ad(9,rC.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Ls(),e=Mn.identifierPrefix;if(Zt){var t=hi,r=di;t=(r&~(1<<32-ws(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Td++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=nM++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},aM={readContext:is,useCallback:hC,useContext:is,useEffect:E0,useImperativeHandle:dC,useInsertionEffect:lC,useLayoutEffect:cC,useMemo:fC,useReducer:gy,useRef:aC,useState:function(){return gy(bd)},useDebugValue:T0,useDeferredValue:function(n){var e=os();return gC(e,Tn.memoizedState,n)},useTransition:function(){var n=gy(bd)[0],e=os().memoizedState;return[n,e]},useMutableSource:eC,useSyncExternalStore:tC,useId:pC,unstable_isNewReconciler:!1},lM={readContext:is,useCallback:hC,useContext:is,useEffect:E0,useImperativeHandle:dC,useInsertionEffect:lC,useLayoutEffect:cC,useMemo:fC,useReducer:py,useRef:aC,useState:function(){return py(bd)},useDebugValue:T0,useDeferredValue:function(n){var e=os();return Tn===null?e.memoizedState=n:gC(e,Tn.memoizedState,n)},useTransition:function(){var n=py(bd)[0],e=os().memoizedState;return[n,e]},useMutableSource:eC,useSyncExternalStore:tC,useId:pC,unstable_isNewReconciler:!1};function fs(n,e){if(n&&n.defaultProps){e=cn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function C_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:cn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ap={isMounted:function(n){return(n=n._reactInternals)?Ha(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=hr(),s=mo(n),i=yi(r,s);i.payload=e,t!=null&&(i.callback=t),e=go(n,i,s),e!==null&&(Is(e,n,s,r),Ff(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=hr(),s=mo(n),i=yi(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=go(n,i,s),e!==null&&(Is(e,n,s,r),Ff(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=hr(),r=mo(n),s=yi(t,r);s.tag=2,e!=null&&(s.callback=e),e=go(n,s,r),e!==null&&(Is(e,n,r,t),Ff(e,n,r))}};function _S(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!vd(t,r)||!vd(s,i):!0}function vC(n,e,t){var r=!1,s=bo,i=e.contextType;return typeof i=="object"&&i!==null?i=is(i):(s=Er(e)?Ea:lr.current,r=e.contextTypes,i=(r=r!=null)?rc(n,s):bo),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ap,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function vS(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ap.enqueueReplaceState(e,e.state,null)}function R_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},y0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=is(i):(i=Er(e)?Ea:lr.current,s.context=rc(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(C_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Ap.enqueueReplaceState(s,s.state,null),Eg(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function ac(n,e){try{var t="",r=e;do t+=O2(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function my(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function k_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var cM=typeof WeakMap=="function"?WeakMap:Map;function wC(n,e,t){t=yi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Rg||(Rg=!0,U_=r),k_(n,e)},t}function IC(n,e,t){t=yi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){k_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){k_(n,e),typeof r!="function"&&(po===null?po=new Set([this]):po.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function wS(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new cM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=SM.bind(null,n,e,t),e.then(n,n))}function IS(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function xS(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=yi(-1,1),e.tag=2,go(t,e,1))),t.lanes|=1),n)}var uM=ki.ReactCurrentOwner,vr=!1;function ur(n,e,t,r){e.child=n===null?YA(e,null,t,r):ic(e,n.child,t,r)}function SS(n,e,t,r,s){t=t.render;var i=e.ref;return Wl(e,s),r=x0(n,e,t,r,i,s),t=S0(),n!==null&&!vr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,xi(n,e,s)):(Zt&&t&&u0(e),e.flags|=1,ur(n,e,r,s),e.child)}function ES(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!D0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,xC(n,e,i,r,s)):(n=qf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:vd,t(o,r)&&n.ref===e.ref)return xi(n,e,s)}return e.flags|=1,n=yo(i,r),n.ref=e.ref,n.return=e,e.child=n}function xC(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(vd(i,r)&&n.ref===e.ref)if(vr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(vr=!0);else return e.lanes=n.lanes,xi(n,e,s)}return N_(n,e,t,r,s)}function SC(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ut(Fl,Dr),Dr|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ut(Fl,Dr),Dr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Ut(Fl,Dr),Dr|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Ut(Fl,Dr),Dr|=r;return ur(n,e,s,t),e.child}function EC(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function N_(n,e,t,r,s){var i=Er(t)?Ea:lr.current;return i=rc(e,i),Wl(e,s),t=x0(n,e,t,r,i,s),r=S0(),n!==null&&!vr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,xi(n,e,s)):(Zt&&r&&u0(e),e.flags|=1,ur(n,e,t,s),e.child)}function TS(n,e,t,r,s){if(Er(t)){var i=!0;vg(e)}else i=!1;if(Wl(e,s),e.stateNode===null)$f(n,e),vC(e,t,r),R_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=is(u):(u=Er(t)?Ea:lr.current,u=rc(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&vS(e,o,r,u),Hi=!1;var g=e.memoizedState;o.state=g,Eg(e,r,o,s),l=e.memoizedState,a!==r||g!==l||Sr.current||Hi?(typeof h=="function"&&(C_(e,t,h,r),l=e.memoizedState),(a=Hi||_S(e,t,a,r,g,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,XA(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:fs(e.type,a),o.props=u,f=e.pendingProps,g=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=is(l):(l=Er(t)?Ea:lr.current,l=rc(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||g!==l)&&vS(e,o,r,l),Hi=!1,g=e.memoizedState,o.state=g,Eg(e,r,o,s);var _=e.memoizedState;a!==f||g!==_||Sr.current||Hi?(typeof y=="function"&&(C_(e,t,y,r),_=e.memoizedState),(u=Hi||_S(e,t,u,r,g,_,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,_,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,_,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=_),o.props=r,o.state=_,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=1024),r=!1)}return P_(n,e,t,r,i,s)}function P_(n,e,t,r,s,i){EC(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&uS(e,t,!1),xi(n,e,i);r=e.stateNode,uM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=ic(e,n.child,null,i),e.child=ic(e,null,a,i)):ur(n,e,a,i),e.memoizedState=r.state,s&&uS(e,t,!0),e.child}function TC(n){var e=n.stateNode;e.pendingContext?cS(n,e.pendingContext,e.pendingContext!==e.context):e.context&&cS(n,e.context,!1),_0(n,e.containerInfo)}function bS(n,e,t,r,s){return sc(),h0(s),e.flags|=256,ur(n,e,t,r),e.child}var D_={dehydrated:null,treeContext:null,retryLane:0};function L_(n){return{baseLanes:n,cachePool:null,transitions:null}}function bC(n,e,t){var r=e.pendingProps,s=on.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Ut(on,s&1),n===null)return b_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=kp(o,r,0,null),n=_a(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=L_(t),e.memoizedState=D_,n):b0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return dM(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=yo(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=yo(a,i):(i=_a(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?L_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=D_,r}return i=n.child,n=i.sibling,r=yo(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function b0(n,e){return e=kp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function ff(n,e,t,r){return r!==null&&h0(r),ic(e,n.child,null,t),n=b0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function dM(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=my(Error(Y(422))),ff(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=kp({mode:"visible",children:r.children},s,0,null),i=_a(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ic(e,n.child,null,o),e.child.memoizedState=L_(o),e.memoizedState=D_,i);if(!(e.mode&1))return ff(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Y(419)),r=my(i,r,void 0),ff(n,e,o,r)}if(a=(o&n.childLanes)!==0,vr||a){if(r=Mn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ii(n,s),Is(r,n,s,-1))}return P0(),r=my(Error(Y(421))),ff(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=EM.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Fr=fo(s.nextSibling),jr=e,Zt=!0,ys=null,n!==null&&(Xr[Zr++]=di,Xr[Zr++]=hi,Xr[Zr++]=Ta,di=n.id,hi=n.overflow,Ta=e),e=b0(e,r.children),e.flags|=4096,e)}function AS(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),A_(n.return,e,t)}function yy(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function AC(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(ur(n,e,r.children,t),r=on.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&AS(n,t,e);else if(n.tag===19)AS(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Ut(on,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Tg(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),yy(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Tg(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}yy(e,!0,t,null,i);break;case"together":yy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $f(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function xi(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Aa|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Y(153));if(e.child!==null){for(n=e.child,t=yo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=yo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function hM(n,e,t){switch(e.tag){case 3:TC(e),sc();break;case 5:ZA(e);break;case 1:Er(e.type)&&vg(e);break;case 4:_0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ut(xg,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ut(on,on.current&1),e.flags|=128,null):t&e.child.childLanes?bC(n,e,t):(Ut(on,on.current&1),n=xi(n,e,t),n!==null?n.sibling:null);Ut(on,on.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return AC(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ut(on,on.current),r)break;return null;case 22:case 23:return e.lanes=0,SC(n,e,t)}return xi(n,e,t)}var CC,M_,RC,kC;CC=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};M_=function(){};RC=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,ha(Ws.current);var i=null;switch(t){case"input":s=r_(n,s),r=r_(n,r),i=[];break;case"select":s=cn({},s,{value:void 0}),r=cn({},r,{value:void 0}),i=[];break;case"textarea":s=o_(n,s),r=o_(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=yg)}l_(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(hd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(hd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Wt("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};kC=function(n,e,t,r){t!==r&&(e.flags|=4)};function gu(n,e){if(!Zt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function tr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function fM(n,e,t){var r=e.pendingProps;switch(d0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tr(e),null;case 1:return Er(e.type)&&_g(),tr(e),null;case 3:return r=e.stateNode,oc(),Ht(Sr),Ht(lr),w0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(df(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ys!==null&&(z_(ys),ys=null))),M_(n,e),tr(e),null;case 5:v0(e);var s=ha(Ed.current);if(t=e.type,n!==null&&e.stateNode!=null)RC(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Y(166));return tr(e),null}if(n=ha(Ws.current),df(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Fs]=e,r[xd]=i,n=(e.mode&1)!==0,t){case"dialog":Wt("cancel",r),Wt("close",r);break;case"iframe":case"object":case"embed":Wt("load",r);break;case"video":case"audio":for(s=0;s<Ru.length;s++)Wt(Ru[s],r);break;case"source":Wt("error",r);break;case"img":case"image":case"link":Wt("error",r),Wt("load",r);break;case"details":Wt("toggle",r);break;case"input":Ox(r,i),Wt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Wt("invalid",r);break;case"textarea":Fx(r,i),Wt("invalid",r)}l_(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&uf(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&uf(r.textContent,a,n),s=["children",""+a]):hd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Wt("scroll",r)}switch(t){case"input":tf(r),Vx(r,i,!0);break;case"textarea":tf(r),jx(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=yg)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=sA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Fs]=e,n[xd]=r,CC(n,e,!1,!1),e.stateNode=n;e:{switch(o=c_(t,r),t){case"dialog":Wt("cancel",n),Wt("close",n),s=r;break;case"iframe":case"object":case"embed":Wt("load",n),s=r;break;case"video":case"audio":for(s=0;s<Ru.length;s++)Wt(Ru[s],n);s=r;break;case"source":Wt("error",n),s=r;break;case"img":case"image":case"link":Wt("error",n),Wt("load",n),s=r;break;case"details":Wt("toggle",n),s=r;break;case"input":Ox(n,r),s=r_(n,r),Wt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=cn({},r,{value:void 0}),Wt("invalid",n);break;case"textarea":Fx(n,r),s=o_(n,r),Wt("invalid",n);break;default:s=r}l_(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?aA(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&iA(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&fd(n,l):typeof l=="number"&&fd(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(hd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Wt("scroll",n):l!=null&&Yv(n,i,l,o))}switch(t){case"input":tf(n),Vx(n,r,!1);break;case"textarea":tf(n),jx(n);break;case"option":r.value!=null&&n.setAttribute("value",""+To(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?$l(n,!!r.multiple,i,!1):r.defaultValue!=null&&$l(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=yg)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return tr(e),null;case 6:if(n&&e.stateNode!=null)kC(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Y(166));if(t=ha(Ed.current),ha(Ws.current),df(e)){if(r=e.stateNode,t=e.memoizedProps,r[Fs]=e,(i=r.nodeValue!==t)&&(n=jr,n!==null))switch(n.tag){case 3:uf(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&uf(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Fs]=e,e.stateNode=r}return tr(e),null;case 13:if(Ht(on),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Zt&&Fr!==null&&e.mode&1&&!(e.flags&128))QA(),sc(),e.flags|=98560,i=!1;else if(i=df(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(Y(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));i[Fs]=e}else sc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;tr(e),i=!1}else ys!==null&&(z_(ys),ys=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||on.current&1?An===0&&(An=3):P0())),e.updateQueue!==null&&(e.flags|=4),tr(e),null);case 4:return oc(),M_(n,e),n===null&&wd(e.stateNode.containerInfo),tr(e),null;case 10:return p0(e.type._context),tr(e),null;case 17:return Er(e.type)&&_g(),tr(e),null;case 19:if(Ht(on),i=e.memoizedState,i===null)return tr(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)gu(i,!1);else{if(An!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Tg(n),o!==null){for(e.flags|=128,gu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ut(on,on.current&1|2),e.child}n=n.sibling}i.tail!==null&&mn()>lc&&(e.flags|=128,r=!0,gu(i,!1),e.lanes=4194304)}else{if(!r)if(n=Tg(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),gu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Zt)return tr(e),null}else 2*mn()-i.renderingStartTime>lc&&t!==1073741824&&(e.flags|=128,r=!0,gu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=mn(),e.sibling=null,t=on.current,Ut(on,r?t&1|2:t&1),e):(tr(e),null);case 22:case 23:return N0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Dr&1073741824&&(tr(e),e.subtreeFlags&6&&(e.flags|=8192)):tr(e),null;case 24:return null;case 25:return null}throw Error(Y(156,e.tag))}function gM(n,e){switch(d0(e),e.tag){case 1:return Er(e.type)&&_g(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return oc(),Ht(Sr),Ht(lr),w0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return v0(e),null;case 13:if(Ht(on),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Y(340));sc()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ht(on),null;case 4:return oc(),null;case 10:return p0(e.type._context),null;case 22:case 23:return N0(),null;case 24:return null;default:return null}}var gf=!1,sr=!1,pM=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function Vl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){hn(n,e,r)}else t.current=null}function O_(n,e,t){try{t()}catch(r){hn(n,e,r)}}var CS=!1;function mM(n,e){if(v_=gg,n=MA(),c0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,g=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)g=f,f=y;for(;;){if(f===n)break t;if(g===t&&++u===s&&(a=o),g===i&&++h===r&&(l=o),(y=f.nextSibling)!==null)break;f=g,g=f.parentNode}f=y}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(w_={focusedElem:n,selectionRange:t},gg=!1,Ie=e;Ie!==null;)if(e=Ie,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ie=n;else for(;Ie!==null;){e=Ie;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var C=_.memoizedProps,N=_.memoizedState,T=e.stateNode,x=T.getSnapshotBeforeUpdate(e.elementType===e.type?C:fs(e.type,C),N);T.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(P){hn(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,Ie=n;break}Ie=e.return}return _=CS,CS=!1,_}function qu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&O_(e,t,i)}s=s.next}while(s!==r)}}function Cp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function V_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function NC(n){var e=n.alternate;e!==null&&(n.alternate=null,NC(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Fs],delete e[xd],delete e[S_],delete e[XL],delete e[ZL])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function PC(n){return n.tag===5||n.tag===3||n.tag===4}function RS(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||PC(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function F_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=yg));else if(r!==4&&(n=n.child,n!==null))for(F_(n,e,t),n=n.sibling;n!==null;)F_(n,e,t),n=n.sibling}function j_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(j_(n,e,t),n=n.sibling;n!==null;)j_(n,e,t),n=n.sibling}var Wn=null,ps=!1;function $i(n,e,t){for(t=t.child;t!==null;)DC(n,e,t),t=t.sibling}function DC(n,e,t){if(qs&&typeof qs.onCommitFiberUnmount=="function")try{qs.onCommitFiberUnmount(wp,t)}catch{}switch(t.tag){case 5:sr||Vl(t,e);case 6:var r=Wn,s=ps;Wn=null,$i(n,e,t),Wn=r,ps=s,Wn!==null&&(ps?(n=Wn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Wn.removeChild(t.stateNode));break;case 18:Wn!==null&&(ps?(n=Wn,t=t.stateNode,n.nodeType===8?uy(n.parentNode,t):n.nodeType===1&&uy(n,t),yd(n)):uy(Wn,t.stateNode));break;case 4:r=Wn,s=ps,Wn=t.stateNode.containerInfo,ps=!0,$i(n,e,t),Wn=r,ps=s;break;case 0:case 11:case 14:case 15:if(!sr&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&O_(t,e,o),s=s.next}while(s!==r)}$i(n,e,t);break;case 1:if(!sr&&(Vl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){hn(t,e,a)}$i(n,e,t);break;case 21:$i(n,e,t);break;case 22:t.mode&1?(sr=(r=sr)||t.memoizedState!==null,$i(n,e,t),sr=r):$i(n,e,t);break;default:$i(n,e,t)}}function kS(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new pM),e.forEach(function(r){var s=TM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function hs(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Wn=a.stateNode,ps=!1;break e;case 3:Wn=a.stateNode.containerInfo,ps=!0;break e;case 4:Wn=a.stateNode.containerInfo,ps=!0;break e}a=a.return}if(Wn===null)throw Error(Y(160));DC(i,o,s),Wn=null,ps=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){hn(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)LC(e,n),e=e.sibling}function LC(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(hs(e,n),Ps(n),r&4){try{qu(3,n,n.return),Cp(3,n)}catch(C){hn(n,n.return,C)}try{qu(5,n,n.return)}catch(C){hn(n,n.return,C)}}break;case 1:hs(e,n),Ps(n),r&512&&t!==null&&Vl(t,t.return);break;case 5:if(hs(e,n),Ps(n),r&512&&t!==null&&Vl(t,t.return),n.flags&32){var s=n.stateNode;try{fd(s,"")}catch(C){hn(n,n.return,C)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&nA(s,i),c_(a,o);var u=c_(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?aA(s,f):h==="dangerouslySetInnerHTML"?iA(s,f):h==="children"?fd(s,f):Yv(s,h,f,u)}switch(a){case"input":s_(s,i);break;case"textarea":rA(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?$l(s,!!i.multiple,y,!1):g!==!!i.multiple&&(i.defaultValue!=null?$l(s,!!i.multiple,i.defaultValue,!0):$l(s,!!i.multiple,i.multiple?[]:"",!1))}s[xd]=i}catch(C){hn(n,n.return,C)}}break;case 6:if(hs(e,n),Ps(n),r&4){if(n.stateNode===null)throw Error(Y(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(C){hn(n,n.return,C)}}break;case 3:if(hs(e,n),Ps(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{yd(e.containerInfo)}catch(C){hn(n,n.return,C)}break;case 4:hs(e,n),Ps(n);break;case 13:hs(e,n),Ps(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(R0=mn())),r&4&&kS(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(sr=(u=sr)||h,hs(e,n),sr=u):hs(e,n),Ps(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(Ie=n,h=n.child;h!==null;){for(f=Ie=h;Ie!==null;){switch(g=Ie,y=g.child,g.tag){case 0:case 11:case 14:case 15:qu(4,g,g.return);break;case 1:Vl(g,g.return);var _=g.stateNode;if(typeof _.componentWillUnmount=="function"){r=g,t=g.return;try{e=r,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(C){hn(r,t,C)}}break;case 5:Vl(g,g.return);break;case 22:if(g.memoizedState!==null){PS(f);continue}}y!==null?(y.return=g,Ie=y):PS(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=oA("display",o))}catch(C){hn(n,n.return,C)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(C){hn(n,n.return,C)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:hs(e,n),Ps(n),r&4&&kS(n);break;case 21:break;default:hs(e,n),Ps(n)}}function Ps(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(PC(t)){var r=t;break e}t=t.return}throw Error(Y(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(fd(s,""),r.flags&=-33);var i=RS(n);j_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=RS(n);F_(n,a,o);break;default:throw Error(Y(161))}}catch(l){hn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function yM(n,e,t){Ie=n,MC(n)}function MC(n,e,t){for(var r=(n.mode&1)!==0;Ie!==null;){var s=Ie,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||gf;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||sr;a=gf;var u=sr;if(gf=o,(sr=l)&&!u)for(Ie=s;Ie!==null;)o=Ie,l=o.child,o.tag===22&&o.memoizedState!==null?DS(s):l!==null?(l.return=o,Ie=l):DS(s);for(;i!==null;)Ie=i,MC(i),i=i.sibling;Ie=s,gf=a,sr=u}NS(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Ie=i):NS(n)}}function NS(n){for(;Ie!==null;){var e=Ie;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:sr||Cp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!sr)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:fs(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&pS(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}pS(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&yd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}sr||e.flags&512&&V_(e)}catch(g){hn(e,e.return,g)}}if(e===n){Ie=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ie=t;break}Ie=e.return}}function PS(n){for(;Ie!==null;){var e=Ie;if(e===n){Ie=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ie=t;break}Ie=e.return}}function DS(n){for(;Ie!==null;){var e=Ie;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Cp(4,e)}catch(l){hn(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){hn(e,s,l)}}var i=e.return;try{V_(e)}catch(l){hn(e,i,l)}break;case 5:var o=e.return;try{V_(e)}catch(l){hn(e,o,l)}}}catch(l){hn(e,e.return,l)}if(e===n){Ie=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ie=a;break}Ie=e.return}}var _M=Math.ceil,Cg=ki.ReactCurrentDispatcher,A0=ki.ReactCurrentOwner,rs=ki.ReactCurrentBatchConfig,ft=0,Mn=null,Sn=null,Qn=0,Dr=0,Fl=Uo(0),An=0,Cd=null,Aa=0,Rp=0,C0=0,Wu=null,_r=null,R0=0,lc=1/0,ai=null,Rg=!1,U_=null,po=null,pf=!1,no=null,kg=0,Gu=0,$_=null,Bf=-1,zf=0;function hr(){return ft&6?mn():Bf!==-1?Bf:Bf=mn()}function mo(n){return n.mode&1?ft&2&&Qn!==0?Qn&-Qn:tM.transition!==null?(zf===0&&(zf=vA()),zf):(n=bt,n!==0||(n=window.event,n=n===void 0?16:bA(n.type)),n):1}function Is(n,e,t,r){if(50<Gu)throw Gu=0,$_=null,Error(Y(185));oh(n,t,r),(!(ft&2)||n!==Mn)&&(n===Mn&&(!(ft&2)&&(Rp|=t),An===4&&Ki(n,Qn)),Tr(n,r),t===1&&ft===0&&!(e.mode&1)&&(lc=mn()+500,Tp&&$o()))}function Tr(n,e){var t=n.callbackNode;tL(n,e);var r=fg(n,n===Mn?Qn:0);if(r===0)t!==null&&Bx(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Bx(t),e===1)n.tag===0?eM(LS.bind(null,n)):WA(LS.bind(null,n)),YL(function(){!(ft&6)&&$o()}),t=null;else{switch(wA(r)){case 1:t=t0;break;case 4:t=yA;break;case 16:t=hg;break;case 536870912:t=_A;break;default:t=hg}t=zC(t,OC.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function OC(n,e){if(Bf=-1,zf=0,ft&6)throw Error(Y(327));var t=n.callbackNode;if(Gl()&&n.callbackNode!==t)return null;var r=fg(n,n===Mn?Qn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Ng(n,r);else{e=r;var s=ft;ft|=2;var i=FC();(Mn!==n||Qn!==e)&&(ai=null,lc=mn()+500,ya(n,e));do try{IM();break}catch(a){VC(n,a)}while(1);g0(),Cg.current=i,ft=s,Sn!==null?e=0:(Mn=null,Qn=0,e=An)}if(e!==0){if(e===2&&(s=g_(n),s!==0&&(r=s,e=B_(n,s))),e===1)throw t=Cd,ya(n,0),Ki(n,r),Tr(n,mn()),t;if(e===6)Ki(n,r);else{if(s=n.current.alternate,!(r&30)&&!vM(s)&&(e=Ng(n,r),e===2&&(i=g_(n),i!==0&&(r=i,e=B_(n,i))),e===1))throw t=Cd,ya(n,0),Ki(n,r),Tr(n,mn()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(Y(345));case 2:ta(n,_r,ai);break;case 3:if(Ki(n,r),(r&130023424)===r&&(e=R0+500-mn(),10<e)){if(fg(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){hr(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=x_(ta.bind(null,n,_r,ai),e);break}ta(n,_r,ai);break;case 4:if(Ki(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-ws(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=mn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*_M(r/1960))-r,10<r){n.timeoutHandle=x_(ta.bind(null,n,_r,ai),r);break}ta(n,_r,ai);break;case 5:ta(n,_r,ai);break;default:throw Error(Y(329))}}}return Tr(n,mn()),n.callbackNode===t?OC.bind(null,n):null}function B_(n,e){var t=Wu;return n.current.memoizedState.isDehydrated&&(ya(n,e).flags|=256),n=Ng(n,e),n!==2&&(e=_r,_r=t,e!==null&&z_(e)),n}function z_(n){_r===null?_r=n:_r.push.apply(_r,n)}function vM(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Es(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ki(n,e){for(e&=~C0,e&=~Rp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ws(e),r=1<<t;n[t]=-1,e&=~r}}function LS(n){if(ft&6)throw Error(Y(327));Gl();var e=fg(n,0);if(!(e&1))return Tr(n,mn()),null;var t=Ng(n,e);if(n.tag!==0&&t===2){var r=g_(n);r!==0&&(e=r,t=B_(n,r))}if(t===1)throw t=Cd,ya(n,0),Ki(n,e),Tr(n,mn()),t;if(t===6)throw Error(Y(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ta(n,_r,ai),Tr(n,mn()),null}function k0(n,e){var t=ft;ft|=1;try{return n(e)}finally{ft=t,ft===0&&(lc=mn()+500,Tp&&$o())}}function Ca(n){no!==null&&no.tag===0&&!(ft&6)&&Gl();var e=ft;ft|=1;var t=rs.transition,r=bt;try{if(rs.transition=null,bt=1,n)return n()}finally{bt=r,rs.transition=t,ft=e,!(ft&6)&&$o()}}function N0(){Dr=Fl.current,Ht(Fl)}function ya(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,KL(t)),Sn!==null)for(t=Sn.return;t!==null;){var r=t;switch(d0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&_g();break;case 3:oc(),Ht(Sr),Ht(lr),w0();break;case 5:v0(r);break;case 4:oc();break;case 13:Ht(on);break;case 19:Ht(on);break;case 10:p0(r.type._context);break;case 22:case 23:N0()}t=t.return}if(Mn=n,Sn=n=yo(n.current,null),Qn=Dr=e,An=0,Cd=null,C0=Rp=Aa=0,_r=Wu=null,da!==null){for(e=0;e<da.length;e++)if(t=da[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}da=null}return n}function VC(n,e){do{var t=Sn;try{if(g0(),jf.current=Ag,bg){for(var r=ln.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}bg=!1}if(ba=0,Pn=Tn=ln=null,zu=!1,Td=0,A0.current=null,t===null||t.return===null){An=1,Cd=e,Sn=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Qn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var g=h.alternate;g?(h.updateQueue=g.updateQueue,h.memoizedState=g.memoizedState,h.lanes=g.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=IS(o);if(y!==null){y.flags&=-257,xS(y,o,a,i,e),y.mode&1&&wS(i,u,e),e=y,l=u;var _=e.updateQueue;if(_===null){var C=new Set;C.add(l),e.updateQueue=C}else _.add(l);break e}else{if(!(e&1)){wS(i,u,e),P0();break e}l=Error(Y(426))}}else if(Zt&&a.mode&1){var N=IS(o);if(N!==null){!(N.flags&65536)&&(N.flags|=256),xS(N,o,a,i,e),h0(ac(l,a));break e}}i=l=ac(l,a),An!==4&&(An=2),Wu===null?Wu=[i]:Wu.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var T=wC(i,l,e);gS(i,T);break e;case 1:a=l;var x=i.type,k=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(po===null||!po.has(k)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=IC(i,a,e);gS(i,P);break e}}i=i.return}while(i!==null)}UC(t)}catch($){e=$,Sn===t&&t!==null&&(Sn=t=t.return);continue}break}while(1)}function FC(){var n=Cg.current;return Cg.current=Ag,n===null?Ag:n}function P0(){(An===0||An===3||An===2)&&(An=4),Mn===null||!(Aa&268435455)&&!(Rp&268435455)||Ki(Mn,Qn)}function Ng(n,e){var t=ft;ft|=2;var r=FC();(Mn!==n||Qn!==e)&&(ai=null,ya(n,e));do try{wM();break}catch(s){VC(n,s)}while(1);if(g0(),ft=t,Cg.current=r,Sn!==null)throw Error(Y(261));return Mn=null,Qn=0,An}function wM(){for(;Sn!==null;)jC(Sn)}function IM(){for(;Sn!==null&&!G2();)jC(Sn)}function jC(n){var e=BC(n.alternate,n,Dr);n.memoizedProps=n.pendingProps,e===null?UC(n):Sn=e,A0.current=null}function UC(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=gM(t,e),t!==null){t.flags&=32767,Sn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{An=6,Sn=null;return}}else if(t=fM(t,e,Dr),t!==null){Sn=t;return}if(e=e.sibling,e!==null){Sn=e;return}Sn=e=n}while(e!==null);An===0&&(An=5)}function ta(n,e,t){var r=bt,s=rs.transition;try{rs.transition=null,bt=1,xM(n,e,t,r)}finally{rs.transition=s,bt=r}return null}function xM(n,e,t,r){do Gl();while(no!==null);if(ft&6)throw Error(Y(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Y(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(nL(n,i),n===Mn&&(Sn=Mn=null,Qn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||pf||(pf=!0,zC(hg,function(){return Gl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=rs.transition,rs.transition=null;var o=bt;bt=1;var a=ft;ft|=4,A0.current=null,mM(n,t),LC(t,n),BL(w_),gg=!!v_,w_=v_=null,n.current=t,yM(t),H2(),ft=a,bt=o,rs.transition=i}else n.current=t;if(pf&&(pf=!1,no=n,kg=s),i=n.pendingLanes,i===0&&(po=null),Y2(t.stateNode),Tr(n,mn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Rg)throw Rg=!1,n=U_,U_=null,n;return kg&1&&n.tag!==0&&Gl(),i=n.pendingLanes,i&1?n===$_?Gu++:(Gu=0,$_=n):Gu=0,$o(),null}function Gl(){if(no!==null){var n=wA(kg),e=rs.transition,t=bt;try{if(rs.transition=null,bt=16>n?16:n,no===null)var r=!1;else{if(n=no,no=null,kg=0,ft&6)throw Error(Y(331));var s=ft;for(ft|=4,Ie=n.current;Ie!==null;){var i=Ie,o=i.child;if(Ie.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ie=u;Ie!==null;){var h=Ie;switch(h.tag){case 0:case 11:case 15:qu(8,h,i)}var f=h.child;if(f!==null)f.return=h,Ie=f;else for(;Ie!==null;){h=Ie;var g=h.sibling,y=h.return;if(NC(h),h===u){Ie=null;break}if(g!==null){g.return=y,Ie=g;break}Ie=y}}}var _=i.alternate;if(_!==null){var C=_.child;if(C!==null){_.child=null;do{var N=C.sibling;C.sibling=null,C=N}while(C!==null)}}Ie=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ie=o;else e:for(;Ie!==null;){if(i=Ie,i.flags&2048)switch(i.tag){case 0:case 11:case 15:qu(9,i,i.return)}var T=i.sibling;if(T!==null){T.return=i.return,Ie=T;break e}Ie=i.return}}var x=n.current;for(Ie=x;Ie!==null;){o=Ie;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,Ie=k;else e:for(o=x;Ie!==null;){if(a=Ie,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Cp(9,a)}}catch($){hn(a,a.return,$)}if(a===o){Ie=null;break e}var P=a.sibling;if(P!==null){P.return=a.return,Ie=P;break e}Ie=a.return}}if(ft=s,$o(),qs&&typeof qs.onPostCommitFiberRoot=="function")try{qs.onPostCommitFiberRoot(wp,n)}catch{}r=!0}return r}finally{bt=t,rs.transition=e}}return!1}function MS(n,e,t){e=ac(t,e),e=wC(n,e,1),n=go(n,e,1),e=hr(),n!==null&&(oh(n,1,e),Tr(n,e))}function hn(n,e,t){if(n.tag===3)MS(n,n,t);else for(;e!==null;){if(e.tag===3){MS(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(po===null||!po.has(r))){n=ac(t,n),n=IC(e,n,1),e=go(e,n,1),n=hr(),e!==null&&(oh(e,1,n),Tr(e,n));break}}e=e.return}}function SM(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=hr(),n.pingedLanes|=n.suspendedLanes&t,Mn===n&&(Qn&t)===t&&(An===4||An===3&&(Qn&130023424)===Qn&&500>mn()-R0?ya(n,0):C0|=t),Tr(n,e)}function $C(n,e){e===0&&(n.mode&1?(e=sf,sf<<=1,!(sf&130023424)&&(sf=4194304)):e=1);var t=hr();n=Ii(n,e),n!==null&&(oh(n,e,t),Tr(n,t))}function EM(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),$C(n,t)}function TM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Y(314))}r!==null&&r.delete(e),$C(n,t)}var BC;BC=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Sr.current)vr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return vr=!1,hM(n,e,t);vr=!!(n.flags&131072)}else vr=!1,Zt&&e.flags&1048576&&GA(e,Ig,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;$f(n,e),n=e.pendingProps;var s=rc(e,lr.current);Wl(e,t),s=x0(null,e,r,n,s,t);var i=S0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Er(r)?(i=!0,vg(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,y0(e),s.updater=Ap,e.stateNode=s,s._reactInternals=e,R_(e,r,n,t),e=P_(null,e,r,!0,i,t)):(e.tag=0,Zt&&i&&u0(e),ur(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch($f(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=AM(r),n=fs(r,n),s){case 0:e=N_(null,e,r,n,t);break e;case 1:e=TS(null,e,r,n,t);break e;case 11:e=SS(null,e,r,n,t);break e;case 14:e=ES(null,e,r,fs(r.type,n),t);break e}throw Error(Y(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:fs(r,s),N_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:fs(r,s),TS(n,e,r,s,t);case 3:e:{if(TC(e),n===null)throw Error(Y(387));r=e.pendingProps,i=e.memoizedState,s=i.element,XA(n,e),Eg(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=ac(Error(Y(423)),e),e=bS(n,e,r,t,s);break e}else if(r!==s){s=ac(Error(Y(424)),e),e=bS(n,e,r,t,s);break e}else for(Fr=fo(e.stateNode.containerInfo.firstChild),jr=e,Zt=!0,ys=null,t=YA(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(sc(),r===s){e=xi(n,e,t);break e}ur(n,e,r,t)}e=e.child}return e;case 5:return ZA(e),n===null&&b_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,I_(r,s)?o=null:i!==null&&I_(r,i)&&(e.flags|=32),EC(n,e),ur(n,e,o,t),e.child;case 6:return n===null&&b_(e),null;case 13:return bC(n,e,t);case 4:return _0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=ic(e,null,r,t):ur(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:fs(r,s),SS(n,e,r,s,t);case 7:return ur(n,e,e.pendingProps,t),e.child;case 8:return ur(n,e,e.pendingProps.children,t),e.child;case 12:return ur(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ut(xg,r._currentValue),r._currentValue=o,i!==null)if(Es(i.value,o)){if(i.children===s.children&&!Sr.current){e=xi(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=yi(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),A_(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Y(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),A_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ur(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Wl(e,t),s=is(s),r=r(s),e.flags|=1,ur(n,e,r,t),e.child;case 14:return r=e.type,s=fs(r,e.pendingProps),s=fs(r.type,s),ES(n,e,r,s,t);case 15:return xC(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:fs(r,s),$f(n,e),e.tag=1,Er(r)?(n=!0,vg(e)):n=!1,Wl(e,t),vC(e,r,s),R_(e,r,s,t),P_(null,e,r,!0,n,t);case 19:return AC(n,e,t);case 22:return SC(n,e,t)}throw Error(Y(156,e.tag))};function zC(n,e){return mA(n,e)}function bM(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(n,e,t,r){return new bM(n,e,t,r)}function D0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function AM(n){if(typeof n=="function")return D0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Xv)return 11;if(n===Zv)return 14}return 2}function yo(n,e){var t=n.alternate;return t===null?(t=ts(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function qf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")D0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Cl:return _a(t.children,s,i,e);case Jv:o=8,s|=8;break;case Zy:return n=ts(12,t,e,s|2),n.elementType=Zy,n.lanes=i,n;case e_:return n=ts(13,t,e,s),n.elementType=e_,n.lanes=i,n;case t_:return n=ts(19,t,e,s),n.elementType=t_,n.lanes=i,n;case Zb:return kp(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Jb:o=10;break e;case Xb:o=9;break e;case Xv:o=11;break e;case Zv:o=14;break e;case Gi:o=16,r=null;break e}throw Error(Y(130,n==null?n:typeof n,""))}return e=ts(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function _a(n,e,t,r){return n=ts(7,n,r,e),n.lanes=t,n}function kp(n,e,t,r){return n=ts(22,n,r,e),n.elementType=Zb,n.lanes=t,n.stateNode={isHidden:!1},n}function _y(n,e,t){return n=ts(6,n,null,e),n.lanes=t,n}function vy(n,e,t){return e=ts(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function CM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Zm(0),this.expirationTimes=Zm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Zm(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function L0(n,e,t,r,s,i,o,a,l){return n=new CM(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ts(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},y0(i),n}function RM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Al,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function qC(n){if(!n)return bo;n=n._reactInternals;e:{if(Ha(n)!==n||n.tag!==1)throw Error(Y(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Er(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Y(171))}if(n.tag===1){var t=n.type;if(Er(t))return qA(n,t,e)}return e}function WC(n,e,t,r,s,i,o,a,l){return n=L0(t,r,!0,n,s,i,o,a,l),n.context=qC(null),t=n.current,r=hr(),s=mo(t),i=yi(r,s),i.callback=e??null,go(t,i,s),n.current.lanes=s,oh(n,s,r),Tr(n,r),n}function Np(n,e,t,r){var s=e.current,i=hr(),o=mo(s);return t=qC(t),e.context===null?e.context=t:e.pendingContext=t,e=yi(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=go(s,e,o),n!==null&&(Is(n,s,o,i),Ff(n,s,o)),o}function Pg(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function OS(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function M0(n,e){OS(n,e),(n=n.alternate)&&OS(n,e)}function kM(){return null}var GC=typeof reportError=="function"?reportError:function(n){console.error(n)};function O0(n){this._internalRoot=n}Pp.prototype.render=O0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Y(409));Np(n,e,null,null)};Pp.prototype.unmount=O0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Ca(function(){Np(null,n,null,null)}),e[wi]=null}};function Pp(n){this._internalRoot=n}Pp.prototype.unstable_scheduleHydration=function(n){if(n){var e=SA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Qi.length&&e!==0&&e<Qi[t].priority;t++);Qi.splice(t,0,n),t===0&&TA(n)}};function V0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Dp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function VS(){}function NM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Pg(o);i.call(u)}}var o=WC(e,r,n,0,null,!1,!1,"",VS);return n._reactRootContainer=o,n[wi]=o.current,wd(n.nodeType===8?n.parentNode:n),Ca(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Pg(l);a.call(u)}}var l=L0(n,0,!1,null,null,!1,!1,"",VS);return n._reactRootContainer=l,n[wi]=l.current,wd(n.nodeType===8?n.parentNode:n),Ca(function(){Np(e,l,t,r)}),l}function Lp(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Pg(o);a.call(l)}}Np(e,o,n,s)}else o=NM(t,e,n,s,r);return Pg(o)}IA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Cu(e.pendingLanes);t!==0&&(n0(e,t|1),Tr(e,mn()),!(ft&6)&&(lc=mn()+500,$o()))}break;case 13:Ca(function(){var r=Ii(n,1);if(r!==null){var s=hr();Is(r,n,1,s)}}),M0(n,1)}};r0=function(n){if(n.tag===13){var e=Ii(n,134217728);if(e!==null){var t=hr();Is(e,n,134217728,t)}M0(n,134217728)}};xA=function(n){if(n.tag===13){var e=mo(n),t=Ii(n,e);if(t!==null){var r=hr();Is(t,n,e,r)}M0(n,e)}};SA=function(){return bt};EA=function(n,e){var t=bt;try{return bt=n,e()}finally{bt=t}};d_=function(n,e,t){switch(e){case"input":if(s_(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Ep(r);if(!s)throw Error(Y(90));tA(r),s_(r,s)}}}break;case"textarea":rA(n,t);break;case"select":e=t.value,e!=null&&$l(n,!!t.multiple,e,!1)}};uA=k0;dA=Ca;var PM={usingClientEntryPoint:!1,Events:[lh,Pl,Ep,lA,cA,k0]},pu={findFiberByHostInstance:ua,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},DM={bundleType:pu.bundleType,version:pu.version,rendererPackageName:pu.rendererPackageName,rendererConfig:pu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ki.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=gA(n),n===null?null:n.stateNode},findFiberByHostInstance:pu.findFiberByHostInstance||kM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mf.isDisabled&&mf.supportsFiber)try{wp=mf.inject(DM),qs=mf}catch{}}Hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=PM;Hr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!V0(e))throw Error(Y(200));return RM(n,e,null,t)};Hr.createRoot=function(n,e){if(!V0(n))throw Error(Y(299));var t=!1,r="",s=GC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=L0(n,1,!1,null,null,t,!1,r,s),n[wi]=e.current,wd(n.nodeType===8?n.parentNode:n),new O0(e)};Hr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Y(188)):(n=Object.keys(n).join(","),Error(Y(268,n)));return n=gA(e),n=n===null?null:n.stateNode,n};Hr.flushSync=function(n){return Ca(n)};Hr.hydrate=function(n,e,t){if(!Dp(e))throw Error(Y(200));return Lp(null,n,e,!0,t)};Hr.hydrateRoot=function(n,e,t){if(!V0(n))throw Error(Y(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=GC;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=WC(e,null,n,1,t??null,s,!1,i,o),n[wi]=e.current,wd(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Pp(e)};Hr.render=function(n,e,t){if(!Dp(e))throw Error(Y(200));return Lp(null,n,e,!1,t)};Hr.unmountComponentAtNode=function(n){if(!Dp(n))throw Error(Y(40));return n._reactRootContainer?(Ca(function(){Lp(null,null,n,!1,function(){n._reactRootContainer=null,n[wi]=null})}),!0):!1};Hr.unstable_batchedUpdates=k0;Hr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Dp(t))throw Error(Y(200));if(n==null||n._reactInternals===void 0)throw Error(Y(38));return Lp(n,e,t,!1,r)};Hr.version="18.3.1-next-f1338f8080-20240426";function HC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(HC)}catch(n){console.error(n)}}HC(),Hb.exports=Hr;var LM=Hb.exports,FS=LM;Jy.createRoot=FS.createRoot,Jy.hydrateRoot=FS.hydrateRoot;const MM="modulepreload",OM=function(n){return"/"+n},jS={},Me=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=OM(i),i in jS)return;jS[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":MM,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},VM=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QC={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X=function(n,e){if(!n)throw Fc(e)},Fc=function(n){return new Error("Firebase Database ("+QC.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},FM=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},F0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(g=64)),r.push(t[h],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(KC(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):FM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new jM;const g=i<<2|a>>4;if(r.push(g),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const _=u<<6&192|f;r.push(_)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class jM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const YC=function(n){const e=KC(n);return F0.encodeByteArray(e,!0)},Dg=function(n){return YC(n).replace(/\./g,"")},Lg=function(n){try{return F0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UM(n){return JC(void 0,n)}function JC(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!$M(t)||(n[t]=JC(n[t],e[t]));return n}function $M(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BM=()=>XC().__FIREBASE_DEFAULTS__,zM=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},qM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Lg(n[1]);return e&&JSON.parse(e)},Mp=()=>{try{return VM()||BM()||zM()||qM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ZC=n=>{var e,t;return(t=(e=Mp())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},e1=n=>{const e=ZC(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},t1=()=>{var n;return(n=Mp())==null?void 0:n.config},n1=n=>{var e;return(e=Mp())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ni(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Op(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Dg(JSON.stringify(t)),Dg(JSON.stringify(o)),a].join(".")}const Hu={};function WM(){const n={prod:[],emulator:[]};for(const e of Object.keys(Hu))Hu[e]?n.emulator.push(e):n.prod.push(e);return n}function GM(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let US=!1;function j0(n,e){if(typeof window>"u"||typeof document>"u"||!Ni(window.location.host)||Hu[n]===e||Hu[n]||US)return;Hu[n]=e;function t(g){return`__firebase__banner__${g}`}const r="__firebase__banner",i=WM().prod.length>0;function o(){const g=document.getElementById(r);g&&g.remove()}function a(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function l(g,y){g.setAttribute("width","24"),g.setAttribute("id",y),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function u(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{US=!0,o()},g}function h(g,y){g.setAttribute("id",y),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function f(){const g=GM(r),y=t("text"),_=document.getElementById(y)||document.createElement("span"),C=t("learnmore"),N=document.getElementById(C)||document.createElement("a"),T=t("preprendIcon"),x=document.getElementById(T)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const k=g.element;a(k),h(N,C);const P=u();l(x,T),k.append(x,_,N,P),document.body.appendChild(k)}i?(_.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function U0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Cn())}function s1(){var e;const n=(e=Mp())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function HM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function $0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function i1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function QM(){const n=Cn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function o1(){return QC.NODE_ADMIN===!0}function a1(){return!s1()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function l1(){return!s1()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Vp(){try{return typeof indexedDB=="object"}catch{return!1}}function B0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function c1(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KM="FirebaseError";class bs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=KM,Object.setPrototypeOf(this,bs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qa.prototype.create)}}class Qa{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?YM(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new bs(s,a,r)}}function YM(n,e){return n.replace(JM,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const JM=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rd(n){return JSON.parse(n)}function bn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u1=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Rd(Lg(i[0])||""),t=Rd(Lg(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},XM=function(n){const e=u1(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},ZM=function(n){const e=u1(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function As(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ra(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Mg(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Og(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function qr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if($S(i)&&$S(o)){if(!qr(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function $S(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ku(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Nu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const g=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(g<<1|g>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const g=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=g}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function tO(n,e){const t=new nO(n,e);return t.subscribe.bind(t)}class nO{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");rO(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=wy),s.error===void 0&&(s.error=wy),s.complete===void 0&&(s.complete=wy);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function rO(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function wy(){}function ka(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,X(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Fp=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iO=1e3,oO=2,aO=4*60*60*1e3,lO=.5;function BS(n,e=iO,t=oO){const r=e*Math.pow(t,n),s=Math.round(lO*r*(Math.random()-.5)*2);return Math.min(aO,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(n){return n&&n._delegate?n._delegate:n}class Cr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Or;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(uO(e))try{this.getOrInitializeService({instanceIdentifier:na})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=na){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=na){return this.instances.has(e)}getOptions(e=na){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:cO(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=na){return this.component?this.component.multipleInstances?e:na:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function cO(n){return n===na?void 0:n}function uO(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new q_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(rt||(rt={}));const dO={debug:rt.DEBUG,verbose:rt.VERBOSE,info:rt.INFO,warn:rt.WARN,error:rt.ERROR,silent:rt.SILENT},hO=rt.INFO,fO={[rt.DEBUG]:"log",[rt.VERBOSE]:"log",[rt.INFO]:"info",[rt.WARN]:"warn",[rt.ERROR]:"error"},gO=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=fO[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class uh{constructor(e){this.name=e,this._logLevel=hO,this._logHandler=gO,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?dO[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rt.DEBUG,...e),this._logHandler(this,rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rt.VERBOSE,...e),this._logHandler(this,rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rt.INFO,...e),this._logHandler(this,rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rt.WARN,...e),this._logHandler(this,rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rt.ERROR,...e),this._logHandler(this,rt.ERROR,...e)}}const pO=(n,e)=>e.some(t=>n instanceof t);let zS,qS;function mO(){return zS||(zS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yO(){return qS||(qS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const h1=new WeakMap,W_=new WeakMap,f1=new WeakMap,Iy=new WeakMap,z0=new WeakMap;function _O(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(_o(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&h1.set(t,n)}).catch(()=>{}),z0.set(e,n),e}function vO(n){if(W_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});W_.set(n,e)}let G_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return W_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||f1.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return _o(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function wO(n){G_=n(G_)}function IO(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(xy(this),e,...t);return f1.set(r,e.sort?e.sort():[e]),_o(r)}:yO().includes(n)?function(...e){return n.apply(xy(this),e),_o(h1.get(this))}:function(...e){return _o(n.apply(xy(this),e))}}function xO(n){return typeof n=="function"?IO(n):(n instanceof IDBTransaction&&vO(n),pO(n,mO())?new Proxy(n,G_):n)}function _o(n){if(n instanceof IDBRequest)return _O(n);if(Iy.has(n))return Iy.get(n);const e=xO(n);return e!==n&&(Iy.set(n,e),z0.set(e,n)),e}const xy=n=>z0.get(n);function g1(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=_o(o);return r&&o.addEventListener("upgradeneeded",l=>{r(_o(o.result),l.oldVersion,l.newVersion,_o(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const SO=["get","getKey","getAll","getAllKeys","count"],EO=["put","add","delete","clear"],Sy=new Map;function WS(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Sy.get(e))return Sy.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=EO.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||SO.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return Sy.set(e,i),i}wO(n=>({...n,get:(e,t,r)=>WS(e,t)||n.get(e,t,r),has:(e,t)=>!!WS(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(bO(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function bO(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const H_="@firebase/app",GS="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Si=new uh("@firebase/app"),AO="@firebase/app-compat",CO="@firebase/analytics-compat",RO="@firebase/analytics",kO="@firebase/app-check-compat",NO="@firebase/app-check",PO="@firebase/auth",DO="@firebase/auth-compat",LO="@firebase/database",MO="@firebase/data-connect",OO="@firebase/database-compat",VO="@firebase/functions",FO="@firebase/functions-compat",jO="@firebase/installations",UO="@firebase/installations-compat",$O="@firebase/messaging",BO="@firebase/messaging-compat",zO="@firebase/performance",qO="@firebase/performance-compat",WO="@firebase/remote-config",GO="@firebase/remote-config-compat",HO="@firebase/storage",QO="@firebase/storage-compat",KO="@firebase/firestore",YO="@firebase/ai",JO="@firebase/firestore-compat",XO="firebase",ZO="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vg="[DEFAULT]",eV={[H_]:"fire-core",[AO]:"fire-core-compat",[RO]:"fire-analytics",[CO]:"fire-analytics-compat",[NO]:"fire-app-check",[kO]:"fire-app-check-compat",[PO]:"fire-auth",[DO]:"fire-auth-compat",[LO]:"fire-rtdb",[MO]:"fire-data-connect",[OO]:"fire-rtdb-compat",[VO]:"fire-fn",[FO]:"fire-fn-compat",[jO]:"fire-iid",[UO]:"fire-iid-compat",[$O]:"fire-fcm",[BO]:"fire-fcm-compat",[zO]:"fire-perf",[qO]:"fire-perf-compat",[WO]:"fire-rc",[GO]:"fire-rc-compat",[HO]:"fire-gcs",[QO]:"fire-gcs-compat",[KO]:"fire-fst",[JO]:"fire-fst-compat",[YO]:"fire-vertex","fire-js":"fire-js",[XO]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kd=new Map,tV=new Map,Q_=new Map;function HS(n,e){try{n.container.addComponent(e)}catch(t){Si.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ts(n){const e=n.name;if(Q_.has(e))return Si.debug(`There were multiple attempts to register component ${e}.`),!1;Q_.set(e,n);for(const t of kd.values())HS(t,n);for(const t of tV.values())HS(t,n);return!0}function ei(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function nV(n,e,t=Vg){ei(n,e).clearInstance(t)}function en(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rV={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vo=new Qa("app","Firebase",rV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sV{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Cr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya=ZO;function p1(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Vg,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw vo.create("bad-app-name",{appName:String(s)});if(t||(t=t1()),!t)throw vo.create("no-options");const i=kd.get(s);if(i){if(qr(t,i.options)&&qr(r,i.config))return i;throw vo.create("duplicate-app",{appName:s})}const o=new d1(s);for(const l of Q_.values())o.addComponent(l);const a=new sV(t,r,o);return kd.set(s,a),a}function dh(n=Vg){const e=kd.get(n);if(!e&&n===Vg&&t1())return p1();if(!e)throw vo.create("no-app",{appName:n});return e}function iV(){return Array.from(kd.values())}function br(n,e,t){let r=eV[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Si.warn(o.join(" "));return}Ts(new Cr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oV="firebase-heartbeat-database",aV=1,Nd="firebase-heartbeat-store";let Ey=null;function m1(){return Ey||(Ey=g1(oV,aV,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Nd)}catch(t){console.warn(t)}}}}).catch(n=>{throw vo.create("idb-open",{originalErrorMessage:n.message})})),Ey}async function lV(n){try{const t=(await m1()).transaction(Nd),r=await t.objectStore(Nd).get(y1(n));return await t.done,r}catch(e){if(e instanceof bs)Si.warn(e.message);else{const t=vo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Si.warn(t.message)}}}async function QS(n,e){try{const r=(await m1()).transaction(Nd,"readwrite");await r.objectStore(Nd).put(e,y1(n)),await r.done}catch(t){if(t instanceof bs)Si.warn(t.message);else{const r=vo.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Si.warn(r.message)}}}function y1(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV=1024,uV=30;class dV{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new fV(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=KS();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>uV){const o=gV(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Si.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=KS(),{heartbeatsToSend:r,unsentEntries:s}=hV(this._heartbeatsCache.heartbeats),i=Dg(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Si.warn(t),""}}}function KS(){return new Date().toISOString().substring(0,10)}function hV(n,e=cV){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),YS(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),YS(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class fV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Vp()?B0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await lV(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return QS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return QS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function YS(n){return Dg(JSON.stringify({version:2,heartbeats:n})).length}function gV(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pV(n){Ts(new Cr("platform-logger",e=>new TO(e),"PRIVATE")),Ts(new Cr("heartbeat",e=>new dV(e),"PRIVATE")),br(H_,GS,n),br(H_,GS,"esm2020"),br("fire-js","")}pV("");var mV="firebase",yV="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */br(mV,yV,"app");const JS="@firebase/database",XS="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _1="";function v1(n){_1=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),bn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Rd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vV{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return As(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w1=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new _V(e)}}catch{}return new vV},fa=w1("localStorage"),K_=w1("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hl=new uh("@firebase/database"),I1=function(){let n=1;return function(){return n++}}(),x1=function(n){const e=sO(n),t=new eO;t.update(e);const r=t.digest();return F0.encodeByteArray(r)},hh=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=hh.apply(null,r):typeof r=="object"?e+=bn(r):e+=r,e+=" "}return e};let va=null,ZS=!0;const S1=function(n,e){X(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Hl.logLevel=rt.VERBOSE,va=Hl.log.bind(Hl),e&&K_.set("logging_enabled",!0)):typeof n=="function"?va=n:(va=null,K_.remove("logging_enabled"))},Ln=function(...n){if(ZS===!0&&(ZS=!1,va===null&&K_.get("logging_enabled")===!0&&S1(!0)),va){const e=hh.apply(null,n);va(e)}},fh=function(n){return function(...e){Ln(n,...e)}},Y_=function(...n){const e="FIREBASE INTERNAL ERROR: "+hh(...n);Hl.error(e)},Js=function(...n){const e=`FIREBASE FATAL ERROR: ${hh(...n)}`;throw Hl.error(e),new Error(e)},ir=function(...n){const e="FIREBASE WARNING: "+hh(...n);Hl.warn(e)},wV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ir("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},jp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},IV=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ao="[MIN_NAME]",Ei="[MAX_NAME]",Ja=function(n,e){if(n===e)return 0;if(n===Ao||e===Ei)return-1;if(e===Ao||n===Ei)return 1;{const t=eE(n),r=eE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},xV=function(n,e){return n===e?0:n<e?-1:1},mu=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+bn(e))},q0=function(n){if(typeof n!="object"||n===null)return bn(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=bn(e[r]),t+=":",t+=q0(n[e[r]]);return t+="}",t},E1=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Fn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const T1=function(n){X(!jp(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let g=parseInt(h.substr(l,8),2).toString(16);g.length===1&&(g="0"+g),f=f+g}return f.toLowerCase()},SV=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},EV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function TV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const bV=new RegExp("^-?(0*)\\d{1,10}$"),AV=-2147483648,CV=2147483647,eE=function(n){if(bV.test(n)){const e=Number(n);if(e>=AV&&e<=CV)return e}return null},jc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw ir("Exception was thrown by user callback.",t),e},Math.floor(0))}},RV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Qu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kV{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,en(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){ir(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ln("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ir(e)}}class Ql{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ql.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W0="5",b1="v",A1="s",C1="r",R1="f",k1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,N1="ls",P1="p",J_="ac",D1="websocket",L1="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=fa.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&fa.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function PV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function O1(n,e,t){X(typeof e=="string","typeof type must == string"),X(typeof t=="object","typeof params must == object");let r;if(e===D1)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===L1)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);PV(n)&&(t.ns=n.namespace);const s=[];return Fn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(){this.counters_={}}incrementCounter(e,t=1){As(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return UM(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ty={},by={};function G0(n){const e=n.toString();return Ty[e]||(Ty[e]=new DV),Ty[e]}function LV(n,e){const t=n.toString();return by[t]||(by[t]=e()),by[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&jc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE="start",OV="close",VV="pLPCommand",FV="pRTLPCB",V1="id",F1="pw",j1="ser",jV="cb",UV="seg",$V="ts",BV="d",zV="dframe",U1=1870,$1=30,qV=U1-$1,WV=25e3,GV=3e4;class ro{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=fh(e),this.stats_=G0(t),this.urlFn=l=>(this.appCheckToken&&(l[J_]=this.appCheckToken),O1(t,L1,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new MV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(GV)),IV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new H0((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===tE)this.id=a,this.password=l;else if(o===OV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[tE]="t",r[j1]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[jV]=this.scriptTagHolder.uniqueCallbackIdentifier),r[b1]=W0,this.transportSessionId&&(r[A1]=this.transportSessionId),this.lastSessionId&&(r[N1]=this.lastSessionId),this.applicationId&&(r[P1]=this.applicationId),this.appCheckToken&&(r[J_]=this.appCheckToken),typeof location<"u"&&location.hostname&&k1.test(location.hostname)&&(r[C1]=R1);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ro.forceAllow_=!0}static forceDisallow(){ro.forceDisallow_=!0}static isAvailable(){return ro.forceAllow_?!0:!ro.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!SV()&&!EV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=bn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=YC(t),s=E1(r,qV);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[zV]="t",r[V1]=e,r[F1]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=bn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class H0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=I1(),window[VV+this.uniqueCallbackIdentifier]=e,window[FV+this.uniqueCallbackIdentifier]=t,this.myIFrame=H0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ln("frame writing exception"),a.stack&&Ln(a.stack),Ln(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ln("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[V1]=this.myID,e[F1]=this.myPW,e[j1]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+$1+r.length<=U1;){const o=this.pendingSegs.shift();r=r+"&"+UV+s+"="+o.seg+"&"+$V+s+"="+o.ts+"&"+BV+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(WV)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Ln("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HV=16384,QV=45e3;let Fg=null;typeof MozWebSocket<"u"?Fg=MozWebSocket:typeof WebSocket<"u"&&(Fg=WebSocket);class es{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=fh(this.connId),this.stats_=G0(t),this.connURL=es.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[b1]=W0,typeof location<"u"&&location.hostname&&k1.test(location.hostname)&&(o[C1]=R1),t&&(o[A1]=t),r&&(o[N1]=r),s&&(o[J_]=s),i&&(o[P1]=i),O1(e,D1,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,fa.set("previous_websocket_failure",!0);try{let r;o1(),this.mySock=new Fg(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){es.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Fg!==null&&!es.forceDisallow_}static previouslyFailed(){return fa.isInMemoryStorage||fa.get("previous_websocket_failure")===!0}markConnectionHealthy(){fa.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Rd(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(X(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=bn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=E1(t,HV);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(QV))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}es.responsesRequiredToBeHealthy=2;es.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{static get ALL_TRANSPORTS(){return[ro,es]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=es&&es.isAvailable();let r=t&&!es.previouslyFailed();if(e.webSocketOnly&&(t||ir("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[es];else{const s=this.transports_=[];for(const i of cc.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);cc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}cc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KV=6e4,YV=5e3,JV=10*1024,XV=100*1024,Ay="t",nE="d",ZV="s",rE="r",eF="e",sE="o",iE="a",oE="n",aE="p",tF="h";class nF{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=fh("c:"+this.id+":"),this.transportManager_=new cc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Qu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>XV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>JV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ay in e){const t=e[Ay];t===iE?this.upgradeIfSecondaryHealthy_():t===rE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===sE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=mu("t",e),r=mu("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:aE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:iE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:oE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=mu("t",e),r=mu("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=mu(Ay,e);if(nE in e){const r=e[nE];if(t===tF){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===oE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===ZV?this.onConnectionShutdown_(r):t===rE?this.onReset_(r):t===eF?Y_("Server Error: "+r):t===sE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Y_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),W0!==r&&ir("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Qu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(KV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Qu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(YV))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:aE,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(fa.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{constructor(e){this.allowedEvents_=e,this.listeners_={},X(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){X(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg extends z1{static getInstance(){return new jg}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!U0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return X(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lE=32,cE=768;class St{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function vt(){return new St("")}function Ze(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Co(n){return n.pieces_.length-n.pieceNum_}function Mt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new St(n.pieces_,e)}function Q0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function rF(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Pd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function q1(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new St(e,0)}function tn(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof St)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new St(t,0)}function et(n){return n.pieceNum_>=n.pieces_.length}function dr(n,e){const t=Ze(n),r=Ze(e);if(t===null)return e;if(t===r)return dr(Mt(n),Mt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function sF(n,e){const t=Pd(n,0),r=Pd(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=Ja(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function K0(n,e){if(Co(n)!==Co(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function ns(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Co(n)>Co(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class iF{constructor(e,t){this.errorPrefix_=t,this.parts_=Pd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Fp(this.parts_[r]);W1(this)}}function oF(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Fp(e),W1(n)}function aF(n){const e=n.parts_.pop();n.byteLength_-=Fp(e),n.parts_.length>0&&(n.byteLength_-=1)}function W1(n){if(n.byteLength_>cE)throw new Error(n.errorPrefix_+"has a key path longer than "+cE+" bytes ("+n.byteLength_+").");if(n.parts_.length>lE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+lE+") or object contains a cycle "+ra(n))}function ra(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0 extends z1{static getInstance(){return new Y0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return X(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yu=1e3,lF=60*5*1e3,uE=30*1e3,cF=1.3,uF=3e4,dF="server_kill",dE=3;class ss extends B1{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=ss.nextPersistentConnectionId_++,this.log_=fh("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=yu,this.maxReconnectDelay_=lF,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!o1())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Y0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&jg.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(bn(i)),X(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Or,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),X(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),X(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;ss.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&As(e,"w")){const r=Ra(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();ir(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||ZM(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=uE)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=XM(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),X(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+bn(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Y_("Unrecognized action received from server: "+bn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){X(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=yu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=yu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>uF&&(this.reconnectDelay_=yu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*cF)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+ss.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){X(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,g]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Ln("getToken() completed but was canceled"):(Ln("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=g&&g.token,a=new nF(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{ir(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(dF)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&ir(f),l())}}}interrupt(e){Ln("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ln("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Mg(this.interruptReasons_)&&(this.reconnectDelay_=yu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>q0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new St(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Ln("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=dE&&(this.reconnectDelay_=uE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ln("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=dE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+_1.replace(/\./g,"-")]=1,U0()?e["framework.cordova"]=1:i1()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=jg.getInstance().currentlyOnline();return Mg(this.interruptReasons_)&&e}}ss.nextPersistentConnectionId_=0;ss.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new tt(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new tt(Ao,e),s=new tt(Ao,t);return this.compare(r,s)!==0}minPost(){return tt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yf;class G1 extends Up{static get __EMPTY_NODE(){return yf}static set __EMPTY_NODE(e){yf=e}compare(e,t){return Ja(e.name,t.name)}isDefinedOn(e){throw Fc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return tt.MIN}maxPost(){return new tt(Ei,yf)}makePost(e,t){return X(typeof e=="string","KeyIndex indexValue must always be a string."),new tt(e,yf)}toString(){return".key"}}const Gs=new G1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _f=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Lr=class Pu{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Pu.RED,this.left=s??js.EMPTY_NODE,this.right=i??js.EMPTY_NODE}copy(e,t,r,s,i){return new Pu(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return js.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return js.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Pu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Pu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Lr.RED=!0;Lr.BLACK=!1;class hF{copy(e,t,r,s,i){return this}insert(e,t,r){return new Lr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let js=class Wf{constructor(e,t=Wf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Wf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Lr.BLACK,null,null))}remove(e){return new Wf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Lr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new _f(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new _f(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new _f(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new _f(this.root_,null,this.comparator_,!0,e)}};js.EMPTY_NODE=new hF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fF(n,e){return Ja(n.name,e.name)}function J0(n,e){return Ja(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let X_;function gF(n){X_=n}const H1=function(n){return typeof n=="number"?"number:"+T1(n):"string:"+n},Q1=function(n){if(n.isLeafNode()){const e=n.val();X(typeof e=="string"||typeof e=="number"||typeof e=="object"&&As(e,".sv"),"Priority must be a string or number.")}else X(n===X_||n.isEmpty(),"priority of unexpected type.");X(n===X_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hE;class kn{static set __childrenNodeConstructor(e){hE=e}static get __childrenNodeConstructor(){return hE}constructor(e,t=kn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,X(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Q1(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new kn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:kn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return et(e)?this:Ze(e)===".priority"?this.priorityNode_:kn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:kn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=Ze(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(X(r!==".priority"||Co(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,kn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Mt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+H1(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=T1(this.value_):e+=this.value_,this.lazyHash_=x1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===kn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof kn.__childrenNodeConstructor?-1:(X(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=kn.VALUE_TYPE_ORDER.indexOf(t),i=kn.VALUE_TYPE_ORDER.indexOf(r);return X(s>=0,"Unknown leaf type: "+t),X(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}kn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K1,Y1;function pF(n){K1=n}function mF(n){Y1=n}class yF extends Up{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?Ja(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return tt.MIN}maxPost(){return new tt(Ei,new kn("[PRIORITY-POST]",Y1))}makePost(e,t){const r=K1(e);return new tt(t,new kn("[PRIORITY-POST]",r))}toString(){return".priority"}}const $t=new yF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _F=Math.log(2);class vF{constructor(e){const t=i=>parseInt(Math.log(i)/_F,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ug=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,g;if(h===0)return null;if(h===1)return f=n[l],g=t?t(f):f,new Lr(g,f.node,Lr.BLACK,null,null);{const y=parseInt(h/2,10)+l,_=s(l,y),C=s(y+1,u);return f=n[y],g=t?t(f):f,new Lr(g,f.node,Lr.BLACK,_,C)}},i=function(l){let u=null,h=null,f=n.length;const g=function(_,C){const N=f-_,T=f;f-=_;const x=s(N+1,T),k=n[N],P=t?t(k):k;y(new Lr(P,k.node,C,null,x))},y=function(_){u?(u.left=_,u=_):(h=_,u=_)};for(let _=0;_<l.count;++_){const C=l.nextBitIsOne(),N=Math.pow(2,l.count-(_+1));C?g(N,Lr.BLACK):(g(N,Lr.BLACK),g(N,Lr.RED))}return h},o=new vF(n.length),a=i(o);return new js(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cy;const ml={};class fi{static get Default(){return X(ml&&$t,"ChildrenNode.ts has not been loaded"),Cy=Cy||new fi({".priority":ml},{".priority":$t}),Cy}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ra(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof js?t:null}hasIndex(e){return As(this.indexSet_,e.toString())}addIndex(e,t){X(e!==Gs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(tt.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Ug(r,e.getCompare()):a=ml;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new fi(h,u)}addToIndexes(e,t){const r=Og(this.indexes_,(s,i)=>{const o=Ra(this.indexSet_,i);if(X(o,"Missing index implementation for "+i),s===ml)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(tt.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Ug(a,o.getCompare())}else return ml;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new tt(e.name,a))),l.insert(e,e.node)}});return new fi(r,this.indexSet_)}removeFromIndexes(e,t){const r=Og(this.indexes_,s=>{if(s===ml)return s;{const i=t.get(e.name);return i?s.remove(new tt(e.name,i)):s}});return new fi(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _u;class Fe{static get EMPTY_NODE(){return _u||(_u=new Fe(new js(J0),null,fi.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Q1(this.priorityNode_),this.children_.isEmpty()&&X(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||_u}updatePriority(e){return this.children_.isEmpty()?this:new Fe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?_u:t}}getChild(e){const t=Ze(e);return t===null?this:this.getImmediateChild(t).getChild(Mt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(X(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new tt(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?_u:this.priorityNode_;return new Fe(s,o,i)}}updateChild(e,t){const r=Ze(e);if(r===null)return t;{X(Ze(e)!==".priority"||Co(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Mt(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild($t,(o,a)=>{t[o]=a.val(e),r++,i&&Fe.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+H1(this.getPriority().val())+":"),this.forEachChild($t,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":x1(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new tt(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new tt(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new tt(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,tt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,tt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===gh?-1:0}withIndex(e){if(e===Gs||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Fe(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Gs||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator($t),s=t.getIterator($t);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Gs?null:this.indexMap_.get(e.toString())}}Fe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class wF extends Fe{constructor(){super(new js(J0),Fe.EMPTY_NODE,fi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Fe.EMPTY_NODE}isEmpty(){return!1}}const gh=new wF;Object.defineProperties(tt,{MIN:{value:new tt(Ao,Fe.EMPTY_NODE)},MAX:{value:new tt(Ei,gh)}});G1.__EMPTY_NODE=Fe.EMPTY_NODE;kn.__childrenNodeConstructor=Fe;gF(gh);mF(gh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IF=!0;function an(n,e=null){if(n===null)return Fe.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),X(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new kn(t,an(e))}if(!(n instanceof Array)&&IF){const t=[];let r=!1;if(Fn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=an(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new tt(o,l)))}}),t.length===0)return Fe.EMPTY_NODE;const i=Ug(t,fF,o=>o.name,J0);if(r){const o=Ug(t,$t.getCompare());return new Fe(i,an(e),new fi({".priority":o},{".priority":$t}))}else return new Fe(i,an(e),fi.Default)}else{let t=Fe.EMPTY_NODE;return Fn(n,(r,s)=>{if(As(n,r)&&r.substring(0,1)!=="."){const i=an(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(an(e))}}pF(an);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0 extends Up{constructor(e){super(),this.indexPath_=e,X(!et(e)&&Ze(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?Ja(e.name,t.name):i}makePost(e,t){const r=an(e),s=Fe.EMPTY_NODE.updateChild(this.indexPath_,r);return new tt(t,s)}maxPost(){const e=Fe.EMPTY_NODE.updateChild(this.indexPath_,gh);return new tt(Ei,e)}toString(){return Pd(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF extends Up{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Ja(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return tt.MIN}maxPost(){return tt.MAX}makePost(e,t){const r=an(e);return new tt(t,r)}toString(){return".value"}}const Z0=new xF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(n){return{type:"value",snapshotNode:n}}function uc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Dd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ld(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function SF(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){X(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Dd(t,a)):X(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(uc(t,r)):o.trackChildChange(Ld(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild($t,(s,i)=>{t.hasChild(s)||r.trackChildChange(Dd(s,i))}),t.isLeafNode()||t.forEachChild($t,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Ld(s,i,o))}else r.trackChildChange(uc(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Fe.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(e){this.indexedFilter_=new ew(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Md.getStartPost_(e),this.endPost_=Md.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new tt(t,r))||(r=Fe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Fe.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Fe.EMPTY_NODE);const i=this;return t.forEachChild($t,(o,a)=>{i.matches(new tt(o,a))||(s=s.updateImmediateChild(o,Fe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Md(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new tt(t,r))||(r=Fe.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=Fe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Fe.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(Fe.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Fe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(g,y)=>f(y,g)}else o=this.index_.getCompare();const a=e;X(a.numChildren()===this.limit_,"");const l=new tt(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let g=s.getChildAfterChild(this.index_,u,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=s.getChildAfterChild(this.index_,g,this.reverse_);const y=g==null?1:o(g,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Ld(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(Dd(t,f));const C=a.updateImmediateChild(t,Fe.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(i!=null&&i.trackChildChange(uc(g.name,g.node)),C.updateImmediateChild(g.name,g.node)):C}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(Dd(u.name,u.node)),i.trackChildChange(uc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,Fe.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$t}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return X(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return X(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ao}hasEnd(){return this.endSet_}getIndexEndValue(){return X(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return X(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ei}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return X(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===$t}copy(){const e=new tw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function TF(n){return n.loadsAllData()?new ew(n.getIndex()):n.hasLimit()?new EF(n):new Md(n)}function bF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function AF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Z_(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function CF(n,e,t){let r;return n.index_===Gs||t?r=Z_(n,e,t):r=Z_(n,e,Ei),r.startAfterSet_=!0,r}function ev(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function RF(n,e,t){let r;return n.index_===Gs||t?r=ev(n,e,t):r=ev(n,e,Ao),r.endBeforeSet_=!0,r}function $p(n,e){const t=n.copy();return t.index_=e,t}function fE(n){const e={};if(n.isDefault())return e;let t;if(n.index_===$t?t="$priority":n.index_===Z0?t="$value":n.index_===Gs?t="$key":(X(n.index_ instanceof X0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=bn(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=bn(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+bn(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=bn(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+bn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function gE(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==$t&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g extends B1{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(X(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=fh("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=$g.getListenId_(e,r),a={};this.listens_[o]=a;const l=fE(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Ra(this.listens_,o)===a){let g;u?u===401?g="permission_denied":g="rest_error:"+u:g="ok",s(g,null)}})}unlisten(e,t){const r=$g.getListenId_(e,t);delete this.listens_[r]}get(e){const t=fE(e._queryParams),r=e._path.toString(),s=new Or;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Ka(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Rd(a.responseText)}catch{ir("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&ir("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(){this.rootNode_=Fe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bg(){return{value:null,children:new Map}}function Uc(n,e,t){if(et(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=Ze(e);n.children.has(r)||n.children.set(r,Bg());const s=n.children.get(r);e=Mt(e),Uc(s,e,t)}}function tv(n,e){if(et(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild($t,(r,s)=>{Uc(n,new St(r),s)}),tv(n,e)}}else if(n.children.size>0){const t=Ze(e);return e=Mt(e),n.children.has(t)&&tv(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function nv(n,e,t){n.value!==null?t(e,n.value):NF(n,(r,s)=>{const i=new St(e.toString()+"/"+r);nv(s,i,t)})}function NF(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PF{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Fn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pE=10*1e3,DF=30*1e3,LF=5*60*1e3;class MF{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new PF(e);const r=pE+(DF-pE)*Math.random();Qu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Fn(e,(s,i)=>{i>0&&As(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),Qu(this.reportStats_.bind(this),Math.floor(Math.random()*2*LF))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _s;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(_s||(_s={}));function nw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rw(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function sw(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=_s.ACK_USER_WRITE,this.source=nw()}operationForChild(e){if(et(this.path)){if(this.affectedTree.value!=null)return X(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new St(e));return new zg(vt(),t,this.revert)}}else return X(Ze(this.path)===e,"operationForChild called for unrelated child."),new zg(Mt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(e,t){this.source=e,this.path=t,this.type=_s.LISTEN_COMPLETE}operationForChild(e){return et(this.path)?new Od(this.source,vt()):new Od(this.source,Mt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=_s.OVERWRITE}operationForChild(e){return et(this.path)?new Na(this.source,vt(),this.snap.getImmediateChild(e)):new Na(this.source,Mt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=_s.MERGE}operationForChild(e){if(et(this.path)){const t=this.children.subtree(new St(e));return t.isEmpty()?null:t.value?new Na(this.source,vt(),t.value):new dc(this.source,vt(),t)}else return X(Ze(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new dc(this.source,Mt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(et(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ze(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function VF(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(SF(o.childName,o.snapshotNode))}),vu(n,s,"child_removed",e,r,t),vu(n,s,"child_added",e,r,t),vu(n,s,"child_moved",i,r,t),vu(n,s,"child_changed",e,r,t),vu(n,s,"value",e,r,t),s}function vu(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>jF(n,a,l)),o.forEach(a=>{const l=FF(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function FF(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function jF(n,e,t){if(e.childName==null||t.childName==null)throw Fc("Should only compare child_ events.");const r=new tt(e.childName,e.snapshotNode),s=new tt(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bp(n,e){return{eventCache:n,serverCache:e}}function Ku(n,e,t,r){return Bp(new Ro(e,t,r),n.serverCache)}function X1(n,e,t,r){return Bp(n.eventCache,new Ro(e,t,r))}function qg(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Pa(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ry;const UF=()=>(Ry||(Ry=new js(xV)),Ry);class jt{static fromObject(e){let t=new jt(null);return Fn(e,(r,s)=>{t=t.set(new St(r),s)}),t}constructor(e,t=UF()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:vt(),value:this.value};if(et(e))return null;{const r=Ze(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Mt(e),t);return i!=null?{path:tn(new St(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(et(e))return this;{const t=Ze(e),r=this.children.get(t);return r!==null?r.subtree(Mt(e)):new jt(null)}}set(e,t){if(et(e))return new jt(t,this.children);{const r=Ze(e),i=(this.children.get(r)||new jt(null)).set(Mt(e),t),o=this.children.insert(r,i);return new jt(this.value,o)}}remove(e){if(et(e))return this.children.isEmpty()?new jt(null):new jt(null,this.children);{const t=Ze(e),r=this.children.get(t);if(r){const s=r.remove(Mt(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new jt(null):new jt(this.value,i)}else return this}}get(e){if(et(e))return this.value;{const t=Ze(e),r=this.children.get(t);return r?r.get(Mt(e)):null}}setTree(e,t){if(et(e))return t;{const r=Ze(e),i=(this.children.get(r)||new jt(null)).setTree(Mt(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new jt(this.value,o)}}fold(e){return this.fold_(vt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(tn(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,vt(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(et(e))return null;{const i=Ze(e),o=this.children.get(i);return o?o.findOnPath_(Mt(e),tn(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,vt(),t)}foreachOnPath_(e,t,r){if(et(e))return this;{this.value&&r(t,this.value);const s=Ze(e),i=this.children.get(s);return i?i.foreachOnPath_(Mt(e),tn(t,s),r):new jt(null)}}foreach(e){this.foreach_(vt(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(tn(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e){this.writeTree_=e}static empty(){return new xs(new jt(null))}}function Yu(n,e,t){if(et(e))return new xs(new jt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=dr(s,e);return i=i.updateChild(o,t),new xs(n.writeTree_.set(s,i))}else{const s=new jt(t),i=n.writeTree_.setTree(e,s);return new xs(i)}}}function rv(n,e,t){let r=n;return Fn(t,(s,i)=>{r=Yu(r,tn(e,s),i)}),r}function mE(n,e){if(et(e))return xs.empty();{const t=n.writeTree_.setTree(e,new jt(null));return new xs(t)}}function sv(n,e){return Xa(n,e)!=null}function Xa(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(dr(t.path,e)):null}function yE(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild($t,(r,s)=>{e.push(new tt(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new tt(r,s.value))}),e}function wo(n,e){if(et(e))return n;{const t=Xa(n,e);return t!=null?new xs(new jt(t)):new xs(n.writeTree_.subtree(e))}}function iv(n){return n.writeTree_.isEmpty()}function hc(n,e){return Z1(vt(),n.writeTree_,e)}function Z1(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(X(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=Z1(tn(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(tn(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zp(n,e){return rR(e,n)}function $F(n,e,t,r,s){X(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=Yu(n.visibleWrites,e,t)),n.lastWriteId=r}function BF(n,e,t,r){X(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=rv(n.visibleWrites,e,t),n.lastWriteId=r}function zF(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function qF(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);X(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&WF(a,r.path)?s=!1:ns(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return GF(n),!0;if(r.snap)n.visibleWrites=mE(n.visibleWrites,r.path);else{const a=r.children;Fn(a,l=>{n.visibleWrites=mE(n.visibleWrites,tn(r.path,l))})}return!0}else return!1}function WF(n,e){if(n.snap)return ns(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&ns(tn(n.path,t),e))return!0;return!1}function GF(n){n.visibleWrites=eR(n.allWrites,HF,vt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function HF(n){return n.visible}function eR(n,e,t){let r=xs.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)ns(t,o)?(a=dr(t,o),r=Yu(r,a,i.snap)):ns(o,t)&&(a=dr(o,t),r=Yu(r,vt(),i.snap.getChild(a)));else if(i.children){if(ns(t,o))a=dr(t,o),r=rv(r,a,i.children);else if(ns(o,t))if(a=dr(o,t),et(a))r=rv(r,vt(),i.children);else{const l=Ra(i.children,Ze(a));if(l){const u=l.getChild(Mt(a));r=Yu(r,vt(),u)}}}else throw Fc("WriteRecord should have .snap or .children")}}return r}function tR(n,e,t,r,s){if(!r&&!s){const i=Xa(n.visibleWrites,e);if(i!=null)return i;{const o=wo(n.visibleWrites,e);if(iv(o))return t;if(t==null&&!sv(o,vt()))return null;{const a=t||Fe.EMPTY_NODE;return hc(o,a)}}}else{const i=wo(n.visibleWrites,e);if(!s&&iv(i))return t;if(!s&&t==null&&!sv(i,vt()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(ns(u.path,e)||ns(e,u.path))},a=eR(n.allWrites,o,e),l=t||Fe.EMPTY_NODE;return hc(a,l)}}}function QF(n,e,t){let r=Fe.EMPTY_NODE;const s=Xa(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild($t,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=wo(n.visibleWrites,e);return t.forEachChild($t,(o,a)=>{const l=hc(wo(i,new St(o)),a);r=r.updateImmediateChild(o,l)}),yE(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=wo(n.visibleWrites,e);return yE(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function KF(n,e,t,r,s){X(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=tn(e,t);if(sv(n.visibleWrites,i))return null;{const o=wo(n.visibleWrites,i);return iv(o)?s.getChild(t):hc(o,s.getChild(t))}}function YF(n,e,t,r){const s=tn(e,t),i=Xa(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=wo(n.visibleWrites,s);return hc(o,r.getNode().getImmediateChild(t))}else return null}function JF(n,e){return Xa(n.visibleWrites,e)}function XF(n,e,t,r,s,i,o){let a;const l=wo(n.visibleWrites,e),u=Xa(l,vt());if(u!=null)a=u;else if(t!=null)a=hc(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),g=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=g.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=g.getNext();return h}else return[]}function ZF(){return{visibleWrites:xs.empty(),allWrites:[],lastWriteId:-1}}function Wg(n,e,t,r){return tR(n.writeTree,n.treePath,e,t,r)}function iw(n,e){return QF(n.writeTree,n.treePath,e)}function _E(n,e,t,r){return KF(n.writeTree,n.treePath,e,t,r)}function Gg(n,e){return JF(n.writeTree,tn(n.treePath,e))}function ej(n,e,t,r,s,i){return XF(n.writeTree,n.treePath,e,t,r,s,i)}function ow(n,e,t){return YF(n.writeTree,n.treePath,e,t)}function nR(n,e){return rR(tn(n.treePath,e),n.writeTree)}function rR(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;X(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),X(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Ld(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Dd(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,uc(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Ld(r,e.snapshotNode,s.oldSnap));else throw Fc("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const sR=new nj;class aw{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Ro(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ow(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Pa(this.viewCache_),i=ej(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rj(n){return{filter:n}}function sj(n,e){X(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),X(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function ij(n,e,t,r,s){const i=new tj;let o,a;if(t.type===_s.OVERWRITE){const u=t;u.source.fromUser?o=ov(n,e,u.path,u.snap,r,s,i):(X(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!et(u.path),o=Hg(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===_s.MERGE){const u=t;u.source.fromUser?o=aj(n,e,u.path,u.children,r,s,i):(X(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=av(n,e,u.path,u.children,r,s,a,i))}else if(t.type===_s.ACK_USER_WRITE){const u=t;u.revert?o=uj(n,e,u.path,r,s,i):o=lj(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===_s.LISTEN_COMPLETE)o=cj(n,e,t.path,r,i);else throw Fc("Unknown operation type: "+t.type);const l=i.getChanges();return oj(e,o,l),{viewCache:o,changes:l}}function oj(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=qg(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(J1(qg(e)))}}function iR(n,e,t,r,s,i){const o=e.eventCache;if(Gg(r,t)!=null)return e;{let a,l;if(et(t))if(X(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Pa(e),h=u instanceof Fe?u:Fe.EMPTY_NODE,f=iw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=Wg(r,Pa(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Ze(t);if(u===".priority"){X(Co(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=_E(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=Mt(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const g=_E(r,t,o.getNode(),l);g!=null?f=o.getNode().getImmediateChild(u).updateChild(h,g):f=o.getNode().getImmediateChild(u)}else f=ow(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Ku(e,a,o.isFullyInitialized()||et(t),n.filter.filtersNodes())}}function Hg(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(et(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=Ze(t);if(!l.isCompleteForPath(t)&&Co(t)>1)return e;const _=Mt(t),N=l.getNode().getImmediateChild(y).updateChild(_,r);y===".priority"?u=h.updatePriority(l.getNode(),N):u=h.updateChild(l.getNode(),y,N,_,sR,null)}const f=X1(e,u,l.isFullyInitialized()||et(t),h.filtersNodes()),g=new aw(s,f,i);return iR(n,f,t,s,g,a)}function ov(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new aw(s,e,i);if(et(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Ku(e,u,!0,n.filter.filtersNodes());else{const f=Ze(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=Ku(e,u,a.isFullyInitialized(),a.isFiltered());else{const g=Mt(t),y=a.getNode().getImmediateChild(f);let _;if(et(g))_=r;else{const C=h.getCompleteChild(f);C!=null?Q0(g)===".priority"&&C.getChild(q1(g)).isEmpty()?_=C:_=C.updateChild(g,r):_=Fe.EMPTY_NODE}if(y.equals(_))l=e;else{const C=n.filter.updateChild(a.getNode(),f,_,g,h,o);l=Ku(e,C,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function vE(n,e){return n.eventCache.isCompleteForChild(e)}function aj(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=tn(t,l);vE(e,Ze(h))&&(a=ov(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=tn(t,l);vE(e,Ze(h))||(a=ov(n,a,h,u,s,i,o))}),a}function wE(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function av(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;et(t)?u=r:u=new jt(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,g)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),_=wE(n,y,g);l=Hg(n,l,new St(f),_,s,i,o,a)}}),u.children.inorderTraversal((f,g)=>{const y=!e.serverCache.isCompleteForChild(f)&&g.value===null;if(!h.hasChild(f)&&!y){const _=e.serverCache.getNode().getImmediateChild(f),C=wE(n,_,g);l=Hg(n,l,new St(f),C,s,i,o,a)}}),l}function lj(n,e,t,r,s,i,o){if(Gg(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(et(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Hg(n,e,t,l.getNode().getChild(t),s,i,a,o);if(et(t)){let u=new jt(null);return l.getNode().forEachChild(Gs,(h,f)=>{u=u.set(new St(h),f)}),av(n,e,t,u,s,i,a,o)}else return e}else{let u=new jt(null);return r.foreach((h,f)=>{const g=tn(t,h);l.isCompleteForPath(g)&&(u=u.set(h,l.getNode().getChild(g)))}),av(n,e,t,u,s,i,a,o)}}function cj(n,e,t,r,s){const i=e.serverCache,o=X1(e,i.getNode(),i.isFullyInitialized()||et(t),i.isFiltered());return iR(n,o,t,r,sR,s)}function uj(n,e,t,r,s,i){let o;if(Gg(r,t)!=null)return e;{const a=new aw(r,e,s),l=e.eventCache.getNode();let u;if(et(t)||Ze(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Wg(r,Pa(e));else{const f=e.serverCache.getNode();X(f instanceof Fe,"serverChildren would be complete if leaf node"),h=iw(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Ze(t);let f=ow(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,Mt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Fe.EMPTY_NODE,Mt(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Wg(r,Pa(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Gg(r,vt())!=null,Ku(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dj{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new ew(r.getIndex()),i=TF(r);this.processor_=rj(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(Fe.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Fe.EMPTY_NODE,a.getNode(),null),h=new Ro(l,o.isFullyInitialized(),s.filtersNodes()),f=new Ro(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Bp(f,h),this.eventGenerator_=new OF(this.query_)}get query(){return this.query_}}function hj(n){return n.viewCache_.serverCache.getNode()}function fj(n){return qg(n.viewCache_)}function gj(n,e){const t=Pa(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!et(e)&&!t.getImmediateChild(Ze(e)).isEmpty())?t.getChild(e):null}function IE(n){return n.eventRegistrations_.length===0}function pj(n,e){n.eventRegistrations_.push(e)}function xE(n,e,t){const r=[];if(t){X(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function SE(n,e,t,r){e.type===_s.MERGE&&e.source.queryId!==null&&(X(Pa(n.viewCache_),"We should always have a full cache before handling merges"),X(qg(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=ij(n.processor_,s,e,t,r);return sj(n.processor_,i.viewCache),X(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,oR(n,i.changes,i.viewCache.eventCache.getNode(),null)}function mj(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild($t,(i,o)=>{r.push(uc(i,o))}),t.isFullyInitialized()&&r.push(J1(t.getNode())),oR(n,r,t.getNode(),e)}function oR(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return VF(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qg;class aR{constructor(){this.views=new Map}}function yj(n){X(!Qg,"__referenceConstructor has already been defined"),Qg=n}function _j(){return X(Qg,"Reference.ts has not been loaded"),Qg}function vj(n){return n.views.size===0}function lw(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return X(i!=null,"SyncTree gave us an op for an invalid query."),SE(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(SE(o,e,t,r));return i}}function lR(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Wg(t,s?r:null),l=!1;a?l=!0:r instanceof Fe?(a=iw(t,r),l=!1):(a=Fe.EMPTY_NODE,l=!1);const u=Bp(new Ro(a,l,!1),new Ro(r,s,!1));return new dj(e,u)}return o}function wj(n,e,t,r,s,i){const o=lR(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),pj(o,t),mj(o,t)}function Ij(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=ko(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(xE(u,t,r)),IE(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(xE(l,t,r)),IE(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!ko(n)&&i.push(new(_j())(e._repo,e._path)),{removed:i,events:o}}function cR(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Io(n,e){let t=null;for(const r of n.views.values())t=t||gj(r,e);return t}function uR(n,e){if(e._queryParams.loadsAllData())return qp(n);{const r=e._queryIdentifier;return n.views.get(r)}}function dR(n,e){return uR(n,e)!=null}function ko(n){return qp(n)!=null}function qp(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kg;function xj(n){X(!Kg,"__referenceConstructor has already been defined"),Kg=n}function Sj(){return X(Kg,"Reference.ts has not been loaded"),Kg}let Ej=1;class EE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new jt(null),this.pendingWriteTree_=ZF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function cw(n,e,t,r,s){return $F(n.pendingWriteTree_,e,t,r,s),s?$c(n,new Na(nw(),e,t)):[]}function Tj(n,e,t,r){BF(n.pendingWriteTree_,e,t,r);const s=jt.fromObject(t);return $c(n,new dc(nw(),e,s))}function so(n,e,t=!1){const r=zF(n.pendingWriteTree_,e);if(qF(n.pendingWriteTree_,e)){let i=new jt(null);return r.snap!=null?i=i.set(vt(),!0):Fn(r.children,o=>{i=i.set(new St(o),!0)}),$c(n,new zg(r.path,i,t))}else return[]}function ph(n,e,t){return $c(n,new Na(rw(),e,t))}function bj(n,e,t){const r=jt.fromObject(t);return $c(n,new dc(rw(),e,r))}function Aj(n,e){return $c(n,new Od(rw(),e))}function Cj(n,e,t){const r=uw(n,t);if(r){const s=dw(r),i=s.path,o=s.queryId,a=dr(i,e),l=new Od(sw(o),a);return hw(n,i,l)}else return[]}function Yg(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||dR(o,e))){const l=Ij(o,e,t,r);vj(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(g=>g._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(g,y)=>ko(y));if(h&&!f){const g=n.syncPointTree_.subtree(i);if(!g.isEmpty()){const y=Nj(g);for(let _=0;_<y.length;++_){const C=y[_],N=C.query,T=pR(n,C);n.listenProvider_.startListening(Ju(N),Vd(n,N),T.hashFn,T.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(Ju(e),null):u.forEach(g=>{const y=n.queryToTagMap.get(Gp(g));n.listenProvider_.stopListening(Ju(g),y)}))}Pj(n,u)}return a}function hR(n,e,t,r){const s=uw(n,r);if(s!=null){const i=dw(s),o=i.path,a=i.queryId,l=dr(o,e),u=new Na(sw(a),l,t);return hw(n,o,u)}else return[]}function Rj(n,e,t,r){const s=uw(n,r);if(s){const i=dw(s),o=i.path,a=i.queryId,l=dr(o,e),u=jt.fromObject(t),h=new dc(sw(a),l,u);return hw(n,o,h)}else return[]}function lv(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(g,y)=>{const _=dr(g,s);i=i||Io(y,_),o=o||ko(y)});let a=n.syncPointTree_.get(s);a?(o=o||ko(a),i=i||Io(a,vt())):(a=new aR,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=Fe.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,_)=>{const C=Io(_,vt());C&&(i=i.updateImmediateChild(y,C))}));const u=dR(a,e);if(!u&&!e._queryParams.loadsAllData()){const g=Gp(e);X(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");const y=Dj();n.queryToTagMap.set(g,y),n.tagToQueryMap.set(y,g)}const h=zp(n.pendingWriteTree_,s);let f=wj(a,e,t,h,i,l);if(!u&&!o&&!r){const g=uR(a,e);f=f.concat(Lj(n,e,g))}return f}function Wp(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=dr(o,e),u=Io(a,l);if(u)return u});return tR(s,e,i,t,!0)}function kj(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=dr(u,t);r=r||Io(h,f)});let s=n.syncPointTree_.get(t);s?r=r||Io(s,vt()):(s=new aR,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Ro(r,!0,!1):null,a=zp(n.pendingWriteTree_,e._path),l=lR(s,e,a,i?o.getNode():Fe.EMPTY_NODE,i);return fj(l)}function $c(n,e){return fR(e,n.syncPointTree_,null,zp(n.pendingWriteTree_,vt()))}function fR(n,e,t,r){if(et(n.path))return gR(n,e,t,r);{const s=e.get(vt());t==null&&s!=null&&(t=Io(s,vt()));let i=[];const o=Ze(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=nR(r,o);i=i.concat(fR(a,l,u,h))}return s&&(i=i.concat(lw(s,n,r,t))),i}}function gR(n,e,t,r){const s=e.get(vt());t==null&&s!=null&&(t=Io(s,vt()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=nR(r,o),h=n.operationForChild(o);h&&(i=i.concat(gR(h,a,l,u)))}),s&&(i=i.concat(lw(s,n,r,t))),i}function pR(n,e){const t=e.query,r=Vd(n,t);return{hashFn:()=>(hj(e)||Fe.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?Cj(n,t._path,r):Aj(n,t._path);{const i=TV(s,t);return Yg(n,t,null,i)}}}}function Vd(n,e){const t=Gp(e);return n.queryToTagMap.get(t)}function Gp(n){return n._path.toString()+"$"+n._queryIdentifier}function uw(n,e){return n.tagToQueryMap.get(e)}function dw(n){const e=n.indexOf("$");return X(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new St(n.substr(0,e))}}function hw(n,e,t){const r=n.syncPointTree_.get(e);X(r,"Missing sync point for query tag that we're tracking");const s=zp(n.pendingWriteTree_,e);return lw(r,t,s,null)}function Nj(n){return n.fold((e,t,r)=>{if(t&&ko(t))return[qp(t)];{let s=[];return t&&(s=cR(t)),Fn(r,(i,o)=>{s=s.concat(o)}),s}})}function Ju(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Sj())(n._repo,n._path):n}function Pj(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=Gp(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function Dj(){return Ej++}function Lj(n,e,t){const r=e._path,s=Vd(n,e),i=pR(n,t),o=n.listenProvider_.startListening(Ju(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)X(!ko(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!et(u)&&h&&ko(h))return[qp(h).query];{let g=[];return h&&(g=g.concat(cR(h).map(y=>y.query))),Fn(f,(y,_)=>{g=g.concat(_)}),g}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(Ju(h),Vd(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new fw(t)}node(){return this.node_}}class gw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=tn(this.path_,e);return new gw(this.syncTree_,t)}node(){return Wp(this.syncTree_,this.path_)}}const Mj=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},TE=function(n,e,t){if(!n||typeof n!="object")return n;if(X(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Oj(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Vj(n[".sv"],e);X(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Oj=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:X(!1,"Unexpected server value: "+n)}},Vj=function(n,e,t){n.hasOwnProperty("increment")||X(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&X(!1,"Unexpected increment value: "+r);const s=e.node();if(X(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},mR=function(n,e,t,r){return mw(e,new gw(t,n),r)},pw=function(n,e,t){return mw(n,new fw(e),t)};function mw(n,e,t){const r=n.getPriority().val(),s=TE(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=TE(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new kn(a,an(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new kn(s))),o.forEachChild($t,(a,l)=>{const u=mw(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Hp(n,e){let t=e instanceof St?e:new St(e),r=n,s=Ze(t);for(;s!==null;){const i=Ra(r.node.children,s)||{children:{},childCount:0};r=new yw(s,r,i),t=Mt(t),s=Ze(t)}return r}function Za(n){return n.node.value}function _w(n,e){n.node.value=e,cv(n)}function yR(n){return n.node.childCount>0}function Fj(n){return Za(n)===void 0&&!yR(n)}function Qp(n,e){Fn(n.node.children,(t,r)=>{e(new yw(t,n,r))})}function _R(n,e,t,r){t&&!r&&e(n),Qp(n,s=>{_R(s,e,!0,r)}),t&&r&&e(n)}function jj(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function mh(n){return new St(n.parent===null?n.name:mh(n.parent)+"/"+n.name)}function cv(n){n.parent!==null&&Uj(n.parent,n.name,n)}function Uj(n,e,t){const r=Fj(t),s=As(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,cv(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,cv(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j=/[\[\].#$\/\u0000-\u001F\u007F]/,Bj=/[\[\].#$\u0000-\u001F\u007F]/,ky=10*1024*1024,Kp=function(n){return typeof n=="string"&&n.length!==0&&!$j.test(n)},vR=function(n){return typeof n=="string"&&n.length!==0&&!Bj.test(n)},zj=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),vR(n)},Fd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!jp(n)||n&&typeof n=="object"&&As(n,".sv")},Xs=function(n,e,t,r){r&&e===void 0||yh(ka(n,"value"),e,t)},yh=function(n,e,t){const r=t instanceof St?new iF(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ra(r));if(typeof e=="function")throw new Error(n+"contains a function "+ra(r)+" with contents = "+e.toString());if(jp(e))throw new Error(n+"contains "+e.toString()+" "+ra(r));if(typeof e=="string"&&e.length>ky/3&&Fp(e)>ky)throw new Error(n+"contains a string greater than "+ky+" utf8 bytes "+ra(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Fn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Kp(o)))throw new Error(n+" contains an invalid key ("+o+") "+ra(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);oF(r,o),yh(n,a,r),aF(r)}),s&&i)throw new Error(n+' contains ".value" child '+ra(r)+" in addition to actual children.")}},qj=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Pd(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Kp(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(sF);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&ns(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},wR=function(n,e,t,r){if(r&&e===void 0)return;const s=ka(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Fn(e,(o,a)=>{const l=new St(o);if(yh(s,a,tn(t,l)),Q0(l)===".priority"&&!Fd(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),qj(s,i)},vw=function(n,e,t){if(!(t&&e===void 0)){if(jp(e))throw new Error(ka(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Fd(e))throw new Error(ka(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},_h=function(n,e,t,r){if(!(r&&t===void 0)&&!Kp(t))throw new Error(ka(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},ww=function(n,e,t,r){if(!(r&&t===void 0)&&!vR(t))throw new Error(ka(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Wj=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),ww(n,e,t,r)},Us=function(n,e){if(Ze(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},IR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Kp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!zj(t))throw new Error(ka(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Yp(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!K0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function xR(n,e,t){Yp(n,t),SR(n,r=>K0(r,e))}function Wr(n,e,t){Yp(n,t),SR(n,r=>ns(r,e)||ns(e,r))}function SR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(Hj(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Hj(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();va&&Ln("event: "+t.toString()),jc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ER="repo_interrupt",Qj=25;class Kj{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Gj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Bg(),this.transactionQueueTree_=new yw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Yj(n,e,t){if(n.stats_=G0(n.repoInfo_),n.forceRestClient_||RV())n.server_=new $g(n.repoInfo_,(r,s,i,o)=>{bE(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>AE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{bn(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new ss(n.repoInfo_,e,(r,s,i,o)=>{bE(n,r,s,i,o)},r=>{AE(n,r)},r=>{Jj(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=LV(n.repoInfo_,()=>new MF(n.stats_,n.server_)),n.infoData_=new kF,n.infoSyncTree_=new EE({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=ph(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Iw(n,"connected",!1),n.serverSyncTree_=new EE({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);Wr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function TR(n){const t=n.infoData_.getNode(new St(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function vh(n){return Mj({timestamp:TR(n)})}function bE(n,e,t,r,s){n.dataUpdateCount++;const i=new St(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=Og(t,u=>an(u));o=Rj(n.serverSyncTree_,i,l,s)}else{const l=an(t);o=hR(n.serverSyncTree_,i,l,s)}else if(r){const l=Og(t,u=>an(u));o=bj(n.serverSyncTree_,i,l)}else{const l=an(t);o=ph(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=fc(n,i)),Wr(n.eventQueue_,a,o)}function AE(n,e){Iw(n,"connected",e),e===!1&&e4(n)}function Jj(n,e){Fn(e,(t,r)=>{Iw(n,t,r)})}function Iw(n,e,t){const r=new St("/.info/"+e),s=an(t);n.infoData_.updateSnapshot(r,s);const i=ph(n.infoSyncTree_,r,s);Wr(n.eventQueue_,r,i)}function Jp(n){return n.nextWriteId_++}function Xj(n,e,t){const r=kj(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=an(s).withIndex(e._queryParams.getIndex());lv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ph(n.serverSyncTree_,e._path,i);else{const a=Vd(n.serverSyncTree_,e);o=hR(n.serverSyncTree_,e._path,i,a)}return Wr(n.eventQueue_,e._path,o),Yg(n.serverSyncTree_,e,t,null,!0),i},s=>(Bc(n,"get for query "+bn(e)+" failed: "+s),Promise.reject(new Error(s))))}function xw(n,e,t,r,s){Bc(n,"set",{path:e.toString(),value:t,priority:r});const i=vh(n),o=an(t,r),a=Wp(n.serverSyncTree_,e),l=pw(o,a,i),u=Jp(n),h=cw(n.serverSyncTree_,e,l,u,!0);Yp(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(g,y)=>{const _=g==="ok";_||ir("set at "+e+" failed: "+g);const C=so(n.serverSyncTree_,u,!_);Wr(n.eventQueue_,e,C),No(n,s,g,y)});const f=Ew(n,e);fc(n,f),Wr(n.eventQueue_,f,[])}function Zj(n,e,t,r){Bc(n,"update",{path:e.toString(),value:t});let s=!0;const i=vh(n),o={};if(Fn(t,(a,l)=>{s=!1,o[a]=mR(tn(e,a),an(l),n.serverSyncTree_,i)}),s)Ln("update() called with empty data.  Don't do anything."),No(n,r,"ok",void 0);else{const a=Jp(n),l=Tj(n.serverSyncTree_,e,o,a);Yp(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||ir("update at "+e+" failed: "+u);const g=so(n.serverSyncTree_,a,!f),y=g.length>0?fc(n,e):e;Wr(n.eventQueue_,y,g),No(n,r,u,h)}),Fn(t,u=>{const h=Ew(n,tn(e,u));fc(n,h)}),Wr(n.eventQueue_,e,[])}}function e4(n){Bc(n,"onDisconnectEvents");const e=vh(n),t=Bg();nv(n.onDisconnect_,vt(),(s,i)=>{const o=mR(s,i,n.serverSyncTree_,e);Uc(t,s,o)});let r=[];nv(t,vt(),(s,i)=>{r=r.concat(ph(n.serverSyncTree_,s,i));const o=Ew(n,s);fc(n,o)}),n.onDisconnect_=Bg(),Wr(n.eventQueue_,vt(),r)}function t4(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&tv(n.onDisconnect_,e),No(n,t,r,s)})}function CE(n,e,t,r){const s=an(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Uc(n.onDisconnect_,e,s),No(n,r,i,o)})}function n4(n,e,t,r,s){const i=an(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Uc(n.onDisconnect_,e,i),No(n,s,o,a)})}function r4(n,e,t,r){if(Mg(t)){Ln("onDisconnect().update() called with empty data.  Don't do anything."),No(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Fn(t,(o,a)=>{const l=an(a);Uc(n.onDisconnect_,tn(e,o),l)}),No(n,r,s,i)})}function s4(n,e,t){let r;Ze(e._path)===".info"?r=lv(n.infoSyncTree_,e,t):r=lv(n.serverSyncTree_,e,t),xR(n.eventQueue_,e._path,r)}function uv(n,e,t){let r;Ze(e._path)===".info"?r=Yg(n.infoSyncTree_,e,t):r=Yg(n.serverSyncTree_,e,t),xR(n.eventQueue_,e._path,r)}function bR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(ER)}function i4(n){n.persistentConnection_&&n.persistentConnection_.resume(ER)}function Bc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ln(t,...e)}function No(n,e,t,r){e&&jc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function o4(n,e,t,r,s,i){Bc(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:I1(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Sw(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{yh("transaction failed: Data returned ",l,o.path),o.status=0;const u=Hp(n.transactionQueueTree_,e),h=Za(u)||[];h.push(o),_w(u,h);let f;typeof l=="object"&&l!==null&&As(l,".priority")?(f=Ra(l,".priority"),X(Fd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Wp(n.serverSyncTree_,e)||Fe.EMPTY_NODE).getPriority().val();const g=vh(n),y=an(l,f),_=pw(y,a,g);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=_,o.currentWriteId=Jp(n);const C=cw(n.serverSyncTree_,e,_,o.currentWriteId,o.applyLocally);Wr(n.eventQueue_,e,C),Xp(n,n.transactionQueueTree_)}}function Sw(n,e,t){return Wp(n.serverSyncTree_,e,t)||Fe.EMPTY_NODE}function Xp(n,e=n.transactionQueueTree_){if(e||Zp(n,e),Za(e)){const t=CR(n,e);X(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&a4(n,mh(e),t)}else yR(e)&&Qp(e,t=>{Xp(n,t)})}function a4(n,e,t){const r=t.map(u=>u.currentWriteId),s=Sw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];X(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=dr(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Bc(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let g=0;g<t.length;g++)t[g].status=2,h=h.concat(so(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&f.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Zp(n,Hp(n.transactionQueueTree_,e)),Xp(n,n.transactionQueueTree_),Wr(n.eventQueue_,e,h);for(let g=0;g<f.length;g++)jc(f[g])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{ir("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}fc(n,e)}},o)}function fc(n,e){const t=AR(n,e),r=mh(t),s=CR(n,t);return l4(n,s,r),r}function l4(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=dr(t,l.path);let h=!1,f;if(X(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(so(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Qj)h=!0,f="maxretry",s=s.concat(so(n.serverSyncTree_,l.currentWriteId,!0));else{const g=Sw(n,l.path,o);l.currentInputSnapshot=g;const y=e[a].update(g.val());if(y!==void 0){yh("transaction failed: Data returned ",y,l.path);let _=an(y);typeof y=="object"&&y!=null&&As(y,".priority")||(_=_.updatePriority(g.getPriority()));const N=l.currentWriteId,T=vh(n),x=pw(_,g,T);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=x,l.currentWriteId=Jp(n),o.splice(o.indexOf(N),1),s=s.concat(cw(n.serverSyncTree_,l.path,x,l.currentWriteId,l.applyLocally)),s=s.concat(so(n.serverSyncTree_,N,!0))}else h=!0,f="nodata",s=s.concat(so(n.serverSyncTree_,l.currentWriteId,!0))}Wr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Zp(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)jc(r[a]);Xp(n,n.transactionQueueTree_)}function AR(n,e){let t,r=n.transactionQueueTree_;for(t=Ze(e);t!==null&&Za(r)===void 0;)r=Hp(r,t),e=Mt(e),t=Ze(e);return r}function CR(n,e){const t=[];return RR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function RR(n,e,t){const r=Za(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);Qp(e,s=>{RR(n,s,t)})}function Zp(n,e){const t=Za(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,_w(e,t.length>0?t:void 0)}Qp(e,r=>{Zp(n,r)})}function Ew(n,e){const t=mh(AR(n,e)),r=Hp(n.transactionQueueTree_,e);return jj(r,s=>{Ny(n,s)}),Ny(n,r),_R(r,s=>{Ny(n,s)}),t}function Ny(n,e){const t=Za(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(X(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(X(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(so(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?_w(e,void 0):t.length=i+1,Wr(n.eventQueue_,mh(e),s);for(let o=0;o<r.length;o++)jc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c4(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function u4(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ir(`Invalid query segment '${t}' in query '${n}'`)}return e}const dv=function(n,e){const t=d4(n),r=t.namespace;t.domain==="firebase.com"&&Js(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Js("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||wV();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new M1(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new St(t.pathString)}},d4=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=c4(n.substring(h,f)));const g=u4(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const _=e.indexOf(".");r=e.substring(0,_).toLowerCase(),t=e.substring(_+1),i=r}"ns"in g&&(i=g.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",h4=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=RE.charAt(t%64),t=Math.floor(t/64);X(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=RE.charAt(e[s]);return X(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+bn(this.snapshot.exportVal())}}class NR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return X(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Or;return t4(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Us("OnDisconnect.remove",this._path);const e=new Or;return CE(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Us("OnDisconnect.set",this._path),Xs("OnDisconnect.set",e,this._path,!1);const t=new Or;return CE(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Us("OnDisconnect.setWithPriority",this._path),Xs("OnDisconnect.setWithPriority",e,this._path,!1),vw("OnDisconnect.setWithPriority",t,!1);const r=new Or;return n4(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Us("OnDisconnect.update",this._path),wR("OnDisconnect.update",e,this._path,!1);const t=new Or;return r4(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return et(this._path)?null:Q0(this._path)}get ref(){return new Cs(this._repo,this._path)}get _queryIdentifier(){const e=gE(this._queryParams),t=q0(e);return t==="{}"?"default":t}get _queryObject(){return gE(this._queryParams)}isEqual(e){if(e=le(e),!(e instanceof Kr))return!1;const t=this._repo===e._repo,r=K0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+rF(this._path)}}function em(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Bo(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Gs){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Ao)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Ei)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===$t){if(e!=null&&!Fd(e)||t!=null&&!Fd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(X(n.getIndex()instanceof X0||n.getIndex()===Z0,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function tm(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Cs extends Kr{constructor(e,t){super(e,t,new tw,!1)}get parent(){const e=q1(this._path);return e===null?null:new Cs(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Da{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new St(e),r=gc(this.ref,e);return new Da(this._node.getChild(t),r,$t)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Da(s,gc(this.ref,r),$t)))}hasChild(e){const t=new St(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function he(n,e){return n=le(n),n._checkNotDeleted("ref"),e!==void 0?gc(n._root,e):n._root}function Dq(n,e){n=le(n),n._checkNotDeleted("refFromURL");const t=dv(e,n._repo.repoInfo_.nodeAdmin);IR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Js("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),he(n,t.path.toString())}function gc(n,e){return n=le(n),Ze(n._path)===null?Wj("child","path",e,!1):ww("child","path",e,!1),new Cs(n._repo,tn(n._path,e))}function Lq(n){return n=le(n),new f4(n._repo,n._path)}function g4(n,e){n=le(n),Us("push",n._path),Xs("push",e,n._path,!0);const t=TR(n._repo),r=h4(t),s=gc(n,r),i=gc(n,r);let o;return e!=null?o=Xe(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Mq(n){return Us("remove",n._path),Xe(n,null)}function Xe(n,e){n=le(n),Us("set",n._path),Xs("set",e,n._path,!1);const t=new Or;return xw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Oq(n,e){n=le(n),Us("setPriority",n._path),vw("setPriority",e,!1);const t=new Or;return xw(n._repo,tn(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Vq(n,e,t){if(Us("setWithPriority",n._path),Xs("setWithPriority",e,n._path,!1),vw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Or;return xw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function Fq(n,e){wR("update",e,n._path,!1);const t=new Or;return Zj(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Be(n){n=le(n);const e=new Tw(()=>{}),t=new wh(e);return Xj(n._repo,n,t).then(r=>new Da(r,new Cs(n._repo,n._path),n._queryParams.getIndex()))}class wh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new kR("value",this,new Da(e.snapshotNode,new Cs(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new NR(this,e,t):null}matches(e){return e instanceof wh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class nm{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new NR(this,e,t):null}createEvent(e,t){X(e.childName!=null,"Child events should have a childName.");const r=gc(new Cs(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new kR(e.type,this,new Da(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof nm?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Ih(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{uv(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new Tw(t,i||void 0),a=e==="value"?new wh(o):new nm(e,o);return s4(n._repo,n,a),()=>uv(n._repo,n,a)}function PR(n,e,t,r){return Ih(n,"value",e,t,r)}function jq(n,e,t,r){return Ih(n,"child_added",e,t,r)}function Uq(n,e,t,r){return Ih(n,"child_changed",e,t,r)}function $q(n,e,t,r){return Ih(n,"child_moved",e,t,r)}function Bq(n,e,t,r){return Ih(n,"child_removed",e,t,r)}function zq(n,e,t){let r=null;const s=t?new Tw(t):null;e==="value"?r=new wh(s):e&&(r=new nm(e,s)),uv(n._repo,n,r)}let Rs=class{},DR=class extends Rs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Xs("endAt",this._value,e._path,!0);const t=ev(e._queryParams,this._value,this._key);if(tm(t),Bo(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}};function Gq(n,e){return _h("endAt","key",e,!0),new DR(n,e)}class p4 extends Rs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Xs("endBefore",this._value,e._path,!1);const t=RF(e._queryParams,this._value,this._key);if(tm(t),Bo(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}}function Hq(n,e){return _h("endBefore","key",e,!0),new p4(n,e)}let LR=class extends Rs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Xs("startAt",this._value,e._path,!0);const t=Z_(e._queryParams,this._value,this._key);if(tm(t),Bo(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}};function Kq(n=null,e){return _h("startAt","key",e,!0),new LR(n,e)}class m4 extends Rs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Xs("startAfter",this._value,e._path,!1);const t=CF(e._queryParams,this._value,this._key);if(tm(t),Bo(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}}function Yq(n,e){return _h("startAfter","key",e,!0),new m4(n,e)}class y4 extends Rs{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Kr(e._repo,e._path,bF(e._queryParams,this._limit),e._orderByCalled)}}function Jq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new y4(n)}class _4 extends Rs{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Kr(e._repo,e._path,AF(e._queryParams,this._limit),e._orderByCalled)}}function Xq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new _4(n)}class v4 extends Rs{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){em(e,"orderByChild");const t=new St(this._path);if(et(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new X0(t),s=$p(e._queryParams,r);return Bo(s),new Kr(e._repo,e._path,s,!0)}}function Zq(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ww("orderByChild","path",n,!1),new v4(n)}class w4 extends Rs{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){em(e,"orderByKey");const t=$p(e._queryParams,Gs);return Bo(t),new Kr(e._repo,e._path,t,!0)}}function e8(){return new w4}class I4 extends Rs{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){em(e,"orderByPriority");const t=$p(e._queryParams,$t);return Bo(t),new Kr(e._repo,e._path,t,!0)}}function t8(){return new I4}class x4 extends Rs{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){em(e,"orderByValue");const t=$p(e._queryParams,Z0);return Bo(t),new Kr(e._repo,e._path,t,!0)}}function n8(){return new x4}class S4 extends Rs{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Xs("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new DR(this._value,this._key)._apply(new LR(this._value,this._key)._apply(e))}}function r8(n,e){return _h("equalTo","key",e,!0),new S4(n,e)}function s8(n,...e){let t=le(n);for(const r of e)t=r._apply(t);return t}yj(Cs);xj(Cs);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4="FIREBASE_DATABASE_EMULATOR_HOST",hv={};let MR=!1;function T4(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Ni(i);n.repoInfo_=new M1(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function OR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Js("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ln("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=dv(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[E4]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=dv(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new Ql(Ql.OWNER):new NV(n.name,n.options,e);IR("Invalid Firebase Database URL",o),et(o.path)||Js("Database URL must point to the root of a Firebase Database (not including a child path).");const f=A4(a,n,h,new kV(n,t));return new R4(f,n)}function b4(n,e){const t=hv[e];(!t||t[n.key]!==n)&&Js(`Database ${e}(${n.repoInfo_}) has already been deleted.`),bR(n),delete t[n.key]}function A4(n,e,t,r){let s=hv[e.name];s||(s={},hv[e.name]=s);let i=s[n.toURLString()];return i&&Js("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Kj(n,MR,t,r),s[n.toURLString()]=i,i}function C4(n){MR=n}class R4{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Yj(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Cs(this._repo,vt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(b4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Js("Cannot call "+e+" on a deleted database.")}}function VR(){cc.IS_TRANSPORT_INITIALIZED&&ir("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function i8(){VR(),ro.forceDisallow()}function o8(){VR(),es.forceDisallow(),ro.forceAllow()}function k4(n=dh(),e){const t=ei(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=e1("database");r&&N4(t,...r)}return t}function N4(n,e,t,r={}){n=le(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&qr(r,i.repoInfo_.emulatorOptions))return;Js("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Js('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ql(Ql.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:r1(r.mockUserToken,n.app.options.projectId);o=new Ql(a)}Ni(e)&&(Op(e),j0("Database",!0)),T4(i,s,r,o)}function a8(n){n=le(n),n._checkNotDeleted("goOffline"),bR(n._repo)}function l8(n){n=le(n),n._checkNotDeleted("goOnline"),i4(n._repo)}function c8(n,e){S1(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P4(n){v1(Ya),Ts(new Cr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return OR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),br(JS,XS,n),br(JS,XS,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4={".sv":"timestamp"};function u8(){return D4}function d8(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L4{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function h8(n,e,t){if(n=le(n),Us("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new Or,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new Da(u,new Cs(n._repo,n._path),$t),s.resolve(new L4(l,h)))},o=PR(n,()=>{});return o4(n._repo,n._path,e,i,o,r),s.promise}ss.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};ss.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const f8=function(n){const e=ss.prototype.put;return ss.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){ss.prototype.put=e}},g8=function(n){C4(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p8({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){v1(t);const o=new d1("database-standalone"),a=new q_("auth-internal",o);let l;return s&&(l=new q_("app-check-internal",o),l.setComponent(new Cr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Cr("auth-internal",()=>r,"PRIVATE")),OR(n,a,l,e,i)}P4();var kE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xo,FR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(R,S){function I(){}I.prototype=S.prototype,R.D=S.prototype,R.prototype=new I,R.prototype.constructor=R,R.C=function(A,w,b){for(var v=Array(arguments.length-2),te=2;te<arguments.length;te++)v[te-2]=arguments[te];return S.prototype[w].apply(A,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(R,S,I){I||(I=0);var A=Array(16);if(typeof S=="string")for(var w=0;16>w;++w)A[w]=S.charCodeAt(I++)|S.charCodeAt(I++)<<8|S.charCodeAt(I++)<<16|S.charCodeAt(I++)<<24;else for(w=0;16>w;++w)A[w]=S[I++]|S[I++]<<8|S[I++]<<16|S[I++]<<24;S=R.g[0],I=R.g[1],w=R.g[2];var b=R.g[3],v=S+(b^I&(w^b))+A[0]+3614090360&4294967295;S=I+(v<<7&4294967295|v>>>25),v=b+(w^S&(I^w))+A[1]+3905402710&4294967295,b=S+(v<<12&4294967295|v>>>20),v=w+(I^b&(S^I))+A[2]+606105819&4294967295,w=b+(v<<17&4294967295|v>>>15),v=I+(S^w&(b^S))+A[3]+3250441966&4294967295,I=w+(v<<22&4294967295|v>>>10),v=S+(b^I&(w^b))+A[4]+4118548399&4294967295,S=I+(v<<7&4294967295|v>>>25),v=b+(w^S&(I^w))+A[5]+1200080426&4294967295,b=S+(v<<12&4294967295|v>>>20),v=w+(I^b&(S^I))+A[6]+2821735955&4294967295,w=b+(v<<17&4294967295|v>>>15),v=I+(S^w&(b^S))+A[7]+4249261313&4294967295,I=w+(v<<22&4294967295|v>>>10),v=S+(b^I&(w^b))+A[8]+1770035416&4294967295,S=I+(v<<7&4294967295|v>>>25),v=b+(w^S&(I^w))+A[9]+2336552879&4294967295,b=S+(v<<12&4294967295|v>>>20),v=w+(I^b&(S^I))+A[10]+4294925233&4294967295,w=b+(v<<17&4294967295|v>>>15),v=I+(S^w&(b^S))+A[11]+2304563134&4294967295,I=w+(v<<22&4294967295|v>>>10),v=S+(b^I&(w^b))+A[12]+1804603682&4294967295,S=I+(v<<7&4294967295|v>>>25),v=b+(w^S&(I^w))+A[13]+4254626195&4294967295,b=S+(v<<12&4294967295|v>>>20),v=w+(I^b&(S^I))+A[14]+2792965006&4294967295,w=b+(v<<17&4294967295|v>>>15),v=I+(S^w&(b^S))+A[15]+1236535329&4294967295,I=w+(v<<22&4294967295|v>>>10),v=S+(w^b&(I^w))+A[1]+4129170786&4294967295,S=I+(v<<5&4294967295|v>>>27),v=b+(I^w&(S^I))+A[6]+3225465664&4294967295,b=S+(v<<9&4294967295|v>>>23),v=w+(S^I&(b^S))+A[11]+643717713&4294967295,w=b+(v<<14&4294967295|v>>>18),v=I+(b^S&(w^b))+A[0]+3921069994&4294967295,I=w+(v<<20&4294967295|v>>>12),v=S+(w^b&(I^w))+A[5]+3593408605&4294967295,S=I+(v<<5&4294967295|v>>>27),v=b+(I^w&(S^I))+A[10]+38016083&4294967295,b=S+(v<<9&4294967295|v>>>23),v=w+(S^I&(b^S))+A[15]+3634488961&4294967295,w=b+(v<<14&4294967295|v>>>18),v=I+(b^S&(w^b))+A[4]+3889429448&4294967295,I=w+(v<<20&4294967295|v>>>12),v=S+(w^b&(I^w))+A[9]+568446438&4294967295,S=I+(v<<5&4294967295|v>>>27),v=b+(I^w&(S^I))+A[14]+3275163606&4294967295,b=S+(v<<9&4294967295|v>>>23),v=w+(S^I&(b^S))+A[3]+4107603335&4294967295,w=b+(v<<14&4294967295|v>>>18),v=I+(b^S&(w^b))+A[8]+1163531501&4294967295,I=w+(v<<20&4294967295|v>>>12),v=S+(w^b&(I^w))+A[13]+2850285829&4294967295,S=I+(v<<5&4294967295|v>>>27),v=b+(I^w&(S^I))+A[2]+4243563512&4294967295,b=S+(v<<9&4294967295|v>>>23),v=w+(S^I&(b^S))+A[7]+1735328473&4294967295,w=b+(v<<14&4294967295|v>>>18),v=I+(b^S&(w^b))+A[12]+2368359562&4294967295,I=w+(v<<20&4294967295|v>>>12),v=S+(I^w^b)+A[5]+4294588738&4294967295,S=I+(v<<4&4294967295|v>>>28),v=b+(S^I^w)+A[8]+2272392833&4294967295,b=S+(v<<11&4294967295|v>>>21),v=w+(b^S^I)+A[11]+1839030562&4294967295,w=b+(v<<16&4294967295|v>>>16),v=I+(w^b^S)+A[14]+4259657740&4294967295,I=w+(v<<23&4294967295|v>>>9),v=S+(I^w^b)+A[1]+2763975236&4294967295,S=I+(v<<4&4294967295|v>>>28),v=b+(S^I^w)+A[4]+1272893353&4294967295,b=S+(v<<11&4294967295|v>>>21),v=w+(b^S^I)+A[7]+4139469664&4294967295,w=b+(v<<16&4294967295|v>>>16),v=I+(w^b^S)+A[10]+3200236656&4294967295,I=w+(v<<23&4294967295|v>>>9),v=S+(I^w^b)+A[13]+681279174&4294967295,S=I+(v<<4&4294967295|v>>>28),v=b+(S^I^w)+A[0]+3936430074&4294967295,b=S+(v<<11&4294967295|v>>>21),v=w+(b^S^I)+A[3]+3572445317&4294967295,w=b+(v<<16&4294967295|v>>>16),v=I+(w^b^S)+A[6]+76029189&4294967295,I=w+(v<<23&4294967295|v>>>9),v=S+(I^w^b)+A[9]+3654602809&4294967295,S=I+(v<<4&4294967295|v>>>28),v=b+(S^I^w)+A[12]+3873151461&4294967295,b=S+(v<<11&4294967295|v>>>21),v=w+(b^S^I)+A[15]+530742520&4294967295,w=b+(v<<16&4294967295|v>>>16),v=I+(w^b^S)+A[2]+3299628645&4294967295,I=w+(v<<23&4294967295|v>>>9),v=S+(w^(I|~b))+A[0]+4096336452&4294967295,S=I+(v<<6&4294967295|v>>>26),v=b+(I^(S|~w))+A[7]+1126891415&4294967295,b=S+(v<<10&4294967295|v>>>22),v=w+(S^(b|~I))+A[14]+2878612391&4294967295,w=b+(v<<15&4294967295|v>>>17),v=I+(b^(w|~S))+A[5]+4237533241&4294967295,I=w+(v<<21&4294967295|v>>>11),v=S+(w^(I|~b))+A[12]+1700485571&4294967295,S=I+(v<<6&4294967295|v>>>26),v=b+(I^(S|~w))+A[3]+2399980690&4294967295,b=S+(v<<10&4294967295|v>>>22),v=w+(S^(b|~I))+A[10]+4293915773&4294967295,w=b+(v<<15&4294967295|v>>>17),v=I+(b^(w|~S))+A[1]+2240044497&4294967295,I=w+(v<<21&4294967295|v>>>11),v=S+(w^(I|~b))+A[8]+1873313359&4294967295,S=I+(v<<6&4294967295|v>>>26),v=b+(I^(S|~w))+A[15]+4264355552&4294967295,b=S+(v<<10&4294967295|v>>>22),v=w+(S^(b|~I))+A[6]+2734768916&4294967295,w=b+(v<<15&4294967295|v>>>17),v=I+(b^(w|~S))+A[13]+1309151649&4294967295,I=w+(v<<21&4294967295|v>>>11),v=S+(w^(I|~b))+A[4]+4149444226&4294967295,S=I+(v<<6&4294967295|v>>>26),v=b+(I^(S|~w))+A[11]+3174756917&4294967295,b=S+(v<<10&4294967295|v>>>22),v=w+(S^(b|~I))+A[2]+718787259&4294967295,w=b+(v<<15&4294967295|v>>>17),v=I+(b^(w|~S))+A[9]+3951481745&4294967295,R.g[0]=R.g[0]+S&4294967295,R.g[1]=R.g[1]+(w+(v<<21&4294967295|v>>>11))&4294967295,R.g[2]=R.g[2]+w&4294967295,R.g[3]=R.g[3]+b&4294967295}r.prototype.u=function(R,S){S===void 0&&(S=R.length);for(var I=S-this.blockSize,A=this.B,w=this.h,b=0;b<S;){if(w==0)for(;b<=I;)s(this,R,b),b+=this.blockSize;if(typeof R=="string"){for(;b<S;)if(A[w++]=R.charCodeAt(b++),w==this.blockSize){s(this,A),w=0;break}}else for(;b<S;)if(A[w++]=R[b++],w==this.blockSize){s(this,A),w=0;break}}this.h=w,this.o+=S},r.prototype.v=function(){var R=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);R[0]=128;for(var S=1;S<R.length-8;++S)R[S]=0;var I=8*this.o;for(S=R.length-8;S<R.length;++S)R[S]=I&255,I/=256;for(this.u(R),R=Array(16),S=I=0;4>S;++S)for(var A=0;32>A;A+=8)R[I++]=this.g[S]>>>A&255;return R};function i(R,S){var I=a;return Object.prototype.hasOwnProperty.call(I,R)?I[R]:I[R]=S(R)}function o(R,S){this.h=S;for(var I=[],A=!0,w=R.length-1;0<=w;w--){var b=R[w]|0;A&&b==S||(I[w]=b,A=!1)}this.g=I}var a={};function l(R){return-128<=R&&128>R?i(R,function(S){return new o([S|0],0>S?-1:0)}):new o([R|0],0>R?-1:0)}function u(R){if(isNaN(R)||!isFinite(R))return f;if(0>R)return N(u(-R));for(var S=[],I=1,A=0;R>=I;A++)S[A]=R/I|0,I*=4294967296;return new o(S,0)}function h(R,S){if(R.length==0)throw Error("number format error: empty string");if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(R.charAt(0)=="-")return N(h(R.substring(1),S));if(0<=R.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=u(Math.pow(S,8)),A=f,w=0;w<R.length;w+=8){var b=Math.min(8,R.length-w),v=parseInt(R.substring(w,w+b),S);8>b?(b=u(Math.pow(S,b)),A=A.j(b).add(u(v))):(A=A.j(I),A=A.add(u(v)))}return A}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(C(this))return-N(this).m();for(var R=0,S=1,I=0;I<this.g.length;I++){var A=this.i(I);R+=(0<=A?A:4294967296+A)*S,S*=4294967296}return R},n.toString=function(R){if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(_(this))return"0";if(C(this))return"-"+N(this).toString(R);for(var S=u(Math.pow(R,6)),I=this,A="";;){var w=P(I,S).g;I=T(I,w.j(S));var b=((0<I.g.length?I.g[0]:I.h)>>>0).toString(R);if(I=w,_(I))return b+A;for(;6>b.length;)b="0"+b;A=b+A}},n.i=function(R){return 0>R?0:R<this.g.length?this.g[R]:this.h};function _(R){if(R.h!=0)return!1;for(var S=0;S<R.g.length;S++)if(R.g[S]!=0)return!1;return!0}function C(R){return R.h==-1}n.l=function(R){return R=T(this,R),C(R)?-1:_(R)?0:1};function N(R){for(var S=R.g.length,I=[],A=0;A<S;A++)I[A]=~R.g[A];return new o(I,~R.h).add(g)}n.abs=function(){return C(this)?N(this):this},n.add=function(R){for(var S=Math.max(this.g.length,R.g.length),I=[],A=0,w=0;w<=S;w++){var b=A+(this.i(w)&65535)+(R.i(w)&65535),v=(b>>>16)+(this.i(w)>>>16)+(R.i(w)>>>16);A=v>>>16,b&=65535,v&=65535,I[w]=v<<16|b}return new o(I,I[I.length-1]&-2147483648?-1:0)};function T(R,S){return R.add(N(S))}n.j=function(R){if(_(this)||_(R))return f;if(C(this))return C(R)?N(this).j(N(R)):N(N(this).j(R));if(C(R))return N(this.j(N(R)));if(0>this.l(y)&&0>R.l(y))return u(this.m()*R.m());for(var S=this.g.length+R.g.length,I=[],A=0;A<2*S;A++)I[A]=0;for(A=0;A<this.g.length;A++)for(var w=0;w<R.g.length;w++){var b=this.i(A)>>>16,v=this.i(A)&65535,te=R.i(w)>>>16,Ee=R.i(w)&65535;I[2*A+2*w]+=v*Ee,x(I,2*A+2*w),I[2*A+2*w+1]+=b*Ee,x(I,2*A+2*w+1),I[2*A+2*w+1]+=v*te,x(I,2*A+2*w+1),I[2*A+2*w+2]+=b*te,x(I,2*A+2*w+2)}for(A=0;A<S;A++)I[A]=I[2*A+1]<<16|I[2*A];for(A=S;A<2*S;A++)I[A]=0;return new o(I,0)};function x(R,S){for(;(R[S]&65535)!=R[S];)R[S+1]+=R[S]>>>16,R[S]&=65535,S++}function k(R,S){this.g=R,this.h=S}function P(R,S){if(_(S))throw Error("division by zero");if(_(R))return new k(f,f);if(C(R))return S=P(N(R),S),new k(N(S.g),N(S.h));if(C(S))return S=P(R,N(S)),new k(N(S.g),S.h);if(30<R.g.length){if(C(R)||C(S))throw Error("slowDivide_ only works with positive integers.");for(var I=g,A=S;0>=A.l(R);)I=$(I),A=$(A);var w=j(I,1),b=j(A,1);for(A=j(A,2),I=j(I,2);!_(A);){var v=b.add(A);0>=v.l(R)&&(w=w.add(I),b=v),A=j(A,1),I=j(I,1)}return S=T(R,w.j(S)),new k(w,S)}for(w=f;0<=R.l(S);){for(I=Math.max(1,Math.floor(R.m()/S.m())),A=Math.ceil(Math.log(I)/Math.LN2),A=48>=A?1:Math.pow(2,A-48),b=u(I),v=b.j(S);C(v)||0<v.l(R);)I-=A,b=u(I),v=b.j(S);_(b)&&(b=g),w=w.add(b),R=T(R,v)}return new k(w,R)}n.A=function(R){return P(this,R).h},n.and=function(R){for(var S=Math.max(this.g.length,R.g.length),I=[],A=0;A<S;A++)I[A]=this.i(A)&R.i(A);return new o(I,this.h&R.h)},n.or=function(R){for(var S=Math.max(this.g.length,R.g.length),I=[],A=0;A<S;A++)I[A]=this.i(A)|R.i(A);return new o(I,this.h|R.h)},n.xor=function(R){for(var S=Math.max(this.g.length,R.g.length),I=[],A=0;A<S;A++)I[A]=this.i(A)^R.i(A);return new o(I,this.h^R.h)};function $(R){for(var S=R.g.length+1,I=[],A=0;A<S;A++)I[A]=R.i(A)<<1|R.i(A-1)>>>31;return new o(I,R.h)}function j(R,S){var I=S>>5;S%=32;for(var A=R.g.length-I,w=[],b=0;b<A;b++)w[b]=0<S?R.i(b+I)>>>S|R.i(b+I+1)<<32-S:R.i(b+I);return new o(w,R.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,FR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,xo=o}).apply(typeof kE<"u"?kE:typeof self<"u"?self:typeof window<"u"?window:{});var vf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var jR,Du,UR,Gf,fv,$R,BR,zR;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,p,m){return c==Array.prototype||c==Object.prototype||(c[p]=m.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof vf=="object"&&vf];for(var p=0;p<c.length;++p){var m=c[p];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function s(c,p){if(p)e:{var m=r;c=c.split(".");for(var E=0;E<c.length-1;E++){var O=c[E];if(!(O in m))break e;m=m[O]}c=c[c.length-1],E=m[c],p=p(E),p!=E&&p!=null&&e(m,c,{configurable:!0,writable:!0,value:p})}}function i(c,p){c instanceof String&&(c+="");var m=0,E=!1,O={next:function(){if(!E&&m<c.length){var U=m++;return{value:p(U,c[U]),done:!1}}return E=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(c){return c||function(){return i(this,function(p,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var p=typeof c;return p=p!="object"?p:c?Array.isArray(c)?"array":p:"null",p=="array"||p=="object"&&typeof c.length=="number"}function u(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function h(c,p,m){return c.call.apply(c.bind,arguments)}function f(c,p,m){if(!c)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,E),c.apply(p,O)}}return function(){return c.apply(p,arguments)}}function g(c,p,m){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function y(c,p){var m=Array.prototype.slice.call(arguments,1);return function(){var E=m.slice();return E.push.apply(E,arguments),c.apply(this,E)}}function _(c,p){function m(){}m.prototype=p.prototype,c.aa=p.prototype,c.prototype=new m,c.prototype.constructor=c,c.Qb=function(E,O,U){for(var se=Array(arguments.length-2),Lt=2;Lt<arguments.length;Lt++)se[Lt-2]=arguments[Lt];return p.prototype[O].apply(E,se)}}function C(c){const p=c.length;if(0<p){const m=Array(p);for(let E=0;E<p;E++)m[E]=c[E];return m}return[]}function N(c,p){for(let m=1;m<arguments.length;m++){const E=arguments[m];if(l(E)){const O=c.length||0,U=E.length||0;c.length=O+U;for(let se=0;se<U;se++)c[O+se]=E[se]}else c.push(E)}}class T{constructor(p,m){this.i=p,this.j=m,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function x(c){return/^[\s\xa0]*$/.test(c)}function k(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function P(c){return P[" "](c),c}P[" "]=function(){};var $=k().indexOf("Gecko")!=-1&&!(k().toLowerCase().indexOf("webkit")!=-1&&k().indexOf("Edge")==-1)&&!(k().indexOf("Trident")!=-1||k().indexOf("MSIE")!=-1)&&k().indexOf("Edge")==-1;function j(c,p,m){for(const E in c)p.call(m,c[E],E,c)}function R(c,p){for(const m in c)p.call(void 0,c[m],m,c)}function S(c){const p={};for(const m in c)p[m]=c[m];return p}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(c,p){let m,E;for(let O=1;O<arguments.length;O++){E=arguments[O];for(m in E)c[m]=E[m];for(let U=0;U<I.length;U++)m=I[U],Object.prototype.hasOwnProperty.call(E,m)&&(c[m]=E[m])}}function w(c){var p=1;c=c.split(":");const m=[];for(;0<p&&c.length;)m.push(c.shift()),p--;return c.length&&m.push(c.join(":")),m}function b(c){a.setTimeout(()=>{throw c},0)}function v(){var c=Se;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class te{constructor(){this.h=this.g=null}add(p,m){const E=Ee.get();E.set(p,m),this.h?this.h.next=E:this.g=E,this.h=E}}var Ee=new T(()=>new ue,c=>c.reset());class ue{constructor(){this.next=this.g=this.h=null}set(p,m){this.h=p,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let ye,K=!1,Se=new te,Te=()=>{const c=a.Promise.resolve(void 0);ye=()=>{c.then(je)}};var je=()=>{for(var c;c=v();){try{c.h.call(c.g)}catch(m){b(m)}var p=Ee;p.j(c),100>p.h&&(p.h++,c.next=p.g,p.g=c)}K=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function D(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var z=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};a.addEventListener("test",m,p),a.removeEventListener("test",m,p)}catch{}return c}();function ce(c,p){if(D.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var m=this.type=c.type,E=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget){if($){e:{try{P(p.nodeName);var O=!0;break e}catch{}O=!1}O||(p=null)}}else m=="mouseover"?p=c.fromElement:m=="mouseout"&&(p=c.toElement);this.relatedTarget=p,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:_e[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&ce.aa.h.call(this)}}_(ce,D);var _e={2:"touch",3:"pen",4:"mouse"};ce.prototype.h=function(){ce.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ne="closure_listenable_"+(1e6*Math.random()|0),pe=0;function Z(c,p,m,E,O){this.listener=c,this.proxy=null,this.src=p,this.type=m,this.capture=!!E,this.ha=O,this.key=++pe,this.da=this.fa=!1}function we(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function ie(c){this.src=c,this.g={},this.h=0}ie.prototype.add=function(c,p,m,E,O){var U=c.toString();c=this.g[U],c||(c=this.g[U]=[],this.h++);var se=de(c,p,E,O);return-1<se?(p=c[se],m||(p.fa=!1)):(p=new Z(p,this.src,U,!!E,O),p.fa=m,c.push(p)),p};function ve(c,p){var m=p.type;if(m in c.g){var E=c.g[m],O=Array.prototype.indexOf.call(E,p,void 0),U;(U=0<=O)&&Array.prototype.splice.call(E,O,1),U&&(we(p),c.g[m].length==0&&(delete c.g[m],c.h--))}}function de(c,p,m,E){for(var O=0;O<c.length;++O){var U=c[O];if(!U.da&&U.listener==p&&U.capture==!!m&&U.ha==E)return O}return-1}var G="closure_lm_"+(1e6*Math.random()|0),oe={};function ee(c,p,m,E,O){if(E&&E.once)return Ae(c,p,m,E,O);if(Array.isArray(p)){for(var U=0;U<p.length;U++)ee(c,p[U],m,E,O);return null}return m=wt(m),c&&c[Ne]?c.K(p,m,u(E)?!!E.capture:!!E,O):ae(c,p,m,!1,E,O)}function ae(c,p,m,E,O,U){if(!p)throw Error("Invalid event type");var se=u(O)?!!O.capture:!!O,Lt=Ct(c);if(Lt||(c[G]=Lt=new ie(c)),m=Lt.add(p,m,E,se,U),m.proxy)return m;if(E=ge(),m.proxy=E,E.src=c,E.listener=m,c.addEventListener)z||(O=se),O===void 0&&(O=!1),c.addEventListener(p.toString(),E,O);else if(c.attachEvent)c.attachEvent(gt(p.toString()),E);else if(c.addListener&&c.removeListener)c.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return m}function ge(){function c(m){return p.call(c.src,c.listener,m)}const p=Nt;return c}function Ae(c,p,m,E,O){if(Array.isArray(p)){for(var U=0;U<p.length;U++)Ae(c,p[U],m,E,O);return null}return m=wt(m),c&&c[Ne]?c.L(p,m,u(E)?!!E.capture:!!E,O):ae(c,p,m,!0,E,O)}function Ke(c,p,m,E,O){if(Array.isArray(p))for(var U=0;U<p.length;U++)Ke(c,p[U],m,E,O);else E=u(E)?!!E.capture:!!E,m=wt(m),c&&c[Ne]?(c=c.i,p=String(p).toString(),p in c.g&&(U=c.g[p],m=de(U,m,E,O),-1<m&&(we(U[m]),Array.prototype.splice.call(U,m,1),U.length==0&&(delete c.g[p],c.h--)))):c&&(c=Ct(c))&&(p=c.g[p.toString()],c=-1,p&&(c=de(p,m,E,O)),(m=-1<c?p[c]:null)&&kt(m))}function kt(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[Ne])ve(p.i,c);else{var m=c.type,E=c.proxy;p.removeEventListener?p.removeEventListener(m,E,c.capture):p.detachEvent?p.detachEvent(gt(m),E):p.addListener&&p.removeListener&&p.removeListener(E),(m=Ct(p))?(ve(m,c),m.h==0&&(m.src=null,p[G]=null)):we(c)}}}function gt(c){return c in oe?oe[c]:oe[c]="on"+c}function Nt(c,p){if(c.da)c=!0;else{p=new ce(p,this);var m=c.listener,E=c.ha||c.src;c.fa&&kt(c),c=m.call(E,p)}return c}function Ct(c){return c=c[G],c instanceof ie?c:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function wt(c){return typeof c=="function"?c:(c[Pt]||(c[Pt]=function(p){return c.handleEvent(p)}),c[Pt])}function Pe(){be.call(this),this.i=new ie(this),this.M=this,this.F=null}_(Pe,be),Pe.prototype[Ne]=!0,Pe.prototype.removeEventListener=function(c,p,m,E){Ke(this,c,p,m,E)};function ut(c,p){var m,E=c.F;if(E)for(m=[];E;E=E.F)m.push(E);if(c=c.M,E=p.type||p,typeof p=="string")p=new D(p,c);else if(p instanceof D)p.target=p.target||c;else{var O=p;p=new D(E,c),A(p,O)}if(O=!0,m)for(var U=m.length-1;0<=U;U--){var se=p.g=m[U];O=Dt(se,E,!0,p)&&O}if(se=p.g=c,O=Dt(se,E,!0,p)&&O,O=Dt(se,E,!1,p)&&O,m)for(U=0;U<m.length;U++)se=p.g=m[U],O=Dt(se,E,!1,p)&&O}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var c=this.i,p;for(p in c.g){for(var m=c.g[p],E=0;E<m.length;E++)we(m[E]);delete c.g[p],c.h--}}this.F=null},Pe.prototype.K=function(c,p,m,E){return this.i.add(String(c),p,!1,m,E)},Pe.prototype.L=function(c,p,m,E){return this.i.add(String(c),p,!0,m,E)};function Dt(c,p,m,E){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();for(var O=!0,U=0;U<p.length;++U){var se=p[U];if(se&&!se.da&&se.capture==m){var Lt=se.listener,qn=se.ha||se.src;se.fa&&ve(c.i,se),O=Lt.call(qn,E)!==!1&&O}}return O&&!E.defaultPrevented}function Vt(c,p,m){if(typeof c=="function")m&&(c=g(c,m));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(c,p||0)}function Yt(c){c.g=Vt(()=>{c.g=null,c.i&&(c.i=!1,Yt(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class Et extends be{constructor(p,m){super(),this.m=p,this.l=m,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Yt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ft(c){be.call(this),this.h=c,this.g={}}_(Ft,be);var vn=[];function pt(c){j(c.g,function(p,m){this.g.hasOwnProperty(m)&&kt(p)},c),c.g={}}Ft.prototype.N=function(){Ft.aa.N.call(this),pt(this)},Ft.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var It=a.JSON.stringify,kr=a.JSON.parse,mr=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function lt(){}lt.prototype.h=null;function dt(c){return c.h||(c.h=c.i())}function Un(){}var Jn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ks(){D.call(this,"d")}_(ks,D);function cs(){D.call(this,"c")}_(cs,D);var us={},ti=null;function ll(){return ti=ti||new Pe}us.La="serverreachability";function Bh(c){D.call(this,us.La,c)}_(Bh,D);function ni(c){const p=ll();ut(p,new Bh(p))}us.STAT_EVENT="statevent";function cl(c,p){D.call(this,us.STAT_EVENT,c),this.stat=p}_(cl,D);function $n(c){const p=ll();ut(p,new cl(p,c))}us.Ma="timingevent";function zh(c,p){D.call(this,us.Ma,c),this.size=p}_(zh,D);function Ko(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},p)}function Yo(){this.g=!0}Yo.prototype.xa=function(){this.g=!1};function M(c,p,m,E,O,U){c.info(function(){if(c.g)if(U)for(var se="",Lt=U.split("&"),qn=0;qn<Lt.length;qn++){var yt=Lt[qn].split("=");if(1<yt.length){var Xn=yt[0];yt=yt[1];var Zn=Xn.split("_");se=2<=Zn.length&&Zn[1]=="type"?se+(Xn+"="+yt+"&"):se+(Xn+"=redacted&")}}else se=null;else se=U;return"XMLHTTP REQ ("+E+") [attempt "+O+"]: "+p+`
`+m+`
`+se})}function W(c,p,m,E,O,U,se){c.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+O+"]: "+p+`
`+m+`
`+U+" "+se})}function B(c,p,m,E){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+Le(c,m)+(E?" "+E:"")})}function me(c,p){c.info(function(){return"TIMEOUT: "+p})}Yo.prototype.info=function(){};function Le(c,p){if(!c.g)return p;if(!p)return null;try{var m=JSON.parse(p);if(m){for(c=0;c<m.length;c++)if(Array.isArray(m[c])){var E=m[c];if(!(2>E.length)){var O=E[1];if(Array.isArray(O)&&!(1>O.length)){var U=O[0];if(U!="noop"&&U!="stop"&&U!="close")for(var se=1;se<O.length;se++)O[se]=""}}}}return It(m)}catch{return p}}var qe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Re={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},De;function Oe(){}_(Oe,lt),Oe.prototype.g=function(){return new XMLHttpRequest},Oe.prototype.i=function(){return{}},De=new Oe;function at(c,p,m,E){this.j=c,this.i=p,this.l=m,this.R=E||1,this.U=new Ft(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new He}function He(){this.i=null,this.g="",this.h=!1}var ze={},Je={};function Ue(c,p,m){c.L=1,c.v=qh(yr(p)),c.m=m,c.P=!0,Ve(c,null)}function Ve(c,p){c.F=Date.now(),wn(c),c.A=yr(c.v);var m=c.A,E=c.R;Array.isArray(E)||(E=[String(E)]),lx(m.i,"t",E),c.C=0,m=c.j.J,c.h=new He,c.g=bx(c.j,m?p:null,!c.m),0<c.O&&(c.M=new Et(g(c.Y,c,c.g),c.O)),p=c.U,m=c.g,E=c.ca;var O="readystatechange";Array.isArray(O)||(O&&(vn[0]=O.toString()),O=vn);for(var U=0;U<O.length;U++){var se=ee(m,O[U],E||p.handleEvent,!1,p.h||p);if(!se)break;p.g[se.key]=se}p=c.H?S(c.H):{},c.m?(c.u||(c.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,p)):(c.u="GET",c.g.ea(c.A,c.u,null,p)),ni(),M(c.i,c.u,c.A,c.l,c.R,c.m)}at.prototype.ca=function(c){c=c.target;const p=this.M;p&&ii(c)==3?p.j():this.Y(c)},at.prototype.Y=function(c){try{if(c==this.g)e:{const Zn=ii(this.g);var p=this.g.Ba();const gl=this.g.Z();if(!(3>Zn)&&(Zn!=3||this.g&&(this.h.h||this.g.oa()||px(this.g)))){this.J||Zn!=4||p==7||(p==8||0>=gl?ni(3):ni(2)),xt(this);var m=this.g.Z();this.X=m;t:if(ke(this)){var E=px(this.g);c="";var O=E.length,U=ii(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){pn(this),Ye(this);var se="";break t}this.h.i=new a.TextDecoder}for(p=0;p<O;p++)this.h.h=!0,c+=this.h.i.decode(E[p],{stream:!(U&&p==O-1)});E.length=0,this.h.g+=c,this.C=0,se=this.h.g}else se=this.g.oa();if(this.o=m==200,W(this.i,this.u,this.A,this.l,this.R,Zn,m),this.o){if(this.T&&!this.K){t:{if(this.g){var Lt,qn=this.g;if((Lt=qn.g?qn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Lt)){var yt=Lt;break t}}yt=null}if(m=yt)B(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Yr(this,m);else{this.o=!1,this.s=3,$n(12),pn(this),Ye(this);break e}}if(this.P){m=!0;let ds;for(;!this.J&&this.C<se.length;)if(ds=We(this,se),ds==Je){Zn==4&&(this.s=4,$n(14),m=!1),B(this.i,this.l,null,"[Incomplete Response]");break}else if(ds==ze){this.s=4,$n(15),B(this.i,this.l,se,"[Invalid Chunk]"),m=!1;break}else B(this.i,this.l,ds,null),Yr(this,ds);if(ke(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Zn!=4||se.length!=0||this.h.h||(this.s=1,$n(16),m=!1),this.o=this.o&&m,!m)B(this.i,this.l,se,"[Invalid Chunked Response]"),pn(this),Ye(this);else if(0<se.length&&!this.W){this.W=!0;var Xn=this.j;Xn.g==this&&Xn.ba&&!Xn.M&&(Xn.j.info("Great, no buffering proxy detected. Bytes received: "+se.length),Gm(Xn),Xn.M=!0,$n(11))}}else B(this.i,this.l,se,null),Yr(this,se);Zn==4&&pn(this),this.o&&!this.J&&(Zn==4?xx(this.j,this):(this.o=!1,wn(this)))}else i2(this.g),m==400&&0<se.indexOf("Unknown SID")?(this.s=3,$n(12)):(this.s=0,$n(13)),pn(this),Ye(this)}}}catch{}finally{}};function ke(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function We(c,p){var m=c.C,E=p.indexOf(`
`,m);return E==-1?Je:(m=Number(p.substring(m,E)),isNaN(m)?ze:(E+=1,E+m>p.length?Je:(p=p.slice(E,E+m),c.C=E+m,p)))}at.prototype.cancel=function(){this.J=!0,pn(this)};function wn(c){c.S=Date.now()+c.I,mt(c,c.I)}function mt(c,p){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Ko(g(c.ba,c),p)}function xt(c){c.B&&(a.clearTimeout(c.B),c.B=null)}at.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(me(this.i,this.A),this.L!=2&&(ni(),$n(17)),pn(this),this.s=2,Ye(this)):mt(this,this.S-c)};function Ye(c){c.j.G==0||c.J||xx(c.j,c)}function pn(c){xt(c);var p=c.M;p&&typeof p.ma=="function"&&p.ma(),c.M=null,pt(c.U),c.g&&(p=c.g,c.g=null,p.abort(),p.ma())}function Yr(c,p){try{var m=c.j;if(m.G!=0&&(m.g==c||ht(m.h,c))){if(!c.K&&ht(m.h,c)&&m.G==3){try{var E=m.Da.g.parse(p)}catch{E=null}if(Array.isArray(E)&&E.length==3){var O=E;if(O[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<c.F)Yh(m),Qh(m);else break e;Wm(m),$n(18)}}else m.za=O[1],0<m.za-m.T&&37500>O[2]&&m.F&&m.v==0&&!m.C&&(m.C=Ko(g(m.Za,m),6e3));if(1>=Qe(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Xo(m,11)}else if((c.K||m.g==c)&&Yh(m),!x(p))for(O=m.Da.g.parse(p),p=0;p<O.length;p++){let yt=O[p];if(m.T=yt[0],yt=yt[1],m.G==2)if(yt[0]=="c"){m.K=yt[1],m.ia=yt[2];const Xn=yt[3];Xn!=null&&(m.la=Xn,m.j.info("VER="+m.la));const Zn=yt[4];Zn!=null&&(m.Aa=Zn,m.j.info("SVER="+m.Aa));const gl=yt[5];gl!=null&&typeof gl=="number"&&0<gl&&(E=1.5*gl,m.L=E,m.j.info("backChannelRequestTimeoutMs_="+E)),E=m;const ds=c.g;if(ds){const Xh=ds.g?ds.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xh){var U=E.h;U.g||Xh.indexOf("spdy")==-1&&Xh.indexOf("quic")==-1&&Xh.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(sn(U,U.h),U.h=null))}if(E.D){const Hm=ds.g?ds.g.getResponseHeader("X-HTTP-Session-Id"):null;Hm&&(E.ya=Hm,qt(E.I,E.D,Hm))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-c.F,m.j.info("Handshake RTT: "+m.R+"ms")),E=m;var se=c;if(E.qa=Tx(E,E.J?E.ia:null,E.W),se.K){Jt(E.h,se);var Lt=se,qn=E.L;qn&&(Lt.I=qn),Lt.B&&(xt(Lt),wn(Lt)),E.g=se}else wx(E);0<m.i.length&&Kh(m)}else yt[0]!="stop"&&yt[0]!="close"||Xo(m,7);else m.G==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?Xo(m,7):qm(m):yt[0]!="noop"&&m.l&&m.l.ta(yt),m.v=0)}}ni(4)}catch{}}var ri=class{constructor(c,p){this.g=c,this.map=p}};function ul(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Bn(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Qe(c){return c.h?1:c.g?c.g.size:0}function ht(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function sn(c,p){c.g?c.g.add(p):c.h=p}function Jt(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}ul.prototype.cancel=function(){if(this.i=Nr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Nr(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const m of c.g.values())p=p.concat(m.D);return p}return C(c.i)}function Jo(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var p=[],m=c.length,E=0;E<m;E++)p.push(c[E]);return p}p=[],m=0;for(E in c)p[m++]=c[E];return p}function Fi(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var p=[];c=c.length;for(var m=0;m<c;m++)p.push(m);return p}p=[],m=0;for(const E in c)p[m++]=E;return p}}}function si(c,p){if(c.forEach&&typeof c.forEach=="function")c.forEach(p,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,p,void 0);else for(var m=Fi(c),E=Jo(c),O=E.length,U=0;U<O;U++)p.call(void 0,E[U],m&&m[U],c)}var zn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function zt(c,p){if(c){c=c.split("&");for(var m=0;m<c.length;m++){var E=c[m].indexOf("="),O=null;if(0<=E){var U=c[m].substring(0,E);O=c[m].substring(E+1)}else U=c[m];p(U,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function cr(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof cr){this.h=c.h,dl(this,c.j),this.o=c.o,this.g=c.g,Ns(this,c.s),this.l=c.l;var p=c.i,m=new ru;m.i=p.i,p.g&&(m.g=new Map(p.g),m.h=p.h),sx(this,m),this.m=c.m}else c&&(p=String(c).match(zn))?(this.h=!1,dl(this,p[1]||"",!0),this.o=tu(p[2]||""),this.g=tu(p[3]||"",!0),Ns(this,p[4]),this.l=tu(p[5]||"",!0),sx(this,p[6]||"",!0),this.m=tu(p[7]||"")):(this.h=!1,this.i=new ru(null,this.h))}cr.prototype.toString=function(){var c=[],p=this.j;p&&c.push(nu(p,ix,!0),":");var m=this.g;return(m||p=="file")&&(c.push("//"),(p=this.o)&&c.push(nu(p,ix,!0),"@"),c.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&c.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(nu(m,m.charAt(0)=="/"?KD:QD,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",nu(m,JD)),c.join("")};function yr(c){return new cr(c)}function dl(c,p,m){c.j=m?tu(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function Ns(c,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);c.s=p}else c.s=null}function sx(c,p,m){p instanceof ru?(c.i=p,XD(c.i,c.h)):(m||(p=nu(p,YD)),c.i=new ru(p,c.h))}function qt(c,p,m){c.i.set(p,m)}function qh(c){return qt(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function tu(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function nu(c,p,m){return typeof c=="string"?(c=encodeURI(c).replace(p,HD),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function HD(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var ix=/[#\/\?@]/g,QD=/[#\?:]/g,KD=/[#\?]/g,YD=/[#\?@]/g,JD=/#/g;function ru(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function ji(c){c.g||(c.g=new Map,c.h=0,c.i&&zt(c.i,function(p,m){c.add(decodeURIComponent(p.replace(/\+/g," ")),m)}))}n=ru.prototype,n.add=function(c,p){ji(this),this.i=null,c=hl(this,c);var m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(p),this.h+=1,this};function ox(c,p){ji(c),p=hl(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function ax(c,p){return ji(c),p=hl(c,p),c.g.has(p)}n.forEach=function(c,p){ji(this),this.g.forEach(function(m,E){m.forEach(function(O){c.call(p,O,E,this)},this)},this)},n.na=function(){ji(this);const c=Array.from(this.g.values()),p=Array.from(this.g.keys()),m=[];for(let E=0;E<p.length;E++){const O=c[E];for(let U=0;U<O.length;U++)m.push(p[E])}return m},n.V=function(c){ji(this);let p=[];if(typeof c=="string")ax(this,c)&&(p=p.concat(this.g.get(hl(this,c))));else{c=Array.from(this.g.values());for(let m=0;m<c.length;m++)p=p.concat(c[m])}return p},n.set=function(c,p){return ji(this),this.i=null,c=hl(this,c),ax(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},n.get=function(c,p){return c?(c=this.V(c),0<c.length?String(c[0]):p):p};function lx(c,p,m){ox(c,p),0<m.length&&(c.i=null,c.g.set(hl(c,p),C(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(var m=0;m<p.length;m++){var E=p[m];const U=encodeURIComponent(String(E)),se=this.V(E);for(E=0;E<se.length;E++){var O=U;se[E]!==""&&(O+="="+encodeURIComponent(String(se[E]))),c.push(O)}}return this.i=c.join("&")};function hl(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function XD(c,p){p&&!c.j&&(ji(c),c.i=null,c.g.forEach(function(m,E){var O=E.toLowerCase();E!=O&&(ox(this,E),lx(this,O,m))},c)),c.j=p}function ZD(c,p){const m=new Yo;if(a.Image){const E=new Image;E.onload=y(Ui,m,"TestLoadImage: loaded",!0,p,E),E.onerror=y(Ui,m,"TestLoadImage: error",!1,p,E),E.onabort=y(Ui,m,"TestLoadImage: abort",!1,p,E),E.ontimeout=y(Ui,m,"TestLoadImage: timeout",!1,p,E),a.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=c}else p(!1)}function e2(c,p){const m=new Yo,E=new AbortController,O=setTimeout(()=>{E.abort(),Ui(m,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:E.signal}).then(U=>{clearTimeout(O),U.ok?Ui(m,"TestPingServer: ok",!0,p):Ui(m,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(O),Ui(m,"TestPingServer: error",!1,p)})}function Ui(c,p,m,E,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),E(m)}catch{}}function t2(){this.g=new mr}function n2(c,p,m){const E=m||"";try{si(c,function(O,U){let se=O;u(O)&&(se=It(O)),p.push(E+U+"="+encodeURIComponent(se))})}catch(O){throw p.push(E+"type="+encodeURIComponent("_badmap")),O}}function Wh(c){this.l=c.Ub||null,this.j=c.eb||!1}_(Wh,lt),Wh.prototype.g=function(){return new Gh(this.l,this.j)},Wh.prototype.i=function(c){return function(){return c}}({});function Gh(c,p){Pe.call(this),this.D=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}_(Gh,Pe),n=Gh.prototype,n.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=p,this.readyState=1,iu(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(p.body=c),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,su(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,iu(this)),this.g&&(this.readyState=3,iu(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cx(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function cx(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?su(this):iu(this),this.readyState==3&&cx(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,su(this))},n.Qa=function(c){this.g&&(this.response=c,su(this))},n.ga=function(){this.g&&su(this)};function su(c){c.readyState=4,c.l=null,c.j=null,c.v=null,iu(c)}n.setRequestHeader=function(c,p){this.u.append(c,p)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var m=p.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=p.next();return c.join(`\r
`)};function iu(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Gh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function ux(c){let p="";return j(c,function(m,E){p+=E,p+=":",p+=m,p+=`\r
`}),p}function zm(c,p,m){e:{for(E in m){var E=!1;break e}E=!0}E||(m=ux(m),typeof c=="string"?m!=null&&encodeURIComponent(String(m)):qt(c,p,m))}function dn(c){Pe.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}_(dn,Pe);var r2=/^https?$/i,s2=["POST","PUT"];n=dn.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,p,m,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():De.g(),this.v=this.o?dt(this.o):dt(De),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch(U){dx(this,U);return}if(c=m||"",m=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var O in E)m.set(O,E[O]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const U of E.keys())m.set(U,E.get(U));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(m.keys()).find(U=>U.toLowerCase()=="content-type"),O=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(s2,p,void 0))||E||O||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,se]of m)this.g.setRequestHeader(U,se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{gx(this),this.u=!0,this.g.send(c),this.u=!1}catch(U){dx(this,U)}};function dx(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.m=5,hx(c),Hh(c)}function hx(c){c.A||(c.A=!0,ut(c,"complete"),ut(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,ut(this,"complete"),ut(this,"abort"),Hh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hh(this,!0)),dn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?fx(this):this.bb())},n.bb=function(){fx(this)};function fx(c){if(c.h&&typeof o<"u"&&(!c.v[1]||ii(c)!=4||c.Z()!=2)){if(c.u&&ii(c)==4)Vt(c.Ea,0,c);else if(ut(c,"readystatechange"),ii(c)==4){c.h=!1;try{const se=c.Z();e:switch(se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var m;if(!(m=p)){var E;if(E=se===0){var O=String(c.D).match(zn)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),E=!r2.test(O?O.toLowerCase():"")}m=E}if(m)ut(c,"complete"),ut(c,"success");else{c.m=6;try{var U=2<ii(c)?c.g.statusText:""}catch{U=""}c.l=U+" ["+c.Z()+"]",hx(c)}}finally{Hh(c)}}}}function Hh(c,p){if(c.g){gx(c);const m=c.g,E=c.v[0]?()=>{}:null;c.g=null,c.v=null,p||ut(c,"ready");try{m.onreadystatechange=E}catch{}}}function gx(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function ii(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<ii(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),kr(p)}};function px(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function i2(c){const p={};c=(c.g&&2<=ii(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<c.length;E++){if(x(c[E]))continue;var m=w(c[E]);const O=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const U=p[O]||[];p[O]=U,U.push(m)}R(p,function(E){return E.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ou(c,p,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||p}function mx(c){this.Aa=0,this.i=[],this.j=new Yo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ou("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ou("baseRetryDelayMs",5e3,c),this.cb=ou("retryDelaySeedMs",1e4,c),this.Wa=ou("forwardChannelMaxRetries",2,c),this.wa=ou("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new ul(c&&c.concurrentRequestLimit),this.Da=new t2,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=mx.prototype,n.la=8,n.G=1,n.connect=function(c,p,m,E){$n(0),this.W=c,this.H=p||{},m&&E!==void 0&&(this.H.OSID=m,this.H.OAID=E),this.F=this.X,this.I=Tx(this,null,this.W),Kh(this)};function qm(c){if(yx(c),c.G==3){var p=c.U++,m=yr(c.I);if(qt(m,"SID",c.K),qt(m,"RID",p),qt(m,"TYPE","terminate"),au(c,m),p=new at(c,c.j,p),p.L=2,p.v=qh(yr(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=p.v,m=!0),m||(p.g=bx(p.j,null),p.g.ea(p.v)),p.F=Date.now(),wn(p)}Ex(c)}function Qh(c){c.g&&(Gm(c),c.g.cancel(),c.g=null)}function yx(c){Qh(c),c.u&&(a.clearTimeout(c.u),c.u=null),Yh(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function Kh(c){if(!Bn(c.h)&&!c.s){c.s=!0;var p=c.Ga;ye||Te(),K||(ye(),K=!0),Se.add(p,c),c.B=0}}function o2(c,p){return Qe(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=p.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Ko(g(c.Ga,c,p),Sx(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const O=new at(this,this.j,c);let U=this.o;if(this.S&&(U?(U=S(U),A(U,this.S)):U=this.S),this.m!==null||this.O||(O.H=U,U=null),this.P)e:{for(var p=0,m=0;m<this.i.length;m++){t:{var E=this.i[m];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(p+=E,4096<p){p=m;break e}if(p===4096||m===this.i.length-1){p=m+1;break e}}p=1e3}else p=1e3;p=vx(this,O,p),m=yr(this.I),qt(m,"RID",c),qt(m,"CVER",22),this.D&&qt(m,"X-HTTP-Session-Id",this.D),au(this,m),U&&(this.O?p="headers="+encodeURIComponent(String(ux(U)))+"&"+p:this.m&&zm(m,this.m,U)),sn(this.h,O),this.Ua&&qt(m,"TYPE","init"),this.P?(qt(m,"$req",p),qt(m,"SID","null"),O.T=!0,Ue(O,m,null)):Ue(O,m,p),this.G=2}}else this.G==3&&(c?_x(this,c):this.i.length==0||Bn(this.h)||_x(this))};function _x(c,p){var m;p?m=p.l:m=c.U++;const E=yr(c.I);qt(E,"SID",c.K),qt(E,"RID",m),qt(E,"AID",c.T),au(c,E),c.m&&c.o&&zm(E,c.m,c.o),m=new at(c,c.j,m,c.B+1),c.m===null&&(m.H=c.o),p&&(c.i=p.D.concat(c.i)),p=vx(c,m,1e3),m.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),sn(c.h,m),Ue(m,E,p)}function au(c,p){c.H&&j(c.H,function(m,E){qt(p,E,m)}),c.l&&si({},function(m,E){qt(p,E,m)})}function vx(c,p,m){m=Math.min(c.i.length,m);var E=c.l?g(c.l.Na,c.l,c):null;e:{var O=c.i;let U=-1;for(;;){const se=["count="+m];U==-1?0<m?(U=O[0].g,se.push("ofs="+U)):U=0:se.push("ofs="+U);let Lt=!0;for(let qn=0;qn<m;qn++){let yt=O[qn].g;const Xn=O[qn].map;if(yt-=U,0>yt)U=Math.max(0,O[qn].g-100),Lt=!1;else try{n2(Xn,se,"req"+yt+"_")}catch{E&&E(Xn)}}if(Lt){E=se.join("&");break e}}}return c=c.i.splice(0,m),p.D=c,E}function wx(c){if(!c.g&&!c.u){c.Y=1;var p=c.Fa;ye||Te(),K||(ye(),K=!0),Se.add(p,c),c.v=0}}function Wm(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Ko(g(c.Fa,c),Sx(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,Ix(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Ko(g(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,$n(10),Qh(this),Ix(this))};function Gm(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function Ix(c){c.g=new at(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var p=yr(c.qa);qt(p,"RID","rpc"),qt(p,"SID",c.K),qt(p,"AID",c.T),qt(p,"CI",c.F?"0":"1"),!c.F&&c.ja&&qt(p,"TO",c.ja),qt(p,"TYPE","xmlhttp"),au(c,p),c.m&&c.o&&zm(p,c.m,c.o),c.L&&(c.g.I=c.L);var m=c.g;c=c.ia,m.L=1,m.v=qh(yr(p)),m.m=null,m.P=!0,Ve(m,c)}n.Za=function(){this.C!=null&&(this.C=null,Qh(this),Wm(this),$n(19))};function Yh(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function xx(c,p){var m=null;if(c.g==p){Yh(c),Gm(c),c.g=null;var E=2}else if(ht(c.h,p))m=p.D,Jt(c.h,p),E=1;else return;if(c.G!=0){if(p.o)if(E==1){m=p.m?p.m.length:0,p=Date.now()-p.F;var O=c.B;E=ll(),ut(E,new zh(E,m)),Kh(c)}else wx(c);else if(O=p.s,O==3||O==0&&0<p.X||!(E==1&&o2(c,p)||E==2&&Wm(c)))switch(m&&0<m.length&&(p=c.h,p.i=p.i.concat(m)),O){case 1:Xo(c,5);break;case 4:Xo(c,10);break;case 3:Xo(c,6);break;default:Xo(c,2)}}}function Sx(c,p){let m=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(m*=2),m*p}function Xo(c,p){if(c.j.info("Error code "+p),p==2){var m=g(c.fb,c),E=c.Xa;const O=!E;E=new cr(E||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||dl(E,"https"),qh(E),O?ZD(E.toString(),m):e2(E.toString(),m)}else $n(2);c.G=0,c.l&&c.l.sa(p),Ex(c),yx(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),$n(2)):(this.j.info("Failed to ping google.com"),$n(1))};function Ex(c){if(c.G=0,c.ka=[],c.l){const p=Nr(c.h);(p.length!=0||c.i.length!=0)&&(N(c.ka,p),N(c.ka,c.i),c.h.i.length=0,C(c.i),c.i.length=0),c.l.ra()}}function Tx(c,p,m){var E=m instanceof cr?yr(m):new cr(m);if(E.g!="")p&&(E.g=p+"."+E.g),Ns(E,E.s);else{var O=a.location;E=O.protocol,p=p?p+"."+O.hostname:O.hostname,O=+O.port;var U=new cr(null);E&&dl(U,E),p&&(U.g=p),O&&Ns(U,O),m&&(U.l=m),E=U}return m=c.D,p=c.ya,m&&p&&qt(E,m,p),qt(E,"VER",c.la),au(c,E),E}function bx(c,p,m){if(p&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Ca&&!c.pa?new dn(new Wh({eb:m})):new dn(c.pa),p.Ha(c.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ax(){}n=Ax.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Jh(){}Jh.prototype.g=function(c,p){return new Pr(c,p)};function Pr(c,p){Pe.call(this),this.g=new mx(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(c?c["X-WebChannel-Client-Profile"]=p.va:c={"X-WebChannel-Client-Profile":p.va}),this.g.S=c,(c=p&&p.Sb)&&!x(c)&&(this.g.m=c),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!x(p)&&(this.g.D=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new fl(this)}_(Pr,Pe),Pr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Pr.prototype.close=function(){qm(this.g)},Pr.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.u&&(m={},m.__data__=It(c),c=m);p.i.push(new ri(p.Ya++,c)),p.G==3&&Kh(p)},Pr.prototype.N=function(){this.g.l=null,delete this.j,qm(this.g),delete this.g,Pr.aa.N.call(this)};function Cx(c){ks.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const m in p){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}_(Cx,ks);function Rx(){cs.call(this),this.status=1}_(Rx,cs);function fl(c){this.g=c}_(fl,Ax),fl.prototype.ua=function(){ut(this.g,"a")},fl.prototype.ta=function(c){ut(this.g,new Cx(c))},fl.prototype.sa=function(c){ut(this.g,new Rx)},fl.prototype.ra=function(){ut(this.g,"b")},Jh.prototype.createWebChannel=Jh.prototype.g,Pr.prototype.send=Pr.prototype.o,Pr.prototype.open=Pr.prototype.m,Pr.prototype.close=Pr.prototype.close,zR=function(){return new Jh},BR=function(){return ll()},$R=us,fv={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},qe.NO_ERROR=0,qe.TIMEOUT=8,qe.HTTP_ERROR=6,Gf=qe,Re.COMPLETE="complete",UR=Re,Un.EventType=Jn,Jn.OPEN="a",Jn.CLOSE="b",Jn.ERROR="c",Jn.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,Du=Un,dn.prototype.listenOnce=dn.prototype.L,dn.prototype.getLastError=dn.prototype.Ka,dn.prototype.getLastErrorCode=dn.prototype.Ba,dn.prototype.getStatus=dn.prototype.Z,dn.prototype.getResponseJson=dn.prototype.Oa,dn.prototype.getResponseText=dn.prototype.oa,dn.prototype.send=dn.prototype.ea,dn.prototype.setWithCredentials=dn.prototype.Ha,jR=dn}).apply(typeof vf<"u"?vf:typeof self<"u"?self:typeof window<"u"?window:{});const NE="@firebase/firestore",PE="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Dn.UNAUTHENTICATED=new Dn(null),Dn.GOOGLE_CREDENTIALS=new Dn("google-credentials-uid"),Dn.FIRST_PARTY=new Dn("first-party-uid"),Dn.MOCK_USER=new Dn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Po=new uh("@firebase/firestore");function Sl(){return Po.logLevel}function y8(n){Po.setLogLevel(n)}function Q(n,...e){if(Po.logLevel<=rt.DEBUG){const t=e.map(bw);Po.debug(`Firestore (${zc}): ${n}`,...t)}}function yn(n,...e){if(Po.logLevel<=rt.ERROR){const t=e.map(bw);Po.error(`Firestore (${zc}): ${n}`,...t)}}function as(n,...e){if(Po.logLevel<=rt.WARN){const t=e.map(bw);Po.warn(`Firestore (${zc}): ${n}`,...t)}}function bw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fe(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,qR(n,r,t)}function qR(n,e,t){let r=`FIRESTORE (${zc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw yn(r),new Error(r)}function xe(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||qR(e,s,r)}function _8(n,e){n||fe(57014,e)}function re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends bs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class M4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Dn.UNAUTHENTICATED))}shutdown(){}}class O4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class V4{constructor(e){this.t=e,this.currentUser=Dn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){xe(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new On;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new On,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new On)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(xe(typeof r.accessToken=="string",31837,{l:r}),new WR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return xe(e===null||typeof e=="string",2055,{h:e}),new Dn(e)}}class F4{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Dn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class j4{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new F4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Dn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class gv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class U4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,en(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){xe(this.o===void 0,3512);const r=i=>{i.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new gv(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(xe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new gv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class v8{getToken(){return Promise.resolve(new gv(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=$4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function $e(n,e){return n<e?-1:n>e?1:0}function pv(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Py(s)===Py(i)?$e(s,i):Py(s)?1:-1}return $e(n.length,e.length)}const B4=55296,z4=57343;function Py(n){const e=n.charCodeAt(0);return e>=B4&&e<=z4}function pc(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function GR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv="__name__";class Os{constructor(e,t,r){t===void 0?t=0:t>e.length&&fe(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&fe(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Os.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Os?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Os.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return $e(e.length,t.length)}static compareSegments(e,t){const r=Os.isNumericId(e),s=Os.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Os.extractNumericId(e).compare(Os.extractNumericId(t)):pv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return xo.fromString(e.substring(4,e.length-2))}}class nt extends Os{construct(e,t,r){return new nt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new q(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new nt(t)}static emptyPath(){return new nt([])}}const q4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nn extends Os{construct(e,t,r){return new nn(e,t,r)}static isValidIdentifier(e){return q4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mv}static keyField(){return new nn([mv])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new q(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new q(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new q(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new q(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nn(t)}static emptyPath(){return new nn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e){this.path=e}static fromPath(e){return new ne(nt.fromString(e))}static fromName(e){return new ne(nt.fromString(e).popFirst(5))}static empty(){return new ne(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&nt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return nt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ne(new nt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cw(n,e,t){if(!t)throw new q(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function W4(n,e,t,r){if(e===!0&&r===!0)throw new q(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function DE(n){if(!ne.isDocumentKey(n))throw new q(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function LE(n){if(ne.isDocumentKey(n))throw new q(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function HR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function rm(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":fe(12329,{type:typeof n})}function st(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=rm(n);throw new q(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function QR(n,e){if(e<=0)throw new q(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(n,e){const t={typeString:n};return e&&(t.value=e),t}function el(n,e){if(!HR(n))throw new q(F.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new q(F.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ME=-62135596800,OE=1e6;class _t{static now(){return _t.fromMillis(Date.now())}static fromDate(e){return _t.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*OE);return new _t(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ME)throw new q(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/OE}_compareTo(e){return this.seconds===e.seconds?$e(this.nanoseconds,e.nanoseconds):$e(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:_t._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(el(e,_t._jsonSchema))return new _t(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ME;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}_t._jsonSchemaVersion="firestore/timestamp/1.0",_t._jsonSchema={type:En("string",_t._jsonSchemaVersion),seconds:En("number"),nanoseconds:En("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{static fromTimestamp(e){return new Ce(e)}static min(){return new Ce(new _t(0,0))}static max(){return new Ce(new _t(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc=-1;class yc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function yv(n){return n.fields.find(e=>e.kind===2)}function sa(n){return n.fields.filter(e=>e.kind!==2)}function G4(n,e){let t=$e(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=H4(n.fields[r],e.fields[r]),t!==0)return t;return $e(n.fields.length,e.fields.length)}yc.UNKNOWN_ID=-1;class wa{constructor(e,t){this.fieldPath=e,this.kind=t}}function H4(n,e){const t=nn.comparator(n.fieldPath,e.fieldPath);return t!==0?t:$e(n.kind,e.kind)}class _c{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new _c(0,Gr.min())}}function KR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ce.fromTimestamp(r===1e9?new _t(t+1,0):new _t(t,r));return new Gr(s,ne.empty(),e)}function YR(n){return new Gr(n.readTime,n.key,mc)}class Gr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Gr(Ce.min(),ne.empty(),mc)}static max(){return new Gr(Ce.max(),ne.empty(),mc)}}function Rw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ne.comparator(n.documentKey,e.documentKey),t!==0?t:$e(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class XR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zo(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==JR)throw n;Q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&fe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):V.reject(t)}static resolve(e){return new V((t,r)=>{t(e)})}static reject(e){return new V((t,r)=>{r(e)})}static waitFor(e){return new V((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=V.resolve(!1);for(const r of e)t=t.next(s=>s?V.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new V((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new V((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mr="SimpleDb";class sm{static open(e,t,r,s){try{return new sm(t,e.transaction(s,r))}catch(i){throw new Xu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new On,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Xu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=kw(r.target.error);this.S.reject(new Xu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Q(Mr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new K4(t)}}class Hs{static delete(e){return Q(Mr,"Removing database:",e),oa(XC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Vp())return!1;if(Hs.F())return!0;const e=Cn(),t=Hs.M(e),r=0<t&&t<10,s=ZR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Hs.M(Cn())===12.2&&yn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Q(Mr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Xu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new q(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new q(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Xu(e,o))},s.onupgradeneeded=i=>{Q(Mr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{Q(Mr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=sm.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),V.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(Q(Mr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ZR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class Q4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return oa(this.U.delete())}}class Xu extends q{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function qo(n){return n.name==="IndexedDbTransactionError"}class K4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(Q(Mr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(Q(Mr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),oa(r)}add(e){return Q(Mr,"ADD",this.store.name,e,e),oa(this.store.add(e))}get(e){return oa(this.store.get(e)).next(t=>(t===void 0&&(t=null),Q(Mr,"GET",this.store.name,e,t),t))}delete(e){return Q(Mr,"DELETE",this.store.name,e),oa(this.store.delete(e))}count(){return Q(Mr,"COUNT",this.store.name),oa(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new V((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new V((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){Q(Mr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new V((r,s)=>{t.onerror=i=>{const o=kw(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new V((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new Q4(a),u=t(a.primaryKey,a.value,l);if(u instanceof V){const h=u.catch(f=>(l.done(),V.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>V.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function oa(n){return new V((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=kw(r.target.error);t(s)}})}let VE=!1;function kw(n){const e=Hs.M(Cn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new q("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return VE||(VE=!0,setTimeout(()=>{throw r},0)),r}}return n}const Zu="IndexBackfiller";class Y4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Q(Zu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();Q(Zu,`Documents written: ${t}`)}catch(t){qo(t)?Q(Zu,"Ignoring IndexedDB error during index backfill: ",t):await zo(t)}await this.re(6e4)})}}class J4{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return V.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return Q(Zu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(Q(Zu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=YR(i);Rw(o,r)>0&&(r=o)}),new Gr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}wr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const So=-1;function xh(n){return n==null}function jd(n){return n===0&&1/n==-1/0}function ek(n){return typeof n=="number"&&Number.isInteger(n)&&!jd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jg="";function or(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=FE(e)),e=X4(n.get(t),e);return FE(e)}function X4(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Jg:t+="";break;default:t+=i}}return t}function FE(n){return n+Jg+""}function $s(n){const e=n.length;if(xe(e>=2,64408,{path:n}),e===2)return xe(n.charAt(0)===Jg&&n.charAt(1)==="",56145,{path:n}),nt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Jg,i);switch((o<0||o>t)&&fe(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:fe(61167,{path:n})}i=o+2}return new nt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ia="remoteDocuments",Sh="owner",yl="owner",Ud="mutationQueues",Z4="userId",ms="mutations",jE="batchId",ga="userMutationsIndex",UE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hf(n,e){return[n,or(e)]}function tk(n,e,t){return[n,or(e),t]}const e3={},vc="documentMutations",Xg="remoteDocumentsV14",t3=["prefixPath","collectionGroup","readTime","documentId"],Qf="documentKeyIndex",n3=["prefixPath","collectionGroup","documentId"],nk="collectionGroupIndex",r3=["collectionGroup","readTime","prefixPath","documentId"],$d="remoteDocumentGlobal",_v="remoteDocumentGlobalKey",wc="targets",rk="queryTargetsIndex",s3=["canonicalId","targetId"],Ic="targetDocuments",i3=["targetId","path"],Nw="documentTargetsIndex",o3=["path","targetId"],Zg="targetGlobalKey",Ia="targetGlobal",Bd="collectionParents",a3=["collectionId","parent"],xc="clientMetadata",l3="clientId",im="bundles",c3="bundleId",om="namedQueries",u3="name",Pw="indexConfiguration",d3="indexId",vv="collectionGroupIndex",h3="collectionGroup",ed="indexState",f3=["indexId","uid"],sk="sequenceNumberIndex",g3=["uid","sequenceNumber"],td="indexEntries",p3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ik="documentKeyIndex",m3=["indexId","uid","orderedDocumentKey"],am="documentOverlays",y3=["userId","collectionPath","documentId"],wv="collectionPathOverlayIndex",_3=["userId","collectionPath","largestBatchId"],ok="collectionGroupOverlayIndex",v3=["userId","collectionGroup","largestBatchId"],Dw="globals",w3="name",ak=[Ud,ms,vc,ia,wc,Sh,Ia,Ic,xc,$d,Bd,im,om],I3=[...ak,am],lk=[Ud,ms,vc,Xg,wc,Sh,Ia,Ic,xc,$d,Bd,im,om,am],ck=lk,Lw=[...ck,Pw,ed,td],x3=Lw,uk=[...Lw,Dw],S3=uk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv extends XR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Rn(n,e){const t=re(n);return Hs.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $E(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Wo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function dk(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function hk(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t){this.comparator=e,this.root=t||Gn.EMPTY}insert(e,t){return new Bt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Gn.BLACK,null,null))}remove(e){return new Bt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wf(this.root,e,this.comparator,!1)}getReverseIterator(){return new wf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wf(this.root,e,this.comparator,!0)}}class wf{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Gn.RED,this.left=s??Gn.EMPTY,this.right=i??Gn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Gn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Gn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Gn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw fe(27949);return e+(this.isRed()?0:1)}}Gn.EMPTY=null,Gn.RED=!0,Gn.BLACK=!1;Gn.EMPTY=new class{constructor(){this.size=0}get key(){throw fe(57766)}get value(){throw fe(16141)}get color(){throw fe(16727)}get left(){throw fe(29726)}get right(){throw fe(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Gn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.comparator=e,this.data=new Bt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new BE(this.data.getIterator())}getIteratorFrom(e){return new BE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class BE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function _l(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(e){this.fields=e,e.sort(nn.comparator)}static empty(){return new Ir([])}unionWith(e){let t=new At(nn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ir(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return pc(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I8(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new fk("Invalid base64 string: "+i):i}}(e);return new fn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new fn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $e(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}fn.EMPTY_BYTE_STRING=new fn("");const E3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(n){if(xe(!!n,39018),typeof n=="string"){let e=0;const t=E3.exec(n);if(xe(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Xt(n.seconds),nanos:Xt(n.nanos)}}function Xt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function bi(n){return typeof n=="string"?fn.fromBase64String(n):fn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gk="server_timestamp",pk="__type__",mk="__previous_value__",yk="__local_write_time__";function lm(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[pk])==null?void 0:r.stringValue)===gk}function cm(n){const e=n.mapValue.fields[mk];return lm(e)?cm(e):e}function zd(n){const e=Ti(n.mapValue.fields[yk].timestampValue);return new _t(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const qd="(default)";class La{constructor(e,t){this.projectId=e,this.database=t||qd}static empty(){return new La("","")}get isDefaultDatabase(){return this.database===qd}isEqual(e){return e instanceof La&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mw="__type__",_k="__max__",io={mapValue:{fields:{__type__:{stringValue:_k}}}},Ow="__vector__",Sc="value",Kf={nullValue:"NULL_VALUE"};function Do(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?lm(n)?4:vk(n)?9007199254740991:um(n)?10:11:fe(28295,{value:n})}function Zs(n,e){if(n===e)return!0;const t=Do(n);if(t!==Do(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zd(n).isEqual(zd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ti(s.timestampValue),a=Ti(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return bi(s.bytesValue).isEqual(bi(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Xt(s.geoPointValue.latitude)===Xt(i.geoPointValue.latitude)&&Xt(s.geoPointValue.longitude)===Xt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Xt(s.integerValue)===Xt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Xt(s.doubleValue),a=Xt(i.doubleValue);return o===a?jd(o)===jd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return pc(n.arrayValue.values||[],e.arrayValue.values||[],Zs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if($E(o)!==$E(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Zs(o[l],a[l])))return!1;return!0}(n,e);default:return fe(52216,{left:n})}}function Wd(n,e){return(n.values||[]).find(t=>Zs(t,e))!==void 0}function Lo(n,e){if(n===e)return 0;const t=Do(n),r=Do(e);if(t!==r)return $e(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $e(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Xt(i.integerValue||i.doubleValue),l=Xt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return zE(n.timestampValue,e.timestampValue);case 4:return zE(zd(n),zd(e));case 5:return pv(n.stringValue,e.stringValue);case 6:return function(i,o){const a=bi(i),l=bi(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=$e(a[u],l[u]);if(h!==0)return h}return $e(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=$e(Xt(i.latitude),Xt(o.latitude));return a!==0?a:$e(Xt(i.longitude),Xt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return qE(n.arrayValue,e.arrayValue);case 10:return function(i,o){var g,y,_,C;const a=i.fields||{},l=o.fields||{},u=(g=a[Sc])==null?void 0:g.arrayValue,h=(y=l[Sc])==null?void 0:y.arrayValue,f=$e(((_=u==null?void 0:u.values)==null?void 0:_.length)||0,((C=h==null?void 0:h.values)==null?void 0:C.length)||0);return f!==0?f:qE(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===io.mapValue&&o===io.mapValue)return 0;if(i===io.mapValue)return 1;if(o===io.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=pv(l[f],h[f]);if(g!==0)return g;const y=Lo(a[l[f]],u[h[f]]);if(y!==0)return y}return $e(l.length,h.length)}(n.mapValue,e.mapValue);default:throw fe(23264,{he:t})}}function zE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return $e(n,e);const t=Ti(n),r=Ti(e),s=$e(t.seconds,r.seconds);return s!==0?s:$e(t.nanos,r.nanos)}function qE(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Lo(t[s],r[s]);if(i)return i}return $e(t.length,r.length)}function Ec(n){return xv(n)}function xv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ti(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return bi(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ne.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=xv(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${xv(t.fields[o])}`;return s+"}"}(n.mapValue):fe(61005,{value:n})}function Yf(n){switch(Do(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=cm(n);return e?16+Yf(e):16;case 5:return 2*n.stringValue.length;case 6:return bi(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Yf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Wo(r.fields,(i,o)=>{s+=i.length+Yf(o)}),s}(n.mapValue);default:throw fe(13486,{value:n})}}function Ma(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Sv(n){return!!n&&"integerValue"in n}function Gd(n){return!!n&&"arrayValue"in n}function WE(n){return!!n&&"nullValue"in n}function GE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Jf(n){return!!n&&"mapValue"in n}function um(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Mw])==null?void 0:r.stringValue)===Ow}function nd(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Wo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=nd(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=nd(n.arrayValue.values[t]);return e}return{...n}}function vk(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===_k}const wk={mapValue:{fields:{[Mw]:{stringValue:Ow},[Sc]:{arrayValue:{}}}}};function b3(n){return"nullValue"in n?Kf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ma(La.empty(),ne.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?um(n)?wk:{mapValue:{}}:fe(35942,{value:n})}function A3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ma(La.empty(),ne.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?wk:"mapValue"in n?um(n)?{mapValue:{}}:io:fe(61959,{value:n})}function HE(n,e){const t=Lo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function QE(n,e){const t=Lo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e){this.value=e}static empty(){return new Hn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Jf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nd(t)}setAll(e){let t=nn.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=nd(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Jf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Zs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Jf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Wo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Hn(nd(this.value))}}function Ik(n){const e=[];return Wo(n.fields,(t,r)=>{const s=new nn([t]);if(Jf(r)){const i=Ik(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ir(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Gt(e,0,Ce.min(),Ce.min(),Ce.min(),Hn.empty(),0)}static newFoundDocument(e,t,r,s){return new Gt(e,1,t,Ce.min(),r,s,0)}static newNoDocument(e,t){return new Gt(e,2,t,Ce.min(),Ce.min(),Hn.empty(),0)}static newUnknownDocument(e,t){return new Gt(e,3,t,Ce.min(),Ce.min(),Hn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ce.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Hn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Hn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Gt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Gt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e,t){this.position=e,this.inclusive=t}}function KE(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ne.comparator(ne.fromName(o.referenceValue),t.key):r=Lo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function YE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Zs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e,t="asc"){this.field=e,this.dir=t}}function C3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{}class ot extends xk{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new R3(e,t,r):t==="array-contains"?new P3(e,r):t==="in"?new Ck(e,r):t==="not-in"?new D3(e,r):t==="array-contains-any"?new L3(e,r):new ot(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new k3(e,r):new N3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Lo(t,this.value)):t!==null&&Do(this.value)===Do(t)&&this.matchesComparison(Lo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return fe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Tt extends xk{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Tt(e,t)}matches(e){return Tc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Tc(n){return n.op==="and"}function Ev(n){return n.op==="or"}function Vw(n){return Sk(n)&&Tc(n)}function Sk(n){for(const e of n.filters)if(e instanceof Tt)return!1;return!0}function Tv(n){if(n instanceof ot)return n.field.canonicalString()+n.op.toString()+Ec(n.value);if(Vw(n))return n.filters.map(e=>Tv(e)).join(",");{const e=n.filters.map(t=>Tv(t)).join(",");return`${n.op}(${e})`}}function Ek(n,e){return n instanceof ot?function(r,s){return s instanceof ot&&r.op===s.op&&r.field.isEqual(s.field)&&Zs(r.value,s.value)}(n,e):n instanceof Tt?function(r,s){return s instanceof Tt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Ek(o,s.filters[a]),!0):!1}(n,e):void fe(19439)}function Tk(n,e){const t=n.filters.concat(e);return Tt.create(t,n.op)}function bk(n){return n instanceof ot?function(t){return`${t.field.canonicalString()} ${t.op} ${Ec(t.value)}`}(n):n instanceof Tt?function(t){return t.op.toString()+" {"+t.getFilters().map(bk).join(" ,")+"}"}(n):"Filter"}class R3 extends ot{constructor(e,t,r){super(e,t,r),this.key=ne.fromName(r.referenceValue)}matches(e){const t=ne.comparator(e.key,this.key);return this.matchesComparison(t)}}class k3 extends ot{constructor(e,t){super(e,"in",t),this.keys=Ak("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class N3 extends ot{constructor(e,t){super(e,"not-in",t),this.keys=Ak("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ak(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>ne.fromName(r.referenceValue))}class P3 extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Gd(t)&&Wd(t.arrayValue,this.value)}}class Ck extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Wd(this.value.arrayValue,t)}}class D3 extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if(Wd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Wd(this.value.arrayValue,t)}}class L3 extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Gd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Wd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function bv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new M3(n,e,t,r,s,i,o)}function Oa(n){const e=re(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Tv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),xh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ec(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ec(r)).join(",")),e.Te=t}return e.Te}function Eh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!C3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ek(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!YE(n.startAt,e.startAt)&&YE(n.endAt,e.endAt)}function ep(n){return ne.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function tp(n,e){return n.filters.filter(t=>t instanceof ot&&t.field.isEqual(e))}function JE(n,e,t){let r=Kf,s=!0;for(const i of tp(n,e)){let o=Kf,a=!0;switch(i.op){case"<":case"<=":o=b3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Kf}HE({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];HE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function XE(n,e,t){let r=io,s=!0;for(const i of tp(n,e)){let o=io,a=!0;switch(i.op){case">=":case">":o=A3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=io}QE({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];QE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Rk(n,e,t,r,s,i,o,a){return new Pi(n,e,t,r,s,i,o,a)}function qc(n){return new Pi(n)}function ZE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Fw(n){return n.collectionGroup!==null}function Kl(n){const e=re(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new At(nn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Hd(i,r))}),t.has(nn.keyField().canonicalString())||e.Ie.push(new Hd(nn.keyField(),r))}return e.Ie}function ar(n){const e=re(n);return e.Ee||(e.Ee=Nk(e,Kl(n))),e.Ee}function kk(n){const e=re(n);return e.de||(e.de=Nk(e,n.explicitOrderBy)),e.de}function Nk(n,e){if(n.limitType==="F")return bv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Hd(s.field,i)});const t=n.endAt?new Mo(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Mo(n.startAt.position,n.startAt.inclusive):null;return bv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Av(n,e){const t=n.filters.concat([e]);return new Pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function np(n,e,t){return new Pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Th(n,e){return Eh(ar(n),ar(e))&&n.limitType===e.limitType}function Pk(n){return`${Oa(ar(n))}|lt:${n.limitType}`}function El(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>bk(s)).join(", ")}]`),xh(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ec(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ec(s)).join(",")),`Target(${r})`}(ar(n))}; limitType=${n.limitType})`}function bh(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ne.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Kl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=KE(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Kl(r),s)||r.endAt&&!function(o,a,l){const u=KE(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Kl(r),s))}(n,e)}function Dk(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Lk(n){return(e,t)=>{let r=!1;for(const s of Kl(n)){const i=O3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function O3(n,e,t){const r=n.field.isKeyField()?ne.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Lo(l,u):fe(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return fe(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Wo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return hk(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V3=new Bt(ne.comparator);function xr(){return V3}const Mk=new Bt(ne.comparator);function Lu(...n){let e=Mk;for(const t of n)e=e.insert(t.key,t);return e}function Ok(n){let e=Mk;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Bs(){return rd()}function Vk(){return rd()}function rd(){return new Di(n=>n.toString(),(n,e)=>n.isEqual(e))}const F3=new Bt(ne.comparator),j3=new At(ne.comparator);function Ge(...n){let e=j3;for(const t of n)e=e.add(t);return e}const U3=new At($e);function jw(){return U3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jd(e)?"-0":e}}function Fk(n){return{integerValue:""+n}}function jk(n,e){return ek(e)?Fk(e):Uw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dm{constructor(){this._=void 0}}function $3(n,e,t){return n instanceof bc?function(s,i){const o={fields:{[pk]:{stringValue:gk},[yk]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&lm(i)&&(i=cm(i)),i&&(o.fields[mk]=i),{mapValue:o}}(t,e):n instanceof Va?$k(n,e):n instanceof Fa?Bk(n,e):function(s,i){const o=Uk(s,i),a=eT(o)+eT(s.Ae);return Sv(o)&&Sv(s.Ae)?Fk(a):Uw(s.serializer,a)}(n,e)}function B3(n,e,t){return n instanceof Va?$k(n,e):n instanceof Fa?Bk(n,e):t}function Uk(n,e){return n instanceof Ac?function(r){return Sv(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class bc extends dm{}class Va extends dm{constructor(e){super(),this.elements=e}}function $k(n,e){const t=zk(e);for(const r of n.elements)t.some(s=>Zs(s,r))||t.push(r);return{arrayValue:{values:t}}}class Fa extends dm{constructor(e){super(),this.elements=e}}function Bk(n,e){let t=zk(e);for(const r of n.elements)t=t.filter(s=>!Zs(s,r));return{arrayValue:{values:t}}}class Ac extends dm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function eT(n){return Xt(n.integerValue||n.doubleValue)}function zk(n){return Gd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,t){this.field=e,this.transform=t}}function z3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Va&&s instanceof Va||r instanceof Fa&&s instanceof Fa?pc(r.elements,s.elements,Zs):r instanceof Ac&&s instanceof Ac?Zs(r.Ae,s.Ae):r instanceof bc&&s instanceof bc}(n.transform,e.transform)}class q3{constructor(e,t){this.version=e,this.transformResults=t}}class rn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rn}static exists(e){return new rn(void 0,e)}static updateTime(e){return new rn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class hm{}function qk(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Gc(n.key,rn.none()):new Wc(n.key,n.data,rn.none());{const t=n.data,r=Hn.empty();let s=new At(nn.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Li(n.key,r,new Ir(s.toArray()),rn.none())}}function W3(n,e,t){n instanceof Wc?function(s,i,o){const a=s.value.clone(),l=nT(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Li?function(s,i,o){if(!Xf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=nT(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Wk(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function sd(n,e,t,r){return n instanceof Wc?function(i,o,a,l){if(!Xf(i.precondition,o))return a;const u=i.value.clone(),h=rT(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Li?function(i,o,a,l){if(!Xf(i.precondition,o))return a;const u=rT(i.fieldTransforms,l,o),h=o.data;return h.setAll(Wk(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Xf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function G3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Uk(r.transform,s||null);i!=null&&(t===null&&(t=Hn.empty()),t.set(r.field,i))}return t||null}function tT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&pc(r,s,(i,o)=>z3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Wc extends hm{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Li extends hm{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Wk(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function nT(n,e,t){const r=new Map;xe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,B3(o,a,t[s]))}return r}function rT(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,$3(i,o,e))}return r}class Gc extends hm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $w extends hm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&W3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=sd(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=sd(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Vk();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=qk(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ce.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ge())}isEqual(e){return this.batchId===e.batchId&&pc(this.mutations,e.mutations,(t,r)=>tT(t,r))&&pc(this.baseMutations,e.baseMutations,(t,r)=>tT(t,r))}}class zw{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){xe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return F3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new zw(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var In,ct;function Hk(n){switch(n){case F.OK:return fe(64938);case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0;default:return fe(15467,{code:n})}}function Qk(n){if(n===void 0)return yn("GRPC error has no .code"),F.UNKNOWN;switch(n){case In.OK:return F.OK;case In.CANCELLED:return F.CANCELLED;case In.UNKNOWN:return F.UNKNOWN;case In.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case In.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case In.INTERNAL:return F.INTERNAL;case In.UNAVAILABLE:return F.UNAVAILABLE;case In.UNAUTHENTICATED:return F.UNAUTHENTICATED;case In.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case In.NOT_FOUND:return F.NOT_FOUND;case In.ALREADY_EXISTS:return F.ALREADY_EXISTS;case In.PERMISSION_DENIED:return F.PERMISSION_DENIED;case In.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case In.ABORTED:return F.ABORTED;case In.OUT_OF_RANGE:return F.OUT_OF_RANGE;case In.UNIMPLEMENTED:return F.UNIMPLEMENTED;case In.DATA_LOSS:return F.DATA_LOSS;default:return fe(39323,{code:n})}}(ct=In||(In={}))[ct.OK=0]="OK",ct[ct.CANCELLED=1]="CANCELLED",ct[ct.UNKNOWN=2]="UNKNOWN",ct[ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ct[ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ct[ct.NOT_FOUND=5]="NOT_FOUND",ct[ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",ct[ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",ct[ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",ct[ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ct[ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ct[ct.ABORTED=10]="ABORTED",ct[ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",ct[ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",ct[ct.INTERNAL=13]="INTERNAL",ct[ct.UNAVAILABLE=14]="UNAVAILABLE",ct[ct.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let id=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kk(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q3=new xo([4294967295,4294967295],0);function sT(n){const e=Kk().encode(n),t=new FR;return t.update(e),new Uint8Array(t.digest())}function iT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new xo([t,r],0),new xo([s,i],0)]}class Ww{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Mu(`Invalid padding: ${t}`);if(r<0)throw new Mu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Mu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Mu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=xo.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(xo.fromNumber(r)));return s.compare(Q3)===1&&(s=new xo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=sT(e),[r,s]=iT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Ww(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=sT(e),[r,s]=iT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Mu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Rh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ch(Ce.min(),s,new Bt($e),xr(),Ge())}}class Rh{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Rh(r,t,Ge(),Ge(),Ge())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Yk{constructor(e,t){this.targetId=e,this.Ce=t}}class Jk{constructor(e,t,r=fn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class oT{constructor(){this.ve=0,this.Fe=aT(),this.Me=fn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ge(),t=Ge(),r=Ge();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:fe(38017,{changeType:i})}}),new Rh(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=aT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,xe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class K3{constructor(e){this.Ge=e,this.ze=new Map,this.je=xr(),this.Je=If(),this.He=If(),this.Ye=new Bt($e)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:fe(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(ep(i))if(r===0){const o=new ne(i.path);this.et(t,o,Gt.newNoDocument(o,Ce.min()))}else xe(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}id==null||id.lt(function(h,f,g,y,_){var T,x,k;const C={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},N=f.unchangedNames;return N&&(C.bloomFilter={applied:_===0,hashCount:(N==null?void 0:N.hashCount)??0,bitmapLength:((x=(T=N==null?void 0:N.bits)==null?void 0:T.bitmap)==null?void 0:x.length)??0,padding:((k=N==null?void 0:N.bits)==null?void 0:k.padding)??0,mightContain:P=>(y==null?void 0:y.mightContain(P))??!1}),C}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=bi(r).toUint8Array()}catch(l){if(l instanceof fk)return as("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Ww(o,s,i)}catch(l){return as(l instanceof Mu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&ep(a.target)){const l=new ne(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Gt.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=Ge();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Ch(e,t,this.Ye,this.je,r);return this.je=xr(),this.Je=If(),this.He=If(),this.Ye=new Bt($e),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new oT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new At($e),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new At($e),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Q("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new oT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function If(){return new Bt(ne.comparator)}function aT(){return new Bt(ne.comparator)}const Y3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),J3=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),X3=(()=>({and:"AND",or:"OR"}))();class Z3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Cv(n,e){return n.useProto3Json||xh(e)?e:{value:e}}function Cc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Xk(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function e5(n,e){return Cc(n,e.toTimestamp())}function _n(n){return xe(!!n,49232),Ce.fromTimestamp(function(t){const r=Ti(t);return new _t(r.seconds,r.nanos)}(n))}function Gw(n,e){return Rv(n,e).canonicalString()}function Rv(n,e){const t=function(s){return new nt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Zk(n){const e=nt.fromString(n);return xe(lN(e),10190,{key:e.toString()}),e}function Qd(n,e){return Gw(n.databaseId,e.path)}function Qs(n,e){const t=Zk(e);if(t.get(1)!==n.databaseId.projectId)throw new q(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ne(nN(t))}function eN(n,e){return Gw(n.databaseId,e)}function tN(n){const e=Zk(n);return e.length===4?nt.emptyPath():nN(e)}function kv(n){return new nt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function nN(n){return xe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function lT(n,e,t){return{name:Qd(n,e),fields:t.value.mapValue.fields}}function fm(n,e,t){const r=Qs(n,e.name),s=_n(e.updateTime),i=e.createTime?_n(e.createTime):Ce.min(),o=new Hn({mapValue:{fields:e.fields}}),a=Gt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function t5(n,e){return"found"in e?function(r,s){xe(!!s.found,43571),s.found.name,s.found.updateTime;const i=Qs(r,s.found.name),o=_n(s.found.updateTime),a=s.found.createTime?_n(s.found.createTime):Ce.min(),l=new Hn({mapValue:{fields:s.found.fields}});return Gt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){xe(!!s.missing,3894),xe(!!s.readTime,22933);const i=Qs(r,s.missing),o=_n(s.readTime);return Gt.newNoDocument(i,o)}(n,e):fe(7234,{result:e})}function n5(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:fe(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(xe(h===void 0||typeof h=="string",58123),fn.fromBase64String(h||"")):(xe(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),fn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?F.UNKNOWN:Qk(u.code);return new q(h,u.message||"")}(o);t=new Jk(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Qs(n,r.document.name),i=_n(r.document.updateTime),o=r.document.createTime?_n(r.document.createTime):Ce.min(),a=new Hn({mapValue:{fields:r.document.fields}}),l=Gt.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new Zf(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Qs(n,r.document),i=r.readTime?_n(r.readTime):Ce.min(),o=Gt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Zf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Qs(n,r.document),i=r.removedTargetIds||[];t=new Zf([],i,s,null)}else{if(!("filter"in e))return fe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new H3(s,i),a=r.targetId;t=new Yk(a,o)}}return t}function Kd(n,e){let t;if(e instanceof Wc)t={update:lT(n,e.key,e.value)};else if(e instanceof Gc)t={delete:Qd(n,e.key)};else if(e instanceof Li)t={update:lT(n,e.key,e.data),updateMask:l5(e.fieldMask)};else{if(!(e instanceof $w))return fe(16599,{Vt:e.type});t={verify:Qd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof bc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Va)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Fa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ac)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw fe(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:e5(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:fe(27497)}(n,e.precondition)),t}function Nv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?rn.updateTime(_n(i.updateTime)):i.exists!==void 0?rn.exists(i.exists):rn.none()}(e.currentDocument):rn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)xe(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new bc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Va(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Fa(h)}else"increment"in a?l=new Ac(o,a.increment):fe(16584,{proto:a});const u=nn.fromServerFormat(a.fieldPath);return new Ah(u,l)}(n,s)):[];if(e.update){e.update.name;const s=Qs(n,e.update.name),i=new Hn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new Ir(u.map(h=>nn.fromServerFormat(h)))}(e.updateMask);return new Li(s,i,o,t,r)}return new Wc(s,i,t,r)}if(e.delete){const s=Qs(n,e.delete);return new Gc(s,t)}if(e.verify){const s=Qs(n,e.verify);return new $w(s,t)}return fe(1463,{proto:e})}function r5(n,e){return n&&n.length>0?(xe(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?_n(s.updateTime):_n(i);return o.isEqual(Ce.min())&&(o=_n(i)),new q3(o,s.transformResults||[])}(t,e))):[]}function rN(n,e){return{documents:[eN(n,e.path)]}}function gm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=eN(n,s);const i=function(u){if(u.length!==0)return aN(Tt.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(g){return{field:Yi(g.field),direction:i5(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Cv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function sN(n,e,t,r){const{ft:s,parent:i}=gm(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Yi(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Yi(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function iN(n){let e=tN(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){xe(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=oN(f);return g instanceof Tt&&Vw(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(_){return new Hd(Tl(_.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,xh(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new Mo(y,g)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const g=!f.before,y=f.values||[];return new Mo(y,g)}(t.endAt)),Rk(e,s,o,i,a,"F",l,u)}function s5(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fe(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function oN(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Tl(t.unaryFilter.field);return ot.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Tl(t.unaryFilter.field);return ot.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Tl(t.unaryFilter.field);return ot.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Tl(t.unaryFilter.field);return ot.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fe(61313);default:return fe(60726)}}(n):n.fieldFilter!==void 0?function(t){return ot.create(Tl(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fe(58110);default:return fe(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Tt.create(t.compositeFilter.filters.map(r=>oN(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return fe(1026)}}(t.compositeFilter.op))}(n):fe(30097,{filter:n})}function i5(n){return Y3[n]}function o5(n){return J3[n]}function a5(n){return X3[n]}function Yi(n){return{fieldPath:n.canonicalString()}}function Tl(n){return nn.fromServerFormat(n.fieldPath)}function aN(n){return n instanceof ot?function(t){if(t.op==="=="){if(GE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NAN"}};if(WE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(GE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NOT_NAN"}};if(WE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yi(t.field),op:o5(t.op),value:t.value}}}(n):n instanceof Tt?function(t){const r=t.getFilters().map(s=>aN(s));return r.length===1?r[0]:{compositeFilter:{op:a5(t.op),filters:r}}}(n):fe(54877,{filter:n})}function l5(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function lN(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,t,r,s,i=Ce.min(),o=Ce.min(),a=fn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new gi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new gi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(e){this.yt=e}}function c5(n,e){let t;if(e.document)t=fm(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ne.fromSegments(e.noDocument.path),s=Ua(e.noDocument.readTime);t=Gt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return fe(56709);{const r=ne.fromSegments(e.unknownDocument.path),s=Ua(e.unknownDocument.version);t=Gt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new _t(s[0],s[1]);return Ce.fromTimestamp(i)}(e.readTime)),t}function cT(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:rp(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Qd(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Cc(i,o.version.toTimestamp()),createTime:Cc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ja(e.version)};else{if(!e.isUnknownDocument())return fe(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:ja(e.version)}}return r}function rp(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ja(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ua(n){const e=new _t(n.seconds,n.nanoseconds);return Ce.fromTimestamp(e)}function aa(n,e){const t=(e.baseMutations||[]).map(i=>Nv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Nv(n.yt,i)),s=_t.fromMillis(e.localWriteTimeMs);return new Bw(e.batchId,s,t,r)}function Ou(n){const e=Ua(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ua(n.lastLimboFreeSnapshotVersion):Ce.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return xe(o===1,1966,{count:o}),ar(qc(tN(i.documents[0])))}(n.query):function(i){return ar(iN(i))}(n.query),new gi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,fn.fromBase64String(n.resumeToken))}function uN(n,e){const t=ja(e.snapshotVersion),r=ja(e.lastLimboFreeSnapshotVersion);let s;s=ep(e.target)?rN(n.yt,e.target):gm(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Oa(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function pm(n){const e=iN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?np(e,e.limit,"L"):e}function Dy(n,e){return new qw(e.largestBatchId,Nv(n.yt,e.overlayMutation))}function uT(n,e){const t=e.path.lastSegment();return[n,or(e.path.popLast()),t]}function dT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ja(r.readTime),documentKey:or(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{getBundleMetadata(e,t){return hT(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Ua(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return hT(e).put(function(s){return{bundleId:s.id,createTime:ja(_n(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return fT(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:pm(i.bundledQuery),readTime:Ua(i.readTime)}}(r)})}saveNamedQuery(e,t){return fT(e).put(function(s){return{name:s.name,readTime:ja(_n(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function hT(n){return Rn(n,im)}function fT(n){return Rn(n,om)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new mm(e,r)}getOverlay(e,t){return wu(e).get(uT(this.userId,t)).next(r=>r?Dy(this.serializer,r):null)}getOverlays(e,t){const r=Bs();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new qw(t,o);s.push(this.St(e,a))}),V.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(or(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(wu(e).Z(wv,a))}),V.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Bs(),i=or(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return wu(e).J(wv,o).next(a=>{for(const l of a){const u=Dy(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Bs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return wu(e).ee({index:ok,range:a},(l,u,h)=>{const f=Dy(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return wu(e).put(function(s,i,o){const[a,l,u]=uT(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Kd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function wu(n){return Rn(n,am)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5{bt(e){return Rn(e,Dw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?fn.fromUint8Array(r):fn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Xt(e.integerValue));else if("doubleValue"in e){const r=Xt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),jd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ti(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(bi(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?vk(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):um(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):fe(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=Sc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(Xt(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),ne.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}la.Kt=new la;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vl=255;function h5(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function gT(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=h5(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class f5{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=gT(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=gT(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(vl),this.sn(255)}_n(){this.an(vl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===vl?(this.sn(vl),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===vl?(this.an(vl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class g5{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class p5{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Iu{constructor(){this.cn=new f5,this.ln=new g5(this.cn),this.hn=new p5(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new ca(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:eg(this.En),directionalValue:eg(this.dn),orderedDocumentKey:eg(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Bi(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=pT(n.En,e.En),t!==0?t:(t=pT(n.dn,e.dn),t!==0?t:ne.comparator(n.In,e.In)))}function pT(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function eg(n){return l1()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function mT(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class yT{constructor(e){this.mn=new At((t,r)=>nn.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(xe(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=yv(e);if(t!==void 0&&!this.wn(t))return!1;const r=sa(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new At(nn.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new wa(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new wa(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new wa(r.field,r.dir==="asc"?0:1)));return new yc(yc.UNKNOWN_ID,this.collectionId,t,_c.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dN(n){var t,r;if(xe(n instanceof ot||n instanceof Tt,20012),n instanceof ot){if(n instanceof Ck){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>ot.create(n.field,"==",i)))||[];return Tt.create(s,"or")}return n}const e=n.filters.map(s=>dN(s));return Tt.create(e,n.op)}function m5(n){if(n.getFilters().length===0)return[];const e=Lv(dN(n));return xe(hN(e),7391),Pv(e)||Dv(e)?[e]:e.getFilters()}function Pv(n){return n instanceof ot}function Dv(n){return n instanceof Tt&&Vw(n)}function hN(n){return Pv(n)||Dv(n)||function(t){if(t instanceof Tt&&Ev(t)){for(const r of t.getFilters())if(!Pv(r)&&!Dv(r))return!1;return!0}return!1}(n)}function Lv(n){if(xe(n instanceof ot||n instanceof Tt,34018),n instanceof ot)return n;if(n.filters.length===1)return Lv(n.filters[0]);const e=n.filters.map(r=>Lv(r));let t=Tt.create(e,n.op);return t=sp(t),hN(t)?t:(xe(t instanceof Tt,64498),xe(Tc(t),40251),xe(t.filters.length>1,57927),t.filters.reduce((r,s)=>Hw(r,s)))}function Hw(n,e){let t;return xe(n instanceof ot||n instanceof Tt,38388),xe(e instanceof ot||e instanceof Tt,25473),t=n instanceof ot?e instanceof ot?function(s,i){return Tt.create([s,i],"and")}(n,e):_T(n,e):e instanceof ot?_T(e,n):function(s,i){if(xe(s.filters.length>0&&i.filters.length>0,48005),Tc(s)&&Tc(i))return Tk(s,i.getFilters());const o=Ev(s)?s:i,a=Ev(s)?i:s,l=o.filters.map(u=>Hw(u,a));return Tt.create(l,"or")}(n,e),sp(t)}function _T(n,e){if(Tc(e))return Tk(e,n.getFilters());{const t=e.filters.map(r=>Hw(n,r));return Tt.create(t,"or")}}function sp(n){if(xe(n instanceof ot||n instanceof Tt,11850),n instanceof ot)return n;const e=n.getFilters();if(e.length===1)return sp(e[0]);if(Sk(n))return n;const t=e.map(s=>sp(s)),r=[];return t.forEach(s=>{s instanceof ot?r.push(s):s instanceof Tt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Tt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(){this.Cn=new Qw}addToCollectionParentIndex(e,t){return this.Cn.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(Gr.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(Gr.min())}updateCollectionGroup(e,t,r){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class Qw{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new At(nt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new At(nt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vT="IndexedDbIndexManager",xf=new Uint8Array(0);class _5{constructor(e,t){this.databaseId=t,this.vn=new Qw,this.Fn=new Di(r=>Oa(r),(r,s)=>Eh(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:or(s)};return wT(e).put(i)}return V.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[GR(t),""],!1,!0);return wT(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push($s(o.parent))}return r})}addFieldIndex(e,t){const r=xu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Il(e);return i.next(a=>{o.put(dT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=xu(e),s=Il(e),i=wl(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=xu(e),r=wl(e),s=Il(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return V.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new yT(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=wl(e);let s=!0;const i=new Map;return V.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ge();const a=[];return V.forEach(i,(l,u)=>{Q(vT,`Using index ${function(k){return`id=${k.indexId}|cg=${k.collectionGroup}|f=${k.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(l)} to execute ${Oa(t)}`);const h=function(k,P){const $=yv(P);if($===void 0)return null;for(const j of tp(k,$.fieldPath))switch(j.op){case"array-contains-any":return j.value.arrayValue.values||[];case"array-contains":return[j.value]}return null}(u,l),f=function(k,P){const $=new Map;for(const j of sa(P))for(const R of tp(k,j.fieldPath))switch(R.op){case"==":case"in":$.set(j.fieldPath.canonicalString(),R.value);break;case"not-in":case"!=":return $.set(j.fieldPath.canonicalString(),R.value),Array.from($.values())}return null}(u,l),g=function(k,P){const $=[];let j=!0;for(const R of sa(P)){const S=R.kind===0?JE(k,R.fieldPath,k.startAt):XE(k,R.fieldPath,k.startAt);$.push(S.value),j&&(j=S.inclusive)}return new Mo($,j)}(u,l),y=function(k,P){const $=[];let j=!0;for(const R of sa(P)){const S=R.kind===0?XE(k,R.fieldPath,k.endAt):JE(k,R.fieldPath,k.endAt);$.push(S.value),j&&(j=S.inclusive)}return new Mo($,j)}(u,l),_=this.On(l,u,g),C=this.On(l,u,y),N=this.Nn(l,u,f),T=this.Bn(l.indexId,h,_,g.inclusive,C,y.inclusive,N);return V.forEach(T,x=>r.Y(x,t.limit).next(k=>{k.forEach(P=>{const $=ne.fromSegments(P.documentKey);o.has($)||(o=o.add($),a.push($))})}))}).next(()=>a)}return V.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=m5(Tt.create(e.filters,"and")).map(r=>bv(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.Ln(t[f/u]):xf,y=this.kn(e,g,r[f%u],s),_=this.qn(e,g,i[f%u],o),C=a.map(N=>this.kn(e,g,N,!0));h.push(...this.createRange(y,_,C))}return h}kn(e,t,r,s){const i=new ca(e,ne.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new ca(e,ne.empty(),t,r);return s?i.An():i}xn(e,t){const r=new yT(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return V.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new At(nn.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:u=u.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new Iu;for(const s of sa(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);la.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new Iu;return la.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new Iu;return la.Kt.Dt(Ma(this.databaseId,t),r.Pn(function(i){const o=sa(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new Iu);let i=0;for(const o of sa(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&Gd(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);la.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Iu;l.seed(a.un()),la.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof ot&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=xu(e),s=Il(e);return(t?r.J(vv,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return V.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new _c(f.sequenceNumber,new Gr(Ua(f.readTime),new ne($s(f.documentKey)),f.largestBatchId)):_c.empty(),y=h.fields.map(([_,C])=>new wa(nn.fromServerFormat(_),C));return new yc(h.indexId,h.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:$e(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=xu(e),i=Il(e);return this.Gn(e).next(o=>s.J(vv,IDBKeyRange.bound(t,t)).next(a=>V.forEach(a,l=>i.put(dT(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return V.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?V.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),V.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?V.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return wl(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return wl(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=wl(e);let i=new At(Bi);return s.ee({index:ik,range:IDBKeyRange.only([r.indexId,this.uid,eg(this.$n(r,t))])},(o,a)=>{i=i.add(new ca(r.indexId,t,mT(a.arrayValue),mT(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new At(Bi);const s=this.Qn(t,e);if(s==null)return r;const i=yv(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Gd(o))for(const a of o.arrayValue.values||[])r=r.add(new ca(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new ca(t.indexId,e.key,xf,s));return r}Jn(e,t,r,s,i){Q(vT,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,g){const y=l.getIterator(),_=u.getIterator();let C=_l(y),N=_l(_);for(;C||N;){let T=!1,x=!1;if(C&&N){const k=h(C,N);k<0?x=!0:k>0&&(T=!0)}else C!=null?x=!0:T=!0;T?(f(N),N=_l(_)):x?(g(C),C=_l(y)):(C=_l(y),N=_l(_))}}(s,i,Bi,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),V.waitFor(o)}Gn(e){let t=1;return Il(e).ee({index:sk,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Bi(o,a)).filter((o,a,l)=>!a||Bi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Bi(o,e),l=Bi(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,xf,ne.empty()),l=s[o+1].Vn(this.uid,xf,ne.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return Bi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(IT)}getMinOffset(e,t){return V.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||fe(44426))).next(IT)}}function wT(n){return Rn(n,Bd)}function wl(n){return Rn(n,td)}function xu(n){return Rn(n,Pw)}function Il(n){return Rn(n,ed)}function IT(n){xe(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Rw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Gr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},fN=41943040;class rr{static withCacheSize(e){return new rr(e,rr.DEFAULT_COLLECTION_PERCENTILE,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gN(n,e,t){const r=n.store(ms),s=n.store(vc),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{xe(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=tk(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return V.waitFor(i).next(()=>u)}function ip(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw fe(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rr.DEFAULT_COLLECTION_PERCENTILE=10,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rr.DEFAULT=new rr(fN,rr.DEFAULT_COLLECTION_PERCENTILE,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rr.DISABLED=new rr(-1,0,0);class ym{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){xe(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new ym(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zi(e).ee({index:ga,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=bl(e),o=zi(e);return o.add({}).next(a=>{xe(typeof a=="number",49019);const l=new Bw(a,t,r,s),u=function(y,_,C){const N=C.baseMutations.map(x=>Kd(y.yt,x)),T=C.mutations.map(x=>Kd(y.yt,x));return{userId:_,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:N,mutations:T}}(this.serializer,this.userId,l),h=[];let f=new At((g,y)=>$e(g.canonicalString(),y.canonicalString()));for(const g of s){const y=tk(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,e3))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),V.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return zi(e).get(t).next(r=>r?(xe(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),aa(this.serializer,r)):null)}er(e,t){return this.Xn[t]?V.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return zi(e).ee({index:ga,range:s},(o,a,l)=>{a.userId===this.userId&&(xe(a.batchId>=r,47524,{tr:r}),i=aa(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=So;return zi(e).ee({index:ga,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,So],[this.userId,Number.POSITIVE_INFINITY]);return zi(e).J(ga,t).next(r=>r.map(s=>aa(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Hf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return bl(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,g=$s(h);if(u===this.userId&&t.path.isEqual(g))return zi(e).get(f).next(y=>{if(!y)throw fe(61480,{nr:o,batchId:f});xe(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(aa(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new At($e);const s=[];return t.forEach(i=>{const o=Hf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=bl(e).ee({range:a},(u,h,f)=>{const[g,y,_]=u,C=$s(y);g===this.userId&&i.path.isEqual(C)?r=r.add(_):f.done()});s.push(l)}),V.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Hf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new At($e);return bl(e).ee({range:o},(l,u,h)=>{const[f,g,y]=l,_=$s(g);f===this.userId&&r.isPrefixOf(_)?_.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(zi(e).get(i).next(o=>{if(o===null)throw fe(35274,{batchId:i});xe(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(aa(this.serializer,o))}))}),V.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return gN(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),V.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return V.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return bl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=$s(i[1]);s.push(l)}else a.done()}).next(()=>{xe(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return pN(e,this.userId,t)}_r(e){return mN(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:So,lastStreamToken:""})}}function pN(n,e,t){const r=Hf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return bl(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function zi(n){return Rn(n,ms)}function bl(n){return Rn(n,vc)}function mN(n){return Rn(n,Ud)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new $a(0)}static cr(){return new $a(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new $a(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>Ce.fromTimestamp(new _t(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>xl(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(xe(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return xl(e).ee((o,a)=>{const l=Ou(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>V.waitFor(i)).next(()=>s)}forEachTarget(e,t){return xl(e).ee((r,s)=>{const i=Ou(s);t(i)})}lr(e){return ST(e).get(Zg).next(t=>(xe(t!==null,2888),t))}hr(e,t){return ST(e).put(Zg,t)}Pr(e,t){return xl(e).put(uN(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Oa(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return xl(e).ee({range:s,index:rk},(o,a,l)=>{const u=Ou(a);Eh(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ji(e);return t.forEach(o=>{const a=or(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),V.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ji(e);return V.forEach(t,i=>{const o=or(i.path);return V.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ji(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ji(e);let i=Ge();return s.ee({range:r,X:!0},(o,a,l)=>{const u=$s(o[1]),h=new ne(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=or(t.path),s=IDBKeyRange.bound([r],[GR(r)],!1,!0);let i=0;return Ji(e).ee({index:Nw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return xl(e).get(t).next(r=>r?Ou(r):null)}}function xl(n){return Rn(n,wc)}function ST(n){return Rn(n,Ia)}function Ji(n){return Rn(n,Ic)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ET="LruGarbageCollector",yN=1048576;function TT([n,e],[t,r]){const s=$e(n,t);return s===0?$e(e,r):s}class w5{constructor(e){this.Ir=e,this.buffer=new At(TT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();TT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class _N{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Q(ET,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){qo(t)?Q(ET,"Ignoring IndexedDB error during garbage collection: ",t):await zo(t)}await this.Vr(3e5)})}}class I5{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return V.resolve(wr.ce);const r=new w5(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Q("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(xT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xT):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(Q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),Sl()<=rt.DEBUG&&Q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function vN(n,e){return new I5(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5{constructor(e,t){this.db=e,this.garbageCollector=vN(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Sf(e,r)}removeReference(e,t,r){return Sf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Sf(e,t)}br(e,t){return function(s,i){let o=!1;return mN(s).te(a=>pN(s,a,i).next(l=>(l&&(o=!0),V.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ce.min()),Ji(e).delete(function(f){return[0,or(f.path)]}(o))))});s.push(l)}}).next(()=>V.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Sf(e,t)}Sr(e,t){const r=Ji(e);let s,i=wr.ce;return r.ee({index:Nw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==wr.ce&&t(new ne($s(s)),i),i=u,s=l):i=wr.ce}).next(()=>{i!==wr.ce&&t(new ne($s(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Sf(n,e){return Ji(n).put(function(r,s){return{targetId:0,path:or(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wN{constructor(){this.changes=new Di(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Gt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?V.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S5{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Zo(e).put(r)}removeEntry(e,t,r){return Zo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],rp(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Gt.newInvalidDocument(t);return Zo(e).ee({index:Qf,range:IDBKeyRange.only(Su(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Gt.newInvalidDocument(t)};return Zo(e).ee({index:Qf,range:IDBKeyRange.only(Su(t))},(s,i)=>{r={document:this.Cr(t,i),size:ip(i)}}).next(()=>r)}getEntries(e,t){let r=xr();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=xr(),s=new Bt(ne.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,ip(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return V.resolve();let s=new At(CT);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Su(s.first()),Su(s.last())),o=s.getIterator();let a=o.getNext();return Zo(e).ee({index:Qf,range:i},(l,u,h)=>{const f=ne.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&CT(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(Su(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),rp(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Zo(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=xr();for(const f of u){const g=this.Cr(ne.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(bh(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=xr();const o=AT(t,r),a=AT(t,Gr.max());return Zo(e).ee({index:nk,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(ne.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new E5(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return bT(e).get(_v).next(t=>(xe(!!t,20021),t))}Dr(e,t){return bT(e).put(_v,t)}Cr(e,t){if(t){const r=c5(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ce.min())))return r}return Gt.newInvalidDocument(e)}}function IN(n){return new S5(n)}class E5 extends wN{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Di(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new At((i,o)=>$e(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=cT(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=ip(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=cT(this.Nr.serializer,o.convertToNoDocument(Ce.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),V.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function bT(n){return Rn(n,$d)}function Zo(n){return Rn(n,Xg)}function Su(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function AT(n,e){const t=e.documentKey.path.toArray();return[n,rp(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function CT(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=$e(t[i],r[i]),s)return s;return s=$e(t.length,r.length),s||(s=$e(t[t.length-2],r[r.length-2]),s||$e(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&sd(r.mutation,s,Ir.empty(),_t.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ge()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ge()){const s=Bs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Lu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Bs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ge()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=xr();const o=rd(),a=function(){return rd()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Li)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),sd(h.mutation,u,h.mutation.getFieldMask(),_t.now())):o.set(u.key,Ir.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new T5(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=rd();let s=new Bt((o,a)=>o-a),i=Ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||Ir.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||Ge()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=Vk();h.forEach(g=>{if(!i.has(g)){const y=qk(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return V.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ne.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Fw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):V.resolve(Bs());let a=mc,l=i;return o.next(u=>V.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?V.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,Ge())).next(h=>({batchId:a,changes:Ok(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ne(t)).next(r=>{let s=Lu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Lu();return this.indexManager.getCollectionParents(e,i).next(a=>V.forEach(a,l=>{const u=function(f,g){return new Pi(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Gt.newInvalidDocument(h)))});let a=Lu();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&sd(h.mutation,u,Ir.empty(),_t.now()),bh(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return V.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:_n(s.createTime)}}(t)),V.resolve()}getNamedQuery(e,t){return V.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:pm(s.bundledQuery),readTime:_n(s.readTime)}}(t)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(){this.overlays=new Bt(ne.comparator),this.qr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Bs();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),V.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),V.resolve()}getOverlaysForCollection(e,t,r){const s=Bs(),i=t.length+1,o=new ne(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return V.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Bt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Bs(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Bs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return V.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new qw(t,r));let i=this.qr.get(t);i===void 0&&(i=Ge(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(){this.sessionToken=fn.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(){this.Qr=new At(Nn.$r),this.Ur=new At(Nn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Nn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Nn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new ne(new nt([])),r=new Nn(t,e),s=new Nn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ne(new nt([])),r=new Nn(t,e),s=new Nn(t,e+1);let i=Ge();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Nn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Nn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ne.comparator(e.key,t.key)||$e(e.Yr,t.Yr)}static Kr(e,t){return $e(e.Yr,t.Yr)||ne.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new At(Nn.$r)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Bw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Nn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,t){return V.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return V.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?So:this.tr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Nn(t,0),s=new Nn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),V.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new At($e);return t.forEach(s=>{const i=new Nn(s,0),o=new Nn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),V.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ne.isDocumentKey(i)||(i=i.child(""));const o=new Nn(new ne(i),0);let a=new At($e);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),V.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){xe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return V.forEach(t.mutations,s=>{const i=new Nn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new Nn(t,0),s=this.Zr.firstAfterOrEqual(r);return V.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k5{constructor(e){this.ri=e,this.docs=function(){return new Bt(ne.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return V.resolve(r?r.document.mutableCopy():Gt.newInvalidDocument(t))}getEntries(e,t){let r=xr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Gt.newInvalidDocument(s))}),V.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=xr();const o=t.path,a=new ne(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Rw(YR(h),r)<=0||(s.has(h.key)||bh(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return V.resolve(i)}getAllFromCollectionGroup(e,t,r,s){fe(9500)}ii(e,t){return V.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new N5(this)}getSize(e){return V.resolve(this.size)}}class N5 extends wN{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),V.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{constructor(e){this.persistence=e,this.si=new Di(t=>Oa(t),Eh),this.lastRemoteSnapshotVersion=Ce.min(),this.highestTargetId=0,this.oi=0,this._i=new Kw,this.targetCount=0,this.ai=$a.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),V.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new $a(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Pr(t),V.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),V.waitFor(i).next(()=>s)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return V.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),V.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),V.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return V.resolve(r)}containsKey(e,t){return V.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(e,t){this.ui={},this.overlays={},this.ci=new wr(0),this.li=!1,this.li=!0,this.hi=new C5,this.referenceDelegate=e(this),this.Pi=new P5(this),this.indexManager=new y5,this.remoteDocumentCache=function(s){return new k5(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new cN(t),this.Ii=new b5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new A5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new R5(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Q("MemoryPersistence","Starting transaction:",e);const s=new D5(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return V.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class D5 extends XR{constructor(e){super(),this.currentSequenceNumber=e}}class _m{constructor(e){this.persistence=e,this.Ri=new Kw,this.Vi=null}static mi(e){return new _m(e)}get fi(){if(this.Vi)return this.Vi;throw fe(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),V.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),V.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.fi,r=>{const s=ne.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,Ce.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return V.or([()=>V.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class op{constructor(e,t){this.persistence=e,this.pi=new Di(r=>or(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=vN(this,t)}static mi(e,t){return new op(e,t)}Ei(){}di(e){return V.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return V.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?V.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ce.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Yf(e.data.value)),t}br(e,t,r){return V.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(e){this.serializer=e}k(e,t,r,s){const i=new sm("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(Sh)}(e),function(l){l.createObjectStore(Ud,{keyPath:Z4}),l.createObjectStore(ms,{keyPath:jE,autoIncrement:!0}).createIndex(ga,UE,{unique:!0}),l.createObjectStore(vc)}(e),RT(e),function(l){l.createObjectStore(ia)}(e));let o=V.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(Ic),l.deleteObjectStore(wc),l.deleteObjectStore(Ia)}(e),RT(e)),o=o.next(()=>function(l){const u=l.store(Ia),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ce.min().toTimestamp(),targetCount:0};return u.put(Zg,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(ms).J().next(f=>{l.deleteObjectStore(ms),l.createObjectStore(ms,{keyPath:jE,autoIncrement:!0}).createIndex(ga,UE,{unique:!0});const g=u.store(ms),y=f.map(_=>g.put(_));return V.waitFor(y)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(xc,{keyPath:l3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore($d)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(im,{keyPath:c3})})(e),function(l){l.createObjectStore(om,{keyPath:u3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(am,{keyPath:y3});u.createIndex(wv,_3,{unique:!1}),u.createIndex(ok,v3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(Xg,{keyPath:t3});u.createIndex(Qf,n3),u.createIndex(nk,r3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(ia))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(Pw,{keyPath:d3,autoIncrement:!0}).createIndex(vv,h3,{unique:!1}),l.createObjectStore(ed,{keyPath:f3}).createIndex(sk,g3,{unique:!1}),l.createObjectStore(td,{keyPath:p3}).createIndex(ik,m3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(ed).clear()}).next(()=>{t.objectStore(td).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(Dw,{keyPath:w3})})(e)})),r<18&&s>=18&&l1()&&(o=o.next(()=>{t.objectStore(ed).clear()}).next(()=>{t.objectStore(td).clear()})),o}wi(e){let t=0;return e.store(ia).ee((r,s)=>{t+=ip(s)}).next(()=>{const r={byteSize:t};return e.store($d).put(_v,r)})}yi(e){const t=e.store(Ud),r=e.store(ms);return t.J().next(s=>V.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,So],[i.userId,i.lastAcknowledgedBatchId]);return r.J(ga,o).next(a=>V.forEach(a,l=>{xe(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=aa(this.serializer,l);return gN(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(Ic),r=e.store(ia);return e.store(Ia).get(Zg).next(s=>{const i=[];return r.ee((o,a)=>{const l=new nt(o),u=function(f){return[0,or(f)]}(l);i.push(t.get(u).next(h=>h?V.resolve():(f=>t.put({targetId:0,path:or(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>V.waitFor(i))})}bi(e,t){e.createObjectStore(Bd,{keyPath:a3});const r=t.store(Bd),s=new Qw,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:or(l)})}};return t.store(ia).ee({X:!0},(o,a)=>{const l=new nt(o);return i(l.popLast())}).next(()=>t.store(vc).ee({X:!0},([o,a,l],u)=>{const h=$s(a);return i(h.popLast())}))}Di(e){const t=e.store(wc);return t.ee((r,s)=>{const i=Ou(s),o=uN(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(ia),s=[];return r.ee((i,o)=>{const a=t.store(Xg),l=function(f){return f.document?new ne(nt.fromString(f.document.name).popFirst(5)):f.noDocument?ne.fromSegments(f.noDocument.path):f.unknownDocument?ne.fromSegments(f.unknownDocument.path):fe(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>V.waitFor(s))}Fi(e,t){const r=t.store(ms),s=IN(this.serializer),i=new Yw(_m.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??Ge();aa(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),V.forEach(a,(l,u)=>{const h=new Dn(u),f=mm.wt(this.serializer,h),g=i.getIndexManager(h),y=ym.wt(h,this.serializer,g,i.referenceDelegate);return new xN(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Iv(t,wr.ce),l).next()})})}}function RT(n){n.createObjectStore(Ic,{keyPath:i3}).createIndex(Nw,o3,{unique:!0}),n.createObjectStore(wc,{keyPath:"targetId"}).createIndex(rk,s3,{unique:!0}),n.createObjectStore(Ia)}const qi="IndexedDbPersistence",Ly=18e5,My=5e3,Oy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",SN="main";class Jw{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=g=>Promise.resolve(),!Jw.v())throw new q(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new x5(this,s),this.$i=t+SN,this.serializer=new cN(l),this.Ui=new Hs(this.$i,this.Ni,new L5(this.serializer)),this.hi=new d5,this.Pi=new v5(this.referenceDelegate,this.serializer),this.remoteDocumentCache=IN(this.serializer),this.Ii=new u5,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&yn(qi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new q(F.FAILED_PRECONDITION,Oy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new wr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ef(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(qo(e))return Q(qi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Q(qi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Eu(e).get(yl).next(t=>V.resolve(this.es(t)))}ts(e){return Ef(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ly)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Rn(t,xc);return r.J().next(s=>{const i=this.ss(s,Ly),o=s.filter(a=>i.indexOf(a)===-1);return V.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?V.resolve(!0):Eu(e).get(yl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,My)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new q(F.FAILED_PRECONDITION,Oy);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ef(e).J().next(r=>this.ss(r,My).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&Q(qi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Sh,xc],e=>{const t=new Iv(e,wr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Ef(e).J().next(t=>this.ss(t,Ly).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return ym.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new _5(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return mm.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){Q(qi,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?S3:l===17?uk:l===16?x3:l===15?Lw:l===14?ck:l===13?lk:l===12?I3:l===11?ak:void fe(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new Iv(a,this.ci?this.ci.next():wr.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw yn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new q(F.FAILED_PRECONDITION,JR);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Eu(e).get(yl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,My)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new q(F.FAILED_PRECONDITION,Oy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Eu(e).put(yl,t)}static v(){return Hs.v()}Zi(e){const t=Eu(e);return t.get(yl).next(r=>this.es(r)?(Q(qi,"Releasing primary lease."),t.delete(yl)):V.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(yn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;a1()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return Q(qi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return yn(qi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){yn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Eu(n){return Rn(n,Sh)}function Ef(n){return Rn(n,xc)}function Xw(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=Ge(),s=Ge();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Zw(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return a1()?8:ZR(Cn())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new M5;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(Sl()<=rt.DEBUG&&Q("QueryEngine","SDK will not create cache indexes for query:",El(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),V.resolve()):(Sl()<=rt.DEBUG&&Q("QueryEngine","Query:",El(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Sl()<=rt.DEBUG&&Q("QueryEngine","The SDK decides to create cache indexes for query:",El(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ar(t))):V.resolve())}ys(e,t){if(ZE(t))return V.resolve(null);let r=ar(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=np(t,null,"F"),r=ar(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ge(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,np(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return ZE(t)||s.isEqual(Ce.min())?V.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?V.resolve(null):(Sl()<=rt.DEBUG&&Q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),El(t)),this.vs(e,o,t,KR(s,mc)).next(a=>a))})}Ds(e,t){let r=new At(Lk(e));return t.forEach((s,i)=>{bh(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return Sl()<=rt.DEBUG&&Q("QueryEngine","Using full collection scan to execute query:",El(t)),this.ps.getDocumentsMatchingQuery(e,t,Gr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eI="LocalStore",O5=3e8;class V5{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Bt($e),this.xs=new Di(i=>Oa(i),Eh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new xN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function TN(n,e,t,r){return new V5(n,e,t,r)}async function bN(n,e){const t=re(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Ge();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function F5(n,e){const t=re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,g=f.keys();let y=V.resolve();return g.forEach(_=>{y=y.next(()=>h.getEntry(l,_)).next(C=>{const N=u.docVersions.get(_);xe(N!==null,48541),C.version.compareTo(N)<0&&(f.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),h.addEntry(C)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Ge();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function AN(n){const e=re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function j5(n,e){const t=re(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(fn.EMPTY_BYTE_STRING,Ce.min()).withLastLimboFreeSnapshotVersion(Ce.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(C,N,T){return C.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=O5?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(g,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let l=xr(),u=Ge();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(CN(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(Ce.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return V.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function CN(n,e,t){let r=Ge(),s=Ge();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=xr();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ce.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Q(eI,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function U5(n,e){const t=re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=So),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Rc(n,e){const t=re(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,V.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new gi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function kc(n,e,t){const r=re(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!qo(o))throw o;Q(eI,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function ap(n,e,t){const r=re(n);let s=Ce.min(),i=Ge();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=re(l),g=f.xs.get(h);return g!==void 0?V.resolve(f.Ms.get(g)):f.Pi.getTargetData(u,h)}(r,o,ar(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:Ce.min(),t?i:Ge())).next(a=>(NN(r,Dk(e),a),{documents:a,Qs:i})))}function RN(n,e){const t=re(n),r=re(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function kN(n,e){const t=re(n),r=t.Os.get(e)||Ce.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,KR(r,mc),Number.MAX_SAFE_INTEGER)).then(s=>(NN(t,e,s),s))}function NN(n,e,t){let r=n.Os.get(e)||Ce.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function $5(n,e,t,r){const s=re(n);let i=Ge(),o=xr();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Rc(s,function(h){return ar(qc(nt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>CN(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function B5(n,e,t=Ge()){const r=await Rc(n,ar(pm(e.bundledQuery))),s=re(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=_n(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(fn.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PN="firestore_clients";function kT(n,e){return`${PN}_${n}_${e}`}const DN="firestore_mutations";function NT(n,e,t){let r=`${DN}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const LN="firestore_targets";function Vy(n,e){return`${LN}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vs="SharedClientState";class lp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new q(s.error.code,s.error.message))),o?new lp(e,t,s.state,i):(yn(Vs,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class od{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new q(r.error.code,r.error.message))),i?new od(e,r.state,s):(yn(Vs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class cp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=jw();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=ek(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new cp(e,i):(yn(Vs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class tI{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new tI(t.clientId,t.onlineState):(yn(Vs,`Failed to parse online state: ${e}`),null)}}class Mv{constructor(){this.activeTargetIds=jw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Bt($e),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=kT(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Mv),this.ro=new RegExp(`^${PN}_${o}_([^_]*)$`),this.io=new RegExp(`^${DN}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${LN}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(kT(this.persistenceKey,r));if(s){const i=cp.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Vy(this.persistenceKey,e));if(s){const i=od.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Vy(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Q(Vs,"READ",e,t),t}setItem(e,t){Q(Vs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Q(Vs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(Q(Vs,"EVENT",t.key,t.newValue),t.key===this.eo)return void yn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=wr.ce;if(i!=null)try{const a=JSON.parse(i);xe(typeof a=="number",30636,{So:i}),o=a}catch(a){yn(Vs,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==wr.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new lp(this.currentUser,e,t,r),i=NT(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=NT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=Vy(this.persistenceKey,e),i=new od(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return cp.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return lp.Ws(new Dn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return od.Ws(s,t)}uo(e){return tI.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);Q(Vs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=jw();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class MN{constructor(){this.Mo=new Mv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Mv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT="ConnectivityMonitor";class DT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Q(PT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Q(PT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tf=null;function Ov(){return Tf===null?Tf=function(){return 268435456+Math.round(2147483648*Math.random())}():Tf++,"0x"+Tf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jy="RestConnection",q5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class W5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===qd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=Ov(),a=this.zo(e,t.toUriEncodedString());Q(jy,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=Ni(u);return this.Jo(e,a,l,r,h).then(f=>(Q(jy,`Received RPC '${e}' ${o}: `,f),f),f=>{throw as(jy,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+zc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=q5[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr="WebChannelConnection";class H5 extends W5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=Ov();return new Promise((a,l)=>{const u=new jR;u.setWithCredentials(!0),u.listenOnce(UR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Gf.NO_ERROR:const f=u.getResponseJson();Q(nr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case Gf.TIMEOUT:Q(nr,`RPC '${e}' ${o} timed out`),l(new q(F.DEADLINE_EXCEEDED,"Request time out"));break;case Gf.HTTP_ERROR:const g=u.getStatus();if(Q(nr,`RPC '${e}' ${o} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const _=y==null?void 0:y.error;if(_&&_.status&&_.message){const C=function(T){const x=T.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(x)>=0?x:F.UNKNOWN}(_.status);l(new q(C,_.message))}else l(new q(F.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new q(F.UNAVAILABLE,"Connection failed."));break;default:fe(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Q(nr,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);Q(nr,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=Ov(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=zR(),a=BR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");Q(nr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let g=!1,y=!1;const _=new G5({Yo:N=>{y?Q(nr,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(g||(Q(nr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),Q(nr,`RPC '${e}' stream ${s} sending:`,N),f.send(N))},Zo:()=>f.close()}),C=(N,T,x)=>{N.listen(T,k=>{try{x(k)}catch(P){setTimeout(()=>{throw P},0)}})};return C(f,Du.EventType.OPEN,()=>{y||(Q(nr,`RPC '${e}' stream ${s} transport opened.`),_.o_())}),C(f,Du.EventType.CLOSE,()=>{y||(y=!0,Q(nr,`RPC '${e}' stream ${s} transport closed`),_.a_(),this.E_(f))}),C(f,Du.EventType.ERROR,N=>{y||(y=!0,as(nr,`RPC '${e}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),_.a_(new q(F.UNAVAILABLE,"The operation could not be completed")))}),C(f,Du.EventType.MESSAGE,N=>{var T;if(!y){const x=N.data[0];xe(!!x,16349);const k=x,P=(k==null?void 0:k.error)||((T=k[0])==null?void 0:T.error);if(P){Q(nr,`RPC '${e}' stream ${s} received error:`,P);const $=P.status;let j=function(I){const A=In[I];if(A!==void 0)return Qk(A)}($),R=P.message;j===void 0&&(j=F.INTERNAL,R="Unknown error status: "+$+" with message "+P.message),y=!0,_.a_(new q(j,R)),f.close()}else Q(nr,`RPC '${e}' stream ${s} received:`,x),_.u_(x)}}),C(a,$R.STAT_EVENT,N=>{N.stat===fv.PROXY?Q(nr,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===fv.NOPROXY&&Q(nr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{_.__()},0),_}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ON(){return typeof window<"u"?window:null}function tg(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tl(n){return new Z3(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&Q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT="PersistentStream";class VN{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new nI(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(yn(t.toString()),yn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new q(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Q(LT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Q(LT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Q5 extends VN{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=n5(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ce.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ce.min():o.readTime?_n(o.readTime):Ce.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=kv(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=ep(l)?{documents:rN(i,l)}:{query:gm(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Xk(i,o.resumeToken);const u=Cv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(Ce.min())>0){a.readTime=Cc(i,o.snapshotVersion.toTimestamp());const u=Cv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=s5(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=kv(this.serializer),t.removeTarget=e,this.q_(t)}}class K5 extends VN{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return xe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,xe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){xe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=r5(e.writeResults,e.commitTime),r=_n(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=kv(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Kd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y5{}class J5 extends Y5{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new q(F.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Rv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new q(F.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Rv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(F.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class X5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(yn(t),this.aa=!1):Q("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ba="RemoteStore";class Z5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Go(this)&&(Q(Ba,"Restarting streams for network reachability change."),await async function(l){const u=re(l);u.Ea.add(4),await Hc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await kh(u)}(this))})}),this.Ra=new X5(r,s)}}async function kh(n){if(Go(n))for(const e of n.da)await e(!0)}async function Hc(n){for(const e of n.da)await e(!1)}function vm(n,e){const t=re(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),iI(t)?sI(t):Kc(t).O_()&&rI(t,e))}function Nc(n,e){const t=re(n),r=Kc(t);t.Ia.delete(e),r.O_()&&FN(t,e),t.Ia.size===0&&(r.O_()?r.L_():Go(t)&&t.Ra.set("Unknown"))}function rI(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ce.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Kc(n).Y_(e)}function FN(n,e){n.Va.Ue(e),Kc(n).Z_(e)}function sI(n){n.Va=new K3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Kc(n).start(),n.Ra.ua()}function iI(n){return Go(n)&&!Kc(n).x_()&&n.Ia.size>0}function Go(n){return re(n).Ea.size===0}function jN(n){n.Va=void 0}async function e6(n){n.Ra.set("Online")}async function t6(n){n.Ia.forEach((e,t)=>{rI(n,e)})}async function n6(n,e){jN(n),iI(n)?(n.Ra.ha(e),sI(n)):n.Ra.set("Unknown")}async function r6(n,e,t){if(n.Ra.set("Online"),e instanceof Jk&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){Q(Ba,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await up(n,r)}else if(e instanceof Zf?n.Va.Ze(e):e instanceof Yk?n.Va.st(e):n.Va.tt(e),!t.isEqual(Ce.min()))try{const r=await AN(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(fn.EMPTY_BYTE_STRING,h.snapshotVersion)),FN(i,l);const f=new gi(h.target,l,u,h.sequenceNumber);rI(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Q(Ba,"Failed to raise snapshot:",r),await up(n,r)}}async function up(n,e,t){if(!qo(e))throw e;n.Ea.add(1),await Hc(n),n.Ra.set("Offline"),t||(t=()=>AN(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Q(Ba,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await kh(n)})}function UN(n,e){return e().catch(t=>up(n,t,e))}async function Qc(n){const e=re(n),t=Oo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:So;for(;s6(e);)try{const s=await U5(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,i6(e,s)}catch(s){await up(e,s)}$N(e)&&BN(e)}function s6(n){return Go(n)&&n.Ta.length<10}function i6(n,e){n.Ta.push(e);const t=Oo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function $N(n){return Go(n)&&!Oo(n).x_()&&n.Ta.length>0}function BN(n){Oo(n).start()}async function o6(n){Oo(n).ra()}async function a6(n){const e=Oo(n);for(const t of n.Ta)e.ea(t.mutations)}async function l6(n,e,t){const r=n.Ta.shift(),s=zw.from(r,e,t);await UN(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Qc(n)}async function c6(n,e){e&&Oo(n).X_&&await async function(r,s){if(function(o){return Hk(o)&&o!==F.ABORTED}(s.code)){const i=r.Ta.shift();Oo(r).B_(),await UN(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Qc(r)}}(n,e),$N(n)&&BN(n)}async function MT(n,e){const t=re(n);t.asyncQueue.verifyOperationInProgress(),Q(Ba,"RemoteStore received new credentials");const r=Go(t);t.Ea.add(3),await Hc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await kh(t)}async function Vv(n,e){const t=re(n);e?(t.Ea.delete(2),await kh(t)):e||(t.Ea.add(2),await Hc(t),t.Ra.set("Unknown"))}function Kc(n){return n.ma||(n.ma=function(t,r,s){const i=re(t);return i.sa(),new Q5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:e6.bind(null,n),t_:t6.bind(null,n),r_:n6.bind(null,n),H_:r6.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),iI(n)?sI(n):n.Ra.set("Unknown")):(await n.ma.stop(),jN(n))})),n.ma}function Oo(n){return n.fa||(n.fa=function(t,r,s){const i=re(t);return i.sa(),new K5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:o6.bind(null,n),r_:c6.bind(null,n),ta:a6.bind(null,n),na:l6.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Qc(n)):(await n.fa.stop(),n.Ta.length>0&&(Q(Ba,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oI{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new On,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new oI(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Yc(n,e){if(yn("AsyncQueue",`${e}: ${n}`),qo(n))return new q(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{static emptySet(e){return new xa(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ne.comparator(t.key,r.key):(t,r)=>ne.comparator(t.key,r.key),this.keyedMap=Lu(),this.sortedSet=new Bt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new xa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OT{constructor(){this.ga=new Bt(ne.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):fe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class za{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new za(e,t,xa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Th(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u6{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class d6{constructor(){this.queries=VT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=re(t),i=s.queries;s.queries=VT(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new q(F.ABORTED,"Firestore shutting down"))}}function VT(){return new Di(n=>Pk(n),Th)}async function aI(n,e){const t=re(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new u6,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Yc(o,`Initialization of query '${El(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&cI(t)}async function lI(n,e){const t=re(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function h6(n,e){const t=re(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&cI(t)}function f6(n,e,t){const r=re(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function cI(n){n.Ca.forEach(e=>{e.next()})}var Fv,FT;(FT=Fv||(Fv={})).Ma="default",FT.Cache="cache";class uI{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new za(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=za.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Fv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jT{constructor(e){this.serializer=e}$s(e){return Qs(this.serializer,e)}Us(e){return e.metadata.exists?fm(this.serializer,e.document,!1):Gt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return _n(e)}}class dI{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=qN(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=nt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new jT(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ge()).add(i);t.set(o,a)}}return t}async ja(e){const t=await $5(e,new jT(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await B5(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function qN(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(e){this.key=e}}class GN{constructor(e){this.key=e}}class HN{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ge(),this.mutatedKeys=Ge(),this.eu=Lk(e),this.tu=new xa(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new OT,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),y=bh(this.query,f)?f:null,_=!!g&&this.mutatedKeys.has(g.key),C=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let N=!1;g&&y?g.data.isEqual(y.data)?_!==C&&(r.track({type:3,doc:y}),N=!0):this.su(g,y)||(r.track({type:2,doc:y}),N=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),N=!0):g&&!y&&(r.track({type:1,doc:g}),N=!0,(l||u)&&(a=!0)),N&&(y?(o=o.add(y),i=C?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,_){const C=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fe(20277,{Rt:N})}};return C(y)-C(_)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new za(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new OT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ge(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new GN(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new WN(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=Ge();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return za.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ho="SyncEngine";class g6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class p6{constructor(e){this.key=e,this.hu=!1}}class m6{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Di(a=>Pk(a),Th),this.Iu=new Map,this.Eu=new Set,this.du=new Bt(ne.comparator),this.Au=new Map,this.Ru=new Kw,this.Vu={},this.mu=new Map,this.fu=$a.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function y6(n,e,t=!0){const r=wm(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await QN(r,e,t,!0),s}async function _6(n,e){const t=wm(n);await QN(t,e,!0,!1)}async function QN(n,e,t,r){const s=await Rc(n.localStore,ar(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await hI(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&vm(n.remoteStore,s),a}async function hI(n,e,t,r,s){n.pu=(f,g,y)=>async function(C,N,T,x){let k=N.view.ru(T);k.Cs&&(k=await ap(C.localStore,N.query,!1).then(({documents:R})=>N.view.ru(R,k)));const P=x&&x.targetChanges.get(N.targetId),$=x&&x.targetMismatches.get(N.targetId)!=null,j=N.view.applyChanges(k,C.isPrimaryClient,P,$);return jv(C,N.targetId,j.au),j.snapshot}(n,f,g,y);const i=await ap(n.localStore,e,!0),o=new HN(e,i.Qs),a=o.ru(i.documents),l=Rh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);jv(n,t,u.au);const h=new g6(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function v6(n,e,t){const r=re(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Th(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await kc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Nc(r.remoteStore,s.targetId),Pc(r,s.targetId)}).catch(zo)):(Pc(r,s.targetId),await kc(r.localStore,s.targetId,!0))}async function w6(n,e){const t=re(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Nc(t.remoteStore,r.targetId))}async function I6(n,e,t){const r=mI(n);try{const s=await function(o,a){const l=re(o),u=_t.now(),h=a.reduce((y,_)=>y.add(_.key),Ge());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let _=xr(),C=Ge();return l.Ns.getEntries(y,h).next(N=>{_=N,_.forEach((T,x)=>{x.isValidDocument()||(C=C.add(T))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,_)).next(N=>{f=N;const T=[];for(const x of a){const k=G3(x,f.get(x.key).overlayedDocument);k!=null&&T.push(new Li(x.key,k,Ik(k.value.mapValue),rn.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,T,a)}).next(N=>{g=N;const T=N.applyToLocalDocumentSet(f,C);return l.documentOverlayCache.saveOverlays(y,N.batchId,T)})}).then(()=>({batchId:g.batchId,changes:Ok(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new Bt($e)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Mi(r,s.changes),await Qc(r.remoteStore)}catch(s){const i=Yc(s,"Failed to persist write");t.reject(i)}}async function KN(n,e){const t=re(n);try{const r=await j5(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(xe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?xe(o.hu,14607):s.removedDocuments.size>0&&(xe(o.hu,42227),o.hu=!1))}),await Mi(t,r,e)}catch(r){await zo(r)}}function UT(n,e,t){const r=re(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=re(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const g of f.Sa)g.va(a)&&(u=!0)}),u&&cI(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function x6(n,e,t){const r=re(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new Bt(ne.comparator);o=o.insert(i,Gt.newNoDocument(i,Ce.min()));const a=Ge().add(i),l=new Ch(Ce.min(),new Map,new Bt($e),o,a);await KN(r,l),r.du=r.du.remove(i),r.Au.delete(e),pI(r)}else await kc(r.localStore,e,!1).then(()=>Pc(r,e,t)).catch(zo)}async function S6(n,e){const t=re(n),r=e.batch.batchId;try{const s=await F5(t.localStore,e);gI(t,r,null),fI(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Mi(t,s)}catch(s){await zo(s)}}async function E6(n,e,t){const r=re(n);try{const s=await function(o,a){const l=re(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(xe(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);gI(r,e,t),fI(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Mi(r,s)}catch(s){await zo(s)}}async function T6(n,e){const t=re(n);Go(t.remoteStore)||Q(Ho,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=re(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===So)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Yc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function fI(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function gI(n,e,t){const r=re(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Pc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||YN(n,r)})}function YN(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Nc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),pI(n))}function jv(n,e,t){for(const r of t)r instanceof WN?(n.Ru.addReference(r.key,e),b6(n,r)):r instanceof GN?(Q(Ho,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||YN(n,r.key)):fe(19791,{wu:r})}function b6(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Q(Ho,"New document in limbo: "+t),n.Eu.add(r),pI(n))}function pI(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new ne(nt.fromString(e)),r=n.fu.next();n.Au.set(r,new p6(t)),n.du=n.du.insert(t,r),vm(n.remoteStore,new gi(ar(qc(t.path)),r,"TargetPurposeLimboResolution",wr.ce))}}async function Mi(n,e,t){const r=re(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=Zw.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=re(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>V.forEach(u,g=>V.forEach(g.Es,y=>h.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>V.forEach(g.ds,y=>h.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!qo(f))throw f;Q(eI,"Failed to update sequence numbers: "+f)}for(const f of u){const g=f.targetId;if(!f.fromCache){const y=h.Ms.get(g),_=y.snapshotVersion,C=y.withLastLimboFreeSnapshotVersion(_);h.Ms=h.Ms.insert(g,C)}}}(r.localStore,i))}async function A6(n,e){const t=re(n);if(!t.currentUser.isEqual(e)){Q(Ho,"User change. New user:",e.toKey());const r=await bN(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new q(F.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Mi(t,r.Ls)}}function C6(n,e){const t=re(n),r=t.Au.get(e);if(r&&r.hu)return Ge().add(r.key);{let s=Ge();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function R6(n,e){const t=re(n),r=await ap(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&jv(t,e.targetId,s.au),s}async function k6(n,e){const t=re(n);return kN(t.localStore,e).then(r=>Mi(t,r))}async function N6(n,e,t,r){const s=re(n),i=await function(a,l){const u=re(a),h=re(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(g=>g?u.localDocuments.getDocuments(f,g):V.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Qc(s.remoteStore):t==="acknowledged"||t==="rejected"?(gI(s,e,r||null),fI(s,e),function(a,l){re(re(a).mutationQueue).ir(l)}(s.localStore,e)):fe(6720,"Unknown batchState",{Su:t}),await Mi(s,i)):Q(Ho,"Cannot apply mutation batch with id: "+e)}async function P6(n,e){const t=re(n);if(wm(t),mI(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await $T(t,r.toArray());t.gu=!0,await Vv(t.remoteStore,!0);for(const i of s)vm(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Pc(t,o),kc(t.localStore,o,!0))),Nc(t.remoteStore,o)}),await s,await $T(t,r),function(o){const a=re(o);a.Au.forEach((l,u)=>{Nc(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new Bt(ne.comparator)}(t),t.gu=!1,await Vv(t.remoteStore,!1)}}async function $T(n,e,t){const r=re(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Rc(r.localStore,ar(l[0]));for(const u of l){const h=r.Tu.get(u),f=await R6(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await RN(r.localStore,o);a=await Rc(r.localStore,u),await hI(r,JN(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function JN(n){return Rk(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function D6(n){return function(t){return re(re(t).persistence).Ts()}(re(n).localStore)}async function L6(n,e,t,r){const s=re(n);if(s.gu)return void Q(Ho,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await kN(s.localStore,Dk(i[0])),a=Ch.createSynthesizedRemoteEventForCurrentChange(e,t==="current",fn.EMPTY_BYTE_STRING);await Mi(s,o,a);break}case"rejected":await kc(s.localStore,e,!0),Pc(s,e,r);break;default:fe(64155,t)}}async function M6(n,e,t){const r=wm(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){Q(Ho,"Adding an already active target "+s);continue}const i=await RN(r.localStore,s),o=await Rc(r.localStore,i);await hI(r,JN(i),o.targetId,!1,o.resumeToken),vm(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await kc(r.localStore,s,!1).then(()=>{Nc(r.remoteStore,s),Pc(r,s)}).catch(zo)}}function wm(n){const e=re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=KN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=C6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=x6.bind(null,e),e.Pu.H_=h6.bind(null,e.eventManager),e.Pu.yu=f6.bind(null,e.eventManager),e}function mI(n){const e=re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=S6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=E6.bind(null,e),e}function O6(n,e,t){const r=re(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,_){const C=re(y),N=_n(_.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",T=>C.Ii.getBundleMetadata(T,_.id)).then(T=>!!T&&T.createTime.compareTo(N)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(qN(l));const u=new dI(l,o.serializer);let h=await o.bu();for(;h;){const g=await u.Ga(h);g&&a._updateProgress(g),h=await o.bu()}const f=await u.ja(i.localStore);return await Mi(i,f.Ha,void 0),await function(y,_){const C=re(y);return C.persistence.runTransaction("Save bundle","readwrite",N=>C.Ii.saveBundleMetadata(N,_))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return as(Ho,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Dc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=tl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return TN(this.persistence,new EN,e.initialUser,this.serializer)}Cu(e){return new Yw(_m.mi,this.serializer)}Du(e){return new MN}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Dc.provider={build:()=>new Dc};class yI extends Dc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){xe(this.persistence.referenceDelegate instanceof op,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new _N(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?rr.withCacheSize(this.cacheSizeBytes):rr.DEFAULT;return new Yw(r=>op.mi(r,t),this.serializer)}}class _I extends Dc{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await mI(this.xu.syncEngine),await Qc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return TN(this.persistence,new EN,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new _N(r,e.asyncQueue,t)}Mu(e,t){const r=new J4(t,this.persistence);return new Y4(e.asyncQueue,r)}Cu(e){const t=Xw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?rr.withCacheSize(this.cacheSizeBytes):rr.DEFAULT;return new Jw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,ON(),tg(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new MN}}class XN extends _I{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Fy&&(this.sharedClientState.syncEngine={Co:N6.bind(null,t),vo:L6.bind(null,t),Fo:M6.bind(null,t),Ts:D6.bind(null,t),Do:k6.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await P6(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=ON();if(!Fy.v(t))throw new q(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Xw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Vo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>UT(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=A6.bind(null,this.syncEngine),await Vv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new d6}()}createDatastore(e){const t=tl(e.databaseInfo.databaseId),r=function(i){return new H5(i)}(e.databaseInfo);return function(i,o,a,l){return new J5(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new Z5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>UT(this.syncEngine,t,0),function(){return DT.v()?new DT:new z5}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new m6(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=re(s);Q(Ba,"RemoteStore shutting down."),i.Ea.add(5),await Hc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Vo.provider={build:()=>new Vo};function BT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):yn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new On,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new zN(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F6{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new zN(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new q(F.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new q(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=re(s),a={documents:i.map(f=>Qd(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,nt.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const g=t5(o.serializer,f);u.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=u.get(f.toString());xe(!!g,55234,{key:f}),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Gc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ne.fromPath(r);this.mutations.push(new $w(s,this.precondition(s)))}),await async function(r,s){const i=re(r),o={writes:s.map(a=>Kd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,nt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw fe(50498,{Gu:e.constructor.name});t=Ce.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new q(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ce.min())?rn.exists(!1):rn.updateTime(t):rn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ce.min()))throw new q(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rn.updateTime(t)}return rn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U6{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new nI(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new j6(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!xh(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Hk(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fo="FirestoreClient";class $6{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Dn.UNAUTHENTICATED,this.clientId=Aw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Q(Fo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Q(Fo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new On;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Yc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Uy(n,e){n.asyncQueue.verifyOperationInProgress(),Q(Fo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await bN(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function zT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await vI(n);Q(Fo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>MT(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>MT(e.remoteStore,s)),n._onlineComponents=e}async function vI(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Q(Fo,"Using user provided OfflineComponentProvider");try{await Uy(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;as("Error using user provided cache. Falling back to memory cache: "+t),await Uy(n,new Dc)}}else Q(Fo,"Using default OfflineComponentProvider"),await Uy(n,new yI(void 0));return n._offlineComponents}async function xm(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Q(Fo,"Using user provided OnlineComponentProvider"),await zT(n,n._uninitializedComponentsProvider._online)):(Q(Fo,"Using default OnlineComponentProvider"),await zT(n,new Vo))),n._onlineComponents}function ZN(n){return vI(n).then(e=>e.persistence)}function Jc(n){return vI(n).then(e=>e.localStore)}function eP(n){return xm(n).then(e=>e.remoteStore)}function wI(n){return xm(n).then(e=>e.syncEngine)}function tP(n){return xm(n).then(e=>e.datastore)}async function Lc(n){const e=await xm(n),t=e.eventManager;return t.onListen=y6.bind(null,e.syncEngine),t.onUnlisten=v6.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=_6.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=w6.bind(null,e.syncEngine),t}function B6(n){return n.asyncQueue.enqueue(async()=>{const e=await ZN(n),t=await eP(n);return e.setNetworkEnabled(!0),function(s){const i=re(s);return i.Ea.delete(0),kh(i)}(t)})}function z6(n){return n.asyncQueue.enqueue(async()=>{const e=await ZN(n),t=await eP(n);return e.setNetworkEnabled(!1),async function(s){const i=re(s);i.Ea.add(0),await Hc(i),i.Ra.set("Offline")}(t)})}function q6(n,e){const t=new On;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=re(u);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new q(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Yc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Jc(n),e,t)),t.promise}function nP(n,e,t={}){const r=new On;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Im({next:g=>{h.Nu(),o.enqueueAndForget(()=>lI(i,f));const y=g.docs.has(a);!y&&g.fromCache?u.reject(new q(F.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?u.reject(new q(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new uI(qc(a.path),h,{includeMetadataChanges:!0,qa:!0});return aI(i,f)}(await Lc(n),n.asyncQueue,e,t,r)),r.promise}function W6(n,e){const t=new On;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await ap(s,i,!0),l=new HN(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=Yc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Jc(n),e,t)),t.promise}function rP(n,e,t={}){const r=new On;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Im({next:g=>{h.Nu(),o.enqueueAndForget(()=>lI(i,f)),g.fromCache&&l.source==="server"?u.reject(new q(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new uI(a,h,{includeMetadataChanges:!0,qa:!0});return aI(i,f)}(await Lc(n),n.asyncQueue,e,t,r)),r.promise}function G6(n,e,t){const r=new On;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await tP(n);r.resolve(async function(o,a,l){var C;const u=re(o),{request:h,gt:f,parent:g}=sN(u.serializer,kk(a),l);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,g,h,1)).filter(N=>!!N.result);xe(y.length===1,64727);const _=(C=y[0].result)==null?void 0:C.aggregateFields;return Object.keys(_).reduce((N,T)=>(N[f[T]]=_[T],N),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function H6(n,e){const t=new Im(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){re(s).Ca.add(i),i.next()}(await Lc(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){re(s).Ca.delete(i)}(await Lc(n),t))}}function Q6(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?Kk().encode(o):o,function(h,f){return new V6(h,f)}(function(h,f){if(h instanceof Uint8Array)return BT(h,f);if(h instanceof ArrayBuffer)return BT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,tl(e));n.asyncQueue.enqueueAndForget(async()=>{O6(await wI(n),s,r)})}function K6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=re(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await Jc(n),e))}function sP(n,e){return function(r,s){return new F6(r,s)}(n,e)}function Y6(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=re(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,g,y,_,C){f=[...f],g=[...g],f.sort(y),g.sort(y);const N=f.length,T=g.length;let x=0,k=0;for(;x<T&&k<N;){const P=y(f[k],g[x]);P<0?C(f[k++]):P>0?_(g[x++]):(x++,k++)}for(;x<T;)_(g[x++]);for(;k<N;)C(f[k++])}(u,s,G4,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>V.waitFor(a)))}(await Jc(n),e))}function J6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){re(r).Fs.Vs=s}(await Jc(n),e))}function X6(n){return n.asyncQueue.enqueue(async()=>function(t){const r=re(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Jc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP="firestore.googleapis.com",WT=!0;class GT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new q(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oP,this.ssl=WT}else this.host=e.host,this.ssl=e.ssl??WT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=fN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yN)throw new q(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}W4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=iP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new q(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new q(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new q(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Nh{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new GT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new GT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new M4;switch(r.type){case"firstParty":return new j4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new q(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=qT.get(t);r&&(Q("ComponentProvider","Removing Datastore"),qT.delete(t),r.terminate())}(this),Promise.resolve()}}function Z6(n,e,t,r={}){var u;n=st(n,Nh);const s=Ni(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Op(`https://${a}`),j0("Firestore",!0)),i.host!==oP&&i.host!==a&&as("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!qr(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Dn.MOCK_USER;else{h=r1(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new q(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Dn(g)}n._authCredentials=new O4(new WR(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new jn(this.firestore,e,this._query)}}class Rt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ks(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rt(this.firestore,e,this._key)}toJSON(){return{type:Rt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(el(t,Rt._jsonSchema))return new Rt(e,r||null,new ne(nt.fromString(t.referencePath)))}}Rt._jsonSchemaVersion="firestore/documentReference/1.0",Rt._jsonSchema={type:En("string",Rt._jsonSchemaVersion),referencePath:En("string")};class Ks extends jn{constructor(e,t,r){super(e,t,qc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rt(this.firestore,null,new ne(e))}withConverter(e){return new Ks(this.firestore,e,this._path)}}function Jr(n,e,...t){if(n=le(n),Cw("collection","path",e),n instanceof Nh){const r=nt.fromString(e,...t);return LE(r),new Ks(n,null,r)}{if(!(n instanceof Rt||n instanceof Ks))throw new q(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(nt.fromString(e,...t));return LE(r),new Ks(n.firestore,null,r)}}function x8(n,e){if(n=st(n,Nh),Cw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new q(F.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new jn(n,null,function(r){return new Pi(nt.emptyPath(),r)}(e))}function ng(n,e,...t){if(n=le(n),arguments.length===1&&(e=Aw.newId()),Cw("doc","path",e),n instanceof Nh){const r=nt.fromString(e,...t);return DE(r),new Rt(n,null,new ne(r))}{if(!(n instanceof Rt||n instanceof Ks))throw new q(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(nt.fromString(e,...t));return DE(r),new Rt(n.firestore,n instanceof Ks?n.converter:null,new ne(r))}}function S8(n,e){return n=le(n),e=le(e),(n instanceof Rt||n instanceof Ks)&&(e instanceof Rt||e instanceof Ks)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function aP(n,e){return n=le(n),e=le(e),n instanceof jn&&e instanceof jn&&n.firestore===e.firestore&&Th(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HT="AsyncQueue";class QT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new nI(this,"async_queue_retry"),this._c=()=>{const r=tg();r&&Q(HT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=tg();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=tg();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new On;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!qo(e))throw e;Q(HT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,yn("INTERNAL UNHANDLED ERROR: ",KT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=oI.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&fe(47125,{Pc:KT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function KT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class eU{constructor(){this._progressObserver={},this._taskCompletionResolver=new On,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E8=-1;class Ot extends Nh{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new QT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new QT(e),this._firestoreClient=void 0,await e}}}function T8(n,e,t){t||(t=qd);const r=ei(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(qr(i,e))return s;throw new q(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new q(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yN)throw new q(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Ni(e.host)&&Op(e.host),r.initialize({options:e,instanceIdentifier:t})}function tU(n,e){const t=typeof n=="object"?n:dh(),r=typeof n=="string"?n:e||qd,s=ei(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=e1("firestore");i&&Z6(s,...i)}return s}function un(n){if(n._terminated)throw new q(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||lP(n),n._firestoreClient}function lP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new T3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,iP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new $6(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function b8(n,e){as("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return cP(n,Vo.provider,{build:r=>new _I(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function A8(n){as("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();cP(n,Vo.provider,{build:t=>new XN(t,e.cacheSizeBytes)})}function cP(n,e,t){if((n=st(n,Ot))._firestoreClient||n._terminated)throw new q(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new q(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},lP(n)}function C8(n){if(n._initialized&&!n._terminated)throw new q(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new On;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Hs.v())return Promise.resolve();const s=r+SN;await Hs.delete(s)}(Xw(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function R8(n){return function(t){const r=new On;return t.asyncQueue.enqueueAndForget(async()=>T6(await wI(t),r)),r.promise}(un(n=st(n,Ot)))}function k8(n){return B6(un(n=st(n,Ot)))}function N8(n){return z6(un(n=st(n,Ot)))}function P8(n){return nV(n.app,"firestore",n._databaseId.database),n._delete()}function YT(n,e){const t=un(n=st(n,Ot)),r=new eU;return Q6(t,n._databaseId,e,r),r}function nU(n,e){return K6(un(n=st(n,Ot)),e).then(t=>t?new jn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class rU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Vr(fn.fromBase64String(e))}catch(t){throw new q(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Vr(fn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Vr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(el(e,Vr._jsonSchema))return Vr.fromBase64String(e.bytes)}}Vr._jsonSchemaVersion="firestore/bytes/1.0",Vr._jsonSchema={type:En("string",Vr._jsonSchemaVersion),bytes:En("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function D8(){return new nl(mv)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return $e(this._lat,e._lat)||$e(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ys._jsonSchemaVersion}}static fromJSON(e){if(el(e,Ys._jsonSchema))return new Ys(e.latitude,e.longitude)}}Ys._jsonSchemaVersion="firestore/geoPoint/1.0",Ys._jsonSchema={type:En("string",Ys._jsonSchemaVersion),latitude:En("number"),longitude:En("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ss._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(el(e,Ss._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Ss(e.vectorValues);throw new q(F.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ss._jsonSchemaVersion="firestore/vectorValue/1.0",Ss._jsonSchema={type:En("string",Ss._jsonSchemaVersion),vectorValues:En("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sU=/^__.*__$/;class iU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Li(e,this.data,this.fieldMask,t,this.fieldTransforms):new Wc(e,this.data,t,this.fieldTransforms)}}class uP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Li(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fe(40011,{Ac:n})}}class Sm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Sm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return dp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(dP(this.Ac)&&sU.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class oU{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||tl(e)}Cc(e,t,r,s=!1){return new Sm({Ac:e,methodName:t,Dc:r,path:nn.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sl(n){const e=n._freezeSettings(),t=tl(n._databaseId);return new oU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Em(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);AI("Data must be an object, but it was:",o,r);const a=gP(r,o);let l,u;if(i.merge)l=new Ir(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=Jd(e,f,t);if(!o.contains(g))throw new q(F.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);mP(h,g)||h.push(g)}l=new Ir(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new iU(new Hn(a),l,u)}class Ph extends rl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ph}}function hP(n,e,t){return new Sm({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class II extends rl{_toFieldTransform(e){return new Ah(e.path,new bc)}isEqual(e){return e instanceof II}}class xI extends rl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=hP(this,e,!0),r=this.vc.map(i=>il(i,t)),s=new Va(r);return new Ah(e.path,s)}isEqual(e){return e instanceof xI&&qr(this.vc,e.vc)}}class SI extends rl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=hP(this,e,!0),r=this.vc.map(i=>il(i,t)),s=new Fa(r);return new Ah(e.path,s)}isEqual(e){return e instanceof SI&&qr(this.vc,e.vc)}}class EI extends rl{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Ac(e.serializer,jk(e.serializer,this.Fc));return new Ah(e.path,t)}isEqual(e){return e instanceof EI&&this.Fc===e.Fc}}function TI(n,e,t,r){const s=n.Cc(1,e,t);AI("Data must be an object, but it was:",s,r);const i=[],o=Hn.empty();Wo(r,(l,u)=>{const h=Tm(e,l,t);u=le(u);const f=s.yc(h);if(u instanceof Ph)i.push(h);else{const g=il(u,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new Ir(i);return new uP(o,a,s.fieldTransforms)}function bI(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[Jd(e,r,t)],l=[s];if(i.length%2!=0)throw new q(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Jd(e,i[g])),l.push(i[g+1]);const u=[],h=Hn.empty();for(let g=a.length-1;g>=0;--g)if(!mP(u,a[g])){const y=a[g];let _=l[g];_=le(_);const C=o.yc(y);if(_ instanceof Ph)u.push(y);else{const N=il(_,C);N!=null&&(u.push(y),h.set(y,N))}}const f=new Ir(u);return new uP(h,f,o.fieldTransforms)}function fP(n,e,t,r=!1){return il(t,n.Cc(r?4:3,e))}function il(n,e){if(pP(n=le(n)))return AI("Unsupported field value:",e,n),gP(n,e);if(n instanceof rl)return function(r,s){if(!dP(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=il(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return jk(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=_t.fromDate(r);return{timestampValue:Cc(s.serializer,i)}}if(r instanceof _t){const i=new _t(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Cc(s.serializer,i)}}if(r instanceof Ys)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Vr)return{bytesValue:Xk(s.serializer,r._byteString)};if(r instanceof Rt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Gw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ss)return function(o,a){return{mapValue:{fields:{[Mw]:{stringValue:Ow},[Sc]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return Uw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${rm(r)}`)}(n,e)}function gP(n,e){const t={};return hk(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wo(n,(r,s)=>{const i=il(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function pP(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof _t||n instanceof Ys||n instanceof Vr||n instanceof Rt||n instanceof rl||n instanceof Ss)}function AI(n,e,t){if(!pP(t)||!HR(t)){const r=rm(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Jd(n,e,t){if((e=le(e))instanceof nl)return e._internalPath;if(typeof e=="string")return Tm(n,e);throw dp("Field path arguments must be of type string or ",n,!1,void 0,t)}const aU=new RegExp("[~\\*/\\[\\]]");function Tm(n,e,t){if(e.search(aU)>=0)throw dp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new nl(...e.split("."))._internalPath}catch{throw dp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function dp(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new q(F.INVALID_ARGUMENT,a+n+l)}function mP(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new lU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(bm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class lU extends Xd{data(){return super.data()}}function bm(n,e){return typeof e=="string"?Tm(n,e):e instanceof nl?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class CI{}class Dh extends CI{}function jl(n,e,...t){let r=[];e instanceof CI&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Xc).length,a=i.filter(l=>l instanceof Lh).length;if(o>1||o>0&&a>0)throw new q(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Lh extends Dh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Lh(e,t,r)}_apply(e){const t=this._parse(e);return vP(e._query,t),new jn(e.firestore,e.converter,Av(e._query,t))}_parse(e){const t=sl(e.firestore);return function(i,o,a,l,u,h,f){let g;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new q(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){XT(f,h);const _=[];for(const C of f)_.push(JT(l,i,C));g={arrayValue:{values:_}}}else g=JT(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||XT(f,h),g=fP(a,o,f,h==="in"||h==="not-in");return ot.create(u,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ul(n,e,t){const r=e,s=bm("where",n);return Lh._create(s,r,t)}class Xc extends CI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Xc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Tt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)vP(o,l),o=Av(o,l)}(e._query,t),new jn(e.firestore,e.converter,Av(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function L8(...n){return n.forEach(e=>wP("or",e)),Xc._create("or",n)}function M8(...n){return n.forEach(e=>wP("and",e)),Xc._create("and",n)}class RI extends Dh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new RI(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new q(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new q(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Hd(i,o)}(e._query,this._field,this._direction);return new jn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Pi(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function cU(n,e="asc"){const t=e,r=bm("orderBy",n);return RI._create(r,t)}class Am extends Dh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Am(e,t,r)}_apply(e){return new jn(e.firestore,e.converter,np(e._query,this._limit,this._limitType))}}function O8(n){return QR("limit",n),Am._create("limit",n,"F")}function V8(n){return QR("limitToLast",n),Am._create("limitToLast",n,"L")}class Cm extends Dh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Cm(e,t,r)}_apply(e){const t=_P(e,this.type,this._docOrFields,this._inclusive);return new jn(e.firestore,e.converter,function(s,i){return new Pi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function F8(...n){return Cm._create("startAt",n,!0)}function j8(...n){return Cm._create("startAfter",n,!1)}class Rm extends Dh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Rm(e,t,r)}_apply(e){const t=_P(e,this.type,this._docOrFields,this._inclusive);return new jn(e.firestore,e.converter,function(s,i){return new Pi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function U8(...n){return Rm._create("endBefore",n,!1)}function $8(...n){return Rm._create("endAt",n,!0)}function _P(n,e,t,r){if(t[0]=le(t[0]),t[0]instanceof Xd)return function(i,o,a,l,u){if(!l)throw new q(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Kl(i))if(f.field.isKeyField())h.push(Ma(o,l.key));else{const g=l.data.field(f.field);if(lm(g))throw new q(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new q(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(g)}return new Mo(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=sl(n.firestore);return function(o,a,l,u,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new q(F.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let _=0;_<h.length;_++){const C=h[_];if(g[_].field.isKeyField()){if(typeof C!="string")throw new q(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof C}`);if(!Fw(o)&&C.indexOf("/")!==-1)throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${C}' contains a slash.`);const N=o.path.child(nt.fromString(C));if(!ne.isDocumentKey(N))throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);const T=new ne(N);y.push(Ma(a,T))}else{const N=fP(l,u,C);y.push(N)}}return new Mo(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function JT(n,e,t){if(typeof(t=le(t))=="string"){if(t==="")throw new q(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fw(e)&&t.indexOf("/")!==-1)throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(nt.fromString(t));if(!ne.isDocumentKey(r))throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ma(n,new ne(r))}if(t instanceof Rt)return Ma(n,t._key);throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rm(t)}.`)}function XT(n,e){if(!Array.isArray(n)||n.length===0)throw new q(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function vP(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new q(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new q(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function wP(n,e){if(!(e instanceof Lh||e instanceof Xc))throw new q(F.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class IP{convertValue(e,t="none"){switch(Do(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Xt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(bi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fe(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Wo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[Sc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>Xt(o.doubleValue));return new Ss(t)}convertGeoPoint(e){return new Ys(Xt(e.latitude),Xt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=cm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zd(e));default:return null}}convertTimestamp(e){const t=Ti(e);return new _t(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=nt.fromString(e);xe(lN(r),9688,{name:e});const s=new La(r.get(1),r.get(3)),i=new ne(r.popFirst(5));return s.isEqual(t)||yn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function km(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class kI extends IP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B8(n){return new Yd("sum",Jd("sum",n))}function z8(n){return new Yd("avg",Jd("average",n))}function uU(){return new Yd("count")}function q8(n,e){var t,r;return n instanceof Yd&&e instanceof Yd&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function W8(n,e){return aP(n.query,e.query)&&qr(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xP="NOT SUPPORTED";class oo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ur extends Xd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new rg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(bm("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(F.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ur._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function G8(n,e,t){if(el(e,Ur._jsonSchema)){if(e.bundle===xP)throw new q(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=tl(n._databaseId),s=sP(e.bundle,r),i=s.Wu(),o=new dI(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new q(F.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=fm(r,a[0].document),u=new ne(nt.fromString(e.bundleName));return new Ur(n,new kI(n),u,l,new oo(!1,!1),t||null)}}Ur._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ur._jsonSchema={type:En("string",Ur._jsonSchemaVersion),bundleSource:En("string","DocumentSnapshot"),bundleName:En("string"),bundle:En("string")};class rg extends Ur{data(e={}){return super.data(e)}}class $r{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new oo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new rg(this._firestore,this._userDataWriter,r.key,r,new oo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new rg(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new rg(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:dU(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(F.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=$r._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Aw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function H8(n,e,t){if(el(e,$r._jsonSchema)){if(e.bundle===xP)throw new q(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=tl(n._databaseId),s=sP(e.bundle,r),i=s.Wu(),o=new dI(s.getMetadata(),r);for(const g of i)o.Ga(g);if(o.queries.length!==1)throw new q(F.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=pm(o.queries[0].bundledQuery),l=o.documents;let u=new xa;l.map(g=>{const y=fm(r,g.document);u=u.add(y)});const h=za.fromInitialDocuments(a,u,Ge(),!1,!1),f=new jn(n,t||null,a);return new $r(n,new kI(n),f,h)}}function dU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fe(61501,{type:n})}}function Q8(n,e){return n instanceof Ur&&e instanceof Ur?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof $r&&e instanceof $r&&n._firestore===e._firestore&&aP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hU(n){n=st(n,Rt);const e=st(n.firestore,Ot);return nP(un(e),n._key).then(t=>NI(e,n,t))}$r._jsonSchemaVersion="firestore/querySnapshot/1.0",$r._jsonSchema={type:En("string",$r._jsonSchemaVersion),bundleSource:En("string","QuerySnapshot"),bundleName:En("string"),bundle:En("string")};class Qo extends IP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rt(this.firestore,null,t)}}function K8(n){n=st(n,Rt);const e=st(n.firestore,Ot),t=un(e),r=new Qo(e);return q6(t,n._key).then(s=>new Ur(e,r,n._key,s,new oo(s!==null&&s.hasLocalMutations,!0),n.converter))}function Y8(n){n=st(n,Rt);const e=st(n.firestore,Ot);return nP(un(e),n._key,{source:"server"}).then(t=>NI(e,n,t))}function ad(n){n=st(n,jn);const e=st(n.firestore,Ot),t=un(e),r=new Qo(e);return yP(n._query),rP(t,n._query).then(s=>new $r(e,r,n,s))}function J8(n){n=st(n,jn);const e=st(n.firestore,Ot),t=un(e),r=new Qo(e);return W6(t,n._query).then(s=>new $r(e,r,n,s))}function X8(n){n=st(n,jn);const e=st(n.firestore,Ot),t=un(e),r=new Qo(e);return rP(t,n._query,{source:"server"}).then(s=>new $r(e,r,n,s))}function fU(n,e,t){n=st(n,Rt);const r=st(n.firestore,Ot),s=km(n.converter,e,t);return Mh(r,[Em(sl(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,rn.none())])}function Z8(n,e,t,...r){n=st(n,Rt);const s=st(n.firestore,Ot),i=sl(s);let o;return o=typeof(e=le(e))=="string"||e instanceof nl?bI(i,"updateDoc",n._key,e,t,r):TI(i,"updateDoc",n._key,e),Mh(s,[o.toMutation(n._key,rn.exists(!0))])}function gU(n){return Mh(st(n.firestore,Ot),[new Gc(n._key,rn.none())])}function oi(n,e){const t=st(n.firestore,Ot),r=ng(n),s=km(n.converter,e);return Mh(t,[Em(sl(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,rn.exists(!1))]).then(()=>r)}function ZT(n,...e){var l,u,h;n=le(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Yl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Yl(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof Rt)o=st(n.firestore,Ot),a=qc(n._key.path),i={next:f=>{e[r]&&e[r](NI(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=st(n,jn);o=st(f.firestore,Ot),a=f._query;const g=new Qo(o);i={next:y=>{e[r]&&e[r](new $r(o,g,f,y))},error:e[r+1],complete:e[r+2]},yP(n._query)}return function(g,y,_,C){const N=new Im(C),T=new uI(y,N,_);return g.asyncQueue.enqueueAndForget(async()=>aI(await Lc(g),T)),()=>{N.Nu(),g.asyncQueue.enqueueAndForget(async()=>lI(await Lc(g),T))}}(un(o),a,s,i)}function eW(n,e,...t){const r=le(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const g=l[f];if(typeof g!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(g.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=g:f==="bundleName"?u.bundleName=g:f==="bundleSource"&&(u.bundleSource=g)}return u}(e);if(s.error)throw new q(F.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Yl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Yl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,g,y){let _,C=!1;return YT(u,h.bundle).then(()=>nU(u,h.bundleName)).then(T=>{T&&!C&&(y&&T.withConverter(y),_=ZT(T,f||{},g))}).catch(T=>(g.error&&g.error(T),()=>{})),()=>{C||(C=!0,_&&_())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Yl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,g,y){let _,C=!1;return YT(u,h.bundle).then(()=>{if(!C){const T=new Rt(u,y||null,ne.fromPath(h.bundleName));_=ZT(T,f||{},g)}}).catch(T=>(g.error&&g.error(T),()=>{})),()=>{C||(C=!0,_&&_())}}(r,s,i,a,t[o])}throw new q(F.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function tW(n,e){return H6(un(n=st(n,Ot)),Yl(e)?e:{next:e})}function Mh(n,e){return function(r,s){const i=new On;return r.asyncQueue.enqueueAndForget(async()=>I6(await wI(r),s,i)),i.promise}(un(n),e)}function NI(n,e,t){const r=t.docs.get(e._key),s=new Qo(n);return new Ur(n,s,e._key,r,new oo(t.hasPendingWrites,t.fromCache),e.converter)}function nW(n){return pU(n,{count:uU()})}function pU(n,e){const t=st(n.firestore,Ot),r=un(t),s=dk(e,(i,o)=>new Gk(o,i.aggregateType,i._internalFieldPath));return G6(r,n._query,s).then(i=>function(a,l,u){const h=new Qo(a);return new rU(l,h,u)}(t,n,i))}class mU{constructor(e){this.kind="memory",this._onlineComponentProvider=Vo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new yI(void 0)}}toJSON(){return{kind:this.kind}}}class yU{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=xU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class _U{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Dc.provider}toJSON(){return{kind:this.kind}}}class vU{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new yI(e)}}toJSON(){return{kind:this.kind}}}function rW(){return new _U}function sW(n){return new vU(n==null?void 0:n.cacheSizeBytes)}function iW(n){return new mU(n)}function oW(n){return new yU(n)}class wU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vo.provider,this._offlineComponentProvider={build:t=>new _I(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class IU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vo.provider,this._offlineComponentProvider={build:t=>new XN(t,e==null?void 0:e.cacheSizeBytes)}}}function xU(n){return new wU(n==null?void 0:n.forceOwnership)}function aW(){return new IU}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SU={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=sl(e)}set(e,t,r){this._verifyNotCommitted();const s=ao(e,this._firestore),i=km(s.converter,t,r),o=Em(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,rn.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ao(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof nl?bI(this._dataReader,"WriteBatch.update",i._key,t,r,s):TI(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,rn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ao(e,this._firestore);return this._mutations=this._mutations.concat(new Gc(t._key,rn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new q(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ao(n,e){if((n=le(n)).firestore!==e)throw new q(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=sl(e)}get(e){const t=ao(e,this._firestore),r=new kI(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return fe(24041);const i=s[0];if(i.isFoundDocument())return new Xd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Xd(this._firestore,r,t._key,null,t.converter);throw fe(18433,{doc:i})})}set(e,t,r){const s=ao(e,this._firestore),i=km(s.converter,t,r),o=Em(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=ao(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof nl?bI(this._dataReader,"Transaction.update",i._key,t,r,s):TI(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=ao(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU extends TU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ao(e,this._firestore),r=new Qo(this._firestore);return super.get(e).then(s=>new Ur(this._firestore,r,t._key,s._document,new oo(!1,!1),t.converter))}}function lW(n,e,t){n=st(n,Ot);const r={...SU,...t};return function(i){if(i.maxAttempts<1)throw new q(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new On;return i.asyncQueue.enqueueAndForget(async()=>{const u=await tP(i);new U6(i.asyncQueue,u,a,o,l).ju()}),l.promise}(un(n),s=>e(new bU(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cW(){return new Ph("deleteField")}function gs(){return new II("serverTimestamp")}function uW(...n){return new xI("arrayUnion",n)}function dW(...n){return new SI("arrayRemove",n)}function hW(n){return new EI("increment",n)}function fW(n){return new Ss(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gW(n){return un(n=st(n,Ot)),new EU(n,e=>Mh(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pW(n,e){const t=un(n=st(n,Ot));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return as("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new q(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=eb(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Tm("setIndexConfiguration",eb(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new wa(g,2)):f.order==="ASCENDING"?h.push(new wa(g,0)):f.order==="DESCENDING"&&h.push(new wa(g,1))}a.push(new yc(yc.UNKNOWN_ID,u,h,_c.empty()))}return a}(e);return Y6(t,r)}function eb(n,e){if(typeof n[e]!="string")throw new q(F.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function mW(n){var s;n=st(n,Ot);const e=tb.get(n);if(e)return e;if(((s=un(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new AU(n);return tb.set(n,r),r}function yW(n){SP(n,!0)}function _W(n){SP(n,!1)}function vW(n){X6(un(n._firestore)).then(e=>Q("deleting all persistent cache indexes succeeded")).catch(e=>as("deleting all persistent cache indexes failed",e))}function SP(n,e){J6(un(n._firestore),e).then(t=>Q(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>as(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const tb=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wW(n){var r;const e=un(st(n.firestore,Ot)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:gm(t,ar(n._query)).ft}function IW(n,e){var i;const t=dk(e,(o,a)=>new Gk(a,o.aggregateType,o._internalFieldPath)),r=un(st(n.firestore,Ot)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:sN(s,kk(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xW{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return PI.instance.onExistenceFilterMismatch(e)}}class PI{constructor(){this.Mc=new Map}static get instance(){return bf||(bf=new PI,function(t){if(id)throw new Error("a TestingHooksSpi instance is already set");id=t}(bf)),bf}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let bf=null;(function(e,t=!0){(function(s){zc=s})(Ya),Ts(new Cr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Ot(new V4(r.getProvider("auth-internal")),new U4(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new q(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new La(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),br(NE,PE,e),br(NE,PE,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SW={PHONE:"phone",TOTP:"totp"},EW={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},TW={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},bW={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},AW={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function EP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const CW=CU,RU=EP,TP=new Qa("auth","Firebase",EP()),RW={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hp=new uh("@firebase/auth");function kU(n,...e){hp.logLevel<=rt.WARN&&hp.warn(`Auth (${Ya}): ${n}`,...e)}function sg(n,...e){hp.logLevel<=rt.ERROR&&hp.error(`Auth (${Ya}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(n,...e){throw LI(n,...e)}function fr(n,...e){return LI(n,...e)}function DI(n,e,t){const r={...RU(),[e]:t};return new Qa("auth","Firebase",r).create(e,{appName:n.name})}function Vn(n){return DI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Zc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Rr(n,"argument-error"),DI(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function LI(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return TP.create(n,...e)}function J(n,e,...t){if(!n)throw LI(e,...t)}function zs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw sg(e),new Error(e)}function Ai(n,e){n||zs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function MI(){return nb()==="http:"||nb()==="https:"}function nb(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(MI()||$0()||"connection"in navigator)?navigator.onLine:!0}function PU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ai(t>e,"Short delay should be less than long delay!"),this.isMobile=U0()||i1()}get(){return NU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OI(n,e){Ai(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],MU=new Oh(3e4,6e4);function Qt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Kt(n,e,t,r,s={}){return AP(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ka({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return HM()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Ni(n.emulatorConfig.host)&&(u.credentials="include"),bP.fetch()(await CP(n,n.config.apiHost,t,a),u)})}async function AP(n,e,t){n._canInitEmulator=!1;const r={...DU,...e};try{const s=new VU(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Vu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Vu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Vu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Vu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw DI(n,h,u);Rr(n,h)}}catch(s){if(s instanceof bs)throw s;Rr(n,"network-request-failed",{message:String(s)})}}async function Oi(n,e,t,r,s={}){const i=await Kt(n,e,t,r,s);return"mfaPendingCredential"in i&&Rr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function CP(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?OI(n.config,s):`${n.config.apiScheme}://${s}`;return LU.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function OU(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class VU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(fr(this.auth,"network-request-failed")),MU.get())})}}function Vu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=fr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rb(n){return n!==void 0&&n.getResponse!==void 0}function sb(n){return n!==void 0&&n.enterprise!==void 0}class RP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return OU(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FU(n){return(await Kt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function kP(n,e){return Kt(n,"GET","/v2/recaptchaConfig",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jU(n,e){return Kt(n,"POST","/v1/accounts:delete",e)}async function UU(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function fp(n,e){return Kt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ld(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kW(n,e=!1){return le(n).getIdToken(e)}async function $U(n,e=!1){const t=le(n),r=await t.getIdToken(e),s=Nm(r);J(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:ld($y(s.auth_time)),issuedAtTime:ld($y(s.iat)),expirationTime:ld($y(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function $y(n){return Number(n)*1e3}function Nm(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return sg("JWT malformed, contained fewer than 3 sections"),null;try{const s=Lg(t);return s?JSON.parse(s):(sg("Failed to decode base64 JWT payload"),null)}catch(s){return sg("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function ib(n){const e=Nm(n);return J(e,"internal-error"),J(typeof e.exp<"u","internal-error"),J(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ci(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof bs&&BU(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function BU({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ld(this.lastLoginAt),this.creationTime=ld(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eh(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Ci(n,fp(e,{idToken:t}));J(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?NP(s.providerUserInfo):[],o=WU(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Uv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function qU(n){const e=le(n);await eh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function WU(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function NP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GU(n,e){const t=await AP(n,{},async()=>{const r=Ka({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await CP(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&Ni(n.emulatorConfig.host)&&(l.credentials="include"),bP.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function HU(n,e){return Kt(n,"POST","/v2/accounts:revokeToken",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){J(e.idToken,"internal-error"),J(typeof e.idToken<"u","internal-error"),J(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ib(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){J(e.length!==0,"internal-error");const t=ib(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(J(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await GU(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Jl;return r&&(J(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(J(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(J(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Jl,this.toJSON())}_performRefresh(){return zs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(n,e){J(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class vs{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new zU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Uv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ci(this,this.stsTokenManager.getToken(this.auth,e));return J(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return $U(this,e)}reload(){return qU(this)}_assign(e){this!==e&&(J(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new vs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){J(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await eh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(en(this.auth.app))return Promise.reject(Vn(this.auth));const e=await this.getIdToken();return await Ci(this,jU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:g,isAnonymous:y,providerData:_,stsTokenManager:C}=t;J(f&&C,e,"internal-error");const N=Jl.fromJSON(this.name,C);J(typeof f=="string",e,"internal-error"),Wi(r,e.name),Wi(s,e.name),J(typeof g=="boolean",e,"internal-error"),J(typeof y=="boolean",e,"internal-error"),Wi(i,e.name),Wi(o,e.name),Wi(a,e.name),Wi(l,e.name),Wi(u,e.name),Wi(h,e.name);const T=new vs({uid:f,auth:e,email:s,emailVerified:g,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:N,createdAt:u,lastLoginAt:h});return _&&Array.isArray(_)&&(T.providerData=_.map(x=>({...x}))),l&&(T._redirectEventId=l),T}static async _fromIdTokenResponse(e,t,r=!1){const s=new Jl;s.updateFromServerResponse(t);const i=new vs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await eh(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];J(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?NP(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Jl;a.updateFromIdToken(r);const l=new vs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Uv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ob=new Map;function pi(n){Ai(n instanceof Function,"Expected a class definition");let e=ob.get(n);return e?(Ai(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ob.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}PP.type="NONE";const ab=PP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ig(n,e,t){return`firebase:${n}:${e}:${t}`}class Xl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ig(this.userKey,s.apiKey,i),this.fullPersistenceKey=ig("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await fp(this.auth,{idToken:e}).catch(()=>{});return t?vs._fromGetAccountInfoResponse(this.auth,t,e):null}return vs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Xl(pi(ab),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||pi(ab);const o=ig(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const g=await fp(e,{idToken:h}).catch(()=>{});if(!g)break;f=await vs._fromGetAccountInfoResponse(e,g,h)}else f=vs._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Xl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Xl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(OP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(DP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(FP(e))return"Blackberry";if(jP(e))return"Webos";if(LP(e))return"Safari";if((e.includes("chrome/")||MP(e))&&!e.includes("edge/"))return"Chrome";if(VP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function DP(n=Cn()){return/firefox\//i.test(n)}function LP(n=Cn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function MP(n=Cn()){return/crios\//i.test(n)}function OP(n=Cn()){return/iemobile/i.test(n)}function VP(n=Cn()){return/android/i.test(n)}function FP(n=Cn()){return/blackberry/i.test(n)}function jP(n=Cn()){return/webos/i.test(n)}function VI(n=Cn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function QU(n=Cn()){var e;return VI(n)&&!!((e=window.navigator)!=null&&e.standalone)}function KU(){return QM()&&document.documentMode===10}function UP(n=Cn()){return VI(n)||VP(n)||jP(n)||FP(n)||/windows phone/i.test(n)||OP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(n,e=[]){let t;switch(n){case"Browser":t=lb(Cn());break;case"Worker":t=`${lb(Cn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ya}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YU{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JU(n,e={}){return Kt(n,"GET","/v2/passwordPolicy",Qt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XU=6;class ZU{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??XU,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e${constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new cb(this),this.idTokenSubscription=new cb(this),this.beforeStateQueue=new YU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=TP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=pi(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Xl.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await fp(this,{idToken:e}),r=await vs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(en(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return J(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await eh(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=PU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(en(this.app))return Promise.reject(Vn(this));const t=e?le(e):null;return t&&J(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&J(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return en(this.app)?Promise.reject(Vn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return en(this.app)?Promise.reject(Vn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(pi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await JU(this),t=new ZU(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Qa("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await HU(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&pi(e)||this._popupRedirectResolver;J(t,this,"argument-error"),this.redirectPersistenceManager=await Xl.create(this,[pi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(J(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return J(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$P(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(en(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&kU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function gn(n){return le(n)}class cb{constructor(e){this.auth=e,this.observer=null,this.addObserver=tO(t=>this.observer=t)}get next(){return J(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function t$(n){Vh=n}function FI(n){return Vh.loadJS(n)}function n$(){return Vh.recaptchaV2Script}function r$(){return Vh.recaptchaEnterpriseScript}function s$(){return Vh.gapiScript}function BP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i$=500,o$=6e4,Af=1e12;class a${constructor(e){this.auth=e,this.counter=Af,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new u$(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||Af;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||Af;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||Af;return(r=this._widgets.get(t))==null||r.execute(),""}}class l${constructor(){this.enterprise=new c$}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class c${ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class u${constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;J(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=d$(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},o$)},i$))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function d$(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const h$="recaptcha-enterprise",cd="NO_RECAPTCHA";class zP{constructor(e){this.type=h$,this.auth=gn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{kP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new RP(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;sb(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(cd)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new l$().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&sb(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=r$();l.length!==0&&(l+=a),FI(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Tu(n,e,t,r=!1,s=!1){const i=new zP(n);let o;if(s)o=cd;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Eo(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Tu(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Tu(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Tu(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Tu(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await Tu(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function qP(n){const e=gn(n),t=await kP(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new RP(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new zP(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f$(n,e){const t=ei(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(qr(i,e??{}))return s;Rr(s,"already-initialized")}return t.initialize({options:e})}function g$(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(pi);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function p$(n,e,t){const r=gn(n);J(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=WP(e),{host:o,port:a}=m$(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){J(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),J(qr(u,r.config.emulator)&&qr(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ni(o)?(Op(`${i}//${o}${l}`),j0("Auth",!0)):s||y$()}function WP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function m$(n){const e=WP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ub(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ub(o)}}}function ub(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function y$(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return zs("not implemented")}_getIdTokenResponse(e){return zs("not implemented")}_linkToIdToken(e,t){return zs("not implemented")}_getReauthenticationResolver(e){return zs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GP(n,e){return Kt(n,"POST","/v1/accounts:resetPassword",Qt(n,e))}async function _$(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function v$(n,e){return Kt(n,"POST","/v1/accounts:signUp",e)}async function w$(n,e){return Kt(n,"POST","/v1/accounts:update",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I$(n,e){return Oi(n,"POST","/v1/accounts:signInWithPassword",Qt(n,e))}async function Pm(n,e){return Kt(n,"POST","/v1/accounts:sendOobCode",Qt(n,e))}async function x$(n,e){return Pm(n,e)}async function S$(n,e){return Pm(n,e)}async function E$(n,e){return Pm(n,e)}async function T$(n,e){return Pm(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b$(n,e){return Oi(n,"POST","/v1/accounts:signInWithEmailLink",Qt(n,e))}async function A$(n,e){return Oi(n,"POST","/v1/accounts:signInWithEmailLink",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th extends Fh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new th(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new th(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Eo(e,t,"signInWithPassword",I$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return b$(e,{email:this._email,oobCode:this._password});default:Rr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Eo(e,r,"signUpPassword",v$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return A$(e,{idToken:t,email:this._email,oobCode:this._password});default:Rr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _i(n,e){return Oi(n,"POST","/v1/accounts:signInWithIdp",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C$="http://localhost";class Ri extends Fh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ri(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Rr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Ri(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return _i(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_i(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_i(e,t)}buildRequest(){const e={requestUri:C$,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ka(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function db(n,e){return Kt(n,"POST","/v1/accounts:sendVerificationCode",Qt(n,e))}async function R$(n,e){return Oi(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,e))}async function k$(n,e){const t=await Oi(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,e));if(t.temporaryProof)throw Vu(n,"account-exists-with-different-credential",t);return t}const N$={USER_NOT_FOUND:"user-not-found"};async function P$(n,e){const t={...e,operation:"REAUTH"};return Oi(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,t),N$)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa extends Fh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Sa({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Sa({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return R$(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return k$(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return P$(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Sa({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D$(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function L$(n){const e=ku(Nu(n)).link,t=e?ku(Nu(e)).deep_link_id:null,r=ku(Nu(n)).deep_link_id;return(r?ku(Nu(r)).link:null)||r||t||e||n}class jh{constructor(e){const t=ku(Nu(e)),r=t.apiKey??null,s=t.oobCode??null,i=D$(t.mode??null);J(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=L$(e);try{return new jh(t)}catch{return null}}}function NW(n){return jh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(){this.providerId=ol.PROVIDER_ID}static credential(e,t){return th._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=jh.parseLink(t);return J(r,"argument-error"),th._fromEmailAndCode(e,r.code,r.tenantId)}}ol.PROVIDER_ID="password";ol.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ol.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu extends Vi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class og extends eu{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return J("providerId"in t&&"signInMethod"in t,"argument-error"),Ri._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return J(e.idToken||e.accessToken,"argument-error"),Ri._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return og.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return og.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new og(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi extends eu{constructor(){super("facebook.com")}static credential(e){return Ri._fromParams({providerId:Xi.PROVIDER_ID,signInMethod:Xi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xi.credentialFromTaggedObject(e)}static credentialFromError(e){return Xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xi.credential(e.oauthAccessToken)}catch{return null}}}Xi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui extends eu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ri._fromParams({providerId:ui.PROVIDER_ID,signInMethod:ui.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ui.credentialFromTaggedObject(e)}static credentialFromError(e){return ui.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ui.credential(t,r)}catch{return null}}}ui.GOOGLE_SIGN_IN_METHOD="google.com";ui.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi extends eu{constructor(){super("github.com")}static credential(e){return Ri._fromParams({providerId:Zi.PROVIDER_ID,signInMethod:Zi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zi.credentialFromTaggedObject(e)}static credentialFromError(e){return Zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zi.credential(e.oauthAccessToken)}catch{return null}}}Zi.GITHUB_SIGN_IN_METHOD="github.com";Zi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M$="http://localhost";class nh extends Fh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return _i(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_i(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_i(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new nh(r,i)}static _create(e,t){return new nh(e,t)}buildRequest(){return{requestUri:M$,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O$="saml.";class $v extends Vi{constructor(e){J(e.startsWith(O$),"argument-error"),super(e)}static credentialFromResult(e){return $v.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return $v.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=nh.fromJSON(e);return J(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return nh._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo extends eu{constructor(){super("twitter.com")}static credential(e,t){return Ri._fromParams({providerId:eo.PROVIDER_ID,signInMethod:eo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return eo.credentialFromTaggedObject(e)}static credentialFromError(e){return eo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return eo.credential(t,r)}catch{return null}}}eo.TWITTER_SIGN_IN_METHOD="twitter.com";eo.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HP(n,e){return Oi(n,"POST","/v1/accounts:signUp",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await vs._fromIdTokenResponse(e,r,s),o=hb(r);return new ls({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=hb(r);return new ls({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function hb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PW(n){var s;if(en(n.app))return Promise.reject(Vn(n));const e=gn(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ls({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await HP(e,{returnSecureToken:!0}),r=await ls._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp extends bs{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,gp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new gp(e,t,r,s)}}function QP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?gp._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KP(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DW(n,e){const t=le(n);await Dm(!0,t,e);const{providerUserInfo:r}=await UU(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=KP(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function jI(n,e,t=!1){const r=await Ci(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ls._forOperation(n,"link",r)}async function Dm(n,e,t){await eh(e);const r=KP(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";J(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YP(n,e,t=!1){const{auth:r}=n;if(en(r.app))return Promise.reject(Vn(r));const s="reauthenticate";try{const i=await Ci(n,QP(r,s,e,n),t);J(i.idToken,r,"internal-error");const o=Nm(i.idToken);J(o,r,"internal-error");const{sub:a}=o;return J(n.uid===a,r,"user-mismatch"),ls._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Rr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JP(n,e,t=!1){if(en(n.app))return Promise.reject(Vn(n));const r="signIn",s=await QP(n,r,e),i=await ls._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function UI(n,e){return JP(gn(n),e)}async function V$(n,e){const t=le(n);return await Dm(!1,t,e.providerId),jI(t,e)}async function F$(n,e){return YP(le(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j$(n,e){return Oi(n,"POST","/v1/accounts:signInWithCustomToken",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LW(n,e){if(en(n.app))return Promise.reject(Vn(n));const t=gn(n),r=await j$(t,{token:e,returnSecureToken:!0}),s=await ls._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?$I._fromServerResponse(e,t):"totpInfo"in t?BI._fromServerResponse(e,t):Rr(e,"internal-error")}}class $I extends Uh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new $I(t)}}class BI extends Uh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new BI(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(n,e,t){var r;J(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),J(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),J(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(J(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(J(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zI(n){const e=gn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function U$(n,e,t){const r=gn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Lm(r,s,t),await Eo(r,s,"getOobCode",S$,"EMAIL_PASSWORD_PROVIDER")}async function MW(n,e,t){await GP(le(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&zI(n),r})}async function OW(n,e){await w$(le(n),{oobCode:e})}async function $$(n,e){const t=le(n),r=await GP(t,{oobCode:e}),s=r.requestType;switch(J(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":J(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":J(r.mfaInfo,t,"internal-error");default:J(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Uh._fromServerResponse(gn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function VW(n,e){const{data:t}=await $$(le(n),e);return t.email}async function B$(n,e,t){if(en(n.app))return Promise.reject(Vn(n));const r=gn(n),o=await Eo(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",HP,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&zI(n),l}),a=await ls._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function z$(n,e,t){return en(n.app)?Promise.reject(Vn(n)):UI(le(n),ol.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&zI(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FW(n,e,t){const r=gn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){J(a.handleCodeInApp,r,"argument-error"),a&&Lm(r,o,a)}i(s,t),await Eo(r,s,"getOobCode",E$,"EMAIL_PASSWORD_PROVIDER")}function jW(n,e){const t=jh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function UW(n,e,t){if(en(n.app))return Promise.reject(Vn(n));const r=le(n),s=ol.credentialWithLink(e,t||Zd());return J(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),UI(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q$(n,e){return Kt(n,"POST","/v1/accounts:createAuthUri",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $W(n,e){const t=MI()?Zd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await q$(le(n),r);return s||[]}async function W$(n,e){const t=le(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Lm(t.auth,s,e);const{email:i}=await x$(t.auth,s);i!==n.email&&await n.reload()}async function BW(n,e,t){const r=le(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Lm(r.auth,i,t);const{email:o}=await T$(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G$(n,e){return Kt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zW(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=le(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ci(r,G$(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function qW(n,e){const t=le(n);return en(t.auth.app)?Promise.reject(Vn(t.auth)):XP(t,e,null)}function WW(n,e){return XP(le(n),null,e)}async function XP(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Ci(n,_$(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H$(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Nm(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Zl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new Q$(r,t);case"github.com":return new K$(r,t);case"google.com":return new Y$(r,t);case"twitter.com":return new J$(r,t,n.screenName||null);case"custom":case"anonymous":return new Zl(r,null);default:return new Zl(r,e,t)}}class Zl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class ZP extends Zl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class Q$ extends Zl{constructor(e,t){super(e,"facebook.com",t)}}class K$ extends ZP{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class Y$ extends Zl{constructor(e,t){super(e,"google.com",t)}}class J$ extends ZP{constructor(e,t,r){super(e,"twitter.com",t,r)}}function GW(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:H$(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X$(n,e){return le(n).setPersistence(e)}function HW(n){return qP(n)}async function QW(n,e){return gn(n).validatePassword(e)}function Z$(n,e,t,r){return le(n).onIdTokenChanged(e,t,r)}function eB(n,e,t){return le(n).beforeAuthStateChanged(e,t)}function KW(n,e,t,r){return le(n).onAuthStateChanged(e,t,r)}function YW(n){le(n).useDeviceLanguage()}function JW(n,e){return le(n).updateCurrentUser(e)}function XW(n){return le(n).signOut()}function ZW(n,e){return gn(n).revokeAccessToken(e)}async function e7(n){return le(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new pa("enroll",e,t)}static _fromMfaPendingCredential(e){return new pa("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return pa._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return pa._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=gn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Uh._fromServerResponse(r,a));J(s.mfaPendingCredential,r,"internal-error");const o=pa._fromMfaPendingCredential(s.mfaPendingCredential);return new qI(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await ls._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return J(t.user,r,"internal-error"),ls._forOperation(t.user,t.operationType,u);default:Rr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function t7(n,e){var s;const t=le(n),r=e;return J(e.customData.operationType,t,"argument-error"),J((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),qI._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fb(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",Qt(n,e))}function tB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Qt(n,e))}function nB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",Qt(n,e))}function rB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Qt(n,e))}function sB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Qt(n,e))}class WI{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Uh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new WI(e)}async getSession(){return pa._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Ci(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Ci(this.user,sB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const By=new WeakMap;function n7(n){const e=le(n);return By.has(e)||By.set(e,WI._fromUser(e)),By.get(e)}const pp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eD{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(pp,"1"),this.storage.removeItem(pp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iB=1e3,oB=10;class tD extends eD{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=UP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);KU()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,oB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},iB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tD.type="LOCAL";const nD=tD;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aB=1e3;function zy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function qy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class rD{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=qy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return zy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=qy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=qy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(g=>g.name===r);h&&t(h.value),u.deleted.find(g=>g.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=zy(r);const i=setInterval(()=>{const a=zy(r);a!==s&&(t(a),s=a)},aB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}rD.type="COOKIE";const r7=rD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sD extends eD{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sD.type="SESSION";const iD=sD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Mm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await lB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Mm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Om(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Om("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===u)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(){return window}function uB(n){xn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GI(){return typeof xn().WorkerGlobalScope<"u"&&typeof xn().importScripts=="function"}async function dB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function fB(){return GI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD="firebaseLocalStorageDb",gB=1,mp="firebaseLocalStorage",aD="fbase_key";class $h{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Vm(n,e){return n.transaction([mp],e?"readwrite":"readonly").objectStore(mp)}function pB(){const n=indexedDB.deleteDatabase(oD);return new $h(n).toPromise()}function Bv(){const n=indexedDB.open(oD,gB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(mp,{keyPath:aD})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(mp)?e(r):(r.close(),await pB(),e(await Bv()))})})}async function gb(n,e,t){const r=Vm(n,!0).put({[aD]:e,value:t});return new $h(r).toPromise()}async function mB(n,e){const t=Vm(n,!1).get(e),r=await new $h(t).toPromise();return r===void 0?null:r.value}function pb(n,e){const t=Vm(n,!0).delete(e);return new $h(t).toPromise()}const yB=800,_B=3;class lD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Bv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>_B)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return GI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Mm._getInstance(fB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await dB(),!this.activeServiceWorker)return;this.sender=new cB(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||hB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Bv();return await gb(e,pp,"1"),await pb(e,pp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>gb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>mB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Vm(s,!1).getAll();return new $h(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),yB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lD.type="LOCAL";const vB=lD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mb(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:start",Qt(n,e))}function wB(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",Qt(n,e))}function IB(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=BP("rcb"),xB=new Oh(3e4,6e4);class SB{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=xn().grecaptcha)!=null&&e.render)}load(e,t=""){return J(EB(t),e,"argument-error"),this.shouldResolveImmediately(t)&&rb(xn().grecaptcha)?Promise.resolve(xn().grecaptcha):new Promise((r,s)=>{const i=xn().setTimeout(()=>{s(fr(e,"network-request-failed"))},xB.get());xn()[Wy]=()=>{xn().clearTimeout(i),delete xn()[Wy];const a=xn().grecaptcha;if(!a||!rb(a)){s(fr(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${n$()}?${Ka({onload:Wy,render:"explicit",hl:t})}`;FI(o).catch(()=>{clearTimeout(i),s(fr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=xn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function EB(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class TB{async load(e){return new a$(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ud="recaptcha",bB={theme:"light",type:"image"};class s7{constructor(e,t,r={...bB}){this.parameters=r,this.type=ud,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=gn(e),this.isInvisible=this.parameters.size==="invisible",J(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;J(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new TB:new SB,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){J(!this.parameters.sitekey,this.auth,"argument-error"),J(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),J(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=xn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){J(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){J(MI()&&!GI(),this.auth,"internal-error"),await AB(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await FU(this.auth);J(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return J(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function AB(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Sa._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function i7(n,e,t){if(en(n.app))return Promise.reject(Vn(n));const r=gn(n),s=await Fm(r,e,le(t));return new HI(s,i=>UI(r,i))}async function o7(n,e,t){const r=le(n);await Dm(!1,r,"phone");const s=await Fm(r.auth,e,le(t));return new HI(s,i=>V$(r,i))}async function a7(n,e,t){const r=le(n);if(en(r.auth.app))return Promise.reject(Vn(r.auth));const s=await Fm(r.auth,e,le(t));return new HI(s,i=>F$(r,i))}async function Fm(n,e,t){var r;if(!n._getRecaptchaConfig())try{await qP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){J(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Eo(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===cd){J((t==null?void 0:t.type)===ud,h,"argument-error");const g=await Gy(h,f,t);return fb(h,g)}return fb(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{J(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;J(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Eo(n,a,"mfaSmsSignIn",async(f,g)=>{if(g.phoneSignInInfo.captchaResponse===cd){J((t==null?void 0:t.type)===ud,f,"argument-error");const y=await Gy(f,g,t);return mb(f,y)}return mb(f,g)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Eo(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===cd){J((t==null?void 0:t.type)===ud,u,"argument-error");const f=await Gy(u,h,t);return db(u,f)}return db(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function l7(n,e){const t=le(n);if(en(t.auth.app))return Promise.reject(Vn(t.auth));await jI(t,e)}async function Gy(n,e,t){J(t.type===ud,n,"argument-error");const r=await t.verify();J(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e){this.providerId=ec.PROVIDER_ID,this.auth=gn(e)}verifyPhoneNumber(e,t){return Fm(this.auth,e,le(t))}static credential(e,t){return Sa._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ec.credentialFromTaggedObject(t)}static credentialFromError(e){return ec.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Sa._fromTokenResponse(t,r):null}}ec.PROVIDER_ID="phone";ec.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function al(n,e){return e?pi(e):(J(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI extends Fh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _i(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _i(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _i(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function CB(n){return JP(n.auth,new QI(n),n.bypassAuthState)}function RB(n){const{auth:e,user:t}=n;return J(t,e,"internal-error"),YP(t,new QI(n),n.bypassAuthState)}async function kB(n){const{auth:e,user:t}=n;return J(t,e,"internal-error"),jI(t,new QI(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return CB;case"linkViaPopup":case"linkViaRedirect":return kB;case"reauthViaPopup":case"reauthViaRedirect":return RB;default:Rr(this.auth,"internal-error")}}resolve(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NB=new Oh(2e3,1e4);async function PB(n,e,t){if(en(n.app))return Promise.reject(fr(n,"operation-not-supported-in-this-environment"));const r=gn(n);Zc(n,e,Vi);const s=al(r,t);return new mi(r,"signInViaPopup",e,s).executeNotNull()}async function c7(n,e,t){const r=le(n);if(en(r.auth.app))return Promise.reject(fr(r.auth,"operation-not-supported-in-this-environment"));Zc(r.auth,e,Vi);const s=al(r.auth,t);return new mi(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function u7(n,e,t){const r=le(n);Zc(r.auth,e,Vi);const s=al(r.auth,t);return new mi(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class mi extends cD{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,mi.currentPopupAction&&mi.currentPopupAction.cancel(),mi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return J(e,this.auth,"internal-error"),e}async onExecution(){Ai(this.filter.length===1,"Popup operations only handle one event");const e=Om();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(fr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(fr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,mi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,NB.get())};e()}}mi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB="pendingRedirect",ag=new Map;class LB extends cD{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=ag.get(this.auth._key());if(!e){try{const r=await MB(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}ag.set(this.auth._key(),e)}return this.bypassAuthState||ag.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function MB(n,e){const t=dD(e),r=uD(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function KI(n,e){return uD(n)._set(dD(e),"true")}function OB(n,e){ag.set(n._key(),e)}function uD(n){return pi(n._redirectPersistence)}function dD(n){return ig(DB,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d7(n,e,t){return VB(n,e,t)}async function VB(n,e,t){if(en(n.app))return Promise.reject(Vn(n));const r=gn(n);Zc(n,e,Vi),await r._initializationPromise;const s=al(r,t);return await KI(s,r),s._openRedirect(r,e,"signInViaRedirect")}function h7(n,e,t){return FB(n,e,t)}async function FB(n,e,t){const r=le(n);if(Zc(r.auth,e,Vi),en(r.auth.app))return Promise.reject(Vn(r.auth));await r.auth._initializationPromise;const s=al(r.auth,t);await KI(s,r.auth);const i=await fD(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function f7(n,e,t){return jB(n,e,t)}async function jB(n,e,t){const r=le(n);Zc(r.auth,e,Vi),await r.auth._initializationPromise;const s=al(r.auth,t);await Dm(!1,r,e.providerId),await KI(s,r.auth);const i=await fD(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function g7(n,e){return await gn(n)._initializationPromise,hD(n,e,!1)}async function hD(n,e,t=!1){if(en(n.app))return Promise.reject(Vn(n));const r=gn(n),s=al(r,e),o=await new LB(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function fD(n){const e=Om(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UB=10*60*1e3;class $B{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!BB(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!gD(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(fr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=UB&&this.cachedEventUids.clear(),this.cachedEventUids.has(yb(e))}saveEventToCache(e){this.cachedEventUids.add(yb(e)),this.lastProcessedEventTime=Date.now()}}function yb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function gD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function BB(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return gD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zB(n,e={}){return Kt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,WB=/^https?/;async function GB(n){if(n.config.emulator)return;const{authorizedDomains:e}=await zB(n);for(const t of e)try{if(HB(t))return}catch{}Rr(n,"unauthorized-domain")}function HB(n){const e=Zd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!WB.test(t))return!1;if(qB.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QB=new Oh(3e4,6e4);function _b(){const n=xn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function KB(n){return new Promise((e,t)=>{var s,i,o;function r(){_b(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{_b(),t(fr(n,"network-request-failed"))},timeout:QB.get()})}if((i=(s=xn().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=xn().gapi)!=null&&o.load)r();else{const a=BP("iframefcb");return xn()[a]=()=>{gapi.load?r():t(fr(n,"network-request-failed"))},FI(`${s$()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw lg=null,e})}let lg=null;function YB(n){return lg=lg||KB(n),lg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JB=new Oh(5e3,15e3),XB="__/auth/iframe",ZB="emulator/auth/iframe",ez={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function nz(n){const e=n.config;J(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?OI(e,ZB):`https://${n.config.authDomain}/${XB}`,r={apiKey:e.apiKey,appName:n.name,v:Ya},s=tz.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ka(r).slice(1)}`}async function rz(n){const e=await YB(n),t=xn().gapi;return J(t,n,"internal-error"),e.open({where:document.body,url:nz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ez,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=fr(n,"network-request-failed"),a=xn().setTimeout(()=>{i(o)},JB.get());function l(){xn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},iz=500,oz=600,az="_blank",lz="http://localhost";class vb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cz(n,e,t,r=iz,s=oz){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...sz,width:r.toString(),height:s.toString(),top:i,left:o},u=Cn().toLowerCase();t&&(a=MP(u)?az:t),DP(u)&&(e=e||lz,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[y,_])=>`${g}${y}=${_},`,"");if(QU(u)&&a!=="_self")return uz(e||"",a),new vb(null);const f=window.open(e||"",a,h);J(f,n,"popup-blocked");try{f.focus()}catch{}return new vb(f)}function uz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz="__/auth/handler",hz="emulator/auth/handler",fz=encodeURIComponent("fac");async function wb(n,e,t,r,s,i){J(n.config.authDomain,n,"auth-domain-config-required"),J(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ya,eventId:s};if(e instanceof Vi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Mg(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof eu){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${fz}=${encodeURIComponent(l)}`:"";return`${gz(n)}?${Ka(a).slice(1)}${u}`}function gz({config:n}){return n.emulator?OI(n,hz):`https://${n.authDomain}/${dz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hy="webStorageSupport";class pz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iD,this._completeRedirectFn=hD,this._overrideRedirectResult=OB}async _openPopup(e,t,r,s){var o;Ai((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await wb(e,t,r,Zd(),s);return cz(e,i,Om())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await wb(e,t,r,Zd(),s);return uB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ai(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await rz(e),r=new $B(e);return t.register("authEvent",s=>(J(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Hy,{type:Hy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Hy];i!==void 0&&t(!!i),Rr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=GB(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return UP()||LP()||VI()}}const mz=pz;class pD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return zs("unexpected MultiFactorSessionType")}}}class YI extends pD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new YI(e)}_finalizeEnroll(e,t,r){return tB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return wB(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class yz{constructor(){}static assertion(e){return YI._fromCredential(e)}}yz.FACTOR_ID="phone";class _z{static assertionForEnrollment(e,t){return rh._fromSecret(e,t)}static assertionForSignIn(e,t){return rh._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;J(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await nB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return JI._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}_z.FACTOR_ID="totp";class rh extends pD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new rh(t,void 0,e)}static _fromEnrollmentId(e,t){return new rh(t,e)}async _finalizeEnroll(e,t,r){return J(typeof this.secret<"u",e,"argument-error"),rB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){J(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return IB(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class JI{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new JI(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(Cf(e)||Cf(t))&&(r=!0),r&&(Cf(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),Cf(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Cf(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Ib="@firebase/auth",xb="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){J(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Iz(n){Ts(new Cr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;J(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$P(n)},u=new e$(r,s,i,l);return g$(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ts(new Cr("auth-internal",e=>{const t=gn(e.getProvider("auth").getImmediate());return(r=>new vz(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),br(Ib,xb,wz(n)),br(Ib,xb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xz=5*60,Sz=n1("authIdTokenMaxAge")||xz;let Sb=null;const Ez=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Sz)return;const s=t==null?void 0:t.token;Sb!==s&&(Sb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Tz(n=dh()){const e=ei(n,"auth");if(e.isInitialized())return e.getImmediate();const t=f$(n,{popupRedirectResolver:mz,persistence:[vB,nD,iD]}),r=n1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Ez(i.toString());eB(t,o,()=>o(t.currentUser)),Z$(t,a=>o(a))}}const s=ZC("auth");return s&&p$(t,`http://${s}`),t}function bz(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}t$({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=fr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",bz().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Iz("Browser");const mD="@firebase/installations",XI="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD=1e4,_D=`w:${XI}`,vD="FIS_v2",Az="https://firebaseinstallations.googleapis.com/v1",Cz=60*60*1e3,Rz="installations",kz="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},qa=new Qa(Rz,kz,Nz);function wD(n){return n instanceof bs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ID({projectId:n}){return`${Az}/projects/${n}/installations`}function xD(n){return{token:n.token,requestStatus:2,expiresIn:Dz(n.expiresIn),creationTime:Date.now()}}async function SD(n,e){const r=(await e.json()).error;return qa.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function ED({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Pz(n,{refreshToken:e}){const t=ED(n);return t.append("Authorization",Lz(e)),t}async function TD(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Dz(n){return Number(n.replace("s","000"))}function Lz(n){return`${vD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mz({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=ID(n),s=ED(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:vD,appId:n.appId,sdkVersion:_D},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await TD(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:xD(u.authToken)}}else throw await SD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oz(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vz=/^[cdef][\w-]{21}$/,zv="";function Fz(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=jz(n);return Vz.test(t)?t:zv}catch{return zv}}function jz(n){return Oz(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jm(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD=new Map;function CD(n,e){const t=jm(n);RD(t,e),Uz(t,e)}function RD(n,e){const t=AD.get(n);if(t)for(const r of t)r(e)}function Uz(n,e){const t=$z();t&&t.postMessage({key:n,fid:e}),Bz()}let ma=null;function $z(){return!ma&&"BroadcastChannel"in self&&(ma=new BroadcastChannel("[Firebase] FID Change"),ma.onmessage=n=>{RD(n.data.key,n.data.fid)}),ma}function Bz(){AD.size===0&&ma&&(ma.close(),ma=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zz="firebase-installations-database",qz=1,Wa="firebase-installations-store";let Qy=null;function ZI(){return Qy||(Qy=g1(zz,qz,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Wa)}}})),Qy}async function yp(n,e){const t=jm(n),s=(await ZI()).transaction(Wa,"readwrite"),i=s.objectStore(Wa),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&CD(n,e.fid),e}async function kD(n){const e=jm(n),r=(await ZI()).transaction(Wa,"readwrite");await r.objectStore(Wa).delete(e),await r.done}async function Um(n,e){const t=jm(n),s=(await ZI()).transaction(Wa,"readwrite"),i=s.objectStore(Wa),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&CD(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ex(n){let e;const t=await Um(n.appConfig,r=>{const s=Wz(r),i=Gz(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===zv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function Wz(n){const e=n||{fid:Fz(),registrationStatus:0};return ND(e)}function Gz(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(qa.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=Hz(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Qz(n)}:{installationEntry:e}}async function Hz(n,e){try{const t=await Mz(n,e);return yp(n.appConfig,t)}catch(t){throw wD(t)&&t.customData.serverCode===409?await kD(n.appConfig):await yp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Qz(n){let e=await Eb(n.appConfig);for(;e.registrationStatus===1;)await bD(100),e=await Eb(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await ex(n);return r||t}return e}function Eb(n){return Um(n,e=>{if(!e)throw qa.create("installation-not-found");return ND(e)})}function ND(n){return Kz(n)?{fid:n.fid,registrationStatus:0}:n}function Kz(n){return n.registrationStatus===1&&n.registrationTime+yD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yz({appConfig:n,heartbeatServiceProvider:e},t){const r=Jz(n,t),s=Pz(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:_D,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await TD(()=>fetch(r,a));if(l.ok){const u=await l.json();return xD(u)}else throw await SD("Generate Auth Token",l)}function Jz(n,{fid:e}){return`${ID(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tx(n,e=!1){let t;const r=await Um(n.appConfig,i=>{if(!PD(i))throw qa.create("not-registered");const o=i.authToken;if(!e&&e9(o))return i;if(o.requestStatus===1)return t=Xz(n,e),i;{if(!navigator.onLine)throw qa.create("app-offline");const a=n9(i);return t=Zz(n,a),a}});return t?await t:r.authToken}async function Xz(n,e){let t=await Tb(n.appConfig);for(;t.authToken.requestStatus===1;)await bD(100),t=await Tb(n.appConfig);const r=t.authToken;return r.requestStatus===0?tx(n,e):r}function Tb(n){return Um(n,e=>{if(!PD(e))throw qa.create("not-registered");const t=e.authToken;return r9(t)?{...e,authToken:{requestStatus:0}}:e})}async function Zz(n,e){try{const t=await Yz(n,e),r={...e,authToken:t};return await yp(n.appConfig,r),t}catch(t){if(wD(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await kD(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await yp(n.appConfig,r)}throw t}}function PD(n){return n!==void 0&&n.registrationStatus===2}function e9(n){return n.requestStatus===2&&!t9(n)}function t9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Cz}function n9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function r9(n){return n.requestStatus===1&&n.requestTime+yD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s9(n){const e=n,{installationEntry:t,registrationPromise:r}=await ex(e);return r?r.catch(console.error):tx(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i9(n,e=!1){const t=n;return await o9(t),(await tx(t,e)).token}async function o9(n){const{registrationPromise:e}=await ex(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a9(n){if(!n||!n.options)throw Ky("App Configuration");if(!n.name)throw Ky("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Ky(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Ky(n){return qa.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD="installations",l9="installations-internal",c9=n=>{const e=n.getProvider("app").getImmediate(),t=a9(e),r=ei(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},u9=n=>{const e=n.getProvider("app").getImmediate(),t=ei(e,DD).getImmediate();return{getId:()=>s9(t),getToken:s=>i9(t,s)}};function d9(){Ts(new Cr(DD,c9,"PUBLIC")),Ts(new Cr(l9,u9,"PRIVATE"))}d9();br(mD,XI);br(mD,XI,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _p="analytics",h9="firebase_id",f9="origin",g9=60*1e3,p9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",nx="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ar=new uh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Br=new Qa("analytics","Analytics",m9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y9(n){if(!n.startsWith(nx)){const e=Br.create("invalid-gtag-resource",{gtagURL:n});return Ar.warn(e.message),""}return n}function LD(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function _9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function v9(n,e){const t=_9("firebase-js-sdk-policy",{createScriptURL:y9}),r=document.createElement("script"),s=`${nx}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function w9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function I9(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await LD(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){Ar.error(a)}n("config",s,i)}async function x9(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await LD(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Ar.error(i)}}function S9(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await x9(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await I9(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Ar.error(a)}}return s}function E9(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=S9(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function T9(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(nx)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b9=30,A9=1e3;class C9{constructor(e={},t=A9){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const MD=new C9;function R9(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function k9(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:R9(t)},s=p9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw Br.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function N9(n,e=MD,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw Br.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Br.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new L9;return setTimeout(async()=>{a.abort()},t!==void 0?t:g9),OD({appId:r,apiKey:s,measurementId:i},o,a,e)}async function OD(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=MD){var a;const{appId:i,measurementId:o}=n;try{await P9(r,e)}catch(l){if(o)return Ar.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await k9(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!D9(u)){if(s.deleteThrottleMetadata(i),o)return Ar.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?BS(t,s.intervalMillis,b9):BS(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),Ar.debug(`Calling attemptFetch again in ${h} millis`),OD(n,f,r,s)}}function P9(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(Br.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function D9(n){if(!(n instanceof bs)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class L9{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function M9(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O9(){if(Vp())try{await B0()}catch(n){return Ar.warn(Br.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Ar.warn(Br.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function V9(n,e,t,r,s,i,o){const a=N9(n);a.then(g=>{t[g.measurementId]=g.appId,n.options.measurementId&&g.measurementId!==n.options.measurementId&&Ar.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${g.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(g=>Ar.error(g)),e.push(a);const l=O9().then(g=>{if(g)return r.getId()}),[u,h]=await Promise.all([a,l]);T9(i)||v9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[f9]="firebase",f.update=!0,h!=null&&(f[h9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F9{constructor(e){this.app=e}_delete(){return delete dd[this.app.options.appId],Promise.resolve()}}let dd={},bb=[];const Ab={};let Yy="dataLayer",j9="gtag",Cb,VD,Rb=!1;function U9(){const n=[];if($0()&&n.push("This is a browser extension environment."),c1()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=Br.create("invalid-analytics-context",{errorInfo:e});Ar.warn(t.message)}}function $9(n,e,t){U9();const r=n.options.appId;if(!r)throw Br.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Ar.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Br.create("no-api-key");if(dd[r]!=null)throw Br.create("already-exists",{id:r});if(!Rb){w9(Yy);const{wrappedGtag:i,gtagCore:o}=E9(dd,bb,Ab,Yy,j9);VD=i,Cb=o,Rb=!0}return dd[r]=V9(n,bb,Ab,e,Cb,Yy,t),new F9(n)}function B9(n=dh()){n=le(n);const e=ei(n,_p);return e.isInitialized()?e.getImmediate():z9(n)}function z9(n,e={}){const t=ei(n,_p);if(t.isInitialized()){const s=t.getImmediate();if(qr(e,t.getOptions()))return s;throw Br.create("already-initialized")}return t.initialize({options:e})}async function q9(){if($0()||!c1()||!Vp())return!1;try{return await B0()}catch{return!1}}function W9(n,e,t,r){n=le(n),M9(VD,dd[n.app.options.appId],e,t,r).catch(s=>Ar.error(s))}const kb="@firebase/analytics",Nb="0.10.18";function G9(){Ts(new Cr(_p,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return $9(r,s,t)},"PUBLIC")),Ts(new Cr("analytics-internal",n,"PRIVATE")),br(kb,Nb),br(kb,Nb,"esm2020");function n(e){try{const t=e.getProvider(_p).getImmediate();return{logEvent:(r,s,i)=>W9(t,r,s,i)}}catch(t){throw Br.create("interop-component-reg-failed",{reason:t})}}}G9();const FD={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},$m=iV().length?dh():p1(FD),H=k4($m,FD.databaseURL),ci=tU($m),lo=Tz($m);console.log("✅ Firebase services initialized:",{db:!!H,firestore:!!ci,auth:!!lo});X$(lo,nD).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let H9=null;(async()=>{try{await q9()&&(H9=B9($m))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();class Bm{constructor(e,t){this.db=e,this.userUID=t,this.userRef=he(e,`users/${t}`),this.statsRef=he(e,`users/${t}/stats`),this.profileRef=he(e,`users/${t}/profile`),this.behaviorLogRef=he(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(`🔄 StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await Be(this.statsRef);if(!s.exists())return console.error(`❌ StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(`🔄 StatManager: ${e} change: ${o} → ${a} (${t>0?"+":""}${t})`),console.log(`🔄 StatManager: About to write to Firebase - ${e}: ${a}`),console.log("🔄 StatManager: Writing to path:",this.statsRef.toString()),console.log("🔄 StatManager: Full stats object to write:",{...i,[e]:a});try{await Xe(this.statsRef,{...i,[e]:a}),console.log(`✅ StatManager: Successfully updated ${e} in Firebase`)}catch(l){throw console.error(`❌ StatManager: Firebase write failed for ${e}:`,l),l}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`❌ StatManager: CRITICAL ERROR updating ${e}:`,s),console.error("❌ StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await Be(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Be(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log("🔄 StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await Be(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await Be(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log("🔄 StatManager: Last relapse exists:",t.exists()),console.log("🔄 StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),l=r.exists()?r.val():1;console.log(`🔄 StatManager: Current escalation level from Firebase: ${l}`),console.log(`🔄 StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(`🔄 StatManager: After 7+ days clean → escalation level reset to: ${s}`)):(s=l+1,console.log(`🔄 StatManager: Within ${a} days → escalation level: ${l} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(`🔄 StatManager: Escalation level ${s} → addiction increase: +${i}`),console.log("🔄 StatManager: Updating all stats in single write operation...");try{const o=await Be(this.statsRef);if(!o.exists())return console.error("❌ StatManager: No stats found for user"),!1;const a=o.val();console.log("🔄 StatManager: Current stats before relapse:",a);const l=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(`🔄 StatManager: addictionLevel change: ${a.addictionLevel} → ${l} (+${i})`),console.log(`🔄 StatManager: mentalStrength change: ${a.mentalStrength} → ${u} (-3)`),console.log(`🔄 StatManager: triggerDefense change: ${a.triggerDefense} → ${h} (-3)`);const f={...a,addictionLevel:l,mentalStrength:u,triggerDefense:h};console.log("🔄 StatManager: Writing complete updated stats:",f),await Xe(this.statsRef,f),console.log("✅ StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error("❌ StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([Xe(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),Xe(he(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),Xe(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await Xe(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await Be(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Be(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await Be(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,l=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:l,cleanWeeks:u,isCleanFor7Days:l>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await Be(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await Be(he(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Be(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await Be(he(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),Xe(he(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Xe(he(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Be(he(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Be(he(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Be(he(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=await Be(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<1)return;const o=await Be(he(this.db,`users/${this.userUID}/profile/lastActivity`));if(o.exists()){const u=new Date(o.val()),h=Math.floor((r-u)/(1e3*60*60*24));if(h>=7&&i>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${h} days since last activity`);return}}let a=null,l=null;for(let u=0;u<10;u++){const h=new Date;h.setDate(h.getDate()-u);const f=h.toDateString(),g=await Be(he(this.db,`users/${this.userUID}/profile/daily/${f}/logged`));if(g.exists()&&g.val()){a=u,l=h;break}}if(a===null||a>=7)if(l){const u=Math.floor((r-l)/864e5);u>=7&&i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${u} days since last activity`))}else i>=7&&(await this.updateStat("motivation",1,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${i} days since registration with no activity`))}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await Be(he(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await Xe(he(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await g4(he(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await Be(he(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await Be(he(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await Be(he(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Xe(he(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Xe(he(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await Be(he(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Xe(he(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await Be(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await Be(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,l=t.canAwardTriggerDefense?3:0;await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+l)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await Be(he(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await Be(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await Be(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,l=t.canAwardTriggerDefense?.25:0;await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+l)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await Be(he(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const Q9=Object.freeze(Object.defineProperty({__proto__:null,default:Bm},Symbol.toStringTag,{value:"Module"}));class tc{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=Jr(e,"matchingPool"),this.buddyPairsCollection=Jr(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:gs(),lastActive:gs(),status:"waiting"};return await fU(ng(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await gU(ng(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:gs(),status:"active",...r},i=await oi(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await ad(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=ng(this.matchingPoolCollection,e),r=await hU(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async getUserBuddyPair(e){try{console.log("🔄 Firestore: Getting buddy pair for user:",e);const t=jl(this.buddyPairsCollection,Ul("user1Id","==",e)),r=jl(this.buddyPairsCollection,Ul("user2Id","==",e)),[s,i]=await Promise.all([ad(t),ad(r)]);let o=null;if(s.empty?i.empty||(o=i.docs[0]):o=s.docs[0],o){const a=o.data();return console.log("✅ Firestore: Found buddy pair:",o.id),{id:o.id,...a}}else return console.log("ℹ️ Firestore: No buddy pair found for user"),null}catch(t){return console.error("❌ Firestore: Error getting buddy pair:",t),null}}async testConnectivity(){try{return console.log("🧪 Firestore: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ Firestore: Service available and initialized"),!0):(console.warn("⚠️ Firestore: Service not properly initialized"),!1)}catch(e){return console.warn("⚠️ Firestore: Connectivity check failed (non-critical):",(e==null?void 0:e.message)||e),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}class K9{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log("🚀 FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:gs(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await oi(Jr(this.firestore,this.collections.cravings),r);return console.log("✅ Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:gs(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await oi(Jr(this.firestore,this.collections.relapses),r);return console.log("✅ Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:gs(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await oi(Jr(this.firestore,this.collections.hydration),r);return console.log("✅ Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:gs(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await oi(Jr(this.firestore,this.collections.breathing),r);return console.log("✅ Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:gs(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await oi(Jr(this.firestore,this.collections.meditation),r);return console.log("✅ Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:gs(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await oi(Jr(this.firestore,this.collections.physicalActivity),r);return console.log("✅ Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:gs(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await oi(Jr(this.firestore,this.collections.moodTracking),r);return console.log("✅ Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=jl(Jr(this.firestore,this.collections[t]),Ul("userId","==",e),cU("timestamp","desc"));r&&(i=jl(i,Ul("timestamp",">=",_t.fromDate(new Date(r))))),s&&(i=jl(i,Ul("timestamp","<=",_t.fromDate(new Date(s)))));const o=await ad(i),a=[];return o.forEach(l=>{var u;a.push({id:l.id,...l.data(),timestamp:((u=l.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(`✅ Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(`❌ Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(`📊 Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,l,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(y=>(console.warn("⚠️ Cravings data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(y=>(console.warn("⚠️ Relapses data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(y=>(console.warn("⚠️ Hydration data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(y=>(console.warn("⚠️ Breathing data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(y=>(console.warn("⚠️ Meditation data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(y=>(console.warn("⚠️ Physical activity data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(y=>(console.warn("⚠️ Mood data not available yet (indexes building):",y.message),[]))]),g={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(y=>y.outcome==="resisted").length,relapsed:i.filter(y=>y.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((y,_)=>y+(_.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((y,_)=>y+(_.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(y=>y.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(y=>y.achievedTarget).length,breathingExercises:l.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:l.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((y,_)=>y+(_.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,l,u,h,f),generatedAt:new Date};return console.log("📊 Behavioral analytics generated:",g),g}catch(r){throw console.error("❌ Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const l=[],u=e.filter(y=>y.outcome==="resisted").length,h=e.length;if(h>0){const y=u/h*100;l.push(`Craving resistance rate: ${y.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&l.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const g=r.filter(y=>y.achievedTarget).length;return g>0&&l.push(`Achieved hydration target on ${g} days`),l}async migrateUserData(e,t){try{console.log(`🔄 Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let l=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?_t.fromDate(new Date(h.timestamp)):gs(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await oi(Jr(this.firestore,this.collections.cravings),f),l++}catch(f){console.error(`❌ Error migrating craving ${u}:`,f)}console.log(`✅ Migrated ${l} cravings to Firestore`)}return console.log(`✅ Data migration completed for user ${e}`),!0}catch(r){throw console.error("❌ Error during data migration:",r),r}}async testConnectivity(){try{return console.log("🧪 FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn("⚠️ FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn("⚠️ FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(`📊 Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=jl(Jr(this.db,s),Ul("userId","==",e)),o=await ad(i);r[s]=o.size}catch(i){console.warn(`⚠️ Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error("❌ Error generating basic analytics:",t),t}}}class Pb{constructor(e,t){this.db=e,this.userId=t,this.statsRef=he(e,`users/${t}/stats`),this.profileRef=he(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{console.log(`📊 CentralizedStats: Refreshing all stats for user ${this.userId}`);const[e,t,r]=await Promise.all([Be(this.profileRef),Be(this.statsRef),Be(he(this.db,`users/${this.userId}`))]),s=e.exists()?e.val():{},i=r.exists()?r.val():{},o={...s,createdAt:s.createdAt||i.createdAt||null,quitDate:s.quitDate||i.quitDate||i.quitStartDate||null,lastQuitDate:s.lastQuitDate||i.lastQuitDate||null};if(!o.lastRelapseDate&&!o.quitDate&&o.createdAt)try{await Xe(he(this.db,`users/${this.userId}/profile/quitDate`),o.createdAt),o.quitDate=o.createdAt,console.log(`📊 CentralizedStats: Seeded missing quitDate with createdAt for ${this.userId}: ${o.createdAt}`)}catch(x){console.warn(`⚠️ CentralizedStats: Could not seed quitDate for ${this.userId}:`,x.message)}const a=t.exists()?t.val():this.getDefaultStats(),l=this.calculateEffectiveQuitDate(o),u=this.calculateStreakFromRelapse(o),h=await this.calculateCravingsResisted(),f=await this.calculateAddictionLevel(o,l),g=this.calculateMentalStrength(a,h),y=g.strength,_=g.cravingsApplied,C=await this.checkMilestonesFromRelapse(o,a),N=await this.generateSpecialFeatures(o),T={...a,...C,streakDays:u.value,streakUnit:u.unit,streakDisplayText:u.displayText,cravingsResisted:h,addictionLevel:f,mentalStrength:y,mentalStrengthCravingsApplied:_,specialFeatures:N,lastUpdated:new Date().toISOString()};return await Xe(this.statsRef,T),console.log(`✅ CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:u.displayText,cravingsResisted:h,addictionLevel:f,mentalStrength:y,specialFeatures:(N==null?void 0:N.length)||0,effectiveQuitDate:l}),T}catch(e){throw console.error(`❌ CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||null;if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(`📊 CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(`📊 CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const l=e.lastQuitDate||e.originalQuitDate||e.quitDate||e.createdAt||null;return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${l}`),l?this.calculateStreak(l):{value:0,unit:"hours",displayText:"0 hours",streakDays:0}}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return console.log(`📊 CentralizedStats: Streak calculation for ${this.userId}:`),console.log(`  - Last relapse: ${r}`),console.log(`  - Current time: ${t.toISOString()}`),console.log(`  - Hours since relapse: ${o}`),console.log(`  - Days since relapse: ${a}`),o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([Be(he(this.db,`users/${this.userId}/profile/cravingsResisted`)),Be(he(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(`📊 CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length,console.log(`📊 CentralizedStats: Counted cravings from collection: ${r}`)}return r}catch(e){return console.warn(`⚠️ CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}calculateMentalStrength(e,t){try{const r=e.mentalStrength||50,s=e.mentalStrengthCravingsApplied||0;return console.log(`📊 CentralizedStats: Mental strength calculation for ${this.userId}: ${r} (cravings applied: ${s}/3)`),{strength:r,cravingsApplied:s}}catch(r){return console.warn(`⚠️ CentralizedStats: Could not calculate mental strength for ${this.userId}:`,r.message),{strength:e.mentalStrength||50,cravingsApplied:e.mentalStrengthCravingsApplied||0}}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([Be(this.statsRef),Be(he(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Be(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(`📊 CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(`📊 CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(`📊 CentralizedStats: Days since last relapse: ${u}`),console.log(`📊 CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await Xe(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const g=Math.floor(u/7),y=g*2;let _=Math.max(30,o-y);return console.log(`📊 CentralizedStats: Base addiction: ${o}, Weeks clean: ${g}, Decay: -${y}, Final: ${_}`),_}catch(r){return console.error("❌ CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},l=!1;for(const u of o)if(i>=u.days){const h=he(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await Be(h)).exists()){const g=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=g,l=!0,await Xe(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let l={},u=!1;for(const h of a)if(o>=h.days){const f=he(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await Be(f)).exists()){const y=Math.min(100,(t.mentalStrength||50)+h.bonus);l.mentalStrength=y,u=!0,await Xe(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return l}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await Be(he(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(`📊 CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await Be(he(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(`📊 CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(`⚠️ CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(`📊 CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(`📊 CentralizedStats: Generated ${o.length} personalized features:`,o);const l=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=l[Math.floor(Math.random()*l.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await Xe(he(this.db,`users/${this.userId}/specialFeatures`),u),console.log(`📊 CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(`❌ CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=PR(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(`🔄 CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:"🎉 First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

🧠 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! 💪`},30:{title:"🏆 One Month Champion!",message:`Amazing! You've reached 30 days clean!

🧠 Mental Strength: +${e.bonus} points

You're proving your strength every day! 🌟`},90:{title:"👑 Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

🧠 Mental Strength: +${e.bonus} points

You're a true inspiration! 🎯✨`}}[e.days]||{title:"🎉 Milestone Achieved!",message:`You've reached ${t} days clean!

🧠 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(`🎉 Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(`🔄 CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=he(this.db,`users/${this.userId}/profile/milestones`);await Xe(e,null),console.log(`✅ CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(`❌ CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(`🔄 CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([Be(he(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Be(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),Be(this.statsRef)]);let o=1;if(r.exists()){const g=new Date(r.val()),y=Math.floor((e-g)/(1e3*60*60*24)),_=s.exists()?s.val():1;console.log(`🔄 CentralizedStats: Current escalation level: ${_}`),console.log(`🔄 CentralizedStats: Days since last relapse: ${y}`),y>=7?(o=1,console.log(`🔄 CentralizedStats: After 7+ days clean → escalation level reset to: ${o}`)):(o=_+1,console.log(`🔄 CentralizedStats: Within ${y} days → escalation level: ${_} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(`🔄 CentralizedStats: Escalation level ${o} → addiction increase: +${a}`);const l=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(l.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(l.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(l.triggerDefense||30)-3));console.log(`🔄 CentralizedStats: addictionLevel change: ${l.addictionLevel} → ${u} (+${a})`),console.log(`🔄 CentralizedStats: mentalStrength change: ${l.mentalStrength} → ${h} (-3)`),console.log(`🔄 CentralizedStats: triggerDefense change: ${l.triggerDefense} → ${f} (-3)`),await Promise.all([Xe(he(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),Xe(he(this.db,`users/${this.userId}/profile/relapseDate`),t),Xe(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),Xe(he(this.db,`users/${this.userId}/lastQuitDate`),t),Xe(he(this.db,`users/${this.userId}/profile/lastQuitDate`),t),this.resetMilestones(),Xe(this.statsRef,{...l,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(`✅ CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(`❌ CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async getCurrentStats(){try{const e=await Be(this.statsRef);return e.exists()?e.val():this.getDefaultStats()}catch(e){return console.error(`❌ CentralizedStats: Error getting current stats for ${this.userId}:`,e),this.getDefaultStats()}}async handleCravingResisted(){try{console.log(`🔄 CentralizedStats: Handling craving resisted for ${this.userId}`),await this.checkAndResetDailyCounter();const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsApplied||0;if(console.log(`🔄 CentralizedStats: Current mental strength cravings applied: ${t}`),t<3){const r=Math.min(100,(e.mentalStrength||50)+1),s=t+1;return await Xe(this.statsRef,{...e,mentalStrength:r,mentalStrengthCravingsApplied:s,mentalStrengthCravingsAppliedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()}),console.log(`✅ CentralizedStats: Applied +1 mental strength (${e.mentalStrength} → ${r}), cravings applied: ${s}/3`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!0,cravingsApplied:s,limitReached:s>=3}}else return console.log(`📊 CentralizedStats: Daily mental strength limit reached (${t}/3), no bonus applied`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!1,cravingsApplied:t,limitReached:!0}}catch(e){throw console.error(`❌ CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}async checkAndResetDailyCounter(){try{const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsAppliedDate,r=new Date,s=r.toDateString();if(!t){await Xe(this.statsRef,{...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()}),console.log(`✅ CentralizedStats: Initialized daily counter for ${this.userId} (reset to 0)`);return}new Date(t).toDateString()!==s&&(console.log(`🔄 CentralizedStats: New day detected, resetting daily mental strength counter for ${this.userId}`),await Xe(this.statsRef,{...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()}),console.log(`✅ CentralizedStats: Daily mental strength counter reset for ${this.userId}`))}catch(e){console.warn(`⚠️ CentralizedStats: Could not check/reset daily counter for ${this.userId}:`,e.message)}}}const rx=(n,e={})=>{const{threshold:t=100,velocity:r=.5,enabled:s=!0}=e,[i,o]=L.useState(!1),[a,l]=L.useState(null),[u,h]=L.useState(0),f=L.useRef(null),g=L.useRef(0),y=L.useRef(0),_=L.useRef(0),C=L.useRef(0),N=L.useRef(0);return L.useEffect(()=>{if(!s||!f.current)return;const T=f.current;let x=!1;const k=R=>{if(!s)return;const S=R.touches[0];g.current=S.clientY,y.current=S.clientX,_.current=Date.now(),C.current=S.clientY,N.current=Date.now(),x=!0,o(!0),T.classList.add("swiping")},P=R=>{if(!x||!s)return;R.preventDefault();const S=R.touches[0],I=S.clientY-g.current,A=S.clientX-y.current;Math.abs(A)>Math.abs(I)||(h(I),I>0?(l("down"),T.style.transform=`translateY(${Math.min(I,t*1.5)}px)`,T.style.opacity=Math.max(.3,1-I/(t*2))):I<0&&(l("up"),T.style.transform=`translateY(${Math.max(I,-t*1.5)}px)`,T.style.opacity=Math.max(.3,1-Math.abs(I)/(t*2))),C.current=S.clientY,N.current=Date.now())},$=R=>{if(!x||!s)return;x=!1,o(!1);const I=R.changedTouches[0].clientY-g.current,A=Date.now()-_.current,w=Math.abs(I)/A;T.style.transform="",T.style.opacity="",T.classList.remove("swiping"),(Math.abs(I)>t||w>r)&&(I>0&&a==="down"?j("down"):I<0&&a==="up"&&j("up")),l(null),h(0)},j=R=>{T.classList.add(`swipe-${R}`),setTimeout(()=>{typeof n=="function"&&n()},200)};return T.addEventListener("touchstart",k,{passive:!1}),T.addEventListener("touchmove",P,{passive:!1}),T.addEventListener("touchend",$,{passive:!0}),()=>{T.removeEventListener("touchstart",k),T.removeEventListener("touchmove",P),T.removeEventListener("touchend",$)}},[s,t,r,a]),{modalRef:f,isSwipping:i,swipeDirection:a,swipeDistance:u,classes:`modal-swipe-dismiss ${i?"swiping":""} ${a?`swipe-${a}`:""}`}},Y9=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=L.useState("signin"),[s,i]=L.useState(""),[o,a]=L.useState(""),[l,u]=L.useState(""),[h,f]=L.useState(!1),[g,y]=L.useState(!1),[_,C]=L.useState(""),[N,T]=L.useState(""),[x,k]=L.useState(!1);L.useEffect(()=>()=>{g&&y(!1)},[g]);const P=new ui;P.addScope("email"),P.addScope("profile"),P.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const $=()=>{i(""),a(""),u(""),C(""),T("")},j=async()=>{f(!0),y(!0),C("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:P.scopes,customParameters:P.customParameters});const w=PB(lo,P),b=new Promise((te,Ee)=>{setTimeout(()=>Ee(new Error("Popup timeout - please try again")),6e4)}),v=await Promise.race([w,b]);if(v&&v.user){const te=v.user;console.log("Google sign-in successful for:",te.email,"UID:",te.uid),console.log("User display name:",te.displayName),console.log("User photo URL:",te.photoURL),await new Promise(Ee=>setTimeout(Ee,800)),n(te)}else throw new Error("No user data received from Google authentication")}catch(w){console.error("Google sign-in error:",w),w.code==="auth/popup-closed-by-user"?C("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):w.code==="auth/popup-blocked"?C("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):w.code==="auth/cancelled-popup-request"?C("Google sign-in was cancelled. Please try again and complete the authentication process."):w.code==="auth/account-exists-with-different-credential"?C("An account already exists with this email using a different sign-in method. Please use email/password instead."):w.message==="Popup timeout - please try again"?C("Google sign-in popup timed out. Please try again and complete the account selection quickly."):w.code==="auth/network-request-failed"?C("Network error during Google sign-in. Please check your internet connection and try again."):w.code==="auth/operation-not-allowed"?C("Google sign-in is not enabled for this app. Please contact support."):C(A(w.code))}finally{f(!1),y(!1)}},R=async w=>{w.preventDefault(),f(!0),C("");try{const v=(await z$(lo,s,o)).user;console.log("Email sign-in successful for:",v.email),n(v)}catch(b){console.error("Email sign-in error:",b),C(A(b.code))}finally{f(!1)}},S=async w=>{if(w.preventDefault(),f(!0),C(""),o!==l){C("Passwords do not match"),f(!1);return}if(o.length<6){C("Password must be at least 6 characters long"),f(!1);return}try{const v=(await B$(lo,s,o)).user;console.log("Email sign-up successful for:",v.email),await W$(v),n(v)}catch(b){console.error("Email sign-up error:",b),C(A(b.code))}finally{f(!1)}},I=async w=>{if(w.preventDefault(),!s){C("Please enter your email address");return}f(!0),C("");try{await U$(lo,s),T("Password reset email sent! Check your inbox.")}catch(b){console.error("Password reset error:",b),C(A(b.code))}finally{f(!1)}},A=w=>{switch(w){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return x?d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),d.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),d.jsxs("form",{onSubmit:I,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:s,onChange:w=>i(w.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),_&&d.jsx("div",{className:"text-red-400 text-sm",children:_}),N&&d.jsx("div",{className:"text-green-400 text-sm",children:N}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"button",onClick:()=>{k(!1),C(""),T("")},className:"flex-1 px-4 py-3 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 min-h-[44px]",children:"Back to Login"}),d.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-3 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Sending...":"Send Reset Link"})]})]})]})}):d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),d.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),d.jsxs("div",{children:[g&&d.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[d.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),d.jsx("button",{onClick:j,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),d.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:g?d.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,_&&d.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[d.jsx("div",{className:"text-red-300 text-sm mb-2",children:_}),_.includes("Google sign-in")&&!g&&d.jsx("button",{onClick:j,disabled:h,className:"w-full px-3 py-3 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50 min-h-[44px]",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),d.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[d.jsx("button",{onClick:()=>{r("signin"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),d.jsx("button",{onClick:()=>{r("signup"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&d.jsxs("form",{onSubmit:R,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signin-email",type:"email",value:s,onChange:w=>i(w.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signin-password",type:"password",value:o,onChange:w=>a(w.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("button",{type:"button",onClick:()=>k(!0),className:"text-sm text-blue-400 hover:text-blue-300 py-2 px-2 min-h-[44px] min-w-[44px]",children:"Forgot your password?"})}),_&&d.jsx("div",{className:"text-red-400 text-sm",children:_}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&d.jsxs("form",{onSubmit:S,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signup-email",type:"email",value:s,onChange:w=>i(w.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signup-password",type:"password",value:o,onChange:w=>a(w.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),d.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:w=>u(w.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),_&&d.jsx("div",{className:"text-red-400 text-sm",children:_}),N&&d.jsx("div",{className:"text-green-400 text-sm",children:N}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Creating account...":"Create Account"})]})]})})},J9=({offlineManager:n})=>{const[e,t]=L.useState(navigator.onLine),[r,s]=L.useState(!1),[i,o]=L.useState(0),[a,l]=L.useState(!1);return L.useEffect(()=>{const u=()=>{t(!0),s(!1),console.log("🌐 Connection restored"),n&&i>0&&(l(!0),setTimeout(()=>{l(!1),o(0)},2e3))},h=()=>{t(!1),s(!0),console.log("📡 Connection lost")};window.addEventListener("online",u),window.addEventListener("offline",h),t(navigator.onLine);const f=async()=>{if(n)try{const y=await n.getQueuedActionsCount();o(y)}catch(y){console.warn("Could not get queued actions count:",y)}};f();const g=setInterval(f,5e3);return()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),clearInterval(g)}},[n,i]),e&&a?d.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white p-3 text-center shadow-lg",children:d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),d.jsxs("span",{className:"font-medium",children:["Syncing ",i," offline actions..."]})]})}):e&&!a&&i===0||e?null:d.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),d.jsxs("span",{className:"font-medium",children:["You're offline. Some features may be limited.",i>0&&` (${i} actions queued)`]}),d.jsx("button",{onClick:()=>s(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:d.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&d.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[d.jsx("p",{className:"mb-2",children:"While offline, you can:"}),d.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[d.jsx("li",{children:"• View your current stats and progress"}),d.jsx("li",{children:"• Track habits and cravings"}),d.jsx("li",{children:"• Log water intake and breathing exercises"}),d.jsx("li",{children:"• Record craving assessments and resistance"}),d.jsx("li",{children:"• Play distraction games"}),d.jsx("li",{children:"• View your profile information"})]}),d.jsxs("p",{className:"mt-2 text-yellow-200",children:["All changes will sync automatically when you're back online.",i>0&&d.jsxs("span",{className:"block mt-1 font-medium",children:["💾 ",i," action",i!==1?"s":""," queued for sync"]})]})]})]})},X9=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>d.jsxs("div",{className:"p-4 sm:p-6",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),d.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your breathing session"})]}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:[d.jsxs("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[d.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[d.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:d.jsx("span",{className:"text-lg",children:"🫁"})}),d.jsx("div",{className:"text-white font-semibold text-sm",children:"BREATHING RATE"})]}),d.jsx("div",{className:"text-white font-bold text-sm",children:n.name}),d.jsxs("div",{className:"text-slate-400 text-xs",children:[n.inhale,"s | ",n.exhale,"s"]})]}),d.jsxs("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[d.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[d.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:d.jsx("span",{className:"text-lg",children:"⏱️"})}),d.jsx("div",{className:"text-white font-semibold text-sm",children:"DURATION"})]}),d.jsxs("div",{className:"text-white font-bold text-sm",children:[e,"min."]}),d.jsx("div",{className:"text-slate-400 text-xs",children:"Total time"})]})]}),d.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-base sm:text-lg py-3 sm:py-4 px-4 sm:px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl min-h-[44px]",children:"START EXERCISE"}),d.jsx("div",{className:"mt-4 sm:mt-6 text-center",children:d.jsx("p",{className:"text-slate-400 text-xs sm:text-sm",children:"Find a comfortable position and prepare to relax"})})]}),Z9=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),d.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),d.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>d.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),d.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&d.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:d.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),d.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},eq=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=L.useState(n),i=2,o=10;L.useEffect(()=>{s(n)},[n]);const a=f=>{const g=parseInt(f.target.value);s(g),navigator.vibrate&&navigator.vibrate(50),console.log(`🎯 Duration picker: Selected ${g} minutes`)},l=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),d.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),d.jsxs("div",{className:"text-center mb-8",children:[d.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),d.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),d.jsx("div",{className:"mb-8",children:d.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4",autoComplete:"off"})}),d.jsx("button",{onClick:l,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),d.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},tq=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=L.useState(e*60),[g,y]=L.useState("inhale"),[_,C]=L.useState(0),[N,T]=L.useState(!1),[x,k]=L.useState(.1),[P,$]=L.useState(!1),[j,R]=L.useState(!1),S=L.useRef(null),I=L.useRef(null);L.useEffect(()=>{h===0&&N&&!j&&(console.log("🎯 Exercise completed, calling onComplete"),R(!0),t())},[h,N,j,t]);const A=()=>{console.log(`⏰ Starting main timer for ${e} minutes`),I.current&&(console.log("⚠️ Timer already exists, clearing previous timer"),clearInterval(I.current)),I.current=setInterval(()=>{f(be=>{if(be<=1)return console.log(`⏰ Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(I.current),I.current=null,0;const D=be-1;return D%10===0&&console.log(`⏰ Main timer: ${D}s remaining`),D})},1e3),console.log("✅ Main timer started successfully")},w=()=>{console.log(`🚀 Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),S.current&&(console.log("⚠️ Animation already running, clearing previous animation"),cancelAnimationFrame(S.current));const be=n.inhale+n.exhale;let D=0,z=0,ce="inhale";console.log(`📊 Cycle duration: ${be}s, starting animation loop...`);const _e=()=>{if(D+=16,D>=be*1e3&&(console.log(`🔄 Breathing cycle completed, resetting to 0ms. Current phase: ${ce}, phaseTime: ${_}`),D=0,z=0,ce="inhale",y("inhale"),C(0)),D<n.inhale*1e3){ce!=="inhale"&&(console.log(`🔄 Switching to INHALE phase at ${D}ms`),ce="inhale",y("inhale"),C(0),z=0);const Ne=D/(n.inhale*1e3),Z=.1+b(Ne)*3.9;k(Z);const we=Math.floor(Ne*n.inhale);we!==z&&(C(we),z=we,console.log(`⏱️ INHALE: ${we}/${n.inhale}s (phase: ${ce}, scale: ${Z.toFixed(3)})`))}else{ce!=="exhale"&&(console.log(`🔄 Switching to EXHALE phase at ${D}ms`),ce="exhale",y("exhale"),C(0),z=0);const Ne=(D-n.inhale*1e3)/(n.exhale*1e3),Z=4-b(Ne)*3.9;k(Z);const we=Math.floor(Ne*n.exhale);we!==z&&(C(we),z=we,console.log(`⏱️ EXHALE: ${we}/${n.exhale}s (phase: ${ce}, scale: ${Z.toFixed(3)})`))}S.current=requestAnimationFrame(_e)};_e(),console.log("✅ Breathing cycle animation started successfully")},b=be=>be<.5?2*be*be:-1+(4-2*be)*be;L.useEffect(()=>(N&&(A(),w()),()=>{N&&je()}),[N]);const v=be=>{const D=Math.floor(be/60),z=be%60;return`${D.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`},te=()=>_,Ee=()=>g==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",ue=()=>g==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",ye=()=>{console.log("🔄 User clicked close button, showing confirmation popup"),$(!0)},K=()=>{console.log("🚪 User confirmed leaving exercise, cleaning up..."),je(),s?s():r()},Se=()=>{$(!1)},Te=()=>{if(N){console.log("⚠️ Exercise already active, ignoring start request");return}console.log(`🎬 Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(`📊 Initial state - isActive: ${N}, progress: ${x}, currentPhase: ${g}`),k(.1),y("inhale"),C(0),f(e*60),T(!0),console.log("✅ isActive set to true, starting timers..."),setTimeout(()=>{console.log("🚀 Starting main timer and breathing cycle..."),A(),w()},0)},je=()=>{console.log("🧹 Cleaning up breathing exercise resources"),S.current&&(cancelAnimationFrame(S.current),S.current=null),I.current&&(clearInterval(I.current),I.current=null),T(!1),f(0),k(.1),y("inhale"),C(0)};return L.useEffect(()=>{N||(console.log("🎬 Component mounted, starting breathing exercise automatically"),Te())},[]),d.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-6",children:[d.jsx("button",{onClick:ye,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50 min-h-[44px] min-w-[44px]",title:"End breathing exercise",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"text-white text-2xl font-mono",children:v(h)})}),d.jsx("div",{className:"w-11"})," "]}),d.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[d.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),d.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${Ee()} rounded-full shadow-2xl`,style:{transform:`scale(${x})`,transition:"none",boxShadow:`0 0 ${Math.max(x*40,10)}px ${Math.max(x*15,5)}px ${g==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),d.jsxs("div",{className:"p-6 text-center",children:[d.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:d.jsx("span",{className:"text-white text-lg leading-tight",children:ue()})}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[te(),"/",g==="inhale"?n.inhale:n.exhale,"s"]})]}),d.jsx("div",{className:"px-6 pb-6",children:d.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:d.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),P&&d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600/50 max-w-sm",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),d.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{onClick:K,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Leave"}),d.jsx("button",{onClick:Se,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Stay"})]})]})})})]})},nq=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=L.useState("setup"),[o,a]=L.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[l,u]=L.useState(4),[h,f]=L.useState(!1);L.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const g=x=>{a(x),i("setup")},y=x=>{u(x),i("setup")},_=()=>{f(!0),i("exercise")},C=()=>{f(!1),i("setup"),r&&r(),e()},N=()=>{s==="exercise"&&h||e()},T=()=>{console.log("🚪 User leaving breathing exercise via close button"),e(),t&&t()};return n?d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:N}),d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-900 border-slate-700/50 max-w-md sm:max-w-2xl mx-auto w-full",children:[!(s==="exercise"&&h)&&d.jsx("button",{onClick:N,className:"absolute top-4 left-4 z-10 w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors min-h-[44px] min-w-[44px]",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&d.jsx(X9,{selectedRate:o,duration:l,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:_}),s==="rate"&&d.jsx(Z9,{selectedRate:o,onSelect:g,onBack:()=>i("setup")}),s==="duration"&&d.jsx(eq,{selectedDuration:l,onSelect:y,onBack:()=>i("setup")}),s==="exercise"&&d.jsx(tq,{rate:o,duration:l,onComplete:C,onClose:N,onLeave:T})]})})]}):null};var rq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const sq=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),iq=(n,e)=>{const t=L.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>L.createElement("svg",{ref:u,...rq,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${sq(n)}`,...l},[...e.map(([h,f])=>L.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var Yn=iq;const oq=Yn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),aq=Yn("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),jD=Yn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),UD=Yn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),$D=Yn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),lq=Yn("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Rf=Yn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),BD=Yn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),sh=Yn("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),cq=Yn("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),zD=Yn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),uq=Yn("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),dq=Yn("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),hq=Yn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),qD=Yn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),WD=Yn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),GD=Yn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),fq=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=L.useState(null),[i,o]=L.useState(!0),[a,l]=L.useState(30);L.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsx("div",{className:"modal-content bg-slate-800 max-w-4xl",children:d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(aq,{className:"w-6 h-6 text-blue-400"}),d.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("select",{value:a,onChange:h=>l(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-3 rounded border border-slate-600 min-h-[44px]",children:[d.jsx("option",{value:7,children:"Last 7 days"}),d.jsx("option",{value:30,children:"Last 30 days"}),d.jsx("option",{value:90,children:"Last 90 days"})]}),d.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"✕"})]})]}),d.jsx("div",{className:"p-6",children:i?d.jsxs("div",{className:"text-center py-8",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(dq,{className:"w-5 h-5 text-green-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(hq,{className:"w-5 h-5 text-blue-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(jD,{className:"w-5 h-5 text-purple-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),d.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"text-orange-400",children:"💧"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),d.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),d.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>d.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🫁 Breathing Exercises"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🧘‍♀️ Meditation Sessions"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🚶‍♂️ Physical Activities"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"💧 Hydration Goals Met"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>d.jsxs("div",{className:"flex justify-between",children:[d.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),d.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),d.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>d.jsxs("p",{className:"text-gray-300 text-sm",children:["• ",h]},f)),r.insights.length===0&&d.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"📡 System Status"}),d.jsxs("div",{className:"space-y-2 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),d.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),d.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),d.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),g=document.createElement("a");g.href=f,g.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,g.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Export Analytics Data"})]})]}):d.jsxs("div",{className:"text-center py-8",children:[d.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),d.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})})})}):d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 p-6",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),d.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),d.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Close"})]})})})};console.log("🧪 FirestoreBuddyService import check:",!!tc);console.log("🧪 FirestoreBuddyService type:",typeof tc);console.log("🧪 FirestoreBuddyService constructor:",tc==null?void 0:tc.name);const Ms=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},kf=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},Nf=n=>n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e",Ds=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},gq=({onComplete:n,authUser:e,pwaInstallAvailable:t,promptInstall:r})=>{const[s,i]=L.useState(1),[o,a]=L.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[l,u]=L.useState(!1),[h,f]=L.useState(!1),[g,y]=L.useState(null),[_,C]=L.useState(null),N=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:sh},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:GD},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:$D},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:UD}],T=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],x=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],k=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],P=()=>{console.log("Calculating stats with userData:",o);let b=40;o.vapePodsPerWeek<=1?b+=5:o.vapePodsPerWeek<=3?b+=15:o.vapePodsPerWeek<=5?b+=25:o.vapePodsPerWeek<=7?b+=35:b+=40;const v=o.nicotineStrength||"",te=parseInt(v.replace("mg",""))||0;te<=5?b+=0:te<=11?b+=10:te<=20?b+=20:b+=25,o.dailyPatterns.includes("Throughout the day")?b+=20:o.dailyPatterns.length>2?b+=10:b+=0,b=Math.min(b,100);let Ee=25;o.confidence>=9?Ee+=35:o.confidence>=7?Ee+=25:o.confidence>=4?Ee+=15:Ee+=0,o.quitAttempts==="first"?Ee+=15:parseInt(o.quitAttempts)<=3?Ee+=10:Ee+=5,o.copingStrategies.length>=3?Ee+=15:o.copingStrategies.length>=1?Ee+=10:Ee+=0,Ee=Math.min(Ee,80);let ue=35;ue+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[o.archetype]||0,o.confidence>=8?ue+=25:o.confidence>=5?ue+=15:ue+=0,o.quitAttempts==="first"?ue+=10:parseInt(o.quitAttempts)<=3?ue+=5:ue+=15,ue=Math.min(ue,90);let K=15;o.triggers.length<=2?K+=15:o.triggers.length<=4?K+=10:K+=5;const Se=o.triggers.includes("Drinking alcohol"),Te=o.triggers.includes("Social situations");return Se&&Te?K+=0:o.triggers.length>3?K+=5:K+=10,o.copingStrategies.length>=3?K+=25:o.copingStrategies.length>=1?K+=15:K+=0,o.dailyPatterns.includes("Throughout the day")?K+=0:o.dailyPatterns.length>2?K+=5:K+=10,K=Math.min(K,60),{addictionLevel:b,mentalStrength:Ee,motivation:ue,triggerDefense:K}},$=b=>{const v=b.target.files[0];if(v){y(v);const te=new FileReader;te.onload=Ee=>C(Ee.target.result),te.readAsDataURL(v)}},j=async()=>{if(g){f(!0);try{const b=document.createElement("canvas"),v=b.getContext("2d"),te=new Image;te.onload=()=>{b.width=200,b.height=200,v.filter="contrast(1.2) saturate(1.3) brightness(1.1)",v.drawImage(te,0,0,200,200),v.globalCompositeOperation="overlay",v.fillStyle="rgba(255, 200, 200, 0.1)",v.fillRect(0,0,200,200);const Ee=b.toDataURL("image/png"),ue={...o,avatar:Ee};a(ue),w(ue,3),f(!1)},te.src=_}catch(b){console.error("Photo processing failed:",b);const v=kf(o.avatarSeed);a(te=>({...te,avatar:v})),f(!1)}}},R=()=>{u(!0);const b=Math.random().toString(36).substring(7);(async()=>{try{const te=Ms(b),Ee={...o,avatarSeed:b,avatar:te};a(Ee),w(Ee,3)}catch{const Ee=kf(b),ue={...o,avatarSeed:b,avatar:Ee};a(ue),w(ue,3)}})(),setTimeout(()=>u(!1),500)},S=async()=>{if(s<10)await w(o,s),i(s+1);else try{console.log("Completing onboarding with userData:",o);const b=P();console.log("Calculated stats:",b);const v={...o,stats:{...b,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await w(v,10),console.log("Final user data:",v),n(v)}catch(b){console.error("Error completing onboarding:",b);const te={...o,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await w(te,10)}catch(Ee){console.error("Failed to save fallback data to Firebase:",Ee)}console.log("Using fallback stats:",te),n(te)}},I=()=>{s>1&&i(s-1)},A=()=>{switch(s){case 1:return o.heroName.trim().length>0;case 2:return o.archetype!=="";case 3:return o.avatar!==null;case 4:return o.triggers.length>0;case 5:return o.dailyPatterns.length>0;case 6:return o.copingStrategies.length>0;case 7:return o.vapePodsPerWeek>0;case 8:return o.nicotineStrength!=="";case 9:return o.quitAttempts!=="";case 10:return o.confidence>0;default:return!1}},w=async(b,v)=>{if(e)try{const{ref:te,set:Ee}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),ue=te(H,`users/${e.uid}/onboarding`);await Ee(te(H,`users/${e.uid}/onboarding/step${v}`),{...b,stepNumber:v,timestamp:Date.now()}),await Ee(te(H,`users/${e.uid}/onboarding/progress`),{currentStep:v,completedSteps:Array.from({length:v},(ye,K)=>K+1),lastUpdated:Date.now()}),console.log(`Step ${v} saved to Firebase successfully`)}catch(te){console.error(`Error saving step ${v} to Firebase:`,te)}};return L.useEffect(()=>{if(!o.avatar){const b=Ms(o.avatarSeed);a(v=>({...v,avatar:b}))}},[]),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[t&&d.jsxs("div",{className:"mb-4 p-3 rounded-lg border border-blue-600 bg-blue-900/40 text-blue-100 flex items-center justify-between",children:[d.jsx("div",{className:"mr-3",children:"Install QuitArena for a faster, full-screen experience."}),d.jsx("button",{onClick:r,className:"px-4 py-3 rounded-md bg-blue-600 hover:bg-blue-500 text-white text-sm font-semibold min-h-[44px] min-w-[44px]",children:"Install"})]}),d.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(b=>d.jsxs("div",{className:"flex items-center flex-shrink-0",children:[d.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${b<=s?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:b<s?"✓":b}),b<10&&d.jsx("div",{className:`w-4 h-1 mx-1 ${b<s?"bg-blue-500":"bg-slate-600"}`})]},b))}),s===1&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(cq,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),d.jsx("input",{type:"text",value:o.heroName,onChange:b=>{const v={...o,heroName:b.target.value};a(v),b.target.value.trim().length>0&&w(v,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",autoComplete:"name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s===2&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(sh,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),d.jsx("div",{className:"space-y-3 mb-6",children:N.map(b=>{const v=b.icon;return d.jsx("button",{onClick:()=>{const te={...o,archetype:b.id};a(te),w(te,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.archetype===b.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 ${b.color} rounded-lg flex items-center justify-center`,children:d.jsx(v,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-white font-semibold",children:b.name}),d.jsx("p",{className:"text-gray-400 text-sm",children:b.description})]})]})},b.id)})})]}),s===3&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(WD,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:o.avatar?d.jsx("img",{src:o.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{a(b=>({...b,avatar:kf(b.avatarSeed)}))}}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(Rf,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),d.jsx("input",{type:"file",accept:"image/*",onChange:$,className:"hidden",id:"photo-upload",autoComplete:"photo"}),d.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),_&&d.jsx("div",{className:"mb-4",children:d.jsx("button",{onClick:j,disabled:h,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:h?d.jsxs(d.Fragment,{children:[d.jsx(Rf,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):d.jsx(d.Fragment,{children:"✨ Convert to Anime"})})}),d.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),d.jsx("button",{onClick:R,disabled:l,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?d.jsxs(d.Fragment,{children:[d.jsx(Rf,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):d.jsxs(d.Fragment,{children:[d.jsx(Rf,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),d.jsx("button",{onClick:()=>{const b=kf(o.avatarSeed),v={...o,avatar:b};a(v),w(v,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),s===4&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:T.map(b=>d.jsx("button",{onClick:()=>{const v={...o,triggers:o.triggers.includes(b)?o.triggers.filter(te=>te!==b):[...o.triggers,b]};a(v),w(v,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.triggers.includes(b)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.triggers.includes(b)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.triggers.includes(b)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:b})]})},b))})]}),s===5&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📅"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:x.map(b=>d.jsx("button",{onClick:()=>{const v={...o,dailyPatterns:o.dailyPatterns.includes(b)?o.dailyPatterns.filter(te=>te!==b):[...o.dailyPatterns,b]};a(v),w(v,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.dailyPatterns.includes(b)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.dailyPatterns.includes(b)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.dailyPatterns.includes(b)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:b})]})},b))})]}),s===6&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🛡️"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:k.map(b=>d.jsx("button",{onClick:()=>{const v={...o,copingStrategies:o.copingStrategies.includes(b)?o.copingStrategies.filter(te=>te!==b):[...o.copingStrategies,b]};a(v),w(v,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.copingStrategies.includes(b)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.copingStrategies.includes(b)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.copingStrategies.includes(b)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:b})]})},b))})]}),s===7&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🚬"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:o.vapePodsPerWeek,onChange:b=>{const v={...o,vapePodsPerWeek:parseFloat(b.target.value)||0};a(v),v.vapePodsPerWeek>0&&w(v,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select pods per week"}),d.jsx("option",{value:"0.5",children:"0.5 pods"}),d.jsx("option",{value:"1",children:"1 pod"}),d.jsx("option",{value:"2",children:"2 pods"}),d.jsx("option",{value:"3",children:"3 pods"}),d.jsx("option",{value:"4",children:"4 pods"}),d.jsx("option",{value:"5",children:"5 pods"}),d.jsx("option",{value:"6",children:"6 pods"}),d.jsx("option",{value:"7",children:"7 pods"}),d.jsx("option",{value:"8",children:"8+ pods"})]})})]}),s===8&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"⚡"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:o.nicotineStrength,onChange:b=>{const v={...o,nicotineStrength:b.target.value};a(v),v.nicotineStrength&&w(v,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select nicotine strength"}),d.jsx("option",{value:"3mg",children:"3mg"}),d.jsx("option",{value:"6mg",children:"6mg"}),d.jsx("option",{value:"12mg",children:"12mg"}),d.jsx("option",{value:"18mg",children:"18mg"}),d.jsx("option",{value:"20mg",children:"20mg"}),d.jsx("option",{value:"50mg",children:"50mg"})]})})]}),s===9&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📚"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:o.quitAttempts,onChange:b=>{const v={...o,quitAttempts:b.target.value};a(v),v.quitAttempts&&w(v,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select option"}),d.jsx("option",{value:"first",children:"This is my first attempt"}),d.jsx("option",{value:"1",children:"Once before"}),d.jsx("option",{value:"2",children:"Twice before"}),d.jsx("option",{value:"3",children:"3-5 times"}),d.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),s===10&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),d.jsx("input",{type:"range",min:"1",max:"10",value:o.confidence,onChange:b=>{const v={...o,confidence:parseInt(b.target.value)};a(v),w(v,10)},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${Nf(o.confidence)} 0%, ${Nf(o.confidence)} ${o.confidence/10*100}%, #475569 ${o.confidence/10*100}%, #475569 100%)`},autoComplete:"off"}),d.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),d.jsxs("div",{className:"text-center mt-4",children:[d.jsx("span",{className:"font-bold text-4xl",style:{color:Nf(o.confidence)},children:o.confidence}),d.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),d.jsx("div",{className:"text-center mt-2",children:d.jsx("span",{className:"text-sm font-medium",style:{color:Nf(o.confidence)},children:o.confidence<=3?"You can do this! 💪":o.confidence<=6?"Good confidence! 🎯":o.confidence<=9?"Great confidence! 🚀":"Excellent confidence! 🌟"})})]})]}),d.jsxs("div",{className:"flex justify-between",children:[s>1&&d.jsx("button",{onClick:I,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),d.jsxs("button",{onClick:S,disabled:!A(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${A()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[s===10?"Start Journey":"Next",d.jsx(oq,{className:"w-4 h-4"})]})]})]})})},Db={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:sh},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:GD},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:$D},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:UD}},pq={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},Lb={WEEK_WARRIOR:{name:"Week Warrior",icon:jD,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:qD,description:"30 days clean"},LEGEND:{name:"Legend",icon:zD,description:"90 days clean"}},mq=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",yq=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Your body's dependence level - decreases with clean time, increases with relapses",impacts:["What decreases it:","• Clean time: -2 points per week","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[d.jsxs("div",{className:"text-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),d.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),d.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>d.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[d.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300 min-h-[44px]",children:"Got it"})]})})]}):null},Pf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return d.jsxs("div",{className:"mb-0.5 sm:mb-1",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&d.jsx("button",{onClick:()=>i(s),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{fontSize:"4px"},title:`Learn about ${n}`,children:"i"})]}),d.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),d.jsx("div",{className:"stat-bar-interactive w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:d.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},Mb=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{var j,R,S;const[i,o]=L.useState(!1),[a,l]=L.useState(null),[u,h]=L.useState([]),[f,g]=L.useState({});if(L.useEffect(()=>{let I=!1;return(async()=>{try{if(console.log("🔄 TradingCard: Loading Special Features for user:",n==null?void 0:n.heroName,"uid:",n==null?void 0:n.uid),console.log("🔄 TradingCard: User has specialFeatures:",!!(n!=null&&n.specialFeatures)),console.log("🔄 TradingCard: User has triggers:",n==null?void 0:n.triggers),console.log("🔄 TradingCard: User has dailyPatterns:",n==null?void 0:n.dailyPatterns),console.log("🔄 TradingCard: User has copingStrategies:",n==null?void 0:n.copingStrategies),n&&n.uid)if(n.specialFeatures)console.log("✅ TradingCard: Using pre-loaded Special Features"),I||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),g({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),g(n.specialFeatures.categories||{})):(h([]),g({})));else{console.log("🔄 TradingCard: Generating new Special Features");const w=await N(n);console.log("✅ TradingCard: Generated features:",w),I||(Array.isArray(w)?(h(w),g({})):w&&w.features?(h(w.features),g(w.categories||{})):(h([]),g({})))}else console.log("⚠️ TradingCard: No user or uid, setting empty features"),I||(h([]),g({}))}catch(w){console.error("❌ TradingCard: Error loading Special Features:",w),I||(h([]),g({}))}})(),()=>{I=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),d.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),d.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const y=Db[n.archetype];if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(Db)),d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),d.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const _=pq[mq(n.stats.streakDays)],C=y.icon;console.log("🎯 TradingCard: Received user object:",n==null?void 0:n.heroName),console.log("🎯 TradingCard: User stats:",n==null?void 0:n.stats),console.log("🎯 TradingCard: User stats.cravingsResisted:",(j=n==null?void 0:n.stats)==null?void 0:j.cravingsResisted),console.log("🎯 TradingCard: User stats.streakDisplayText:",(R=n==null?void 0:n.stats)==null?void 0:R.streakDisplayText),console.log("🎯 TradingCard: User stats.streakDays:",(S=n==null?void 0:n.stats)==null?void 0:S.streakDays);async function N(I){if(I!=null&&I.isRealBuddy){console.log("🔄 TradingCard: Loading centralized Special Features for buddy:",I.heroName);try{const{ref:ue,get:ye}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),K=ue(H,`users/${I.uid}/stats`),Se=await ye(K);if(Se.exists()){const be=Se.val();if(be.specialFeatures&&Array.isArray(be.specialFeatures))return console.log("✅ TradingCard: Using centralized Special Features for buddy:",be.specialFeatures),be.specialFeatures}const Te=ue(H,`users/${I.uid}/specialFeatures`),je=await ye(Te);if(je.exists()){const be=je.val();return console.log("✅ TradingCard: Using legacy Special Features for buddy:",be),be}}catch(ue){console.warn("⚠️ TradingCard: Could not load centralized Special Features for buddy:",ue.message)}return console.log("🔄 TradingCard: Generating placeholder features for buddy:",I.heroName),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let A=null;if(I.uid)try{const{ref:ue,get:ye}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),K=ue(H,`users/${I.uid}/specialFeatures`),Se=await ye(K);Se.exists()&&(A=Se.val())}catch(ue){console.error("Error fetching special features from Firebase:",ue)}if(!A){const ue=`specialFeatures_${I.heroName||I.id||"default"}`,ye=localStorage.getItem(ue);ye&&(A=JSON.parse(ye))}if(A){if(Array.isArray(A))return A;if(A&&A.features)return A}const w=[],b={};for(I.triggers&&I.triggers.length>0&&I.triggers.forEach(ue=>{let ye="";switch(ue){case"Stress/anxiety":ye="Stress Vaper";break;case"Social situations":ye="Social Vaper";break;case"Boredom":ye="Boredom Fighter";break;case"After meals":ye="Habit Former";break;case"Drinking alcohol":ye="Party Animal";break;case"Work breaks":ye="Work Breaker";break;case"Driving":ye="Driving Vaper";break;default:ye="Trigger Aware"}ye&&!w.includes(ye)&&(w.push(ye),b[ye]="triggers")}),I.dailyPatterns&&I.dailyPatterns.length>0&&I.dailyPatterns.forEach(ue=>{let ye="";switch(ue){case"Morning routine":ye="Morning Struggler";break;case"Evening wind-down":ye="Night Owl";break;case"Throughout the day":ye="All-Day Warrior";break;default:ye="Routine Builder"}ye&&!w.includes(ye)&&(w.push(ye),b[ye]="dailyPatterns")}),I.copingStrategies&&I.copingStrategies.length>0&&(I.copingStrategies.includes("Nothing - this is new to me")?(w.push("First Timer"),b["First Timer"]="copingStrategies"):I.copingStrategies.length>2?(w.push("Veteran Quitter"),b["Veteran Quitter"]="copingStrategies"):(w.push("Cold Turkey"),b["Cold Turkey"]="copingStrategies"));w.length<4;){const ue=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],ye=ue[Math.floor(Math.random()*ue.length)];w.includes(ye.name)||(w.push(ye.name),b[ye.name]=ye.category)}const v=w.slice(0,4),te={};v.forEach(ue=>{te[ue]=b[ue]||"copingStrategies"});const Ee={features:v,categories:te};if(I.uid)try{const{ref:ue,set:ye}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),K=ue(H,`users/${I.uid}/specialFeatures`);await ye(K,Ee),console.log("Special features with categories saved to Firebase successfully")}catch(ue){console.error("Error saving special features to Firebase:",ue);const ye=`specialFeatures_${I.heroName||I.id||"default"}`;localStorage.setItem(ye,JSON.stringify(Ee))}else{const ue=`specialFeatures_${I.heroName||I.id||"default"}`;localStorage.setItem(ue,JSON.stringify(v))}return v}const T=n.stats.addictionLevel||50,x=n.stats.mentalStrength||50,k=n.stats.motivation||50,P=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const $=I=>{l(I),o(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`touch-card relative w-72 sm:w-80 min-h-[480px] sm:min-h-[520px] rounded-xl ${_.color} border-4 ${_.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 mx-auto`,children:[d.jsxs("div",{className:"text-center mb-3",children:[d.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),d.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:y.name})]}),d.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):d.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:d.jsx(C,{className:"w-12 h-12 text-white"})})}),d.jsxs("div",{className:"mb-2 sm:mb-3",children:[d.jsx(Pf,{label:"Addiction",value:T,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:$}),d.jsx(Pf,{label:"Mental Strength",value:x,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:$}),d.jsx(Pf,{label:"Motivation",value:k,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:$}),d.jsx(Pf,{label:"Trigger Defense",value:P,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:$})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),d.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((I,A)=>{const w=f[I]||"copingStrategies",b=v=>{switch(v){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return d.jsx("div",{className:`px-2 py-1 ${b(w)} text-white text-xs rounded-full font-medium`,title:`${I} (${w})`,children:I},A)})})]}),d.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-2 sm:left-3 right-2 sm:right-3 bg-black/30 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Streak:"}),d.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const I=n.stats.streakDays;return`${I} day${I===1?"":"s"}`})(),n.stats.streakDays>0&&d.jsx("span",{className:"text-xs",children:"🔥"})]})]}),d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),d.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,d.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&d.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((I,A)=>{var b,v;const w=((b=Lb[I])==null?void 0:b.icon)||zD;return d.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(v=Lb[I])==null?void 0:v.description,children:d.jsx(w,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},A)}),n.achievements.length>4&&d.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),d.jsx(yq,{isOpen:i,onClose:()=>o(!1),statType:a})]})},_q=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:lq},{id:"craving-support",label:"Craving Support",icon:sh},{id:"profile",label:"Profile",icon:WD},{id:"settings",label:"Explore",icon:BD}];return d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:d.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return d.jsxs("button",{onClick:()=>e(o.id),className:`tab-interactive flex flex-col items-center min-h-[44px] min-w-[44px] justify-center ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[d.jsx(a,{className:"w-5 h-5"}),d.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},vq=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:l,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),d.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),d.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[h,f]=L.useState(!1),[g,y]=L.useState(null),[_,C]=L.useState(null);L.useEffect(()=>{const D=()=>{const z=document.querySelector(".battle-cards-container");z&&(window.innerWidth<1024?(z.style.flexDirection="column",z.style.gap="1rem"):(z.style.flexDirection="row",z.style.gap="3rem"))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),L.useEffect(()=>{_&&n&&(async()=>{if(_&&n)try{console.log("🔄 App: Refreshing stats on page load for user:",n.uid),await _.refreshAllStats(),console.log("✅ App: Stats refreshed on page load")}catch(z){console.error("❌ App: Error refreshing stats on page load:",z)}})()},[_,n]);const N=async()=>{g&&await g.handleAchievementShare()},T=async D=>{if((D==null?void 0:D.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!D.quitDate||new Date(D.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),D.lastRelapseDate){const ce=new Date(D.lastRelapseDate),_e=new Date("2025-09-18T13:56:46.584Z");D.quitDate=ce>_e?D.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 3 quit date set to ${D.quitDate} (considering relapse: ${D.lastRelapseDate})`)}else D.quitDate="2025-09-18T13:56:46.584Z";if((D==null?void 0:D.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!D.quitDate||new Date(D.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),D.lastRelapseDate){const ce=new Date(D.lastRelapseDate),_e=new Date("2025-09-18T13:56:46.584Z");D.quitDate=ce>_e?D.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 2 quit date set to ${D.quitDate} (considering relapse: ${D.lastRelapseDate})`)}else D.quitDate="2025-09-18T13:56:46.584Z";let z={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(D!=null&&D.isRealBuddy){if(D.stats&&Object.assign(z,D.stats),D.quitDate){const ce=new Date(D.quitDate),_e=Ds(ce);z.streakDays=_e.value,z.streakUnit=_e.unit,z.streakDisplayText=_e.displayText}try{const{ref:ce,get:_e}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),Ne=ce(H,`users/${D.uid}/cravings`),pe=await _e(Ne);let Z=0;pe.exists()&&(pe.forEach(we=>{we.val().outcome==="resisted"&&Z++}),z.cravingsResisted=Z,console.log("🔄 Arena: Got buddy cravings resisted:",Z))}catch{console.log("⚠️ Arena: Could not read buddy cravings, using default"),z.cravingsResisted=0}return z}if(!(D!=null&&D.uid)){const ce=localStorage.getItem("quitCoachRelapseDate");if(ce){const pe=new Date(ce),we=new Date().getTime()-pe.getTime(),ie=Math.floor(we/(1e3*3600*24));z.streakDays=ie,z.streakUnit="days",z.streakDisplayText=`${ie} day${ie===1?"":"s"}`}else{const pe=D.quitDate?new Date(D.quitDate):new Date,Z=Ds(pe);z.streakDays=Z.value,z.streakUnit=Z.unit,z.streakDisplayText=Z.displayText}const _e=parseInt(localStorage.getItem("cravingWins")||0);z.cravingsResisted=_e,new Date().toDateString();let Ne=0;for(let pe=0;pe<7;pe++){const Z=new Date;Z.setDate(Z.getDate()-pe);const we=Z.toDateString(),ie=localStorage.getItem(`water_${D.uid}_${we}`);if(ie&&parseInt(ie)>0)Ne++;else break}return Ne>=3&&(z.mentalStrength=Math.min(80,(z.mentalStrength||50)+1)),z}try{const{ref:ce,get:_e}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),Ne=ce(H,`users/${D.uid}/cravings`);try{const ve=await _e(Ne);let de=0,G=0;if(ve.exists()){const ae=ve.val();ve.forEach(ge=>{const Ae=ge.val();Ae.outcome==="resisted"?de++:Ae.outcome==="relapsed"&&G++})}z.cravingsResisted=de;const oe=ce(H,`users/${D.uid}/profile/cravingsResisted`),ee=await _e(oe);if(ee.exists()){const ae=ee.val();console.log(`🔍 Arena: Profile cravingsResisted field value: ${ae}`),z.cravingsResisted=Math.max(de,ae)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const de=ce(H,`users/${D.uid}/profile/cravingsResisted`),G=await _e(de);z.cravingsResisted=G.exists()?G.val():0}let pe=0;const Z=ce(H,`users/${D.uid}/profile/relapseDate`),we=await _e(Z);if(we.exists()){const ve=we.val(),de=new Date(ve),oe=new Date().getTime()-de.getTime();pe=Math.floor(oe/(1e3*3600*24))}else{const ve=D.quitDate?new Date(D.quitDate):new Date,de=Ds(ve);pe=de.value,z.streakUnit=de.unit,z.streakDisplayText=de.displayText,console.log(`🔍 Arena: Calculated streak from quit date: ${de.displayText} (quit: ${ve.toISOString()})`),console.log(`🔍 Arena: Setting streak fields - streakDays: ${pe}, streakUnit: ${z.streakUnit}, streakDisplayText: ${z.streakDisplayText}`)}z.streakDays=pe;let ie=0;for(let ve=0;ve<7;ve++){const de=new Date;de.setDate(de.getDate()-ve);const G=de.toDateString(),oe=ce(H,`users/${D.uid}/profile/daily/${G}/water`),ee=await _e(oe);if(ee.exists()&&ee.val()>0)ie++;else break}ie>=3&&(z.mentalStrength=Math.min(80,(z.mentalStrength||50)+1))}catch(ce){console.error("Error fetching profile data from Firebase:",ce);const _e=localStorage.getItem("quitCoachRelapseDate");if(_e){const Z=new Date(_e),ie=new Date().getTime()-Z.getTime(),ve=Math.floor(ie/(1e3*3600*24));z.streakDays=ve,z.streakUnit="days",z.streakDisplayText=`${ve} day${ve===1?"":"s"}`}else{const Z=D.quitDate?new Date(D.quitDate):new Date,we=Ds(Z);z.streakDays=we.value,z.streakUnit=we.unit,z.streakDisplayText=we.displayText}const Ne=parseInt(localStorage.getItem("cravingWins")||0);z.cravingsResisted=Ne,new Date().toDateString();let pe=0;for(let Z=0;Z<7;Z++){const we=new Date;we.setDate(we.getDate()-Z);const ie=we.toDateString(),ve=localStorage.getItem(`water_${D.uid}_${ie}`);if(ve&&parseInt(ve)>0)pe++;else break}pe>=3&&(z.mentalStrength=Math.min(80,(z.mentalStrength||50)+1))}if(D!=null&&D.uid&&!(D!=null&&D.isRealBuddy))try{const{ref:ce,get:_e}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),Ne=Date.now();await new Promise(Z=>setTimeout(Z,800));const pe=await _e(ce(H,`users/${D.uid}/stats`));if(pe.exists()){const Z=pe.val();Object.assign(z,Z)}else Object.assign(z,D.stats),console.log("🔄 Arena: Using user.stats as fallback:",z);if(g){await g.updateAddictionFromCleanTime();const Z=await _e(ce(H,`users/${D.uid}/stats`));if(Z.exists()){const we=Z.val();if(Object.assign(z,we),D.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||D.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(`🔄 Arena: Using Firebase stats directly for ${D.uid} - no client-side calculation`),z}}}catch(ce){console.error("Error reading/updating stats from Firebase:",ce),Object.assign(z,D.stats)}return z},[x,k]=L.useState(()=>{const D={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{...D,...n.stats}:D}),[P,$]=L.useState(()=>{const D={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return console.log("🔄 Arena: Initializing realTimeNemesisStats with default stats:",D),D});L.useEffect(()=>{e&&Object.keys(e).length>0&&(console.log("🔄 Arena: Syncing realTimeUserStats with userStats:",e),k(e))},[e]);const[j,R]=L.useState({streakDisplayText:null,streakDays:0,streakUnit:"hours"}),[S,I]=L.useState({}),A=async()=>{if(n&&window.centralizedStatService)try{const D=await window.centralizedStatService.getCurrentStats();return console.log("🔄 Arena: Fetched latest stats from CentralizedStatService:",D),I(D),D}catch(D){return console.warn("🔄 Arena: Could not fetch latest stats from CentralizedStatService:",D),null}return null};L.useEffect(()=>{A();const D=setInterval(A,3e4);return()=>clearInterval(D)},[n]),L.useEffect(()=>{typeof window<"u"&&(window.refreshArenaStats=A)},[n]),L.useEffect(()=>{if(!(n!=null&&n.uid))return;let D=!0;return(async()=>{await(async()=>{if(D)try{const Ne=new Bm(H,n.uid);await Ne.initialize(),D&&y(Ne)}catch(Ne){console.error("Error initializing StatManager:",Ne)}})(),await(async()=>{if(D){if(n&&D){const Ne=await T(n);D&&k(Ne)}t&&t.uid&&D&&console.log(`🔄 Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{D=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),L.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(`🚫 Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let D=!0;console.log("🔄 Arena: Setting up real-time listener for buddy stats:",t.heroName);const ce=(async()=>{try{const{ref:_e,onValue:Ne}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),pe=_e(H,`users/${t.uid}/stats`),Z=Ne(pe,ve=>{if(D&&ve.exists()){const de=ve.val();if(console.log("🔄 Arena: Buddy stats updated in real-time:",de),console.log("🔍 Arena: Buddy streak display info - streakDays:",de.streakDays,"streakUnit:",de.streakUnit,"streakDisplayText:",de.streakDisplayText),de.streakDisplayText&&de.streakUnit){const G={streakDays:de.streakDays||0,streakUnit:de.streakUnit,streakDisplayText:de.streakDisplayText};R(G),console.log("🔍 Arena: Using centralized stats streak:",G.streakDisplayText)}else{let G=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(G){const oe=Ds(new Date(G)),ee={streakDays:oe.value,streakUnit:oe.unit,streakDisplayText:oe.displayText};R(ee),de.streakDays=oe.value,de.streakUnit=oe.unit,de.streakDisplayText=oe.displayText,console.log("🔄 Arena: Calculated buddy streak from timestamps (no centralized):",oe.displayText)}else de.streakUnit="hours",de.streakDisplayText="0 hours"}$(G=>(console.log("🔄 Arena: Updating buddy stats with calculated streak:",de.streakDisplayText),{...G,...de}))}},ve=>{ve.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",ve)}),we=_e(H,`users/${t.uid}/profile`),ie=Ne(we,async ve=>{if(D&&ve.exists()){const de=ve.val();console.log("🔄 Arena: Buddy profile updated, recalculating stats..."),console.log("🔄 Arena: Preserving pre-loaded buddy stats during profile update...");const G=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(G==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||G==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Profile change for centralized buddy ${G} - keeping centralized stats intact`);else if(P&&P.addictionLevel!==50){let oe={...P};if(de.quitDate&&de.quitDate!==t.quitDate){const ee=new Date(de.quitDate),ae=Ds(ee);oe.streakDays=ae.value,oe.streakUnit=ae.unit,oe.streakDisplayText=ae.displayText,console.log("🔄 Arena: Updated buddy streak from profile change:",ae.displayText)}else if(de.lastRelapseDate||de.relapseDate){const ee=new Date(de.lastRelapseDate||de.relapseDate),ae=Ds(ee);oe.streakDays=ae.value,oe.streakUnit=ae.unit,oe.streakDisplayText=ae.displayText,R({streakDays:ae.value,streakUnit:ae.unit,streakDisplayText:ae.displayText}),console.log("🔄 Arena: Updated buddy streak from last relapse date:",ae.displayText)}else if(t!=null&&t.finalQuitDate||a!=null&&a.finalQuitDate){const ee=new Date((t==null?void 0:t.finalQuitDate)||(a==null?void 0:a.finalQuitDate)),ae=Ds(ee);oe.streakDays=ae.value,oe.streakUnit=ae.unit,oe.streakDisplayText=ae.displayText,R({streakDays:ae.value,streakUnit:ae.unit,streakDisplayText:ae.displayText}),console.log("🔄 Arena: Updated buddy streak from finalQuitDate fallback:",ae.displayText)}console.log("🔄 Arena: Preserved real buddy stats during profile update:",oe),$(ee=>(console.log("🔄 Arena: Preserving locally calculated streak during profile update:",j),{...ee,...oe,...j}))}else console.log("🔄 Arena: Skipping profile update - waiting for real stats to load first")}},ve=>{ve.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",ve)});return()=>{Z(),ie()}}catch(_e){console.error("Error setting up buddy stats listeners:",_e)}})();return()=>{D=!1,ce.then(_e=>{_e&&typeof _e=="function"&&_e()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]),L.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;const D=setInterval(()=>{const z=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(!z)return;const ce=Ds(new Date(z));R({streakDays:ce.value,streakUnit:ce.unit,streakDisplayText:ce.displayText}),$(_e=>({..._e,streakDays:ce.value,streakUnit:ce.unit,streakDisplayText:ce.displayText}))},60*1e3);return()=>clearInterval(D)},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.lastRelapseDate,a==null?void 0:a.originalQuitDate,a==null?void 0:a.lastActivity]);const w=async()=>{if(n){const D=await T(n);k(D)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const D=await T(t);$(z=>(console.log("🔄 Arena: Preserving locally calculated streak during stats calculation:",j),{...z,...D,...j}))}};L.useEffect(()=>{if(!(n!=null&&n.uid))return;const D=setInterval(w,3e4);return()=>clearInterval(D)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),L.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||w())},[t==null?void 0:t.uid]),L.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||w())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),L.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log("🔄 Arena: Loading buddy data for user:",n.uid),l(T,$,R))},[n==null?void 0:n.uid,a,i,u,R]),L.useEffect(()=>{const D=()=>{console.log("🌐 Internet connection restored")},z=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",D),window.addEventListener("offline",z),()=>{window.removeEventListener("online",D),window.removeEventListener("offline",z)}},[]);const b=D=>{if(!D||!D.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const z=D.stats.mentalStrength||50,ce=D.stats.motivation||50,_e=D.stats.triggerDefense||30,Ne=D.stats.addictionLevel||50;return z*1.5+ce*1+_e*1.2-Ne*1},v=b({...n,stats:x}),te=b({...t,stats:P}),Ee=typeof v=="number"&&!isNaN(v)?v:0,ue=typeof te=="number"&&!isNaN(te)?te:0,ye=Ee>ue?"WINNING":Ee===ue?"TIED":"LOSING",K=()=>{if(ye==="WINNING")return null;if(!x||!P)return console.warn("Stats not available for recommendations calculation"),[];const D=ue-Ee+1,z=[],ce=(x==null?void 0:x.mentalStrength)||50,_e=(x==null?void 0:x.motivation)||50,Ne=(x==null?void 0:x.triggerDefense)||30,pe=(x==null?void 0:x.addictionLevel)||50,Z=(P==null?void 0:P.mentalStrength)||50,we=(P==null?void 0:P.motivation)||50;P!=null&&P.triggerDefense;const ie=(P==null?void 0:P.addictionLevel)||50,ve=Z-ce,de=we-_e,G=pe-ie,oe=[{name:"Mental Strength",multiplier:1.5,gap:ve,current:ce,max:100},{name:"Trigger Defense",multiplier:1.2,gap:de,current:Ne,max:100},{name:"Motivation",multiplier:1,gap:de,current:_e,max:100},{name:"Addiction",multiplier:1,gap:G,current:pe,min:0,isReduction:!0}];if(oe.sort((ee,ae)=>ee.multiplier!==ae.multiplier?ae.multiplier-ee.multiplier:Math.abs(ae.gap)-Math.abs(ee.gap)),oe.forEach(ee=>{if(ee.isReduction){const ae=Math.min(ee.current-ee.min,50),ge=ae*ee.multiplier;ge>0&&z.push({stat:ee.name,change:ae,action:Se(ae),priority:ge,canWin:ge>=D,isReduction:!0,efficiency:ee.multiplier,gap:ee.gap})}else{const ae=Math.min(ee.max-ee.current,50),ge=ae*ee.multiplier;ge>0&&z.push({stat:ee.name,change:ae,action:Te(ee.name,ae),priority:ge,canWin:ge>=D,efficiency:ee.multiplier,gap:ee.gap})}}),z.sort((ee,ae)=>ae.priority-ee.priority),z.length>0&&!z.some(ee=>ee.canWin)){const ee=je(z,D);ee&&z.unshift(ee)}return z.slice(0,3)},Se=D=>D>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":D>=20?"Reduce nicotine intake significantly, avoid high-risk situations":D>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",Te=(D,z)=>{switch(D){case"Mental Strength":return z>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":z>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return z>=30?"Log progress daily, share achievements weekly":z>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return z>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":z>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},je=(D,z)=>{let ce=0;const _e=[];for(const Ne of D){if(ce>=z)break;const pe=z-ce,Z=Math.min(Ne.priority,pe);Z>0&&(_e.push({stat:Ne.stat,change:Math.ceil(Z/Ne.efficiency),contribution:Z}),ce+=Z)}return _e.length>0?{stat:"Combination Strategy",change:Math.ceil(z),action:`Focus on: ${_e.map(Ne=>`${Ne.stat} (+${Ne.change})`).join(", ")}`,priority:ce,canWin:ce>=z,isCombination:!0,strategy:_e}:null},be=K()||[];return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:[d.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4",children:[d.jsxs("div",{className:`inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 rounded-full font-bold text-sm sm:text-lg shadow-xl ${ye==="WINNING"?"bg-green-600":ye==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[ye==="WINNING"?d.jsx(qD,{className:"w-5 h-5 mr-2"}):ye==="TIED"?d.jsx(sh,{className:"w-5 h-5 mr-2"}):d.jsx("span",{className:"mr-2",children:"📉"}),"You are ",ye]}),d.jsx("button",{onClick:()=>f(!0),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center shadow-lg",style:{fontSize:"4px"},title:"Battle Algorithm Info",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"i"})}),d.jsx("button",{onClick:w,className:"touch-interactive ripple-effect w-11 h-11 sm:w-12 sm:h-12 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center shadow-lg min-h-[44px] min-w-[44px]",title:"Refresh Stats",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"🔄"})}),d.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 p-2 rounded",children:[d.jsxs("div",{children:["User Stats: ",JSON.stringify(x)]}),d.jsxs("div",{children:["Base Stats: ",JSON.stringify(n==null?void 0:n.stats)]})]}),d.jsx("button",{onClick:w,className:"mt-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Refresh Stats"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy matching test triggered...");try{await autoMatchUsers(),console.log("✅ Manual buddy matching completed")}catch(D){console.error("❌ Manual buddy matching failed:",D)}},className:"mt-2 ml-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔗 Test Matching"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy reload test triggered...");try{setBuddyLoadAttempted(!1),setRealBuddy(null),await l(T,$,R),console.log("✅ Manual buddy reload completed")}catch(D){console.error("❌ Manual buddy reload failed:",D)}},className:"mt-2 ml-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors min-h-[44px]",children:"👥 Reload Buddy"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Resetting matching system...");try{const D=firestoreBuddyServiceRef.current||firestoreBuddyService;if(D){const{getDocs:z,deleteDoc:ce,doc:_e}=await Me(()=>import("./index.esm-990ad7a3.js"),[]),pe=(await z(D.buddyPairsCollection)).docs.map(G=>ce(_e(ci,"buddyPairs",G.id)));await Promise.all(pe);const we=(await z(D.matchingPoolCollection)).docs.map(G=>ce(_e(ci,"matchingPool",G.id)));await Promise.all(we);const{ref:ie,remove:ve}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),de=["5uSH8SA6y4eZ7jkoLEZCRJZmTGW2","KB67Yg17rkZmCa8UV1N5xIUWoK12","o4mW4BmLWOOVBybTrYcvGJ4nimA3"];for(const G of de)try{await ve(ie(H,`users/${G}/buddyInfo`))}catch{console.log("Could not remove buddy info for:",G)}console.log("✅ Matching system reset completed"),setRealBuddy(null),setBuddyLoadAttempted(!1)}}catch(D){console.error("❌ Reset failed:",D)}},className:"mt-2 ml-2 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Reset Matching"})]})}),d.jsxs("div",{className:"battle-cards-container flex flex-col lg:flex-row items-center justify-center gap-4 lg:gap-12 mb-8 w-full",children:[d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!n||!x)return console.log("🎯 TradingCard: Missing data, not rendering user card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading User..."})});const D=S&&Object.keys(S).length>0?{...n.stats,...S}:e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,...x};return console.log(`🎯 TradingCard: Using ${S&&Object.keys(S).length>0?"latest centralized":e&&Object.keys(e).length>0?"centralized":"calculated"} stats for ${n.uid}`),console.log("🎯 TradingCard: Final stats:",{streak:D.streakDisplayText,addiction:D.addictionLevel,cravingsResisted:D.cravingsResisted}),d.jsx(Mb,{user:{...n,stats:D},showComparison:!1,nemesisUser:t})})()}),d.jsxs("div",{className:"vs-section flex flex-row lg:flex-col items-center justify-center space-x-4 lg:space-x-0 space-y-0 lg:space-y-4 flex-shrink-0",children:[d.jsx("div",{className:"vs-icon w-16 h-16 lg:w-24 lg:h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:d.jsx(uq,{className:"w-8 h-8 lg:w-12 lg:h-12 text-white"})}),d.jsx("div",{className:"bg-red-600 px-4 py-2 lg:px-8 lg:py-3 rounded-full",children:d.jsx("p",{className:"vs-text text-white font-bold text-lg lg:text-2xl",children:"VS"})})]}),d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{var z;if(!t||!P)return console.log("🎯 TradingCard: Missing data, not rendering nemesis card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Nemesis..."})});const D={...t,stats:{...t.stats,...P}};return j.streakDisplayText&&(D.stats.streakDisplayText=j.streakDisplayText,D.stats.streakDays=j.streakDays,D.stats.streakUnit=j.streakUnit),console.log("🎯 TradingCard: Buddy streak debug:",{realTimeNemesisStats:P,mergedNemesisStats:D.stats,buddyStreak:(z=D.stats)==null?void 0:z.streakDisplayText,preservedBuddyStreak:j}),d.jsx(Mb,{user:D,isNemesis:!0,showComparison:!1,nemesisUser:n})})()})]}),ye==="LOSING"&&be&&be.length>0&&d.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-4 sm:p-6 border border-slate-700",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),d.jsx("div",{className:"space-y-4",children:be.slice(0,3).map((D,z)=>d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3 sm:p-4 border-l-4 border-blue-500",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:D.isReduction?d.jsxs(d.Fragment,{children:["🎯 Reduce your ",D.stat," by ",D.change," points!"]}):D.isCombination?d.jsxs(d.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",D.change," total points!"]}):D.isMajor?d.jsxs(d.Fragment,{children:["🎯 Major improvement needed: ",D.change," total points!"]}):d.jsxs(d.Fragment,{children:["🎯 Increase your ",D.stat," by ",D.change," points!"]})}),d.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",D.action]})]}),d.jsxs("div",{className:`font-bold text-xl sm:text-2xl sm:ml-4 ${D.isReduction?"text-green-400":D.isCombination?"text-purple-400":D.isMajor?"text-orange-400":"text-blue-400"}`,children:[D.isReduction?"-":"+",D.change]})]})},z))}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),h&&d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>f(!1)}),d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600 p-6",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg text-sm transition-colors min-h-[44px] min-w-[44px]",title:"Share achievement for Motivation bonus",children:"📤 Share"}),d.jsx("button",{onClick:()=>f(!1),className:"modal-close-enhanced text-gray-400 hover:text-white text-2xl w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"×"})]})]}),d.jsxs("div",{className:"space-y-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),d.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),d.jsxs("p",{className:"text-green-400 font-mono",children:["(",x.mentalStrength||50," × 1.5) + (",x.motivation||50," × 1.0) + (",x.triggerDefense||30," × 1.2) - (",x.addictionLevel||50," × 1.0) = ",v.toFixed(1)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),d.jsxs("p",{className:"text-red-400 font-mono",children:["(",P.mentalStrength||50," × 1.5) + (",P.motivation||50," × 1.0) + (",P.triggerDefense||30," × 1.2) - (",P.addictionLevel||50," × 1.0) = ",te.toFixed(1)]})]}),d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:d.jsxs("p",{className:"text-gray-300 text-xs",children:[d.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",d.jsx("br",{}),d.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",d.jsx("br",{}),d.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",d.jsx("br",{}),d.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})]})},wq=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),d.jsx("div",{className:"modal-container",children:d.jsx("div",{className:"modal-content bg-slate-800 border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-3xl",children:i()})}),d.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),d.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),d.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})]})},Iq=({gameType:n,onClose:e})=>{const[t,r]=L.useState(0),{modalRef:s,classes:i}=rx(e,{threshold:100,velocity:.5,enabled:!0}),o=()=>{const l=L.useRef(null),[u,h]=L.useState([{x:12,y:12}]),[f,g]=L.useState({x:1,y:0}),[y,_]=L.useState({x:1,y:0}),[C,N]=L.useState({x:15,y:15}),[T,x]=L.useState(!1),[k,P]=L.useState(0),[$,j]=L.useState(1),R={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},S={1:5,2:5,3:10};return L.useEffect(()=>{const I=A=>{if(T){A.preventDefault(),h([{x:12,y:12}]),g({x:1,y:0}),_({x:1,y:0}),N({x:15,y:15}),x(!1),P(0),j(1);return}switch(A.key){case"ArrowUp":A.preventDefault(),f.y!==1&&_({x:0,y:-1});break;case"ArrowDown":A.preventDefault(),f.y!==-1&&_({x:0,y:1});break;case"ArrowLeft":A.preventDefault(),f.x!==1&&_({x:-1,y:0});break;case"ArrowRight":A.preventDefault(),f.x!==-1&&_({x:1,y:0});break}};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[f,T]),L.useEffect(()=>{if(T)return;const I=setInterval(()=>{h(A=>{const w={x:A[0].x+f.x,y:A[0].y+f.y};if(w.x<0&&(w.x=24),w.x>=25&&(w.x=0),w.y<0&&(w.y=24),w.y>=25&&(w.y=0),A.slice(0,-1).some(Ee=>Ee.x===w.x&&Ee.y===w.y))return x(!0),A;const v=w.x===C.x&&w.y===C.y;let te;return v?(P(Ee=>Ee+S[$]),N({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),te=[w,...A]):te=[w,...A.slice(0,-1)],(y.x!==f.x||y.y!==f.y)&&setTimeout(()=>{g(y)},0),te})},R[$]);return()=>clearInterval(I)},[f,y,C,T]),L.useEffect(()=>{const I=l.current;if(!I)return;const A=I.getContext("2d"),w=15,b=25;A.fillStyle="#1f2937",A.fillRect(0,0,375,375),A.strokeStyle="#374151",A.lineWidth=1;for(let v=0;v<=b;v++)A.beginPath(),A.moveTo(v*w,0),A.lineTo(v*w,375),A.stroke(),A.beginPath(),A.moveTo(0,v*w),A.lineTo(375,v*w),A.stroke();u.forEach((v,te)=>{te===0?A.fillStyle="#fbbf24":A.fillStyle="#10b981",A.fillRect(v.x*w+1,v.y*w+1,w-2,w-2)}),A.fillStyle="#ef4444",A.fillRect(C.x*w+2,C.y*w+2,w-4,w-4)},[u,C]),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"mb-4",children:d.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[d.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(I=>d.jsxs("button",{onClick:()=>j(I),className:`
                  px-4 py-3 text-sm font-mono border-2 border-green-500 transition-all min-h-[44px]
                  ${$===I?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[d.jsxs("div",{children:["Level ",I]}),d.jsxs("div",{className:"text-xs mt-1",children:[I===1&&"Normal",I===2&&"Fast",I===3&&"Insane"]})]},I))]})}),d.jsx("canvas",{ref:l,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",k," | Level: ",$]}),T&&d.jsxs("div",{className:"mt-2",children:[d.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),d.jsx("button",{onClick:()=>{h([{x:12,y:12}]),g({x:1,y:0}),_({x:1,y:0}),N({x:15,y:15}),x(!1),P(0),j(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Restart Game"})]})]})]})},a=()=>{try{return n==="snake"?d.jsx(o,{}):d.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(l){return console.error("Error rendering game:",l),d.jsxs("div",{className:"text-center text-red-600",children:[d.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),d.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Reload Game"})]})}};return d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{ref:s,className:`modal-content bg-white max-w-4xl ${i}`,role:"dialog","aria-modal":"true","aria-labelledby":"game-modal-title",children:[d.jsx("div",{className:"modal-swipe-indicator"}),d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 p-4",children:[d.jsx("h3",{id:"game-modal-title",className:"text-xl font-bold text-gray-800",children:"🐍 Snake Game"}),d.jsx("button",{onClick:e,className:"modal-close-button","aria-label":"Close game modal",children:"×"})]}),d.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center relative mx-4",children:a()}),d.jsxs("div",{className:"p-4",children:[d.jsx("div",{className:"flex justify-center items-center gap-4 mb-4",children:d.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:["Score: ",t]})}),d.jsx("div",{className:"modal-actions",children:d.jsx("button",{onClick:e,className:"modal-button modal-button-primary",children:"Close Game"})})]})]})]})})})},xq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,l]=L.useState(!1),[u,h]=L.useState(null),[f,g]=L.useState(!1),[y,_]=L.useState({title:"",message:"",type:"info"}),[C,N]=L.useState(null),[T,x]=L.useState(!1),[k,P]=L.useState(0),[$,j]=L.useState(!1),[R,S]=L.useState(!1),[I,A]=L.useState(1),[w,b]=L.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[v,te]=L.useState({resisted:0,relapses:0}),[Ee,ue]=L.useState(0),[ye,K]=L.useState(!1),[Se,Te]=L.useState(""),je=(G,oe,ee="info")=>{console.log("🔄 showQuickActionPopup called:",{title:G,message:oe,type:ee}),_({title:G,message:oe,type:ee}),g(!0),console.log("✅ showQuickActionPopup: Popup data set and showCustomPopup set to true")};S2.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=je),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),L.useEffect(()=>n!=null&&n.uid?(P(0),(async()=>{try{const ge=new Bm(H,n.uid);await ge.initialize(),N(ge)}catch(ge){console.error("Error initializing StatManager:",ge)}})(),(async()=>{try{const ge=new Date().toDateString(),{ref:Ae,get:Ke}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);try{const kt=Ae(H,`users/${n.uid}/profile/dailyCravingLogs/${ge}`),gt=await Ke(kt);if(gt.exists()){const Nt=gt.val();ue(Nt.count||0)}else ue(0)}catch{const gt=`cravingLogs_${n.uid}_${ge}`,Nt=localStorage.getItem(gt);if(Nt){const Ct=JSON.parse(Nt);ue(Ct.count||0)}else ue(0)}}catch(ge){console.error("Error loading daily craving logs:",ge),ue(0)}})(),(async()=>{try{const{ref:ge,get:Ae,onValue:Ke,query:kt,orderByChild:gt,startAt:Nt,endAt:Ct,set:Pt}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),wt=new Date,Pe=new Date(wt.getTime()-7*24*60*60*1e3),ut=Pe.toDateString(),Dt=wt.toDateString();try{const dt=ge(H,`users/${n.uid}/profile/cravingStats`),Un=await Ae(dt);if(Un.exists()){const Jn=Un.val();if(Jn.lastUpdated&&new Date(Jn.lastUpdated)>Pe){te(Jn);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:Vt,get:Yt,query:Et,orderByChild:Ft,startAt:vn,endAt:pt}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),It=Vt(H,`users/${n.uid}/cravings`),kr=Et(It,Ft("date"),vn(ut),pt(Dt));try{const dt=await Yt(kr);let Un=0,Jn=0;if(console.log(`🔍 Weekly Stats: Checking cravings for ${ut} to ${Dt}`),console.log(`🔍 Weekly Stats: Cravings snapshot exists: ${dt.exists()}`),dt.exists()){const cs=dt.val();console.log("🔍 Weekly Stats: Raw cravings data:",cs),dt.forEach(us=>{const ti=us.val();console.log("🔍 Weekly Stats: Individual craving:",ti),ti.outcome==="resisted"?Un++:ti.outcome==="relapsed"&&Jn++})}console.log(`🔍 Weekly Stats: Calculated - resisted: ${Un}, relapses: ${Jn}`);const ks={resisted:Un,relapses:Jn,lastUpdated:wt.toISOString()};te(ks);try{const cs=ge(H,`users/${n.uid}/profile/cravingStats`);await Pt(cs,ks)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(ks))}catch{console.log("Could not query cravings, using localStorage fallback");const Un=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');te(Un)}const mr=ge(H,`users/${n.uid}/profile/cravingStats`);return Ke(mr,dt=>{dt.exists()&&te(dt.val())})}catch(ge){console.error("Error loading weekly stats:",ge);const Ae=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');te(Ae)}})(),(async()=>{try{const{ref:ge,get:Ae,onValue:Ke}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),kt=new Date().toDateString(),gt=ge(H,`users/${n.uid}/profile/daily/${kt}/water`),Nt=await Ae(gt);if(Nt.exists())P(Nt.val()||0);else{const Pt=parseInt(localStorage.getItem(`water_${n.uid}_${kt}`)||0);P(Pt)}return Ke(gt,Pt=>{Pt.exists()&&P(Pt.val()||0)})}catch(ge){console.error("Error loading daily water from Firebase:",ge);const Ae=new Date().toDateString(),Ke=parseInt(localStorage.getItem(`water_${n.uid}_${Ae}`)||0);P(Ke)}})(),()=>{P(0),x(!1),te({resisted:0,relapses:0}),S(!1),A(1),b({strength:5,mood:"",context:"",outcome:""}),ue(0),K(!1),Te("")}):void 0,[n==null?void 0:n.uid]);const be=()=>{h("snake"),l(!0)},D=()=>{h(null),l(!1)},z=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const G=Math.min(k+1,6);P(G);const oe=new Date().toDateString();if(C){if(await C.handleHydrationUpdate(G),o)try{const Ae=await C.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:G,targetGlasses:6,currentStreak:Ae}),console.log("✅ Hydration also logged to Firestore for analytics")}catch(Ae){console.warn("⚠️ Could not log hydration to Firestore:",Ae.message),await handleOfflineBehavioralLog("hydration",{glassesConsumed:G,targetGlasses:6,currentStreak:await C.checkHydrationStreak()})}else await handleOfflineBehavioralLog("hydration",{glassesConsumed:G,targetGlasses:6,currentStreak:await C.checkHydrationStreak()});G===6&&k===5&&await C.checkHydrationStreak()>=3&&(await C.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:ee,set:ae}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),ge=ee(H,`users/${n.uid}/profile/daily/${oe}/water`);await ae(ge,G),localStorage.setItem(`water_${n.uid}_${oe}`,G.toString()),console.log("Water intake updated:",G)}catch(G){console.error("Error updating water intake:",G);const oe=Math.min(k+1,6);P(oe);const ee=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${ee}`,oe.toString())}},ce=()=>{b({strength:5,mood:"",context:"",outcome:""}),A(1),S(!0)},_e=()=>{I<4&&A(I+1)},Ne=()=>{I>1&&A(I-1)},pe=async G=>{var oe;try{const ee=new Date().toISOString(),ae=new Date().toDateString(),ge=new Date,Ae={...w,outcome:G,timestamp:ee,date:ae,timeOfDay:ge.getHours()<12?"morning":ge.getHours()<17?"afternoon":"evening",dayOfWeek:ge.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((ge.getDate()+new Date(ge.getFullYear(),0,1).getDay())/7),month:ge.toLocaleDateString("en-US",{month:"long"}),year:ge.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:G==="resisted",relapsed:G==="relapsed",logged:G==="logged",usedPractices:G==="resistance_practices"}},Ke=new Date().toDateString(),kt=Ee+1;ue(kt);let gt={resisted:v.resisted,relapses:v.relapses,lastUpdated:ee},Nt=!1;kt<=2&&C&&(await C.handleCravingLogged(),Nt=!0);const{ref:Ct,set:Pt,push:wt,get:Pe}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);if(n&&n.uid){try{const pt=Ct(H,`users/${n.uid}/profile/dailyCravingLogs/${Ke}`);await Pt(pt,{count:kt,lastUpdated:ee})}catch{const It=`cravingLogs_${n.uid}_${Ke}`;localStorage.setItem(It,JSON.stringify({count:kt,lastUpdated:ee}))}const Dt=Ct(H,`users/${n.uid}/cravings`),Vt=wt(Dt);if(await Pt(Vt,Ae),o)try{await o.logCraving(n.uid,{outcome:"resisted",strength:w.strength,duration:w.duration,context:"detailed_assessment",triggers:w.triggers||[],mood:w.mood,stressLevel:w.stressLevel,copingStrategiesUsed:w.copingStrategies||[],location:w.location,socialSituation:w.socialSituation}),console.log("✅ Craving also logged to Firestore for analytics")}catch(pt){console.warn("⚠️ Could not log craving to Firestore:",pt.message),await handleOfflineBehavioralLog("craving",{outcome:"resisted",strength:w.strength,duration:w.duration,context:"detailed_assessment",triggers:w.triggers||[],mood:w.mood,stressLevel:w.stressLevel,copingStrategiesUsed:w.copingStrategies||[],location:w.location,socialSituation:w.socialSituation})}let Yt=[],Et=[];try{const pt=Ct(H,`users/${n.uid}/profile/cravingHistory/${Ke}`),It=await Pe(pt);Yt=It.exists()?It.val():[],Yt.push({id:Vt.key,strength:Ae.strength,mood:Ae.mood,context:Ae.context,outcome:Ae.outcome,timestamp:Ae.timestamp,timeOfDay:Ae.timeOfDay}),await Pt(pt,Yt),console.log(`📅 Daily history updated for ${Ke}:`,Yt.length,"records")}catch(pt){console.warn("⚠️ Could not save to daily history:",pt)}const Ft=`${ge.getFullYear()}-${String(ge.getMonth()+1).padStart(2,"0")}`;try{const pt=Ct(H,`users/${n.uid}/profile/cravingTrends/${Ft}`),It=await Pe(pt);Et=It.exists()?It.val():[],Et.push({id:Vt.key,date:Ae.date,strength:Ae.strength,outcome:Ae.outcome,timeOfDay:Ae.timeOfDay}),await Pt(pt,Et),console.log(`📊 Monthly trends updated for ${Ft}:`,Et.length,"records")}catch(pt){console.warn("⚠️ Could not save to monthly trends:",pt)}const vn=Ct(H,`users/${n.uid}/profile/cravingStats`);if(G==="resisted"){gt.resisted=v.resisted+1;let pt=null,It=!0;if(window.centralizedStatService){console.log("🔄 Detailed Assessment: Using CentralizedStatService...");const kr=await window.centralizedStatService.getCurrentStats();((kr==null?void 0:kr.mentalStrengthCravingsApplied)||0)>=3&&(It=!1,console.log("🔄 Detailed Assessment: Daily mental strength limit reached")),await window.centralizedStatService.handleCravingResisted(),console.log("✅ Detailed Assessment: Stats updated via CentralizedStatService")}else C&&(pt=await C.checkDailyCravingResistanceLimits(Ke),await C.handleCravingResistance());Ae.resistanceLimits={...pt,canAwardMentalStrength:It}}else if(G==="relapsed"){if(gt.relapses=v.relapses+1,C){console.log("🔄 Detailed Craving: Calling StatManager.handleRelapse()...");const pt=await C.handleRelapse();if(console.log("🔄 Detailed Craving: StatManager.handleRelapse() result:",pt),o)try{const It=await C.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:It,triggers:w.triggers||[],mood:w.mood,stressLevel:w.stressLevel,location:w.location,socialSituation:w.socialSituation,copingAttempts:w.copingStrategies||[],addictionIncrease:It===1?4:It===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Relapse also logged to Firestore for analytics")}catch(It){console.warn("⚠️ Could not log relapse to Firestore:",It.message),await handleOfflineBehavioralLog("relapse",{escalationLevel:await C.getCurrentEscalationLevel(),triggers:w.triggers||[],mood:w.mood,stressLevel:w.stressLevel,location:w.location,socialSituation:w.socialSituation,copingAttempts:w.copingStrategies||[],addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}}else console.error("❌ Detailed Craving: StatManager not available!");console.log("🔄 Detailed Craving: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Detailed Craving: Secondary stats refresh..."),refreshStats()},1500)):console.error("❌ Detailed Craving: refreshStats function not available!"),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Detailed Craving: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Detailed Craving: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3))}await Pt(vn,gt),te(gt),console.log("📊 Craving assessment saved to database:",{userId:n.uid,cravingId:Vt.key,data:Ae,databasePaths:{main:`users/${n.uid}/cravings/${Vt.key}`,dailyHistory:`users/${n.uid}/profile/cravingHistory/${Ke}`,monthlyTrends:`users/${n.uid}/profile/cravingTrends/${Ft}`,weeklyStats:`users/${n.uid}/profile/cravingStats`,dailyLogs:`users/${n.uid}/profile/dailyCravingLogs/${Ke}`},summary:{dailyHistoryRecords:(Yt==null?void 0:Yt.length)||0,monthlyTrendsRecords:(Et==null?void 0:Et.length)||0,monthKey:Ft,today:Ke}})}const ut=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");if(ut.push(Ae),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(ut)),localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(gt)),G==="resisted")if(Ae.resistanceLimits){const Dt=Ae.resistanceLimits;if(!Dt.canAwardMentalStrength&&!Dt.canAwardTriggerDefense)_({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"});else if(!Dt.canAwardMentalStrength)_({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"});else if(!Dt.canAwardTriggerDefense)_({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"});else{const Vt=await((oe=window.centralizedStatService)==null?void 0:oe.getCurrentStats()),Yt=3-(((Vt==null?void 0:Vt.mentalStrengthCravingsApplied)||0)+1);Yt>0?_({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength increased by 1 point (${Yt} more today) and Trigger Defense increased by 3 points!

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}):_({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength increased by 1 point (daily max reached!) and Trigger Defense increased by 3 points!

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"})}}else _({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"});else _(G==="resistance_practices"?{title:"🛡️ Stay Strong!",message:`Stay strong! Use distraction or wellbeing practices to resist.

You earned awareness bonuses for tracking your craving!`,type:"info"}:G==="relapsed"?{title:"💪 Don't Give Up",message:`Relapses happen to everyone. The important thing is that you're here and trying again.

You still earned awareness bonuses for tracking your craving!`,type:"info"}:G==="logged"?Nt?{title:"📝 Craving Logged",message:`Great job tracking your craving!

You earned awareness bonuses for your self-awareness.

This helps build your Motivation and Trigger Defense.`,type:"info"}:{title:"📝 Daily Limit Reached",message:"Daily craving logging limit reached. Additional logs are recorded but won't award stat points until tomorrow.",type:"info"}:{title:"📝 Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"});g(!0),S(!1),A(1)}catch(ee){console.error("Error saving craving assessment:",ee),_({title:"Progress Recorded",message:`Your progress has been recorded locally.

Keep up the great work!`,type:"info"}),g(!0),S(!1),A(1)}},Z=async()=>{try{const G=new Date().toISOString(),oe=new Date().toDateString();let ee=null;const{ref:ae,set:ge,push:Ae,get:Ke}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);if(n&&n.uid){const Nt=ae(H,`users/${n.uid}/cravings`),Ct=Ae(Nt);await ge(Ct,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:G,date:oe});const Pt=ae(H,`users/${n.uid}/profile/cravingStats`),wt={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:G};if(await ge(Pt,wt),te(wt),window.centralizedStatService){console.log("🔄 Quick Resistance: Using CentralizedStatService...");const Pe=await window.centralizedStatService.getCurrentStats(),ut=(Pe==null?void 0:Pe.mentalStrengthCravingsApplied)||0;console.log("🔄 Quick Resistance: Current mental strength bonus before processing:",ut);const Dt=await window.centralizedStatService.handleCravingResisted();if(console.log("✅ Quick Resistance: Stats updated via CentralizedStatService"),Dt&&Dt.applied){const Vt=Dt.cravingsApplied||0,Yt=Math.max(0,3-Vt);console.log("🔄 Quick Resistance: Bonus applied, remaining:",Yt),Yt>0?je("Craving Resisted! 💪",`Great job! You earned +1 mental strength point. You can still earn ${Yt} more today.`,"success"):je("Craving Resisted! 💪","Excellent! You've reached the daily maximum of 3 mental strength points from craving resistance.","success")}else console.log("🔄 Quick Resistance: Daily limit reached, showing limit message"),je("Daily Mental Strength Limit Reached","You've already earned the maximum 3 mental strength points from craving resistance today. Keep up the great work! Your resistance still counts for your overall progress.","info");typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Resistance: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Resistance: Secondary Arena stats refresh..."),window.refreshArenaStats()},1e3));return}else C&&(ee=await C.checkDailyCravingResistanceLimits(oe),await C.handleCravingResistance())}const kt=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");kt.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:G,date:oe}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(kt));const gt={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:G};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(gt)),te(gt),ee?!ee.canAwardMentalStrength&&!ee.canAwardTriggerDefense?_({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):ee.canAwardMentalStrength?ee.canAwardTriggerDefense?_({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):_({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):_({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):_({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),g(!0)}catch(G){console.error("Error recording quick resistance:",G),_({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),g(!0)}},we=async()=>{try{const G=new Date().toISOString(),oe=new Date().toDateString();if(n&&n.uid){const{ref:ge,set:Ae,push:Ke}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),kt=ge(H,`users/${n.uid}/cravings`),gt=Ke(kt);if(await Ae(gt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:G,date:oe}),window.centralizedStatService)console.log("🔄 Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Quick Relapse: Stats updated via CentralizedStatService"),je("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! 💪`,"warning");else if(C){console.log("🔄 Quick Relapse: Calling StatManager.handleRelapse()...");const Pt=await C.handleRelapse();if(console.log("🔄 Quick Relapse: StatManager.handleRelapse() result:",Pt),o)try{const wt=await C.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:wt,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:wt===1?4:wt===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Quick relapse also logged to Firestore for analytics")}catch(wt){console.warn("⚠️ Could not log quick relapse to Firestore:",wt.message),await handleOfflineBehavioralLog("relapse",{escalationLevel:await C.getCurrentEscalationLevel(),triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}try{await new Promise(Dt=>setTimeout(Dt,100));const{ref:wt,get:Pe}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),ut=await Pe(wt(H,`users/${n.uid}/stats`));if(ut.exists()){const Dt=ut.val();console.log("🔍 Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",Dt)}else console.log("❌ Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(wt){console.error("❌ Quick Relapse: VERIFICATION failed:",wt)}try{const wt=await C.getCurrentEscalationLevel();let Pe=0;switch(wt){case 1:Pe=4;break;case 2:Pe=6;break;default:Pe=8;break}je("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

📊 Stat Changes:
• Addiction: +${Pe} points
• Mental Strength: -3 points
• Trigger Defense: -3 points

Your journey continues! 💪`,"warning")}catch(wt){console.warn("Could not get escalation level for message:",wt),je("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! 💪`,"warning")}}else console.error("❌ Quick Relapse: StatManager not available!"),je("⚠️ Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const Nt=ge(H,`users/${n.uid}/profile/cravingStats`),Ct={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:G};await Ae(Nt,Ct),te(Ct),console.log("🔄 Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log("ℹ️ Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)"),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Relapse: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3))}const ee=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");ee.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:G,date:oe}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(ee));const ae={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:G};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(ae)),te(ae)}catch(G){console.error("Error recording quick relapse:",G),je("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! 💪`,"warning")}},ie=async(G,oe=30)=>{try{if(!G)return null;const{ref:ee,get:ae,query:ge,orderByChild:Ae,startAt:Ke,endAt:kt}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),gt=new Date,Nt=new Date(gt.getTime()-oe*24*60*60*1e3),Ct=ee(H,`users/${G}/cravings`),Pt=await ae(Ct);if(!Pt.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const Pe=Object.values(Pt.val()||{}).filter(lt=>{const dt=new Date(lt.timestamp);return dt>=Nt&&dt<=gt});if(Pe.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const ut=Pe.filter(lt=>lt.outcome==="resisted").length,Dt=Pe.filter(lt=>lt.outcome==="relapsed").length,Vt=Pe.length,Yt=Pe.reduce((lt,dt)=>lt+(dt.strength||0),0)/Vt,Et={},Ft={},vn={},pt={};Pe.forEach(lt=>{lt.mood&&(Et[lt.mood]=(Et[lt.mood]||0)+1),lt.context&&(Ft[lt.context]=(Ft[lt.context]||0)+1),lt.timeOfDay&&(vn[lt.timeOfDay]=(vn[lt.timeOfDay]||0)+1);const dt=new Date(lt.timestamp),Un=`${dt.getFullYear()}-W${Math.ceil((dt.getDate()+new Date(dt.getFullYear(),0,1).getDay())/7)}`;pt[Un]=(pt[Un]||0)+1});const It=Object.entries(Et).sort(([,lt],[,dt])=>dt-lt).slice(0,3).map(([lt,dt])=>({mood:lt,count:dt})),kr=Object.entries(Ft).sort(([,lt],[,dt])=>dt-lt).slice(0,3).map(([lt,dt])=>({context:lt,count:dt})),mr=[];return ut>Dt&&mr.push("You're successfully resisting more cravings than giving in - great job!"),Yt>7&&mr.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),vn.afternoon>vn.morning&&vn.afternoon>vn.evening&&mr.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),It.length>0&&It[0].count>Vt*.4&&mr.push(`You often experience cravings when feeling ${It[0].mood}. This might be a key trigger to address.`),{totalCravings:Vt,resistedCount:ut,relapseCount:Dt,averageStrength:Math.round(Yt*10)/10,successRate:Vt>0?Math.round(ut/Vt*100):0,commonMoods:It,commonContexts:kr,timeOfDayPatterns:vn,weeklyTrends:pt,insights:mr,dateRange:{start:Nt.toDateString(),end:gt.toDateString(),days:oe}}}catch(ee){return console.error("Error getting craving insights:",ee),null}},ve=async(G,oe="json")=>{try{if(!G)return null;const{ref:ee,get:ae}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),ge=ee(H,`users/${n.uid}/cravings`),Ae=await ae(ge);if(!Ae.exists())return console.log("No craving data to export"),null;const Ke=Object.values(Ae.val()||{});if(oe==="json"){const kt=JSON.stringify(Ke,null,2),gt=new Blob([kt],{type:"application/json"}),Nt=URL.createObjectURL(gt),Ct=document.createElement("a");return Ct.href=Nt,Ct.download=`craving-data-${G}-${new Date().toISOString().split("T")[0]}.json`,Ct.click(),URL.revokeObjectURL(Nt),console.log(`Exported ${Ke.length} craving records for user ${G}`),Ke.length}return Ke.length}catch(ee){return console.error("Error exporting craving data:",ee),null}},de=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log("🧪 Testing craving insights...");const G=await ie(n.uid,30);G?(console.log("📊 Craving Insights:",G),_({title:"📊 Your Craving Insights",message:`Last 30 days:

Total cravings: ${G.totalCravings}
Successfully resisted: ${G.resistedCount}
Relapses: ${G.relapseCount}
Success rate: ${G.successRate}%
Average intensity: ${G.averageStrength}/10

Top mood triggers: ${G.commonMoods.map(oe=>`${oe.mood} (${oe.count})`).join(", ")}
Top contexts: ${G.commonContexts.map(oe=>`${oe.context} (${oe.count})`).join(", ")}

Insights:
${G.insights.join(`
`)}`,type:"info"}),g(!0)):(console.log("No insights available"),_({title:"📊 No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),g(!0))};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsx("div",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-start gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[d.jsx("div",{className:"mb-8",children:d.jsx("button",{onClick:ce,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-xl",children:"⚠️"}),d.jsx("span",{children:"I feel like vaping"})]})})}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsx("button",{onClick:Z,className:"btn-success touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-green-400",children:"✅"}),d.jsx("span",{children:"I resisted craving"})]})}),d.jsx("button",{onClick:we,className:"btn-danger touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-red-400",children:"❌"}),d.jsx("span",{children:"I relapsed"})]})})]})]}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"📊 This Week"}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-green-400",children:"🎯"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.resisted}),d.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-red-400",children:"💔"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.relapses}),d.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"🎮 Distract Yourself"}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:be,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🐍 Play Snake"})})]})}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"📊 Data Analysis"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:de,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg min-h-[44px]",children:"🔍 View Insights"}),d.jsx("button",{onClick:()=>ve(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg min-h-[44px]",children:"📥 Export Data"})]})]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"⚡ Quick Actions"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:()=>x(!0),className:"btn-primary touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"💧 Hydration"}),d.jsx("button",{onClick:()=>j(!0),className:"breathing-button touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🫁 Breathe"}),d.jsx("button",{onClick:async()=>{if(je("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log("✅ Physical activity (walk) logged to Firestore for analytics")}catch(G){console.warn("⚠️ Could not log physical activity to Firestore:",G.message),await handleOfflineBehavioralLog("walk",{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"})}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🚶‍♂️ Walk"}),d.jsx("button",{onClick:async()=>{if(je("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log("✅ Meditation (quick) logged to Firestore for analytics")}catch(G){console.warn("⚠️ Could not log meditation to Firestore:",G.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🧘‍♀️ Meditate"})]})]}),a&&u&&d.jsx(Iq,{gameType:u,onClose:D}),d.jsx(wq,{isOpen:f,onClose:()=>g(!1),title:y.title,message:y.message,type:y.type}),T&&d.jsx(Eq,{isOpen:T,onClose:()=>x(!1),onLogWater:z,currentWater:k,userId:n.uid}),$&&d.jsx(nq,{isOpen:$,onClose:()=>j(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),R&&d.jsx(Sq,{isOpen:R,onClose:()=>S(!1),step:I,cravingData:w,setCravingData:b,onNext:_e,onPrev:Ne,onComplete:pe,dailyCravingLogs:Ee})]})})},Sq=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:l})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"😰",label:"Stressed"},{id:"lonely",icon:"😔",label:"Lonely"},{id:"happy",icon:"😊",label:"Happy"},{id:"bored",icon:"😐",label:"Bored"},{id:"excited",icon:"🤩",label:"Excited"},{id:"down",icon:"😞",label:"Down"},{id:"angry",icon:"😠",label:"Angry"},{id:"anxious",icon:"😰",label:"Anxious"}],f=[{id:"break",icon:"☕",label:"I'm taking a break"},{id:"partying",icon:"🎉",label:"I'm partying"},{id:"drinking",icon:"🍺",label:"I'm drinking alcohol"},{id:"car",icon:"🚗",label:"I'm in a car"},{id:"coffee",icon:"☕",label:"I'm drinking coffee"},{id:"eating",icon:"🍽️",label:"I've just finished eating"},{id:"intimate",icon:"💕",label:"I've made love"},{id:"tv",icon:"📺",label:"I'm watching TV"},{id:"wake",icon:"🌅",label:"I've just woken up"}],g=()=>{switch(t){case 1:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),d.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),d.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:_=>s({...r,strength:parseInt(_.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`,autoComplete:"off"}),d.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[d.jsx("span",{children:"Not at all"}),d.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>d.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>d.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-2xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💪 I successfully resisted"}),d.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🛡️ Use resistance practices"}),d.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"📝 Just log this craving"}),d.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💔 I had a relapse"})]})});default:return null}};return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 border-slate-600/50 relative overflow-hidden max-w-lg",children:[d.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),d.jsxs("div",{className:"relative z-10",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>d.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),d.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),d.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",l,"/2"]})]}),d.jsx("div",{className:"mb-8",children:g()}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:"← Back"}),t<4&&d.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next →"})]}),d.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:"×"})]})]})})}):null},Eq=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=L.useState(0),[a,l]=L.useState(0),[u,h]=L.useState(!1);L.useState(!1),L.useEffect(()=>{n&&s&&f()},[n,s,r]);const f=async()=>{try{const{ref:N,get:T}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),x=await g();o(x);const k=await y();l(k)}catch(N){console.error("Error loading hydration data:",N)}},g=async()=>{try{const{ref:N,get:T}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);let x=0;for(let k=0;k<7;k++){const P=new Date;P.setDate(P.getDate()-k);const $=P.toDateString(),j=await T(N(H,`users/${s}/profile/daily/${$}/water`));if(j.exists()&&j.val()>0)x++;else break}return x}catch(N){return console.error("Error checking hydration streak:",N),0}},y=async()=>{try{const{ref:N,get:T}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);let x=0;for(let k=0;k<7;k++){const P=new Date;P.setDate(P.getDate()-k);const $=P.toDateString(),j=await T(N(H,`users/${s}/profile/daily/${$}/water`));j.exists()&&j.val()>=6&&x++}return Math.min(x,3)}catch(N){return console.error("Error checking mental strength progress:",N),0}},_=()=>d.jsx("div",{className:"glasses-visual",children:[...Array(6)].map((N,T)=>{const x=T<r;return d.jsx("div",{className:`glass ${x?"filled":""}`},T)})}),C=async()=>{!s||u||r>=6||(h(!0),t(),setTimeout(async()=>{h(!1),await f()},1e3))};return!n||!s?null:d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsx("div",{className:"modal-content",children:d.jsxs("div",{className:"hydration-module",children:[d.jsxs("div",{className:"module-header",children:[d.jsxs("div",{className:"module-title",children:[d.jsx("div",{className:"water-icon",children:"💧"}),"Hydration Tracker"]}),d.jsx("p",{className:"subtitle",children:"Stay hydrated, stay strong"})]}),d.jsxs("div",{className:"progress-container",children:[d.jsxs("div",{className:"progress-header",children:[d.jsx("span",{className:"progress-text",children:"Today's Progress"}),d.jsxs("span",{className:"progress-fraction",children:[r,"/6"]})]}),_(),d.jsx("div",{className:"progress-bar",children:d.jsx("div",{className:"progress-fill",style:{width:`${r/6*100}%`}})}),d.jsxs("div",{className:"progress-percentage",children:[Math.round(r/6*100),"% Complete"]})]}),d.jsxs("div",{className:"streak-section",children:[d.jsxs("div",{className:"streak-card",children:[d.jsx("span",{className:"streak-icon",children:"🔥"}),d.jsx("div",{className:"streak-label",children:"Hydration Streak"}),d.jsxs("div",{className:"streak-value",children:[i," days"]})]}),d.jsxs("div",{className:"streak-card",children:[d.jsx("span",{className:"streak-icon",children:"💪"}),d.jsx("div",{className:"streak-label",children:"Mental Strength"}),d.jsxs("div",{className:"streak-value",children:[a,"/3"]})]})]}),r===6&&d.jsx("div",{className:"completion-message",children:"🎉 Congratulations! You've completed your daily hydration goal!"}),d.jsx("button",{onClick:C,disabled:r>=6||u,className:"log-button",children:r>=6?"🎉 Goal Complete!":u?"💧 Logging...":"💧 Log Water"}),d.jsx("button",{onClick:e,className:"done-button",children:"Done"})]})})})})},Tq=({user:n,onNavigate:e})=>{const[t,r]=L.useState(null),[s,i]=L.useState(!1),[o,a]=L.useState(!1),[l,u]=L.useState(!1),[h,f]=L.useState(!1),[g,y]=L.useState(null),[_,C]=L.useState(0),[N,T]=L.useState(null),[x,k]=L.useState(!1),[P,$]=L.useState([]),[j,R]=L.useState(null);L.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const ie=new Bm(H,n.uid);await ie.initialize(),R(ie)}catch(ie){console.error("Error initializing StatManager:",ie)}})();const Z=async()=>{try{const{ref:ie,get:ve,onValue:de}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),G=ie(H,`users/${n.uid}/profile/relapseDate`),oe=await ve(G);oe.exists()&&r(new Date(oe.val()));const ee=ie(H,`users/${n.uid}/profile/scheduledTriggers`),ae=await ve(ee);ae.exists()&&$(ae.val());const ge=new Date().toDateString(),Ae=ie(H,`users/${n.uid}/profile/daily/${ge}/water`),Ke=de(Ae,Pe=>{Pe.exists()&&C(Pe.val()||0)}),kt=ie(H,`users/${n.uid}/profile/daily/${ge}/mood`),gt=de(kt,Pe=>{Pe.exists()&&T(Pe.val())}),Nt=ie(H,`users/${n.uid}/profile/daily/${ge}/breathing`),Ct=de(Nt,Pe=>{Pe.exists()&&k(Pe.val()||!1)}),Pt=ie(H,`users/${n.uid}/profile/scheduledTriggers`),wt=de(Pt,Pe=>{Pe.exists()&&$(Pe.val()||[])});return()=>{Ke(),gt(),Ct(),wt()}}catch(ie){console.error("Error loading profile data from Firebase:",ie),we()}},we=()=>{const ie=localStorage.getItem("quitCoachRelapseDate");ie&&r(new Date(ie));const ve=new Date().toDateString(),de=localStorage.getItem(`water_${n.uid}_${ve}`),G=localStorage.getItem(`mood_${n.uid}_${ve}`),oe=localStorage.getItem(`breathing_${n.uid}_${ve}`);de&&C(parseInt(de)),G&&T(JSON.parse(G)),oe&&k(oe==="true");const ee=localStorage.getItem("scheduledTriggers");ee&&$(JSON.parse(ee))};Z()},[n==null?void 0:n.uid]),L.useEffect(()=>{j&&j.trackLoggingActivity()},[j]),L.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:Z,get:we,set:ie}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),ve=Z(H,`users/${n.uid}/profile`),de=await we(ve);if(!de.exists()||Object.keys(de.val()).length===0){console.log("Migrating localStorage data to Firebase...");const G=localStorage.getItem("quitCoachRelapseDate");G&&(await ie(Z(H,`users/${n.uid}/profile/relapseDate`),G),r(new Date(G)));const oe=parseInt(localStorage.getItem("cravingWins")||0);oe>0&&await ie(Z(H,`users/${n.uid}/profile/cravingsResisted`),oe);for(let ae=0;ae<7;ae++){const ge=new Date;ge.setDate(ge.getDate()-ae);const Ae=ge.toDateString(),Ke=localStorage.getItem(`water_${n.uid}_${Ae}`);Ke&&await ie(Z(H,`users/${n.uid}/profile/daily/${Ae}/water`),parseInt(Ke))}for(let ae=0;ae<7;ae++){const ge=new Date;ge.setDate(ge.getDate()-ae);const Ae=ge.toDateString(),Ke=localStorage.getItem(`mood_${n.uid}_${Ae}`);Ke&&await ie(Z(H,`users/${n.uid}/profile/daily/${Ae}/mood`),JSON.parse(Ke))}for(let ae=0;ae<7;ae++){const ge=new Date;ge.setDate(ge.getDate()-ae);const Ae=ge.toDateString(),Ke=localStorage.getItem(`breathing_${n.uid}_${Ae}`);Ke&&await ie(Z(H,`users/${n.uid}/profile/daily/${Ae}/breathing`),Ke==="true")}const ee=localStorage.getItem("scheduledTriggers");if(ee){const ae=JSON.parse(ee);await ie(Z(H,`users/${n.uid}/profile/scheduledTriggers`),ae),$(ae)}console.log("localStorage data migration to Firebase completed")}}catch(Z){console.error("Error migrating localStorage data to Firebase:",Z)}})()},[n==null?void 0:n.uid]);const S=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,I=()=>{const pe=new Date,Z=new Date(pe);Z.setHours(24,0,0,0);const we=Z-pe,ie=Math.floor(we/(1e3*60*60)),ve=Math.floor(we%(1e3*60*60)/(1e3*60)),de=Math.floor(we%(1e3*60)/1e3);return{hours:ie,minutes:ve,seconds:de}},[A,w]=L.useState(I()),[b,v]=L.useState(0),[te,Ee]=L.useState(0),[ue,ye]=L.useState(0),[K,Se]=L.useState(0);L.useEffect(()=>{const pe=setInterval(()=>{w(I());const Z=S(),ie=new Date-Z,ve=Math.floor(ie/(1e3*60*60*24)),de=Math.floor(ie%(1e3*60*60*24)/(1e3*60*60)),G=Math.floor(ie%(1e3*60*60)/(1e3*60)),oe=Math.floor(ie%(1e3*60)/1e3);v(ve),Ee(de),ye(G),Se(oe)},1e3);return()=>clearInterval(pe)},[t,n==null?void 0:n.quitDate]);const Te=async(pe,Z)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:we,set:ie}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),ve=we(H,`users/${n.uid}/profile/${pe}`);return await ie(ve,Z),!0}catch(we){return console.error("Error saving to Firebase:",we),!1}},je=async()=>{const pe=new Date;r(pe),j&&await j.handleRelapse();const Z=pe.toISOString(),we=await Te("relapseDate",Z),ie=await Te("lastQuitDate",Z);we||localStorage.setItem("quitCoachRelapseDate",Z),ie||localStorage.setItem("quitCoachLastQuitDate",Z),console.log("🔄 Relapse logged - quit date reset to relapse time:",Z)},D=(()=>{const pe=new Date,Z=pe.getDay(),we=Z===0?6:Z-1,ie=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let ve=0;ve<=we;ve++)ie[ve].color="bg-green-500";return t&&t.toDateString()===pe.toDateString()&&(ie[we].color="bg-red-500"),ie})(),z=async pe=>{C(pe);const Z=new Date().toDateString();j&&await j.handleHydrationUpdate(pe),await Te(`daily/${Z}/water`,pe)||localStorage.setItem(`water_${Z}`,pe.toString()),i(!1)},ce=async pe=>{T(pe);const Z=new Date().toDateString();await Te(`daily/${Z}/mood`,pe)||localStorage.setItem(`mood_${Z}`,JSON.stringify(pe)),a(!1)},_e=async(pe,Z,we)=>{const ie={day:pe,triggerType:Z,time:we,id:Date.now()},ve=[...P,ie];$(ve),j&&await j.handleTriggerPlanning(),await Te("scheduledTriggers",ve)||localStorage.setItem("scheduledTriggers",JSON.stringify(ve)),u(!1)},Ne=async()=>{j&&await j.handleTriggerListUpdate()};return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-white text-lg",children:"Hello,"}),d.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),d.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:d.jsx("span",{className:"font-bold text-slate-900",children:b})})]}),d.jsxs("div",{className:"px-4 space-y-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("button",{onClick:je,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-2xl",children:"⚠️"}),d.jsx("span",{className:"text-lg",children:"RELAPSE"}),d.jsx("span",{className:"text-2xl",children:"⚠️"})]}),d.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),d.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[d.jsx("span",{className:"text-white text-sm",children:"✓"}),d.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),d.jsx("div",{className:"flex justify-between items-center mb-4",children:D.map((pe,Z)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${pe.color}`}),d.jsx("p",{className:"text-gray-400 text-xs",children:pe.name})]},pe.name))})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-white text-3xl font-bold",children:[A.hours.toString().padStart(2,"0"),":",A.minutes.toString().padStart(2,"0"),":",A.seconds.toString().padStart(2,"0")]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),d.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),d.jsxs("div",{className:"flex items-baseline gap-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:b.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:te.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:ue.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:K.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&d.jsx("div",{className:"mt-3 text-center",children:d.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),d.jsx("p",{className:"text-gray-300 text-sm",children:_>0?`${_} glasses today`:"Tap to log water intake"})]}),d.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),d.jsx("p",{className:"text-gray-300 text-sm",children:N?`You feel ${N.name.toLowerCase()}`:"How do you feel today?"})]}),d.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:P.length>0?`${P.length} triggers planned`:"Plan your trigger defense strategy"})]}),d.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:Ne,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),d.jsx("div",{children:d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),d.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),d.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),d.jsx(bq,{isOpen:s,onClose:()=>i(!1),onConfirm:z,currentWater:_}),d.jsx(Aq,{isOpen:o,onClose:()=>a(!1),onSelect:ce,selectedMood:N}),d.jsx(Cq,{isOpen:l,onClose:()=>u(!1),onSchedule:_e,scheduledTriggers:P}),d.jsx(Rq,{isOpen:h,onClose:()=>f(!1),selectedDate:g,onDateSelect:y,dailyData:{water:_,mood:N,breathing:x,relapseDate:t}})]})},bq=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=L.useState(r),{modalRef:o,classes:a}=rx(e,{threshold:80,velocity:.4,enabled:!0});return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{ref:o,className:`modal-content bg-slate-800 border-slate-700 ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"water-modal-title",children:[d.jsx("div",{className:"modal-swipe-indicator"}),d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"text-center mb-6 p-4",children:[d.jsx("h3",{id:"water-modal-title",className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),d.jsx("div",{className:"mb-6 px-4",children:d.jsxs("div",{className:"form-group",children:[d.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:l=>i(parseInt(l.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0",autoComplete:"off","aria-label":"Number of glasses of water"}),d.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]})}),d.jsxs("div",{className:"modal-actions px-4 pb-4",children:[d.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"}),d.jsx("button",{onClick:()=>t(s),className:"modal-button modal-button-primary",children:"Confirm"})]})]})]})})}):null},Aq=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}],{modalRef:i,classes:o}=rx(e,{threshold:80,velocity:.4,enabled:!0});return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{ref:i,className:`modal-content bg-slate-800 border-slate-700 ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title",children:[d.jsx("div",{className:"modal-swipe-indicator"}),d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"text-center mb-6 p-4",children:[d.jsx("h3",{id:"mood-modal-title",className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),d.jsx("div",{className:"modal-grid modal-grid-2 gap-3 mb-6 px-4",children:s.map(a=>d.jsxs("button",{onClick:()=>t(a),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 min-h-[44px] ${(r==null?void 0:r.name)===a.name?"ring-2 ring-blue-400 bg-blue-600":"bg-slate-700 hover:bg-slate-600"}`,"aria-pressed":(r==null?void 0:r.name)===a.name,"aria-label":`Select ${a.name} mood`,children:[d.jsx("div",{className:`w-12 h-12 ${a.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:a.icon}),d.jsx("p",{className:"text-white font-semibold",children:a.name})]},a.name))}),d.jsx("div",{className:"modal-actions px-4 pb-4",children:d.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"})})]})]})})}):null},Cq=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=L.useState(""),[o,a]=L.useState(""),[l,u]=L.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),d.jsxs("select",{value:s,onChange:g=>i(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select a day"}),f.map(g=>d.jsx("option",{value:g,children:g},g))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),d.jsxs("select",{value:o,onChange:g=>a(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select trigger type"}),h.map(g=>d.jsx("option",{value:g,children:g},g))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),d.jsx("input",{type:"time",value:l,onChange:g=>u(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",autoComplete:"off"})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})})}):null},Rq=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),d.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),d.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&d.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[d.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),d.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors min-h-[44px]",children:"Close"})]})})}):null,kq=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,firestoreBuddyService:r,firestoreBuddyServiceRef:s,initializeFirestoreBuddyService:i,behavioralService:o,user:a,onShowAnalytics:l})=>d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:d.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx(BD,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),d.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"📊 Behavioral Analytics"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),d.jsx("button",{onClick:l,disabled:!o,className:`w-full py-3 rounded-lg transition-colors mb-3 ${o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:o?"📈 View Analytics Dashboard":"📈 Analytics (Service Loading...)"}),o&&d.jsx("button",{onClick:async()=>{try{await o.logCraving(a.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await o.logBreathingExercise(a.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert("✅ Test data added to Firestore for analytics demo!")}catch(u){alert("❌ Error adding test data: "+u.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition-colors text-sm min-h-[44px]",children:"🧪 Add Test Data"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:"← Back to Login"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),d.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),Nq=()=>{const[n,e]=L.useState("arena"),[t,r]=L.useState("auth"),[s,i]=L.useState(null),[o,a]=L.useState(null),[l,u]=L.useState(!1),[h,f]=L.useState(!1),[g,y]=L.useState(null),[_,C]=L.useState(!0),[N,T]=L.useState(!1),[x,k]=L.useState(!1),[P,$]=L.useState(0),[j,R]=L.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[S,I]=L.useState([]);L.useState(null);const[A,w]=L.useState(null),[b,v]=L.useState(null),[te,Ee]=L.useState(null),ue=L.useRef(null),[ye,K]=L.useState(null);L.useEffect(()=>{const M=B=>{window.deferredPrompt=B,T(!0),console.log("📲 PWA: beforeinstallprompt captured (App state set)")},W=()=>{T(!1),console.log("✅ PWA installed (App state cleared)")};return window.addEventListener("beforeinstallprompt",M),window.addEventListener("appinstalled",W),()=>{window.removeEventListener("beforeinstallprompt",M),window.removeEventListener("appinstalled",W)}},[]),L.useEffect(()=>{let M=0,W=0,B=!1;const me=80,Le=De=>{M=De.touches[0].clientY,B=!1},qe=De=>{if(window.scrollY>0)return;W=De.touches[0].clientY;const Oe=W-M;Oe>0&&(B=!0,De.preventDefault(),$(Math.min(Oe,me*1.5)))},Re=async()=>{if(!B)return;W-M>me?(k(!0),$(0),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Pull-to-refresh: Refreshing stats..."),await window.refreshArenaStats()),typeof refreshStats=="function"&&(console.log("🔄 Pull-to-refresh: Calling main refresh..."),refreshStats()),setTimeout(()=>{k(!1)},1e3)):$(0),B=!1};return document.addEventListener("touchstart",Le,{passive:!1}),document.addEventListener("touchmove",qe,{passive:!1}),document.addEventListener("touchend",Re,{passive:!1}),()=>{document.removeEventListener("touchstart",Le),document.removeEventListener("touchmove",qe),document.removeEventListener("touchend",Re)}},[]);const Se=async()=>{try{if(window.promptPWAInstall){const B=await window.promptPWAInstall();B&&B.outcome==="accepted"&&T(!1);return}const M=window.deferredPrompt;if(!M)return;M.prompt();const W=await M.userChoice;window.deferredPrompt=null,W.outcome==="accepted"&&T(!1)}catch(M){console.warn("PWA install prompt failed:",M==null?void 0:M.message)}},Te=async()=>{try{if(!ci){console.error("❌ Firestore instance is not available");return}const M=new tc(ci),W=new K9(ci),B=await M.testConnectivity(),me=await W.testConnectivity();B?(w(M),ue.current=M,console.log("✅ FirestoreBuddyService initialized successfully")):console.warn("⚠️ Firestore connectivity test failed - service not initialized"),me?(v(W),console.log("✅ FirestoreBehavioralService initialized successfully")):console.warn("⚠️ Firestore behavioral service connectivity test failed")}catch(M){console.error("❌ Error initializing FirestoreBuddyService:",M)}},je=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),be=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),D=M=>{M.relapseDate&&ge(new Date(M.relapseDate)),M.dailyWater!==void 0&&Ke(M.dailyWater),M.dailyMood!==void 0&&gt(M.dailyMood),M.dailyBreathing!==void 0&&Ct(M.dailyBreathing),M.scheduledTriggers&&wt(M.scheduledTriggers)},z=async()=>{const M=new Date().toDateString();try{const{ref:W,set:B}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),me=W(H,`users/${g==null?void 0:g.uid}/profile/daily/${M}/breathing`);await B(me,!0)}catch(W){console.error("Error saving breathing exercise to Firebase:",W),localStorage.setItem(`breathing_${g==null?void 0:g.uid}_${M}`,"true")}if(ye)try{await ye.handleBreathingExercise();const W=await ye.checkBreathingStreak(),B=Math.max(0,3-W%3),me=W>=3&&W%3===0?`🎉 Excellent! You've completed a ${W}-day breathing streak and earned +1 Mental Strength!`:`✅ Breathing exercise completed! Current streak: ${W} days. Complete ${B} more days to earn +1 Mental Strength.`;if(showQuickActionPopup("🫁 Breathing Exercise Complete",`${me}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),b)try{await b.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:W,mentalStrengthEarned:W>=3&&W%3===0}),console.log("✅ Breathing exercise also logged to Firestore for analytics")}catch(Le){console.warn("⚠️ Could not log breathing exercise to Firestore:",Le.message),await oe("breathing",{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:W,mentalStrengthEarned:W>=3&&W%3===0})}}catch(W){console.warn("⚠️ Error handling breathing exercise completion:",W.message),showQuickActionPopup("🫁 Breathing Exercise Complete","✅ Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},ce=(M,W)=>{const B=document.createElement("div");B.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",B.innerHTML=`
      <div class="font-bold">${M}</div>
      <div class="text-sm opacity-90">${W}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(B),setTimeout(()=>{B.parentNode&&B.parentNode.removeChild(B)},1e4)},_e=async M=>{if(!M)return!1;R({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:W,get:B,onValue:me}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);R(Ye=>({...Ye,currentStep:"Loading profile data...",progress:20}));const Le=W(H,`users/${M}`),qe=await B(Le);if(!qe.exists())throw new Error("User profile not found");const Re=qe.val(),De=Ne(Re);R(Ye=>({...Ye,currentStep:"Loading battle stats...",progress:40}));const Oe=W(H,`users/${M}/stats`),at=await B(Oe),He=at.exists()?pe(at.val()):je();R(Ye=>({...Ye,currentStep:"Loading habits and progress...",progress:60}));const ze=W(H,`users/${M}/profile`),Je=await B(ze),Ue=Je.exists()?Z(Je.val()):be();R(Ye=>({...Ye,currentStep:"Loading achievements...",progress:80}));const Ve=W(H,`users/${M}/profile/cravingsResisted`),ke=await B(Ve),We=ke.exists()?Math.max(0,parseInt(ke.val())||0):0;R(Ye=>({...Ye,currentStep:"Setting up live sync...",progress:90}));const wn=me(Oe,Ye=>{if(Ye.exists()){const pn=pe(Ye.val());if(console.log("🔄 Firebase Listener: Stats changed, new stats:",pn),Vt(pn),t==="arena"&&o){console.log("🔄 Firebase Listener: Current user object:",o),console.log("🔄 Firebase Listener: user.quitDate:",o.quitDate),console.log("🔄 Firebase Listener: user.uid:",o.uid);const Yr={...o,stats:pn};console.log("🔄 Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",Yr),console.log("🔄 Firebase Listener: updatedUser.quitDate:",Yr.quitDate),console.log("🔄 Firebase Listener: updatedUser.uid:",Yr.uid),calculateRealTimeStats(Yr).then(ri=>{console.log("🔄 Firebase Listener: calculateRealTimeStats returned:",ri),console.log("🔄 Firebase Listener: calculatedStats.streakDays:",ri.streakDays),setRealTimeUserStats(ri)})}}}),mt=me(ze,Ye=>{if(Ye.exists()){const pn=Z(Ye.val());t==="profile"&&D(pn)}}),xt=me(Ve,Ye=>{if(Ye.exists()){const pn=Math.max(0,parseInt(Ye.val())||0);t==="craving-support"&&ut(pn)}});return I([wn,mt,xt]),R(Ye=>({...Ye,currentStep:"Finalizing...",progress:100})),a(Ye=>({...Ye,...De,...Ue,stats:He})),D(Ue),ut(We),De.onboardingCompleted&&f(!0),R({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:De,stats:He,profileData:Ue,cravingsResisted:We}),!0}catch(W){return console.error("❌ Error loading user data:",W),R({isLoading:!1,progress:0,currentStep:"Failed to load data",error:W.message,isComplete:!1}),ce("Failed to load user data",W.message),!1}},Ne=M=>M?{uid:M.uid||"",email:M.email||"",heroName:M.heroName||"Hero",archetype:M.archetype||"The Determined",avatar:M.avatar||Ms("default"),quitDate:M.quitDate,onboardingCompleted:!!M.onboardingCompleted,updatedAt:M.updatedAt||Date.now(),...M}:we(),pe=M=>M?{mentalStrength:Math.max(0,Math.min(100,parseInt(M.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(M.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(M.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(M.addictionLevel)||50)),streakDays:Math.max(0,parseInt(M.streakDays)||0),streakUnit:M.streakUnit||"hours",streakDisplayText:M.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(M.cravingsResisted)||0),...M}:je(),Z=M=>M?{dailyWater:Math.max(0,parseInt(M.dailyWater)||0),dailyMood:M.dailyMood||null,dailyBreathing:!!M.dailyBreathing,scheduledTriggers:Array.isArray(M.scheduledTriggers)?M.scheduledTriggers:[],relapseDate:M.relapseDate?new Date(M.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(M.cravingsResisted)||0),...M}:be(),we=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:Ms("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});L.useEffect(()=>()=>{S.forEach(M=>{typeof M=="function"&&M()})},[S]);const[ie,ve]=L.useState(null);L.useEffect(()=>{(async()=>{try{const W=(await Me(()=>import("./offlineManager-39f7aa9a.js"),[])).default,B=new W;ve(B),window.refreshUserData=ee,console.log("✅ Offline manager initialized")}catch(W){console.error("Error initializing offline manager:",W)}})()},[]);const de=async M=>{if(!M)return!1;const W=await _e(M);if(W&&ie&&(await ie.cacheUserData(o),await ie.cacheProfileData({dailyWater:Ae,dailyMood:kt,dailyBreathing:Nt,scheduledTriggers:Pt,relapseDate:ae,cravingsResisted:Pe})),!W&&ie){console.log("📱 Loading offline data...");const B=await ie.getCachedUserData(),me=await ie.getCachedProfileData();if(B)return console.log("📱 Using offline user data"),a(B),f(B.onboardingCompleted),me&&D(me),!0}return W},G=async()=>g!=null&&g.uid?(console.log("🔄 Refreshing user data with offline support..."),await de(g.uid)):!1,oe=async(M,W)=>{if(!ie||!(g!=null&&g.uid))return!1;const B={...W,userId:g.uid,timestamp:Date.now()};return await ie.handleOfflineBehavioralLog(M,B)},ee=async()=>{if(!(g!=null&&g.uid)){ce("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await G()){const W=document.createElement("div");W.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",W.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(W),setTimeout(()=>{W.parentNode&&W.parentNode.removeChild(W)},5e3)}else ce("Refresh Failed","Could not refresh data. Please try again.")},[ae,ge]=L.useState(null),[Ae,Ke]=L.useState(0),[kt,gt]=L.useState(null),[Nt,Ct]=L.useState(!1),[Pt,wt]=L.useState([]),[Pe,ut]=L.useState(0),[Dt,Vt]=L.useState(je());L.useEffect(()=>{const M=B=>{if(B.message&&B.message.includes("content_script")){console.warn("Browser extension error (ignored):",B.message);return}if(B.message&&(B.message.includes("FrameDoesNotExistError")||B.message.includes("background.js"))){console.warn("Background frame error (ignored):",B.message);return}if(B.message&&B.message.includes("deref")){console.warn("Browser extension deref error (ignored):",B.message);return}if(B.message&&B.message.includes("chrome-extension://")){console.warn("Chrome extension URL error (ignored):",B.message);return}console.error("Global error caught:",B)},W=B=>{if(B.reason&&B.reason.message&&B.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",B.reason.message);return}if(B.reason&&B.reason.message&&(B.reason.message.includes("FrameDoesNotExistError")||B.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",B.reason.message);return}if(B.reason&&B.reason.message&&B.reason.message.includes("deref")){console.warn("Browser extension deref promise rejection (ignored):",B.reason.message);return}if(B.reason&&B.reason.message&&B.reason.message.includes("chrome-extension://")){console.warn("Chrome extension URL promise rejection (ignored):",B.reason.message);return}console.error("Unhandled promise rejection:",B.reason)};return window.addEventListener("error",M),window.addEventListener("unhandledrejection",W),()=>{window.removeEventListener("error",M),window.removeEventListener("unhandledrejection",W)}},[]),L.useEffect(()=>{(()=>{try{H&&typeof H.app<"u"&&console.log("🔥 Firebase RTDB initialized successfully")}catch(W){console.warn("⚠️ Firebase initialization check failed (non-critical):",(W==null?void 0:W.message)||W)}})()},[]),L.useEffect(()=>{let M=!0,W=null;return(async()=>{try{console.log("Initializing authentication state..."),C(!0);const me=async Re=>{const De=`quitDateFixed_${Re}_v2`;if(!localStorage.getItem(De)&&!(Re!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&Re!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:Oe,get:at,set:He}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),ze="2025-09-18T13:56:46.584Z";console.log(`🔧 One-time fix: Setting proper quit date for ${Re}...`);const Je=Oe(H,`users/${Re}/profile`),Ue=await at(Je);let Ve=ze;if(Ue.exists()){const ke=Ue.val();if(ke.lastRelapseDate){const We=new Date(ke.lastRelapseDate),wn=new Date(ze);Ve=We>wn?ke.lastRelapseDate:ze,console.log(`📅 ${Re}: Using quit date ${Ve} (considering relapse: ${ke.lastRelapseDate})`)}}await He(Oe(H,`users/${Re}/quitDate`),Ve),await He(Oe(H,`users/${Re}/profile/quitDate`),Ve),localStorage.setItem(De,"true"),console.log(`✅ One-time fix: Quit date fixed for ${Re} in Firebase database`)}catch(Oe){console.warn(`⚠️ One-time fix failed for ${Re}:`,Oe.message)}},{onAuthStateChanged:Le}=await Me(()=>import("./index.esm-d1370983.js"),[]);W=Le(lo,async Re=>{if(M)if(console.log("Auth state changed:",Re?`User: ${Re.uid}`:"No user"),Re){y(Re),console.log("User authenticated, checking database for user data..."),(Re.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||Re.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(`🧹 Clearing cache for ${Re.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(De=>{(De.includes("quitCoach")||De.includes("quitDate")||De.includes("user")||De.includes("arena"))&&localStorage.removeItem(De)})),me(Re.uid);try{const{ref:De,get:Oe}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),at=De(H,`users/${Re.uid}`),He=await Oe(at);if(He.exists()){const ze=He.val();console.log("Existing user data found - auto-login successful"),(()=>{const Ue=[];for(let Ve=0;Ve<localStorage.length;Ve++){const ke=localStorage.key(Ve);ke&&(ke.startsWith("water_")||ke.startsWith("mood_")||ke.startsWith("breathing_"))&&Ue.push(ke)}Ue.forEach(Ve=>localStorage.removeItem(Ve)),console.log("Cleared previous user data from localStorage")})(),a(ze),f(!0),r("arena");try{const Ue=await Me(()=>Promise.resolve().then(()=>Q9),void 0),Ve=new Ue.default(H,Re.uid);await Ve.initialize(),K(Ve),console.log("✅ StatManager initialized successfully")}catch(Ue){console.error("Error initializing StatManager:",Ue)}try{const Ue=new Pb(H,Re.uid);Ee(Ue),window.centralizedStatService=Ue,await Ue.refreshAllStats(),console.log("✅ CentralizedStatService initialized and stats refreshed for user:",Re.uid),Ue.setupRealTimeListener(Ve=>{console.log("🔄 Real-time stats update received:",Ve),Vt(Ve)})}catch(Ue){console.error("Error initializing CentralizedStatService:",Ue)}try{console.log("🔍 Checking if existing user needs buddy matching...");const Ue=ue.current||A;if(Ue)if(await Ue.getUserBuddyPair(Re.uid))console.log("✅ Existing user already has a buddy pair");else{console.log("🔄 Existing user has no buddy - adding to matching pool...");const ke={userId:Re.uid,heroName:ze.heroName,archetype:ze.archetype,joinedAt:new Date().toISOString(),stats:ze.stats};await Ue.addToMatchingPool(ke),console.log("✅ Added existing user to matching pool"),setTimeout(async()=>{try{console.log("⏳ Triggering auto-matching for existing user..."),await ks()}catch(We){console.error("Auto-matching failed for existing user:",We)}},2e3)}else console.log("⚠️ FirestoreBuddyService not available for existing user buddy check")}catch(Ue){console.error("Error checking existing user buddy status:",Ue)}console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(De){console.error("Error fetching user data during auto-login:",De),r("onboarding")}}else console.log("No authenticated user - showing login screen"),y(null),a(null),f(!1),r("auth"),(()=>{const Oe=[];for(let at=0;at<localStorage.length;at++){const He=localStorage.key(at);He&&(He.startsWith("water_")||He.startsWith("mood_")||He.startsWith("breathing_"))&&Oe.push(He)}Oe.forEach(at=>localStorage.removeItem(at)),console.log("Cleared user-specific data from localStorage")})()});const qe=setTimeout(()=>{M&&(console.warn("Auth initialization timeout - forcing to auth screen"),C(!1),r("auth"))},1e4);W&&clearTimeout(qe)}catch(me){console.error("Error initializing authentication:",me),M&&(C(!1),r("auth"))}finally{M&&C(!1)}})(),Te(),()=>{M=!1,W&&W()}},[]);const Yt=async M=>{console.log("Authentication successful, checking for existing user data...",{uid:M==null?void 0:M.uid,email:M==null?void 0:M.email});try{const{ref:W,get:B}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);console.log("Checking database for existing user data...");const me=W(H,`users/${M.uid}`),Le=await B(me);if(Le.exists()){const qe=Le.val();if(console.log("Existing user data found - loading all user data..."),await de(M.uid)){console.log("✅ All user data loaded successfully, going to Arena");try{const De=new Pb(H,M.uid);Ee(De),window.centralizedStatService=De,await De.refreshAllStats(),console.log("✅ CentralizedStatService initialized for existing user:",M.uid),De.setupRealTimeListener(Oe=>{console.log("🔄 Real-time stats update received:",Oe),Vt(Oe)})}catch(De){console.error("Error initializing CentralizedStatService for existing user:",De)}r("arena")}else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(qe);const De=!!qe.onboardingCompleted;f(De),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(W){console.error("Database check failed:",W),r("onboarding")}},[Et,Ft]=L.useState(null),[vn,pt]=L.useState(!1),[It,kr]=L.useState(null),[mr,lt]=L.useState(!1),dt=async(M,W,B)=>{var me,Le,qe;if(!(!(o!=null&&o.uid)||vn)){pt(!0),kr(null),lt(!0);try{console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!A),console.log("🔄 FirestoreBuddyService type:",typeof A);const Re=ue.current||A;if(!Re){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Un();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:De,query:Oe,where:at,getDocs:He}=await Me(()=>import("./index.esm-990ad7a3.js"),[]),ze=De(ci,"buddyPairs"),Je=Oe(ze,at("user1Id","==",o.uid)),Ue=await He(Je);let Ve=null,ke=null;if(Ue.empty){const We=Oe(ze,at("user2Id","==",o.uid)),wn=await He(We);if(!wn.empty){const mt=wn.docs[0];Ve={id:mt.id,...mt.data()},ke=Ve.user1Id}}else{const We=Ue.docs[0];Ve={id:We.id,...We.data()},ke=Ve.user2Id}if(Ve&&ke){console.log("✅ Firestore: Found buddy pair:",Ve.id),console.log("🔍 Buddy pair data:",{user1Id:Ve.user1Id,user2Id:Ve.user2Id,user1Name:Ve.user1Name,user2Name:Ve.user2Name,currentUserId:o.uid,buddyUserId:ke});let We="Your Buddy";if(Ve.user1Id===o.uid?We=Ve.user2Name||"Your Buddy":We=Ve.user1Name||"Your Buddy",We==="Your Buddy")try{const ht=(await Re.getAllMatchingPoolUsers()).find(sn=>sn.userId===ke);ht&&ht.heroName&&(We=ht.heroName,console.log("🔍 Found buddy name from matching pool:",We))}catch(Qe){console.log("⚠️ Could not get buddy name from matching pool:",Qe.message)}if(We==="Your Buddy"&&(We=`Buddy ${ke.slice(-4)}`),console.log("🔍 Selected buddy name:",We),We!=="Your Buddy"&&We.startsWith("Buddy ")===!1)try{console.log("🔄 Updating buddy pair with correct names...");const{doc:Qe,updateDoc:ht}=await Me(()=>import("./index.esm-990ad7a3.js"),[]),sn=Qe(ci,"buddyPairs",Ve.id),Jt={};Ve.user1Id===o.uid?(Jt.user1Name=o.heroName,Jt.user2Name=We):(Jt.user1Name=We,Jt.user2Name=o.heroName),await ht(sn,Jt),console.log("✅ Updated buddy pair with names:",Jt)}catch(Qe){console.log("⚠️ Could not update buddy pair names:",Qe.message)}let wn={streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0};try{console.log("🔄 Attempting to get real buddy stats from Firebase...");const{ref:Qe,get:ht}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),sn=Qe(H,`users/${ke}/stats`),Jt=await ht(sn);if(Jt.exists()){const Nr=Jt.val();wn={...wn,...Nr},console.log("✅ Got real buddy stats from Firebase:",Nr)}else console.log("⚠️ Buddy stats not found in Firebase, using defaults")}catch(Qe){console.log("⚠️ Could not read buddy stats (permission), using defaults:",Qe.message)}let mt=null,xt=null,Ye=null,pn=Ms("buddy","adventurer"),Yr="DETERMINED";try{console.log("🔄 Loading Firebase imports for buddy profile...");const{ref:Qe,get:ht}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);console.log("✅ Firebase imports loaded successfully"),console.log("🔍 Reading buddy profile fields from path:",`users/${ke}`),console.log("🔄 Firestore: Attempting to read buddy quit date from multiple locations...");const[sn,Jt,Nr,Jo,Fi,si,zn]=await Promise.all([ht(Qe(H,`users/${ke}/avatar`)),ht(Qe(H,`users/${ke}/avatarSeed`)),ht(Qe(H,`users/${ke}/archetype`)),ht(Qe(H,`users/${ke}/heroName`)),ht(Qe(H,`users/${ke}/quitDate`)),ht(Qe(H,`users/${ke}/profile/quitDate`)),ht(Qe(H,`users/${ke}/profile`))]);if(console.log("🔍 Firestore: Quit date snapshots - root exists:",Fi.exists(),"profile exists:",si.exists()),sn.exists())pn=sn.val(),console.log("✅ Got buddy avatar from Firebase");else if(Jt.exists()){const zt=Jt.val(),cr=Nr.exists()?Nr.val():"adventurer";pn=Ms(zt,cr),console.log("✅ Generated buddy avatar from seed:",zt)}if(Nr.exists()&&(Yr=Nr.val(),console.log("✅ Got buddy archetype:",Yr)),Jo.exists()){const zt=Jo.val();console.log("✅ Got buddy hero name:",zt),We=zt}if(Fi.exists())mt=Fi.val(),console.log("✅ Got buddy quit date from Firebase (root):",mt);else if(si.exists())mt=si.val(),console.log("✅ Got buddy quit date from Firebase (profile):",mt);else{if(console.log("⚠️ No buddy quit date found in Firebase (neither root nor profile)"),console.log("🔍 quitDateSnapshot exists:",Fi.exists()),console.log("🔍 profileQuitDateSnapshot exists:",si.exists()),zn.exists()){const zt=zn.val();console.log("🔍 Full profile data available:",zt),zt&&zt.quitDate?(mt=zt.quitDate,console.log("✅ Found buddy quit date in profile data:",mt)):console.log("⚠️ Profile exists but has no quit date field"),zt&&zt.lastActivity&&(Ye=zt.lastActivity,console.log("🔍 Captured buddy lastActivity for fallback:",Ye))}else console.log("⚠️ No profile data available at all");if(zn.exists()){const zt=zn.val();xt=zt.lastRelapseDate||zt.relapseDate,console.log("🔍 Found buddy relapse date:",xt)}if(!mt){if(console.log("⚠️ No quit date found, checking for createdAt timestamp..."),console.log("🔍 Buddy user ID:",ke),zn.exists()){const zt=zn.val();zt.createdAt?(mt=zt.createdAt,console.log("✅ Using buddy createdAt as quit date:",mt)):(console.log("⚠️ No createdAt timestamp found either - not assigning fallback quit date"),mt=void 0)}else console.log("⚠️ No profile data available - not assigning fallback quit date"),mt=void 0;ke==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"?console.log("🔄 Arena: User 2 uses centralized stats - no hardcoded quit date needed"):ke==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&console.log("🔄 Arena: User 3 uses centralized stats - no hardcoded quit date needed")}}}catch(Qe){console.log("⚠️ Could not read buddy profile (permission):",Qe.message),console.log("🔍 Full profile error details:",Qe),console.log("🔍 Trying to access path:",`users/${ke}`),console.log("🔍 Current user can read own profile, but not buddy profile")}const ri=mt||Ye||null;let ul=ri;(ke==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||ke==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")&&(console.log(`🔄 Arena: Not setting quit date for centralized buddy ${ke} - using null to prevent calculations`),ul=null);const Bn={heroName:We,uid:ke,stats:wn,quitDate:ul,originalQuitDate:ul,finalQuitDate:ri,lastActivity:Ye||null,lastRelapseDate:xt,achievements:[],archetype:Yr,avatar:pn,userId:ke,isRealBuddy:!0,pairId:Ve.id,triggers:[],dailyPatterns:[],copingStrategies:[],specialFeatures:null};console.log("🔍 Firestore: Final buddy object with quit date:",{heroName:We,originalQuitDate:mt,finalQuitDate:ri,lastRelapseDate:xt,hasOriginalQuitDate:!!mt,usingDefaultQuitDate:!mt,hasRelapseDate:!!xt}),Ft(Bn),console.log("✅ Firestore: Buddy data loaded successfully"),console.log("🔍 Firestore: Buddy Special Features data:",{hasSpecialFeatures:!!Bn.specialFeatures,hasTriggers:!!((me=Bn.triggers)!=null&&me.length),hasDailyPatterns:!!((Le=Bn.dailyPatterns)!=null&&Le.length),hasCopingStrategies:!!((qe=Bn.copingStrategies)!=null&&qe.length),uid:Bn.uid});try{let Qe=Bn.lastRelapseDate||null;if(!Qe){const ht=Bn.finalQuitDate;if(ht){const sn=new Date(ht).getTime(),Jt=Date.now();Math.abs(Jt-sn)<2*60*1e3||(Qe=ht)}}if(!Qe&&Bn.lastActivity&&(Qe=Bn.lastActivity),Qe){const ht=Ds(new Date(Qe)),sn={streakDays:ht.value,streakUnit:ht.unit,streakDisplayText:ht.displayText};typeof setBuddyStreakData=="function"&&setBuddyStreakData(sn),typeof setRealTimeNemesisStats=="function"&&setRealTimeNemesisStats(Jt=>({...Jt,streakDays:sn.streakDays,streakUnit:sn.streakUnit,streakDisplayText:sn.streakDisplayText})),console.log("🔄 Arena: Primed buddy streak from loaded data:",sn.streakDisplayText)}}catch(Qe){console.log("⚠️ Arena: Could not prime buddy streak:",Qe==null?void 0:Qe.message)}console.log(`🔄 Firestore: Reading centralized buddy stats for ${ke} (read-only)`);try{try{const{ref:Qe,get:ht}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),sn=await ht(Qe(H,`users/${ke}/stats`));if(sn.exists()){const Jt=sn.val(),Nr=new Date,Jo=Bn.lastRelapseDate;if(Jo){const Fi=new Date(Jo),si=Nr-Fi,zn=Math.floor(si/(1e3*60*60)),zt=Math.floor(zn/24);let cr,yr;zn<24?(cr=`${zn} hour${zn===1?"":"s"}`,yr=0):(cr=`${zt} day${zt===1?"":"s"}`,yr=zt),console.log(`🔄 Firestore: Calculated buddy streak locally: ${cr} (${zn} hours since relapse)`);const dl={streakDays:yr,streakUnit:zn<24?"hours":"days",streakDisplayText:cr};B(dl);const Ns={...Jt,streakDays:yr,streakUnit:zn<24?"hours":"days",streakDisplayText:cr};console.log("🔄 Firestore: Using buddy stats with locally calculated streak:",Ns),console.log("🔄 Firestore: Buddy streak fields:",{streakDays:Ns.streakDays,streakUnit:Ns.streakUnit,streakDisplayText:Ns.streakDisplayText}),W(Ns)}else console.log("🔄 Firestore: No relapse date found for buddy, using existing stats"),W(Jt)}else{console.log("⚠️ Firestore: No centralized stats found for buddy, using fallback calculation");const Jt=await M(Bn);W(Jt)}}catch(Qe){console.error("❌ Error reading buddy stats:",Qe);const ht=await M(Bn);W(ht)}}catch(Qe){console.error("❌ Error reading centralized buddy stats:",Qe);const ht=await M(Bn);W(ht)}await Jn(o.uid,ke)}else console.log("ℹ️ Firestore: No buddy pair found for user"),Ft(null)}catch(Re){console.error("❌ Firestore: Error loading buddy:",Re),console.log("🔄 Falling back to Realtime Database buddy loading..."),await Un()}finally{pt(!1)}}},Un=async()=>{var M,W,B,me,Le,qe,Re,De,Oe,at;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:He,get:ze}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),Je=He(H,"buddyPairs"),Ue=await ze(Je);if(!Ue.exists()){Ft(null);return}const Ve=Ue.val();let ke=null,We=null;for(const[wn,mt]of Object.entries(Ve))if(mt.users&&Array.isArray(mt.users)&&mt.users.includes(o.uid)){ke={...mt,pairId:wn},We=mt.users.find(xt=>xt!==o.uid);break}if(ke&&We){const wn=He(H,`users/${We}`),mt=await ze(wn);if(!mt.exists()){const{remove:pn}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);await pn(He(H,`buddyPairs/${ke.pairId}`)),Ft(null);return}const xt=mt.val(),Ye={heroName:xt.heroName||"Buddy",stats:{streakDays:((M=xt.stats)==null?void 0:M.streakDays)||0,addictionLevel:((W=xt.stats)==null?void 0:W.addictionLevel)||50,willpower:((B=xt.stats)==null?void 0:B.mentalStrength)||50,motivation:((me=xt.stats)==null?void 0:me.mentalStrength)||50,cravingResistance:((Le=xt.stats)==null?void 0:Le.mentalStrength)||50,triggerDefense:((qe=xt.stats)==null?void 0:qe.triggerDefense)||30,experiencePoints:((Re=xt.stats)==null?void 0:Re.experiencePoints)||0},achievements:xt.achievements||[],archetype:xt.archetype||"The Determined",avatar:xt.avatar||Ms(xt.heroName||"buddy","adventurer"),uid:We,userId:We,lastRelapseDate:xt.lastRelapseDate,isRealBuddy:!0,pairId:ke.pairId,triggers:xt.triggers||[],dailyPatterns:xt.dailyPatterns||[],copingStrategies:xt.copingStrategies||[],specialFeatures:xt.specialFeatures||null};Ft(Ye),console.log("🔍 RealtimeDB: Buddy Special Features data:",{hasSpecialFeatures:!!Ye.specialFeatures,hasTriggers:!!((De=Ye.triggers)!=null&&De.length),hasDailyPatterns:!!((Oe=Ye.dailyPatterns)!=null&&Oe.length),hasCopingStrategies:!!((at=Ye.copingStrategies)!=null&&at.length),uid:Ye.uid}),await Jn(o.uid,We)}else Ft(null)}catch(He){console.error("Error loading buddy from Realtime Database:",He),kr("Failed to load buddy data"),Ft(null)}},Jn=async(M,W)=>{try{const B=ue.current||A;if(B&&(Et!=null&&Et.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await B.removeFromMatchingPool(M),await B.removeFromMatchingPool(W);const{doc:me,updateDoc:Le}=await Me(()=>import("./index.esm-990ad7a3.js"),[]),qe=me(ci,"buddyPairs",Et.pairId);await Le(qe,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:me,remove:Le,set:qe}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);await Le(me(H,`matchingPool/${M}`)),await Le(me(H,`matchingPool/${W}`)),Et!=null&&Et.pairId&&(await qe(me(H,`buddyPairs/${Et.pairId}/user1RemovedFromPool`),!0),await qe(me(H,`buddyPairs/${Et.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(B){console.error("❌ Error removing users from matching pool:",B)}};L.useEffect(()=>{lt(!1),Ft(null)},[o==null?void 0:o.uid]),L.useEffect(()=>{o!=null&&o.uid&&!Et&&!vn&&!mr&&console.log("🔄 Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,Et,vn,mr]),L.useEffect(()=>{A&&console.log("✅ FirestoreBuddyService is now available")},[A]);const ks=async()=>{try{const M=ue.current||A;if(!M){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await cs();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting NEW CHAIN PAIRING algorithm...");const W=await M.getAllMatchingPoolUsers();if(console.log("🔍 Firestore: Current matching pool state:",{totalUsers:W.length,userIds:W.map(me=>({id:me.userId,name:me.heroName,joinedAt:me.joinedAt}))}),W.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing (need 2, have",W.length,")");return}console.log(`🔄 Firestore: Found ${W.length} users in matching pool`);const B=W;if(console.log("ℹ️ Firestore: Skipping user validation to avoid permission errors"),B.sort((me,Le)=>{const qe=me.joinedAt?new Date(me.joinedAt).getTime():0,Re=Le.joinedAt?new Date(Le.joinedAt).getTime():0;return qe-Re}),console.log("🔄 Firestore: Sorted users by join time (oldest first):",B.map(me=>({userId:me.userId,joinedAt:me.joinedAt}))),B.length>=2){const me=B[B.length-1],Le=B[B.length-2];if(me.userId!==Le.userId)try{console.log(`🔄 Firestore: SEQUENTIAL PAIRING: ${me.userId} (${me.heroName}) pairs with ${Le.userId} (${Le.heroName})`);const qe={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1,user1Name:me.heroName||"User 1",user2Name:Le.heroName||"User 2"};console.log("🔄 Firestore: About to call createBuddyPair with data:",{arrivingUserId:me.userId,targetUserId:Le.userId,pairData:qe});const Re=await M.createBuddyPair(me.userId,Le.userId,qe);if(console.log("🔄 Firestore: createBuddyPair returned:",Re),Re){const{ref:De,set:Oe}=await Me(()=>import("./index.esm-88dfaf84.js"),[]);if(await Oe(De(H,`users/${Le.userId}/buddyInfo`),{hasBuddy:!0,buddyId:me.userId,pairId:Re,matchedAt:qe.matchedAt}),await Oe(De(H,`users/${me.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Le.userId,pairId:Re,matchedAt:qe.matchedAt}),await M.removeFromMatchingPool(Le.userId),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Created buddy pair ${Re}`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Removed ${Le.userId} (${Le.heroName}) from matching pool`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Kept ${me.userId} (${me.heroName}) in matching pool for next pairing`),o!=null&&o.uid&&[me.userId,Le.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(He){console.error("Error reloading buddy data:",He)}}else console.error(`❌ Firestore: Failed to create buddy pair between ${me.userId} and ${Le.userId}`)}catch(qe){console.error(`❌ Firestore: Failed to create buddy pair between ${me.userId} and ${Le.userId}:`,qe)}else console.log("ℹ️ Firestore: Same user in pool, cannot pair")}else console.log("ℹ️ Firestore: Not enough users in pool for pairing (need 2, have",B.length,")")}catch(M){console.error("❌ Firestore: Auto-matching failed:",M),console.log("🔄 Falling back to Realtime Database auto-matching..."),await cs()}},cs=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:M,get:W,set:B,push:me,remove:Le}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),qe=M(H,"matchingPool"),Re=await W(qe);if(!Re.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const De=Re.val(),Oe=[];if(Object.entries(De).forEach(([ze,Je])=>{typeof Je=="string"?Oe.push(Je):Je&&typeof Je=="object"?Je.uid?Oe.push(Je.uid):Je.userId?Oe.push(Je.userId):Oe.push(ze):Oe.push(ze)}),console.log(`🔄 Realtime Database: Found ${Oe.length} users in matching pool`),Oe.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",Oe.length,")");return}const at=Oe;console.log("ℹ️ Realtime Database: Skipping user validation to avoid permission errors"),console.log(`🔄 Realtime Database: Valid users for pairing: ${at.join(", ")}`);const He=at.map((ze,Je)=>({userId:ze,joinedAt:new Date(Date.now()-(at.length-Je)*1e3).toISOString()}));if(He.sort((ze,Je)=>{const Ue=ze.joinedAt?new Date(ze.joinedAt).getTime():0,Ve=Je.joinedAt?new Date(Je.joinedAt).getTime():0;return Ue-Ve}),console.log("🔄 Realtime Database: Sorted users by join time (oldest first):",He.map(ze=>({userId:ze.userId,joinedAt:ze.joinedAt}))),He.length>=2){const ze=He[0],Je=He[He.length-1];if(ze&&Je&&ze.userId!==Je.userId){console.log(`🔄 Realtime Database: CHAIN PAIRING: ${Je.userId} (arriving) pairs with ${ze.userId} (waiting)`);try{const Ue=me(M(H,"buddyPairs")).key,Ve={pairId:Ue,users:[Je.userId,ze.userId],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await B(M(H,`buddyPairs/${Ue}`),Ve),await B(M(H,`users/${ze.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Je.userId,pairId:Ue,matchedAt:Ve.matchedAt}),await B(M(H,`users/${Je.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ze.userId,pairId:Ue,matchedAt:Ve.matchedAt}),Object.keys(De).forEach(async ke=>{const We=De[ke];((We==null?void 0:We.uid)||(We==null?void 0:We.userId)||ke)===ze.userId&&(await Le(M(H,`matchingPool/${ke}`)),console.log(`✅ Realtime Database: Removed ${ze.userId} (waiting) from matching pool`))}),await B(M(H,`buddyPairs/${Ue}/user1RemovedFromPool`),!0),await B(M(H,`buddyPairs/${Ue}/user2RemovedFromPool`),!1),console.log(`✅ Realtime Database: CHAIN PAIRING: Created buddy pair ${Ue}`),console.log(`✅ Realtime Database: CHAIN PAIRING: Kept ${Je.userId} (arriving) in matching pool for next pairing`)}catch(Ue){console.error("Error creating buddy pair:",Ue)}}else console.log("ℹ️ Realtime Database: Same user in pool, cannot pair")}else console.log("ℹ️ Realtime Database: Not enough users in pool for pairing (need 2, have",He.length,")");if(o!=null&&o.uid&&He.length>=2){const ze=He[0],Je=He[He.length-1];if([Je==null?void 0:Je.userId,ze==null?void 0:ze.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Ve){console.error("Error reloading buddy data:",Ve)}}}catch(M){console.error("Error in Realtime Database auto-matching:",M)}},us={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},ti=()=>vn?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Ms("loading","adventurer"),isLoading:!0}:It?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Ms("error","adventurer"),isError:!0,errorMessage:It}:Et||us,ll=async M=>{console.log("Onboarding completed with user data:",M);try{if(!M||!M.heroName||!M.stats)throw new Error("Invalid user data received from onboarding");if(!g)throw new Error("No authenticated user found");const W=new Date,B={...M,uid:g.uid,email:g.email,displayName:g.displayName||M.heroName,photoURL:g.photoURL,onboardingCompleted:!0,createdAt:W.toISOString(),updatedAt:W.getTime(),originalQuitDate:W.toISOString(),lastQuitDate:W.toISOString(),lastRelapseDate:W.toISOString(),lastActivity:W.toISOString(),daily:{[W.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",B);const{ref:me,set:Le}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),qe=me(H,`users/${g.uid}`);await Le(qe,B),console.log("Firebase save successful, updating app state..."),a(B),f(!0);try{const De=ue.current||A;if(De){console.log("✅ Using Firestore for matching pool");const Oe={quitStartDate:B.quitDate||new Date().toISOString(),addictionLevel:B.stats.addictionLevel||50,triggers:B.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:B.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:g.uid,heroName:B.heroName,archetype:B.archetype,joinedAt:new Date().toISOString()};if(await De.addToMatchingPool(g.uid,Oe))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Oe,set:at}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),He={quitStartDate:B.quitDate||new Date().toISOString(),addictionLevel:B.stats.addictionLevel||50,triggers:B.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:B.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:g.uid,heroName:B.heroName,archetype:B.archetype,joinedAt:new Date().toISOString()};await at(Oe(H,`matchingPool/${g.uid}`),He),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{console.log("⏳ Waiting 1 second before attempting auto-matching..."),await new Promise(Oe=>setTimeout(Oe,1e3)),await ks()}catch(Oe){console.error("Automatic matching failed:",Oe)}}catch(De){console.error("⚠️ Failed to add user to buddy matching pool:",De)}const Re=await de(g.uid);r("arena")}catch(W){console.error("Error in handleOnboardingComplete:",W);const B=new Date,me={heroName:(M==null?void 0:M.heroName)||"Hero",archetype:(M==null?void 0:M.archetype)||"The Determined",avatar:(M==null?void 0:M.avatar)||Ms("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:B,createdAt:B.toISOString(),lastActivity:B.toISOString(),lastRelapseDate:B.toISOString(),uid:g==null?void 0:g.uid,email:g==null?void 0:g.email,onboardingCompleted:!0};if(g)try{const{ref:Le,set:qe}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),Re=Le(H,`users/${g.uid}`);await qe(Re,me)}catch(Le){console.error("Failed to save fallback data to Firebase:",Le)}a(me),f(!0),r("arena")}},Bh=()=>{a(null),f(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},ni=async()=>{try{console.log("Logging out user...");const{signOut:M}=await Me(()=>import("./index.esm-d1370983.js"),[]);await M(lo),a(null),y(null),f(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(M){console.error("Error during logout:",M),a(null),y(null),f(!1),r("auth")}},cl=async()=>{if(!g){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:M,set:W,remove:B}=await Me(()=>import("./index.esm-88dfaf84.js"),[]),me=M(H,`users/${g.uid}`);await W(me,null);const Le=M(H,"users");await W(Le,null);const qe=M(H,"buddyPairs");await W(qe,null);const Re=M(H,"matchingPool");await W(Re,null),console.log("All user data and buddy matching data cleared from database"),a(null),f(!1),r("onboarding"),Ft(null),pt(!1),kr(null),console.log("Account reset successful - ready for fresh onboarding")}catch(M){console.error("Error resetting account for testing:",M)}},$n=M=>{console.log("Tab changed to:",M),e(M),r(M),M==="arena"&&(o!=null&&o.uid)&&(console.log("🔄 Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log("🔄 Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},zh=M=>{r(M==="mood-selector"?"mood-selector":"profile")},Ko=M=>{i(M),r("profile")},Yo=()=>{r("profile")};return _?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?d.jsx(Y9,{onAuthSuccess:Yt}):j.isLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:j.currentStep}),d.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[d.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${j.progress}%`}})}),d.jsxs("div",{className:"text-sm text-gray-400",children:[j.progress,"% Complete"]})]}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),j.error&&d.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[d.jsxs("p",{className:"text-red-300 text-sm",children:[d.jsx("span",{className:"font-semibold",children:"Error:"})," ",j.error]}),d.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative",children:[P>0&&d.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white text-center py-2 transition-transform duration-200",style:{transform:`translateY(${Math.max(0,P-60)}px)`},children:P>80?"Release to refresh":"Pull to refresh"}),x&&d.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-green-600 text-white text-center py-2",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),d.jsx("span",{children:"Refreshing..."})]})}),d.jsx(J9,{offlineManager:ie}),t==="onboarding"&&d.jsx("div",{children:d.jsx(gq,{onComplete:ll,authUser:g,pwaInstallAvailable:N,promptInstall:Se})}),h&&o?d.jsxs(d.Fragment,{children:[t==="arena"&&d.jsx("div",{children:(()=>{try{const M=ti();return d.jsx(vq,{user:o,userStats:Dt,nemesis:M,onBackToLogin:ni,onResetForTesting:cl,buddyLoading:vn,buddyError:It,realBuddy:Et,loadRealBuddy:dt,buddyLoadAttempted:mr})}catch(M){return console.error("Error rendering ArenaView:",M),d.jsxs("div",{className:"text-white text-center p-8",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),d.jsx("p",{className:"text-gray-300 mb-4",children:M.message}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-3 rounded hover:bg-blue-700 min-h-[44px]",children:"Reload App"})]})}})()}),t==="craving-support"&&d.jsx("div",{children:d.jsx(xq,{user:o,nemesis:ti(),onBackToLogin:ni,onResetForTesting:cl,behavioralService:b,onBreathingComplete:async M=>{await z()},setActiveTab:e})}),t==="profile"&&d.jsx("div",{children:d.jsx(Tq,{user:o,onNavigate:zh})}),t==="mood-selector"&&d.jsx(MoodSelector,{onMoodSelect:Ko,onBack:Yo}),t==="settings"&&d.jsx(kq,{onResetApp:Bh,onBackToLogin:ni,onResetForTesting:cl,firestoreBuddyService:A,firestoreBuddyServiceRef:ue,initializeFirestoreBuddyService:Te,behavioralService:b,user:o,onShowAnalytics:()=>u(!0)}),l&&d.jsx(fq,{user:o,behavioralService:b,onClose:()=>u(!1)}),d.jsx(_q,{activeTab:n,onTabChange:$n,dataLoadingState:j,onRefreshData:ee,offlineManager:ie})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),d.jsx("p",{className:"text-gray-300",children:h?"User data missing":"Onboarding not completed"}),d.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),d.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),d.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:h,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 min-h-[44px]",children:"Debug State"})]})})]})};Jy.createRoot(document.getElementById("root")).render(d.jsx(Nq,{}));export{Fq as $,Uq as A,$q as B,Bq as C,Da as D,Lq as E,PR as F,Zq as G,e8 as H,t8 as I,n8 as J,g4 as K,s8 as L,he as M,Dq as N,f4 as O,Mq as P,Rs as Q,Cs as R,h8 as S,L4 as T,u8 as U,Xe as V,Oq as W,Vq as X,Yq as Y,Kq as Z,p8 as _,R4 as a,D8 as a$,IP as a0,Yd as a1,rU as a2,Vr as a3,E8 as a4,Ks as a5,Rt as a6,Ur as a7,nl as a8,rl as a9,nn as aA,xW as aB,st as aC,_8 as aD,IW as aE,wW as aF,I8 as aG,as as aH,W4 as aI,oi as aJ,q8 as aK,W8 as aL,M8 as aM,dW as aN,uW as aO,z8 as aP,C8 as aQ,Jr as aR,x8 as aS,Z6 as aT,uU as aU,vW as aV,gU as aW,cW as aX,N8 as aY,_W as aZ,ng as a_,Ot as aa,q as ab,Ys as ac,eU as ad,AU as ae,jn as af,Xc as ag,Dh as ah,rg as ai,Rm as aj,Lh as ak,Am as al,RI as am,$r as an,Cm as ao,oo as ap,_t as aq,bU as ar,Ss as as,EU as at,Aw as au,fn as av,La as aw,ne as ax,v8 as ay,M4 as az,Kr as b,Zi as b$,G8 as b0,b8 as b1,A8 as b2,k8 as b3,yW as b4,$8 as b5,U8 as b6,un as b7,Mh as b8,pU as b9,jl as bA,aP as bB,H8 as bC,S8 as bD,lW as bE,gs as bF,fU as bG,pW as bH,y8 as bI,Q8 as bJ,j8 as bK,F8 as bL,B8 as bM,P8 as bN,Z8 as bO,fW as bP,R8 as bQ,Ul as bR,gW as bS,AW as bT,jh as bU,Fh as bV,RW as bW,th as bX,ol as bY,Xi as bZ,SW as b_,nW as ba,hU as bb,K8 as bc,Y8 as bd,ad as be,J8 as bf,X8 as bg,tU as bh,mW as bi,hW as bj,T8 as bk,O8 as bl,V8 as bm,YT as bn,rW as bo,iW as bp,sW as bq,nU as br,ZT as bs,eW as bt,tW as bu,L8 as bv,cU as bw,oW as bx,aW as by,xU as bz,tw as c,PB as c$,ui as c0,Ri as c1,og as c2,bW as c3,Sa as c4,ec as c5,yz as c6,EW as c7,s7 as c8,$v as c9,HW as cA,jW as cB,V$ as cC,o7 as cD,u7 as cE,f7 as cF,n7 as cG,KW as cH,Z$ as cI,NW as cJ,RU as cK,F$ as cL,a7 as cM,c7 as cN,h7 as cO,qU as cP,ZW as cQ,W$ as cR,U$ as cS,FW as cT,X$ as cU,PW as cV,UI as cW,LW as cX,z$ as cY,UW as cZ,i7 as c_,TW as ca,_z as cb,JI as cc,eo as cd,OW as ce,eB as cf,r7 as cg,nD as ch,mz as ci,iD as cj,$$ as ck,MW as cl,p$ as cm,B$ as cn,CW as co,e7 as cp,$W as cq,GW as cr,Tz as cs,kW as ct,$U as cu,t7 as cv,g7 as cw,ab as cx,vB as cy,f$ as cz,Us as d,d7 as d0,XW as d1,DW as d2,JW as d3,qW as d4,WW as d5,l7 as d6,zW as d7,YW as d8,QW as d9,BW as da,VW as db,Me as dc,gc as e,g8 as f,N4 as g,f8 as h,c8 as i,Gq as j,Hq as k,r8 as l,o8 as m,i8 as n,Be as o,k4 as p,a8 as q,OR as r,v1 as s,l8 as t,d8 as u,ww as v,Jq as w,Xq as x,zq as y,jq as z};
