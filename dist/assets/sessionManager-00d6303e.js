import{cH as h,d1 as c,dc as r}from"./index-118d3eb3.js";class g{constructor(){this.sessionTimeout=null,this.warningTimeout=null,this.activityTimeout=null,this.lastActivity=Date.now(),this.sessionStartTime=null,this.isSessionActive=!1,this.warningShown=!1,this.config={sessionTimeoutDuration:30*60*1e3,warningDuration:5*60*1e3,activityTimeoutDuration:15*60*1e3,enableActivityTracking:!0,enableSessionTimeout:!0,enableWarning:!0,autoLogout:!0},this.init()}init(){console.log("üïê Initializing SessionManager..."),this.setupAuthStateListener(),this.setupActivityTracking(),this.setupVisibilityChangeHandler(),console.log("‚úÖ SessionManager initialized")}setupAuthStateListener(){h(r,i=>{i?this.startSession(i):this.endSession()})}setupActivityTracking(){if(!this.config.enableActivityTracking)return;const i=["mousedown","mousemove","keypress","keydown","scroll","touchstart","click","focus"],t=()=>{this.lastActivity=Date.now(),this.resetActivityTimeout(),this.isSessionActive&&this.resetSessionTimeout()};i.forEach(s=>{document.addEventListener(s,t,{passive:!0})}),document.addEventListener("visibilitychange",()=>{document.hidden||t()})}setupVisibilityChangeHandler(){document.addEventListener("visibilitychange",()=>{document.hidden?this.handlePageHidden():this.handlePageVisible()})}startSession(i){console.log("üïê Starting session for user:",i.uid),this.sessionStartTime=Date.now(),this.isSessionActive=!0,this.lastActivity=Date.now(),this.warningShown=!1,this.setupSessionTimeout(),this.setupActivityTimeout(),this.showSessionStartedNotification()}endSession(){console.log("üïê Ending session"),this.isSessionActive=!1,this.sessionStartTime=null,this.warningShown=!1,this.clearSessionTimeout(),this.clearWarningTimeout(),this.clearActivityTimeout(),this.showSessionEndedNotification()}setupSessionTimeout(){this.config.enableSessionTimeout&&(this.clearSessionTimeout(),this.sessionTimeout=setTimeout(()=>{this.handleSessionTimeout()},this.config.sessionTimeoutDuration),this.config.enableWarning&&(this.warningTimeout=setTimeout(()=>{this.showSessionWarning()},this.config.sessionTimeoutDuration-this.config.warningDuration)))}setupActivityTimeout(){this.config.enableActivityTracking&&(this.clearActivityTimeout(),this.activityTimeout=setTimeout(()=>{this.handleActivityTimeout()},this.config.activityTimeoutDuration))}resetSessionTimeout(){this.isSessionActive&&(this.clearSessionTimeout(),this.setupSessionTimeout())}resetActivityTimeout(){this.isSessionActive&&(this.clearActivityTimeout(),this.setupActivityTimeout())}clearSessionTimeout(){this.sessionTimeout&&(clearTimeout(this.sessionTimeout),this.sessionTimeout=null),this.warningTimeout&&(clearTimeout(this.warningTimeout),this.warningTimeout=null)}clearActivityTimeout(){this.activityTimeout&&(clearTimeout(this.activityTimeout),this.activityTimeout=null)}clearWarningTimeout(){this.warningTimeout&&(clearTimeout(this.warningTimeout),this.warningTimeout=null)}handleSessionTimeout(){console.log("‚è∞ Session timeout reached"),this.config.autoLogout?(this.showSessionTimeoutNotification(),setTimeout(async()=>{try{await c(r)}catch(i){console.error("‚ùå Error signing out:",i)}},3e3)):this.showSessionTimeoutWarning()}handleActivityTimeout(){console.log("‚è∞ Activity timeout reached"),this.showInactivityWarning()}handlePageHidden(){console.log("üëÅÔ∏è Page hidden"),this.pauseSessionTimeout()}handlePageVisible(){console.log("üëÅÔ∏è Page visible"),this.resumeSessionTimeout()}pauseSessionTimeout(){this.sessionTimeout&&(clearTimeout(this.sessionTimeout),this.sessionTimeout=null)}resumeSessionTimeout(){this.isSessionActive&&this.setupSessionTimeout()}showSessionStartedNotification(){this.showNotification({type:"success",title:"üïê Session Started",message:"You are now logged in and your session is active.",duration:3e3})}showSessionEndedNotification(){this.showNotification({type:"info",title:"üëã Session Ended",message:"You have been logged out.",duration:3e3})}showSessionWarning(){if(this.warningShown)return;this.warningShown=!0;const i=Math.floor(this.config.warningDuration/6e4);this.showNotification({type:"warning",title:"‚è∞ Session Warning",message:`Your session will expire in ${i} minutes. Please save your work.`,duration:1e4,actions:[{text:"Extend Session",action:()=>this.extendSession()}]})}showSessionTimeoutNotification(){this.showNotification({type:"error",title:"‚è∞ Session Expired",message:"Your session has expired. You will be logged out automatically.",duration:0,actions:[{text:"Stay Logged In",action:()=>this.extendSession()}]})}showSessionTimeoutWarning(){this.showNotification({type:"warning",title:"‚è∞ Session Expired",message:"Your session has expired. Please refresh the page to continue.",duration:15e3,actions:[{text:"Refresh Page",action:()=>window.location.reload()}]})}showInactivityWarning(){this.showNotification({type:"info",title:"üò¥ Inactive Session",message:"You have been inactive for a while. Your session will timeout soon.",duration:8e3,actions:[{text:"Stay Active",action:()=>this.resetActivityTimeout()}]})}showNotification({type:i,title:t,message:s,duration:o=5e3,actions:a=[]}){const e=document.createElement("div");e.className=`fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${i==="success"?"bg-green-500":i==="error"?"bg-red-500":i==="warning"?"bg-yellow-500":i==="info"?"bg-blue-500":"bg-gray-500"} text-white`;let n=`
      <div class="font-bold">${t}</div>
      <div class="text-sm opacity-90 mt-1">${s}</div>
    `;a.length>0&&(n+='<div class="mt-3 flex gap-2">',a.forEach(u=>{n+=`
          <button 
            class="px-3 py-1 bg-white bg-opacity-20 rounded text-sm hover:bg-opacity-30 transition-colors"
            onclick="(${u.action.toString()})()"
          >
            ${u.text}
          </button>
        `}),n+="</div>"),n+=`
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,e.innerHTML=n,document.body.appendChild(e),o>0&&setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},o)}extendSession(){console.log("üïê Extending session"),this.warningShown=!1,this.resetSessionTimeout(),this.resetActivityTimeout(),this.showNotification({type:"success",title:"‚úÖ Session Extended",message:"Your session has been extended.",duration:3e3})}async logout(){try{await c(r)}catch(i){console.error("‚ùå Error during logout:",i)}}getSessionInfo(){if(!this.isSessionActive)return{isActive:!1,startTime:null,duration:0,lastActivity:null,timeUntilTimeout:0,timeUntilWarning:0};const i=Date.now(),t=i-this.sessionStartTime,s=i-this.lastActivity,o=this.config.sessionTimeoutDuration-s,a=o-this.config.warningDuration;return{isActive:this.isSessionActive,startTime:this.sessionStartTime,duration:Math.floor(t/1e3),lastActivity:this.lastActivity,timeUntilTimeout:Math.max(0,Math.floor(o/1e3)),timeUntilWarning:Math.max(0,Math.floor(a/1e3))}}getSessionDuration(){return!this.isSessionActive||!this.sessionStartTime?0:Math.floor((Date.now()-this.sessionStartTime)/1e3)}getTimeUntilTimeout(){if(!this.isSessionActive)return 0;const i=Date.now()-this.lastActivity;return Math.max(0,this.config.sessionTimeoutDuration-i)}updateConfig(i){this.config={...this.config,...i},this.isSessionActive&&(this.resetSessionTimeout(),this.resetActivityTimeout())}destroy(){this.clearSessionTimeout(),this.clearWarningTimeout(),this.clearActivityTimeout()}}export{g as default};
