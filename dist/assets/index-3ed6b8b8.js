var U2=Object.defineProperty;var B2=(n,e,t)=>e in n?U2(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Wh=(n,e,t)=>(B2(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function z2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var aA={exports:{}},_p={},lA={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kd=Symbol.for("react.element"),q2=Symbol.for("react.portal"),W2=Symbol.for("react.fragment"),G2=Symbol.for("react.strict_mode"),H2=Symbol.for("react.profiler"),Q2=Symbol.for("react.provider"),K2=Symbol.for("react.context"),Y2=Symbol.for("react.forward_ref"),J2=Symbol.for("react.suspense"),X2=Symbol.for("react.memo"),Z2=Symbol.for("react.lazy"),QS=Symbol.iterator;function ej(n){return n===null||typeof n!="object"?null:(n=QS&&n[QS]||n["@@iterator"],typeof n=="function"?n:null)}var cA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uA=Object.assign,dA={};function Sc(n,e,t){this.props=n,this.context=e,this.refs=dA,this.updater=t||cA}Sc.prototype.isReactComponent={};Sc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Sc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function hA(){}hA.prototype=Sc.prototype;function Jv(n,e,t){this.props=n,this.context=e,this.refs=dA,this.updater=t||cA}var Xv=Jv.prototype=new hA;Xv.constructor=Jv;uA(Xv,Sc.prototype);Xv.isPureReactComponent=!0;var KS=Array.isArray,fA=Object.prototype.hasOwnProperty,Zv={current:null},mA={key:!0,ref:!0,__self:!0,__source:!0};function pA(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)fA.call(e,r)&&!mA.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Kd,type:n,key:i,ref:o,props:s,_owner:Zv.current}}function tj(n,e){return{$$typeof:Kd,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function e_(n){return typeof n=="object"&&n!==null&&n.$$typeof===Kd}function nj(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var YS=/\/+/g;function Xg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?nj(""+n.key):e.toString(36)}function Nf(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Kd:case q2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+Xg(o,0):r,KS(s)?(t="",n!=null&&(t=n.replace(YS,"$&/")+"/"),Nf(s,e,t,"",function(u){return u})):s!=null&&(e_(s)&&(s=tj(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(YS,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",KS(n))for(var a=0;a<n.length;a++){i=n[a];var c=r+Xg(i,a);o+=Nf(i,e,t,c,s)}else if(c=ej(n),typeof c=="function")for(n=c.call(n),a=0;!(i=n.next()).done;)i=i.value,c=r+Xg(i,a++),o+=Nf(i,e,t,c,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Gh(n,e,t){if(n==null)return n;var r=[],s=0;return Nf(n,r,"","",function(i){return e.call(t,i,s++)}),r}function rj(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var cr={current:null},Cf={transition:null},sj={ReactCurrentDispatcher:cr,ReactCurrentBatchConfig:Cf,ReactCurrentOwner:Zv};function gA(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:Gh,forEach:function(n,e,t){Gh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Gh(n,function(){e++}),e},toArray:function(n){return Gh(n,function(e){return e})||[]},only:function(n){if(!e_(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};He.Component=Sc;He.Fragment=W2;He.Profiler=H2;He.PureComponent=Jv;He.StrictMode=G2;He.Suspense=J2;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sj;He.act=gA;He.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=uA({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Zv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(c in e)fA.call(e,c)&&!mA.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Kd,type:n.type,key:s,ref:i,props:r,_owner:o}};He.createContext=function(n){return n={$$typeof:K2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Q2,_context:n},n.Consumer=n};He.createElement=pA;He.createFactory=function(n){var e=pA.bind(null,n);return e.type=n,e};He.createRef=function(){return{current:null}};He.forwardRef=function(n){return{$$typeof:Y2,render:n}};He.isValidElement=e_;He.lazy=function(n){return{$$typeof:Z2,_payload:{_status:-1,_result:n},_init:rj}};He.memo=function(n,e){return{$$typeof:X2,type:n,compare:e===void 0?null:e}};He.startTransition=function(n){var e=Cf.transition;Cf.transition={};try{n()}finally{Cf.transition=e}};He.unstable_act=gA;He.useCallback=function(n,e){return cr.current.useCallback(n,e)};He.useContext=function(n){return cr.current.useContext(n)};He.useDebugValue=function(){};He.useDeferredValue=function(n){return cr.current.useDeferredValue(n)};He.useEffect=function(n,e){return cr.current.useEffect(n,e)};He.useId=function(){return cr.current.useId()};He.useImperativeHandle=function(n,e,t){return cr.current.useImperativeHandle(n,e,t)};He.useInsertionEffect=function(n,e){return cr.current.useInsertionEffect(n,e)};He.useLayoutEffect=function(n,e){return cr.current.useLayoutEffect(n,e)};He.useMemo=function(n,e){return cr.current.useMemo(n,e)};He.useReducer=function(n,e,t){return cr.current.useReducer(n,e,t)};He.useRef=function(n){return cr.current.useRef(n)};He.useState=function(n){return cr.current.useState(n)};He.useSyncExternalStore=function(n,e,t){return cr.current.useSyncExternalStore(n,e,t)};He.useTransition=function(){return cr.current.useTransition()};He.version="18.3.1";lA.exports=He;var D=lA.exports;const yA=z2(D);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ij=D,oj=Symbol.for("react.element"),aj=Symbol.for("react.fragment"),lj=Object.prototype.hasOwnProperty,cj=ij.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,uj={key:!0,ref:!0,__self:!0,__source:!0};function vA(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)lj.call(e,r)&&!uj.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:oj,type:n,key:i,ref:o,props:s,_owner:cj.current}}_p.Fragment=aj;_p.jsx=vA;_p.jsxs=vA;aA.exports=_p;var l=aA.exports,r0={},_A={exports:{}},Fr={},wA={exports:{}},xA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(z,ne){var W=z.length;z.push(ne);e:for(;0<W;){var Q=W-1>>>1,Z=z[Q];if(0<s(Z,ne))z[Q]=ne,z[W]=Z,W=Q;else break e}}function t(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var ne=z[0],W=z.pop();if(W!==ne){z[0]=W;e:for(var Q=0,Z=z.length,me=Z>>>1;Q<me;){var we=2*(Q+1)-1,De=z[we],Re=we+1,vt=z[Re];if(0>s(De,W))Re<Z&&0>s(vt,De)?(z[Q]=vt,z[Re]=W,Q=Re):(z[Q]=De,z[we]=W,Q=we);else if(Re<Z&&0>s(vt,W))z[Q]=vt,z[Re]=W,Q=Re;else break e}}return ne}function s(z,ne){var W=z.sortIndex-ne.sortIndex;return W!==0?W:z.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],u=[],h=1,f=null,m=3,g=!1,v=!1,_=!1,R=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(z){for(var ne=t(u);ne!==null;){if(ne.callback===null)r(u);else if(ne.startTime<=z)r(u),ne.sortIndex=ne.expirationTime,e(c,ne);else break;ne=t(u)}}function P(z){if(_=!1,C(z),!v)if(t(c)!==null)v=!0,ve($);else{var ne=t(u);ne!==null&&Te(P,ne.startTime-z)}}function $(z,ne){v=!1,_&&(_=!1,x(S),S=-1),g=!0;var W=m;try{for(C(ne),f=t(c);f!==null&&(!(f.expirationTime>ne)||z&&!k());){var Q=f.callback;if(typeof Q=="function"){f.callback=null,m=f.priorityLevel;var Z=Q(f.expirationTime<=ne);ne=n.unstable_now(),typeof Z=="function"?f.callback=Z:f===t(c)&&r(c),C(ne)}else r(c);f=t(c)}if(f!==null)var me=!0;else{var we=t(u);we!==null&&Te(P,we.startTime-ne),me=!1}return me}finally{f=null,m=W,g=!1}}var V=!1,A=null,S=-1,E=5,N=-1;function k(){return!(n.unstable_now()-N<E)}function b(){if(A!==null){var z=n.unstable_now();N=z;var ne=!0;try{ne=A(!0,z)}finally{ne?w():(V=!1,A=null)}}else V=!1}var w;if(typeof I=="function")w=function(){I(b)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,q=U.port2;U.port1.onmessage=b,w=function(){q.postMessage(null)}}else w=function(){R(b,0)};function ve(z){A=z,V||(V=!0,w())}function Te(z,ne){S=R(function(){z(n.unstable_now())},ne)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_continueExecution=function(){v||g||(v=!0,ve($))},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(z){switch(m){case 1:case 2:case 3:var ne=3;break;default:ne=m}var W=m;m=ne;try{return z()}finally{m=W}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(z,ne){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var W=m;m=z;try{return ne()}finally{m=W}},n.unstable_scheduleCallback=function(z,ne,W){var Q=n.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?Q+W:Q):W=Q,z){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=W+Z,z={id:h++,callback:ne,priorityLevel:z,startTime:W,expirationTime:Z,sortIndex:-1},W>Q?(z.sortIndex=W,e(u,z),t(c)===null&&z===t(u)&&(_?(x(S),S=-1):_=!0,Te(P,W-Q))):(z.sortIndex=Z,e(c,z),v||g||(v=!0,ve($))),z},n.unstable_shouldYield=k,n.unstable_wrapCallback=function(z){var ne=m;return function(){var W=m;m=ne;try{return z.apply(this,arguments)}finally{m=W}}}})(xA);wA.exports=xA;var dj=wA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hj=D,Mr=dj;function K(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var SA=new Set,nd={};function Pa(n,e){Bl(n,e),Bl(n+"Capture",e)}function Bl(n,e){for(nd[n]=e,n=0;n<e.length;n++)SA.add(e[n])}var oi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s0=Object.prototype.hasOwnProperty,fj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,JS={},XS={};function mj(n){return s0.call(XS,n)?!0:s0.call(JS,n)?!1:fj.test(n)?XS[n]=!0:(JS[n]=!0,!1)}function pj(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function gj(n,e,t,r){if(e===null||typeof e>"u"||pj(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ur(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Gn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Gn[n]=new ur(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Gn[e]=new ur(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Gn[n]=new ur(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Gn[n]=new ur(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Gn[n]=new ur(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Gn[n]=new ur(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Gn[n]=new ur(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Gn[n]=new ur(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Gn[n]=new ur(n,5,!1,n.toLowerCase(),null,!1,!1)});var t_=/[\-:]([a-z])/g;function n_(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(t_,n_);Gn[e]=new ur(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(t_,n_);Gn[e]=new ur(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(t_,n_);Gn[e]=new ur(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Gn[n]=new ur(n,1,!1,n.toLowerCase(),null,!1,!1)});Gn.xlinkHref=new ur("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Gn[n]=new ur(n,1,!1,n.toLowerCase(),null,!0,!0)});function r_(n,e,t,r){var s=Gn.hasOwnProperty(e)?Gn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gj(e,t,s,r)&&(t=null),r||s===null?mj(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var yi=hj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hh=Symbol.for("react.element"),ml=Symbol.for("react.portal"),pl=Symbol.for("react.fragment"),s_=Symbol.for("react.strict_mode"),i0=Symbol.for("react.profiler"),IA=Symbol.for("react.provider"),EA=Symbol.for("react.context"),i_=Symbol.for("react.forward_ref"),o0=Symbol.for("react.suspense"),a0=Symbol.for("react.suspense_list"),o_=Symbol.for("react.memo"),Pi=Symbol.for("react.lazy"),bA=Symbol.for("react.offscreen"),ZS=Symbol.iterator;function Yc(n){return n===null||typeof n!="object"?null:(n=ZS&&n[ZS]||n["@@iterator"],typeof n=="function"?n:null)}var Zt=Object.assign,Zg;function gu(n){if(Zg===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Zg=e&&e[1]||""}return`
`+Zg+n}var ey=!1;function ty(n,e){if(!n||ey)return"";ey=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=o&&0<=a);break}}}finally{ey=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?gu(n):""}function yj(n){switch(n.tag){case 5:return gu(n.type);case 16:return gu("Lazy");case 13:return gu("Suspense");case 19:return gu("SuspenseList");case 0:case 2:case 15:return n=ty(n.type,!1),n;case 11:return n=ty(n.type.render,!1),n;case 1:return n=ty(n.type,!0),n;default:return""}}function l0(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case pl:return"Fragment";case ml:return"Portal";case i0:return"Profiler";case s_:return"StrictMode";case o0:return"Suspense";case a0:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case EA:return(n.displayName||"Context")+".Consumer";case IA:return(n._context.displayName||"Context")+".Provider";case i_:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case o_:return e=n.displayName||null,e!==null?e:l0(n.type)||"Memo";case Pi:e=n._payload,n=n._init;try{return l0(n(e))}catch{}}return null}function vj(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return l0(e);case 8:return e===s_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ho(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function TA(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function _j(n){var e=TA(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Qh(n){n._valueTracker||(n._valueTracker=_j(n))}function AA(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=TA(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function sm(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function c0(n,e){var t=e.checked;return Zt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function eI(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=ho(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function NA(n,e){e=e.checked,e!=null&&r_(n,"checked",e,!1)}function u0(n,e){NA(n,e);var t=ho(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?d0(n,e.type,t):e.hasOwnProperty("defaultValue")&&d0(n,e.type,ho(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function tI(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function d0(n,e,t){(e!=="number"||sm(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var yu=Array.isArray;function Tl(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+ho(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function h0(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(K(91));return Zt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function nI(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(K(92));if(yu(t)){if(1<t.length)throw Error(K(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ho(t)}}function CA(n,e){var t=ho(e.value),r=ho(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function rI(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function kA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function f0(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?kA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Kh,RA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Kh=Kh||document.createElement("div"),Kh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Kh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function rd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Nu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wj=["Webkit","ms","Moz","O"];Object.keys(Nu).forEach(function(n){wj.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Nu[e]=Nu[n]})});function DA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Nu.hasOwnProperty(n)&&Nu[n]?(""+e).trim():e+"px"}function PA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=DA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var xj=Zt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function m0(n,e){if(e){if(xj[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(K(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(K(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(K(61))}if(e.style!=null&&typeof e.style!="object")throw Error(K(62))}}function p0(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var g0=null;function a_(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var y0=null,Al=null,Nl=null;function sI(n){if(n=Xd(n)){if(typeof y0!="function")throw Error(K(280));var e=n.stateNode;e&&(e=Ep(e),y0(n.stateNode,n.type,e))}}function jA(n){Al?Nl?Nl.push(n):Nl=[n]:Al=n}function MA(){if(Al){var n=Al,e=Nl;if(Nl=Al=null,sI(n),e)for(n=0;n<e.length;n++)sI(e[n])}}function OA(n,e){return n(e)}function LA(){}var ny=!1;function VA(n,e,t){if(ny)return n(e,t);ny=!0;try{return OA(n,e,t)}finally{ny=!1,(Al!==null||Nl!==null)&&(LA(),MA())}}function sd(n,e){var t=n.stateNode;if(t===null)return null;var r=Ep(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(K(231,e,typeof t));return t}var v0=!1;if(oi)try{var Jc={};Object.defineProperty(Jc,"passive",{get:function(){v0=!0}}),window.addEventListener("test",Jc,Jc),window.removeEventListener("test",Jc,Jc)}catch{v0=!1}function Sj(n,e,t,r,s,i,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var Cu=!1,im=null,om=!1,_0=null,Ij={onError:function(n){Cu=!0,im=n}};function Ej(n,e,t,r,s,i,o,a,c){Cu=!1,im=null,Sj.apply(Ij,arguments)}function bj(n,e,t,r,s,i,o,a,c){if(Ej.apply(this,arguments),Cu){if(Cu){var u=im;Cu=!1,im=null}else throw Error(K(198));om||(om=!0,_0=u)}}function ja(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function FA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function iI(n){if(ja(n)!==n)throw Error(K(188))}function Tj(n){var e=n.alternate;if(!e){if(e=ja(n),e===null)throw Error(K(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return iI(s),n;if(i===r)return iI(s),e;i=i.sibling}throw Error(K(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(K(189))}}if(t.alternate!==r)throw Error(K(190))}if(t.tag!==3)throw Error(K(188));return t.stateNode.current===t?n:e}function $A(n){return n=Tj(n),n!==null?UA(n):null}function UA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=UA(n);if(e!==null)return e;n=n.sibling}return null}var BA=Mr.unstable_scheduleCallback,oI=Mr.unstable_cancelCallback,Aj=Mr.unstable_shouldYield,Nj=Mr.unstable_requestPaint,dn=Mr.unstable_now,Cj=Mr.unstable_getCurrentPriorityLevel,l_=Mr.unstable_ImmediatePriority,zA=Mr.unstable_UserBlockingPriority,am=Mr.unstable_NormalPriority,kj=Mr.unstable_LowPriority,qA=Mr.unstable_IdlePriority,wp=null,Ds=null;function Rj(n){if(Ds&&typeof Ds.onCommitFiberRoot=="function")try{Ds.onCommitFiberRoot(wp,n,void 0,(n.current.flags&128)===128)}catch{}}var ds=Math.clz32?Math.clz32:jj,Dj=Math.log,Pj=Math.LN2;function jj(n){return n>>>=0,n===0?32:31-(Dj(n)/Pj|0)|0}var Yh=64,Jh=4194304;function vu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function lm(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=vu(a):(i&=o,i!==0&&(r=vu(i)))}else o=t&~s,o!==0?r=vu(o):i!==0&&(r=vu(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-ds(e),s=1<<t,r|=n[t],e&=~s;return r}function Mj(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Oj(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-ds(i),a=1<<o,c=s[o];c===-1?(!(a&t)||a&r)&&(s[o]=Mj(a,e)):c<=e&&(n.expiredLanes|=a),i&=~a}}function w0(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function WA(){var n=Yh;return Yh<<=1,!(Yh&4194240)&&(Yh=64),n}function ry(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Yd(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ds(e),n[e]=t}function Lj(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-ds(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function c_(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-ds(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var ft=0;function GA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var HA,u_,QA,KA,YA,x0=!1,Xh=[],Yi=null,Ji=null,Xi=null,id=new Map,od=new Map,Mi=[],Vj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function aI(n,e){switch(n){case"focusin":case"focusout":Yi=null;break;case"dragenter":case"dragleave":Ji=null;break;case"mouseover":case"mouseout":Xi=null;break;case"pointerover":case"pointerout":id.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":od.delete(e.pointerId)}}function Xc(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Xd(e),e!==null&&u_(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function Fj(n,e,t,r,s){switch(e){case"focusin":return Yi=Xc(Yi,n,e,t,r,s),!0;case"dragenter":return Ji=Xc(Ji,n,e,t,r,s),!0;case"mouseover":return Xi=Xc(Xi,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return id.set(i,Xc(id.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,od.set(i,Xc(od.get(i)||null,n,e,t,r,s)),!0}return!1}function JA(n){var e=Yo(n.target);if(e!==null){var t=ja(e);if(t!==null){if(e=t.tag,e===13){if(e=FA(t),e!==null){n.blockedOn=e,YA(n.priority,function(){QA(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function kf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=S0(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);g0=r,t.target.dispatchEvent(r),g0=null}else return e=Xd(t),e!==null&&u_(e),n.blockedOn=t,!1;e.shift()}return!0}function lI(n,e,t){kf(n)&&t.delete(e)}function $j(){x0=!1,Yi!==null&&kf(Yi)&&(Yi=null),Ji!==null&&kf(Ji)&&(Ji=null),Xi!==null&&kf(Xi)&&(Xi=null),id.forEach(lI),od.forEach(lI)}function Zc(n,e){n.blockedOn===e&&(n.blockedOn=null,x0||(x0=!0,Mr.unstable_scheduleCallback(Mr.unstable_NormalPriority,$j)))}function ad(n){function e(s){return Zc(s,n)}if(0<Xh.length){Zc(Xh[0],n);for(var t=1;t<Xh.length;t++){var r=Xh[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Yi!==null&&Zc(Yi,n),Ji!==null&&Zc(Ji,n),Xi!==null&&Zc(Xi,n),id.forEach(e),od.forEach(e),t=0;t<Mi.length;t++)r=Mi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Mi.length&&(t=Mi[0],t.blockedOn===null);)JA(t),t.blockedOn===null&&Mi.shift()}var Cl=yi.ReactCurrentBatchConfig,cm=!0;function Uj(n,e,t,r){var s=ft,i=Cl.transition;Cl.transition=null;try{ft=1,d_(n,e,t,r)}finally{ft=s,Cl.transition=i}}function Bj(n,e,t,r){var s=ft,i=Cl.transition;Cl.transition=null;try{ft=4,d_(n,e,t,r)}finally{ft=s,Cl.transition=i}}function d_(n,e,t,r){if(cm){var s=S0(n,e,t,r);if(s===null)fy(n,e,r,um,t),aI(n,r);else if(Fj(s,n,e,t,r))r.stopPropagation();else if(aI(n,r),e&4&&-1<Vj.indexOf(n)){for(;s!==null;){var i=Xd(s);if(i!==null&&HA(i),i=S0(n,e,t,r),i===null&&fy(n,e,r,um,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else fy(n,e,r,null,t)}}var um=null;function S0(n,e,t,r){if(um=null,n=a_(r),n=Yo(n),n!==null)if(e=ja(n),e===null)n=null;else if(t=e.tag,t===13){if(n=FA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return um=n,null}function XA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Cj()){case l_:return 1;case zA:return 4;case am:case kj:return 16;case qA:return 536870912;default:return 16}default:return 16}}var Bi=null,h_=null,Rf=null;function ZA(){if(Rf)return Rf;var n,e=h_,t=e.length,r,s="value"in Bi?Bi.value:Bi.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Rf=s.slice(n,1<r?1-r:void 0)}function Df(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Zh(){return!0}function cI(){return!1}function $r(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Zh:cI,this.isPropagationStopped=cI,this}return Zt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Zh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Zh)},persist:function(){},isPersistent:Zh}),e}var Ic={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},f_=$r(Ic),Jd=Zt({},Ic,{view:0,detail:0}),zj=$r(Jd),sy,iy,eu,xp=Zt({},Jd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:m_,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==eu&&(eu&&n.type==="mousemove"?(sy=n.screenX-eu.screenX,iy=n.screenY-eu.screenY):iy=sy=0,eu=n),sy)},movementY:function(n){return"movementY"in n?n.movementY:iy}}),uI=$r(xp),qj=Zt({},xp,{dataTransfer:0}),Wj=$r(qj),Gj=Zt({},Jd,{relatedTarget:0}),oy=$r(Gj),Hj=Zt({},Ic,{animationName:0,elapsedTime:0,pseudoElement:0}),Qj=$r(Hj),Kj=Zt({},Ic,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Yj=$r(Kj),Jj=Zt({},Ic,{data:0}),dI=$r(Jj),Xj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Zj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tM(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=eM[n])?!!e[n]:!1}function m_(){return tM}var nM=Zt({},Jd,{key:function(n){if(n.key){var e=Xj[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Df(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Zj[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:m_,charCode:function(n){return n.type==="keypress"?Df(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Df(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),rM=$r(nM),sM=Zt({},xp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hI=$r(sM),iM=Zt({},Jd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:m_}),oM=$r(iM),aM=Zt({},Ic,{propertyName:0,elapsedTime:0,pseudoElement:0}),lM=$r(aM),cM=Zt({},xp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),uM=$r(cM),dM=[9,13,27,32],p_=oi&&"CompositionEvent"in window,ku=null;oi&&"documentMode"in document&&(ku=document.documentMode);var hM=oi&&"TextEvent"in window&&!ku,e1=oi&&(!p_||ku&&8<ku&&11>=ku),fI=String.fromCharCode(32),mI=!1;function t1(n,e){switch(n){case"keyup":return dM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function n1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var gl=!1;function fM(n,e){switch(n){case"compositionend":return n1(e);case"keypress":return e.which!==32?null:(mI=!0,fI);case"textInput":return n=e.data,n===fI&&mI?null:n;default:return null}}function mM(n,e){if(gl)return n==="compositionend"||!p_&&t1(n,e)?(n=ZA(),Rf=h_=Bi=null,gl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return e1&&e.locale!=="ko"?null:e.data;default:return null}}var pM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!pM[n.type]:e==="textarea"}function r1(n,e,t,r){jA(r),e=dm(e,"onChange"),0<e.length&&(t=new f_("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Ru=null,ld=null;function gM(n){m1(n,0)}function Sp(n){var e=_l(n);if(AA(e))return n}function yM(n,e){if(n==="change")return e}var s1=!1;if(oi){var ay;if(oi){var ly="oninput"in document;if(!ly){var gI=document.createElement("div");gI.setAttribute("oninput","return;"),ly=typeof gI.oninput=="function"}ay=ly}else ay=!1;s1=ay&&(!document.documentMode||9<document.documentMode)}function yI(){Ru&&(Ru.detachEvent("onpropertychange",i1),ld=Ru=null)}function i1(n){if(n.propertyName==="value"&&Sp(ld)){var e=[];r1(e,ld,n,a_(n)),VA(gM,e)}}function vM(n,e,t){n==="focusin"?(yI(),Ru=e,ld=t,Ru.attachEvent("onpropertychange",i1)):n==="focusout"&&yI()}function _M(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Sp(ld)}function wM(n,e){if(n==="click")return Sp(e)}function xM(n,e){if(n==="input"||n==="change")return Sp(e)}function SM(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ps=typeof Object.is=="function"?Object.is:SM;function cd(n,e){if(ps(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!s0.call(e,s)||!ps(n[s],e[s]))return!1}return!0}function vI(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function _I(n,e){var t=vI(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=vI(t)}}function o1(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?o1(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function a1(){for(var n=window,e=sm();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=sm(n.document)}return e}function g_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function IM(n){var e=a1(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&o1(t.ownerDocument.documentElement,t)){if(r!==null&&g_(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=_I(t,i);var o=_I(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var EM=oi&&"documentMode"in document&&11>=document.documentMode,yl=null,I0=null,Du=null,E0=!1;function wI(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;E0||yl==null||yl!==sm(r)||(r=yl,"selectionStart"in r&&g_(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Du&&cd(Du,r)||(Du=r,r=dm(I0,"onSelect"),0<r.length&&(e=new f_("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=yl)))}function ef(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var vl={animationend:ef("Animation","AnimationEnd"),animationiteration:ef("Animation","AnimationIteration"),animationstart:ef("Animation","AnimationStart"),transitionend:ef("Transition","TransitionEnd")},cy={},l1={};oi&&(l1=document.createElement("div").style,"AnimationEvent"in window||(delete vl.animationend.animation,delete vl.animationiteration.animation,delete vl.animationstart.animation),"TransitionEvent"in window||delete vl.transitionend.transition);function Ip(n){if(cy[n])return cy[n];if(!vl[n])return n;var e=vl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in l1)return cy[n]=e[t];return n}var c1=Ip("animationend"),u1=Ip("animationiteration"),d1=Ip("animationstart"),h1=Ip("transitionend"),f1=new Map,xI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function To(n,e){f1.set(n,e),Pa(e,[n])}for(var uy=0;uy<xI.length;uy++){var dy=xI[uy],bM=dy.toLowerCase(),TM=dy[0].toUpperCase()+dy.slice(1);To(bM,"on"+TM)}To(c1,"onAnimationEnd");To(u1,"onAnimationIteration");To(d1,"onAnimationStart");To("dblclick","onDoubleClick");To("focusin","onFocus");To("focusout","onBlur");To(h1,"onTransitionEnd");Bl("onMouseEnter",["mouseout","mouseover"]);Bl("onMouseLeave",["mouseout","mouseover"]);Bl("onPointerEnter",["pointerout","pointerover"]);Bl("onPointerLeave",["pointerout","pointerover"]);Pa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Pa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Pa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Pa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Pa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Pa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _u="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AM=new Set("cancel close invalid load scroll toggle".split(" ").concat(_u));function SI(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,bj(r,e,void 0,n),n.currentTarget=null}function m1(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;SI(s,a,u),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;SI(s,a,u),i=c}}}if(om)throw n=_0,om=!1,_0=null,n}function Mt(n,e){var t=e[C0];t===void 0&&(t=e[C0]=new Set);var r=n+"__bubble";t.has(r)||(p1(e,n,2,!1),t.add(r))}function hy(n,e,t){var r=0;e&&(r|=4),p1(t,n,r,e)}var tf="_reactListening"+Math.random().toString(36).slice(2);function ud(n){if(!n[tf]){n[tf]=!0,SA.forEach(function(t){t!=="selectionchange"&&(AM.has(t)||hy(t,!1,n),hy(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[tf]||(e[tf]=!0,hy("selectionchange",!1,e))}}function p1(n,e,t,r){switch(XA(e)){case 1:var s=Uj;break;case 4:s=Bj;break;default:s=d_}t=s.bind(null,e,t,n),s=void 0,!v0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function fy(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Yo(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}VA(function(){var u=i,h=a_(t),f=[];e:{var m=f1.get(n);if(m!==void 0){var g=f_,v=n;switch(n){case"keypress":if(Df(t)===0)break e;case"keydown":case"keyup":g=rM;break;case"focusin":v="focus",g=oy;break;case"focusout":v="blur",g=oy;break;case"beforeblur":case"afterblur":g=oy;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=uI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=Wj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=oM;break;case c1:case u1:case d1:g=Qj;break;case h1:g=lM;break;case"scroll":g=zj;break;case"wheel":g=uM;break;case"copy":case"cut":case"paste":g=Yj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=hI}var _=(e&4)!==0,R=!_&&n==="scroll",x=_?m!==null?m+"Capture":null:m;_=[];for(var I=u,C;I!==null;){C=I;var P=C.stateNode;if(C.tag===5&&P!==null&&(C=P,x!==null&&(P=sd(I,x),P!=null&&_.push(dd(I,P,C)))),R)break;I=I.return}0<_.length&&(m=new g(m,v,null,t,h),f.push({event:m,listeners:_}))}}if(!(e&7)){e:{if(m=n==="mouseover"||n==="pointerover",g=n==="mouseout"||n==="pointerout",m&&t!==g0&&(v=t.relatedTarget||t.fromElement)&&(Yo(v)||v[ai]))break e;if((g||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,g?(v=t.relatedTarget||t.toElement,g=u,v=v?Yo(v):null,v!==null&&(R=ja(v),v!==R||v.tag!==5&&v.tag!==6)&&(v=null)):(g=null,v=u),g!==v)){if(_=uI,P="onMouseLeave",x="onMouseEnter",I="mouse",(n==="pointerout"||n==="pointerover")&&(_=hI,P="onPointerLeave",x="onPointerEnter",I="pointer"),R=g==null?m:_l(g),C=v==null?m:_l(v),m=new _(P,I+"leave",g,t,h),m.target=R,m.relatedTarget=C,P=null,Yo(h)===u&&(_=new _(x,I+"enter",v,t,h),_.target=C,_.relatedTarget=R,P=_),R=P,g&&v)t:{for(_=g,x=v,I=0,C=_;C;C=tl(C))I++;for(C=0,P=x;P;P=tl(P))C++;for(;0<I-C;)_=tl(_),I--;for(;0<C-I;)x=tl(x),C--;for(;I--;){if(_===x||x!==null&&_===x.alternate)break t;_=tl(_),x=tl(x)}_=null}else _=null;g!==null&&II(f,m,g,_,!1),v!==null&&R!==null&&II(f,R,v,_,!0)}}e:{if(m=u?_l(u):window,g=m.nodeName&&m.nodeName.toLowerCase(),g==="select"||g==="input"&&m.type==="file")var $=yM;else if(pI(m))if(s1)$=xM;else{$=_M;var V=vM}else(g=m.nodeName)&&g.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&($=wM);if($&&($=$(n,u))){r1(f,$,t,h);break e}V&&V(n,m,u),n==="focusout"&&(V=m._wrapperState)&&V.controlled&&m.type==="number"&&d0(m,"number",m.value)}switch(V=u?_l(u):window,n){case"focusin":(pI(V)||V.contentEditable==="true")&&(yl=V,I0=u,Du=null);break;case"focusout":Du=I0=yl=null;break;case"mousedown":E0=!0;break;case"contextmenu":case"mouseup":case"dragend":E0=!1,wI(f,t,h);break;case"selectionchange":if(EM)break;case"keydown":case"keyup":wI(f,t,h)}var A;if(p_)e:{switch(n){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else gl?t1(n,t)&&(S="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(S="onCompositionStart");S&&(e1&&t.locale!=="ko"&&(gl||S!=="onCompositionStart"?S==="onCompositionEnd"&&gl&&(A=ZA()):(Bi=h,h_="value"in Bi?Bi.value:Bi.textContent,gl=!0)),V=dm(u,S),0<V.length&&(S=new dI(S,n,null,t,h),f.push({event:S,listeners:V}),A?S.data=A:(A=n1(t),A!==null&&(S.data=A)))),(A=hM?fM(n,t):mM(n,t))&&(u=dm(u,"onBeforeInput"),0<u.length&&(h=new dI("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=A))}m1(f,e)})}function dd(n,e,t){return{instance:n,listener:e,currentTarget:t}}function dm(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=sd(n,t),i!=null&&r.unshift(dd(n,i,s)),i=sd(n,e),i!=null&&r.push(dd(n,i,s))),n=n.return}return r}function tl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function II(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,s?(c=sd(t,i),c!=null&&o.unshift(dd(t,c,a))):s||(c=sd(t,i),c!=null&&o.push(dd(t,c,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var NM=/\r\n?/g,CM=/\u0000|\uFFFD/g;function EI(n){return(typeof n=="string"?n:""+n).replace(NM,`
`).replace(CM,"")}function nf(n,e,t){if(e=EI(e),EI(n)!==e&&t)throw Error(K(425))}function hm(){}var b0=null,T0=null;function A0(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var N0=typeof setTimeout=="function"?setTimeout:void 0,kM=typeof clearTimeout=="function"?clearTimeout:void 0,bI=typeof Promise=="function"?Promise:void 0,RM=typeof queueMicrotask=="function"?queueMicrotask:typeof bI<"u"?function(n){return bI.resolve(null).then(n).catch(DM)}:N0;function DM(n){setTimeout(function(){throw n})}function my(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),ad(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);ad(e)}function Zi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function TI(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ec=Math.random().toString(36).slice(2),Ts="__reactFiber$"+Ec,hd="__reactProps$"+Ec,ai="__reactContainer$"+Ec,C0="__reactEvents$"+Ec,PM="__reactListeners$"+Ec,jM="__reactHandles$"+Ec;function Yo(n){var e=n[Ts];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ai]||t[Ts]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=TI(n);n!==null;){if(t=n[Ts])return t;n=TI(n)}return e}n=t,t=n.parentNode}return null}function Xd(n){return n=n[Ts]||n[ai],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function _l(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(K(33))}function Ep(n){return n[hd]||null}var k0=[],wl=-1;function Ao(n){return{current:n}}function Lt(n){0>wl||(n.current=k0[wl],k0[wl]=null,wl--)}function Ct(n,e){wl++,k0[wl]=n.current,n.current=e}var fo={},sr=Ao(fo),gr=Ao(!1),da=fo;function zl(n,e){var t=n.type.contextTypes;if(!t)return fo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function yr(n){return n=n.childContextTypes,n!=null}function fm(){Lt(gr),Lt(sr)}function AI(n,e,t){if(sr.current!==fo)throw Error(K(168));Ct(sr,e),Ct(gr,t)}function g1(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(K(108,vj(n)||"Unknown",s));return Zt({},t,r)}function mm(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||fo,da=sr.current,Ct(sr,n),Ct(gr,gr.current),!0}function NI(n,e,t){var r=n.stateNode;if(!r)throw Error(K(169));t?(n=g1(n,e,da),r.__reactInternalMemoizedMergedChildContext=n,Lt(gr),Lt(sr),Ct(sr,n)):Lt(gr),Ct(gr,t)}var Ks=null,bp=!1,py=!1;function y1(n){Ks===null?Ks=[n]:Ks.push(n)}function MM(n){bp=!0,y1(n)}function No(){if(!py&&Ks!==null){py=!0;var n=0,e=ft;try{var t=Ks;for(ft=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Ks=null,bp=!1}catch(s){throw Ks!==null&&(Ks=Ks.slice(n+1)),BA(l_,No),s}finally{ft=e,py=!1}}return null}var xl=[],Sl=0,pm=null,gm=0,zr=[],qr=0,ha=null,Js=1,Xs="";function $o(n,e){xl[Sl++]=gm,xl[Sl++]=pm,pm=n,gm=e}function v1(n,e,t){zr[qr++]=Js,zr[qr++]=Xs,zr[qr++]=ha,ha=n;var r=Js;n=Xs;var s=32-ds(r)-1;r&=~(1<<s),t+=1;var i=32-ds(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Js=1<<32-ds(e)+s|t<<s|r,Xs=i+n}else Js=1<<i|t<<s|r,Xs=n}function y_(n){n.return!==null&&($o(n,1),v1(n,1,0))}function v_(n){for(;n===pm;)pm=xl[--Sl],xl[Sl]=null,gm=xl[--Sl],xl[Sl]=null;for(;n===ha;)ha=zr[--qr],zr[qr]=null,Xs=zr[--qr],zr[qr]=null,Js=zr[--qr],zr[qr]=null}var Rr=null,kr=null,Bt=!1,ls=null;function _1(n,e){var t=Gr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function CI(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Rr=n,kr=Zi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Rr=n,kr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ha!==null?{id:Js,overflow:Xs}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Gr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Rr=n,kr=null,!0):!1;default:return!1}}function R0(n){return(n.mode&1)!==0&&(n.flags&128)===0}function D0(n){if(Bt){var e=kr;if(e){var t=e;if(!CI(n,e)){if(R0(n))throw Error(K(418));e=Zi(t.nextSibling);var r=Rr;e&&CI(n,e)?_1(r,t):(n.flags=n.flags&-4097|2,Bt=!1,Rr=n)}}else{if(R0(n))throw Error(K(418));n.flags=n.flags&-4097|2,Bt=!1,Rr=n}}}function kI(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Rr=n}function rf(n){if(n!==Rr)return!1;if(!Bt)return kI(n),Bt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!A0(n.type,n.memoizedProps)),e&&(e=kr)){if(R0(n))throw w1(),Error(K(418));for(;e;)_1(n,e),e=Zi(e.nextSibling)}if(kI(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(K(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){kr=Zi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}kr=null}}else kr=Rr?Zi(n.stateNode.nextSibling):null;return!0}function w1(){for(var n=kr;n;)n=Zi(n.nextSibling)}function ql(){kr=Rr=null,Bt=!1}function __(n){ls===null?ls=[n]:ls.push(n)}var OM=yi.ReactCurrentBatchConfig;function tu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(K(309));var r=t.stateNode}if(!r)throw Error(K(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(K(284));if(!t._owner)throw Error(K(290,n))}return n}function sf(n,e){throw n=Object.prototype.toString.call(e),Error(K(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function RI(n){var e=n._init;return e(n._payload)}function x1(n){function e(x,I){if(n){var C=x.deletions;C===null?(x.deletions=[I],x.flags|=16):C.push(I)}}function t(x,I){if(!n)return null;for(;I!==null;)e(x,I),I=I.sibling;return null}function r(x,I){for(x=new Map;I!==null;)I.key!==null?x.set(I.key,I):x.set(I.index,I),I=I.sibling;return x}function s(x,I){return x=ro(x,I),x.index=0,x.sibling=null,x}function i(x,I,C){return x.index=C,n?(C=x.alternate,C!==null?(C=C.index,C<I?(x.flags|=2,I):C):(x.flags|=2,I)):(x.flags|=1048576,I)}function o(x){return n&&x.alternate===null&&(x.flags|=2),x}function a(x,I,C,P){return I===null||I.tag!==6?(I=Sy(C,x.mode,P),I.return=x,I):(I=s(I,C),I.return=x,I)}function c(x,I,C,P){var $=C.type;return $===pl?h(x,I,C.props.children,P,C.key):I!==null&&(I.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Pi&&RI($)===I.type)?(P=s(I,C.props),P.ref=tu(x,I,C),P.return=x,P):(P=Ff(C.type,C.key,C.props,null,x.mode,P),P.ref=tu(x,I,C),P.return=x,P)}function u(x,I,C,P){return I===null||I.tag!==4||I.stateNode.containerInfo!==C.containerInfo||I.stateNode.implementation!==C.implementation?(I=Iy(C,x.mode,P),I.return=x,I):(I=s(I,C.children||[]),I.return=x,I)}function h(x,I,C,P,$){return I===null||I.tag!==7?(I=ia(C,x.mode,P,$),I.return=x,I):(I=s(I,C),I.return=x,I)}function f(x,I,C){if(typeof I=="string"&&I!==""||typeof I=="number")return I=Sy(""+I,x.mode,C),I.return=x,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Hh:return C=Ff(I.type,I.key,I.props,null,x.mode,C),C.ref=tu(x,null,I),C.return=x,C;case ml:return I=Iy(I,x.mode,C),I.return=x,I;case Pi:var P=I._init;return f(x,P(I._payload),C)}if(yu(I)||Yc(I))return I=ia(I,x.mode,C,null),I.return=x,I;sf(x,I)}return null}function m(x,I,C,P){var $=I!==null?I.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return $!==null?null:a(x,I,""+C,P);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Hh:return C.key===$?c(x,I,C,P):null;case ml:return C.key===$?u(x,I,C,P):null;case Pi:return $=C._init,m(x,I,$(C._payload),P)}if(yu(C)||Yc(C))return $!==null?null:h(x,I,C,P,null);sf(x,C)}return null}function g(x,I,C,P,$){if(typeof P=="string"&&P!==""||typeof P=="number")return x=x.get(C)||null,a(I,x,""+P,$);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Hh:return x=x.get(P.key===null?C:P.key)||null,c(I,x,P,$);case ml:return x=x.get(P.key===null?C:P.key)||null,u(I,x,P,$);case Pi:var V=P._init;return g(x,I,C,V(P._payload),$)}if(yu(P)||Yc(P))return x=x.get(C)||null,h(I,x,P,$,null);sf(I,P)}return null}function v(x,I,C,P){for(var $=null,V=null,A=I,S=I=0,E=null;A!==null&&S<C.length;S++){A.index>S?(E=A,A=null):E=A.sibling;var N=m(x,A,C[S],P);if(N===null){A===null&&(A=E);break}n&&A&&N.alternate===null&&e(x,A),I=i(N,I,S),V===null?$=N:V.sibling=N,V=N,A=E}if(S===C.length)return t(x,A),Bt&&$o(x,S),$;if(A===null){for(;S<C.length;S++)A=f(x,C[S],P),A!==null&&(I=i(A,I,S),V===null?$=A:V.sibling=A,V=A);return Bt&&$o(x,S),$}for(A=r(x,A);S<C.length;S++)E=g(A,x,S,C[S],P),E!==null&&(n&&E.alternate!==null&&A.delete(E.key===null?S:E.key),I=i(E,I,S),V===null?$=E:V.sibling=E,V=E);return n&&A.forEach(function(k){return e(x,k)}),Bt&&$o(x,S),$}function _(x,I,C,P){var $=Yc(C);if(typeof $!="function")throw Error(K(150));if(C=$.call(C),C==null)throw Error(K(151));for(var V=$=null,A=I,S=I=0,E=null,N=C.next();A!==null&&!N.done;S++,N=C.next()){A.index>S?(E=A,A=null):E=A.sibling;var k=m(x,A,N.value,P);if(k===null){A===null&&(A=E);break}n&&A&&k.alternate===null&&e(x,A),I=i(k,I,S),V===null?$=k:V.sibling=k,V=k,A=E}if(N.done)return t(x,A),Bt&&$o(x,S),$;if(A===null){for(;!N.done;S++,N=C.next())N=f(x,N.value,P),N!==null&&(I=i(N,I,S),V===null?$=N:V.sibling=N,V=N);return Bt&&$o(x,S),$}for(A=r(x,A);!N.done;S++,N=C.next())N=g(A,x,S,N.value,P),N!==null&&(n&&N.alternate!==null&&A.delete(N.key===null?S:N.key),I=i(N,I,S),V===null?$=N:V.sibling=N,V=N);return n&&A.forEach(function(b){return e(x,b)}),Bt&&$o(x,S),$}function R(x,I,C,P){if(typeof C=="object"&&C!==null&&C.type===pl&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case Hh:e:{for(var $=C.key,V=I;V!==null;){if(V.key===$){if($=C.type,$===pl){if(V.tag===7){t(x,V.sibling),I=s(V,C.props.children),I.return=x,x=I;break e}}else if(V.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Pi&&RI($)===V.type){t(x,V.sibling),I=s(V,C.props),I.ref=tu(x,V,C),I.return=x,x=I;break e}t(x,V);break}else e(x,V);V=V.sibling}C.type===pl?(I=ia(C.props.children,x.mode,P,C.key),I.return=x,x=I):(P=Ff(C.type,C.key,C.props,null,x.mode,P),P.ref=tu(x,I,C),P.return=x,x=P)}return o(x);case ml:e:{for(V=C.key;I!==null;){if(I.key===V)if(I.tag===4&&I.stateNode.containerInfo===C.containerInfo&&I.stateNode.implementation===C.implementation){t(x,I.sibling),I=s(I,C.children||[]),I.return=x,x=I;break e}else{t(x,I);break}else e(x,I);I=I.sibling}I=Iy(C,x.mode,P),I.return=x,x=I}return o(x);case Pi:return V=C._init,R(x,I,V(C._payload),P)}if(yu(C))return v(x,I,C,P);if(Yc(C))return _(x,I,C,P);sf(x,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,I!==null&&I.tag===6?(t(x,I.sibling),I=s(I,C),I.return=x,x=I):(t(x,I),I=Sy(C,x.mode,P),I.return=x,x=I),o(x)):t(x,I)}return R}var Wl=x1(!0),S1=x1(!1),ym=Ao(null),vm=null,Il=null,w_=null;function x_(){w_=Il=vm=null}function S_(n){var e=ym.current;Lt(ym),n._currentValue=e}function P0(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function kl(n,e){vm=n,w_=Il=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(hr=!0),n.firstContext=null)}function Yr(n){var e=n._currentValue;if(w_!==n)if(n={context:n,memoizedValue:e,next:null},Il===null){if(vm===null)throw Error(K(308));Il=n,vm.dependencies={lanes:0,firstContext:n}}else Il=Il.next=n;return e}var Jo=null;function I_(n){Jo===null?Jo=[n]:Jo.push(n)}function I1(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,I_(e)):(t.next=s.next,s.next=t),e.interleaved=t,li(n,r)}function li(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ji=!1;function E_(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function E1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function si(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function eo(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,tt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,li(n,t)}return s=r.interleaved,s===null?(e.next=e,I_(r)):(e.next=s.next,s.next=e),r.interleaved=e,li(n,t)}function Pf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,c_(n,t)}}function DI(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function _m(n,e,t,r){var s=n.updateQueue;ji=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=c))}if(i!==null){var f=s.baseState;o=0,h=u=c=null,a=i;do{var m=a.lane,g=a.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=n,_=a;switch(m=e,g=t,_.tag){case 1:if(v=_.payload,typeof v=="function"){f=v.call(g,f,m);break e}f=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=_.payload,m=typeof v=="function"?v.call(g,f,m):v,m==null)break e;f=Zt({},f,m);break e;case 2:ji=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,m=s.effects,m===null?s.effects=[a]:m.push(a))}else g={eventTime:g,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=g,c=f):h=h.next=g,o|=m;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;m=a,a=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(1);if(h===null&&(c=f),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ma|=o,n.lanes=o,n.memoizedState=f}}function PI(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(K(191,s));s.call(r)}}}var Zd={},Ps=Ao(Zd),fd=Ao(Zd),md=Ao(Zd);function Xo(n){if(n===Zd)throw Error(K(174));return n}function b_(n,e){switch(Ct(md,e),Ct(fd,n),Ct(Ps,Zd),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:f0(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=f0(e,n)}Lt(Ps),Ct(Ps,e)}function Gl(){Lt(Ps),Lt(fd),Lt(md)}function b1(n){Xo(md.current);var e=Xo(Ps.current),t=f0(e,n.type);e!==t&&(Ct(fd,n),Ct(Ps,t))}function T_(n){fd.current===n&&(Lt(Ps),Lt(fd))}var Yt=Ao(0);function wm(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var gy=[];function A_(){for(var n=0;n<gy.length;n++)gy[n]._workInProgressVersionPrimary=null;gy.length=0}var jf=yi.ReactCurrentDispatcher,yy=yi.ReactCurrentBatchConfig,fa=0,Xt=null,Sn=null,Rn=null,xm=!1,Pu=!1,pd=0,LM=0;function Yn(){throw Error(K(321))}function N_(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!ps(n[t],e[t]))return!1;return!0}function C_(n,e,t,r,s,i){if(fa=i,Xt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,jf.current=n===null||n.memoizedState===null?UM:BM,n=t(r,s),Pu){i=0;do{if(Pu=!1,pd=0,25<=i)throw Error(K(301));i+=1,Rn=Sn=null,e.updateQueue=null,jf.current=zM,n=t(r,s)}while(Pu)}if(jf.current=Sm,e=Sn!==null&&Sn.next!==null,fa=0,Rn=Sn=Xt=null,xm=!1,e)throw Error(K(300));return n}function k_(){var n=pd!==0;return pd=0,n}function Is(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rn===null?Xt.memoizedState=Rn=n:Rn=Rn.next=n,Rn}function Jr(){if(Sn===null){var n=Xt.alternate;n=n!==null?n.memoizedState:null}else n=Sn.next;var e=Rn===null?Xt.memoizedState:Rn.next;if(e!==null)Rn=e,Sn=n;else{if(n===null)throw Error(K(310));Sn=n,n={memoizedState:Sn.memoizedState,baseState:Sn.baseState,baseQueue:Sn.baseQueue,queue:Sn.queue,next:null},Rn===null?Xt.memoizedState=Rn=n:Rn=Rn.next=n}return Rn}function gd(n,e){return typeof e=="function"?e(n):e}function vy(n){var e=Jr(),t=e.queue;if(t===null)throw Error(K(311));t.lastRenderedReducer=n;var r=Sn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,u=i;do{var h=u.lane;if((fa&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=f,o=r):c=c.next=f,Xt.lanes|=h,ma|=h}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=a,ps(r,e.memoizedState)||(hr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Xt.lanes|=i,ma|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function _y(n){var e=Jr(),t=e.queue;if(t===null)throw Error(K(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);ps(i,e.memoizedState)||(hr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function T1(){}function A1(n,e){var t=Xt,r=Jr(),s=e(),i=!ps(r.memoizedState,s);if(i&&(r.memoizedState=s,hr=!0),r=r.queue,R_(k1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Rn!==null&&Rn.memoizedState.tag&1){if(t.flags|=2048,yd(9,C1.bind(null,t,r,s,e),void 0,null),jn===null)throw Error(K(349));fa&30||N1(t,e,s)}return s}function N1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Xt.updateQueue,e===null?(e={lastEffect:null,stores:null},Xt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function C1(n,e,t,r){e.value=t,e.getSnapshot=r,R1(e)&&D1(n)}function k1(n,e,t){return t(function(){R1(e)&&D1(n)})}function R1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!ps(n,t)}catch{return!0}}function D1(n){var e=li(n,1);e!==null&&hs(e,n,1,-1)}function jI(n){var e=Is();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gd,lastRenderedState:n},e.queue=n,n=n.dispatch=$M.bind(null,Xt,n),[e.memoizedState,n]}function yd(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Xt.updateQueue,e===null?(e={lastEffect:null,stores:null},Xt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function P1(){return Jr().memoizedState}function Mf(n,e,t,r){var s=Is();Xt.flags|=n,s.memoizedState=yd(1|e,t,void 0,r===void 0?null:r)}function Tp(n,e,t,r){var s=Jr();r=r===void 0?null:r;var i=void 0;if(Sn!==null){var o=Sn.memoizedState;if(i=o.destroy,r!==null&&N_(r,o.deps)){s.memoizedState=yd(e,t,i,r);return}}Xt.flags|=n,s.memoizedState=yd(1|e,t,i,r)}function MI(n,e){return Mf(8390656,8,n,e)}function R_(n,e){return Tp(2048,8,n,e)}function j1(n,e){return Tp(4,2,n,e)}function M1(n,e){return Tp(4,4,n,e)}function O1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function L1(n,e,t){return t=t!=null?t.concat([n]):null,Tp(4,4,O1.bind(null,e,n),t)}function D_(){}function V1(n,e){var t=Jr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&N_(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function F1(n,e){var t=Jr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&N_(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function $1(n,e,t){return fa&21?(ps(t,e)||(t=WA(),Xt.lanes|=t,ma|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,hr=!0),n.memoizedState=t)}function VM(n,e){var t=ft;ft=t!==0&&4>t?t:4,n(!0);var r=yy.transition;yy.transition={};try{n(!1),e()}finally{ft=t,yy.transition=r}}function U1(){return Jr().memoizedState}function FM(n,e,t){var r=no(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},B1(n))z1(e,t);else if(t=I1(n,e,t,r),t!==null){var s=ar();hs(t,n,r,s),q1(t,e,r)}}function $M(n,e,t){var r=no(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(B1(n))z1(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,ps(a,o)){var c=e.interleaved;c===null?(s.next=s,I_(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=I1(n,e,s,r),t!==null&&(s=ar(),hs(t,n,r,s),q1(t,e,r))}}function B1(n){var e=n.alternate;return n===Xt||e!==null&&e===Xt}function z1(n,e){Pu=xm=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function q1(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,c_(n,t)}}var Sm={readContext:Yr,useCallback:Yn,useContext:Yn,useEffect:Yn,useImperativeHandle:Yn,useInsertionEffect:Yn,useLayoutEffect:Yn,useMemo:Yn,useReducer:Yn,useRef:Yn,useState:Yn,useDebugValue:Yn,useDeferredValue:Yn,useTransition:Yn,useMutableSource:Yn,useSyncExternalStore:Yn,useId:Yn,unstable_isNewReconciler:!1},UM={readContext:Yr,useCallback:function(n,e){return Is().memoizedState=[n,e===void 0?null:e],n},useContext:Yr,useEffect:MI,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Mf(4194308,4,O1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Mf(4194308,4,n,e)},useInsertionEffect:function(n,e){return Mf(4,2,n,e)},useMemo:function(n,e){var t=Is();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Is();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=FM.bind(null,Xt,n),[r.memoizedState,n]},useRef:function(n){var e=Is();return n={current:n},e.memoizedState=n},useState:jI,useDebugValue:D_,useDeferredValue:function(n){return Is().memoizedState=n},useTransition:function(){var n=jI(!1),e=n[0];return n=VM.bind(null,n[1]),Is().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Xt,s=Is();if(Bt){if(t===void 0)throw Error(K(407));t=t()}else{if(t=e(),jn===null)throw Error(K(349));fa&30||N1(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,MI(k1.bind(null,r,i,n),[n]),r.flags|=2048,yd(9,C1.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Is(),e=jn.identifierPrefix;if(Bt){var t=Xs,r=Js;t=(r&~(1<<32-ds(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=pd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=LM++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},BM={readContext:Yr,useCallback:V1,useContext:Yr,useEffect:R_,useImperativeHandle:L1,useInsertionEffect:j1,useLayoutEffect:M1,useMemo:F1,useReducer:vy,useRef:P1,useState:function(){return vy(gd)},useDebugValue:D_,useDeferredValue:function(n){var e=Jr();return $1(e,Sn.memoizedState,n)},useTransition:function(){var n=vy(gd)[0],e=Jr().memoizedState;return[n,e]},useMutableSource:T1,useSyncExternalStore:A1,useId:U1,unstable_isNewReconciler:!1},zM={readContext:Yr,useCallback:V1,useContext:Yr,useEffect:R_,useImperativeHandle:L1,useInsertionEffect:j1,useLayoutEffect:M1,useMemo:F1,useReducer:_y,useRef:P1,useState:function(){return _y(gd)},useDebugValue:D_,useDeferredValue:function(n){var e=Jr();return Sn===null?e.memoizedState=n:$1(e,Sn.memoizedState,n)},useTransition:function(){var n=_y(gd)[0],e=Jr().memoizedState;return[n,e]},useMutableSource:T1,useSyncExternalStore:A1,useId:U1,unstable_isNewReconciler:!1};function is(n,e){if(n&&n.defaultProps){e=Zt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function j0(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Zt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ap={isMounted:function(n){return(n=n._reactInternals)?ja(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=ar(),s=no(n),i=si(r,s);i.payload=e,t!=null&&(i.callback=t),e=eo(n,i,s),e!==null&&(hs(e,n,s,r),Pf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=ar(),s=no(n),i=si(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=eo(n,i,s),e!==null&&(hs(e,n,s,r),Pf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=ar(),r=no(n),s=si(t,r);s.tag=2,e!=null&&(s.callback=e),e=eo(n,s,r),e!==null&&(hs(e,n,r,t),Pf(e,n,r))}};function OI(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!cd(t,r)||!cd(s,i):!0}function W1(n,e,t){var r=!1,s=fo,i=e.contextType;return typeof i=="object"&&i!==null?i=Yr(i):(s=yr(e)?da:sr.current,r=e.contextTypes,i=(r=r!=null)?zl(n,s):fo),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ap,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function LI(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ap.enqueueReplaceState(e,e.state,null)}function M0(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},E_(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Yr(i):(i=yr(e)?da:sr.current,s.context=zl(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(j0(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Ap.enqueueReplaceState(s,s.state,null),_m(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Hl(n,e){try{var t="",r=e;do t+=yj(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function wy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function O0(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var qM=typeof WeakMap=="function"?WeakMap:Map;function G1(n,e,t){t=si(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Em||(Em=!0,G0=r),O0(n,e)},t}function H1(n,e,t){t=si(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){O0(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){O0(n,e),typeof r!="function"&&(to===null?to=new Set([this]):to.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function VI(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new qM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=sO.bind(null,n,e,t),e.then(n,n))}function FI(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function $I(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=si(-1,1),e.tag=2,eo(t,e,1))),t.lanes|=1),n)}var WM=yi.ReactCurrentOwner,hr=!1;function ir(n,e,t,r){e.child=n===null?S1(e,null,t,r):Wl(e,n.child,t,r)}function UI(n,e,t,r,s){t=t.render;var i=e.ref;return kl(e,s),r=C_(n,e,t,r,i,s),t=k_(),n!==null&&!hr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ci(n,e,s)):(Bt&&t&&y_(e),e.flags|=1,ir(n,e,r,s),e.child)}function BI(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!$_(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Q1(n,e,i,r,s)):(n=Ff(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:cd,t(o,r)&&n.ref===e.ref)return ci(n,e,s)}return e.flags|=1,n=ro(i,r),n.ref=e.ref,n.return=e,e.child=n}function Q1(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(cd(i,r)&&n.ref===e.ref)if(hr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(hr=!0);else return e.lanes=n.lanes,ci(n,e,s)}return L0(n,e,t,r,s)}function K1(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ct(bl,br),br|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ct(bl,br),br|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Ct(bl,br),br|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Ct(bl,br),br|=r;return ir(n,e,s,t),e.child}function Y1(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function L0(n,e,t,r,s){var i=yr(t)?da:sr.current;return i=zl(e,i),kl(e,s),t=C_(n,e,t,r,i,s),r=k_(),n!==null&&!hr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ci(n,e,s)):(Bt&&r&&y_(e),e.flags|=1,ir(n,e,t,s),e.child)}function zI(n,e,t,r,s){if(yr(t)){var i=!0;mm(e)}else i=!1;if(kl(e,s),e.stateNode===null)Of(n,e),W1(e,t,r),M0(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Yr(u):(u=yr(t)?da:sr.current,u=zl(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==u)&&LI(e,o,r,u),ji=!1;var m=e.memoizedState;o.state=m,_m(e,r,o,s),c=e.memoizedState,a!==r||m!==c||gr.current||ji?(typeof h=="function"&&(j0(e,t,h,r),c=e.memoizedState),(a=ji||OI(e,t,a,r,m,c,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,E1(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:is(e.type,a),o.props=u,f=e.pendingProps,m=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Yr(c):(c=yr(t)?da:sr.current,c=zl(e,c));var g=t.getDerivedStateFromProps;(h=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||m!==c)&&LI(e,o,r,c),ji=!1,m=e.memoizedState,o.state=m,_m(e,r,o,s);var v=e.memoizedState;a!==f||m!==v||gr.current||ji?(typeof g=="function"&&(j0(e,t,g,r),v=e.memoizedState),(u=ji||OI(e,t,u,r,m,v,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,v,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,v,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=v),o.props=r,o.state=v,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),r=!1)}return V0(n,e,t,r,i,s)}function V0(n,e,t,r,s,i){Y1(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&NI(e,t,!1),ci(n,e,i);r=e.stateNode,WM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Wl(e,n.child,null,i),e.child=Wl(e,null,a,i)):ir(n,e,a,i),e.memoizedState=r.state,s&&NI(e,t,!0),e.child}function J1(n){var e=n.stateNode;e.pendingContext?AI(n,e.pendingContext,e.pendingContext!==e.context):e.context&&AI(n,e.context,!1),b_(n,e.containerInfo)}function qI(n,e,t,r,s){return ql(),__(s),e.flags|=256,ir(n,e,t,r),e.child}var F0={dehydrated:null,treeContext:null,retryLane:0};function $0(n){return{baseLanes:n,cachePool:null,transitions:null}}function X1(n,e,t){var r=e.pendingProps,s=Yt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Ct(Yt,s&1),n===null)return D0(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=kp(o,r,0,null),n=ia(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=$0(t),e.memoizedState=F0,n):P_(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return GM(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ro(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=ro(a,i):(i=ia(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?$0(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=F0,r}return i=n.child,n=i.sibling,r=ro(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function P_(n,e){return e=kp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function of(n,e,t,r){return r!==null&&__(r),Wl(e,n.child,null,t),n=P_(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function GM(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=wy(Error(K(422))),of(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=kp({mode:"visible",children:r.children},s,0,null),i=ia(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Wl(e,n.child,null,o),e.child.memoizedState=$0(o),e.memoizedState=F0,i);if(!(e.mode&1))return of(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(K(419)),r=wy(i,r,void 0),of(n,e,o,r)}if(a=(o&n.childLanes)!==0,hr||a){if(r=jn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,li(n,s),hs(r,n,s,-1))}return F_(),r=wy(Error(K(421))),of(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=iO.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,kr=Zi(s.nextSibling),Rr=e,Bt=!0,ls=null,n!==null&&(zr[qr++]=Js,zr[qr++]=Xs,zr[qr++]=ha,Js=n.id,Xs=n.overflow,ha=e),e=P_(e,r.children),e.flags|=4096,e)}function WI(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),P0(n.return,e,t)}function xy(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function Z1(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(ir(n,e,r.children,t),r=Yt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&WI(n,t,e);else if(n.tag===19)WI(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Ct(Yt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&wm(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),xy(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&wm(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}xy(e,!0,t,null,i);break;case"together":xy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Of(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ci(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ma|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(K(153));if(e.child!==null){for(n=e.child,t=ro(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ro(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function HM(n,e,t){switch(e.tag){case 3:J1(e),ql();break;case 5:b1(e);break;case 1:yr(e.type)&&mm(e);break;case 4:b_(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ct(ym,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ct(Yt,Yt.current&1),e.flags|=128,null):t&e.child.childLanes?X1(n,e,t):(Ct(Yt,Yt.current&1),n=ci(n,e,t),n!==null?n.sibling:null);Ct(Yt,Yt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Z1(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ct(Yt,Yt.current),r)break;return null;case 22:case 23:return e.lanes=0,K1(n,e,t)}return ci(n,e,t)}var eN,U0,tN,nN;eN=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};U0=function(){};tN=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Xo(Ps.current);var i=null;switch(t){case"input":s=c0(n,s),r=c0(n,r),i=[];break;case"select":s=Zt({},s,{value:void 0}),r=Zt({},r,{value:void 0}),i=[];break;case"textarea":s=h0(n,s),r=h0(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=hm)}m0(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(nd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(i||(i=[]),i.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(nd.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Mt("scroll",n),i||a===c||(i=[])):(i=i||[]).push(u,c))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};nN=function(n,e,t,r){t!==r&&(e.flags|=4)};function nu(n,e){if(!Bt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Jn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function QM(n,e,t){var r=e.pendingProps;switch(v_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jn(e),null;case 1:return yr(e.type)&&fm(),Jn(e),null;case 3:return r=e.stateNode,Gl(),Lt(gr),Lt(sr),A_(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(rf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ls!==null&&(K0(ls),ls=null))),U0(n,e),Jn(e),null;case 5:T_(e);var s=Xo(md.current);if(t=e.type,n!==null&&e.stateNode!=null)tN(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(K(166));return Jn(e),null}if(n=Xo(Ps.current),rf(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Ts]=e,r[hd]=i,n=(e.mode&1)!==0,t){case"dialog":Mt("cancel",r),Mt("close",r);break;case"iframe":case"object":case"embed":Mt("load",r);break;case"video":case"audio":for(s=0;s<_u.length;s++)Mt(_u[s],r);break;case"source":Mt("error",r);break;case"img":case"image":case"link":Mt("error",r),Mt("load",r);break;case"details":Mt("toggle",r);break;case"input":eI(r,i),Mt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Mt("invalid",r);break;case"textarea":nI(r,i),Mt("invalid",r)}m0(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&nf(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&nf(r.textContent,a,n),s=["children",""+a]):nd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Mt("scroll",r)}switch(t){case"input":Qh(r),tI(r,i,!0);break;case"textarea":Qh(r),rI(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=hm)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=kA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Ts]=e,n[hd]=r,eN(n,e,!1,!1),e.stateNode=n;e:{switch(o=p0(t,r),t){case"dialog":Mt("cancel",n),Mt("close",n),s=r;break;case"iframe":case"object":case"embed":Mt("load",n),s=r;break;case"video":case"audio":for(s=0;s<_u.length;s++)Mt(_u[s],n);s=r;break;case"source":Mt("error",n),s=r;break;case"img":case"image":case"link":Mt("error",n),Mt("load",n),s=r;break;case"details":Mt("toggle",n),s=r;break;case"input":eI(n,r),s=c0(n,r),Mt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Zt({},r,{value:void 0}),Mt("invalid",n);break;case"textarea":nI(n,r),s=h0(n,r),Mt("invalid",n);break;default:s=r}m0(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?PA(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&RA(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&rd(n,c):typeof c=="number"&&rd(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(nd.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Mt("scroll",n):c!=null&&r_(n,i,c,o))}switch(t){case"input":Qh(n),tI(n,r,!1);break;case"textarea":Qh(n),rI(n);break;case"option":r.value!=null&&n.setAttribute("value",""+ho(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Tl(n,!!r.multiple,i,!1):r.defaultValue!=null&&Tl(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=hm)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Jn(e),null;case 6:if(n&&e.stateNode!=null)nN(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(K(166));if(t=Xo(md.current),Xo(Ps.current),rf(e)){if(r=e.stateNode,t=e.memoizedProps,r[Ts]=e,(i=r.nodeValue!==t)&&(n=Rr,n!==null))switch(n.tag){case 3:nf(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&nf(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Ts]=e,e.stateNode=r}return Jn(e),null;case 13:if(Lt(Yt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Bt&&kr!==null&&e.mode&1&&!(e.flags&128))w1(),ql(),e.flags|=98560,i=!1;else if(i=rf(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(K(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(K(317));i[Ts]=e}else ql(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Jn(e),i=!1}else ls!==null&&(K0(ls),ls=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Yt.current&1?En===0&&(En=3):F_())),e.updateQueue!==null&&(e.flags|=4),Jn(e),null);case 4:return Gl(),U0(n,e),n===null&&ud(e.stateNode.containerInfo),Jn(e),null;case 10:return S_(e.type._context),Jn(e),null;case 17:return yr(e.type)&&fm(),Jn(e),null;case 19:if(Lt(Yt),i=e.memoizedState,i===null)return Jn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)nu(i,!1);else{if(En!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=wm(n),o!==null){for(e.flags|=128,nu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ct(Yt,Yt.current&1|2),e.child}n=n.sibling}i.tail!==null&&dn()>Ql&&(e.flags|=128,r=!0,nu(i,!1),e.lanes=4194304)}else{if(!r)if(n=wm(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),nu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Bt)return Jn(e),null}else 2*dn()-i.renderingStartTime>Ql&&t!==1073741824&&(e.flags|=128,r=!0,nu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=dn(),e.sibling=null,t=Yt.current,Ct(Yt,r?t&1|2:t&1),e):(Jn(e),null);case 22:case 23:return V_(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?br&1073741824&&(Jn(e),e.subtreeFlags&6&&(e.flags|=8192)):Jn(e),null;case 24:return null;case 25:return null}throw Error(K(156,e.tag))}function KM(n,e){switch(v_(e),e.tag){case 1:return yr(e.type)&&fm(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Gl(),Lt(gr),Lt(sr),A_(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return T_(e),null;case 13:if(Lt(Yt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(K(340));ql()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Lt(Yt),null;case 4:return Gl(),null;case 10:return S_(e.type._context),null;case 22:case 23:return V_(),null;case 24:return null;default:return null}}var af=!1,er=!1,YM=typeof WeakSet=="function"?WeakSet:Set,ue=null;function El(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){an(n,e,r)}else t.current=null}function B0(n,e,t){try{t()}catch(r){an(n,e,r)}}var GI=!1;function JM(n,e){if(b0=cm,n=a1(),g_(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,u=0,h=0,f=n,m=null;t:for(;;){for(var g;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(c=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(g=f.firstChild)!==null;)m=f,f=g;for(;;){if(f===n)break t;if(m===t&&++u===s&&(a=o),m===i&&++h===r&&(c=o),(g=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=g}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(T0={focusedElem:n,selectionRange:t},cm=!1,ue=e;ue!==null;)if(e=ue,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ue=n;else for(;ue!==null;){e=ue;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var _=v.memoizedProps,R=v.memoizedState,x=e.stateNode,I=x.getSnapshotBeforeUpdate(e.elementType===e.type?_:is(e.type,_),R);x.__reactInternalSnapshotBeforeUpdate=I}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(P){an(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,ue=n;break}ue=e.return}return v=GI,GI=!1,v}function ju(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&B0(e,t,i)}s=s.next}while(s!==r)}}function Np(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function z0(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function rN(n){var e=n.alternate;e!==null&&(n.alternate=null,rN(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ts],delete e[hd],delete e[C0],delete e[PM],delete e[jM])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function sN(n){return n.tag===5||n.tag===3||n.tag===4}function HI(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||sN(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function q0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=hm));else if(r!==4&&(n=n.child,n!==null))for(q0(n,e,t),n=n.sibling;n!==null;)q0(n,e,t),n=n.sibling}function W0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(W0(n,e,t),n=n.sibling;n!==null;)W0(n,e,t),n=n.sibling}var Bn=null,os=!1;function Ni(n,e,t){for(t=t.child;t!==null;)iN(n,e,t),t=t.sibling}function iN(n,e,t){if(Ds&&typeof Ds.onCommitFiberUnmount=="function")try{Ds.onCommitFiberUnmount(wp,t)}catch{}switch(t.tag){case 5:er||El(t,e);case 6:var r=Bn,s=os;Bn=null,Ni(n,e,t),Bn=r,os=s,Bn!==null&&(os?(n=Bn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Bn.removeChild(t.stateNode));break;case 18:Bn!==null&&(os?(n=Bn,t=t.stateNode,n.nodeType===8?my(n.parentNode,t):n.nodeType===1&&my(n,t),ad(n)):my(Bn,t.stateNode));break;case 4:r=Bn,s=os,Bn=t.stateNode.containerInfo,os=!0,Ni(n,e,t),Bn=r,os=s;break;case 0:case 11:case 14:case 15:if(!er&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&B0(t,e,o),s=s.next}while(s!==r)}Ni(n,e,t);break;case 1:if(!er&&(El(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){an(t,e,a)}Ni(n,e,t);break;case 21:Ni(n,e,t);break;case 22:t.mode&1?(er=(r=er)||t.memoizedState!==null,Ni(n,e,t),er=r):Ni(n,e,t);break;default:Ni(n,e,t)}}function QI(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new YM),e.forEach(function(r){var s=oO.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function ss(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Bn=a.stateNode,os=!1;break e;case 3:Bn=a.stateNode.containerInfo,os=!0;break e;case 4:Bn=a.stateNode.containerInfo,os=!0;break e}a=a.return}if(Bn===null)throw Error(K(160));iN(i,o,s),Bn=null,os=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){an(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oN(e,n),e=e.sibling}function oN(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ss(e,n),Ss(n),r&4){try{ju(3,n,n.return),Np(3,n)}catch(_){an(n,n.return,_)}try{ju(5,n,n.return)}catch(_){an(n,n.return,_)}}break;case 1:ss(e,n),Ss(n),r&512&&t!==null&&El(t,t.return);break;case 5:if(ss(e,n),Ss(n),r&512&&t!==null&&El(t,t.return),n.flags&32){var s=n.stateNode;try{rd(s,"")}catch(_){an(n,n.return,_)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&NA(s,i),p0(a,o);var u=p0(a,i);for(o=0;o<c.length;o+=2){var h=c[o],f=c[o+1];h==="style"?PA(s,f):h==="dangerouslySetInnerHTML"?RA(s,f):h==="children"?rd(s,f):r_(s,h,f,u)}switch(a){case"input":u0(s,i);break;case"textarea":CA(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var g=i.value;g!=null?Tl(s,!!i.multiple,g,!1):m!==!!i.multiple&&(i.defaultValue!=null?Tl(s,!!i.multiple,i.defaultValue,!0):Tl(s,!!i.multiple,i.multiple?[]:"",!1))}s[hd]=i}catch(_){an(n,n.return,_)}}break;case 6:if(ss(e,n),Ss(n),r&4){if(n.stateNode===null)throw Error(K(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(_){an(n,n.return,_)}}break;case 3:if(ss(e,n),Ss(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{ad(e.containerInfo)}catch(_){an(n,n.return,_)}break;case 4:ss(e,n),Ss(n);break;case 13:ss(e,n),Ss(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(O_=dn())),r&4&&QI(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(er=(u=er)||h,ss(e,n),er=u):ss(e,n),Ss(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(ue=n,h=n.child;h!==null;){for(f=ue=h;ue!==null;){switch(m=ue,g=m.child,m.tag){case 0:case 11:case 14:case 15:ju(4,m,m.return);break;case 1:El(m,m.return);var v=m.stateNode;if(typeof v.componentWillUnmount=="function"){r=m,t=m.return;try{e=r,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(_){an(r,t,_)}}break;case 5:El(m,m.return);break;case 22:if(m.memoizedState!==null){YI(f);continue}}g!==null?(g.return=m,ue=g):YI(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=DA("display",o))}catch(_){an(n,n.return,_)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(_){an(n,n.return,_)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ss(e,n),Ss(n),r&4&&QI(n);break;case 21:break;default:ss(e,n),Ss(n)}}function Ss(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(sN(t)){var r=t;break e}t=t.return}throw Error(K(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(rd(s,""),r.flags&=-33);var i=HI(n);W0(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=HI(n);q0(n,a,o);break;default:throw Error(K(161))}}catch(c){an(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function XM(n,e,t){ue=n,aN(n)}function aN(n,e,t){for(var r=(n.mode&1)!==0;ue!==null;){var s=ue,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||af;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||er;a=af;var u=er;if(af=o,(er=c)&&!u)for(ue=s;ue!==null;)o=ue,c=o.child,o.tag===22&&o.memoizedState!==null?JI(s):c!==null?(c.return=o,ue=c):JI(s);for(;i!==null;)ue=i,aN(i),i=i.sibling;ue=s,af=a,er=u}KI(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ue=i):KI(n)}}function KI(n){for(;ue!==null;){var e=ue;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:er||Np(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!er)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:is(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&PI(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}PI(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&ad(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}er||e.flags&512&&z0(e)}catch(m){an(e,e.return,m)}}if(e===n){ue=null;break}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}}function YI(n){for(;ue!==null;){var e=ue;if(e===n){ue=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ue=t;break}ue=e.return}}function JI(n){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Np(4,e)}catch(c){an(e,t,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){an(e,s,c)}}var i=e.return;try{z0(e)}catch(c){an(e,i,c)}break;case 5:var o=e.return;try{z0(e)}catch(c){an(e,o,c)}}}catch(c){an(e,e.return,c)}if(e===n){ue=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ue=a;break}ue=e.return}}var ZM=Math.ceil,Im=yi.ReactCurrentDispatcher,j_=yi.ReactCurrentOwner,Qr=yi.ReactCurrentBatchConfig,tt=0,jn=null,_n=null,Wn=0,br=0,bl=Ao(0),En=0,vd=null,ma=0,Cp=0,M_=0,Mu=null,dr=null,O_=0,Ql=1/0,Qs=null,Em=!1,G0=null,to=null,lf=!1,zi=null,bm=0,Ou=0,H0=null,Lf=-1,Vf=0;function ar(){return tt&6?dn():Lf!==-1?Lf:Lf=dn()}function no(n){return n.mode&1?tt&2&&Wn!==0?Wn&-Wn:OM.transition!==null?(Vf===0&&(Vf=WA()),Vf):(n=ft,n!==0||(n=window.event,n=n===void 0?16:XA(n.type)),n):1}function hs(n,e,t,r){if(50<Ou)throw Ou=0,H0=null,Error(K(185));Yd(n,t,r),(!(tt&2)||n!==jn)&&(n===jn&&(!(tt&2)&&(Cp|=t),En===4&&Oi(n,Wn)),vr(n,r),t===1&&tt===0&&!(e.mode&1)&&(Ql=dn()+500,bp&&No()))}function vr(n,e){var t=n.callbackNode;Oj(n,e);var r=lm(n,n===jn?Wn:0);if(r===0)t!==null&&oI(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&oI(t),e===1)n.tag===0?MM(XI.bind(null,n)):y1(XI.bind(null,n)),RM(function(){!(tt&6)&&No()}),t=null;else{switch(GA(r)){case 1:t=l_;break;case 4:t=zA;break;case 16:t=am;break;case 536870912:t=qA;break;default:t=am}t=pN(t,lN.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function lN(n,e){if(Lf=-1,Vf=0,tt&6)throw Error(K(327));var t=n.callbackNode;if(Rl()&&n.callbackNode!==t)return null;var r=lm(n,n===jn?Wn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Tm(n,r);else{e=r;var s=tt;tt|=2;var i=uN();(jn!==n||Wn!==e)&&(Qs=null,Ql=dn()+500,sa(n,e));do try{nO();break}catch(a){cN(n,a)}while(1);x_(),Im.current=i,tt=s,_n!==null?e=0:(jn=null,Wn=0,e=En)}if(e!==0){if(e===2&&(s=w0(n),s!==0&&(r=s,e=Q0(n,s))),e===1)throw t=vd,sa(n,0),Oi(n,r),vr(n,dn()),t;if(e===6)Oi(n,r);else{if(s=n.current.alternate,!(r&30)&&!eO(s)&&(e=Tm(n,r),e===2&&(i=w0(n),i!==0&&(r=i,e=Q0(n,i))),e===1))throw t=vd,sa(n,0),Oi(n,r),vr(n,dn()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(K(345));case 2:Uo(n,dr,Qs);break;case 3:if(Oi(n,r),(r&130023424)===r&&(e=O_+500-dn(),10<e)){if(lm(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){ar(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=N0(Uo.bind(null,n,dr,Qs),e);break}Uo(n,dr,Qs);break;case 4:if(Oi(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-ds(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=dn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ZM(r/1960))-r,10<r){n.timeoutHandle=N0(Uo.bind(null,n,dr,Qs),r);break}Uo(n,dr,Qs);break;case 5:Uo(n,dr,Qs);break;default:throw Error(K(329))}}}return vr(n,dn()),n.callbackNode===t?lN.bind(null,n):null}function Q0(n,e){var t=Mu;return n.current.memoizedState.isDehydrated&&(sa(n,e).flags|=256),n=Tm(n,e),n!==2&&(e=dr,dr=t,e!==null&&K0(e)),n}function K0(n){dr===null?dr=n:dr.push.apply(dr,n)}function eO(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!ps(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Oi(n,e){for(e&=~M_,e&=~Cp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ds(e),r=1<<t;n[t]=-1,e&=~r}}function XI(n){if(tt&6)throw Error(K(327));Rl();var e=lm(n,0);if(!(e&1))return vr(n,dn()),null;var t=Tm(n,e);if(n.tag!==0&&t===2){var r=w0(n);r!==0&&(e=r,t=Q0(n,r))}if(t===1)throw t=vd,sa(n,0),Oi(n,e),vr(n,dn()),t;if(t===6)throw Error(K(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Uo(n,dr,Qs),vr(n,dn()),null}function L_(n,e){var t=tt;tt|=1;try{return n(e)}finally{tt=t,tt===0&&(Ql=dn()+500,bp&&No())}}function pa(n){zi!==null&&zi.tag===0&&!(tt&6)&&Rl();var e=tt;tt|=1;var t=Qr.transition,r=ft;try{if(Qr.transition=null,ft=1,n)return n()}finally{ft=r,Qr.transition=t,tt=e,!(tt&6)&&No()}}function V_(){br=bl.current,Lt(bl)}function sa(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,kM(t)),_n!==null)for(t=_n.return;t!==null;){var r=t;switch(v_(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&fm();break;case 3:Gl(),Lt(gr),Lt(sr),A_();break;case 5:T_(r);break;case 4:Gl();break;case 13:Lt(Yt);break;case 19:Lt(Yt);break;case 10:S_(r.type._context);break;case 22:case 23:V_()}t=t.return}if(jn=n,_n=n=ro(n.current,null),Wn=br=e,En=0,vd=null,M_=Cp=ma=0,dr=Mu=null,Jo!==null){for(e=0;e<Jo.length;e++)if(t=Jo[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Jo=null}return n}function cN(n,e){do{var t=_n;try{if(x_(),jf.current=Sm,xm){for(var r=Xt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}xm=!1}if(fa=0,Rn=Sn=Xt=null,Pu=!1,pd=0,j_.current=null,t===null||t.return===null){En=1,vd=e,_n=null;break}e:{var i=n,o=t.return,a=t,c=e;if(e=Wn,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var g=FI(o);if(g!==null){g.flags&=-257,$I(g,o,a,i,e),g.mode&1&&VI(i,u,e),e=g,c=u;var v=e.updateQueue;if(v===null){var _=new Set;_.add(c),e.updateQueue=_}else v.add(c);break e}else{if(!(e&1)){VI(i,u,e),F_();break e}c=Error(K(426))}}else if(Bt&&a.mode&1){var R=FI(o);if(R!==null){!(R.flags&65536)&&(R.flags|=256),$I(R,o,a,i,e),__(Hl(c,a));break e}}i=c=Hl(c,a),En!==4&&(En=2),Mu===null?Mu=[i]:Mu.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=G1(i,c,e);DI(i,x);break e;case 1:a=c;var I=i.type,C=i.stateNode;if(!(i.flags&128)&&(typeof I.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(to===null||!to.has(C)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=H1(i,a,e);DI(i,P);break e}}i=i.return}while(i!==null)}hN(t)}catch($){e=$,_n===t&&t!==null&&(_n=t=t.return);continue}break}while(1)}function uN(){var n=Im.current;return Im.current=Sm,n===null?Sm:n}function F_(){(En===0||En===3||En===2)&&(En=4),jn===null||!(ma&268435455)&&!(Cp&268435455)||Oi(jn,Wn)}function Tm(n,e){var t=tt;tt|=2;var r=uN();(jn!==n||Wn!==e)&&(Qs=null,sa(n,e));do try{tO();break}catch(s){cN(n,s)}while(1);if(x_(),tt=t,Im.current=r,_n!==null)throw Error(K(261));return jn=null,Wn=0,En}function tO(){for(;_n!==null;)dN(_n)}function nO(){for(;_n!==null&&!Aj();)dN(_n)}function dN(n){var e=mN(n.alternate,n,br);n.memoizedProps=n.pendingProps,e===null?hN(n):_n=e,j_.current=null}function hN(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=KM(t,e),t!==null){t.flags&=32767,_n=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{En=6,_n=null;return}}else if(t=QM(t,e,br),t!==null){_n=t;return}if(e=e.sibling,e!==null){_n=e;return}_n=e=n}while(e!==null);En===0&&(En=5)}function Uo(n,e,t){var r=ft,s=Qr.transition;try{Qr.transition=null,ft=1,rO(n,e,t,r)}finally{Qr.transition=s,ft=r}return null}function rO(n,e,t,r){do Rl();while(zi!==null);if(tt&6)throw Error(K(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(K(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(Lj(n,i),n===jn&&(_n=jn=null,Wn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||lf||(lf=!0,pN(am,function(){return Rl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Qr.transition,Qr.transition=null;var o=ft;ft=1;var a=tt;tt|=4,j_.current=null,JM(n,t),oN(t,n),IM(T0),cm=!!b0,T0=b0=null,n.current=t,XM(t),Nj(),tt=a,ft=o,Qr.transition=i}else n.current=t;if(lf&&(lf=!1,zi=n,bm=s),i=n.pendingLanes,i===0&&(to=null),Rj(t.stateNode),vr(n,dn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Em)throw Em=!1,n=G0,G0=null,n;return bm&1&&n.tag!==0&&Rl(),i=n.pendingLanes,i&1?n===H0?Ou++:(Ou=0,H0=n):Ou=0,No(),null}function Rl(){if(zi!==null){var n=GA(bm),e=Qr.transition,t=ft;try{if(Qr.transition=null,ft=16>n?16:n,zi===null)var r=!1;else{if(n=zi,zi=null,bm=0,tt&6)throw Error(K(331));var s=tt;for(tt|=4,ue=n.current;ue!==null;){var i=ue,o=i.child;if(ue.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(ue=u;ue!==null;){var h=ue;switch(h.tag){case 0:case 11:case 15:ju(8,h,i)}var f=h.child;if(f!==null)f.return=h,ue=f;else for(;ue!==null;){h=ue;var m=h.sibling,g=h.return;if(rN(h),h===u){ue=null;break}if(m!==null){m.return=g,ue=m;break}ue=g}}}var v=i.alternate;if(v!==null){var _=v.child;if(_!==null){v.child=null;do{var R=_.sibling;_.sibling=null,_=R}while(_!==null)}}ue=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ue=o;else e:for(;ue!==null;){if(i=ue,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ju(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,ue=x;break e}ue=i.return}}var I=n.current;for(ue=I;ue!==null;){o=ue;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,ue=C;else e:for(o=I;ue!==null;){if(a=ue,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Np(9,a)}}catch($){an(a,a.return,$)}if(a===o){ue=null;break e}var P=a.sibling;if(P!==null){P.return=a.return,ue=P;break e}ue=a.return}}if(tt=s,No(),Ds&&typeof Ds.onPostCommitFiberRoot=="function")try{Ds.onPostCommitFiberRoot(wp,n)}catch{}r=!0}return r}finally{ft=t,Qr.transition=e}}return!1}function ZI(n,e,t){e=Hl(t,e),e=G1(n,e,1),n=eo(n,e,1),e=ar(),n!==null&&(Yd(n,1,e),vr(n,e))}function an(n,e,t){if(n.tag===3)ZI(n,n,t);else for(;e!==null;){if(e.tag===3){ZI(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(to===null||!to.has(r))){n=Hl(t,n),n=H1(e,n,1),e=eo(e,n,1),n=ar(),e!==null&&(Yd(e,1,n),vr(e,n));break}}e=e.return}}function sO(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=ar(),n.pingedLanes|=n.suspendedLanes&t,jn===n&&(Wn&t)===t&&(En===4||En===3&&(Wn&130023424)===Wn&&500>dn()-O_?sa(n,0):M_|=t),vr(n,e)}function fN(n,e){e===0&&(n.mode&1?(e=Jh,Jh<<=1,!(Jh&130023424)&&(Jh=4194304)):e=1);var t=ar();n=li(n,e),n!==null&&(Yd(n,e,t),vr(n,t))}function iO(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),fN(n,t)}function oO(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(K(314))}r!==null&&r.delete(e),fN(n,t)}var mN;mN=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||gr.current)hr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return hr=!1,HM(n,e,t);hr=!!(n.flags&131072)}else hr=!1,Bt&&e.flags&1048576&&v1(e,gm,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Of(n,e),n=e.pendingProps;var s=zl(e,sr.current);kl(e,t),s=C_(null,e,r,n,s,t);var i=k_();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,yr(r)?(i=!0,mm(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,E_(e),s.updater=Ap,e.stateNode=s,s._reactInternals=e,M0(e,r,n,t),e=V0(null,e,r,!0,i,t)):(e.tag=0,Bt&&i&&y_(e),ir(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Of(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=lO(r),n=is(r,n),s){case 0:e=L0(null,e,r,n,t);break e;case 1:e=zI(null,e,r,n,t);break e;case 11:e=UI(null,e,r,n,t);break e;case 14:e=BI(null,e,r,is(r.type,n),t);break e}throw Error(K(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),L0(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),zI(n,e,r,s,t);case 3:e:{if(J1(e),n===null)throw Error(K(387));r=e.pendingProps,i=e.memoizedState,s=i.element,E1(n,e),_m(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Hl(Error(K(423)),e),e=qI(n,e,r,t,s);break e}else if(r!==s){s=Hl(Error(K(424)),e),e=qI(n,e,r,t,s);break e}else for(kr=Zi(e.stateNode.containerInfo.firstChild),Rr=e,Bt=!0,ls=null,t=S1(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ql(),r===s){e=ci(n,e,t);break e}ir(n,e,r,t)}e=e.child}return e;case 5:return b1(e),n===null&&D0(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,A0(r,s)?o=null:i!==null&&A0(r,i)&&(e.flags|=32),Y1(n,e),ir(n,e,o,t),e.child;case 6:return n===null&&D0(e),null;case 13:return X1(n,e,t);case 4:return b_(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Wl(e,null,r,t):ir(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),UI(n,e,r,s,t);case 7:return ir(n,e,e.pendingProps,t),e.child;case 8:return ir(n,e,e.pendingProps.children,t),e.child;case 12:return ir(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ct(ym,r._currentValue),r._currentValue=o,i!==null)if(ps(i.value,o)){if(i.children===s.children&&!gr.current){e=ci(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=si(-1,t&-t),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),P0(i.return,t,e),a.lanes|=t;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(K(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),P0(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ir(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,kl(e,t),s=Yr(s),r=r(s),e.flags|=1,ir(n,e,r,t),e.child;case 14:return r=e.type,s=is(r,e.pendingProps),s=is(r.type,s),BI(n,e,r,s,t);case 15:return Q1(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),Of(n,e),e.tag=1,yr(r)?(n=!0,mm(e)):n=!1,kl(e,t),W1(e,r,s),M0(e,r,s,t),V0(null,e,r,!0,n,t);case 19:return Z1(n,e,t);case 22:return K1(n,e,t)}throw Error(K(156,e.tag))};function pN(n,e){return BA(n,e)}function aO(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gr(n,e,t,r){return new aO(n,e,t,r)}function $_(n){return n=n.prototype,!(!n||!n.isReactComponent)}function lO(n){if(typeof n=="function")return $_(n)?1:0;if(n!=null){if(n=n.$$typeof,n===i_)return 11;if(n===o_)return 14}return 2}function ro(n,e){var t=n.alternate;return t===null?(t=Gr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Ff(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")$_(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case pl:return ia(t.children,s,i,e);case s_:o=8,s|=8;break;case i0:return n=Gr(12,t,e,s|2),n.elementType=i0,n.lanes=i,n;case o0:return n=Gr(13,t,e,s),n.elementType=o0,n.lanes=i,n;case a0:return n=Gr(19,t,e,s),n.elementType=a0,n.lanes=i,n;case bA:return kp(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case IA:o=10;break e;case EA:o=9;break e;case i_:o=11;break e;case o_:o=14;break e;case Pi:o=16,r=null;break e}throw Error(K(130,n==null?n:typeof n,""))}return e=Gr(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function ia(n,e,t,r){return n=Gr(7,n,r,e),n.lanes=t,n}function kp(n,e,t,r){return n=Gr(22,n,r,e),n.elementType=bA,n.lanes=t,n.stateNode={isHidden:!1},n}function Sy(n,e,t){return n=Gr(6,n,null,e),n.lanes=t,n}function Iy(n,e,t){return e=Gr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function cO(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ry(0),this.expirationTimes=ry(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ry(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function U_(n,e,t,r,s,i,o,a,c){return n=new cO(n,e,t,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Gr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},E_(i),n}function uO(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ml,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function gN(n){if(!n)return fo;n=n._reactInternals;e:{if(ja(n)!==n||n.tag!==1)throw Error(K(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(yr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(K(171))}if(n.tag===1){var t=n.type;if(yr(t))return g1(n,t,e)}return e}function yN(n,e,t,r,s,i,o,a,c){return n=U_(t,r,!0,n,s,i,o,a,c),n.context=gN(null),t=n.current,r=ar(),s=no(t),i=si(r,s),i.callback=e??null,eo(t,i,s),n.current.lanes=s,Yd(n,s,r),vr(n,r),n}function Rp(n,e,t,r){var s=e.current,i=ar(),o=no(s);return t=gN(t),e.context===null?e.context=t:e.pendingContext=t,e=si(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=eo(s,e,o),n!==null&&(hs(n,s,o,i),Pf(n,s,o)),o}function Am(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function eE(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function B_(n,e){eE(n,e),(n=n.alternate)&&eE(n,e)}function dO(){return null}var vN=typeof reportError=="function"?reportError:function(n){console.error(n)};function z_(n){this._internalRoot=n}Dp.prototype.render=z_.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(K(409));Rp(n,e,null,null)};Dp.prototype.unmount=z_.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;pa(function(){Rp(null,n,null,null)}),e[ai]=null}};function Dp(n){this._internalRoot=n}Dp.prototype.unstable_scheduleHydration=function(n){if(n){var e=KA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Mi.length&&e!==0&&e<Mi[t].priority;t++);Mi.splice(t,0,n),t===0&&JA(n)}};function q_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Pp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function tE(){}function hO(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Am(o);i.call(u)}}var o=yN(e,r,n,0,null,!1,!1,"",tE);return n._reactRootContainer=o,n[ai]=o.current,ud(n.nodeType===8?n.parentNode:n),pa(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Am(c);a.call(u)}}var c=U_(n,0,!1,null,null,!1,!1,"",tE);return n._reactRootContainer=c,n[ai]=c.current,ud(n.nodeType===8?n.parentNode:n),pa(function(){Rp(e,c,t,r)}),c}function jp(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=Am(o);a.call(c)}}Rp(e,o,n,s)}else o=hO(t,e,n,s,r);return Am(o)}HA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=vu(e.pendingLanes);t!==0&&(c_(e,t|1),vr(e,dn()),!(tt&6)&&(Ql=dn()+500,No()))}break;case 13:pa(function(){var r=li(n,1);if(r!==null){var s=ar();hs(r,n,1,s)}}),B_(n,1)}};u_=function(n){if(n.tag===13){var e=li(n,134217728);if(e!==null){var t=ar();hs(e,n,134217728,t)}B_(n,134217728)}};QA=function(n){if(n.tag===13){var e=no(n),t=li(n,e);if(t!==null){var r=ar();hs(t,n,e,r)}B_(n,e)}};KA=function(){return ft};YA=function(n,e){var t=ft;try{return ft=n,e()}finally{ft=t}};y0=function(n,e,t){switch(e){case"input":if(u0(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Ep(r);if(!s)throw Error(K(90));AA(r),u0(r,s)}}}break;case"textarea":CA(n,t);break;case"select":e=t.value,e!=null&&Tl(n,!!t.multiple,e,!1)}};OA=L_;LA=pa;var fO={usingClientEntryPoint:!1,Events:[Xd,_l,Ep,jA,MA,L_]},ru={findFiberByHostInstance:Yo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mO={bundleType:ru.bundleType,version:ru.version,rendererPackageName:ru.rendererPackageName,rendererConfig:ru.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=$A(n),n===null?null:n.stateNode},findFiberByHostInstance:ru.findFiberByHostInstance||dO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cf.isDisabled&&cf.supportsFiber)try{wp=cf.inject(mO),Ds=cf}catch{}}Fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fO;Fr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!q_(e))throw Error(K(200));return uO(n,e,null,t)};Fr.createRoot=function(n,e){if(!q_(n))throw Error(K(299));var t=!1,r="",s=vN;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=U_(n,1,!1,null,null,t,!1,r,s),n[ai]=e.current,ud(n.nodeType===8?n.parentNode:n),new z_(e)};Fr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(K(188)):(n=Object.keys(n).join(","),Error(K(268,n)));return n=$A(e),n=n===null?null:n.stateNode,n};Fr.flushSync=function(n){return pa(n)};Fr.hydrate=function(n,e,t){if(!Pp(e))throw Error(K(200));return jp(null,n,e,!0,t)};Fr.hydrateRoot=function(n,e,t){if(!q_(n))throw Error(K(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=vN;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=yN(e,null,n,1,t??null,s,!1,i,o),n[ai]=e.current,ud(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Dp(e)};Fr.render=function(n,e,t){if(!Pp(e))throw Error(K(200));return jp(null,n,e,!1,t)};Fr.unmountComponentAtNode=function(n){if(!Pp(n))throw Error(K(40));return n._reactRootContainer?(pa(function(){jp(null,null,n,!1,function(){n._reactRootContainer=null,n[ai]=null})}),!0):!1};Fr.unstable_batchedUpdates=L_;Fr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Pp(t))throw Error(K(200));if(n==null||n._reactInternals===void 0)throw Error(K(38));return jp(n,e,t,!1,r)};Fr.version="18.3.1-next-f1338f8080-20240426";function _N(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_N)}catch(n){console.error(n)}}_N(),_A.exports=Fr;var pO=_A.exports,nE=pO;r0.createRoot=nE.createRoot,r0.hydrateRoot=nE.hydrateRoot;const gO="modulepreload",yO=function(n){return"/"+n},rE={},Ve=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=yO(i),i in rE)return;rE[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":gO,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},vO=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wN={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X=function(n,e){if(!n)throw bc(e)},bc=function(n){return new Error("Firebase Database ("+wN.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xN=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},_O=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},W_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,u=c?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|u>>6,g=u&63;c||(g=64,o||(m=64)),r.push(t[h],t[f],t[m],t[g])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(xN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):_O(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new wO;const m=i<<2|a>>4;if(r.push(m),u!==64){const g=a<<4&240|u>>2;if(r.push(g),f!==64){const v=u<<6&192|f;r.push(v)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class wO extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const SN=function(n){const e=xN(n);return W_.encodeByteArray(e,!0)},Nm=function(n){return SN(n).replace(/\./g,"")},Cm=function(n){try{return W_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xO(n){return IN(void 0,n)}function IN(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!SO(t)||(n[t]=IN(n[t],e[t]));return n}function SO(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IO=()=>EN().__FIREBASE_DEFAULTS__,EO=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},bO=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Cm(n[1]);return e&&JSON.parse(e)},Mp=()=>{try{return vO()||IO()||EO()||bO()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},bN=n=>{var e,t;return(t=(e=Mp())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},TN=n=>{const e=bN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},AN=()=>{var n;return(n=Mp())==null?void 0:n.config},NN=n=>{var e;return(e=Mp())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Op(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Nm(JSON.stringify(t)),Nm(JSON.stringify(o)),a].join(".")}const Lu={};function TO(){const n={prod:[],emulator:[]};for(const e of Object.keys(Lu))Lu[e]?n.emulator.push(e):n.prod.push(e);return n}function AO(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let sE=!1;function G_(n,e){if(typeof window>"u"||typeof document>"u"||!vi(window.location.host)||Lu[n]===e||Lu[n]||sE)return;Lu[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=TO().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,g){m.setAttribute("width","24"),m.setAttribute("id",g),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{sE=!0,o()},m}function h(m,g){m.setAttribute("id",g),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=AO(r),g=t("text"),v=document.getElementById(g)||document.createElement("span"),_=t("learnmore"),R=document.getElementById(_)||document.createElement("a"),x=t("preprendIcon"),I=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const C=m.element;a(C),h(R,_);const P=u();c(I,x),C.append(I,v,R,P),document.body.appendChild(C)}i?(v.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,v.innerText="Preview backend running in this workspace."),v.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function H_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(bn())}function kN(){var e;const n=(e=Mp())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function NO(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Q_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function RN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function CO(){const n=bn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function DN(){return wN.NODE_ADMIN===!0}function PN(){return!kN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jN(){return!kN()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Lp(){try{return typeof indexedDB=="object"}catch{return!1}}function K_(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function MN(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kO="FirebaseError";class ys extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=kO,Object.setPrototypeOf(this,ys.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ma.prototype.create)}}class Ma{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?RO(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ys(s,a,r)}}function RO(n,e){return n.replace(DO,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const DO=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _d(n){return JSON.parse(n)}function In(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ON=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=_d(Cm(i[0])||""),t=_d(Cm(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},PO=function(n){const e=ON(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},jO=function(n){const e=ON(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vs(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ga(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function km(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Rm(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Or(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(iE(i)&&iE(o)){if(!Or(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function iE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function wu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function xu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MO{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const m=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(m<<1|m>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const m=(s<<5|s>>>27)+u+c+h+r[f]&4294967295;c=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=m}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function OO(n,e){const t=new LO(n,e);return t.subscribe.bind(t)}class LO{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");VO(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ey),s.error===void 0&&(s.error=Ey),s.complete===void 0&&(s.complete=Ey);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function VO(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ey(){}function ya(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FO=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,X(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Vp=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $O=1e3,UO=2,BO=4*60*60*1e3,zO=.5;function oE(n,e=$O,t=UO){const r=e*Math.pow(t,n),s=Math.round(zO*r*(Math.random()-.5)*2);return Math.min(BO,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(n){return n&&n._delegate?n._delegate:n}class xr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Nr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(WO(e))try{this.getOrInitializeService({instanceIdentifier:Bo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Bo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Bo){return this.instances.has(e)}getOptions(e=Bo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:qO(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Bo){return this.component?this.component.multipleInstances?e:Bo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qO(n){return n===Bo?void 0:n}function WO(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Y0(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var We;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(We||(We={}));const GO={debug:We.DEBUG,verbose:We.VERBOSE,info:We.INFO,warn:We.WARN,error:We.ERROR,silent:We.SILENT},HO=We.INFO,QO={[We.DEBUG]:"log",[We.VERBOSE]:"log",[We.INFO]:"info",[We.WARN]:"warn",[We.ERROR]:"error"},KO=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=QO[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class eh{constructor(e){this.name=e,this._logLevel=HO,this._logHandler=KO,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in We))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?GO[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,We.DEBUG,...e),this._logHandler(this,We.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,We.VERBOSE,...e),this._logHandler(this,We.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,We.INFO,...e),this._logHandler(this,We.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,We.WARN,...e),this._logHandler(this,We.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,We.ERROR,...e),this._logHandler(this,We.ERROR,...e)}}const YO=(n,e)=>e.some(t=>n instanceof t);let aE,lE;function JO(){return aE||(aE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function XO(){return lE||(lE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const VN=new WeakMap,J0=new WeakMap,FN=new WeakMap,by=new WeakMap,Y_=new WeakMap;function ZO(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(js(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&VN.set(t,n)}).catch(()=>{}),Y_.set(e,n),e}function eL(n){if(J0.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});J0.set(n,e)}let X0={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return J0.get(n);if(e==="objectStoreNames")return n.objectStoreNames||FN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return js(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function tL(n){X0=n(X0)}function nL(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call($f(this),e,...t);return FN.set(r,e.sort?e.sort():[e]),js(r)}:XO().includes(n)?function(...e){return n.apply($f(this),e),js(VN.get(this))}:function(...e){return js(n.apply($f(this),e))}}function rL(n){return typeof n=="function"?nL(n):(n instanceof IDBTransaction&&eL(n),YO(n,JO())?new Proxy(n,X0):n)}function js(n){if(n instanceof IDBRequest)return ZO(n);if(by.has(n))return by.get(n);const e=rL(n);return e!==n&&(by.set(n,e),Y_.set(e,n)),e}const $f=n=>Y_.get(n);function J_(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=js(o);return r&&o.addEventListener("upgradeneeded",c=>{r(js(o.result),c.oldVersion,c.newVersion,js(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}function sL(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),js(t).then(()=>{})}const iL=["get","getKey","getAll","getAllKeys","count"],oL=["put","add","delete","clear"],Ty=new Map;function cE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ty.get(e))return Ty.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=oL.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||iL.includes(t)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&c.done]))[0]};return Ty.set(e,i),i}tL(n=>({...n,get:(e,t,r)=>cE(e,t)||n.get(e,t,r),has:(e,t)=>!!cE(e,t)||n.has(e,t)}));const Z8=Object.freeze(Object.defineProperty({__proto__:null,deleteDB:sL,openDB:J_,unwrap:$f,wrap:js},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(lL(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function lL(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Z0="@firebase/app",uE="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ui=new eh("@firebase/app"),cL="@firebase/app-compat",uL="@firebase/analytics-compat",dL="@firebase/analytics",hL="@firebase/app-check-compat",fL="@firebase/app-check",mL="@firebase/auth",pL="@firebase/auth-compat",gL="@firebase/database",yL="@firebase/data-connect",vL="@firebase/database-compat",_L="@firebase/functions",wL="@firebase/functions-compat",xL="@firebase/installations",SL="@firebase/installations-compat",IL="@firebase/messaging",EL="@firebase/messaging-compat",bL="@firebase/performance",TL="@firebase/performance-compat",AL="@firebase/remote-config",NL="@firebase/remote-config-compat",CL="@firebase/storage",kL="@firebase/storage-compat",RL="@firebase/firestore",DL="@firebase/ai",PL="@firebase/firestore-compat",jL="firebase",ML="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dm="[DEFAULT]",OL={[Z0]:"fire-core",[cL]:"fire-core-compat",[dL]:"fire-analytics",[uL]:"fire-analytics-compat",[fL]:"fire-app-check",[hL]:"fire-app-check-compat",[mL]:"fire-auth",[pL]:"fire-auth-compat",[gL]:"fire-rtdb",[yL]:"fire-data-connect",[vL]:"fire-rtdb-compat",[_L]:"fire-fn",[wL]:"fire-fn-compat",[xL]:"fire-iid",[SL]:"fire-iid-compat",[IL]:"fire-fcm",[EL]:"fire-fcm-compat",[bL]:"fire-perf",[TL]:"fire-perf-compat",[AL]:"fire-rc",[NL]:"fire-rc-compat",[CL]:"fire-gcs",[kL]:"fire-gcs-compat",[RL]:"fire-fst",[PL]:"fire-fst-compat",[DL]:"fire-vertex","fire-js":"fire-js",[jL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd=new Map,LL=new Map,ev=new Map;function dE(n,e){try{n.container.addComponent(e)}catch(t){ui.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function gs(n){const e=n.name;if(ev.has(e))return ui.debug(`There were multiple attempts to register component ${e}.`),!1;ev.set(e,n);for(const t of wd.values())dE(t,n);for(const t of LL.values())dE(t,n);return!0}function qs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function VL(n,e,t=Dm){qs(n,e).clearInstance(t)}function zt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},so=new Ma("app","Firebase",FL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new xr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw so.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const La=ML;function X_(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Dm,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw so.create("bad-app-name",{appName:String(s)});if(t||(t=AN()),!t)throw so.create("no-options");const i=wd.get(s);if(i){if(Or(t,i.options)&&Or(r,i.config))return i;throw so.create("duplicate-app",{appName:s})}const o=new LN(s);for(const c of ev.values())o.addComponent(c);const a=new $L(t,r,o);return wd.set(s,a),a}function Tc(n=Dm){const e=wd.get(n);if(!e&&n===Dm&&AN())return X_();if(!e)throw so.create("no-app",{appName:n});return e}function $N(){return Array.from(wd.values())}function _r(n,e,t){let r=OL[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ui.warn(o.join(" "));return}gs(new xr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL="firebase-heartbeat-database",BL=1,xd="firebase-heartbeat-store";let Ay=null;function UN(){return Ay||(Ay=J_(UL,BL,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(xd)}catch(t){console.warn(t)}}}}).catch(n=>{throw so.create("idb-open",{originalErrorMessage:n.message})})),Ay}async function zL(n){try{const t=(await UN()).transaction(xd),r=await t.objectStore(xd).get(BN(n));return await t.done,r}catch(e){if(e instanceof ys)ui.warn(e.message);else{const t=so.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ui.warn(t.message)}}}async function hE(n,e){try{const r=(await UN()).transaction(xd,"readwrite");await r.objectStore(xd).put(e,BN(n)),await r.done}catch(t){if(t instanceof ys)ui.warn(t.message);else{const r=so.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ui.warn(r.message)}}}function BN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qL=1024,WL=30;class GL{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new QL(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=fE();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>WL){const o=KL(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ui.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=fE(),{heartbeatsToSend:r,unsentEntries:s}=HL(this._heartbeatsCache.heartbeats),i=Nm(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ui.warn(t),""}}}function fE(){return new Date().toISOString().substring(0,10)}function HL(n,e=qL){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),mE(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),mE(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class QL{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Lp()?K_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await zL(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return hE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return hE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function mE(n){return Nm(JSON.stringify({version:2,heartbeats:n})).length}function KL(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YL(n){gs(new xr("platform-logger",e=>new aL(e),"PRIVATE")),gs(new xr("heartbeat",e=>new GL(e),"PRIVATE")),_r(Z0,uE,n),_r(Z0,uE,"esm2020"),_r("fire-js","")}YL("");var JL="firebase",XL="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_r(JL,XL,"app");const pE="@firebase/database",gE="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zN="";function qN(n){zN=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),In(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:_d(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return vs(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WN=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ZL(e)}}catch{}return new e4},Zo=WN("localStorage"),tv=WN("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dl=new eh("@firebase/database"),GN=function(){let n=1;return function(){return n++}}(),HN=function(n){const e=FO(n),t=new MO;t.update(e);const r=t.digest();return W_.encodeByteArray(r)},th=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=th.apply(null,r):typeof r=="object"?e+=In(r):e+=r,e+=" "}return e};let oa=null,yE=!0;const QN=function(n,e){X(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Dl.logLevel=We.VERBOSE,oa=Dl.log.bind(Dl),e&&tv.set("logging_enabled",!0)):typeof n=="function"?oa=n:(oa=null,tv.remove("logging_enabled"))},Pn=function(...n){if(yE===!0&&(yE=!1,oa===null&&tv.get("logging_enabled")===!0&&QN(!0)),oa){const e=th.apply(null,n);oa(e)}},nh=function(n){return function(...e){Pn(n,...e)}},nv=function(...n){const e="FIREBASE INTERNAL ERROR: "+th(...n);Dl.error(e)},Us=function(...n){const e=`FIREBASE FATAL ERROR: ${th(...n)}`;throw Dl.error(e),new Error(e)},tr=function(...n){const e="FIREBASE WARNING: "+th(...n);Dl.warn(e)},t4=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&tr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Fp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},n4=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},mo="[MIN_NAME]",di="[MAX_NAME]",Va=function(n,e){if(n===e)return 0;if(n===mo||e===di)return-1;if(e===mo||n===di)return 1;{const t=vE(n),r=vE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},r4=function(n,e){return n===e?0:n<e?-1:1},su=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+In(e))},Z_=function(n){if(typeof n!="object"||n===null)return In(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=In(e[r]),t+=":",t+=Z_(n[e[r]]);return t+="}",t},KN=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Ln(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const YN=function(n){X(!Fp(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,c;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(c=0;c<64;c+=8){let m=parseInt(h.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},s4=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},i4=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function o4(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const a4=new RegExp("^-?(0*)\\d{1,10}$"),l4=-2147483648,c4=2147483647,vE=function(n){if(a4.test(n)){const e=Number(n);if(e>=l4&&e<=c4)return e}return null},Ac=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw tr("Exception was thrown by user callback.",t),e},Math.floor(0))}},u4=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Vu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,zt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){tr(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Pn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tr(e)}}class Pl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Pl.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew="5",JN="v",XN="s",ZN="r",eC="f",tC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,nC="ls",rC="p",rv="ac",sC="websocket",iC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{constructor(e,t,r,s,i=!1,o="",a=!1,c=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Zo.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Zo.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function f4(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function aC(n,e,t){X(typeof e=="string","typeof type must == string"),X(typeof t=="object","typeof params must == object");let r;if(e===sC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===iC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);f4(n)&&(t.ns=n.namespace);const s=[];return Ln(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(){this.counters_={}}incrementCounter(e,t=1){vs(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return xO(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny={},Cy={};function tw(n){const e=n.toString();return Ny[e]||(Ny[e]=new m4),Ny[e]}function p4(n,e){const t=n.toString();return Cy[t]||(Cy[t]=e()),Cy[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Ac(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _E="start",y4="close",v4="pLPCommand",_4="pRTLPCB",lC="id",cC="pw",uC="ser",w4="cb",x4="seg",S4="ts",I4="d",E4="dframe",dC=1870,hC=30,b4=dC-hC,T4=25e3,A4=3e4;class qi{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nh(e),this.stats_=tw(t),this.urlFn=c=>(this.appCheckToken&&(c[rv]=this.appCheckToken),aC(t,iC,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new g4(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(A4)),n4(()=>{if(this.isClosed_)return;this.scriptTagHolder=new nw((...i)=>{const[o,a,c,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===_E)this.id=a,this.password=c;else if(o===y4)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[_E]="t",r[uC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[w4]=this.scriptTagHolder.uniqueCallbackIdentifier),r[JN]=ew,this.transportSessionId&&(r[XN]=this.transportSessionId),this.lastSessionId&&(r[nC]=this.lastSessionId),this.applicationId&&(r[rC]=this.applicationId),this.appCheckToken&&(r[rv]=this.appCheckToken),typeof location<"u"&&location.hostname&&tC.test(location.hostname)&&(r[ZN]=eC);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){qi.forceAllow_=!0}static forceDisallow(){qi.forceDisallow_=!0}static isAvailable(){return qi.forceAllow_?!0:!qi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!s4()&&!i4()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=In(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=SN(t),s=KN(r,b4);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[E4]="t",r[lC]=e,r[cC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=In(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class nw{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=GN(),window[v4+this.uniqueCallbackIdentifier]=e,window[_4+this.uniqueCallbackIdentifier]=t,this.myIFrame=nw.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Pn("frame writing exception"),a.stack&&Pn(a.stack),Pn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Pn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[lC]=this.myID,e[cC]=this.myPW,e[uC]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+hC+r.length<=dC;){const o=this.pendingSegs.shift();r=r+"&"+x4+s+"="+o.seg+"&"+S4+s+"="+o.ts+"&"+I4+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(T4)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Pn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N4=16384,C4=45e3;let Pm=null;typeof MozWebSocket<"u"?Pm=MozWebSocket:typeof WebSocket<"u"&&(Pm=WebSocket);class Wr{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nh(this.connId),this.stats_=tw(t),this.connURL=Wr.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[JN]=ew,typeof location<"u"&&location.hostname&&tC.test(location.hostname)&&(o[ZN]=eC),t&&(o[XN]=t),r&&(o[nC]=r),s&&(o[rv]=s),i&&(o[rC]=i),aC(e,sC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Zo.set("previous_websocket_failure",!0);try{let r;DN(),this.mySock=new Pm(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Wr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Pm!==null&&!Wr.forceDisallow_}static previouslyFailed(){return Zo.isInMemoryStorage||Zo.get("previous_websocket_failure")===!0}markConnectionHealthy(){Zo.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=_d(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(X(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=In(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=KN(t,N4);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(C4))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Wr.responsesRequiredToBeHealthy=2;Wr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{static get ALL_TRANSPORTS(){return[qi,Wr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Wr&&Wr.isAvailable();let r=t&&!Wr.previouslyFailed();if(e.webSocketOnly&&(t||tr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Wr];else{const s=this.transports_=[];for(const i of Kl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Kl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Kl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k4=6e4,R4=5e3,D4=10*1024,P4=100*1024,ky="t",wE="d",j4="s",xE="r",M4="e",SE="o",IE="a",EE="n",bE="p",O4="h";class L4{constructor(e,t,r,s,i,o,a,c,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nh("c:"+this.id+":"),this.transportManager_=new Kl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Vu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>P4?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>D4?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ky in e){const t=e[ky];t===IE?this.upgradeIfSecondaryHealthy_():t===xE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===SE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=su("t",e),r=su("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:bE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:IE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:EE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=su("t",e),r=su("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=su(ky,e);if(wE in e){const r=e[wE];if(t===O4){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===EE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===j4?this.onConnectionShutdown_(r):t===xE?this.onReset_(r):t===M4?nv("Server Error: "+r):t===SE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):nv("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ew!==r&&tr("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Vu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(k4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Vu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(R4))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:bE,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Zo.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e){this.allowedEvents_=e,this.listeners_={},X(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){X(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm extends mC{static getInstance(){return new jm}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!H_()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return X(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TE=32,AE=768;class ct{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function rt(){return new ct("")}function $e(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function po(n){return n.pieces_.length-n.pieceNum_}function St(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ct(n.pieces_,e)}function rw(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function V4(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Sd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function pC(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ct(e,0)}function qt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ct)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new ct(t,0)}function Ue(n){return n.pieceNum_>=n.pieces_.length}function or(n,e){const t=$e(n),r=$e(e);if(t===null)return e;if(t===r)return or(St(n),St(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function F4(n,e){const t=Sd(n,0),r=Sd(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=Va(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function sw(n,e){if(po(n)!==po(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Hr(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(po(n)>po(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class $4{constructor(e,t){this.errorPrefix_=t,this.parts_=Sd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Vp(this.parts_[r]);gC(this)}}function U4(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Vp(e),gC(n)}function B4(n){const e=n.parts_.pop();n.byteLength_-=Vp(e),n.parts_.length>0&&(n.byteLength_-=1)}function gC(n){if(n.byteLength_>AE)throw new Error(n.errorPrefix_+"has a key path longer than "+AE+" bytes ("+n.byteLength_+").");if(n.parts_.length>TE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+TE+") or object contains a cycle "+zo(n))}function zo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw extends mC{static getInstance(){return new iw}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return X(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu=1e3,z4=60*5*1e3,NE=30*1e3,q4=1.3,W4=3e4,G4="server_kill",CE=3;class Kr extends fC{constructor(e,t,r,s,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Kr.nextPersistentConnectionId_++,this.log_=nh("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=iu,this.maxReconnectDelay_=z4,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!DN())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");iw.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&jm.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(In(i)),X(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Nr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),X(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),X(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const c=a.d,u=a.s;Kr.warnOnListenWarnings_(c,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&vs(e,"w")){const r=ga(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();tr(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||jO(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=NE)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=PO(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),X(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+In(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):nv("Unrecognized action received from server: "+In(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){X(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=iu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=iu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>W4&&(this.reconnectDelay_=iu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*q4)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Kr.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(f){X(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:c,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,m]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Pn("getToken() completed but was canceled"):(Pn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=m&&m.token,a=new L4(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,g=>{tr(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(G4)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&tr(f),c())}}}interrupt(e){Pn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Pn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],km(this.interruptReasons_)&&(this.reconnectDelay_=iu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>Z_(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new ct(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Pn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=CE&&(this.reconnectDelay_=NE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Pn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=CE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+zN.replace(/\./g,"-")]=1,H_()?e["framework.cordova"]=1:RN()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=jm.getInstance().currentlyOnline();return km(this.interruptReasons_)&&e}}Kr.nextPersistentConnectionId_=0;Kr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Be(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new Be(mo,e),s=new Be(mo,t);return this.compare(r,s)!==0}minPost(){return Be.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uf;class yC extends $p{static get __EMPTY_NODE(){return uf}static set __EMPTY_NODE(e){uf=e}compare(e,t){return Va(e.name,t.name)}isDefinedOn(e){throw bc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Be.MIN}maxPost(){return new Be(di,uf)}makePost(e,t){return X(typeof e=="string","KeyIndex indexValue must always be a string."),new Be(e,uf)}toString(){return".key"}}const Ms=new yC;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let df=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Tr=class Su{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Su.RED,this.left=s??As.EMPTY_NODE,this.right=i??As.EMPTY_NODE}copy(e,t,r,s,i){return new Su(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return As.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return As.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Su.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Su.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Tr.RED=!0;Tr.BLACK=!1;class H4{copy(e,t,r,s,i){return this}insert(e,t,r){return new Tr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let As=class Uf{constructor(e,t=Uf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Uf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Tr.BLACK,null,null))}remove(e){return new Uf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Tr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new df(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new df(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new df(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new df(this.root_,null,this.comparator_,!0,e)}};As.EMPTY_NODE=new H4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q4(n,e){return Va(n.name,e.name)}function ow(n,e){return Va(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sv;function K4(n){sv=n}const vC=function(n){return typeof n=="number"?"number:"+YN(n):"string:"+n},_C=function(n){if(n.isLeafNode()){const e=n.val();X(typeof e=="string"||typeof e=="number"||typeof e=="object"&&vs(e,".sv"),"Priority must be a string or number.")}else X(n===sv||n.isEmpty(),"priority of unexpected type.");X(n===sv||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kE;class Nn{static set __childrenNodeConstructor(e){kE=e}static get __childrenNodeConstructor(){return kE}constructor(e,t=Nn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,X(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),_C(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Nn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Nn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ue(e)?this:$e(e)===".priority"?this.priorityNode_:Nn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Nn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=$e(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(X(r!==".priority"||po(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Nn.__childrenNodeConstructor.EMPTY_NODE.updateChild(St(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+vC(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=YN(this.value_):e+=this.value_,this.lazyHash_=HN(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Nn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Nn.__childrenNodeConstructor?-1:(X(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=Nn.VALUE_TYPE_ORDER.indexOf(t),i=Nn.VALUE_TYPE_ORDER.indexOf(r);return X(s>=0,"Unknown leaf type: "+t),X(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Nn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wC,xC;function Y4(n){wC=n}function J4(n){xC=n}class X4 extends $p{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?Va(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Be.MIN}maxPost(){return new Be(di,new Nn("[PRIORITY-POST]",xC))}makePost(e,t){const r=wC(e);return new Be(t,new Nn("[PRIORITY-POST]",r))}toString(){return".priority"}}const kt=new X4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z4=Math.log(2);class eV{constructor(e){const t=i=>parseInt(Math.log(i)/Z4,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Mm=function(n,e,t,r){n.sort(e);const s=function(c,u){const h=u-c;let f,m;if(h===0)return null;if(h===1)return f=n[c],m=t?t(f):f,new Tr(m,f.node,Tr.BLACK,null,null);{const g=parseInt(h/2,10)+c,v=s(c,g),_=s(g+1,u);return f=n[g],m=t?t(f):f,new Tr(m,f.node,Tr.BLACK,v,_)}},i=function(c){let u=null,h=null,f=n.length;const m=function(v,_){const R=f-v,x=f;f-=v;const I=s(R+1,x),C=n[R],P=t?t(C):C;g(new Tr(P,C.node,_,null,I))},g=function(v){u?(u.left=v,u=v):(h=v,u=v)};for(let v=0;v<c.count;++v){const _=c.nextBitIsOne(),R=Math.pow(2,c.count-(v+1));_?m(R,Tr.BLACK):(m(R,Tr.BLACK),m(R,Tr.RED))}return h},o=new eV(n.length),a=i(o);return new As(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ry;const nl={};class Zs{static get Default(){return X(nl&&kt,"ChildrenNode.ts has not been loaded"),Ry=Ry||new Zs({".priority":nl},{".priority":kt}),Ry}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=ga(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof As?t:null}hasIndex(e){return vs(this.indexSet_,e.toString())}addIndex(e,t){X(e!==Ms,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(Be.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Mm(r,e.getCompare()):a=nl;const c=e.toString(),u={...this.indexSet_};u[c]=e;const h={...this.indexes_};return h[c]=a,new Zs(h,u)}addToIndexes(e,t){const r=Rm(this.indexes_,(s,i)=>{const o=ga(this.indexSet_,i);if(X(o,"Missing index implementation for "+i),s===nl)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(Be.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Mm(a,o.getCompare())}else return nl;else{const a=t.get(e.name);let c=s;return a&&(c=c.remove(new Be(e.name,a))),c.insert(e,e.node)}});return new Zs(r,this.indexSet_)}removeFromIndexes(e,t){const r=Rm(this.indexes_,s=>{if(s===nl)return s;{const i=t.get(e.name);return i?s.remove(new Be(e.name,i)):s}});return new Zs(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ou;class Ce{static get EMPTY_NODE(){return ou||(ou=new Ce(new As(ow),null,Zs.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&_C(this.priorityNode_),this.children_.isEmpty()&&X(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ou}updatePriority(e){return this.children_.isEmpty()?this:new Ce(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ou:t}}getChild(e){const t=$e(e);return t===null?this:this.getImmediateChild(t).getChild(St(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(X(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new Be(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?ou:this.priorityNode_;return new Ce(s,o,i)}}updateChild(e,t){const r=$e(e);if(r===null)return t;{X($e(e)!==".priority"||po(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(St(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(kt,(o,a)=>{t[o]=a.val(e),r++,i&&Ce.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+vC(this.getPriority().val())+":"),this.forEachChild(kt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":HN(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new Be(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Be(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Be(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,Be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,Be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===rh?-1:0}withIndex(e){if(e===Ms||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ce(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ms||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(kt),s=t.getIterator(kt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ms?null:this.indexMap_.get(e.toString())}}Ce.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class tV extends Ce{constructor(){super(new As(ow),Ce.EMPTY_NODE,Zs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ce.EMPTY_NODE}isEmpty(){return!1}}const rh=new tV;Object.defineProperties(Be,{MIN:{value:new Be(mo,Ce.EMPTY_NODE)},MAX:{value:new Be(di,rh)}});yC.__EMPTY_NODE=Ce.EMPTY_NODE;Nn.__childrenNodeConstructor=Ce;K4(rh);J4(rh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nV=!0;function Jt(n,e=null){if(n===null)return Ce.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),X(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Nn(t,Jt(e))}if(!(n instanceof Array)&&nV){const t=[];let r=!1;if(Ln(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=Jt(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new Be(o,c)))}}),t.length===0)return Ce.EMPTY_NODE;const i=Mm(t,Q4,o=>o.name,ow);if(r){const o=Mm(t,kt.getCompare());return new Ce(i,Jt(e),new Zs({".priority":o},{".priority":kt}))}else return new Ce(i,Jt(e),Zs.Default)}else{let t=Ce.EMPTY_NODE;return Ln(n,(r,s)=>{if(vs(n,r)&&r.substring(0,1)!=="."){const i=Jt(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Jt(e))}}Y4(Jt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw extends $p{constructor(e){super(),this.indexPath_=e,X(!Ue(e)&&$e(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?Va(e.name,t.name):i}makePost(e,t){const r=Jt(e),s=Ce.EMPTY_NODE.updateChild(this.indexPath_,r);return new Be(t,s)}maxPost(){const e=Ce.EMPTY_NODE.updateChild(this.indexPath_,rh);return new Be(di,e)}toString(){return Sd(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV extends $p{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Va(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Be.MIN}maxPost(){return Be.MAX}makePost(e,t){const r=Jt(e);return new Be(t,r)}toString(){return".value"}}const lw=new rV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SC(n){return{type:"value",snapshotNode:n}}function Yl(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Id(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ed(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function sV(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){X(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Id(t,a)):X(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Yl(t,r)):o.trackChildChange(Ed(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(kt,(s,i)=>{t.hasChild(s)||r.trackChildChange(Id(s,i))}),t.isLeafNode()||t.forEachChild(kt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Ed(s,i,o))}else r.trackChildChange(Yl(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ce.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{constructor(e){this.indexedFilter_=new cw(e.getIndex()),this.index_=e.getIndex(),this.startPost_=bd.getStartPost_(e),this.endPost_=bd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new Be(t,r))||(r=Ce.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Ce.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Ce.EMPTY_NODE);const i=this;return t.forEachChild(kt,(o,a)=>{i.matches(new Be(o,a))||(s=s.updateImmediateChild(o,Ce.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iV{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new bd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new Be(t,r))||(r=Ce.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=Ce.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Ce.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(Ce.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Ce.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(m,g)=>f(g,m)}else o=this.index_.getCompare();const a=e;X(a.numChildren()===this.limit_,"");const c=new Be(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const f=a.getImmediateChild(t);let m=s.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);const g=m==null?1:o(m,c);if(h&&!r.isEmpty()&&g>=0)return i!=null&&i.trackChildChange(Ed(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(Id(t,f));const _=a.updateImmediateChild(t,Ce.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(i!=null&&i.trackChildChange(Yl(m.name,m.node)),_.updateImmediateChild(m.name,m.node)):_}}else return r.isEmpty()?e:h&&o(u,c)>=0?(i!=null&&(i.trackChildChange(Id(u.name,u.node)),i.trackChildChange(Yl(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,Ce.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=kt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return X(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return X(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:mo}hasEnd(){return this.endSet_}getIndexEndValue(){return X(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return X(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:di}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return X(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===kt}copy(){const e=new uw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function oV(n){return n.loadsAllData()?new cw(n.getIndex()):n.hasLimit()?new iV(n):new bd(n)}function aV(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function lV(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function iv(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function cV(n,e,t){let r;return n.index_===Ms||t?r=iv(n,e,t):r=iv(n,e,di),r.startAfterSet_=!0,r}function ov(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function uV(n,e,t){let r;return n.index_===Ms||t?r=ov(n,e,t):r=ov(n,e,mo),r.endBeforeSet_=!0,r}function Up(n,e){const t=n.copy();return t.index_=e,t}function RE(n){const e={};if(n.isDefault())return e;let t;if(n.index_===kt?t="$priority":n.index_===lw?t="$value":n.index_===Ms?t="$key":(X(n.index_ instanceof aw,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=In(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=In(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+In(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=In(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+In(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function DE(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==kt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om extends fC{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(X(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=nh("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Om.getListenId_(e,r),a={};this.listens_[o]=a;const c=RE(e._queryParams);this.restRequest_(i+".json",c,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),ga(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",s(m,null)}})}unlisten(e,t){const r=Om.getListenId_(e,t);delete this.listens_[r]}get(e){const t=RE(e._queryParams),r=e._path.toString(),s=new Nr;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Oa(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=_d(a.responseText)}catch{tr("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&tr("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(){this.rootNode_=Ce.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(){return{value:null,children:new Map}}function Nc(n,e,t){if(Ue(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=$e(e);n.children.has(r)||n.children.set(r,Lm());const s=n.children.get(r);e=St(e),Nc(s,e,t)}}function av(n,e){if(Ue(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(kt,(r,s)=>{Nc(n,new ct(r),s)}),av(n,e)}}else if(n.children.size>0){const t=$e(e);return e=St(e),n.children.has(t)&&av(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function lv(n,e,t){n.value!==null?t(e,n.value):hV(n,(r,s)=>{const i=new ct(e.toString()+"/"+r);lv(s,i,t)})}function hV(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Ln(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE=10*1e3,mV=30*1e3,pV=5*60*1e3;class gV{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new fV(e);const r=PE+(mV-PE)*Math.random();Vu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Ln(e,(s,i)=>{i>0&&vs(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),Vu(this.reportStats_.bind(this),Math.floor(Math.random()*2*pV))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cs;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(cs||(cs={}));function dw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function hw(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fw(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=cs.ACK_USER_WRITE,this.source=dw()}operationForChild(e){if(Ue(this.path)){if(this.affectedTree.value!=null)return X(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ct(e));return new Vm(rt(),t,this.revert)}}else return X($e(this.path)===e,"operationForChild called for unrelated child."),new Vm(St(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td{constructor(e,t){this.source=e,this.path=t,this.type=cs.LISTEN_COMPLETE}operationForChild(e){return Ue(this.path)?new Td(this.source,rt()):new Td(this.source,St(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=cs.OVERWRITE}operationForChild(e){return Ue(this.path)?new va(this.source,rt(),this.snap.getImmediateChild(e)):new va(this.source,St(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=cs.MERGE}operationForChild(e){if(Ue(this.path)){const t=this.children.subtree(new ct(e));return t.isEmpty()?null:t.value?new va(this.source,rt(),t.value):new Jl(this.source,rt(),t)}else return X($e(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Jl(this.source,St(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ue(e))return this.isFullyInitialized()&&!this.filtered_;const t=$e(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function vV(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(sV(o.childName,o.snapshotNode))}),au(n,s,"child_removed",e,r,t),au(n,s,"child_added",e,r,t),au(n,s,"child_moved",i,r,t),au(n,s,"child_changed",e,r,t),au(n,s,"value",e,r,t),s}function au(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,c)=>wV(n,a,c)),o.forEach(a=>{const c=_V(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function _V(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function wV(n,e,t){if(e.childName==null||t.childName==null)throw bc("Should only compare child_ events.");const r=new Be(e.childName,e.snapshotNode),s=new Be(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bp(n,e){return{eventCache:n,serverCache:e}}function Fu(n,e,t,r){return Bp(new go(e,t,r),n.serverCache)}function IC(n,e,t,r){return Bp(n.eventCache,new go(e,t,r))}function Fm(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function _a(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dy;const xV=()=>(Dy||(Dy=new As(r4)),Dy);class Nt{static fromObject(e){let t=new Nt(null);return Ln(e,(r,s)=>{t=t.set(new ct(r),s)}),t}constructor(e,t=xV()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:rt(),value:this.value};if(Ue(e))return null;{const r=$e(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(St(e),t);return i!=null?{path:qt(new ct(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ue(e))return this;{const t=$e(e),r=this.children.get(t);return r!==null?r.subtree(St(e)):new Nt(null)}}set(e,t){if(Ue(e))return new Nt(t,this.children);{const r=$e(e),i=(this.children.get(r)||new Nt(null)).set(St(e),t),o=this.children.insert(r,i);return new Nt(this.value,o)}}remove(e){if(Ue(e))return this.children.isEmpty()?new Nt(null):new Nt(null,this.children);{const t=$e(e),r=this.children.get(t);if(r){const s=r.remove(St(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new Nt(null):new Nt(this.value,i)}else return this}}get(e){if(Ue(e))return this.value;{const t=$e(e),r=this.children.get(t);return r?r.get(St(e)):null}}setTree(e,t){if(Ue(e))return t;{const r=$e(e),i=(this.children.get(r)||new Nt(null)).setTree(St(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Nt(this.value,o)}}fold(e){return this.fold_(rt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(qt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,rt(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(Ue(e))return null;{const i=$e(e),o=this.children.get(i);return o?o.findOnPath_(St(e),qt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,rt(),t)}foreachOnPath_(e,t,r){if(Ue(e))return this;{this.value&&r(t,this.value);const s=$e(e),i=this.children.get(s);return i?i.foreachOnPath_(St(e),qt(t,s),r):new Nt(null)}}foreach(e){this.foreach_(rt(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(qt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e){this.writeTree_=e}static empty(){return new fs(new Nt(null))}}function $u(n,e,t){if(Ue(e))return new fs(new Nt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=or(s,e);return i=i.updateChild(o,t),new fs(n.writeTree_.set(s,i))}else{const s=new Nt(t),i=n.writeTree_.setTree(e,s);return new fs(i)}}}function cv(n,e,t){let r=n;return Ln(t,(s,i)=>{r=$u(r,qt(e,s),i)}),r}function jE(n,e){if(Ue(e))return fs.empty();{const t=n.writeTree_.setTree(e,new Nt(null));return new fs(t)}}function uv(n,e){return Fa(n,e)!=null}function Fa(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(or(t.path,e)):null}function ME(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(kt,(r,s)=>{e.push(new Be(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new Be(r,s.value))}),e}function io(n,e){if(Ue(e))return n;{const t=Fa(n,e);return t!=null?new fs(new Nt(t)):new fs(n.writeTree_.subtree(e))}}function dv(n){return n.writeTree_.isEmpty()}function Xl(n,e){return EC(rt(),n.writeTree_,e)}function EC(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(X(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=EC(qt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(qt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zp(n,e){return NC(e,n)}function SV(n,e,t,r,s){X(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=$u(n.visibleWrites,e,t)),n.lastWriteId=r}function IV(n,e,t,r){X(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=cv(n.visibleWrites,e,t),n.lastWriteId=r}function EV(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function bV(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);X(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&TV(a,r.path)?s=!1:Hr(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return AV(n),!0;if(r.snap)n.visibleWrites=jE(n.visibleWrites,r.path);else{const a=r.children;Ln(a,c=>{n.visibleWrites=jE(n.visibleWrites,qt(r.path,c))})}return!0}else return!1}function TV(n,e){if(n.snap)return Hr(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Hr(qt(n.path,t),e))return!0;return!1}function AV(n){n.visibleWrites=bC(n.allWrites,NV,rt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function NV(n){return n.visible}function bC(n,e,t){let r=fs.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)Hr(t,o)?(a=or(t,o),r=$u(r,a,i.snap)):Hr(o,t)&&(a=or(o,t),r=$u(r,rt(),i.snap.getChild(a)));else if(i.children){if(Hr(t,o))a=or(t,o),r=cv(r,a,i.children);else if(Hr(o,t))if(a=or(o,t),Ue(a))r=cv(r,rt(),i.children);else{const c=ga(i.children,$e(a));if(c){const u=c.getChild(St(a));r=$u(r,rt(),u)}}}else throw bc("WriteRecord should have .snap or .children")}}return r}function TC(n,e,t,r,s){if(!r&&!s){const i=Fa(n.visibleWrites,e);if(i!=null)return i;{const o=io(n.visibleWrites,e);if(dv(o))return t;if(t==null&&!uv(o,rt()))return null;{const a=t||Ce.EMPTY_NODE;return Xl(o,a)}}}else{const i=io(n.visibleWrites,e);if(!s&&dv(i))return t;if(!s&&t==null&&!uv(i,rt()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Hr(u.path,e)||Hr(e,u.path))},a=bC(n.allWrites,o,e),c=t||Ce.EMPTY_NODE;return Xl(a,c)}}}function CV(n,e,t){let r=Ce.EMPTY_NODE;const s=Fa(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(kt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=io(n.visibleWrites,e);return t.forEachChild(kt,(o,a)=>{const c=Xl(io(i,new ct(o)),a);r=r.updateImmediateChild(o,c)}),ME(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=io(n.visibleWrites,e);return ME(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function kV(n,e,t,r,s){X(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=qt(e,t);if(uv(n.visibleWrites,i))return null;{const o=io(n.visibleWrites,i);return dv(o)?s.getChild(t):Xl(o,s.getChild(t))}}function RV(n,e,t,r){const s=qt(e,t),i=Fa(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=io(n.visibleWrites,s);return Xl(o,r.getNode().getImmediateChild(t))}else return null}function DV(n,e){return Fa(n.visibleWrites,e)}function PV(n,e,t,r,s,i,o){let a;const c=io(n.visibleWrites,e),u=Fa(c,rt());if(u!=null)a=u;else if(t!=null)a=Xl(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),m=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let g=m.getNext();for(;g&&h.length<s;)f(g,r)!==0&&h.push(g),g=m.getNext();return h}else return[]}function jV(){return{visibleWrites:fs.empty(),allWrites:[],lastWriteId:-1}}function $m(n,e,t,r){return TC(n.writeTree,n.treePath,e,t,r)}function mw(n,e){return CV(n.writeTree,n.treePath,e)}function OE(n,e,t,r){return kV(n.writeTree,n.treePath,e,t,r)}function Um(n,e){return DV(n.writeTree,qt(n.treePath,e))}function MV(n,e,t,r,s,i){return PV(n.writeTree,n.treePath,e,t,r,s,i)}function pw(n,e,t){return RV(n.writeTree,n.treePath,e,t)}function AC(n,e){return NC(qt(n.treePath,e),n.writeTree)}function NC(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;X(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),X(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Ed(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Id(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,Yl(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Ed(r,e.snapshotNode,s.oldSnap));else throw bc("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const CC=new LV;class gw{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new go(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return pw(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:_a(this.viewCache_),i=MV(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VV(n){return{filter:n}}function FV(n,e){X(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),X(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function $V(n,e,t,r,s){const i=new OV;let o,a;if(t.type===cs.OVERWRITE){const u=t;u.source.fromUser?o=hv(n,e,u.path,u.snap,r,s,i):(X(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Ue(u.path),o=Bm(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===cs.MERGE){const u=t;u.source.fromUser?o=BV(n,e,u.path,u.children,r,s,i):(X(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=fv(n,e,u.path,u.children,r,s,a,i))}else if(t.type===cs.ACK_USER_WRITE){const u=t;u.revert?o=WV(n,e,u.path,r,s,i):o=zV(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===cs.LISTEN_COMPLETE)o=qV(n,e,t.path,r,i);else throw bc("Unknown operation type: "+t.type);const c=i.getChanges();return UV(e,o,c),{viewCache:o,changes:c}}function UV(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Fm(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(SC(Fm(e)))}}function kC(n,e,t,r,s,i){const o=e.eventCache;if(Um(r,t)!=null)return e;{let a,c;if(Ue(t))if(X(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=_a(e),h=u instanceof Ce?u:Ce.EMPTY_NODE,f=mw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=$m(r,_a(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=$e(t);if(u===".priority"){X(po(t)===1,"Can't have a priority with additional path components");const h=o.getNode();c=e.serverCache.getNode();const f=OE(r,t,h,c);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=St(t);let f;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const m=OE(r,t,o.getNode(),c);m!=null?f=o.getNode().getImmediateChild(u).updateChild(h,m):f=o.getNode().getImmediateChild(u)}else f=pw(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Fu(e,a,o.isFullyInitialized()||Ue(t),n.filter.filtersNodes())}}function Bm(n,e,t,r,s,i,o,a){const c=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Ue(t))u=h.updateFullNode(c.getNode(),r,null);else if(h.filtersNodes()&&!c.isFiltered()){const g=c.getNode().updateChild(t,r);u=h.updateFullNode(c.getNode(),g,null)}else{const g=$e(t);if(!c.isCompleteForPath(t)&&po(t)>1)return e;const v=St(t),R=c.getNode().getImmediateChild(g).updateChild(v,r);g===".priority"?u=h.updatePriority(c.getNode(),R):u=h.updateChild(c.getNode(),g,R,v,CC,null)}const f=IC(e,u,c.isFullyInitialized()||Ue(t),h.filtersNodes()),m=new gw(s,f,i);return kC(n,f,t,s,m,a)}function hv(n,e,t,r,s,i,o){const a=e.eventCache;let c,u;const h=new gw(s,e,i);if(Ue(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Fu(e,u,!0,n.filter.filtersNodes());else{const f=$e(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),c=Fu(e,u,a.isFullyInitialized(),a.isFiltered());else{const m=St(t),g=a.getNode().getImmediateChild(f);let v;if(Ue(m))v=r;else{const _=h.getCompleteChild(f);_!=null?rw(m)===".priority"&&_.getChild(pC(m)).isEmpty()?v=_:v=_.updateChild(m,r):v=Ce.EMPTY_NODE}if(g.equals(v))c=e;else{const _=n.filter.updateChild(a.getNode(),f,v,m,h,o);c=Fu(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function LE(n,e){return n.eventCache.isCompleteForChild(e)}function BV(n,e,t,r,s,i,o){let a=e;return r.foreach((c,u)=>{const h=qt(t,c);LE(e,$e(h))&&(a=hv(n,a,h,u,s,i,o))}),r.foreach((c,u)=>{const h=qt(t,c);LE(e,$e(h))||(a=hv(n,a,h,u,s,i,o))}),a}function VE(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function fv(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;Ue(t)?u=r:u=new Nt(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(h.hasChild(f)){const g=e.serverCache.getNode().getImmediateChild(f),v=VE(n,g,m);c=Bm(n,c,new ct(f),v,s,i,o,a)}}),u.children.inorderTraversal((f,m)=>{const g=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!h.hasChild(f)&&!g){const v=e.serverCache.getNode().getImmediateChild(f),_=VE(n,v,m);c=Bm(n,c,new ct(f),_,s,i,o,a)}}),c}function zV(n,e,t,r,s,i,o){if(Um(s,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(Ue(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Bm(n,e,t,c.getNode().getChild(t),s,i,a,o);if(Ue(t)){let u=new Nt(null);return c.getNode().forEachChild(Ms,(h,f)=>{u=u.set(new ct(h),f)}),fv(n,e,t,u,s,i,a,o)}else return e}else{let u=new Nt(null);return r.foreach((h,f)=>{const m=qt(t,h);c.isCompleteForPath(m)&&(u=u.set(h,c.getNode().getChild(m)))}),fv(n,e,t,u,s,i,a,o)}}function qV(n,e,t,r,s){const i=e.serverCache,o=IC(e,i.getNode(),i.isFullyInitialized()||Ue(t),i.isFiltered());return kC(n,o,t,r,CC,s)}function WV(n,e,t,r,s,i){let o;if(Um(r,t)!=null)return e;{const a=new gw(r,e,s),c=e.eventCache.getNode();let u;if(Ue(t)||$e(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=$m(r,_a(e));else{const f=e.serverCache.getNode();X(f instanceof Ce,"serverChildren would be complete if leaf node"),h=mw(r,f)}h=h,u=n.filter.updateFullNode(c,h,i)}else{const h=$e(t);let f=pw(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=c.getImmediateChild(h)),f!=null?u=n.filter.updateChild(c,h,f,St(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(c,h,Ce.EMPTY_NODE,St(t),a,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=$m(r,_a(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Um(r,rt())!=null,Fu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GV{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new cw(r.getIndex()),i=oV(r);this.processor_=VV(i);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(Ce.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ce.EMPTY_NODE,a.getNode(),null),h=new go(c,o.isFullyInitialized(),s.filtersNodes()),f=new go(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Bp(f,h),this.eventGenerator_=new yV(this.query_)}get query(){return this.query_}}function HV(n){return n.viewCache_.serverCache.getNode()}function QV(n){return Fm(n.viewCache_)}function KV(n,e){const t=_a(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Ue(e)&&!t.getImmediateChild($e(e)).isEmpty())?t.getChild(e):null}function FE(n){return n.eventRegistrations_.length===0}function YV(n,e){n.eventRegistrations_.push(e)}function $E(n,e,t){const r=[];if(t){X(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function UE(n,e,t,r){e.type===cs.MERGE&&e.source.queryId!==null&&(X(_a(n.viewCache_),"We should always have a full cache before handling merges"),X(Fm(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=$V(n.processor_,s,e,t,r);return FV(n.processor_,i.viewCache),X(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,RC(n,i.changes,i.viewCache.eventCache.getNode(),null)}function JV(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(kt,(i,o)=>{r.push(Yl(i,o))}),t.isFullyInitialized()&&r.push(SC(t.getNode())),RC(n,r,t.getNode(),e)}function RC(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return vV(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zm;class DC{constructor(){this.views=new Map}}function XV(n){X(!zm,"__referenceConstructor has already been defined"),zm=n}function ZV(){return X(zm,"Reference.ts has not been loaded"),zm}function eF(n){return n.views.size===0}function yw(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return X(i!=null,"SyncTree gave us an op for an invalid query."),UE(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(UE(o,e,t,r));return i}}function PC(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=$m(t,s?r:null),c=!1;a?c=!0:r instanceof Ce?(a=mw(t,r),c=!1):(a=Ce.EMPTY_NODE,c=!1);const u=Bp(new go(a,c,!1),new go(r,s,!1));return new GV(e,u)}return o}function tF(n,e,t,r,s,i){const o=PC(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),YV(o,t),JV(o,t)}function nF(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=yo(n);if(s==="default")for(const[c,u]of n.views.entries())o=o.concat($E(u,t,r)),FE(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=n.views.get(s);c&&(o=o.concat($E(c,t,r)),FE(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return a&&!yo(n)&&i.push(new(ZV())(e._repo,e._path)),{removed:i,events:o}}function jC(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function oo(n,e){let t=null;for(const r of n.views.values())t=t||KV(r,e);return t}function MC(n,e){if(e._queryParams.loadsAllData())return qp(n);{const r=e._queryIdentifier;return n.views.get(r)}}function OC(n,e){return MC(n,e)!=null}function yo(n){return qp(n)!=null}function qp(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qm;function rF(n){X(!qm,"__referenceConstructor has already been defined"),qm=n}function sF(){return X(qm,"Reference.ts has not been loaded"),qm}let iF=1;class BE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Nt(null),this.pendingWriteTree_=jV(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function vw(n,e,t,r,s){return SV(n.pendingWriteTree_,e,t,r,s),s?Cc(n,new va(dw(),e,t)):[]}function oF(n,e,t,r){IV(n.pendingWriteTree_,e,t,r);const s=Nt.fromObject(t);return Cc(n,new Jl(dw(),e,s))}function Wi(n,e,t=!1){const r=EV(n.pendingWriteTree_,e);if(bV(n.pendingWriteTree_,e)){let i=new Nt(null);return r.snap!=null?i=i.set(rt(),!0):Ln(r.children,o=>{i=i.set(new ct(o),!0)}),Cc(n,new Vm(r.path,i,t))}else return[]}function sh(n,e,t){return Cc(n,new va(hw(),e,t))}function aF(n,e,t){const r=Nt.fromObject(t);return Cc(n,new Jl(hw(),e,r))}function lF(n,e){return Cc(n,new Td(hw(),e))}function cF(n,e,t){const r=_w(n,t);if(r){const s=ww(r),i=s.path,o=s.queryId,a=or(i,e),c=new Td(fw(o),a);return xw(n,i,c)}else return[]}function Wm(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||OC(o,e))){const c=nF(o,e,t,r);eF(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=c.removed;if(a=c.events,!s){const h=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(m,g)=>yo(g));if(h&&!f){const m=n.syncPointTree_.subtree(i);if(!m.isEmpty()){const g=hF(m);for(let v=0;v<g.length;++v){const _=g[v],R=_.query,x=$C(n,_);n.listenProvider_.startListening(Uu(R),Ad(n,R),x.hashFn,x.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(Uu(e),null):u.forEach(m=>{const g=n.queryToTagMap.get(Gp(m));n.listenProvider_.stopListening(Uu(m),g)}))}fF(n,u)}return a}function LC(n,e,t,r){const s=_w(n,r);if(s!=null){const i=ww(s),o=i.path,a=i.queryId,c=or(o,e),u=new va(fw(a),c,t);return xw(n,o,u)}else return[]}function uF(n,e,t,r){const s=_w(n,r);if(s){const i=ww(s),o=i.path,a=i.queryId,c=or(o,e),u=Nt.fromObject(t),h=new Jl(fw(a),c,u);return xw(n,o,h)}else return[]}function mv(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(m,g)=>{const v=or(m,s);i=i||oo(g,v),o=o||yo(g)});let a=n.syncPointTree_.get(s);a?(o=o||yo(a),i=i||oo(a,rt())):(a=new DC,n.syncPointTree_=n.syncPointTree_.set(s,a));let c;i!=null?c=!0:(c=!1,i=Ce.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((g,v)=>{const _=oo(v,rt());_&&(i=i.updateImmediateChild(g,_))}));const u=OC(a,e);if(!u&&!e._queryParams.loadsAllData()){const m=Gp(e);X(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const g=mF();n.queryToTagMap.set(m,g),n.tagToQueryMap.set(g,m)}const h=zp(n.pendingWriteTree_,s);let f=tF(a,e,t,h,i,c);if(!u&&!o&&!r){const m=MC(a,e);f=f.concat(pF(n,e,m))}return f}function Wp(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=or(o,e),u=oo(a,c);if(u)return u});return TC(s,e,i,t,!0)}function dF(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=or(u,t);r=r||oo(h,f)});let s=n.syncPointTree_.get(t);s?r=r||oo(s,rt()):(s=new DC,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new go(r,!0,!1):null,a=zp(n.pendingWriteTree_,e._path),c=PC(s,e,a,i?o.getNode():Ce.EMPTY_NODE,i);return QV(c)}function Cc(n,e){return VC(e,n.syncPointTree_,null,zp(n.pendingWriteTree_,rt()))}function VC(n,e,t,r){if(Ue(n.path))return FC(n,e,t,r);{const s=e.get(rt());t==null&&s!=null&&(t=oo(s,rt()));let i=[];const o=$e(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const u=t?t.getImmediateChild(o):null,h=AC(r,o);i=i.concat(VC(a,c,u,h))}return s&&(i=i.concat(yw(s,n,r,t))),i}}function FC(n,e,t,r){const s=e.get(rt());t==null&&s!=null&&(t=oo(s,rt()));let i=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,u=AC(r,o),h=n.operationForChild(o);h&&(i=i.concat(FC(h,a,c,u)))}),s&&(i=i.concat(yw(s,n,r,t))),i}function $C(n,e){const t=e.query,r=Ad(n,t);return{hashFn:()=>(HV(e)||Ce.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?cF(n,t._path,r):lF(n,t._path);{const i=o4(s,t);return Wm(n,t,null,i)}}}}function Ad(n,e){const t=Gp(e);return n.queryToTagMap.get(t)}function Gp(n){return n._path.toString()+"$"+n._queryIdentifier}function _w(n,e){return n.tagToQueryMap.get(e)}function ww(n){const e=n.indexOf("$");return X(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ct(n.substr(0,e))}}function xw(n,e,t){const r=n.syncPointTree_.get(e);X(r,"Missing sync point for query tag that we're tracking");const s=zp(n.pendingWriteTree_,e);return yw(r,t,s,null)}function hF(n){return n.fold((e,t,r)=>{if(t&&yo(t))return[qp(t)];{let s=[];return t&&(s=jC(t)),Ln(r,(i,o)=>{s=s.concat(o)}),s}})}function Uu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(sF())(n._repo,n._path):n}function fF(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=Gp(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function mF(){return iF++}function pF(n,e,t){const r=e._path,s=Ad(n,e),i=$C(n,t),o=n.listenProvider_.startListening(Uu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)X(!yo(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,h,f)=>{if(!Ue(u)&&h&&yo(h))return[qp(h).query];{let m=[];return h&&(m=m.concat(jC(h).map(g=>g.query))),Ln(f,(g,v)=>{m=m.concat(v)}),m}});for(let u=0;u<c.length;++u){const h=c[u];n.listenProvider_.stopListening(Uu(h),Ad(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Sw(t)}node(){return this.node_}}class Iw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=qt(this.path_,e);return new Iw(this.syncTree_,t)}node(){return Wp(this.syncTree_,this.path_)}}const gF=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},zE=function(n,e,t){if(!n||typeof n!="object")return n;if(X(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return yF(n[".sv"],e,t);if(typeof n[".sv"]=="object")return vF(n[".sv"],e);X(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},yF=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:X(!1,"Unexpected server value: "+n)}},vF=function(n,e,t){n.hasOwnProperty("increment")||X(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&X(!1,"Unexpected increment value: "+r);const s=e.node();if(X(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},UC=function(n,e,t,r){return bw(e,new Iw(t,n),r)},Ew=function(n,e,t){return bw(n,new Sw(e),t)};function bw(n,e,t){const r=n.getPriority().val(),s=zE(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=zE(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Nn(a,Jt(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Nn(s))),o.forEachChild(kt,(a,c)=>{const u=bw(c,e.getImmediateChild(a),t);u!==c&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Hp(n,e){let t=e instanceof ct?e:new ct(e),r=n,s=$e(t);for(;s!==null;){const i=ga(r.node.children,s)||{children:{},childCount:0};r=new Tw(s,r,i),t=St(t),s=$e(t)}return r}function $a(n){return n.node.value}function Aw(n,e){n.node.value=e,pv(n)}function BC(n){return n.node.childCount>0}function _F(n){return $a(n)===void 0&&!BC(n)}function Qp(n,e){Ln(n.node.children,(t,r)=>{e(new Tw(t,n,r))})}function zC(n,e,t,r){t&&!r&&e(n),Qp(n,s=>{zC(s,e,!0,r)}),t&&r&&e(n)}function wF(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function ih(n){return new ct(n.parent===null?n.name:ih(n.parent)+"/"+n.name)}function pv(n){n.parent!==null&&xF(n.parent,n.name,n)}function xF(n,e,t){const r=_F(t),s=vs(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,pv(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,pv(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SF=/[\[\].#$\/\u0000-\u001F\u007F]/,IF=/[\[\].#$\u0000-\u001F\u007F]/,Py=10*1024*1024,Kp=function(n){return typeof n=="string"&&n.length!==0&&!SF.test(n)},qC=function(n){return typeof n=="string"&&n.length!==0&&!IF.test(n)},EF=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),qC(n)},Nd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Fp(n)||n&&typeof n=="object"&&vs(n,".sv")},Bs=function(n,e,t,r){r&&e===void 0||oh(ya(n,"value"),e,t)},oh=function(n,e,t){const r=t instanceof ct?new $4(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+zo(r));if(typeof e=="function")throw new Error(n+"contains a function "+zo(r)+" with contents = "+e.toString());if(Fp(e))throw new Error(n+"contains "+e.toString()+" "+zo(r));if(typeof e=="string"&&e.length>Py/3&&Vp(e)>Py)throw new Error(n+"contains a string greater than "+Py+" utf8 bytes "+zo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Ln(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Kp(o)))throw new Error(n+" contains an invalid key ("+o+") "+zo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);U4(r,o),oh(n,a,r),B4(r)}),s&&i)throw new Error(n+' contains ".value" child '+zo(r)+" in addition to actual children.")}},bF=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Sd(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Kp(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(F4);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&Hr(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},WC=function(n,e,t,r){if(r&&e===void 0)return;const s=ya(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Ln(e,(o,a)=>{const c=new ct(o);if(oh(s,a,qt(t,c)),rw(c)===".priority"&&!Nd(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),bF(s,i)},Nw=function(n,e,t){if(!(t&&e===void 0)){if(Fp(e))throw new Error(ya(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Nd(e))throw new Error(ya(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ah=function(n,e,t,r){if(!(r&&t===void 0)&&!Kp(t))throw new Error(ya(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Cw=function(n,e,t,r){if(!(r&&t===void 0)&&!qC(t))throw new Error(ya(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},TF=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Cw(n,e,t,r)},Ns=function(n,e){if($e(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},GC=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Kp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!EF(t))throw new Error(ya(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AF{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Yp(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!sw(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function HC(n,e,t){Yp(n,t),QC(n,r=>sw(r,e))}function Lr(n,e,t){Yp(n,t),QC(n,r=>Hr(r,e)||Hr(e,r))}function QC(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(NF(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function NF(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();oa&&Pn("event: "+t.toString()),Ac(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC="repo_interrupt",CF=25;class kF{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new AF,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Lm(),this.transactionQueueTree_=new Tw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function RF(n,e,t){if(n.stats_=tw(n.repoInfo_),n.forceRestClient_||u4())n.server_=new Om(n.repoInfo_,(r,s,i,o)=>{qE(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>WE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{In(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Kr(n.repoInfo_,e,(r,s,i,o)=>{qE(n,r,s,i,o)},r=>{WE(n,r)},r=>{DF(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=p4(n.repoInfo_,()=>new gV(n.stats_,n.server_)),n.infoData_=new dV,n.infoSyncTree_=new BE({startListening:(r,s,i,o)=>{let a=[];const c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=sh(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),kw(n,"connected",!1),n.serverSyncTree_=new BE({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,c)=>{const u=o(a,c);Lr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function YC(n){const t=n.infoData_.getNode(new ct(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function lh(n){return gF({timestamp:YC(n)})}function qE(n,e,t,r,s){n.dataUpdateCount++;const i=new ct(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const c=Rm(t,u=>Jt(u));o=uF(n.serverSyncTree_,i,c,s)}else{const c=Jt(t);o=LC(n.serverSyncTree_,i,c,s)}else if(r){const c=Rm(t,u=>Jt(u));o=aF(n.serverSyncTree_,i,c)}else{const c=Jt(t);o=sh(n.serverSyncTree_,i,c)}let a=i;o.length>0&&(a=Zl(n,i)),Lr(n.eventQueue_,a,o)}function WE(n,e){kw(n,"connected",e),e===!1&&MF(n)}function DF(n,e){Ln(e,(t,r)=>{kw(n,t,r)})}function kw(n,e,t){const r=new ct("/.info/"+e),s=Jt(t);n.infoData_.updateSnapshot(r,s);const i=sh(n.infoSyncTree_,r,s);Lr(n.eventQueue_,r,i)}function Jp(n){return n.nextWriteId_++}function PF(n,e,t){const r=dF(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=Jt(s).withIndex(e._queryParams.getIndex());mv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=sh(n.serverSyncTree_,e._path,i);else{const a=Ad(n.serverSyncTree_,e);o=LC(n.serverSyncTree_,e._path,i,a)}return Lr(n.eventQueue_,e._path,o),Wm(n.serverSyncTree_,e,t,null,!0),i},s=>(kc(n,"get for query "+In(e)+" failed: "+s),Promise.reject(new Error(s))))}function Rw(n,e,t,r,s){kc(n,"set",{path:e.toString(),value:t,priority:r});const i=lh(n),o=Jt(t,r),a=Wp(n.serverSyncTree_,e),c=Ew(o,a,i),u=Jp(n),h=vw(n.serverSyncTree_,e,c,u,!0);Yp(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(m,g)=>{const v=m==="ok";v||tr("set at "+e+" failed: "+m);const _=Wi(n.serverSyncTree_,u,!v);Lr(n.eventQueue_,e,_),vo(n,s,m,g)});const f=Pw(n,e);Zl(n,f),Lr(n.eventQueue_,f,[])}function jF(n,e,t,r){kc(n,"update",{path:e.toString(),value:t});let s=!0;const i=lh(n),o={};if(Ln(t,(a,c)=>{s=!1,o[a]=UC(qt(e,a),Jt(c),n.serverSyncTree_,i)}),s)Pn("update() called with empty data.  Don't do anything."),vo(n,r,"ok",void 0);else{const a=Jp(n),c=oF(n.serverSyncTree_,e,o,a);Yp(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||tr("update at "+e+" failed: "+u);const m=Wi(n.serverSyncTree_,a,!f),g=m.length>0?Zl(n,e):e;Lr(n.eventQueue_,g,m),vo(n,r,u,h)}),Ln(t,u=>{const h=Pw(n,qt(e,u));Zl(n,h)}),Lr(n.eventQueue_,e,[])}}function MF(n){kc(n,"onDisconnectEvents");const e=lh(n),t=Lm();lv(n.onDisconnect_,rt(),(s,i)=>{const o=UC(s,i,n.serverSyncTree_,e);Nc(t,s,o)});let r=[];lv(t,rt(),(s,i)=>{r=r.concat(sh(n.serverSyncTree_,s,i));const o=Pw(n,s);Zl(n,o)}),n.onDisconnect_=Lm(),Lr(n.eventQueue_,rt(),r)}function OF(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&av(n.onDisconnect_,e),vo(n,t,r,s)})}function GE(n,e,t,r){const s=Jt(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Nc(n.onDisconnect_,e,s),vo(n,r,i,o)})}function LF(n,e,t,r,s){const i=Jt(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Nc(n.onDisconnect_,e,i),vo(n,s,o,a)})}function VF(n,e,t,r){if(km(t)){Pn("onDisconnect().update() called with empty data.  Don't do anything."),vo(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Ln(t,(o,a)=>{const c=Jt(a);Nc(n.onDisconnect_,qt(e,o),c)}),vo(n,r,s,i)})}function FF(n,e,t){let r;$e(e._path)===".info"?r=mv(n.infoSyncTree_,e,t):r=mv(n.serverSyncTree_,e,t),HC(n.eventQueue_,e._path,r)}function gv(n,e,t){let r;$e(e._path)===".info"?r=Wm(n.infoSyncTree_,e,t):r=Wm(n.serverSyncTree_,e,t),HC(n.eventQueue_,e._path,r)}function JC(n){n.persistentConnection_&&n.persistentConnection_.interrupt(KC)}function $F(n){n.persistentConnection_&&n.persistentConnection_.resume(KC)}function kc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Pn(t,...e)}function vo(n,e,t,r){e&&Ac(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function UF(n,e,t,r,s,i){kc(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:GN(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Dw(n,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{oh("transaction failed: Data returned ",c,o.path),o.status=0;const u=Hp(n.transactionQueueTree_,e),h=$a(u)||[];h.push(o),Aw(u,h);let f;typeof c=="object"&&c!==null&&vs(c,".priority")?(f=ga(c,".priority"),X(Nd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Wp(n.serverSyncTree_,e)||Ce.EMPTY_NODE).getPriority().val();const m=lh(n),g=Jt(c,f),v=Ew(g,a,m);o.currentOutputSnapshotRaw=g,o.currentOutputSnapshotResolved=v,o.currentWriteId=Jp(n);const _=vw(n.serverSyncTree_,e,v,o.currentWriteId,o.applyLocally);Lr(n.eventQueue_,e,_),Xp(n,n.transactionQueueTree_)}}function Dw(n,e,t){return Wp(n.serverSyncTree_,e,t)||Ce.EMPTY_NODE}function Xp(n,e=n.transactionQueueTree_){if(e||Zp(n,e),$a(e)){const t=ZC(n,e);X(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&BF(n,ih(e),t)}else BC(e)&&Qp(e,t=>{Xp(n,t)})}function BF(n,e,t){const r=t.map(u=>u.currentWriteId),s=Dw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];X(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=or(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),c=e;n.server_.put(c.toString(),a,u=>{kc(n,"transaction put response",{path:c.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let m=0;m<t.length;m++)t[m].status=2,h=h.concat(Wi(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();Zp(n,Hp(n.transactionQueueTree_,e)),Xp(n,n.transactionQueueTree_),Lr(n.eventQueue_,e,h);for(let m=0;m<f.length;m++)Ac(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{tr("transaction at "+c.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}Zl(n,e)}},o)}function Zl(n,e){const t=XC(n,e),r=ih(t),s=ZC(n,t);return zF(n,s,r),r}function zF(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=or(t,c.path);let h=!1,f;if(X(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)h=!0,f=c.abortReason,s=s.concat(Wi(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=CF)h=!0,f="maxretry",s=s.concat(Wi(n.serverSyncTree_,c.currentWriteId,!0));else{const m=Dw(n,c.path,o);c.currentInputSnapshot=m;const g=e[a].update(m.val());if(g!==void 0){oh("transaction failed: Data returned ",g,c.path);let v=Jt(g);typeof g=="object"&&g!=null&&vs(g,".priority")||(v=v.updatePriority(m.getPriority()));const R=c.currentWriteId,x=lh(n),I=Ew(v,m,x);c.currentOutputSnapshotRaw=v,c.currentOutputSnapshotResolved=I,c.currentWriteId=Jp(n),o.splice(o.indexOf(R),1),s=s.concat(vw(n.serverSyncTree_,c.path,I,c.currentWriteId,c.applyLocally)),s=s.concat(Wi(n.serverSyncTree_,R,!0))}else h=!0,f="nodata",s=s.concat(Wi(n.serverSyncTree_,c.currentWriteId,!0))}Lr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Zp(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Ac(r[a]);Xp(n,n.transactionQueueTree_)}function XC(n,e){let t,r=n.transactionQueueTree_;for(t=$e(e);t!==null&&$a(r)===void 0;)r=Hp(r,t),e=St(e),t=$e(e);return r}function ZC(n,e){const t=[];return ek(n,e,t),t.sort((r,s)=>r.order-s.order),t}function ek(n,e,t){const r=$a(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);Qp(e,s=>{ek(n,s,t)})}function Zp(n,e){const t=$a(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,Aw(e,t.length>0?t:void 0)}Qp(e,r=>{Zp(n,r)})}function Pw(n,e){const t=ih(XC(n,e)),r=Hp(n.transactionQueueTree_,e);return wF(r,s=>{jy(n,s)}),jy(n,r),zC(r,s=>{jy(n,s)}),t}function jy(n,e){const t=$a(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(X(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(X(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Wi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Aw(e,void 0):t.length=i+1,Lr(n.eventQueue_,ih(e),s);for(let o=0;o<r.length;o++)Ac(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qF(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function WF(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):tr(`Invalid query segment '${t}' in query '${n}'`)}return e}const yv=function(n,e){const t=GF(n),r=t.namespace;t.domain==="firebase.com"&&Us(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Us("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||t4();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new oC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new ct(t.pathString)}},GF=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=qF(n.substring(h,f)));const m=WF(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const g=e.slice(0,u);if(g.toLowerCase()==="localhost")t="localhost";else if(g.split(".").length<=2)t=g;else{const v=e.indexOf(".");r=e.substring(0,v).toLowerCase(),t=e.substring(v+1),i=r}"ns"in m&&(i=m.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",HF=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=HE.charAt(t%64),t=Math.floor(t/64);X(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=HE.charAt(e[s]);return X(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+In(this.snapshot.exportVal())}}class nk{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return X(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Nr;return OF(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ns("OnDisconnect.remove",this._path);const e=new Nr;return GE(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ns("OnDisconnect.set",this._path),Bs("OnDisconnect.set",e,this._path,!1);const t=new Nr;return GE(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ns("OnDisconnect.setWithPriority",this._path),Bs("OnDisconnect.setWithPriority",e,this._path,!1),Nw("OnDisconnect.setWithPriority",t,!1);const r=new Nr;return LF(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Ns("OnDisconnect.update",this._path),WC("OnDisconnect.update",e,this._path,!1);const t=new Nr;return VF(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return Ue(this._path)?null:rw(this._path)}get ref(){return new _s(this._repo,this._path)}get _queryIdentifier(){const e=DE(this._queryParams),t=Z_(e);return t==="{}"?"default":t}get _queryObject(){return DE(this._queryParams)}isEqual(e){if(e=le(e),!(e instanceof Ur))return!1;const t=this._repo===e._repo,r=sw(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+V4(this._path)}}function eg(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Co(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Ms){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==mo)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==di)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===kt){if(e!=null&&!Nd(e)||t!=null&&!Nd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(X(n.getIndex()instanceof aw||n.getIndex()===lw,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function tg(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class _s extends Ur{constructor(e,t){super(e,t,new uw,!1)}get parent(){const e=pC(this._path);return e===null?null:new _s(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class wa{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ct(e),r=ec(this.ref,e);return new wa(this._node.getChild(t),r,kt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new wa(s,ec(this.ref,r),kt)))}hasChild(e){const t=new ct(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function H(n,e){return n=le(n),n._checkNotDeleted("ref"),e!==void 0?ec(n._root,e):n._root}function t7(n,e){n=le(n),n._checkNotDeleted("refFromURL");const t=yv(e,n._repo.repoInfo_.nodeAdmin);GC("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Us("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),H(n,t.path.toString())}function ec(n,e){return n=le(n),$e(n._path)===null?TF("child","path",e,!1):Cw("child","path",e,!1),new _s(n._repo,qt(n._path,e))}function n7(n){return n=le(n),new QF(n._repo,n._path)}function rk(n,e){n=le(n),Ns("push",n._path),Bs("push",e,n._path,!0);const t=YC(n._repo),r=HF(t),s=ec(n,r),i=ec(n,r);let o;return e!=null?o=Ie(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function KF(n){return Ns("remove",n._path),Ie(n,null)}function Ie(n,e){n=le(n),Ns("set",n._path),Bs("set",e,n._path,!1);const t=new Nr;return Rw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function r7(n,e){n=le(n),Ns("setPriority",n._path),Nw("setPriority",e,!1);const t=new Nr;return Rw(n._repo,qt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function s7(n,e,t){if(Ns("setWithPriority",n._path),Bs("setWithPriority",e,n._path,!1),Nw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Nr;return Rw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function YF(n,e){WC("update",e,n._path,!1);const t=new Nr;return jF(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function _e(n){n=le(n);const e=new jw(()=>{}),t=new ch(e);return PF(n._repo,n,t).then(r=>new wa(r,new _s(n._repo,n._path),n._queryParams.getIndex()))}class ch{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new tk("value",this,new wa(e.snapshotNode,new _s(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new nk(this,e,t):null}matches(e){return e instanceof ch?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class ng{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new nk(this,e,t):null}createEvent(e,t){X(e.childName!=null,"Child events should have a childName.");const r=ec(new _s(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new tk(e.type,this,new wa(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ng?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function uh(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const c=t,u=(h,f)=>{gv(n._repo,n,a),c(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new jw(t,i||void 0),a=e==="value"?new ch(o):new ng(e,o);return FF(n._repo,n,a),()=>gv(n._repo,n,a)}function Mw(n,e,t,r){return uh(n,"value",e,t,r)}function i7(n,e,t,r){return uh(n,"child_added",e,t,r)}function o7(n,e,t,r){return uh(n,"child_changed",e,t,r)}function a7(n,e,t,r){return uh(n,"child_moved",e,t,r)}function l7(n,e,t,r){return uh(n,"child_removed",e,t,r)}function JF(n,e,t){let r=null;const s=t?new jw(t):null;e==="value"?r=new ch(s):e&&(r=new ng(e,s)),gv(n._repo,n,r)}let ws=class{},sk=class extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Bs("endAt",this._value,e._path,!0);const t=ov(e._queryParams,this._value,this._key);if(tg(t),Co(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ur(e._repo,e._path,t,e._orderByCalled)}};function d7(n,e){return ah("endAt","key",e,!0),new sk(n,e)}class XF extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Bs("endBefore",this._value,e._path,!1);const t=uV(e._queryParams,this._value,this._key);if(tg(t),Co(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ur(e._repo,e._path,t,e._orderByCalled)}}function h7(n,e){return ah("endBefore","key",e,!0),new XF(n,e)}let ik=class extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Bs("startAt",this._value,e._path,!0);const t=iv(e._queryParams,this._value,this._key);if(tg(t),Co(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ur(e._repo,e._path,t,e._orderByCalled)}};function m7(n=null,e){return ah("startAt","key",e,!0),new ik(n,e)}class ZF extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Bs("startAfter",this._value,e._path,!1);const t=cV(e._queryParams,this._value,this._key);if(tg(t),Co(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ur(e._repo,e._path,t,e._orderByCalled)}}function p7(n,e){return ah("startAfter","key",e,!0),new ZF(n,e)}class e3 extends ws{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ur(e._repo,e._path,aV(e._queryParams,this._limit),e._orderByCalled)}}function g7(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new e3(n)}class t3 extends ws{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ur(e._repo,e._path,lV(e._queryParams,this._limit),e._orderByCalled)}}function y7(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new t3(n)}class n3 extends ws{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){eg(e,"orderByChild");const t=new ct(this._path);if(Ue(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new aw(t),s=Up(e._queryParams,r);return Co(s),new Ur(e._repo,e._path,s,!0)}}function v7(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Cw("orderByChild","path",n,!1),new n3(n)}class r3 extends ws{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){eg(e,"orderByKey");const t=Up(e._queryParams,Ms);return Co(t),new Ur(e._repo,e._path,t,!0)}}function _7(){return new r3}class s3 extends ws{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){eg(e,"orderByPriority");const t=Up(e._queryParams,kt);return Co(t),new Ur(e._repo,e._path,t,!0)}}function w7(){return new s3}class i3 extends ws{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){eg(e,"orderByValue");const t=Up(e._queryParams,lw);return Co(t),new Ur(e._repo,e._path,t,!0)}}function x7(){return new i3}class o3 extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Bs("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new sk(this._value,this._key)._apply(new ik(this._value,this._key)._apply(e))}}function S7(n,e){return ah("equalTo","key",e,!0),new o3(n,e)}function a3(n,...e){let t=le(n);for(const r of e)t=r._apply(t);return t}XV(_s);rF(_s);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l3="FIREBASE_DATABASE_EMULATOR_HOST",vv={};let ok=!1;function c3(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=vi(i);n.repoInfo_=new oC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function ak(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Us("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Pn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=yv(i,s),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[l3]),u?(c=!0,i=`http://${u}?ns=${a.namespace}`,o=yv(i,s),a=o.repoInfo):c=!o.repoInfo.secure;const h=s&&c?new Pl(Pl.OWNER):new h4(n.name,n.options,e);GC("Invalid Firebase Database URL",o),Ue(o.path)||Us("Database URL must point to the root of a Firebase Database (not including a child path).");const f=d3(a,n,h,new d4(n,t));return new f3(f,n)}function u3(n,e){const t=vv[e];(!t||t[n.key]!==n)&&Us(`Database ${e}(${n.repoInfo_}) has already been deleted.`),JC(n),delete t[n.key]}function d3(n,e,t,r){let s=vv[e.name];s||(s={},vv[e.name]=s);let i=s[n.toURLString()];return i&&Us("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new kF(n,ok,t,r),s[n.toURLString()]=i,i}function h3(n){ok=n}let f3=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(RF(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new _s(this._repo,rt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(u3(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Us("Cannot call "+e+" on a deleted database.")}};function lk(){Kl.IS_TRANSPORT_INITIALIZED&&tr("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function E7(){lk(),qi.forceDisallow()}function b7(){lk(),Wr.forceDisallow(),qi.forceAllow()}function ck(n=Tc(),e){const t=qs(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=TN("database");r&&m3(t,...r)}return t}function m3(n,e,t,r={}){n=le(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Or(r,i.repoInfo_.emulatorOptions))return;Us("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Us('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Pl(Pl.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:CN(r.mockUserToken,n.app.options.projectId);o=new Pl(a)}vi(e)&&(Op(e),G_("Database",!0)),c3(i,s,r,o)}function T7(n){n=le(n),n._checkNotDeleted("goOffline"),JC(n._repo)}function A7(n){n=le(n),n._checkNotDeleted("goOnline"),$F(n._repo)}function N7(n,e){QN(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3(n){qN(La),gs(new xr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return ak(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),_r(pE,gE,n),_r(pE,gE,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g3={".sv":"timestamp"};function C7(){return g3}function k7(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y3{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function R7(n,e,t){if(n=le(n),Ns("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new Nr,i=(a,c,u)=>{let h=null;a?s.reject(a):(h=new wa(u,new _s(n._repo,n._path),kt),s.resolve(new y3(c,h)))},o=Mw(n,()=>{});return UF(n._repo,n._path,e,i,o,r),s.promise}Kr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Kr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const D7=function(n){const e=Kr.prototype.put;return Kr.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){Kr.prototype.put=e}},P7=function(n){h3(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j7({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){qN(t);const o=new LN("database-standalone"),a=new Y0("auth-internal",o);let c;return s&&(c=new Y0("app-check-internal",o),c.setComponent(new xr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new xr("auth-internal",()=>r,"PRIVATE")),ak(n,a,c,e,i)}p3();var QE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ao,uk;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,S){function E(){}E.prototype=S.prototype,A.D=S.prototype,A.prototype=new E,A.prototype.constructor=A,A.C=function(N,k,b){for(var w=Array(arguments.length-2),U=2;U<arguments.length;U++)w[U-2]=arguments[U];return S.prototype[k].apply(N,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,S,E){E||(E=0);var N=Array(16);if(typeof S=="string")for(var k=0;16>k;++k)N[k]=S.charCodeAt(E++)|S.charCodeAt(E++)<<8|S.charCodeAt(E++)<<16|S.charCodeAt(E++)<<24;else for(k=0;16>k;++k)N[k]=S[E++]|S[E++]<<8|S[E++]<<16|S[E++]<<24;S=A.g[0],E=A.g[1],k=A.g[2];var b=A.g[3],w=S+(b^E&(k^b))+N[0]+3614090360&4294967295;S=E+(w<<7&4294967295|w>>>25),w=b+(k^S&(E^k))+N[1]+3905402710&4294967295,b=S+(w<<12&4294967295|w>>>20),w=k+(E^b&(S^E))+N[2]+606105819&4294967295,k=b+(w<<17&4294967295|w>>>15),w=E+(S^k&(b^S))+N[3]+3250441966&4294967295,E=k+(w<<22&4294967295|w>>>10),w=S+(b^E&(k^b))+N[4]+4118548399&4294967295,S=E+(w<<7&4294967295|w>>>25),w=b+(k^S&(E^k))+N[5]+1200080426&4294967295,b=S+(w<<12&4294967295|w>>>20),w=k+(E^b&(S^E))+N[6]+2821735955&4294967295,k=b+(w<<17&4294967295|w>>>15),w=E+(S^k&(b^S))+N[7]+4249261313&4294967295,E=k+(w<<22&4294967295|w>>>10),w=S+(b^E&(k^b))+N[8]+1770035416&4294967295,S=E+(w<<7&4294967295|w>>>25),w=b+(k^S&(E^k))+N[9]+2336552879&4294967295,b=S+(w<<12&4294967295|w>>>20),w=k+(E^b&(S^E))+N[10]+4294925233&4294967295,k=b+(w<<17&4294967295|w>>>15),w=E+(S^k&(b^S))+N[11]+2304563134&4294967295,E=k+(w<<22&4294967295|w>>>10),w=S+(b^E&(k^b))+N[12]+1804603682&4294967295,S=E+(w<<7&4294967295|w>>>25),w=b+(k^S&(E^k))+N[13]+4254626195&4294967295,b=S+(w<<12&4294967295|w>>>20),w=k+(E^b&(S^E))+N[14]+2792965006&4294967295,k=b+(w<<17&4294967295|w>>>15),w=E+(S^k&(b^S))+N[15]+1236535329&4294967295,E=k+(w<<22&4294967295|w>>>10),w=S+(k^b&(E^k))+N[1]+4129170786&4294967295,S=E+(w<<5&4294967295|w>>>27),w=b+(E^k&(S^E))+N[6]+3225465664&4294967295,b=S+(w<<9&4294967295|w>>>23),w=k+(S^E&(b^S))+N[11]+643717713&4294967295,k=b+(w<<14&4294967295|w>>>18),w=E+(b^S&(k^b))+N[0]+3921069994&4294967295,E=k+(w<<20&4294967295|w>>>12),w=S+(k^b&(E^k))+N[5]+3593408605&4294967295,S=E+(w<<5&4294967295|w>>>27),w=b+(E^k&(S^E))+N[10]+38016083&4294967295,b=S+(w<<9&4294967295|w>>>23),w=k+(S^E&(b^S))+N[15]+3634488961&4294967295,k=b+(w<<14&4294967295|w>>>18),w=E+(b^S&(k^b))+N[4]+3889429448&4294967295,E=k+(w<<20&4294967295|w>>>12),w=S+(k^b&(E^k))+N[9]+568446438&4294967295,S=E+(w<<5&4294967295|w>>>27),w=b+(E^k&(S^E))+N[14]+3275163606&4294967295,b=S+(w<<9&4294967295|w>>>23),w=k+(S^E&(b^S))+N[3]+4107603335&4294967295,k=b+(w<<14&4294967295|w>>>18),w=E+(b^S&(k^b))+N[8]+1163531501&4294967295,E=k+(w<<20&4294967295|w>>>12),w=S+(k^b&(E^k))+N[13]+2850285829&4294967295,S=E+(w<<5&4294967295|w>>>27),w=b+(E^k&(S^E))+N[2]+4243563512&4294967295,b=S+(w<<9&4294967295|w>>>23),w=k+(S^E&(b^S))+N[7]+1735328473&4294967295,k=b+(w<<14&4294967295|w>>>18),w=E+(b^S&(k^b))+N[12]+2368359562&4294967295,E=k+(w<<20&4294967295|w>>>12),w=S+(E^k^b)+N[5]+4294588738&4294967295,S=E+(w<<4&4294967295|w>>>28),w=b+(S^E^k)+N[8]+2272392833&4294967295,b=S+(w<<11&4294967295|w>>>21),w=k+(b^S^E)+N[11]+1839030562&4294967295,k=b+(w<<16&4294967295|w>>>16),w=E+(k^b^S)+N[14]+4259657740&4294967295,E=k+(w<<23&4294967295|w>>>9),w=S+(E^k^b)+N[1]+2763975236&4294967295,S=E+(w<<4&4294967295|w>>>28),w=b+(S^E^k)+N[4]+1272893353&4294967295,b=S+(w<<11&4294967295|w>>>21),w=k+(b^S^E)+N[7]+4139469664&4294967295,k=b+(w<<16&4294967295|w>>>16),w=E+(k^b^S)+N[10]+3200236656&4294967295,E=k+(w<<23&4294967295|w>>>9),w=S+(E^k^b)+N[13]+681279174&4294967295,S=E+(w<<4&4294967295|w>>>28),w=b+(S^E^k)+N[0]+3936430074&4294967295,b=S+(w<<11&4294967295|w>>>21),w=k+(b^S^E)+N[3]+3572445317&4294967295,k=b+(w<<16&4294967295|w>>>16),w=E+(k^b^S)+N[6]+76029189&4294967295,E=k+(w<<23&4294967295|w>>>9),w=S+(E^k^b)+N[9]+3654602809&4294967295,S=E+(w<<4&4294967295|w>>>28),w=b+(S^E^k)+N[12]+3873151461&4294967295,b=S+(w<<11&4294967295|w>>>21),w=k+(b^S^E)+N[15]+530742520&4294967295,k=b+(w<<16&4294967295|w>>>16),w=E+(k^b^S)+N[2]+3299628645&4294967295,E=k+(w<<23&4294967295|w>>>9),w=S+(k^(E|~b))+N[0]+4096336452&4294967295,S=E+(w<<6&4294967295|w>>>26),w=b+(E^(S|~k))+N[7]+1126891415&4294967295,b=S+(w<<10&4294967295|w>>>22),w=k+(S^(b|~E))+N[14]+2878612391&4294967295,k=b+(w<<15&4294967295|w>>>17),w=E+(b^(k|~S))+N[5]+4237533241&4294967295,E=k+(w<<21&4294967295|w>>>11),w=S+(k^(E|~b))+N[12]+1700485571&4294967295,S=E+(w<<6&4294967295|w>>>26),w=b+(E^(S|~k))+N[3]+2399980690&4294967295,b=S+(w<<10&4294967295|w>>>22),w=k+(S^(b|~E))+N[10]+4293915773&4294967295,k=b+(w<<15&4294967295|w>>>17),w=E+(b^(k|~S))+N[1]+2240044497&4294967295,E=k+(w<<21&4294967295|w>>>11),w=S+(k^(E|~b))+N[8]+1873313359&4294967295,S=E+(w<<6&4294967295|w>>>26),w=b+(E^(S|~k))+N[15]+4264355552&4294967295,b=S+(w<<10&4294967295|w>>>22),w=k+(S^(b|~E))+N[6]+2734768916&4294967295,k=b+(w<<15&4294967295|w>>>17),w=E+(b^(k|~S))+N[13]+1309151649&4294967295,E=k+(w<<21&4294967295|w>>>11),w=S+(k^(E|~b))+N[4]+4149444226&4294967295,S=E+(w<<6&4294967295|w>>>26),w=b+(E^(S|~k))+N[11]+3174756917&4294967295,b=S+(w<<10&4294967295|w>>>22),w=k+(S^(b|~E))+N[2]+718787259&4294967295,k=b+(w<<15&4294967295|w>>>17),w=E+(b^(k|~S))+N[9]+3951481745&4294967295,A.g[0]=A.g[0]+S&4294967295,A.g[1]=A.g[1]+(k+(w<<21&4294967295|w>>>11))&4294967295,A.g[2]=A.g[2]+k&4294967295,A.g[3]=A.g[3]+b&4294967295}r.prototype.u=function(A,S){S===void 0&&(S=A.length);for(var E=S-this.blockSize,N=this.B,k=this.h,b=0;b<S;){if(k==0)for(;b<=E;)s(this,A,b),b+=this.blockSize;if(typeof A=="string"){for(;b<S;)if(N[k++]=A.charCodeAt(b++),k==this.blockSize){s(this,N),k=0;break}}else for(;b<S;)if(N[k++]=A[b++],k==this.blockSize){s(this,N),k=0;break}}this.h=k,this.o+=S},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var S=1;S<A.length-8;++S)A[S]=0;var E=8*this.o;for(S=A.length-8;S<A.length;++S)A[S]=E&255,E/=256;for(this.u(A),A=Array(16),S=E=0;4>S;++S)for(var N=0;32>N;N+=8)A[E++]=this.g[S]>>>N&255;return A};function i(A,S){var E=a;return Object.prototype.hasOwnProperty.call(E,A)?E[A]:E[A]=S(A)}function o(A,S){this.h=S;for(var E=[],N=!0,k=A.length-1;0<=k;k--){var b=A[k]|0;N&&b==S||(E[k]=b,N=!1)}this.g=E}var a={};function c(A){return-128<=A&&128>A?i(A,function(S){return new o([S|0],0>S?-1:0)}):new o([A|0],0>A?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return R(u(-A));for(var S=[],E=1,N=0;A>=E;N++)S[N]=A/E|0,E*=4294967296;return new o(S,0)}function h(A,S){if(A.length==0)throw Error("number format error: empty string");if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(A.charAt(0)=="-")return R(h(A.substring(1),S));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=u(Math.pow(S,8)),N=f,k=0;k<A.length;k+=8){var b=Math.min(8,A.length-k),w=parseInt(A.substring(k,k+b),S);8>b?(b=u(Math.pow(S,b)),N=N.j(b).add(u(w))):(N=N.j(E),N=N.add(u(w)))}return N}var f=c(0),m=c(1),g=c(16777216);n=o.prototype,n.m=function(){if(_(this))return-R(this).m();for(var A=0,S=1,E=0;E<this.g.length;E++){var N=this.i(E);A+=(0<=N?N:4294967296+N)*S,S*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(v(this))return"0";if(_(this))return"-"+R(this).toString(A);for(var S=u(Math.pow(A,6)),E=this,N="";;){var k=P(E,S).g;E=x(E,k.j(S));var b=((0<E.g.length?E.g[0]:E.h)>>>0).toString(A);if(E=k,v(E))return b+N;for(;6>b.length;)b="0"+b;N=b+N}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function v(A){if(A.h!=0)return!1;for(var S=0;S<A.g.length;S++)if(A.g[S]!=0)return!1;return!0}function _(A){return A.h==-1}n.l=function(A){return A=x(this,A),_(A)?-1:v(A)?0:1};function R(A){for(var S=A.g.length,E=[],N=0;N<S;N++)E[N]=~A.g[N];return new o(E,~A.h).add(m)}n.abs=function(){return _(this)?R(this):this},n.add=function(A){for(var S=Math.max(this.g.length,A.g.length),E=[],N=0,k=0;k<=S;k++){var b=N+(this.i(k)&65535)+(A.i(k)&65535),w=(b>>>16)+(this.i(k)>>>16)+(A.i(k)>>>16);N=w>>>16,b&=65535,w&=65535,E[k]=w<<16|b}return new o(E,E[E.length-1]&-2147483648?-1:0)};function x(A,S){return A.add(R(S))}n.j=function(A){if(v(this)||v(A))return f;if(_(this))return _(A)?R(this).j(R(A)):R(R(this).j(A));if(_(A))return R(this.j(R(A)));if(0>this.l(g)&&0>A.l(g))return u(this.m()*A.m());for(var S=this.g.length+A.g.length,E=[],N=0;N<2*S;N++)E[N]=0;for(N=0;N<this.g.length;N++)for(var k=0;k<A.g.length;k++){var b=this.i(N)>>>16,w=this.i(N)&65535,U=A.i(k)>>>16,q=A.i(k)&65535;E[2*N+2*k]+=w*q,I(E,2*N+2*k),E[2*N+2*k+1]+=b*q,I(E,2*N+2*k+1),E[2*N+2*k+1]+=w*U,I(E,2*N+2*k+1),E[2*N+2*k+2]+=b*U,I(E,2*N+2*k+2)}for(N=0;N<S;N++)E[N]=E[2*N+1]<<16|E[2*N];for(N=S;N<2*S;N++)E[N]=0;return new o(E,0)};function I(A,S){for(;(A[S]&65535)!=A[S];)A[S+1]+=A[S]>>>16,A[S]&=65535,S++}function C(A,S){this.g=A,this.h=S}function P(A,S){if(v(S))throw Error("division by zero");if(v(A))return new C(f,f);if(_(A))return S=P(R(A),S),new C(R(S.g),R(S.h));if(_(S))return S=P(A,R(S)),new C(R(S.g),S.h);if(30<A.g.length){if(_(A)||_(S))throw Error("slowDivide_ only works with positive integers.");for(var E=m,N=S;0>=N.l(A);)E=$(E),N=$(N);var k=V(E,1),b=V(N,1);for(N=V(N,2),E=V(E,2);!v(N);){var w=b.add(N);0>=w.l(A)&&(k=k.add(E),b=w),N=V(N,1),E=V(E,1)}return S=x(A,k.j(S)),new C(k,S)}for(k=f;0<=A.l(S);){for(E=Math.max(1,Math.floor(A.m()/S.m())),N=Math.ceil(Math.log(E)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),b=u(E),w=b.j(S);_(w)||0<w.l(A);)E-=N,b=u(E),w=b.j(S);v(b)&&(b=m),k=k.add(b),A=x(A,w)}return new C(k,A)}n.A=function(A){return P(this,A).h},n.and=function(A){for(var S=Math.max(this.g.length,A.g.length),E=[],N=0;N<S;N++)E[N]=this.i(N)&A.i(N);return new o(E,this.h&A.h)},n.or=function(A){for(var S=Math.max(this.g.length,A.g.length),E=[],N=0;N<S;N++)E[N]=this.i(N)|A.i(N);return new o(E,this.h|A.h)},n.xor=function(A){for(var S=Math.max(this.g.length,A.g.length),E=[],N=0;N<S;N++)E[N]=this.i(N)^A.i(N);return new o(E,this.h^A.h)};function $(A){for(var S=A.g.length+1,E=[],N=0;N<S;N++)E[N]=A.i(N)<<1|A.i(N-1)>>>31;return new o(E,A.h)}function V(A,S){var E=S>>5;S%=32;for(var N=A.g.length-E,k=[],b=0;b<N;b++)k[b]=0<S?A.i(b+E)>>>S|A.i(b+E+1)<<32-S:A.i(b+E);return new o(k,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,uk=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,ao=o}).apply(typeof QE<"u"?QE:typeof self<"u"?self:typeof window<"u"?window:{});var hf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var dk,Iu,hk,Bf,_v,fk,mk,pk;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,p,y){return d==Array.prototype||d==Object.prototype||(d[p]=y.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof hf=="object"&&hf];for(var p=0;p<d.length;++p){var y=d[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(d,p){if(p)e:{var y=r;d=d.split(".");for(var T=0;T<d.length-1;T++){var j=d[T];if(!(j in y))break e;y=y[j]}d=d[d.length-1],T=y[d],p=p(T),p!=T&&p!=null&&e(y,d,{configurable:!0,writable:!0,value:p})}}function i(d,p){d instanceof String&&(d+="");var y=0,T=!1,j={next:function(){if(!T&&y<d.length){var F=y++;return{value:p(F,d[F]),done:!1}}return T=!0,{done:!0,value:void 0}}};return j[Symbol.iterator]=function(){return j},j}s("Array.prototype.values",function(d){return d||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function c(d){var p=typeof d;return p=p!="object"?p:d?Array.isArray(d)?"array":p:"null",p=="array"||p=="object"&&typeof d.length=="number"}function u(d){var p=typeof d;return p=="object"&&d!=null||p=="function"}function h(d,p,y){return d.call.apply(d.bind,arguments)}function f(d,p,y){if(!d)throw Error();if(2<arguments.length){var T=Array.prototype.slice.call(arguments,2);return function(){var j=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(j,T),d.apply(p,j)}}return function(){return d.apply(p,arguments)}}function m(d,p,y){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function g(d,p){var y=Array.prototype.slice.call(arguments,1);return function(){var T=y.slice();return T.push.apply(T,arguments),d.apply(this,T)}}function v(d,p){function y(){}y.prototype=p.prototype,d.aa=p.prototype,d.prototype=new y,d.prototype.constructor=d,d.Qb=function(T,j,F){for(var ie=Array(arguments.length-2),xt=2;xt<arguments.length;xt++)ie[xt-2]=arguments[xt];return p.prototype[j].apply(T,ie)}}function _(d){const p=d.length;if(0<p){const y=Array(p);for(let T=0;T<p;T++)y[T]=d[T];return y}return[]}function R(d,p){for(let y=1;y<arguments.length;y++){const T=arguments[y];if(c(T)){const j=d.length||0,F=T.length||0;d.length=j+F;for(let ie=0;ie<F;ie++)d[j+ie]=T[ie]}else d.push(T)}}class x{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function I(d){return/^[\s\xa0]*$/.test(d)}function C(){var d=a.navigator;return d&&(d=d.userAgent)?d:""}function P(d){return P[" "](d),d}P[" "]=function(){};var $=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function V(d,p,y){for(const T in d)p.call(y,d[T],T,d)}function A(d,p){for(const y in d)p.call(void 0,d[y],y,d)}function S(d){const p={};for(const y in d)p[y]=d[y];return p}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(d,p){let y,T;for(let j=1;j<arguments.length;j++){T=arguments[j];for(y in T)d[y]=T[y];for(let F=0;F<E.length;F++)y=E[F],Object.prototype.hasOwnProperty.call(T,y)&&(d[y]=T[y])}}function k(d){var p=1;d=d.split(":");const y=[];for(;0<p&&d.length;)y.push(d.shift()),p--;return d.length&&y.push(d.join(":")),y}function b(d){a.setTimeout(()=>{throw d},0)}function w(){var d=ne;let p=null;return d.g&&(p=d.g,d.g=d.g.next,d.g||(d.h=null),p.next=null),p}class U{constructor(){this.h=this.g=null}add(p,y){const T=q.get();T.set(p,y),this.h?this.h.next=T:this.g=T,this.h=T}}var q=new x(()=>new ve,d=>d.reset());class ve{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let Te,z=!1,ne=new U,W=()=>{const d=a.Promise.resolve(void 0);Te=()=>{d.then(Q)}};var Q=()=>{for(var d;d=w();){try{d.h.call(d.g)}catch(y){b(y)}var p=q;p.j(d),100>p.h&&(p.h++,d.next=p.g,p.g=d)}z=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function me(d,p){this.type=d,this.g=this.target=p,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var we=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var d=!1,p=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return d}();function De(d,p){if(me.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var y=this.type=d.type,T=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=p,p=d.relatedTarget){if($){e:{try{P(p.nodeName);var j=!0;break e}catch{}j=!1}j||(p=null)}}else y=="mouseover"?p=d.fromElement:y=="mouseout"&&(p=d.toElement);this.relatedTarget=p,T?(this.clientX=T.clientX!==void 0?T.clientX:T.pageX,this.clientY=T.clientY!==void 0?T.clientY:T.pageY,this.screenX=T.screenX||0,this.screenY=T.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:Re[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&De.aa.h.call(this)}}v(De,me);var Re={2:"touch",3:"pen",4:"mouse"};De.prototype.h=function(){De.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var vt="closure_listenable_"+(1e6*Math.random()|0),Ne=0;function Ae(d,p,y,T,j){this.listener=d,this.proxy=null,this.src=p,this.type=y,this.capture=!!T,this.ha=j,this.key=++Ne,this.da=this.fa=!1}function Pe(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function Ee(d){this.src=d,this.g={},this.h=0}Ee.prototype.add=function(d,p,y,T,j){var F=d.toString();d=this.g[F],d||(d=this.g[F]=[],this.h++);var ie=Et(d,p,T,j);return-1<ie?(p=d[ie],y||(p.fa=!1)):(p=new Ae(p,this.src,F,!!T,j),p.fa=y,d.push(p)),p};function Je(d,p){var y=p.type;if(y in d.g){var T=d.g[y],j=Array.prototype.indexOf.call(T,p,void 0),F;(F=0<=j)&&Array.prototype.splice.call(T,j,1),F&&(Pe(p),d.g[y].length==0&&(delete d.g[y],d.h--))}}function Et(d,p,y,T){for(var j=0;j<d.length;++j){var F=d[j];if(!F.da&&F.listener==p&&F.capture==!!y&&F.ha==T)return j}return-1}var ut="closure_lm_"+(1e6*Math.random()|0),ee={};function xe(d,p,y,T,j){if(T&&T.once)return be(d,p,y,T,j);if(Array.isArray(p)){for(var F=0;F<p.length;F++)xe(d,p[F],y,T,j);return null}return y=Le(y),d&&d[vt]?d.K(p,y,u(T)?!!T.capture:!!T,j):pe(d,p,y,!1,T,j)}function pe(d,p,y,T,j,F){if(!p)throw Error("Invalid event type");var ie=u(j)?!!j.capture:!!j,xt=Xe(d);if(xt||(d[ut]=xt=new Ee(d)),y=xt.add(p,y,T,ie,F),y.proxy)return y;if(T=je(),y.proxy=T,T.src=d,T.listener=y,d.addEventListener)we||(j=ie),j===void 0&&(j=!1),d.addEventListener(p.toString(),T,j);else if(d.attachEvent)d.attachEvent(bt(p.toString()),T);else if(d.addListener&&d.removeListener)d.addListener(T);else throw Error("addEventListener and attachEvent are unavailable.");return y}function je(){function d(y){return p.call(d.src,d.listener,y)}const p=dt;return d}function be(d,p,y,T,j){if(Array.isArray(p)){for(var F=0;F<p.length;F++)be(d,p[F],y,T,j);return null}return y=Le(y),d&&d[vt]?d.L(p,y,u(T)?!!T.capture:!!T,j):pe(d,p,y,!0,T,j)}function ge(d,p,y,T,j){if(Array.isArray(p))for(var F=0;F<p.length;F++)ge(d,p[F],y,T,j);else T=u(T)?!!T.capture:!!T,y=Le(y),d&&d[vt]?(d=d.i,p=String(p).toString(),p in d.g&&(F=d.g[p],y=Et(F,y,T,j),-1<y&&(Pe(F[y]),Array.prototype.splice.call(F,y,1),F.length==0&&(delete d.g[p],d.h--)))):d&&(d=Xe(d))&&(p=d.g[p.toString()],d=-1,p&&(d=Et(p,y,T,j)),(y=-1<d?p[d]:null)&&at(y))}function at(d){if(typeof d!="number"&&d&&!d.da){var p=d.src;if(p&&p[vt])Je(p.i,d);else{var y=d.type,T=d.proxy;p.removeEventListener?p.removeEventListener(y,T,d.capture):p.detachEvent?p.detachEvent(bt(y),T):p.addListener&&p.removeListener&&p.removeListener(T),(y=Xe(p))?(Je(y,d),y.h==0&&(y.src=null,p[ut]=null)):Pe(d)}}}function bt(d){return d in ee?ee[d]:ee[d]="on"+d}function dt(d,p){if(d.da)d=!0;else{p=new De(p,this);var y=d.listener,T=d.ha||d.src;d.fa&&at(d),d=y.call(T,p)}return d}function Xe(d){return d=d[ut],d instanceof Ee?d:null}var st="__closure_events_fn_"+(1e9*Math.random()>>>0);function Le(d){return typeof d=="function"?d:(d[st]||(d[st]=function(p){return d.handleEvent(p)}),d[st])}function he(){Z.call(this),this.i=new Ee(this),this.M=this,this.F=null}v(he,Z),he.prototype[vt]=!0,he.prototype.removeEventListener=function(d,p,y,T){ge(this,d,p,y,T)};function Me(d,p){var y,T=d.F;if(T)for(y=[];T;T=T.F)y.push(T);if(d=d.M,T=p.type||p,typeof p=="string")p=new me(p,d);else if(p instanceof me)p.target=p.target||d;else{var j=p;p=new me(T,d),N(p,j)}if(j=!0,y)for(var F=y.length-1;0<=F;F--){var ie=p.g=y[F];j=Ht(ie,T,!0,p)&&j}if(ie=p.g=d,j=Ht(ie,T,!0,p)&&j,j=Ht(ie,T,!1,p)&&j,y)for(F=0;F<y.length;F++)ie=p.g=y[F],j=Ht(ie,T,!1,p)&&j}he.prototype.N=function(){if(he.aa.N.call(this),this.i){var d=this.i,p;for(p in d.g){for(var y=d.g[p],T=0;T<y.length;T++)Pe(y[T]);delete d.g[p],d.h--}}this.F=null},he.prototype.K=function(d,p,y,T){return this.i.add(String(d),p,!1,y,T)},he.prototype.L=function(d,p,y,T){return this.i.add(String(d),p,!0,y,T)};function Ht(d,p,y,T){if(p=d.i.g[String(p)],!p)return!0;p=p.concat();for(var j=!0,F=0;F<p.length;++F){var ie=p[F];if(ie&&!ie.da&&ie.capture==y){var xt=ie.listener,Un=ie.ha||ie.src;ie.fa&&Je(d.i,ie),j=xt.call(Un,T)!==!1&&j}}return j&&!T.defaultPrevented}function Tt(d,p,y){if(typeof d=="function")y&&(d=m(d,y));else if(d&&typeof d.handleEvent=="function")d=m(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(d,p||0)}function tn(d){d.g=Tt(()=>{d.g=null,d.i&&(d.i=!1,tn(d))},d.l);const p=d.h;d.h=null,d.m.apply(null,p)}class mn extends Z{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:tn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qt(d){Z.call(this),this.h=d,this.g={}}v(Qt,Z);var xn=[];function nn(d){V(d.g,function(p,y){this.g.hasOwnProperty(y)&&at(p)},d),d.g={}}Qt.prototype.N=function(){Qt.aa.N.call(this),nn(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pn=a.JSON.stringify,un=a.JSON.parse,Kt=class{stringify(d){return a.JSON.stringify(d,void 0)}parse(d){return a.JSON.parse(d,void 0)}};function Hn(){}Hn.prototype.h=null;function qe(d){return d.h||(d.h=d.i())}function Qe(){}var rn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function oe(){me.call(this,"d")}v(oe,me);function lt(){me.call(this,"c")}v(lt,me);var Dt={},es=null;function An(){return es=es||new he}Dt.La="serverreachability";function Ka(d){me.call(this,Dt.La,d)}v(Ka,me);function Oo(d){const p=An();Me(p,new Ka(p))}Dt.STAT_EVENT="statevent";function Dh(d,p){me.call(this,Dt.STAT_EVENT,d),this.stat=p}v(Dh,me);function Fn(d){const p=An();Me(p,new Dh(p,d))}Dt.Ma="timingevent";function Ph(d,p){me.call(this,Dt.Ma,d),this.size=p}v(Ph,me);function O(d,p){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){d()},p)}function Y(){this.g=!0}Y.prototype.xa=function(){this.g=!1};function te(d,p,y,T,j,F){d.info(function(){if(d.g)if(F)for(var ie="",xt=F.split("&"),Un=0;Un<xt.length;Un++){var nt=xt[Un].split("=");if(1<nt.length){var Qn=nt[0];nt=nt[1];var Kn=Qn.split("_");ie=2<=Kn.length&&Kn[1]=="type"?ie+(Qn+"="+nt+"&"):ie+(Qn+"=redacted&")}}else ie=null;else ie=F;return"XMLHTTP REQ ("+T+") [attempt "+j+"]: "+p+`
`+y+`
`+ie})}function et(d,p,y,T,j,F,ie){d.info(function(){return"XMLHTTP RESP ("+T+") [ attempt "+j+"]: "+p+`
`+y+`
`+F+" "+ie})}function _t(d,p,y,T){d.info(function(){return"XMLHTTP TEXT ("+p+"): "+Se(d,y)+(T?" "+T:"")})}function gn(d,p){d.info(function(){return"TIMEOUT: "+p})}Y.prototype.info=function(){};function Se(d,p){if(!d.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(d=0;d<y.length;d++)if(Array.isArray(y[d])){var T=y[d];if(!(2>T.length)){var j=T[1];if(Array.isArray(j)&&!(1>j.length)){var F=j[0];if(F!="noop"&&F!="stop"&&F!="close")for(var ie=1;ie<j.length;ie++)j[ie]=""}}}}return pn(y)}catch{return p}}var Ye={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},it={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},At;function gt(){}v(gt,Hn),gt.prototype.g=function(){return new XMLHttpRequest},gt.prototype.i=function(){return{}},At=new gt;function sn(d,p,y,T){this.j=d,this.i=p,this.l=y,this.R=T||1,this.U=new Qt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new bi}function bi(){this.i=null,this.g="",this.h=!1}var Ir={},ot={};function wt(d,p,y){d.L=1,d.v=Oh(Ws(p)),d.m=y,d.P=!0,$n(d,null)}function $n(d,p){d.F=Date.now(),Ja(d),d.A=Ws(d.v);var y=d.A,T=d.R;Array.isArray(T)||(T=[String(T)]),TS(y.i,"t",T),d.C=0,y=d.j.J,d.h=new bi,d.g=qS(d.j,y?p:null,!d.m),0<d.O&&(d.M=new mn(m(d.Y,d,d.g),d.O)),p=d.U,y=d.g,T=d.ca;var j="readystatechange";Array.isArray(j)||(j&&(xn[0]=j.toString()),j=xn);for(var F=0;F<j.length;F++){var ie=xe(y,j[F],T||p.handleEvent,!1,p.h||p);if(!ie)break;p.g[ie.key]=ie}p=d.H?S(d.H):{},d.m?(d.u||(d.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,p)):(d.u="GET",d.g.ea(d.A,d.u,null,p)),Oo(),te(d.i,d.u,d.A,d.l,d.R,d.m)}sn.prototype.ca=function(d){d=d.target;const p=this.M;p&&Gs(d)==3?p.j():this.Y(d)},sn.prototype.Y=function(d){try{if(d==this.g)e:{const Kn=Gs(this.g);var p=this.g.Ba();const el=this.g.Z();if(!(3>Kn)&&(Kn!=3||this.g&&(this.h.h||this.g.oa()||PS(this.g)))){this.J||Kn!=4||p==7||(p==8||0>=el?Oo(3):Oo(2)),ts(this);var y=this.g.Z();this.X=y;t:if(Ya(this)){var T=PS(this.g);d="";var j=T.length,F=Gs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ns(this),xs(this);var ie="";break t}this.h.i=new a.TextDecoder}for(p=0;p<j;p++)this.h.h=!0,d+=this.h.i.decode(T[p],{stream:!(F&&p==j-1)});T.length=0,this.h.g+=d,this.C=0,ie=this.h.g}else ie=this.g.oa();if(this.o=y==200,et(this.i,this.u,this.A,this.l,this.R,Kn,y),this.o){if(this.T&&!this.K){t:{if(this.g){var xt,Un=this.g;if((xt=Un.g?Un.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(xt)){var nt=xt;break t}}nt=null}if(y=nt)_t(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qg(this,y);else{this.o=!1,this.s=3,Fn(12),ns(this),xs(this);break e}}if(this.P){y=!0;let rs;for(;!this.J&&this.C<ie.length;)if(rs=zg(this,ie),rs==ot){Kn==4&&(this.s=4,Fn(14),y=!1),_t(this.i,this.l,null,"[Incomplete Response]");break}else if(rs==Ir){this.s=4,Fn(15),_t(this.i,this.l,ie,"[Invalid Chunk]"),y=!1;break}else _t(this.i,this.l,rs,null),qg(this,rs);if(Ya(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kn!=4||ie.length!=0||this.h.h||(this.s=1,Fn(16),y=!1),this.o=this.o&&y,!y)_t(this.i,this.l,ie,"[Invalid Chunked Response]"),ns(this),xs(this);else if(0<ie.length&&!this.W){this.W=!0;var Qn=this.j;Qn.g==this&&Qn.ba&&!Qn.M&&(Qn.j.info("Great, no buffering proxy detected. Bytes received: "+ie.length),Yg(Qn),Qn.M=!0,Fn(11))}}else _t(this.i,this.l,ie,null),qg(this,ie);Kn==4&&ns(this),this.o&&!this.J&&(Kn==4?$S(this.j,this):(this.o=!1,Ja(this)))}else F2(this.g),y==400&&0<ie.indexOf("Unknown SID")?(this.s=3,Fn(12)):(this.s=0,Fn(13)),ns(this),xs(this)}}}catch{}finally{}};function Ya(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function zg(d,p){var y=d.C,T=p.indexOf(`
`,y);return T==-1?ot:(y=Number(p.substring(y,T)),isNaN(y)?Ir:(T+=1,T+y>p.length?ot:(p=p.slice(T,T+y),d.C=T+y,p)))}sn.prototype.cancel=function(){this.J=!0,ns(this)};function Ja(d){d.S=Date.now()+d.I,Pt(d,d.I)}function Pt(d,p){if(d.B!=null)throw Error("WatchDog timer not null");d.B=O(m(d.ba,d),p)}function ts(d){d.B&&(a.clearTimeout(d.B),d.B=null)}sn.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(gn(this.i,this.A),this.L!=2&&(Oo(),Fn(17)),ns(this),this.s=2,xs(this)):Pt(this,this.S-d)};function xs(d){d.j.G==0||d.J||$S(d.j,d)}function ns(d){ts(d);var p=d.M;p&&typeof p.ma=="function"&&p.ma(),d.M=null,nn(d.U),d.g&&(p=d.g,d.g=null,p.abort(),p.ma())}function qg(d,p){try{var y=d.j;if(y.G!=0&&(y.g==d||Wg(y.h,d))){if(!d.K&&Wg(y.h,d)&&y.G==3){try{var T=y.Da.g.parse(p)}catch{T=null}if(Array.isArray(T)&&T.length==3){var j=T;if(j[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<d.F)Bh(y),$h(y);else break e;Kg(y),Fn(18)}}else y.za=j[1],0<y.za-y.T&&37500>j[2]&&y.F&&y.v==0&&!y.C&&(y.C=O(m(y.Za,y),6e3));if(1>=yS(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else Vo(y,11)}else if((d.K||y.g==d)&&Bh(y),!I(p))for(j=y.Da.g.parse(p),p=0;p<j.length;p++){let nt=j[p];if(y.T=nt[0],nt=nt[1],y.G==2)if(nt[0]=="c"){y.K=nt[1],y.ia=nt[2];const Qn=nt[3];Qn!=null&&(y.la=Qn,y.j.info("VER="+y.la));const Kn=nt[4];Kn!=null&&(y.Aa=Kn,y.j.info("SVER="+y.Aa));const el=nt[5];el!=null&&typeof el=="number"&&0<el&&(T=1.5*el,y.L=T,y.j.info("backChannelRequestTimeoutMs_="+T)),T=y;const rs=d.g;if(rs){const qh=rs.g?rs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qh){var F=T.h;F.g||qh.indexOf("spdy")==-1&&qh.indexOf("quic")==-1&&qh.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(Gg(F,F.h),F.h=null))}if(T.D){const Jg=rs.g?rs.g.getResponseHeader("X-HTTP-Session-Id"):null;Jg&&(T.ya=Jg,jt(T.I,T.D,Jg))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-d.F,y.j.info("Handshake RTT: "+y.R+"ms")),T=y;var ie=d;if(T.qa=zS(T,T.J?T.ia:null,T.W),ie.K){vS(T.h,ie);var xt=ie,Un=T.L;Un&&(xt.I=Un),xt.B&&(ts(xt),Ja(xt)),T.g=ie}else VS(T);0<y.i.length&&Uh(y)}else nt[0]!="stop"&&nt[0]!="close"||Vo(y,7);else y.G==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?Vo(y,7):Qg(y):nt[0]!="noop"&&y.l&&y.l.ta(nt),y.v=0)}}Oo(4)}catch{}}var I2=class{constructor(d,p){this.g=d,this.map=p}};function pS(d){this.l=d||10,a.PerformanceNavigationTiming?(d=a.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function gS(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function yS(d){return d.h?1:d.g?d.g.size:0}function Wg(d,p){return d.h?d.h==p:d.g?d.g.has(p):!1}function Gg(d,p){d.g?d.g.add(p):d.h=p}function vS(d,p){d.h&&d.h==p?d.h=null:d.g&&d.g.has(p)&&d.g.delete(p)}pS.prototype.cancel=function(){if(this.i=_S(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function _S(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let p=d.i;for(const y of d.g.values())p=p.concat(y.D);return p}return _(d.i)}function E2(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(c(d)){for(var p=[],y=d.length,T=0;T<y;T++)p.push(d[T]);return p}p=[],y=0;for(T in d)p[y++]=d[T];return p}function b2(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(c(d)||typeof d=="string"){var p=[];d=d.length;for(var y=0;y<d;y++)p.push(y);return p}p=[],y=0;for(const T in d)p[y++]=T;return p}}}function wS(d,p){if(d.forEach&&typeof d.forEach=="function")d.forEach(p,void 0);else if(c(d)||typeof d=="string")Array.prototype.forEach.call(d,p,void 0);else for(var y=b2(d),T=E2(d),j=T.length,F=0;F<j;F++)p.call(void 0,T[F],y&&y[F],d)}var xS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function T2(d,p){if(d){d=d.split("&");for(var y=0;y<d.length;y++){var T=d[y].indexOf("="),j=null;if(0<=T){var F=d[y].substring(0,T);j=d[y].substring(T+1)}else F=d[y];p(F,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function Lo(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof Lo){this.h=d.h,jh(this,d.j),this.o=d.o,this.g=d.g,Mh(this,d.s),this.l=d.l;var p=d.i,y=new Wc;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),SS(this,y),this.m=d.m}else d&&(p=String(d).match(xS))?(this.h=!1,jh(this,p[1]||"",!0),this.o=zc(p[2]||""),this.g=zc(p[3]||"",!0),Mh(this,p[4]),this.l=zc(p[5]||"",!0),SS(this,p[6]||"",!0),this.m=zc(p[7]||"")):(this.h=!1,this.i=new Wc(null,this.h))}Lo.prototype.toString=function(){var d=[],p=this.j;p&&d.push(qc(p,IS,!0),":");var y=this.g;return(y||p=="file")&&(d.push("//"),(p=this.o)&&d.push(qc(p,IS,!0),"@"),d.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&d.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&d.push("/"),d.push(qc(y,y.charAt(0)=="/"?C2:N2,!0))),(y=this.i.toString())&&d.push("?",y),(y=this.m)&&d.push("#",qc(y,R2)),d.join("")};function Ws(d){return new Lo(d)}function jh(d,p,y){d.j=y?zc(p,!0):p,d.j&&(d.j=d.j.replace(/:$/,""))}function Mh(d,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);d.s=p}else d.s=null}function SS(d,p,y){p instanceof Wc?(d.i=p,D2(d.i,d.h)):(y||(p=qc(p,k2)),d.i=new Wc(p,d.h))}function jt(d,p,y){d.i.set(p,y)}function Oh(d){return jt(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function zc(d,p){return d?p?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function qc(d,p,y){return typeof d=="string"?(d=encodeURI(d).replace(p,A2),y&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function A2(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var IS=/[#\/\?@]/g,N2=/[#\?:]/g,C2=/[#\?]/g,k2=/[#\?@]/g,R2=/#/g;function Wc(d,p){this.h=this.g=null,this.i=d||null,this.j=!!p}function Ti(d){d.g||(d.g=new Map,d.h=0,d.i&&T2(d.i,function(p,y){d.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=Wc.prototype,n.add=function(d,p){Ti(this),this.i=null,d=Xa(this,d);var y=this.g.get(d);return y||this.g.set(d,y=[]),y.push(p),this.h+=1,this};function ES(d,p){Ti(d),p=Xa(d,p),d.g.has(p)&&(d.i=null,d.h-=d.g.get(p).length,d.g.delete(p))}function bS(d,p){return Ti(d),p=Xa(d,p),d.g.has(p)}n.forEach=function(d,p){Ti(this),this.g.forEach(function(y,T){y.forEach(function(j){d.call(p,j,T,this)},this)},this)},n.na=function(){Ti(this);const d=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let T=0;T<p.length;T++){const j=d[T];for(let F=0;F<j.length;F++)y.push(p[T])}return y},n.V=function(d){Ti(this);let p=[];if(typeof d=="string")bS(this,d)&&(p=p.concat(this.g.get(Xa(this,d))));else{d=Array.from(this.g.values());for(let y=0;y<d.length;y++)p=p.concat(d[y])}return p},n.set=function(d,p){return Ti(this),this.i=null,d=Xa(this,d),bS(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[p]),this.h+=1,this},n.get=function(d,p){return d?(d=this.V(d),0<d.length?String(d[0]):p):p};function TS(d,p,y){ES(d,p),0<y.length&&(d.i=null,d.g.set(Xa(d,p),_(y)),d.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var T=p[y];const F=encodeURIComponent(String(T)),ie=this.V(T);for(T=0;T<ie.length;T++){var j=F;ie[T]!==""&&(j+="="+encodeURIComponent(String(ie[T]))),d.push(j)}}return this.i=d.join("&")};function Xa(d,p){return p=String(p),d.j&&(p=p.toLowerCase()),p}function D2(d,p){p&&!d.j&&(Ti(d),d.i=null,d.g.forEach(function(y,T){var j=T.toLowerCase();T!=j&&(ES(this,T),TS(this,j,y))},d)),d.j=p}function P2(d,p){const y=new Y;if(a.Image){const T=new Image;T.onload=g(Ai,y,"TestLoadImage: loaded",!0,p,T),T.onerror=g(Ai,y,"TestLoadImage: error",!1,p,T),T.onabort=g(Ai,y,"TestLoadImage: abort",!1,p,T),T.ontimeout=g(Ai,y,"TestLoadImage: timeout",!1,p,T),a.setTimeout(function(){T.ontimeout&&T.ontimeout()},1e4),T.src=d}else p(!1)}function j2(d,p){const y=new Y,T=new AbortController,j=setTimeout(()=>{T.abort(),Ai(y,"TestPingServer: timeout",!1,p)},1e4);fetch(d,{signal:T.signal}).then(F=>{clearTimeout(j),F.ok?Ai(y,"TestPingServer: ok",!0,p):Ai(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(j),Ai(y,"TestPingServer: error",!1,p)})}function Ai(d,p,y,T,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),T(y)}catch{}}function M2(){this.g=new Kt}function O2(d,p,y){const T=y||"";try{wS(d,function(j,F){let ie=j;u(j)&&(ie=pn(j)),p.push(T+F+"="+encodeURIComponent(ie))})}catch(j){throw p.push(T+"type="+encodeURIComponent("_badmap")),j}}function Lh(d){this.l=d.Ub||null,this.j=d.eb||!1}v(Lh,Hn),Lh.prototype.g=function(){return new Vh(this.l,this.j)},Lh.prototype.i=function(d){return function(){return d}}({});function Vh(d,p){he.call(this),this.D=d,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(Vh,he),n=Vh.prototype,n.open=function(d,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=p,this.readyState=1,Hc(this)},n.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(p.body=d),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Gc(this)),this.readyState=0},n.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,Hc(this)),this.g&&(this.readyState=3,Hc(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;AS(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function AS(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}n.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var p=d.value?d.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!d.done}))&&(this.response=this.responseText+=p)}d.done?Gc(this):Hc(this),this.readyState==3&&AS(this)}},n.Ra=function(d){this.g&&(this.response=this.responseText=d,Gc(this))},n.Qa=function(d){this.g&&(this.response=d,Gc(this))},n.ga=function(){this.g&&Gc(this)};function Gc(d){d.readyState=4,d.l=null,d.j=null,d.v=null,Hc(d)}n.setRequestHeader=function(d,p){this.u.append(d,p)},n.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,d.push(y[0]+": "+y[1]),y=p.next();return d.join(`\r
`)};function Hc(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(Vh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function NS(d){let p="";return V(d,function(y,T){p+=T,p+=":",p+=y,p+=`\r
`}),p}function Hg(d,p,y){e:{for(T in y){var T=!1;break e}T=!0}T||(y=NS(y),typeof d=="string"?y!=null&&encodeURIComponent(String(y)):jt(d,p,y))}function on(d){he.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(on,he);var L2=/^https?$/i,V2=["POST","PUT"];n=on.prototype,n.Ha=function(d){this.J=d},n.ea=function(d,p,y,T){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);p=p?p.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():At.g(),this.v=this.o?qe(this.o):qe(At),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(p,String(d),!0),this.B=!1}catch(F){CS(this,F);return}if(d=y||"",y=new Map(this.headers),T)if(Object.getPrototypeOf(T)===Object.prototype)for(var j in T)y.set(j,T[j]);else if(typeof T.keys=="function"&&typeof T.get=="function")for(const F of T.keys())y.set(F,T.get(F));else throw Error("Unknown input type for opt_headers: "+String(T));T=Array.from(y.keys()).find(F=>F.toLowerCase()=="content-type"),j=a.FormData&&d instanceof a.FormData,!(0<=Array.prototype.indexOf.call(V2,p,void 0))||T||j||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,ie]of y)this.g.setRequestHeader(F,ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{DS(this),this.u=!0,this.g.send(d),this.u=!1}catch(F){CS(this,F)}};function CS(d,p){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=p,d.m=5,kS(d),Fh(d)}function kS(d){d.A||(d.A=!0,Me(d,"complete"),Me(d,"error"))}n.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,Me(this,"complete"),Me(this,"abort"),Fh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Fh(this,!0)),on.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?RS(this):this.bb())},n.bb=function(){RS(this)};function RS(d){if(d.h&&typeof o<"u"&&(!d.v[1]||Gs(d)!=4||d.Z()!=2)){if(d.u&&Gs(d)==4)Tt(d.Ea,0,d);else if(Me(d,"readystatechange"),Gs(d)==4){d.h=!1;try{const ie=d.Z();e:switch(ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var T;if(T=ie===0){var j=String(d.D).match(xS)[1]||null;!j&&a.self&&a.self.location&&(j=a.self.location.protocol.slice(0,-1)),T=!L2.test(j?j.toLowerCase():"")}y=T}if(y)Me(d,"complete"),Me(d,"success");else{d.m=6;try{var F=2<Gs(d)?d.g.statusText:""}catch{F=""}d.l=F+" ["+d.Z()+"]",kS(d)}}finally{Fh(d)}}}}function Fh(d,p){if(d.g){DS(d);const y=d.g,T=d.v[0]?()=>{}:null;d.g=null,d.v=null,p||Me(d,"ready");try{y.onreadystatechange=T}catch{}}}function DS(d){d.I&&(a.clearTimeout(d.I),d.I=null)}n.isActive=function(){return!!this.g};function Gs(d){return d.g?d.g.readyState:0}n.Z=function(){try{return 2<Gs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(d){if(this.g){var p=this.g.responseText;return d&&p.indexOf(d)==0&&(p=p.substring(d.length)),un(p)}};function PS(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function F2(d){const p={};d=(d.g&&2<=Gs(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let T=0;T<d.length;T++){if(I(d[T]))continue;var y=k(d[T]);const j=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const F=p[j]||[];p[j]=F,F.push(y)}A(p,function(T){return T.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qc(d,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[d]||p}function jS(d){this.Aa=0,this.i=[],this.j=new Y,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qc("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qc("baseRetryDelayMs",5e3,d),this.cb=Qc("retryDelaySeedMs",1e4,d),this.Wa=Qc("forwardChannelMaxRetries",2,d),this.wa=Qc("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new pS(d&&d.concurrentRequestLimit),this.Da=new M2,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=jS.prototype,n.la=8,n.G=1,n.connect=function(d,p,y,T){Fn(0),this.W=d,this.H=p||{},y&&T!==void 0&&(this.H.OSID=y,this.H.OAID=T),this.F=this.X,this.I=zS(this,null,this.W),Uh(this)};function Qg(d){if(MS(d),d.G==3){var p=d.U++,y=Ws(d.I);if(jt(y,"SID",d.K),jt(y,"RID",p),jt(y,"TYPE","terminate"),Kc(d,y),p=new sn(d,d.j,p),p.L=2,p.v=Oh(Ws(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=qS(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Ja(p)}BS(d)}function $h(d){d.g&&(Yg(d),d.g.cancel(),d.g=null)}function MS(d){$h(d),d.u&&(a.clearTimeout(d.u),d.u=null),Bh(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&a.clearTimeout(d.s),d.s=null)}function Uh(d){if(!gS(d.h)&&!d.s){d.s=!0;var p=d.Ga;Te||W(),z||(Te(),z=!0),ne.add(p,d),d.B=0}}function $2(d,p){return yS(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=p.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=O(m(d.Ga,d,p),US(d,d.B)),d.B++,!0)}n.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const j=new sn(this,this.j,d);let F=this.o;if(this.S&&(F?(F=S(F),N(F,this.S)):F=this.S),this.m!==null||this.O||(j.H=F,F=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var T=this.i[y];if("__data__"in T.map&&(T=T.map.__data__,typeof T=="string")){T=T.length;break t}T=void 0}if(T===void 0)break;if(p+=T,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=LS(this,j,p),y=Ws(this.I),jt(y,"RID",d),jt(y,"CVER",22),this.D&&jt(y,"X-HTTP-Session-Id",this.D),Kc(this,y),F&&(this.O?p="headers="+encodeURIComponent(String(NS(F)))+"&"+p:this.m&&Hg(y,this.m,F)),Gg(this.h,j),this.Ua&&jt(y,"TYPE","init"),this.P?(jt(y,"$req",p),jt(y,"SID","null"),j.T=!0,wt(j,y,null)):wt(j,y,p),this.G=2}}else this.G==3&&(d?OS(this,d):this.i.length==0||gS(this.h)||OS(this))};function OS(d,p){var y;p?y=p.l:y=d.U++;const T=Ws(d.I);jt(T,"SID",d.K),jt(T,"RID",y),jt(T,"AID",d.T),Kc(d,T),d.m&&d.o&&Hg(T,d.m,d.o),y=new sn(d,d.j,y,d.B+1),d.m===null&&(y.H=d.o),p&&(d.i=p.D.concat(d.i)),p=LS(d,y,1e3),y.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),Gg(d.h,y),wt(y,T,p)}function Kc(d,p){d.H&&V(d.H,function(y,T){jt(p,T,y)}),d.l&&wS({},function(y,T){jt(p,T,y)})}function LS(d,p,y){y=Math.min(d.i.length,y);var T=d.l?m(d.l.Na,d.l,d):null;e:{var j=d.i;let F=-1;for(;;){const ie=["count="+y];F==-1?0<y?(F=j[0].g,ie.push("ofs="+F)):F=0:ie.push("ofs="+F);let xt=!0;for(let Un=0;Un<y;Un++){let nt=j[Un].g;const Qn=j[Un].map;if(nt-=F,0>nt)F=Math.max(0,j[Un].g-100),xt=!1;else try{O2(Qn,ie,"req"+nt+"_")}catch{T&&T(Qn)}}if(xt){T=ie.join("&");break e}}}return d=d.i.splice(0,y),p.D=d,T}function VS(d){if(!d.g&&!d.u){d.Y=1;var p=d.Fa;Te||W(),z||(Te(),z=!0),ne.add(p,d),d.v=0}}function Kg(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=O(m(d.Fa,d),US(d,d.v)),d.v++,!0)}n.Fa=function(){if(this.u=null,FS(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=O(m(this.ab,this),d)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Fn(10),$h(this),FS(this))};function Yg(d){d.A!=null&&(a.clearTimeout(d.A),d.A=null)}function FS(d){d.g=new sn(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var p=Ws(d.qa);jt(p,"RID","rpc"),jt(p,"SID",d.K),jt(p,"AID",d.T),jt(p,"CI",d.F?"0":"1"),!d.F&&d.ja&&jt(p,"TO",d.ja),jt(p,"TYPE","xmlhttp"),Kc(d,p),d.m&&d.o&&Hg(p,d.m,d.o),d.L&&(d.g.I=d.L);var y=d.g;d=d.ia,y.L=1,y.v=Oh(Ws(p)),y.m=null,y.P=!0,$n(y,d)}n.Za=function(){this.C!=null&&(this.C=null,$h(this),Kg(this),Fn(19))};function Bh(d){d.C!=null&&(a.clearTimeout(d.C),d.C=null)}function $S(d,p){var y=null;if(d.g==p){Bh(d),Yg(d),d.g=null;var T=2}else if(Wg(d.h,p))y=p.D,vS(d.h,p),T=1;else return;if(d.G!=0){if(p.o)if(T==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var j=d.B;T=An(),Me(T,new Ph(T,y)),Uh(d)}else VS(d);else if(j=p.s,j==3||j==0&&0<p.X||!(T==1&&$2(d,p)||T==2&&Kg(d)))switch(y&&0<y.length&&(p=d.h,p.i=p.i.concat(y)),j){case 1:Vo(d,5);break;case 4:Vo(d,10);break;case 3:Vo(d,6);break;default:Vo(d,2)}}}function US(d,p){let y=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(y*=2),y*p}function Vo(d,p){if(d.j.info("Error code "+p),p==2){var y=m(d.fb,d),T=d.Xa;const j=!T;T=new Lo(T||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||jh(T,"https"),Oh(T),j?P2(T.toString(),y):j2(T.toString(),y)}else Fn(2);d.G=0,d.l&&d.l.sa(p),BS(d),MS(d)}n.fb=function(d){d?(this.j.info("Successfully pinged google.com"),Fn(2)):(this.j.info("Failed to ping google.com"),Fn(1))};function BS(d){if(d.G=0,d.ka=[],d.l){const p=_S(d.h);(p.length!=0||d.i.length!=0)&&(R(d.ka,p),R(d.ka,d.i),d.h.i.length=0,_(d.i),d.i.length=0),d.l.ra()}}function zS(d,p,y){var T=y instanceof Lo?Ws(y):new Lo(y);if(T.g!="")p&&(T.g=p+"."+T.g),Mh(T,T.s);else{var j=a.location;T=j.protocol,p=p?p+"."+j.hostname:j.hostname,j=+j.port;var F=new Lo(null);T&&jh(F,T),p&&(F.g=p),j&&Mh(F,j),y&&(F.l=y),T=F}return y=d.D,p=d.ya,y&&p&&jt(T,y,p),jt(T,"VER",d.la),Kc(d,T),T}function qS(d,p,y){if(p&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=d.Ca&&!d.pa?new on(new Lh({eb:y})):new on(d.pa),p.Ha(d.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function WS(){}n=WS.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function zh(){}zh.prototype.g=function(d,p){return new Er(d,p)};function Er(d,p){he.call(this),this.g=new jS(p),this.l=d,this.h=p&&p.messageUrlParams||null,d=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(d?d["X-WebChannel-Content-Type"]=p.messageContentType:d={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(d?d["X-WebChannel-Client-Profile"]=p.va:d={"X-WebChannel-Client-Profile":p.va}),this.g.S=d,(d=p&&p.Sb)&&!I(d)&&(this.g.m=d),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!I(p)&&(this.g.D=p,d=this.h,d!==null&&p in d&&(d=this.h,p in d&&delete d[p])),this.j=new Za(this)}v(Er,he),Er.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Er.prototype.close=function(){Qg(this.g)},Er.prototype.o=function(d){var p=this.g;if(typeof d=="string"){var y={};y.__data__=d,d=y}else this.u&&(y={},y.__data__=pn(d),d=y);p.i.push(new I2(p.Ya++,d)),p.G==3&&Uh(p)},Er.prototype.N=function(){this.g.l=null,delete this.j,Qg(this.g),delete this.g,Er.aa.N.call(this)};function GS(d){oe.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var p=d.__sm__;if(p){e:{for(const y in p){d=y;break e}d=void 0}(this.i=d)&&(d=this.i,p=p!==null&&d in p?p[d]:void 0),this.data=p}else this.data=d}v(GS,oe);function HS(){lt.call(this),this.status=1}v(HS,lt);function Za(d){this.g=d}v(Za,WS),Za.prototype.ua=function(){Me(this.g,"a")},Za.prototype.ta=function(d){Me(this.g,new GS(d))},Za.prototype.sa=function(d){Me(this.g,new HS)},Za.prototype.ra=function(){Me(this.g,"b")},zh.prototype.createWebChannel=zh.prototype.g,Er.prototype.send=Er.prototype.o,Er.prototype.open=Er.prototype.m,Er.prototype.close=Er.prototype.close,pk=function(){return new zh},mk=function(){return An()},fk=Dt,_v={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ye.NO_ERROR=0,Ye.TIMEOUT=8,Ye.HTTP_ERROR=6,Bf=Ye,it.COMPLETE="complete",hk=it,Qe.EventType=rn,rn.OPEN="a",rn.CLOSE="b",rn.ERROR="c",rn.MESSAGE="d",he.prototype.listen=he.prototype.K,Iu=Qe,on.prototype.listenOnce=on.prototype.L,on.prototype.getLastError=on.prototype.Ka,on.prototype.getLastErrorCode=on.prototype.Ba,on.prototype.getStatus=on.prototype.Z,on.prototype.getResponseJson=on.prototype.Oa,on.prototype.getResponseText=on.prototype.oa,on.prototype.send=on.prototype.ea,on.prototype.setWithCredentials=on.prototype.Ha,dk=on}).apply(typeof hf<"u"?hf:typeof self<"u"?self:typeof window<"u"?window:{});const KE="@firebase/firestore",YE="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Dn.UNAUTHENTICATED=new Dn(null),Dn.GOOGLE_CREDENTIALS=new Dn("google-credentials-uid"),Dn.FIRST_PARTY=new Dn("first-party-uid"),Dn.MOCK_USER=new Dn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _o=new eh("@firebase/firestore");function ul(){return _o.logLevel}function O7(n){_o.setLogLevel(n)}function G(n,...e){if(_o.logLevel<=We.DEBUG){const t=e.map(Ow);_o.debug(`Firestore (${Rc}): ${n}`,...t)}}function hn(n,...e){if(_o.logLevel<=We.ERROR){const t=e.map(Ow);_o.error(`Firestore (${Rc}): ${n}`,...t)}}function Xr(n,...e){if(_o.logLevel<=We.WARN){const t=e.map(Ow);_o.warn(`Firestore (${Rc}): ${n}`,...t)}}function Ow(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ce(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,gk(n,r,t)}function gk(n,e,t){let r=`FIRESTORE (${Rc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw hn(r),new Error(r)}function fe(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||gk(e,s,r)}function L7(n,e){n||ce(57014,e)}function se(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends ys{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class v3{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Dn.UNAUTHENTICATED))}shutdown(){}}class _3{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class w3{constructor(e){this.t=e,this.currentUser=Dn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){fe(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new Mn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Mn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{G("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(G("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Mn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(G("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(fe(typeof r.accessToken=="string",31837,{l:r}),new yk(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return fe(e===null||typeof e=="string",2055,{h:e}),new Dn(e)}}class x3{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Dn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class S3{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new x3(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Dn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class I3{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,zt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){fe(this.o===void 0,3512);const r=i=>{i.error!=null&&G("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,G("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{G("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):G("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new wv(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(fe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new wv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class V7{getToken(){return Promise.resolve(new wv(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E3(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=E3(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function ke(n,e){return n<e?-1:n>e?1:0}function xv(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return My(s)===My(i)?ke(s,i):My(s)?1:-1}return ke(n.length,e.length)}const b3=55296,T3=57343;function My(n){const e=n.charCodeAt(0);return e>=b3&&e<=T3}function tc(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function vk(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sv="__name__";class Es{constructor(e,t,r){t===void 0?t=0:t>e.length&&ce(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ce(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Es.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Es?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Es.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return ke(e.length,t.length)}static compareSegments(e,t){const r=Es.isNumericId(e),s=Es.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Es.extractNumericId(e).compare(Es.extractNumericId(t)):xv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ao.fromString(e.substring(4,e.length-2))}}class ze extends Es{construct(e,t,r){return new ze(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new B(L.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ze(t)}static emptyPath(){return new ze([])}}const A3=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Wt extends Es{construct(e,t,r){return new Wt(e,t,r)}static isValidIdentifier(e){return A3.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Wt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Sv}static keyField(){return new Wt([Sv])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new B(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new B(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new B(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new B(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Wt(t)}static emptyPath(){return new Wt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.path=e}static fromPath(e){return new re(ze.fromString(e))}static fromName(e){return new re(ze.fromString(e).popFirst(5))}static empty(){return new re(ze.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ze.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ze.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new ze(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vw(n,e,t){if(!t)throw new B(L.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function N3(n,e,t,r){if(e===!0&&r===!0)throw new B(L.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function JE(n){if(!re.isDocumentKey(n))throw new B(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function XE(n){if(re.isDocumentKey(n))throw new B(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function _k(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function rg(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ce(12329,{type:typeof n})}function Ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=rg(n);throw new B(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function wk(n,e){if(e<=0)throw new B(L.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ua(n,e){if(!_k(n))throw new B(L.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new B(L.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZE=-62135596800,eb=1e6;class Fe{static now(){return Fe.fromMillis(Date.now())}static fromDate(e){return Fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*eb);return new Fe(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ZE)throw new B(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/eb}_compareTo(e){return this.seconds===e.seconds?ke(this.nanoseconds,e.nanoseconds):ke(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Fe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ua(e,Fe._jsonSchema))return new Fe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ZE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Fe._jsonSchemaVersion="firestore/timestamp/1.0",Fe._jsonSchema={type:wn("string",Fe._jsonSchemaVersion),seconds:wn("number"),nanoseconds:wn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{static fromTimestamp(e){return new ye(e)}static min(){return new ye(new Fe(0,0))}static max(){return new ye(new Fe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=-1;class rc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Iv(n){return n.fields.find(e=>e.kind===2)}function qo(n){return n.fields.filter(e=>e.kind!==2)}function C3(n,e){let t=ke(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=k3(n.fields[r],e.fields[r]),t!==0)return t;return ke(n.fields.length,e.fields.length)}rc.UNKNOWN_ID=-1;class aa{constructor(e,t){this.fieldPath=e,this.kind=t}}function k3(n,e){const t=Wt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:ke(n.kind,e.kind)}class sc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new sc(0,Vr.min())}}function xk(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ye.fromTimestamp(r===1e9?new Fe(t+1,0):new Fe(t,r));return new Vr(s,re.empty(),e)}function Sk(n){return new Vr(n.readTime,n.key,nc)}class Vr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Vr(ye.min(),re.empty(),nc)}static max(){return new Vr(ye.max(),re.empty(),nc)}}function Fw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=re.comparator(n.documentKey,e.documentKey),t!==0?t:ke(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ik="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ek{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ko(n){if(n.code!==L.FAILED_PRECONDITION||n.message!==Ik)throw n;G("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ce(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,r)=>{t(e)})}static reject(e){return new M((t,r)=>{r(e)})}static waitFor(e){return new M((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},c=>r(c))}),o=!0,i===s&&t()})}static or(e){let t=M.resolve(!1);for(const r of e)t=t.next(s=>s?M.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new M((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let c=0;c<i;c++){const u=c;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new M((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ar="SimpleDb";class sg{static open(e,t,r,s){try{return new sg(t,e.transaction(s,r))}catch(i){throw new Bu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Mn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Bu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=$w(r.target.error);this.S.reject(new Bu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(G(Ar,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new D3(t)}}class Os{static delete(e){return G(Ar,"Removing database:",e),Go(EN().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Lp())return!1;if(Os.F())return!0;const e=bn(),t=Os.M(e),r=0<t&&t<10,s=bk(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Os.M(bn())===12.2&&hn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(G(Ar,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Bu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new B(L.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new B(L.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Bu(e,o))},s.onupgradeneeded=i=>{G(Ar,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{G(Ar,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=sg.open(this.db,e,i?"readonly":"readwrite",r),c=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),M.reject(u))).toPromise();return c.catch(()=>{}),await a.D,c}catch(a){const c=a,u=c.name!=="FirebaseError"&&o<3;if(G(Ar,"Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function bk(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class R3{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Go(this.U.delete())}}class Bu extends B{constructor(e,t){super(L.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ro(n){return n.name==="IndexedDbTransactionError"}class D3{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(G(Ar,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(G(Ar,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Go(r)}add(e){return G(Ar,"ADD",this.store.name,e,e),Go(this.store.add(e))}get(e){return Go(this.store.get(e)).next(t=>(t===void 0&&(t=null),G(Ar,"GET",this.store.name,e,t),t))}delete(e){return G(Ar,"DELETE",this.store.name,e),Go(this.store.delete(e))}count(){return G(Ar,"COUNT",this.store.name),Go(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new M((o,a)=>{i.onerror=c=>{a(c.target.error)},i.onsuccess=c=>{o(c.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,c)=>{o.push(c)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new M((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){G(Ar,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new M((r,s)=>{t.onerror=i=>{const o=$w(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new M((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new R3(a),u=t(a.primaryKey,a.value,c);if(u instanceof M){const h=u.catch(f=>(c.done(),M.reject(f)));r.push(h)}c.isDone?s():c.G===null?a.continue():a.continue(c.G)}}).next(()=>M.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Go(n){return new M((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=$w(r.target.error);t(s)}})}let tb=!1;function $w(n){const e=Os.M(bn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tb||(tb=!0,setTimeout(()=>{throw r},0)),r}}return n}const zu="IndexBackfiller";class P3{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){G(zu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();G(zu,`Documents written: ${t}`)}catch(t){Ro(t)?G(zu,"Ignoring IndexedDB error during index backfill: ",t):await ko(t)}await this.re(6e4)})}}class j3{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return M.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return G(zu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(G(zu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Sk(i);Fw(o,r)>0&&(r=o)}),new Vr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}fr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lo=-1;function dh(n){return n==null}function Cd(n){return n===0&&1/n==-1/0}function Tk(n){return typeof n=="number"&&Number.isInteger(n)&&!Cd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm="";function nr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=nb(e)),e=M3(n.get(t),e);return nb(e)}function M3(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Gm:t+="";break;default:t+=i}}return t}function nb(n){return n+Gm+""}function Cs(n){const e=n.length;if(fe(e>=2,64408,{path:n}),e===2)return fe(n.charAt(0)===Gm&&n.charAt(1)==="",56145,{path:n}),ze.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Gm,i);switch((o<0||o>t)&&ce(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let c;s.length===0?c=a:(s+=a,c=s,s=""),r.push(c);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ce(61167,{path:n})}i=o+2}return new ze(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wo="remoteDocuments",hh="owner",rl="owner",kd="mutationQueues",O3="userId",as="mutations",rb="batchId",ea="userMutationsIndex",sb=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(n,e){return[n,nr(e)]}function Ak(n,e,t){return[n,nr(e),t]}const L3={},ic="documentMutations",Hm="remoteDocumentsV14",V3=["prefixPath","collectionGroup","readTime","documentId"],qf="documentKeyIndex",F3=["prefixPath","collectionGroup","documentId"],Nk="collectionGroupIndex",$3=["collectionGroup","readTime","prefixPath","documentId"],Rd="remoteDocumentGlobal",Ev="remoteDocumentGlobalKey",oc="targets",Ck="queryTargetsIndex",U3=["canonicalId","targetId"],ac="targetDocuments",B3=["targetId","path"],Uw="documentTargetsIndex",z3=["path","targetId"],Qm="targetGlobalKey",la="targetGlobal",Dd="collectionParents",q3=["collectionId","parent"],lc="clientMetadata",W3="clientId",ig="bundles",G3="bundleId",og="namedQueries",H3="name",Bw="indexConfiguration",Q3="indexId",bv="collectionGroupIndex",K3="collectionGroup",qu="indexState",Y3=["indexId","uid"],kk="sequenceNumberIndex",J3=["uid","sequenceNumber"],Wu="indexEntries",X3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Rk="documentKeyIndex",Z3=["indexId","uid","orderedDocumentKey"],ag="documentOverlays",e6=["userId","collectionPath","documentId"],Tv="collectionPathOverlayIndex",t6=["userId","collectionPath","largestBatchId"],Dk="collectionGroupOverlayIndex",n6=["userId","collectionGroup","largestBatchId"],zw="globals",r6="name",Pk=[kd,as,ic,Wo,oc,hh,la,ac,lc,Rd,Dd,ig,og],s6=[...Pk,ag],jk=[kd,as,ic,Hm,oc,hh,la,ac,lc,Rd,Dd,ig,og,ag],Mk=jk,qw=[...Mk,Bw,qu,Wu],i6=qw,Ok=[...qw,zw],o6=Ok;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av extends Ek{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Tn(n,e){const t=se(n);return Os.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ib(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Do(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Lk(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Vk(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e,t){this.comparator=e,this.root=t||zn.EMPTY}insert(e,t){return new Rt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,zn.BLACK,null,null))}remove(e){return new Rt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,zn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ff(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ff(this.root,e,this.comparator,!1)}getReverseIterator(){return new ff(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ff(this.root,e,this.comparator,!0)}}class ff{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class zn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??zn.RED,this.left=s??zn.EMPTY,this.right=i??zn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new zn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return zn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return zn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,zn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,zn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ce(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ce(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ce(27949);return e+(this.isRed()?0:1)}}zn.EMPTY=null,zn.RED=!0,zn.BLACK=!1;zn.EMPTY=new class{constructor(){this.size=0}get key(){throw ce(57766)}get value(){throw ce(16141)}get color(){throw ce(16727)}get left(){throw ce(29726)}get right(){throw ce(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new zn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this.comparator=e,this.data=new Rt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ob(this.data.getIterator())}getIteratorFrom(e){return new ob(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof mt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new mt(this.comparator);return t.data=e,t}}class ob{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sl(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e){this.fields=e,e.sort(Wt.comparator)}static empty(){return new mr([])}unionWith(e){let t=new mt(Wt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new mr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tc(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $7(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Fk("Invalid base64 string: "+i):i}}(e);return new ln(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new ln(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ke(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ln.EMPTY_BYTE_STRING=new ln("");const a6=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(n){if(fe(!!n,39018),typeof n=="string"){let e=0;const t=a6.exec(n);if(fe(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ut(n.seconds),nanos:Ut(n.nanos)}}function Ut(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fi(n){return typeof n=="string"?ln.fromBase64String(n):ln.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k="server_timestamp",Uk="__type__",Bk="__previous_value__",zk="__local_write_time__";function lg(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Uk])==null?void 0:r.stringValue)===$k}function cg(n){const e=n.mapValue.fields[Bk];return lg(e)?cg(e):e}function Pd(n){const e=hi(n.mapValue.fields[zk].timestampValue);return new Fe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l6{constructor(e,t,r,s,i,o,a,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u,this.isUsingEmulator=h}}const jd="(default)";class xa{constructor(e,t){this.projectId=e,this.database=t||jd}static empty(){return new xa("","")}get isDefaultDatabase(){return this.database===jd}isEqual(e){return e instanceof xa&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ww="__type__",qk="__max__",Gi={mapValue:{fields:{__type__:{stringValue:qk}}}},Gw="__vector__",cc="value",Wf={nullValue:"NULL_VALUE"};function wo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?lg(n)?4:Wk(n)?9007199254740991:ug(n)?10:11:ce(28295,{value:n})}function zs(n,e){if(n===e)return!0;const t=wo(n);if(t!==wo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Pd(n).isEqual(Pd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=hi(s.timestampValue),a=hi(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return fi(s.bytesValue).isEqual(fi(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Ut(s.geoPointValue.latitude)===Ut(i.geoPointValue.latitude)&&Ut(s.geoPointValue.longitude)===Ut(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Ut(s.integerValue)===Ut(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Ut(s.doubleValue),a=Ut(i.doubleValue);return o===a?Cd(o)===Cd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return tc(n.arrayValue.values||[],e.arrayValue.values||[],zs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(ib(o)!==ib(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!zs(o[c],a[c])))return!1;return!0}(n,e);default:return ce(52216,{left:n})}}function Md(n,e){return(n.values||[]).find(t=>zs(t,e))!==void 0}function xo(n,e){if(n===e)return 0;const t=wo(n),r=wo(e);if(t!==r)return ke(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ke(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Ut(i.integerValue||i.doubleValue),c=Ut(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return ab(n.timestampValue,e.timestampValue);case 4:return ab(Pd(n),Pd(e));case 5:return xv(n.stringValue,e.stringValue);case 6:return function(i,o){const a=fi(i),c=fi(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){const h=ke(a[u],c[u]);if(h!==0)return h}return ke(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=ke(Ut(i.latitude),Ut(o.latitude));return a!==0?a:ke(Ut(i.longitude),Ut(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return lb(n.arrayValue,e.arrayValue);case 10:return function(i,o){var m,g,v,_;const a=i.fields||{},c=o.fields||{},u=(m=a[cc])==null?void 0:m.arrayValue,h=(g=c[cc])==null?void 0:g.arrayValue,f=ke(((v=u==null?void 0:u.values)==null?void 0:v.length)||0,((_=h==null?void 0:h.values)==null?void 0:_.length)||0);return f!==0?f:lb(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Gi.mapValue&&o===Gi.mapValue)return 0;if(i===Gi.mapValue)return 1;if(o===Gi.mapValue)return-1;const a=i.fields||{},c=Object.keys(a),u=o.fields||{},h=Object.keys(u);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const m=xv(c[f],h[f]);if(m!==0)return m;const g=xo(a[c[f]],u[h[f]]);if(g!==0)return g}return ke(c.length,h.length)}(n.mapValue,e.mapValue);default:throw ce(23264,{he:t})}}function ab(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ke(n,e);const t=hi(n),r=hi(e),s=ke(t.seconds,r.seconds);return s!==0?s:ke(t.nanos,r.nanos)}function lb(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=xo(t[s],r[s]);if(i)return i}return ke(t.length,r.length)}function uc(n){return Nv(n)}function Nv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=hi(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return fi(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Nv(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Nv(t.fields[o])}`;return s+"}"}(n.mapValue):ce(61005,{value:n})}function Gf(n){switch(wo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=cg(n);return e?16+Gf(e):16;case 5:return 2*n.stringValue.length;case 6:return fi(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Gf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Do(r.fields,(i,o)=>{s+=i.length+Gf(o)}),s}(n.mapValue);default:throw ce(13486,{value:n})}}function Sa(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Cv(n){return!!n&&"integerValue"in n}function Od(n){return!!n&&"arrayValue"in n}function cb(n){return!!n&&"nullValue"in n}function ub(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hf(n){return!!n&&"mapValue"in n}function ug(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Ww])==null?void 0:r.stringValue)===Gw}function Gu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Do(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Gu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gu(n.arrayValue.values[t]);return e}return{...n}}function Wk(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qk}const Gk={mapValue:{fields:{[Ww]:{stringValue:Gw},[cc]:{arrayValue:{}}}}};function c6(n){return"nullValue"in n?Wf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Sa(xa.empty(),re.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?ug(n)?Gk:{mapValue:{}}:ce(35942,{value:n})}function u6(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Sa(xa.empty(),re.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Gk:"mapValue"in n?ug(n)?{mapValue:{}}:Gi:ce(61959,{value:n})}function db(n,e){const t=xo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function hb(n,e){const t=xo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.value=e}static empty(){return new qn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Hf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gu(t)}setAll(e){let t=Wt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Gu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Hf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return zs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Hf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Do(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new qn(Gu(this.value))}}function Hk(n){const e=[];return Do(n.fields,(t,r)=>{const s=new Wt([t]);if(Hf(r)){const i=Hk(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new mr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ot(e,0,ye.min(),ye.min(),ye.min(),qn.empty(),0)}static newFoundDocument(e,t,r,s){return new Ot(e,1,t,ye.min(),r,s,0)}static newNoDocument(e,t){return new Ot(e,2,t,ye.min(),ye.min(),qn.empty(),0)}static newUnknownDocument(e,t){return new Ot(e,3,t,ye.min(),ye.min(),qn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ye.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=qn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=qn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ye.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e,t){this.position=e,this.inclusive=t}}function fb(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=re.comparator(re.fromName(o.referenceValue),t.key):r=xo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function mb(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!zs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld{constructor(e,t="asc"){this.field=e,this.dir=t}}function d6(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{}class Ke extends Qk{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new h6(e,t,r):t==="array-contains"?new p6(e,r):t==="in"?new eR(e,r):t==="not-in"?new g6(e,r):t==="array-contains-any"?new y6(e,r):new Ke(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new f6(e,r):new m6(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(xo(t,this.value)):t!==null&&wo(this.value)===wo(t)&&this.matchesComparison(xo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ce(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ht extends Qk{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ht(e,t)}matches(e){return dc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function dc(n){return n.op==="and"}function kv(n){return n.op==="or"}function Hw(n){return Kk(n)&&dc(n)}function Kk(n){for(const e of n.filters)if(e instanceof ht)return!1;return!0}function Rv(n){if(n instanceof Ke)return n.field.canonicalString()+n.op.toString()+uc(n.value);if(Hw(n))return n.filters.map(e=>Rv(e)).join(",");{const e=n.filters.map(t=>Rv(t)).join(",");return`${n.op}(${e})`}}function Yk(n,e){return n instanceof Ke?function(r,s){return s instanceof Ke&&r.op===s.op&&r.field.isEqual(s.field)&&zs(r.value,s.value)}(n,e):n instanceof ht?function(r,s){return s instanceof ht&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Yk(o,s.filters[a]),!0):!1}(n,e):void ce(19439)}function Jk(n,e){const t=n.filters.concat(e);return ht.create(t,n.op)}function Xk(n){return n instanceof Ke?function(t){return`${t.field.canonicalString()} ${t.op} ${uc(t.value)}`}(n):n instanceof ht?function(t){return t.op.toString()+" {"+t.getFilters().map(Xk).join(" ,")+"}"}(n):"Filter"}class h6 extends Ke{constructor(e,t,r){super(e,t,r),this.key=re.fromName(r.referenceValue)}matches(e){const t=re.comparator(e.key,this.key);return this.matchesComparison(t)}}class f6 extends Ke{constructor(e,t){super(e,"in",t),this.keys=Zk("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class m6 extends Ke{constructor(e,t){super(e,"not-in",t),this.keys=Zk("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Zk(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>re.fromName(r.referenceValue))}class p6 extends Ke{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Od(t)&&Md(t.arrayValue,this.value)}}class eR extends Ke{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Md(this.value.arrayValue,t)}}class g6 extends Ke{constructor(e,t){super(e,"not-in",t)}matches(e){if(Md(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Md(this.value.arrayValue,t)}}class y6 extends Ke{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Od(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Md(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Dv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new v6(n,e,t,r,s,i,o)}function Ia(n){const e=se(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Rv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),dh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>uc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>uc(r)).join(",")),e.Te=t}return e.Te}function fh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!d6(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Yk(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!mb(n.startAt,e.startAt)&&mb(n.endAt,e.endAt)}function Km(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ym(n,e){return n.filters.filter(t=>t instanceof Ke&&t.field.isEqual(e))}function pb(n,e,t){let r=Wf,s=!0;for(const i of Ym(n,e)){let o=Wf,a=!0;switch(i.op){case"<":case"<=":o=c6(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Wf}db({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];db({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function gb(n,e,t){let r=Gi,s=!0;for(const i of Ym(n,e)){let o=Gi,a=!0;switch(i.op){case">=":case">":o=u6(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Gi}hb({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];hb({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function tR(n,e,t,r,s,i,o,a){return new _i(n,e,t,r,s,i,o,a)}function Dc(n){return new _i(n)}function yb(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Qw(n){return n.collectionGroup!==null}function jl(n){const e=se(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new mt(Wt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Ld(i,r))}),t.has(Wt.keyField().canonicalString())||e.Ie.push(new Ld(Wt.keyField(),r))}return e.Ie}function rr(n){const e=se(n);return e.Ee||(e.Ee=rR(e,jl(n))),e.Ee}function nR(n){const e=se(n);return e.de||(e.de=rR(e,n.explicitOrderBy)),e.de}function rR(n,e){if(n.limitType==="F")return Dv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Ld(s.field,i)});const t=n.endAt?new So(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new So(n.startAt.position,n.startAt.inclusive):null;return Dv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Pv(n,e){const t=n.filters.concat([e]);return new _i(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Jm(n,e,t){return new _i(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function mh(n,e){return fh(rr(n),rr(e))&&n.limitType===e.limitType}function sR(n){return`${Ia(rr(n))}|lt:${n.limitType}`}function dl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Xk(s)).join(", ")}]`),dh(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>uc(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>uc(s)).join(",")),`Target(${r})`}(rr(n))}; limitType=${n.limitType})`}function ph(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):re.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of jl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,c){const u=fb(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,jl(r),s)||r.endAt&&!function(o,a,c){const u=fb(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,jl(r),s))}(n,e)}function iR(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function oR(n){return(e,t)=>{let r=!1;for(const s of jl(n)){const i=_6(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function _6(n,e,t){const r=n.field.isKeyField()?re.comparator(e.key,t.key):function(i,o,a){const c=o.data.field(i),u=a.data.field(i);return c!==null&&u!==null?xo(c,u):ce(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ce(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Do(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Vk(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w6=new Rt(re.comparator);function pr(){return w6}const aR=new Rt(re.comparator);function Eu(...n){let e=aR;for(const t of n)e=e.insert(t.key,t);return e}function lR(n){let e=aR;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ks(){return Hu()}function cR(){return Hu()}function Hu(){return new wi(n=>n.toString(),(n,e)=>n.isEqual(e))}const x6=new Rt(re.comparator),S6=new mt(re.comparator);function Oe(...n){let e=S6;for(const t of n)e=e.add(t);return e}const I6=new mt(ke);function Kw(){return I6}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Cd(e)?"-0":e}}function uR(n){return{integerValue:""+n}}function dR(n,e){return Tk(e)?uR(e):Yw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(){this._=void 0}}function E6(n,e,t){return n instanceof hc?function(s,i){const o={fields:{[Uk]:{stringValue:$k},[zk]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&lg(i)&&(i=cg(i)),i&&(o.fields[Bk]=i),{mapValue:o}}(t,e):n instanceof Ea?fR(n,e):n instanceof ba?mR(n,e):function(s,i){const o=hR(s,i),a=vb(o)+vb(s.Ae);return Cv(o)&&Cv(s.Ae)?uR(a):Yw(s.serializer,a)}(n,e)}function b6(n,e,t){return n instanceof Ea?fR(n,e):n instanceof ba?mR(n,e):t}function hR(n,e){return n instanceof fc?function(r){return Cv(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class hc extends dg{}class Ea extends dg{constructor(e){super(),this.elements=e}}function fR(n,e){const t=pR(e);for(const r of n.elements)t.some(s=>zs(s,r))||t.push(r);return{arrayValue:{values:t}}}class ba extends dg{constructor(e){super(),this.elements=e}}function mR(n,e){let t=pR(e);for(const r of n.elements)t=t.filter(s=>!zs(s,r));return{arrayValue:{values:t}}}class fc extends dg{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function vb(n){return Ut(n.integerValue||n.doubleValue)}function pR(n){return Od(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e,t){this.field=e,this.transform=t}}function T6(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Ea&&s instanceof Ea||r instanceof ba&&s instanceof ba?tc(r.elements,s.elements,zs):r instanceof fc&&s instanceof fc?zs(r.Ae,s.Ae):r instanceof hc&&s instanceof hc}(n.transform,e.transform)}class A6{constructor(e,t){this.version=e,this.transformResults=t}}class Gt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Gt}static exists(e){return new Gt(void 0,e)}static updateTime(e){return new Gt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Qf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class hg{}function gR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jc(n.key,Gt.none()):new Pc(n.key,n.data,Gt.none());{const t=n.data,r=qn.empty();let s=new mt(Wt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new xi(n.key,r,new mr(s.toArray()),Gt.none())}}function N6(n,e,t){n instanceof Pc?function(s,i,o){const a=s.value.clone(),c=wb(s.fieldTransforms,i,o.transformResults);a.setAll(c),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof xi?function(s,i,o){if(!Qf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=wb(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(yR(s)),c.setAll(a),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Qu(n,e,t,r){return n instanceof Pc?function(i,o,a,c){if(!Qf(i.precondition,o))return a;const u=i.value.clone(),h=xb(i.fieldTransforms,c,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof xi?function(i,o,a,c){if(!Qf(i.precondition,o))return a;const u=xb(i.fieldTransforms,c,o),h=o.data;return h.setAll(yR(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Qf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function C6(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=hR(r.transform,s||null);i!=null&&(t===null&&(t=qn.empty()),t.set(r.field,i))}return t||null}function _b(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&tc(r,s,(i,o)=>T6(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Pc extends hg{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class xi extends hg{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function yR(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function wb(n,e,t){const r=new Map;fe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,b6(o,a,t[s]))}return r}function xb(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,E6(i,o,e))}return r}class jc extends hg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Jw extends hg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&N6(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Qu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Qu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=cR();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const c=gR(o,a);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(ye.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Oe())}isEqual(e){return this.batchId===e.batchId&&tc(this.mutations,e.mutations,(t,r)=>_b(t,r))&&tc(this.baseMutations,e.baseMutations,(t,r)=>_b(t,r))}}class Zw{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){fe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return x6}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Zw(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k6{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yn,Ze;function _R(n){switch(n){case L.OK:return ce(64938);case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0;default:return ce(15467,{code:n})}}function wR(n){if(n===void 0)return hn("GRPC error has no .code"),L.UNKNOWN;switch(n){case yn.OK:return L.OK;case yn.CANCELLED:return L.CANCELLED;case yn.UNKNOWN:return L.UNKNOWN;case yn.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case yn.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case yn.INTERNAL:return L.INTERNAL;case yn.UNAVAILABLE:return L.UNAVAILABLE;case yn.UNAUTHENTICATED:return L.UNAUTHENTICATED;case yn.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case yn.NOT_FOUND:return L.NOT_FOUND;case yn.ALREADY_EXISTS:return L.ALREADY_EXISTS;case yn.PERMISSION_DENIED:return L.PERMISSION_DENIED;case yn.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case yn.ABORTED:return L.ABORTED;case yn.OUT_OF_RANGE:return L.OUT_OF_RANGE;case yn.UNIMPLEMENTED:return L.UNIMPLEMENTED;case yn.DATA_LOSS:return L.DATA_LOSS;default:return ce(39323,{code:n})}}(Ze=yn||(yn={}))[Ze.OK=0]="OK",Ze[Ze.CANCELLED=1]="CANCELLED",Ze[Ze.UNKNOWN=2]="UNKNOWN",Ze[Ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ze[Ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ze[Ze.NOT_FOUND=5]="NOT_FOUND",Ze[Ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ze[Ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ze[Ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ze[Ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ze[Ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ze[Ze.ABORTED=10]="ABORTED",Ze[Ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ze[Ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ze[Ze.INTERNAL=13]="INTERNAL",Ze[Ze.UNAVAILABLE=14]="UNAVAILABLE",Ze[Ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ku=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xR(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R6=new ao([4294967295,4294967295],0);function Sb(n){const e=xR().encode(n),t=new uk;return t.update(e),new Uint8Array(t.digest())}function Ib(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ao([t,r],0),new ao([s,i],0)]}class tx{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new bu(`Invalid padding: ${t}`);if(r<0)throw new bu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new bu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new bu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ao.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(ao.fromNumber(r)));return s.compare(R6)===1&&(s=new ao([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Sb(e),[r,s]=Ib(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new tx(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=Sb(e),[r,s]=Ib(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class bu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,vh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new yh(ye.min(),s,new Rt(ke),pr(),Oe())}}class vh{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new vh(r,t,Oe(),Oe(),Oe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class SR{constructor(e,t){this.targetId=e,this.Ce=t}}class IR{constructor(e,t,r=ln.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Eb{constructor(){this.ve=0,this.Fe=bb(),this.Me=ln.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Oe(),t=Oe(),r=Oe();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ce(38017,{changeType:i})}}),new vh(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=bb()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,fe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class D6{constructor(e){this.Ge=e,this.ze=new Map,this.je=pr(),this.Je=mf(),this.He=mf(),this.Ye=new Rt(ke)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ce(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Km(i))if(r===0){const o=new re(i.path);this.et(t,o,Ot.newNoDocument(o,ye.min()))}else fe(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),c=a?this.ct(a,e,o):1;if(c!==0){this.it(t);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}Ku==null||Ku.lt(function(h,f,m,g,v){var x,I,C;const _={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},R=f.unchangedNames;return R&&(_.bloomFilter={applied:v===0,hashCount:(R==null?void 0:R.hashCount)??0,bitmapLength:((I=(x=R==null?void 0:R.bits)==null?void 0:x.bitmap)==null?void 0:I.length)??0,padding:((C=R==null?void 0:R.bits)==null?void 0:C.padding)??0,mightContain:P=>(g==null?void 0:g.mightContain(P))??!1}),_}(o,e.Ce,this.Ge.ht(),a,c))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=fi(r).toUint8Array()}catch(c){if(c instanceof Fk)return Xr("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new tx(o,s,i)}catch(c){return Xr(c instanceof bu?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Km(a.target)){const c=new re(a.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Ot.newNoDocument(c,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=Oe();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{const u=this.ot(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new yh(e,t,this.Ye,this.je,r);return this.je=pr(),this.Je=mf(),this.He=mf(),this.Ye=new Rt(ke),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Eb,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new mt(ke),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new mt(ke),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||G("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Eb),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function mf(){return new Rt(re.comparator)}function bb(){return new Rt(re.comparator)}const P6=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),j6=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),M6=(()=>({and:"AND",or:"OR"}))();class O6{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function jv(n,e){return n.useProto3Json||dh(e)?e:{value:e}}function mc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ER(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function L6(n,e){return mc(n,e.toTimestamp())}function fn(n){return fe(!!n,49232),ye.fromTimestamp(function(t){const r=hi(t);return new Fe(r.seconds,r.nanos)}(n))}function nx(n,e){return Mv(n,e).canonicalString()}function Mv(n,e){const t=function(s){return new ze(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function bR(n){const e=ze.fromString(n);return fe(jR(e),10190,{key:e.toString()}),e}function Vd(n,e){return nx(n.databaseId,e.path)}function Ls(n,e){const t=bR(e);if(t.get(1)!==n.databaseId.projectId)throw new B(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new re(NR(t))}function TR(n,e){return nx(n.databaseId,e)}function AR(n){const e=bR(n);return e.length===4?ze.emptyPath():NR(e)}function Ov(n){return new ze(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function NR(n){return fe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Tb(n,e,t){return{name:Vd(n,e),fields:t.value.mapValue.fields}}function fg(n,e,t){const r=Ls(n,e.name),s=fn(e.updateTime),i=e.createTime?fn(e.createTime):ye.min(),o=new qn({mapValue:{fields:e.fields}}),a=Ot.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function V6(n,e){return"found"in e?function(r,s){fe(!!s.found,43571),s.found.name,s.found.updateTime;const i=Ls(r,s.found.name),o=fn(s.found.updateTime),a=s.found.createTime?fn(s.found.createTime):ye.min(),c=new qn({mapValue:{fields:s.found.fields}});return Ot.newFoundDocument(i,o,a,c)}(n,e):"missing"in e?function(r,s){fe(!!s.missing,3894),fe(!!s.readTime,22933);const i=Ls(r,s.missing),o=fn(s.readTime);return Ot.newNoDocument(i,o)}(n,e):ce(7234,{result:e})}function F6(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ce(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(fe(h===void 0||typeof h=="string",58123),ln.fromBase64String(h||"")):(fe(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),ln.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?L.UNKNOWN:wR(u.code);return new B(h,u.message||"")}(o);t=new IR(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ls(n,r.document.name),i=fn(r.document.updateTime),o=r.document.createTime?fn(r.document.createTime):ye.min(),a=new qn({mapValue:{fields:r.document.fields}}),c=Ot.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new Kf(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ls(n,r.document),i=r.readTime?fn(r.readTime):ye.min(),o=Ot.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Kf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ls(n,r.document),i=r.removedTargetIds||[];t=new Kf([],i,s,null)}else{if(!("filter"in e))return ce(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new k6(s,i),a=r.targetId;t=new SR(a,o)}}return t}function Fd(n,e){let t;if(e instanceof Pc)t={update:Tb(n,e.key,e.value)};else if(e instanceof jc)t={delete:Vd(n,e.key)};else if(e instanceof xi)t={update:Tb(n,e.key,e.data),updateMask:W6(e.fieldMask)};else{if(!(e instanceof Jw))return ce(16599,{Vt:e.type});t={verify:Vd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof hc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ea)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ba)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof fc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ce(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:L6(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ce(27497)}(n,e.precondition)),t}function Lv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Gt.updateTime(fn(i.updateTime)):i.exists!==void 0?Gt.exists(i.exists):Gt.none()}(e.currentDocument):Gt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let c=null;if("setToServerValue"in a)fe(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),c=new hc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];c=new Ea(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];c=new ba(h)}else"increment"in a?c=new fc(o,a.increment):ce(16584,{proto:a});const u=Wt.fromServerFormat(a.fieldPath);return new gh(u,c)}(n,s)):[];if(e.update){e.update.name;const s=Ls(n,e.update.name),i=new qn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const u=c.fieldPaths||[];return new mr(u.map(h=>Wt.fromServerFormat(h)))}(e.updateMask);return new xi(s,i,o,t,r)}return new Pc(s,i,t,r)}if(e.delete){const s=Ls(n,e.delete);return new jc(s,t)}if(e.verify){const s=Ls(n,e.verify);return new Jw(s,t)}return ce(1463,{proto:e})}function $6(n,e){return n&&n.length>0?(fe(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?fn(s.updateTime):fn(i);return o.isEqual(ye.min())&&(o=fn(i)),new A6(o,s.transformResults||[])}(t,e))):[]}function CR(n,e){return{documents:[TR(n,e.path)]}}function mg(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=TR(n,s);const i=function(u){if(u.length!==0)return PR(ht.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(m){return{field:Li(m.field),direction:B6(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=jv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function kR(n,e,t,r){const{ft:s,parent:i}=mg(n,e),o={},a=[];let c=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+c++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Li(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Li(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function RR(n){let e=AR(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){fe(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const m=DR(f);return m instanceof ht&&Hw(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(v){return new Ld(hl(v.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,dh(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(f){const m=!!f.before,g=f.values||[];return new So(g,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const m=!f.before,g=f.values||[];return new So(g,m)}(t.endAt)),tR(e,s,o,i,a,"F",c,u)}function U6(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ce(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function DR(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=hl(t.unaryFilter.field);return Ke.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=hl(t.unaryFilter.field);return Ke.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=hl(t.unaryFilter.field);return Ke.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=hl(t.unaryFilter.field);return Ke.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ce(61313);default:return ce(60726)}}(n):n.fieldFilter!==void 0?function(t){return Ke.create(hl(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ce(58110);default:return ce(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ht.create(t.compositeFilter.filters.map(r=>DR(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ce(1026)}}(t.compositeFilter.op))}(n):ce(30097,{filter:n})}function B6(n){return P6[n]}function z6(n){return j6[n]}function q6(n){return M6[n]}function Li(n){return{fieldPath:n.canonicalString()}}function hl(n){return Wt.fromServerFormat(n.fieldPath)}function PR(n){return n instanceof Ke?function(t){if(t.op==="=="){if(ub(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NAN"}};if(cb(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ub(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NOT_NAN"}};if(cb(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Li(t.field),op:z6(t.op),value:t.value}}}(n):n instanceof ht?function(t){const r=t.getFilters().map(s=>PR(s));return r.length===1?r[0]:{compositeFilter:{op:q6(t.op),filters:r}}}(n):ce(54877,{filter:n})}function W6(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function jR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t,r,s,i=ye.min(),o=ye.min(),a=ln.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new ei(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e){this.yt=e}}function G6(n,e){let t;if(e.document)t=fg(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=re.fromSegments(e.noDocument.path),s=Aa(e.noDocument.readTime);t=Ot.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ce(56709);{const r=re.fromSegments(e.unknownDocument.path),s=Aa(e.unknownDocument.version);t=Ot.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Fe(s[0],s[1]);return ye.fromTimestamp(i)}(e.readTime)),t}function Ab(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Xm(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Vd(i,o.key),fields:o.data.value.mapValue.fields,updateTime:mc(i,o.version.toTimestamp()),createTime:mc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ta(e.version)};else{if(!e.isUnknownDocument())return ce(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Ta(e.version)}}return r}function Xm(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ta(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Aa(n){const e=new Fe(n.seconds,n.nanoseconds);return ye.fromTimestamp(e)}function Ho(n,e){const t=(e.baseMutations||[]).map(i=>Lv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Lv(n.yt,i)),s=Fe.fromMillis(e.localWriteTimeMs);return new Xw(e.batchId,s,t,r)}function Tu(n){const e=Aa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Aa(n.lastLimboFreeSnapshotVersion):ye.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return fe(o===1,1966,{count:o}),rr(Dc(AR(i.documents[0])))}(n.query):function(i){return rr(RR(i))}(n.query),new ei(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ln.fromBase64String(n.resumeToken))}function OR(n,e){const t=Ta(e.snapshotVersion),r=Ta(e.lastLimboFreeSnapshotVersion);let s;s=Km(e.target)?CR(n.yt,e.target):mg(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ia(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function pg(n){const e=RR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Jm(e,e.limit,"L"):e}function Oy(n,e){return new ex(e.largestBatchId,Lv(n.yt,e.overlayMutation))}function Nb(n,e){const t=e.path.lastSegment();return[n,nr(e.path.popLast()),t]}function Cb(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ta(r.readTime),documentKey:nr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H6{getBundleMetadata(e,t){return kb(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Aa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return kb(e).put(function(s){return{bundleId:s.id,createTime:Ta(fn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Rb(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:pg(i.bundledQuery),readTime:Aa(i.readTime)}}(r)})}saveNamedQuery(e,t){return Rb(e).put(function(s){return{name:s.name,readTime:Ta(fn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function kb(n){return Tn(n,ig)}function Rb(n){return Tn(n,og)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new gg(e,r)}getOverlay(e,t){return lu(e).get(Nb(this.userId,t)).next(r=>r?Oy(this.serializer,r):null)}getOverlays(e,t){const r=ks();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new ex(t,o);s.push(this.St(e,a))}),M.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(nr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(lu(e).Z(Tv,a))}),M.waitFor(i)}getOverlaysForCollection(e,t,r){const s=ks(),i=nr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return lu(e).J(Tv,o).next(a=>{for(const c of a){const u=Oy(this.serializer,c);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=ks();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return lu(e).ee({index:Dk,range:a},(c,u,h)=>{const f=Oy(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return lu(e).put(function(s,i,o){const[a,c,u]=Nb(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Fd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function lu(n){return Tn(n,ag)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q6{bt(e){return Tn(e,zw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?ln.fromUint8Array(r):ln.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Ut(e.integerValue));else if("doubleValue"in e){const r=Ut(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Cd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=hi(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(fi(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?Wk(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ug(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ce(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=cc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(Ut(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),re.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Qo.Kt=new Qo;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const il=255;function K6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Db(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=K6(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class Y6{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=Db(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=Db(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(il),this.sn(255)}_n(){this.an(il),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===il?(this.sn(il),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===il?(this.an(il),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class J6{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class X6{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class cu{constructor(){this.cn=new Y6,this.ln=new J6(this.cn),this.hn=new X6(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new Ko(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Yf(this.En),directionalValue:Yf(this.dn),orderedDocumentKey:Yf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Ci(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=Pb(n.En,e.En),t!==0?t:(t=Pb(n.dn,e.dn),t!==0?t:re.comparator(n.In,e.In)))}function Pb(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Yf(n){return jN()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function jb(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class Mb{constructor(e){this.mn=new mt((t,r)=>Wt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(fe(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Iv(e);if(t!==void 0&&!this.wn(t))return!1;const r=qo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const c=r[i];if(!this.Sn(a,c)||!this.bn(this.fn[o++],c))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new mt(Wt.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new aa(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new aa(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new aa(r.field,r.dir==="asc"?0:1)));return new rc(rc.UNKNOWN_ID,this.collectionId,t,sc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LR(n){var t,r;if(fe(n instanceof Ke||n instanceof ht,20012),n instanceof Ke){if(n instanceof eR){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>Ke.create(n.field,"==",i)))||[];return ht.create(s,"or")}return n}const e=n.filters.map(s=>LR(s));return ht.create(e,n.op)}function Z6(n){if(n.getFilters().length===0)return[];const e=$v(LR(n));return fe(VR(e),7391),Vv(e)||Fv(e)?[e]:e.getFilters()}function Vv(n){return n instanceof Ke}function Fv(n){return n instanceof ht&&Hw(n)}function VR(n){return Vv(n)||Fv(n)||function(t){if(t instanceof ht&&kv(t)){for(const r of t.getFilters())if(!Vv(r)&&!Fv(r))return!1;return!0}return!1}(n)}function $v(n){if(fe(n instanceof Ke||n instanceof ht,34018),n instanceof Ke)return n;if(n.filters.length===1)return $v(n.filters[0]);const e=n.filters.map(r=>$v(r));let t=ht.create(e,n.op);return t=Zm(t),VR(t)?t:(fe(t instanceof ht,64498),fe(dc(t),40251),fe(t.filters.length>1,57927),t.filters.reduce((r,s)=>rx(r,s)))}function rx(n,e){let t;return fe(n instanceof Ke||n instanceof ht,38388),fe(e instanceof Ke||e instanceof ht,25473),t=n instanceof Ke?e instanceof Ke?function(s,i){return ht.create([s,i],"and")}(n,e):Ob(n,e):e instanceof Ke?Ob(e,n):function(s,i){if(fe(s.filters.length>0&&i.filters.length>0,48005),dc(s)&&dc(i))return Jk(s,i.getFilters());const o=kv(s)?s:i,a=kv(s)?i:s,c=o.filters.map(u=>rx(u,a));return ht.create(c,"or")}(n,e),Zm(t)}function Ob(n,e){if(dc(e))return Jk(e,n.getFilters());{const t=e.filters.map(r=>rx(n,r));return ht.create(t,"or")}}function Zm(n){if(fe(n instanceof Ke||n instanceof ht,11850),n instanceof Ke)return n;const e=n.getFilters();if(e.length===1)return Zm(e[0]);if(Kk(n))return n;const t=e.map(s=>Zm(s)),r=[];return t.forEach(s=>{s instanceof Ke?r.push(s):s instanceof ht&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ht.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(){this.Cn=new sx}addToCollectionParentIndex(e,t){return this.Cn.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(Vr.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(Vr.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class sx{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new mt(ze.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new mt(ze.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lb="IndexedDbIndexManager",pf=new Uint8Array(0);class t5{constructor(e,t){this.databaseId=t,this.vn=new sx,this.Fn=new wi(r=>Ia(r),(r,s)=>fh(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:nr(s)};return Vb(e).put(i)}return M.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[vk(t),""],!1,!0);return Vb(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Cs(o.parent))}return r})}addFieldIndex(e,t){const r=uu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=al(e);return i.next(a=>{o.put(Cb(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=uu(e),s=al(e),i=ol(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=uu(e),r=ol(e),s=al(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return M.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Mb(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=ol(e);let s=!0;const i=new Map;return M.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Oe();const a=[];return M.forEach(i,(c,u)=>{G(Lb,`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(c)} to execute ${Ia(t)}`);const h=function(C,P){const $=Iv(P);if($===void 0)return null;for(const V of Ym(C,$.fieldPath))switch(V.op){case"array-contains-any":return V.value.arrayValue.values||[];case"array-contains":return[V.value]}return null}(u,c),f=function(C,P){const $=new Map;for(const V of qo(P))for(const A of Ym(C,V.fieldPath))switch(A.op){case"==":case"in":$.set(V.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return $.set(V.fieldPath.canonicalString(),A.value),Array.from($.values())}return null}(u,c),m=function(C,P){const $=[];let V=!0;for(const A of qo(P)){const S=A.kind===0?pb(C,A.fieldPath,C.startAt):gb(C,A.fieldPath,C.startAt);$.push(S.value),V&&(V=S.inclusive)}return new So($,V)}(u,c),g=function(C,P){const $=[];let V=!0;for(const A of qo(P)){const S=A.kind===0?gb(C,A.fieldPath,C.endAt):pb(C,A.fieldPath,C.endAt);$.push(S.value),V&&(V=S.inclusive)}return new So($,V)}(u,c),v=this.On(c,u,m),_=this.On(c,u,g),R=this.Nn(c,u,f),x=this.Bn(c.indexId,h,v,m.inclusive,_,g.inclusive,R);return M.forEach(x,I=>r.Y(I,t.limit).next(C=>{C.forEach(P=>{const $=re.fromSegments(P.documentKey);o.has($)||(o=o.add($),a.push($))})}))}).next(()=>a)}return M.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=Z6(ht.create(e.filters,"and")).map(r=>Dv(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const c=(t!=null?t.length:1)*Math.max(r.length,i.length),u=c/(t!=null?t.length:1),h=[];for(let f=0;f<c;++f){const m=t?this.Ln(t[f/u]):pf,g=this.kn(e,m,r[f%u],s),v=this.qn(e,m,i[f%u],o),_=a.map(R=>this.kn(e,m,R,!0));h.push(...this.createRange(g,v,_))}return h}kn(e,t,r,s){const i=new Ko(e,re.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new Ko(e,re.empty(),t,r);return s?i.An():i}xn(e,t){const r=new Mb(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return M.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(c){let u=new mt(Wt.comparator),h=!1;for(const f of c.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:u=u.add(m.field));for(const f of c.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new cu;for(const s of qo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);Qo.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new cu;return Qo.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new cu;return Qo.Kt.Dt(Sa(this.databaseId,t),r.Pn(function(i){const o=qo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new cu);let i=0;for(const o of qo(e)){const a=r[i++];for(const c of s)if(this.Un(t,o.fieldPath)&&Od(a))s=this.Kn(s,o,a);else{const u=c.Pn(o.kind);Qo.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const c=new cu;c.seed(a.un()),Qo.Kt.Dt(o,c.Pn(t.kind)),i.push(c)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof Ke&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=uu(e),s=al(e);return(t?r.J(bv,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return M.forEach(i,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(h,f){const m=f?new sc(f.sequenceNumber,new Vr(Aa(f.readTime),new re(Cs(f.documentKey)),f.largestBatchId)):sc.empty(),g=h.fields.map(([v,_])=>new aa(Wt.fromServerFormat(v),_));return new rc(h.indexId,h.collectionGroup,g,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ke(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=uu(e),i=al(e);return this.Gn(e).next(o=>s.J(bv,IDBKeyRange.bound(t,t)).next(a=>M.forEach(a,c=>i.put(Cb(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return M.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?M.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),M.forEach(a,c=>this.zn(e,s,c).next(u=>{const h=this.jn(i,c);return u.isEqual(h)?M.resolve():this.Jn(e,i,c,u,h)}))))})}Hn(e,t,r,s){return ol(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return ol(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=ol(e);let i=new mt(Ci);return s.ee({index:Rk,range:IDBKeyRange.only([r.indexId,this.uid,Yf(this.$n(r,t))])},(o,a)=>{i=i.add(new Ko(r.indexId,t,jb(a.arrayValue),jb(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new mt(Ci);const s=this.Qn(t,e);if(s==null)return r;const i=Iv(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Od(o))for(const a of o.arrayValue.values||[])r=r.add(new Ko(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new Ko(t.indexId,e.key,pf,s));return r}Jn(e,t,r,s,i){G(Lb,"Updating index entries for document '%s'",t.key);const o=[];return function(c,u,h,f,m){const g=c.getIterator(),v=u.getIterator();let _=sl(g),R=sl(v);for(;_||R;){let x=!1,I=!1;if(_&&R){const C=h(_,R);C<0?I=!0:C>0&&(x=!0)}else _!=null?I=!0:x=!0;x?(f(R),R=sl(v)):I?(m(_),_=sl(g)):(_=sl(g),R=sl(v))}}(s,i,Ci,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),M.waitFor(o)}Gn(e){let t=1;return al(e).ee({index:kk,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ci(o,a)).filter((o,a,c)=>!a||Ci(o,c[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ci(o,e),c=Ci(o,t);if(a===0)s[0]=e.An();else if(a>0&&c<0)s.push(o),s.push(o.An());else if(c>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,pf,re.empty()),c=s[o+1].Vn(this.uid,pf,re.empty());i.push(IDBKeyRange.bound(a,c))}return i}Zn(e,t){return Ci(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Fb)}getMinOffset(e,t){return M.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||ce(44426))).next(Fb)}}function Vb(n){return Tn(n,Dd)}function ol(n){return Tn(n,Wu)}function uu(n){return Tn(n,Bw)}function al(n){return Tn(n,qu)}function Fb(n){fe(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Fw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Vr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $b={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},FR=41943040;class Zn{static withCacheSize(e){return new Zn(e,Zn.DEFAULT_COLLECTION_PERCENTILE,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $R(n,e,t){const r=n.store(as),s=n.store(ic),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=r.ee({range:o},(h,f,m)=>(a++,m.delete()));i.push(c.next(()=>{fe(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=Ak(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return M.waitFor(i).next(()=>u)}function ep(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ce(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zn.DEFAULT_COLLECTION_PERCENTILE=10,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zn.DEFAULT=new Zn(FR,Zn.DEFAULT_COLLECTION_PERCENTILE,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zn.DISABLED=new Zn(-1,0,0);class yg{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){fe(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new yg(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).ee({index:ea,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=fl(e),o=ki(e);return o.add({}).next(a=>{fe(typeof a=="number",49019);const c=new Xw(a,t,r,s),u=function(g,v,_){const R=_.baseMutations.map(I=>Fd(g.yt,I)),x=_.mutations.map(I=>Fd(g.yt,I));return{userId:v,batchId:_.batchId,localWriteTimeMs:_.localWriteTime.toMillis(),baseMutations:R,mutations:x}}(this.serializer,this.userId,c),h=[];let f=new mt((m,g)=>ke(m.canonicalString(),g.canonicalString()));for(const m of s){const g=Ak(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(u)),h.push(i.put(g,L3))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[a]=c.keys()}),M.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return ki(e).get(t).next(r=>r?(fe(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Ho(this.serializer,r)):null)}er(e,t){return this.Xn[t]?M.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ki(e).ee({index:ea,range:s},(o,a,c)=>{a.userId===this.userId&&(fe(a.batchId>=r,47524,{tr:r}),i=Ho(this.serializer,a)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=lo;return ki(e).ee({index:ea,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,lo],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).J(ea,t).next(r=>r.map(s=>Ho(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=zf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return fl(e).ee({range:s},(o,a,c)=>{const[u,h,f]=o,m=Cs(h);if(u===this.userId&&t.path.isEqual(m))return ki(e).get(f).next(g=>{if(!g)throw ce(61480,{nr:o,batchId:f});fe(g.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:g.userId,batchId:f}),i.push(Ho(this.serializer,g))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new mt(ke);const s=[];return t.forEach(i=>{const o=zf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),c=fl(e).ee({range:a},(u,h,f)=>{const[m,g,v]=u,_=Cs(g);m===this.userId&&i.path.isEqual(_)?r=r.add(v):f.done()});s.push(c)}),M.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=zf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new mt(ke);return fl(e).ee({range:o},(c,u,h)=>{const[f,m,g]=c,v=Cs(m);f===this.userId&&r.isPrefixOf(v)?v.length===s&&(a=a.add(g)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ki(e).get(i).next(o=>{if(o===null)throw ce(35274,{batchId:i});fe(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(Ho(this.serializer,o))}))}),M.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return $R(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),M.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return M.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return fl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const c=Cs(i[1]);s.push(c)}else a.done()}).next(()=>{fe(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return UR(e,this.userId,t)}_r(e){return BR(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:lo,lastStreamToken:""})}}function UR(n,e,t){const r=zf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return fl(n).ee({range:i,X:!0},(a,c,u)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function ki(n){return Tn(n,as)}function fl(n){return Tn(n,ic)}function BR(n){return Tn(n,kd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Na(0)}static cr(){return new Na(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Na(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>ye.fromTimestamp(new Fe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ll(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(fe(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return ll(e).ee((o,a)=>{const c=Tu(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>M.waitFor(i)).next(()=>s)}forEachTarget(e,t){return ll(e).ee((r,s)=>{const i=Tu(s);t(i)})}lr(e){return Ub(e).get(Qm).next(t=>(fe(t!==null,2888),t))}hr(e,t){return Ub(e).put(Qm,t)}Pr(e,t){return ll(e).put(OR(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ia(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return ll(e).ee({range:s,index:Ck},(o,a,c)=>{const u=Tu(a);fh(t,u.target)&&(i=u,c.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Vi(e);return t.forEach(o=>{const a=nr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),M.waitFor(s)}removeMatchingKeys(e,t,r){const s=Vi(e);return M.forEach(t,i=>{const o=nr(i.path);return M.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Vi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Vi(e);let i=Oe();return s.ee({range:r,X:!0},(o,a,c)=>{const u=Cs(o[1]),h=new re(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=nr(t.path),s=IDBKeyRange.bound([r],[vk(r)],!1,!0);let i=0;return Vi(e).ee({index:Uw,X:!0,range:s},([o,a],c,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return ll(e).get(t).next(r=>r?Tu(r):null)}}function ll(n){return Tn(n,oc)}function Ub(n){return Tn(n,la)}function Vi(n){return Tn(n,ac)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bb="LruGarbageCollector",zR=1048576;function zb([n,e],[t,r]){const s=ke(n,t);return s===0?ke(e,r):s}class r5{constructor(e){this.Ir=e,this.buffer=new mt(zb),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();zb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class qR{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){G(Bb,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ro(t)?G(Bb,"Ignoring IndexedDB error during garbage collection: ",t):await ko(t)}await this.Vr(3e5)})}}class s5{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return M.resolve(fr.ce);const r=new r5(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(G("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve($b)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(G("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$b):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(G("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),ul()<=We.DEBUG&&G("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(c-a)+`ms
	Removed ${f} documents in `+(u-c)+`ms
Total Duration: ${u-h}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function WR(n,e){return new s5(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5{constructor(e,t){this.db=e,this.garbageCollector=WR(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return gf(e,r)}removeReference(e,t,r){return gf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return gf(e,t)}br(e,t){return function(s,i){let o=!1;return BR(s).te(a=>UR(s,a,i).next(c=>(c&&(o=!0),M.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const c=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ye.min()),Vi(e).delete(function(f){return[0,nr(f.path)]}(o))))});s.push(c)}}).next(()=>M.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return gf(e,t)}Sr(e,t){const r=Vi(e);let s,i=fr.ce;return r.ee({index:Uw},([o,a],{path:c,sequenceNumber:u})=>{o===0?(i!==fr.ce&&t(new re(Cs(s)),i),i=u,s=c):i=fr.ce}).next(()=>{i!==fr.ce&&t(new re(Cs(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function gf(n,e){return Vi(n).put(function(r,s){return{targetId:0,path:nr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(){this.changes=new wi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Fo(e).put(r)}removeEntry(e,t,r){return Fo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Xm(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Ot.newInvalidDocument(t);return Fo(e).ee({index:qf,range:IDBKeyRange.only(du(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Ot.newInvalidDocument(t)};return Fo(e).ee({index:qf,range:IDBKeyRange.only(du(t))},(s,i)=>{r={document:this.Cr(t,i),size:ep(i)}}).next(()=>r)}getEntries(e,t){let r=pr();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=pr(),s=new Rt(re.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,ep(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return M.resolve();let s=new mt(Gb);t.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(du(s.first()),du(s.last())),o=s.getIterator();let a=o.getNext();return Fo(e).ee({index:qf,range:i},(c,u,h)=>{const f=re.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Gb(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(du(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Xm(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Fo(e).J(IDBKeyRange.bound(a,c,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=pr();for(const f of u){const m=this.Cr(re.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(ph(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=pr();const o=Wb(t,r),a=Wb(t,Vr.max());return Fo(e).ee({index:Nk,range:IDBKeyRange.bound(o,a,!0)},(c,u,h)=>{const f=this.Cr(re.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new a5(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return qb(e).get(Ev).next(t=>(fe(!!t,20021),t))}Dr(e,t){return qb(e).put(Ev,t)}Cr(e,t){if(t){const r=G6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ye.min())))return r}return Ot.newInvalidDocument(e)}}function HR(n){return new o5(n)}class a5 extends GR{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new wi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new mt((i,o)=>ke(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const c=Ab(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=ep(c);r+=u-a.size,t.push(this.Nr.addEntry(e,i,c))}else if(r-=a.size,this.trackRemovals){const c=Ab(this.Nr.serializer,o.convertToNoDocument(ye.min()));t.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),M.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function qb(n){return Tn(n,Rd)}function Fo(n){return Tn(n,Hm)}function du(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Wb(n,e){const t=e.documentKey.path.toArray();return[n,Xm(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Gb(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=ke(t[i],r[i]),s)return s;return s=ke(t.length,r.length),s||(s=ke(t[t.length-2],r[r.length-2]),s||ke(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Qu(r.mutation,s,mr.empty(),Fe.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Oe()){const s=ks();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Eu();return i.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ks();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Oe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=pr();const o=Hu(),a=function(){return Hu()}();return t.forEach((c,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof xi)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Qu(h.mutation,u,h.mutation.getFieldMask(),Fe.now())):o.set(u.key,mr.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new l5(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Hu();let s=new Rt((o,a)=>o-a),i=Oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const u=t.get(c);if(u===null)return;let h=r.get(c)||mr.empty();h=a.applyToLocalView(u,h),r.set(c,h);const f=(s.get(a.batchId)||Oe()).add(c);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),u=c.key,h=c.value,f=cR();h.forEach(m=>{if(!i.has(m)){const g=gR(t.get(m),r.get(m));g!==null&&f.set(m,g),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return M.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Qw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):M.resolve(ks());let a=nc,c=i;return o.next(u=>M.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?M.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{c=c.insert(h,m)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,c,u,Oe())).next(h=>({batchId:a,changes:lR(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new re(t)).next(r=>{let s=Eu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Eu();return this.indexManager.getCollectionParents(e,i).next(a=>M.forEach(a,c=>{const u=function(f,m){return new _i(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((c,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Ot.newInvalidDocument(h)))});let a=Eu();return o.forEach((c,u)=>{const h=i.get(c);h!==void 0&&Qu(h.mutation,u,mr.empty(),Fe.now()),ph(t,u)&&(a=a.insert(c,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return M.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:fn(s.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:pg(s.bundledQuery),readTime:fn(s.readTime)}}(t)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(){this.overlays=new Rt(re.comparator),this.qr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ks();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),M.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){const s=ks(),i=t.length+1,o=new re(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return M.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Rt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=ks(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=ks(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return M.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new ex(t,r));let i=this.qr.get(t);i===void 0&&(i=Oe(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5{constructor(){this.sessionToken=ln.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(){this.Qr=new mt(kn.$r),this.Ur=new mt(kn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new kn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new kn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new re(new ze([])),r=new kn(t,e),s=new kn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new re(new ze([])),r=new kn(t,e),s=new kn(t,e+1);let i=Oe();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new kn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class kn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return re.comparator(e.key,t.key)||ke(e.Yr,t.Yr)}static Kr(e,t){return ke(e.Yr,t.Yr)||re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new mt(kn.$r)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Xw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new kn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return M.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?lo:this.tr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new kn(t,0),s=new kn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),M.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new mt(ke);return t.forEach(s=>{const i=new kn(s,0),o=new kn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),M.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;re.isDocumentKey(i)||(i=i.child(""));const o=new kn(new re(i),0);let a=new mt(ke);return this.Zr.forEachWhile(c=>{const u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.Yr)),!0)},o),M.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){fe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return M.forEach(t.mutations,s=>{const i=new kn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new kn(t,0),s=this.Zr.firstAfterOrEqual(r);return M.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f5{constructor(e){this.ri=e,this.docs=function(){return new Rt(re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():Ot.newInvalidDocument(t))}getEntries(e,t){let r=pr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ot.newInvalidDocument(s))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=pr();const o=t.path,a=new re(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:u,value:{document:h}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Fw(Sk(h),r)<=0||(s.has(h.key)||ph(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return M.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ce(9500)}ii(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new m5(this)}getSize(e){return M.resolve(this.size)}}class m5 extends GR{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(e){this.persistence=e,this.si=new wi(t=>Ia(t),fh),this.lastRemoteSnapshotVersion=ye.min(),this.highestTargetId=0,this.oi=0,this._i=new ix,this.targetCount=0,this.ai=Na.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),M.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Na(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Pr(t),M.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),M.waitFor(i).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),M.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{constructor(e,t){this.ui={},this.overlays={},this.ci=new fr(0),this.li=!1,this.li=!0,this.hi=new d5,this.referenceDelegate=e(this),this.Pi=new p5(this),this.indexManager=new e5,this.remoteDocumentCache=function(s){return new f5(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new MR(t),this.Ii=new c5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new u5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new h5(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){G("MemoryPersistence","Starting transaction:",e);const s=new g5(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return M.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class g5 extends Ek{constructor(e){super(),this.currentSequenceNumber=e}}class vg{constructor(e){this.persistence=e,this.Ri=new ix,this.Vi=null}static mi(e){return new vg(e)}get fi(){if(this.Vi)return this.Vi;throw ce(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),M.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.fi,r=>{const s=re.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,ye.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return M.or([()=>M.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class tp{constructor(e,t){this.persistence=e,this.pi=new wi(r=>nr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=WR(this,t)}static mi(e,t){return new tp(e,t)}Ei(){}di(e){return M.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return M.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?M.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,ye.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),M.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),M.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Gf(e.data.value)),t}br(e,t,r){return M.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return M.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(e){this.serializer=e}k(e,t,r,s){const i=new sg("createOrUpgrade",t);r<1&&s>=1&&(function(c){c.createObjectStore(hh)}(e),function(c){c.createObjectStore(kd,{keyPath:O3}),c.createObjectStore(as,{keyPath:rb,autoIncrement:!0}).createIndex(ea,sb,{unique:!0}),c.createObjectStore(ic)}(e),Hb(e),function(c){c.createObjectStore(Wo)}(e));let o=M.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(ac),c.deleteObjectStore(oc),c.deleteObjectStore(la)}(e),Hb(e)),o=o.next(()=>function(c){const u=c.store(la),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ye.min().toTimestamp(),targetCount:0};return u.put(Qm,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(c,u){return u.store(as).J().next(f=>{c.deleteObjectStore(as),c.createObjectStore(as,{keyPath:rb,autoIncrement:!0}).createIndex(ea,sb,{unique:!0});const m=u.store(as),g=f.map(v=>m.put(v));return M.waitFor(g)})}(e,i))),o=o.next(()=>{(function(c){c.createObjectStore(lc,{keyPath:W3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore(Rd)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(ig,{keyPath:G3})})(e),function(c){c.createObjectStore(og,{keyPath:H3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(c){const u=c.createObjectStore(ag,{keyPath:e6});u.createIndex(Tv,t6,{unique:!1}),u.createIndex(Dk,n6,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(c){const u=c.createObjectStore(Hm,{keyPath:V3});u.createIndex(qf,F3),u.createIndex(Nk,$3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Wo))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore(Bw,{keyPath:Q3,autoIncrement:!0}).createIndex(bv,K3,{unique:!1}),c.createObjectStore(qu,{keyPath:Y3}).createIndex(kk,J3,{unique:!1}),c.createObjectStore(Wu,{keyPath:X3}).createIndex(Rk,Z3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(qu).clear()}).next(()=>{t.objectStore(Wu).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(zw,{keyPath:r6})})(e)})),r<18&&s>=18&&jN()&&(o=o.next(()=>{t.objectStore(qu).clear()}).next(()=>{t.objectStore(Wu).clear()})),o}wi(e){let t=0;return e.store(Wo).ee((r,s)=>{t+=ep(s)}).next(()=>{const r={byteSize:t};return e.store(Rd).put(Ev,r)})}yi(e){const t=e.store(kd),r=e.store(as);return t.J().next(s=>M.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,lo],[i.userId,i.lastAcknowledgedBatchId]);return r.J(ea,o).next(a=>M.forEach(a,c=>{fe(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const u=Ho(this.serializer,c);return $R(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(ac),r=e.store(Wo);return e.store(la).get(Qm).next(s=>{const i=[];return r.ee((o,a)=>{const c=new ze(o),u=function(f){return[0,nr(f)]}(c);i.push(t.get(u).next(h=>h?M.resolve():(f=>t.put({targetId:0,path:nr(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>M.waitFor(i))})}bi(e,t){e.createObjectStore(Dd,{keyPath:q3});const r=t.store(Dd),s=new sx,i=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:nr(c)})}};return t.store(Wo).ee({X:!0},(o,a)=>{const c=new ze(o);return i(c.popLast())}).next(()=>t.store(ic).ee({X:!0},([o,a,c],u)=>{const h=Cs(a);return i(h.popLast())}))}Di(e){const t=e.store(oc);return t.ee((r,s)=>{const i=Tu(s),o=OR(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(Wo),s=[];return r.ee((i,o)=>{const a=t.store(Hm),c=function(f){return f.document?new re(ze.fromString(f.document.name).popFirst(5)):f.noDocument?re.fromSegments(f.noDocument.path):f.unknownDocument?re.fromSegments(f.unknownDocument.path):ce(36783)}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>M.waitFor(s))}Fi(e,t){const r=t.store(as),s=HR(this.serializer),i=new ox(vg.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(c=>{let u=a.get(c.userId)??Oe();Ho(this.serializer,c).keys().forEach(h=>u=u.add(h)),a.set(c.userId,u)}),M.forEach(a,(c,u)=>{const h=new Dn(u),f=gg.wt(this.serializer,h),m=i.getIndexManager(h),g=yg.wt(h,this.serializer,m,i.referenceDelegate);return new QR(s,g,f,m).recalculateAndSaveOverlaysForDocumentKeys(new Av(t,fr.ce),c).next()})})}}function Hb(n){n.createObjectStore(ac,{keyPath:B3}).createIndex(Uw,z3,{unique:!0}),n.createObjectStore(oc,{keyPath:"targetId"}).createIndex(Ck,U3,{unique:!0}),n.createObjectStore(la)}const Ri="IndexedDbPersistence",Ly=18e5,Vy=5e3,Fy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",KR="main";class ax{constructor(e,t,r,s,i,o,a,c,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!ax.v())throw new B(L.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new i5(this,s),this.$i=t+KR,this.serializer=new MR(c),this.Ui=new Os(this.$i,this.Ni,new y5(this.serializer)),this.hi=new Q6,this.Pi=new n5(this.referenceDelegate,this.serializer),this.remoteDocumentCache=HR(this.serializer),this.Ii=new H6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&hn(Ri,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(L.FAILED_PRECONDITION,Fy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new fr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>yf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(Ro(e))return G(Ri,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return G(Ri,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return hu(e).get(rl).next(t=>M.resolve(this.es(t)))}ts(e){return yf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ly)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Tn(t,lc);return r.J().next(s=>{const i=this.ss(s,Ly),o=s.filter(a=>i.indexOf(a)===-1);return M.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?M.resolve(!0):hu(e).get(rl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Vy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new B(L.FAILED_PRECONDITION,Fy);return!1}}return!(!this.networkEnabled||!this.inForeground)||yf(e).J().next(r=>this.ss(r,Vy).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&G(Ri,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[hh,lc],e=>{const t=new Av(e,fr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>yf(e).J().next(t=>this.ss(t,Ly).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return yg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new t5(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return gg.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){G(Ri,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(c){return c===18?o6:c===17?Ok:c===16?i6:c===15?qw:c===14?Mk:c===13?jk:c===12?s6:c===11?Pk:void ce(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new Av(a,this.ci?this.ci.next():fr.ce),t==="readwrite-primary"?this.Hi(o).next(c=>!!c||this.Yi(o)).next(c=>{if(!c)throw hn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new B(L.FAILED_PRECONDITION,Ik);return r(o)}).next(c=>this.Xi(o).next(()=>c)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return hu(e).get(rl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Vy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new B(L.FAILED_PRECONDITION,Fy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return hu(e).put(rl,t)}static v(){return Os.v()}Zi(e){const t=hu(e);return t.get(rl).next(r=>this.es(r)?(G(Ri,"Releasing primary lease."),t.delete(rl)):M.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(hn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;PN()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return G(Ri,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return hn(Ri,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){hn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function hu(n){return Tn(n,hh)}function yf(n){return Tn(n,lc)}function lx(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cx{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=Oe(),s=Oe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new cx(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return PN()?8:bk(bn())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new v5;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(ul()<=We.DEBUG&&G("QueryEngine","SDK will not create cache indexes for query:",dl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),M.resolve()):(ul()<=We.DEBUG&&G("QueryEngine","Query:",dl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(ul()<=We.DEBUG&&G("QueryEngine","The SDK decides to create cache indexes for query:",dl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rr(t))):M.resolve())}ys(e,t){if(yb(t))return M.resolve(null);let r=rr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Jm(t,null,"F"),r=rr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Oe(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const u=this.Ds(t,a);return this.Cs(t,u,o,c.readTime)?this.ys(e,Jm(t,null,"F")):this.vs(e,u,t,c)}))})))}ws(e,t,r,s){return yb(t)||s.isEqual(ye.min())?M.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?M.resolve(null):(ul()<=We.DEBUG&&G("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),dl(t)),this.vs(e,o,t,xk(s,nc)).next(a=>a))})}Ds(e,t){let r=new mt(oR(e));return t.forEach((s,i)=>{ph(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return ul()<=We.DEBUG&&G("QueryEngine","Using full collection scan to execute query:",dl(t)),this.ps.getDocumentsMatchingQuery(e,t,Vr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ux="LocalStore",_5=3e8;class w5{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Rt(ke),this.xs=new wi(i=>Ia(i),fh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new QR(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function JR(n,e,t,r){return new w5(n,e,t,r)}async function XR(n,e){const t=se(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let c=Oe();for(const u of s){o.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(r,c).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function x5(n,e){const t=se(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,c,u,h){const f=u.batch,m=f.keys();let g=M.resolve();return m.forEach(v=>{g=g.next(()=>h.getEntry(c,v)).next(_=>{const R=u.docVersions.get(v);fe(R!==null,48541),_.version.compareTo(R)<0&&(f.applyToRemoteDocument(_,u),_.isValidDocument()&&(_.setReadTime(u.commitVersion),h.addEntry(_)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=Oe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function ZR(n){const e=se(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function S5(n,e){const t=se(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let g=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?g=g.withResumeToken(ln.EMPTY_BYTE_STRING,ye.min()).withLastLimboFreeSnapshotVersion(ye.min()):h.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(h.resumeToken,r)),s=s.insert(f,g),function(_,R,x){return _.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=_5?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(m,g,h)&&a.push(t.Pi.updateTargetData(i,g))});let c=pr(),u=Oe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(eD(i,o,e.documentUpdates).next(h=>{c=h.ks,u=h.qs})),!r.isEqual(ye.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return M.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,u)).next(()=>c)}).then(i=>(t.Ms=s,i))}function eD(n,e,t){let r=Oe(),s=Oe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=pr();return t.forEach((a,c)=>{const u=i.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(ye.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):G(ux,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{ks:o,qs:s}})}function I5(n,e){const t=se(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=lo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function pc(n,e){const t=se(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,M.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new ei(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function gc(n,e,t){const r=se(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ro(o))throw o;G(ux,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function np(n,e,t){const r=se(n);let s=ye.min(),i=Oe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,h){const f=se(c),m=f.xs.get(h);return m!==void 0?M.resolve(f.Ms.get(m)):f.Pi.getTargetData(u,h)}(r,o,rr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:ye.min(),t?i:Oe())).next(a=>(rD(r,iR(e),a),{documents:a,Qs:i})))}function tD(n,e){const t=se(n),r=se(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function nD(n,e){const t=se(n),r=t.Os.get(e)||ye.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,xk(r,nc),Number.MAX_SAFE_INTEGER)).then(s=>(rD(t,e,s),s))}function rD(n,e,t){let r=n.Os.get(e)||ye.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function E5(n,e,t,r){const s=se(n);let i=Oe(),o=pr();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),c=await pc(s,function(h){return rr(Dc(ze.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>eD(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,c.targetId).next(()=>s.Pi.addMatchingKeys(u,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function b5(n,e,t=Oe()){const r=await pc(n,rr(pg(e.bundledQuery))),s=se(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=fn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(ln.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD="firestore_clients";function Qb(n,e){return`${sD}_${n}_${e}`}const iD="firestore_mutations";function Kb(n,e,t){let r=`${iD}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const oD="firestore_targets";function $y(n,e){return`${oD}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bs="SharedClientState";class rp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new B(s.error.code,s.error.message))),o?new rp(e,t,s.state,i):(hn(bs,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Yu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new B(r.error.code,r.error.message))),i?new Yu(e,r.state,s):(hn(bs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class sp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Kw();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Tk(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new sp(e,i):(hn(bs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class dx{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new dx(t.clientId,t.onlineState):(hn(bs,`Failed to parse online state: ${e}`),null)}}class Uv{constructor(){this.activeTargetIds=Kw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Uy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Rt(ke),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=Qb(this.persistenceKey,this.Js),this.no=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Uv),this.ro=new RegExp(`^${sD}_${o}_([^_]*)$`),this.io=new RegExp(`^${iD}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${oD}_${o}_(\\d+)$`),this.oo=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this._o=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(Qb(this.persistenceKey,r));if(s){const i=sp.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem($y(this.persistenceKey,e));if(s){const i=Yu.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem($y(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return G(bs,"READ",e,t),t}setItem(e,t){G(bs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){G(bs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(G(bs,"EVENT",t.key,t.newValue),t.key===this.eo)return void hn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=fr.ce;if(i!=null)try{const a=JSON.parse(i);fe(typeof a=="number",30636,{So:i}),o=a}catch(a){hn(bs,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==fr.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new rp(this.currentUser,e,t,r),i=Kb(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=Kb(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=$y(this.persistenceKey,e),i=new Yu(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return sp.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return rp.Ws(new Dn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return Yu.Ws(s,t)}uo(e){return dx.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);G(bs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{i.has(c)||a.push(c)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=Kw();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class aD{constructor(){this.Mo=new Uv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Uv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb="ConnectivityMonitor";class Jb{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){G(Yb,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){G(Yb,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vf=null;function Bv(){return vf===null?vf=function(){return 268435456+Math.round(2147483648*Math.random())}():vf++,"0x"+vf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const By="RestConnection",A5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class N5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===jd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=Bv(),a=this.zo(e,t.toUriEncodedString());G(By,`Sending RPC '${e}' ${o}:`,a,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:u}=new URL(a),h=vi(u);return this.Jo(e,a,c,r,h).then(f=>(G(By,`Received RPC '${e}' ${o}: `,f),f),f=>{throw Xr(By,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Rc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=A5[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xn="WebChannelConnection";class k5 extends N5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=Bv();return new Promise((a,c)=>{const u=new dk;u.setWithCredentials(!0),u.listenOnce(hk.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Bf.NO_ERROR:const f=u.getResponseJson();G(Xn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case Bf.TIMEOUT:G(Xn,`RPC '${e}' ${o} timed out`),c(new B(L.DEADLINE_EXCEEDED,"Request time out"));break;case Bf.HTTP_ERROR:const m=u.getStatus();if(G(Xn,`RPC '${e}' ${o} failed with status:`,m,"response text:",u.getResponseText()),m>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const v=g==null?void 0:g.error;if(v&&v.status&&v.message){const _=function(x){const I=x.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(I)>=0?I:L.UNKNOWN}(v.status);c(new B(_,v.message))}else c(new B(L.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new B(L.UNAVAILABLE,"Connection failed."));break;default:ce(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{G(Xn,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);G(Xn,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=Bv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=pk(),a=mk(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const h=i.join("");G(Xn,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=o.createWebChannel(h,c);this.I_(f);let m=!1,g=!1;const v=new C5({Yo:R=>{g?G(Xn,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(m||(G(Xn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),G(Xn,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},Zo:()=>f.close()}),_=(R,x,I)=>{R.listen(x,C=>{try{I(C)}catch(P){setTimeout(()=>{throw P},0)}})};return _(f,Iu.EventType.OPEN,()=>{g||(G(Xn,`RPC '${e}' stream ${s} transport opened.`),v.o_())}),_(f,Iu.EventType.CLOSE,()=>{g||(g=!0,G(Xn,`RPC '${e}' stream ${s} transport closed`),v.a_(),this.E_(f))}),_(f,Iu.EventType.ERROR,R=>{g||(g=!0,Xr(Xn,`RPC '${e}' stream ${s} transport errored. Name:`,R.name,"Message:",R.message),v.a_(new B(L.UNAVAILABLE,"The operation could not be completed")))}),_(f,Iu.EventType.MESSAGE,R=>{var x;if(!g){const I=R.data[0];fe(!!I,16349);const C=I,P=(C==null?void 0:C.error)||((x=C[0])==null?void 0:x.error);if(P){G(Xn,`RPC '${e}' stream ${s} received error:`,P);const $=P.status;let V=function(E){const N=yn[E];if(N!==void 0)return wR(N)}($),A=P.message;V===void 0&&(V=L.INTERNAL,A="Unknown error status: "+$+" with message "+P.message),g=!0,v.a_(new B(V,A)),f.close()}else G(Xn,`RPC '${e}' stream ${s} received:`,I),v.u_(I)}}),_(a,fk.STAT_EVENT,R=>{R.stat===_v.PROXY?G(Xn,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===_v.NOPROXY&&G(Xn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{v.__()},0),v}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lD(){return typeof window<"u"?window:null}function Jf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ba(n){return new O6(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hx{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&G("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb="PersistentStream";class cD{constructor(e,t,r,s,i,o,a,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new hx(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(hn(t.toString()),hn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===L.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new B(L.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return G(Xb,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(G(Xb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class R5 extends cD{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=F6(this.serializer,e),r=function(i){if(!("targetChange"in i))return ye.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ye.min():o.readTime?fn(o.readTime):ye.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Ov(this.serializer),t.addTarget=function(i,o){let a;const c=o.target;if(a=Km(c)?{documents:CR(i,c)}:{query:mg(i,c).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ER(i,o.resumeToken);const u=jv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ye.min())>0){a.readTime=mc(i,o.snapshotVersion.toTimestamp());const u=jv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=U6(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Ov(this.serializer),t.removeTarget=e,this.q_(t)}}class D5 extends cD{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return fe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,fe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){fe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=$6(e.writeResults,e.commitTime),r=fn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Ov(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Fd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{}class j5 extends P5{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new B(L.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Mv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new B(L.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Mv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new B(L.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class M5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(hn(t),this.aa=!1):G("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ca="RemoteStore";class O5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Po(this)&&(G(Ca,"Restarting streams for network reachability change."),await async function(c){const u=se(c);u.Ea.add(4),await Mc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await _h(u)}(this))})}),this.Ra=new M5(r,s)}}async function _h(n){if(Po(n))for(const e of n.da)await e(!0)}async function Mc(n){for(const e of n.da)await e(!1)}function _g(n,e){const t=se(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),px(t)?mx(t):Lc(t).O_()&&fx(t,e))}function yc(n,e){const t=se(n),r=Lc(t);t.Ia.delete(e),r.O_()&&uD(t,e),t.Ia.size===0&&(r.O_()?r.L_():Po(t)&&t.Ra.set("Unknown"))}function fx(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ye.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Lc(n).Y_(e)}function uD(n,e){n.Va.Ue(e),Lc(n).Z_(e)}function mx(n){n.Va=new D6({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Lc(n).start(),n.Ra.ua()}function px(n){return Po(n)&&!Lc(n).x_()&&n.Ia.size>0}function Po(n){return se(n).Ea.size===0}function dD(n){n.Va=void 0}async function L5(n){n.Ra.set("Online")}async function V5(n){n.Ia.forEach((e,t)=>{fx(n,e)})}async function F5(n,e){dD(n),px(n)?(n.Ra.ha(e),mx(n)):n.Ra.set("Unknown")}async function $5(n,e,t){if(n.Ra.set("Online"),e instanceof IR&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){G(Ca,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await ip(n,r)}else if(e instanceof Kf?n.Va.Ze(e):e instanceof SR?n.Va.st(e):n.Va.tt(e),!t.isEqual(ye.min()))try{const r=await ZR(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{const h=i.Ia.get(c);if(!h)return;i.Ia.set(c,h.withResumeToken(ln.EMPTY_BYTE_STRING,h.snapshotVersion)),uD(i,c);const f=new ei(h.target,c,u,h.sequenceNumber);fx(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){G(Ca,"Failed to raise snapshot:",r),await ip(n,r)}}async function ip(n,e,t){if(!Ro(e))throw e;n.Ea.add(1),await Mc(n),n.Ra.set("Offline"),t||(t=()=>ZR(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{G(Ca,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await _h(n)})}function hD(n,e){return e().catch(t=>ip(n,t,e))}async function Oc(n){const e=se(n),t=Io(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:lo;for(;U5(e);)try{const s=await I5(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,B5(e,s)}catch(s){await ip(e,s)}fD(e)&&mD(e)}function U5(n){return Po(n)&&n.Ta.length<10}function B5(n,e){n.Ta.push(e);const t=Io(n);t.O_()&&t.X_&&t.ea(e.mutations)}function fD(n){return Po(n)&&!Io(n).x_()&&n.Ta.length>0}function mD(n){Io(n).start()}async function z5(n){Io(n).ra()}async function q5(n){const e=Io(n);for(const t of n.Ta)e.ea(t.mutations)}async function W5(n,e,t){const r=n.Ta.shift(),s=Zw.from(r,e,t);await hD(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Oc(n)}async function G5(n,e){e&&Io(n).X_&&await async function(r,s){if(function(o){return _R(o)&&o!==L.ABORTED}(s.code)){const i=r.Ta.shift();Io(r).B_(),await hD(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Oc(r)}}(n,e),fD(n)&&mD(n)}async function Zb(n,e){const t=se(n);t.asyncQueue.verifyOperationInProgress(),G(Ca,"RemoteStore received new credentials");const r=Po(t);t.Ea.add(3),await Mc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await _h(t)}async function zv(n,e){const t=se(n);e?(t.Ea.delete(2),await _h(t)):e||(t.Ea.add(2),await Mc(t),t.Ra.set("Unknown"))}function Lc(n){return n.ma||(n.ma=function(t,r,s){const i=se(t);return i.sa(),new R5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:L5.bind(null,n),t_:V5.bind(null,n),r_:F5.bind(null,n),H_:$5.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),px(n)?mx(n):n.Ra.set("Unknown")):(await n.ma.stop(),dD(n))})),n.ma}function Io(n){return n.fa||(n.fa=function(t,r,s){const i=se(t);return i.sa(),new D5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:z5.bind(null,n),r_:G5.bind(null,n),ta:q5.bind(null,n),na:W5.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Oc(n)):(await n.fa.stop(),n.Ta.length>0&&(G(Ca,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Mn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new gx(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Vc(n,e){if(hn("AsyncQueue",`${e}: ${n}`),Ro(n))return new B(L.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{static emptySet(e){return new ca(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||re.comparator(t.key,r.key):(t,r)=>re.comparator(t.key,r.key),this.keyedMap=Eu(),this.sortedSet=new Rt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ca)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ca;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eT{constructor(){this.ga=new Rt(re.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ce(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class ka{constructor(e,t,r,s,i,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ka(e,t,ca.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Q5{constructor(){this.queries=tT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=se(t),i=s.queries;s.queries=tT(),i.forEach((o,a)=>{for(const c of a.Sa)c.onError(r)})})(this,new B(L.ABORTED,"Firestore shutting down"))}}function tT(){return new wi(n=>sR(n),mh)}async function yx(n,e){const t=se(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new H5,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Vc(o,`Initialization of query '${dl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&_x(t)}async function vx(n,e){const t=se(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function K5(n,e){const t=se(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&_x(t)}function Y5(n,e,t){const r=se(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function _x(n){n.Ca.forEach(e=>{e.next()})}var qv,nT;(nT=qv||(qv={})).Ma="default",nT.Cache="cache";class wx{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ka(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ka.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==qv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rT{constructor(e){this.serializer=e}$s(e){return Ls(this.serializer,e)}Us(e){return e.metadata.exists?fg(this.serializer,e.document,!1):Ot.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return fn(e)}}class xx{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=gD(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=ze.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new rT(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Oe()).add(i);t.set(o,a)}}return t}async ja(e){const t=await E5(e,new rT(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await b5(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function gD(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e){this.key=e}}class vD{constructor(e){this.key=e}}class _D{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Oe(),this.mutatedKeys=Oe(),this.eu=oR(e),this.tu=new ca(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new eT,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),g=ph(this.query,f)?f:null,v=!!m&&this.mutatedKeys.has(m.key),_=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let R=!1;m&&g?m.data.isEqual(g.data)?v!==_&&(r.track({type:3,doc:g}),R=!0):this.su(m,g)||(r.track({type:2,doc:g}),R=!0,(c&&this.eu(g,c)>0||u&&this.eu(g,u)<0)&&(a=!0)):!m&&g?(r.track({type:0,doc:g}),R=!0):m&&!g&&(r.track({type:1,doc:m}),R=!0,(c||u)&&(a=!0)),R&&(g?(o=o.add(g),i=_?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(g,v){const _=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ce(20277,{Rt:R})}};return _(g)-_(v)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,u=c!==this.Za;return this.Za=c,o.length!==0||u?{snapshot:new ka(this.query,e.tu,i,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new eT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Oe(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new vD(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new yD(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=Oe();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ka.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const jo="SyncEngine";class J5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class X5{constructor(e){this.key=e,this.hu=!1}}class Z5{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new wi(a=>sR(a),mh),this.Iu=new Map,this.Eu=new Set,this.du=new Rt(re.comparator),this.Au=new Map,this.Ru=new ix,this.Vu={},this.mu=new Map,this.fu=Na.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function e$(n,e,t=!0){const r=wg(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await wD(r,e,t,!0),s}async function t$(n,e){const t=wg(n);await wD(t,e,!0,!1)}async function wD(n,e,t,r){const s=await pc(n.localStore,rr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Sx(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&_g(n.remoteStore,s),a}async function Sx(n,e,t,r,s){n.pu=(f,m,g)=>async function(_,R,x,I){let C=R.view.ru(x);C.Cs&&(C=await np(_.localStore,R.query,!1).then(({documents:A})=>R.view.ru(A,C)));const P=I&&I.targetChanges.get(R.targetId),$=I&&I.targetMismatches.get(R.targetId)!=null,V=R.view.applyChanges(C,_.isPrimaryClient,P,$);return Wv(_,R.targetId,V.au),V.snapshot}(n,f,m,g);const i=await np(n.localStore,e,!0),o=new _D(e,i.Qs),a=o.ru(i.documents),c=vh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,c);Wv(n,t,u.au);const h=new J5(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function n$(n,e,t){const r=se(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!mh(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await gc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&yc(r.remoteStore,s.targetId),vc(r,s.targetId)}).catch(ko)):(vc(r,s.targetId),await gc(r.localStore,s.targetId,!0))}async function r$(n,e){const t=se(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),yc(t.remoteStore,r.targetId))}async function s$(n,e,t){const r=Tx(n);try{const s=await function(o,a){const c=se(o),u=Fe.now(),h=a.reduce((g,v)=>g.add(v.key),Oe());let f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",g=>{let v=pr(),_=Oe();return c.Ns.getEntries(g,h).next(R=>{v=R,v.forEach((x,I)=>{I.isValidDocument()||(_=_.add(x))})}).next(()=>c.localDocuments.getOverlayedDocuments(g,v)).next(R=>{f=R;const x=[];for(const I of a){const C=C6(I,f.get(I.key).overlayedDocument);C!=null&&x.push(new xi(I.key,C,Hk(C.value.mapValue),Gt.exists(!0)))}return c.mutationQueue.addMutationBatch(g,u,x,a)}).next(R=>{m=R;const x=R.applyToLocalDocumentSet(f,_);return c.documentOverlayCache.saveOverlays(g,R.batchId,x)})}).then(()=>({batchId:m.batchId,changes:lR(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let u=o.Vu[o.currentUser.toKey()];u||(u=new Rt(ke)),u=u.insert(a,c),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Si(r,s.changes),await Oc(r.remoteStore)}catch(s){const i=Vc(s,"Failed to persist write");t.reject(i)}}async function xD(n,e){const t=se(n);try{const r=await S5(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(fe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?fe(o.hu,14607):s.removedDocuments.size>0&&(fe(o.hu,42227),o.hu=!1))}),await Si(t,r,e)}catch(r){await ko(r)}}function sT(n,e,t){const r=se(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const c=se(o);c.onlineState=a;let u=!1;c.queries.forEach((h,f)=>{for(const m of f.Sa)m.va(a)&&(u=!0)}),u&&_x(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function i$(n,e,t){const r=se(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new Rt(re.comparator);o=o.insert(i,Ot.newNoDocument(i,ye.min()));const a=Oe().add(i),c=new yh(ye.min(),new Map,new Rt(ke),o,a);await xD(r,c),r.du=r.du.remove(i),r.Au.delete(e),bx(r)}else await gc(r.localStore,e,!1).then(()=>vc(r,e,t)).catch(ko)}async function o$(n,e){const t=se(n),r=e.batch.batchId;try{const s=await x5(t.localStore,e);Ex(t,r,null),Ix(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Si(t,s)}catch(s){await ko(s)}}async function a$(n,e,t){const r=se(n);try{const s=await function(o,a){const c=se(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return c.mutationQueue.lookupMutationBatch(u,a).next(f=>(fe(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(u,f))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>c.localDocuments.getDocuments(u,h))})}(r.localStore,e);Ex(r,e,t),Ix(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Si(r,s)}catch(s){await ko(s)}}async function l$(n,e){const t=se(n);Po(t.remoteStore)||G(jo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=se(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===lo)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Vc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Ix(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Ex(n,e,t){const r=se(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function vc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||SD(n,r)})}function SD(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(yc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),bx(n))}function Wv(n,e,t){for(const r of t)r instanceof yD?(n.Ru.addReference(r.key,e),c$(n,r)):r instanceof vD?(G(jo,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||SD(n,r.key)):ce(19791,{wu:r})}function c$(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(G(jo,"New document in limbo: "+t),n.Eu.add(r),bx(n))}function bx(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new re(ze.fromString(e)),r=n.fu.next();n.Au.set(r,new X5(t)),n.du=n.du.insert(t,r),_g(n.remoteStore,new ei(rr(Dc(t.path)),r,"TargetPurposeLimboResolution",fr.ce))}}async function Si(n,e,t){const r=se(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,c)=>{o.push(r.pu(c,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(u){s.push(u);const f=cx.As(c.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(c,u){const h=se(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>M.forEach(u,m=>M.forEach(m.Es,g=>h.persistence.referenceDelegate.addReference(f,m.targetId,g)).next(()=>M.forEach(m.ds,g=>h.persistence.referenceDelegate.removeReference(f,m.targetId,g)))))}catch(f){if(!Ro(f))throw f;G(ux,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const g=h.Ms.get(m),v=g.snapshotVersion,_=g.withLastLimboFreeSnapshotVersion(v);h.Ms=h.Ms.insert(m,_)}}}(r.localStore,i))}async function u$(n,e){const t=se(n);if(!t.currentUser.isEqual(e)){G(jo,"User change. New user:",e.toKey());const r=await XR(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(c=>{c.reject(new B(L.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Si(t,r.Ls)}}function d$(n,e){const t=se(n),r=t.Au.get(e);if(r&&r.hu)return Oe().add(r.key);{let s=Oe();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function h$(n,e){const t=se(n),r=await np(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&Wv(t,e.targetId,s.au),s}async function f$(n,e){const t=se(n);return nD(t.localStore,e).then(r=>Si(t,r))}async function m$(n,e,t,r){const s=se(n),i=await function(a,c){const u=se(a),h=se(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,c).next(m=>m?u.localDocuments.getDocuments(f,m):M.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Oc(s.remoteStore):t==="acknowledged"||t==="rejected"?(Ex(s,e,r||null),Ix(s,e),function(a,c){se(se(a).mutationQueue).ir(c)}(s.localStore,e)):ce(6720,"Unknown batchState",{Su:t}),await Si(s,i)):G(jo,"Cannot apply mutation batch with id: "+e)}async function p$(n,e){const t=se(n);if(wg(t),Tx(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await iT(t,r.toArray());t.gu=!0,await zv(t.remoteStore,!0);for(const i of s)_g(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(vc(t,o),gc(t.localStore,o,!0))),yc(t.remoteStore,o)}),await s,await iT(t,r),function(o){const a=se(o);a.Au.forEach((c,u)=>{yc(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new Rt(re.comparator)}(t),t.gu=!1,await zv(t.remoteStore,!1)}}async function iT(n,e,t){const r=se(n),s=[],i=[];for(const o of e){let a;const c=r.Iu.get(o);if(c&&c.length!==0){a=await pc(r.localStore,rr(c[0]));for(const u of c){const h=r.Tu.get(u),f=await h$(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await tD(r.localStore,o);a=await pc(r.localStore,u),await Sx(r,ID(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function ID(n){return tR(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function g$(n){return function(t){return se(se(t).persistence).Ts()}(se(n).localStore)}async function y$(n,e,t,r){const s=se(n);if(s.gu)return void G(jo,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await nD(s.localStore,iR(i[0])),a=yh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ln.EMPTY_BYTE_STRING);await Si(s,o,a);break}case"rejected":await gc(s.localStore,e,!0),vc(s,e,r);break;default:ce(64155,t)}}async function v$(n,e,t){const r=wg(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){G(jo,"Adding an already active target "+s);continue}const i=await tD(r.localStore,s),o=await pc(r.localStore,i);await Sx(r,ID(i),o.targetId,!1,o.resumeToken),_g(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await gc(r.localStore,s,!1).then(()=>{yc(r.remoteStore,s),vc(r,s)}).catch(ko)}}function wg(n){const e=se(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=xD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=d$.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=i$.bind(null,e),e.Pu.H_=K5.bind(null,e.eventManager),e.Pu.yu=Y5.bind(null,e.eventManager),e}function Tx(n){const e=se(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=o$.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=a$.bind(null,e),e}function _$(n,e,t){const r=se(n);(async function(i,o,a){try{const c=await o.getMetadata();if(await function(g,v){const _=se(g),R=fn(v.createTime);return _.persistence.runTransaction("hasNewerBundle","readonly",x=>_.Ii.getBundleMetadata(x,v.id)).then(x=>!!x&&x.createTime.compareTo(R)>=0)}(i.localStore,c))return await o.close(),a._completeWith(function(g){return{taskState:"Success",documentsLoaded:g.totalDocuments,bytesLoaded:g.totalBytes,totalDocuments:g.totalDocuments,totalBytes:g.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(gD(c));const u=new xx(c,o.serializer);let h=await o.bu();for(;h;){const m=await u.Ga(h);m&&a._updateProgress(m),h=await o.bu()}const f=await u.ja(i.localStore);return await Si(i,f.Ha,void 0),await function(g,v){const _=se(g);return _.persistence.runTransaction("Save bundle","readwrite",R=>_.Ii.saveBundleMetadata(R,v))}(i.localStore,c),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(c){return Xr(jo,`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class _c{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ba(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return JR(this.persistence,new YR,e.initialUser,this.serializer)}Cu(e){return new ox(vg.mi,this.serializer)}Du(e){return new aD}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_c.provider={build:()=>new _c};class Ax extends _c{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){fe(this.persistence.referenceDelegate instanceof tp,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new qR(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Zn.withCacheSize(this.cacheSizeBytes):Zn.DEFAULT;return new ox(r=>tp.mi(r,t),this.serializer)}}class Nx extends _c{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Tx(this.xu.syncEngine),await Oc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return JR(this.persistence,new YR,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new qR(r,e.asyncQueue,t)}Mu(e,t){const r=new j3(t,this.persistence);return new P3(e.asyncQueue,r)}Cu(e){const t=lx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Zn.withCacheSize(this.cacheSizeBytes):Zn.DEFAULT;return new ax(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,lD(),Jf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new aD}}class ED extends Nx{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Uy&&(this.sharedClientState.syncEngine={Co:m$.bind(null,t),vo:y$.bind(null,t),Fo:v$.bind(null,t),Ts:g$.bind(null,t),Do:f$.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await p$(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=lD();if(!Uy.v(t))throw new B(L.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=lx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Uy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Eo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>sT(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=u$.bind(null,this.syncEngine),await zv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Q5}()}createDatastore(e){const t=Ba(e.databaseInfo.databaseId),r=function(i){return new k5(i)}(e.databaseInfo);return function(i,o,a,c){return new j5(i,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new O5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>sT(this.syncEngine,t,0),function(){return Jb.v()?new Jb:new T5}())}createSyncEngine(e,t){return function(s,i,o,a,c,u,h){const f=new Z5(s,i,o,a,c,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=se(s);G(Ca,"RemoteStore shutting down."),i.Ea.add(5),await Mc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Eo.provider={build:()=>new Eo};function oT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):hn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w${constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Mn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new pD(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x${constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new pD(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new B(L.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S${constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new B(L.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=se(s),a={documents:i.map(f=>Vd(o.serializer,f))},c=await o.Ho("BatchGetDocuments",o.serializer.databaseId,ze.emptyPath(),a,i.length),u=new Map;c.forEach(f=>{const m=V6(o.serializer,f);u.set(m.key.toString(),m)});const h=[];return i.forEach(f=>{const m=u.get(f.toString());fe(!!m,55234,{key:f}),h.push(m)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new jc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=re.fromPath(r);this.mutations.push(new Jw(s,this.precondition(s)))}),await async function(r,s){const i=se(r),o={writes:s.map(a=>Fd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,ze.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ce(50498,{Gu:e.constructor.name});t=ye.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new B(L.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ye.min())?Gt.exists(!1):Gt.updateTime(t):Gt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ye.min()))throw new B(L.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Gt.updateTime(t)}return Gt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I${constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new hx(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new S$(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!dh(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!_R(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bo="FirestoreClient";class E${constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Dn.UNAUTHENTICATED,this.clientId=Lw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{G(bo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(G(bo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Mn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Vc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function zy(n,e){n.asyncQueue.verifyOperationInProgress(),G(bo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await XR(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function aT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Cx(n);G(bo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Zb(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Zb(e.remoteStore,s)),n._onlineComponents=e}async function Cx(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){G(bo,"Using user provided OfflineComponentProvider");try{await zy(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===L.FAILED_PRECONDITION||s.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Xr("Error using user provided cache. Falling back to memory cache: "+t),await zy(n,new _c)}}else G(bo,"Using default OfflineComponentProvider"),await zy(n,new Ax(void 0));return n._offlineComponents}async function Sg(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(G(bo,"Using user provided OnlineComponentProvider"),await aT(n,n._uninitializedComponentsProvider._online)):(G(bo,"Using default OnlineComponentProvider"),await aT(n,new Eo))),n._onlineComponents}function bD(n){return Cx(n).then(e=>e.persistence)}function Fc(n){return Cx(n).then(e=>e.localStore)}function TD(n){return Sg(n).then(e=>e.remoteStore)}function kx(n){return Sg(n).then(e=>e.syncEngine)}function AD(n){return Sg(n).then(e=>e.datastore)}async function wc(n){const e=await Sg(n),t=e.eventManager;return t.onListen=e$.bind(null,e.syncEngine),t.onUnlisten=n$.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=t$.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=r$.bind(null,e.syncEngine),t}function b$(n){return n.asyncQueue.enqueue(async()=>{const e=await bD(n),t=await TD(n);return e.setNetworkEnabled(!0),function(s){const i=se(s);return i.Ea.delete(0),_h(i)}(t)})}function T$(n){return n.asyncQueue.enqueue(async()=>{const e=await bD(n),t=await TD(n);return e.setNetworkEnabled(!1),async function(s){const i=se(s);i.Ea.add(0),await Mc(i),i.Ra.set("Offline")}(t)})}function A$(n,e){const t=new Mn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=se(u);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new B(L.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const c=Vc(a,`Failed to get document '${i} from cache`);o.reject(c)}}(await Fc(n),e,t)),t.promise}function ND(n,e,t={}){const r=new Mn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const h=new xg({next:m=>{h.Nu(),o.enqueueAndForget(()=>vx(i,f));const g=m.docs.has(a);!g&&m.fromCache?u.reject(new B(L.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&m.fromCache&&c&&c.source==="server"?u.reject(new B(L.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new wx(Dc(a.path),h,{includeMetadataChanges:!0,qa:!0});return yx(i,f)}(await wc(n),n.asyncQueue,e,t,r)),r.promise}function N$(n,e){const t=new Mn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await np(s,i,!0),c=new _D(i,a.Qs),u=c.ru(a.documents),h=c.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const c=Vc(a,`Failed to execute query '${i} against cache`);o.reject(c)}}(await Fc(n),e,t)),t.promise}function CD(n,e,t={}){const r=new Mn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const h=new xg({next:m=>{h.Nu(),o.enqueueAndForget(()=>vx(i,f)),m.fromCache&&c.source==="server"?u.reject(new B(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new wx(a,h,{includeMetadataChanges:!0,qa:!0});return yx(i,f)}(await wc(n),n.asyncQueue,e,t,r)),r.promise}function C$(n,e,t){const r=new Mn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await AD(n);r.resolve(async function(o,a,c){var _;const u=se(o),{request:h,gt:f,parent:m}=kR(u.serializer,nR(a),c);u.connection.$o||delete h.parent;const g=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,m,h,1)).filter(R=>!!R.result);fe(g.length===1,64727);const v=(_=g[0].result)==null?void 0:_.aggregateFields;return Object.keys(v).reduce((R,x)=>(R[f[x]]=v[x],R),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function k$(n,e){const t=new xg(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){se(s).Ca.add(i),i.next()}(await wc(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){se(s).Ca.delete(i)}(await wc(n),t))}}function R$(n,e,t,r){const s=function(o,a){let c;return c=typeof o=="string"?xR().encode(o):o,function(h,f){return new w$(h,f)}(function(h,f){if(h instanceof Uint8Array)return oT(h,f);if(h instanceof ArrayBuffer)return oT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,Ba(e));n.asyncQueue.enqueueAndForget(async()=>{_$(await kx(n),s,r)})}function D$(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=se(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await Fc(n),e))}function kD(n,e){return function(r,s){return new x$(r,s)}(n,e)}function P$(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=se(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>o.getFieldIndexes(c).next(u=>function(f,m,g,v,_){f=[...f],m=[...m],f.sort(g),m.sort(g);const R=f.length,x=m.length;let I=0,C=0;for(;I<x&&C<R;){const P=g(f[C],m[I]);P<0?_(f[C++]):P>0?v(m[I++]):(I++,C++)}for(;I<x;)v(m[I++]);for(;C<R;)_(f[C++])}(u,s,C3,h=>{a.push(o.addFieldIndex(c,h))},h=>{a.push(o.deleteFieldIndex(c,h))})).next(()=>M.waitFor(a)))}(await Fc(n),e))}function j$(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){se(r).Fs.Vs=s}(await Fc(n),e))}function M$(n){return n.asyncQueue.enqueue(async()=>function(t){const r=se(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Fc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD="firestore.googleapis.com",cT=!0;class uT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=DD,this.ssl=cT}else this.host=e.host,this.ssl=e.ssl??cT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=FR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<zR)throw new B(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}N3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=RD(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new B(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new B(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new B(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wh{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new v3;switch(r.type){case"firstParty":return new S3(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new B(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=lT.get(t);r&&(G("ComponentProvider","Removing Datastore"),lT.delete(t),r.terminate())}(this),Promise.resolve()}}function O$(n,e,t,r={}){var u;n=Ge(n,wh);const s=vi(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Op(`https://${a}`),G_("Firestore",!0)),i.host!==DD&&i.host!==a&&Xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:a,ssl:s,emulatorOptions:r};if(!Or(c,o)&&(n._setSettings(c),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Dn.MOCK_USER;else{h=CN(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new B(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Dn(m)}n._authCredentials=new _3(new yk(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Vn(this.firestore,e,this._query)}}class yt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yt(this.firestore,e,this._key)}toJSON(){return{type:yt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ua(t,yt._jsonSchema))return new yt(e,r||null,new re(ze.fromString(t.referencePath)))}}yt._jsonSchemaVersion="firestore/documentReference/1.0",yt._jsonSchema={type:wn("string",yt._jsonSchemaVersion),referencePath:wn("string")};class Vs extends Vn{constructor(e,t,r){super(e,t,Dc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yt(this.firestore,null,new re(e))}withConverter(e){return new Vs(this.firestore,e,this._path)}}function Cn(n,e,...t){if(n=le(n),Vw("collection","path",e),n instanceof wh){const r=ze.fromString(e,...t);return XE(r),new Vs(n,null,r)}{if(!(n instanceof yt||n instanceof Vs))throw new B(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ze.fromString(e,...t));return XE(r),new Vs(n.firestore,null,r)}}function U7(n,e){if(n=Ge(n,wh),Vw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new B(L.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Vn(n,null,function(r){return new _i(ze.emptyPath(),r)}(e))}function L$(n,e,...t){if(n=le(n),arguments.length===1&&(e=Lw.newId()),Vw("doc","path",e),n instanceof wh){const r=ze.fromString(e,...t);return JE(r),new yt(n,null,new re(r))}{if(!(n instanceof yt||n instanceof Vs))throw new B(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ze.fromString(e,...t));return JE(r),new yt(n.firestore,n instanceof Vs?n.converter:null,new re(r))}}function B7(n,e){return n=le(n),e=le(e),(n instanceof yt||n instanceof Vs)&&(e instanceof yt||e instanceof Vs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function PD(n,e){return n=le(n),e=le(e),n instanceof Vn&&e instanceof Vn&&n.firestore===e.firestore&&mh(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dT="AsyncQueue";class hT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new hx(this,"async_queue_retry"),this._c=()=>{const r=Jf();r&&G(dT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Jf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Jf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Mn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ro(e))throw e;G(dT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,hn("INTERNAL UNHANDLED ERROR: ",fT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=gx.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ce(47125,{Pc:fT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function fT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ml(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class V${constructor(){this._progressObserver={},this._taskCompletionResolver=new Mn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z7=-1;class It extends wh{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new hT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new hT(e),this._firestoreClient=void 0,await e}}}function q7(n,e,t){t||(t=jd);const r=qs(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Or(i,e))return s;throw new B(L.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new B(L.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<zR)throw new B(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&vi(e.host)&&Op(e.host),r.initialize({options:e,instanceIdentifier:t})}function jD(n,e){const t=typeof n=="object"?n:Tc(),r=typeof n=="string"?n:e||jd,s=qs(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=TN("firestore");i&&O$(s,...i)}return s}function en(n){if(n._terminated)throw new B(L.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||MD(n),n._firestoreClient}function MD(n){var r,s,i;const e=n._freezeSettings(),t=function(a,c,u,h){return new l6(a,c,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,RD(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new E$(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const c=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(c),_online:c}}(n._componentsProvider))}function W7(n,e){Xr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return OD(n,Eo.provider,{build:r=>new Nx(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function G7(n){Xr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();OD(n,Eo.provider,{build:t=>new ED(t,e.cacheSizeBytes)})}function OD(n,e,t){if((n=Ge(n,It))._firestoreClient||n._terminated)throw new B(L.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new B(L.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},MD(n)}function H7(n){if(n._initialized&&!n._terminated)throw new B(L.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Mn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Os.v())return Promise.resolve();const s=r+KR;await Os.delete(s)}(lx(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function Q7(n){return function(t){const r=new Mn;return t.asyncQueue.enqueueAndForget(async()=>l$(await kx(t),r)),r.promise}(en(n=Ge(n,It)))}function K7(n){return b$(en(n=Ge(n,It)))}function Y7(n){return T$(en(n=Ge(n,It)))}function J7(n){return VL(n.app,"firestore",n._databaseId.database),n._delete()}function mT(n,e){const t=en(n=Ge(n,It)),r=new V$;return R$(t,n._databaseId,e,r),r}function F$(n,e){return D$(en(n=Ge(n,It)),e).then(t=>t?new Vn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class $${constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Cr(ln.fromBase64String(e))}catch(t){throw new B(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Cr(ln.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Cr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ua(e,Cr._jsonSchema))return Cr.fromBase64String(e.bytes)}}Cr._jsonSchemaVersion="firestore/bytes/1.0",Cr._jsonSchema={type:wn("string",Cr._jsonSchemaVersion),bytes:wn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class za{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Wt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function X7(){return new za(Sv)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ke(this._lat,e._lat)||ke(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Fs._jsonSchemaVersion}}static fromJSON(e){if(Ua(e,Fs._jsonSchema))return new Fs(e.latitude,e.longitude)}}Fs._jsonSchemaVersion="firestore/geoPoint/1.0",Fs._jsonSchema={type:wn("string",Fs._jsonSchemaVersion),latitude:wn("number"),longitude:wn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ms._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ua(e,ms._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new ms(e.vectorValues);throw new B(L.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ms._jsonSchemaVersion="firestore/vectorValue/1.0",ms._jsonSchema={type:wn("string",ms._jsonSchemaVersion),vectorValues:wn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U$=/^__.*__$/;class B${constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new xi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pc(e,this.data,t,this.fieldTransforms)}}class LD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new xi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function VD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ce(40011,{Ac:n})}}class Ig{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Ig({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return op(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(VD(this.Ac)&&U$.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class z${constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ba(e)}Cc(e,t,r,s=!1){return new Ig({Ac:e,methodName:t,Dc:r,path:Wt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wa(n){const e=n._freezeSettings(),t=Ba(n._databaseId);return new z$(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Eg(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Lx("Data must be an object, but it was:",o,r);const a=UD(r,o);let c,u;if(i.merge)c=new mr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=Ud(e,f,t);if(!o.contains(m))throw new B(L.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);zD(h,m)||h.push(m)}c=new mr(h),u=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,u=o.fieldTransforms;return new B$(new qn(a),c,u)}class xh extends qa{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof xh}}function FD(n,e,t){return new Ig({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Rx extends qa{_toFieldTransform(e){return new gh(e.path,new hc)}isEqual(e){return e instanceof Rx}}class Dx extends qa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=FD(this,e,!0),r=this.vc.map(i=>Ga(i,t)),s=new Ea(r);return new gh(e.path,s)}isEqual(e){return e instanceof Dx&&Or(this.vc,e.vc)}}class Px extends qa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=FD(this,e,!0),r=this.vc.map(i=>Ga(i,t)),s=new ba(r);return new gh(e.path,s)}isEqual(e){return e instanceof Px&&Or(this.vc,e.vc)}}class jx extends qa{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new fc(e.serializer,dR(e.serializer,this.Fc));return new gh(e.path,t)}isEqual(e){return e instanceof jx&&this.Fc===e.Fc}}function Mx(n,e,t,r){const s=n.Cc(1,e,t);Lx("Data must be an object, but it was:",s,r);const i=[],o=qn.empty();Do(r,(c,u)=>{const h=bg(e,c,t);u=le(u);const f=s.yc(h);if(u instanceof xh)i.push(h);else{const m=Ga(u,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new mr(i);return new LD(o,a,s.fieldTransforms)}function Ox(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[Ud(e,r,t)],c=[s];if(i.length%2!=0)throw new B(L.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Ud(e,i[m])),c.push(i[m+1]);const u=[],h=qn.empty();for(let m=a.length-1;m>=0;--m)if(!zD(u,a[m])){const g=a[m];let v=c[m];v=le(v);const _=o.yc(g);if(v instanceof xh)u.push(g);else{const R=Ga(v,_);R!=null&&(u.push(g),h.set(g,R))}}const f=new mr(u);return new LD(h,f,o.fieldTransforms)}function $D(n,e,t,r=!1){return Ga(t,n.Cc(r?4:3,e))}function Ga(n,e){if(BD(n=le(n)))return Lx("Unsupported field value:",e,n),UD(n,e);if(n instanceof qa)return function(r,s){if(!VD(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let c=Ga(a,s.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return dR(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Fe.fromDate(r);return{timestampValue:mc(s.serializer,i)}}if(r instanceof Fe){const i=new Fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:mc(s.serializer,i)}}if(r instanceof Fs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Cr)return{bytesValue:ER(s.serializer,r._byteString)};if(r instanceof yt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:nx(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ms)return function(o,a){return{mapValue:{fields:{[Ww]:{stringValue:Gw},[cc]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return Yw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${rg(r)}`)}(n,e)}function UD(n,e){const t={};return Vk(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Do(n,(r,s)=>{const i=Ga(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function BD(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Fe||n instanceof Fs||n instanceof Cr||n instanceof yt||n instanceof qa||n instanceof ms)}function Lx(n,e,t){if(!BD(t)||!_k(t)){const r=rg(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Ud(n,e,t){if((e=le(e))instanceof za)return e._internalPath;if(typeof e=="string")return bg(n,e);throw op("Field path arguments must be of type string or ",n,!1,void 0,t)}const q$=new RegExp("[~\\*/\\[\\]]");function bg(n,e,t){if(e.search(q$)>=0)throw op(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new za(...e.split("."))._internalPath}catch{throw op(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function op(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new B(L.INVALID_ARGUMENT,a+n+c)}function zD(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new W$(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Tg("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class W$ extends Bd{data(){return super.data()}}function Tg(n,e){return typeof e=="string"?bg(n,e):e instanceof za?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Vx{}class Sh extends Vx{}function Hi(n,e,...t){let r=[];e instanceof Vx&&r.push(e),r=r.concat(t),function(i){const o=i.filter(c=>c instanceof $c).length,a=i.filter(c=>c instanceof Ih).length;if(o>1||o>0&&a>0)throw new B(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Ih extends Sh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ih(e,t,r)}_apply(e){const t=this._parse(e);return GD(e._query,t),new Vn(e.firestore,e.converter,Pv(e._query,t))}_parse(e){const t=Wa(e.firestore);return function(i,o,a,c,u,h,f){let m;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new B(L.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){gT(f,h);const v=[];for(const _ of f)v.push(pT(c,i,_));m={arrayValue:{values:v}}}else m=pT(c,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||gT(f,h),m=$D(a,o,f,h==="in"||h==="not-in");return Ke.create(u,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function ti(n,e,t){const r=e,s=Tg("where",n);return Ih._create(s,r,t)}class $c extends Vx{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new $c(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ht.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const c of a)GD(o,c),o=Pv(o,c)}(e._query,t),new Vn(e.firestore,e.converter,Pv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Z7(...n){return n.forEach(e=>HD("or",e)),$c._create("or",n)}function eW(...n){return n.forEach(e=>HD("and",e)),$c._create("and",n)}class Fx extends Sh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Fx(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new B(L.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new B(L.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ld(i,o)}(e._query,this._field,this._direction);return new Vn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new _i(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function ap(n,e="asc"){const t=e,r=Tg("orderBy",n);return Fx._create(r,t)}class Ag extends Sh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Ag(e,t,r)}_apply(e){return new Vn(e.firestore,e.converter,Jm(e._query,this._limit,this._limitType))}}function G$(n){return wk("limit",n),Ag._create("limit",n,"F")}function tW(n){return wk("limitToLast",n),Ag._create("limitToLast",n,"L")}class Ng extends Sh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ng(e,t,r)}_apply(e){const t=WD(e,this.type,this._docOrFields,this._inclusive);return new Vn(e.firestore,e.converter,function(s,i){return new _i(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function nW(...n){return Ng._create("startAt",n,!0)}function rW(...n){return Ng._create("startAfter",n,!1)}class Cg extends Sh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Cg(e,t,r)}_apply(e){const t=WD(e,this.type,this._docOrFields,this._inclusive);return new Vn(e.firestore,e.converter,function(s,i){return new _i(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function sW(...n){return Cg._create("endBefore",n,!1)}function iW(...n){return Cg._create("endAt",n,!0)}function WD(n,e,t,r){if(t[0]=le(t[0]),t[0]instanceof Bd)return function(i,o,a,c,u){if(!c)throw new B(L.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of jl(i))if(f.field.isKeyField())h.push(Sa(o,c.key));else{const m=c.data.field(f.field);if(lg(m))throw new B(L.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const g=f.field.canonicalString();throw new B(L.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${g}' (used as the orderBy) does not exist.`)}h.push(m)}return new So(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Wa(n.firestore);return function(o,a,c,u,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new B(L.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const g=[];for(let v=0;v<h.length;v++){const _=h[v];if(m[v].field.isKeyField()){if(typeof _!="string")throw new B(L.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof _}`);if(!Qw(o)&&_.indexOf("/")!==-1)throw new B(L.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${_}' contains a slash.`);const R=o.path.child(ze.fromString(_));if(!re.isDocumentKey(R))throw new B(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const x=new re(R);g.push(Sa(a,x))}else{const R=$D(c,u,_);g.push(R)}}return new So(g,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function pT(n,e,t){if(typeof(t=le(t))=="string"){if(t==="")throw new B(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qw(e)&&t.indexOf("/")!==-1)throw new B(L.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ze.fromString(t));if(!re.isDocumentKey(r))throw new B(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Sa(n,new re(r))}if(t instanceof yt)return Sa(n,t._key);throw new B(L.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rg(t)}.`)}function gT(n,e){if(!Array.isArray(n)||n.length===0)throw new B(L.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function GD(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new B(L.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(L.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function HD(n,e){if(!(e instanceof Ih||e instanceof $c))throw new B(L.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class QD{convertValue(e,t="none"){switch(wo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ut(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(fi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ce(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Do(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[cc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>Ut(o.doubleValue));return new ms(t)}convertGeoPoint(e){return new Fs(Ut(e.latitude),Ut(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=cg(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Pd(e));default:return null}}convertTimestamp(e){const t=hi(e);return new Fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ze.fromString(e);fe(jR(r),9688,{name:e});const s=new xa(r.get(1),r.get(3)),i=new re(r.popFirst(5));return s.isEqual(t)||hn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class $x extends QD{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oW(n){return new $d("sum",Ud("sum",n))}function aW(n){return new $d("avg",Ud("average",n))}function H$(){return new $d("count")}function lW(n,e){var t,r;return n instanceof $d&&e instanceof $d&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function cW(n,e){return PD(n.query,e.query)&&Or(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KD="NOT SUPPORTED";class Qi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Dr extends Bd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Xf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Tg("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(L.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Dr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function uW(n,e,t){if(Ua(e,Dr._jsonSchema)){if(e.bundle===KD)throw new B(L.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Ba(n._databaseId),s=kD(e.bundle,r),i=s.Wu(),o=new xx(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new B(L.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const c=fg(r,a[0].document),u=new re(ze.fromString(e.bundleName));return new Dr(n,new $x(n),u,c,new Qi(!1,!1),t||null)}}Dr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Dr._jsonSchema={type:wn("string",Dr._jsonSchemaVersion),bundleSource:wn("string","DocumentSnapshot"),bundleName:wn("string"),bundle:wn("string")};class Xf extends Dr{data(e={}){return super.data(e)}}class Pr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Qi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Xf(this._firestore,this._userDataWriter,r.key,r,new Qi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const c=new Xf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Qi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const c=new Xf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Qi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:Q$(a.type),doc:c,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(L.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Pr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Lw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function dW(n,e,t){if(Ua(e,Pr._jsonSchema)){if(e.bundle===KD)throw new B(L.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Ba(n._databaseId),s=kD(e.bundle,r),i=s.Wu(),o=new xx(s.getMetadata(),r);for(const m of i)o.Ga(m);if(o.queries.length!==1)throw new B(L.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=pg(o.queries[0].bundledQuery),c=o.documents;let u=new ca;c.map(m=>{const g=fg(r,m.document);u=u.add(g)});const h=ka.fromInitialDocuments(a,u,Oe(),!1,!1),f=new Vn(n,t||null,a);return new Pr(n,new $x(n),f,h)}}function Q$(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ce(61501,{type:n})}}function hW(n,e){return n instanceof Dr&&e instanceof Dr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Pr&&e instanceof Pr&&n._firestore===e._firestore&&PD(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fW(n){n=Ge(n,yt);const e=Ge(n.firestore,It);return ND(en(e),n._key).then(t=>Ux(e,n,t))}Pr._jsonSchemaVersion="firestore/querySnapshot/1.0",Pr._jsonSchema={type:wn("string",Pr._jsonSchemaVersion),bundleSource:wn("string","QuerySnapshot"),bundleName:wn("string"),bundle:wn("string")};class Mo extends QD{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yt(this.firestore,null,t)}}function mW(n){n=Ge(n,yt);const e=Ge(n.firestore,It),t=en(e),r=new Mo(e);return A$(t,n._key).then(s=>new Dr(e,r,n._key,s,new Qi(s!==null&&s.hasLocalMutations,!0),n.converter))}function pW(n){n=Ge(n,yt);const e=Ge(n.firestore,It);return ND(en(e),n._key,{source:"server"}).then(t=>Ux(e,n,t))}function xc(n){n=Ge(n,Vn);const e=Ge(n.firestore,It),t=en(e),r=new Mo(e);return qD(n._query),CD(t,n._query).then(s=>new Pr(e,r,n,s))}function gW(n){n=Ge(n,Vn);const e=Ge(n.firestore,It),t=en(e),r=new Mo(e);return N$(t,n._query).then(s=>new Pr(e,r,n,s))}function yW(n){n=Ge(n,Vn);const e=Ge(n.firestore,It),t=en(e),r=new Mo(e);return CD(t,n._query,{source:"server"}).then(s=>new Pr(e,r,n,s))}function vW(n,e,t){n=Ge(n,yt);const r=Ge(n.firestore,It),s=kg(n.converter,e,t);return Eh(r,[Eg(Wa(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Gt.none())])}function _W(n,e,t,...r){n=Ge(n,yt);const s=Ge(n.firestore,It),i=Wa(s);let o;return o=typeof(e=le(e))=="string"||e instanceof za?Ox(i,"updateDoc",n._key,e,t,r):Mx(i,"updateDoc",n._key,e),Eh(s,[o.toMutation(n._key,Gt.exists(!0))])}function wW(n){return Eh(Ge(n.firestore,It),[new jc(n._key,Gt.none())])}function Br(n,e){const t=Ge(n.firestore,It),r=L$(n),s=kg(n.converter,e);return Eh(t,[Eg(Wa(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Gt.exists(!1))]).then(()=>r)}function yT(n,...e){var c,u,h;n=le(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Ml(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Ml(e[r])){const f=e[r];e[r]=(c=f.next)==null?void 0:c.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof yt)o=Ge(n.firestore,It),a=Dc(n._key.path),i={next:f=>{e[r]&&e[r](Ux(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=Ge(n,Vn);o=Ge(f.firestore,It),a=f._query;const m=new Mo(o);i={next:g=>{e[r]&&e[r](new Pr(o,m,f,g))},error:e[r+1],complete:e[r+2]},qD(n._query)}return function(m,g,v,_){const R=new xg(_),x=new wx(g,R,v);return m.asyncQueue.enqueueAndForget(async()=>yx(await wc(m),x)),()=>{R.Nu(),m.asyncQueue.enqueueAndForget(async()=>vx(await wc(m),x))}}(en(o),a,s,i)}function xW(n,e,...t){const r=le(n),s=function(c){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in c)){u.error=`snapshotJson missing required field: ${f}`;break}const m=c[f];if(typeof m!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(m.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=m:f==="bundleName"?u.bundleName=m:f==="bundleSource"&&(u.bundleSource=m)}return u}(e);if(s.error)throw new B(L.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Ml(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Ml(t[o])){const c=t[o++];a={next:c.next,error:c.error,complete:c.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,g){let v,_=!1;return mT(u,h.bundle).then(()=>F$(u,h.bundleName)).then(x=>{x&&!_&&(g&&x.withConverter(g),v=yT(x,f||{},m))}).catch(x=>(m.error&&m.error(x),()=>{})),()=>{_||(_=!0,v&&v())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Ml(t[o])){const c=t[o++];a={next:c.next,error:c.error,complete:c.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,g){let v,_=!1;return mT(u,h.bundle).then(()=>{if(!_){const x=new yt(u,g||null,re.fromPath(h.bundleName));v=yT(x,f||{},m)}}).catch(x=>(m.error&&m.error(x),()=>{})),()=>{_||(_=!0,v&&v())}}(r,s,i,a,t[o])}throw new B(L.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function SW(n,e){return k$(en(n=Ge(n,It)),Ml(e)?e:{next:e})}function Eh(n,e){return function(r,s){const i=new Mn;return r.asyncQueue.enqueueAndForget(async()=>s$(await kx(r),s,i)),i.promise}(en(n),e)}function Ux(n,e,t){const r=t.docs.get(e._key),s=new Mo(n);return new Dr(n,s,e._key,r,new Qi(t.hasPendingWrites,t.fromCache),e.converter)}function IW(n){return K$(n,{count:H$()})}function K$(n,e){const t=Ge(n.firestore,It),r=en(t),s=Lk(e,(i,o)=>new vR(o,i.aggregateType,i._internalFieldPath));return C$(r,n._query,s).then(i=>function(a,c,u){const h=new Mo(a);return new $$(c,h,u)}(t,n,i))}class Y${constructor(e){this.kind="memory",this._onlineComponentProvider=Eo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Ax(void 0)}}toJSON(){return{kind:this.kind}}}class J${constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=nU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class X${constructor(){this.kind="memoryEager",this._offlineComponentProvider=_c.provider}toJSON(){return{kind:this.kind}}}class Z${constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Ax(e)}}toJSON(){return{kind:this.kind}}}function EW(){return new X$}function bW(n){return new Z$(n==null?void 0:n.cacheSizeBytes)}function TW(n){return new Y$(n)}function AW(n){return new J$(n)}class eU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Eo.provider,this._offlineComponentProvider={build:t=>new Nx(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class tU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Eo.provider,this._offlineComponentProvider={build:t=>new ED(t,e==null?void 0:e.cacheSizeBytes)}}}function nU(n){return new eU(n==null?void 0:n.forceOwnership)}function NW(){return new tU}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rU={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Wa(e)}set(e,t,r){this._verifyNotCommitted();const s=Ki(e,this._firestore),i=kg(s.converter,t,r),o=Eg(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Gt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ki(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof za?Ox(this._dataReader,"WriteBatch.update",i._key,t,r,s):Mx(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Gt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ki(e,this._firestore);return this._mutations=this._mutations.concat(new jc(t._key,Gt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(L.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ki(n,e){if((n=le(n)).firestore!==e)throw new B(L.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Wa(e)}get(e){const t=Ki(e,this._firestore),r=new $x(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return ce(24041);const i=s[0];if(i.isFoundDocument())return new Bd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Bd(this._firestore,r,t._key,null,t.converter);throw ce(18433,{doc:i})})}set(e,t,r){const s=Ki(e,this._firestore),i=kg(s.converter,t,r),o=Eg(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=Ki(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof za?Ox(this._dataReader,"Transaction.update",i._key,t,r,s):Mx(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=Ki(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU extends iU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ki(e,this._firestore),r=new Mo(this._firestore);return super.get(e).then(s=>new Dr(this._firestore,r,t._key,s._document,new Qi(!1,!1),t.converter))}}function CW(n,e,t){n=Ge(n,It);const r={...rU,...t};return function(i){if(i.maxAttempts<1)throw new B(L.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const c=new Mn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await AD(i);new I$(i.asyncQueue,u,a,o,c).ju()}),c.promise}(en(n),s=>e(new oU(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kW(){return new xh("deleteField")}function aU(){return new Rx("serverTimestamp")}function RW(...n){return new Dx("arrayUnion",n)}function DW(...n){return new Px("arrayRemove",n)}function PW(n){return new jx("increment",n)}function jW(n){return new ms(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MW(n){return en(n=Ge(n,It)),new sU(n,e=>Eh(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OW(n,e){const t=en(n=Ge(n,It));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Xr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new B(L.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const c of o.indexes){const u=vT(c,"collectionGroup"),h=[];if(Array.isArray(c.fields))for(const f of c.fields){const m=bg("setIndexConfiguration",vT(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new aa(m,2)):f.order==="ASCENDING"?h.push(new aa(m,0)):f.order==="DESCENDING"&&h.push(new aa(m,1))}a.push(new rc(rc.UNKNOWN_ID,u,h,sc.empty()))}return a}(e);return P$(t,r)}function vT(n,e){if(typeof n[e]!="string")throw new B(L.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function LW(n){var s;n=Ge(n,It);const e=_T.get(n);if(e)return e;if(((s=en(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new lU(n);return _T.set(n,r),r}function VW(n){YD(n,!0)}function FW(n){YD(n,!1)}function $W(n){M$(en(n._firestore)).then(e=>G("deleting all persistent cache indexes succeeded")).catch(e=>Xr("deleting all persistent cache indexes failed",e))}function YD(n,e){j$(en(n._firestore),e).then(t=>G(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Xr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const _T=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UW(n){var r;const e=en(Ge(n.firestore,It)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:mg(t,rr(n._query)).ft}function BW(n,e){var i;const t=Lk(e,(o,a)=>new vR(a,o.aggregateType,o._internalFieldPath)),r=en(Ge(n.firestore,It)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:kR(s,nR(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zW{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Bx.instance.onExistenceFilterMismatch(e)}}class Bx{constructor(){this.Mc=new Map}static get instance(){return _f||(_f=new Bx,function(t){if(Ku)throw new Error("a TestingHooksSpi instance is already set");Ku=t}(_f)),_f}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let _f=null;(function(e,t=!0){(function(s){Rc=s})(La),gs(new xr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new It(new w3(r.getProvider("auth-internal")),new I3(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new B(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xa(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),_r(KE,YE,e),_r(KE,YE,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qW={PHONE:"phone",TOTP:"totp"},WW={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},GW={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},HW={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},QW={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function JD(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const KW=cU,uU=JD,XD=new Ma("auth","Firebase",JD()),YW={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lp=new eh("@firebase/auth");function dU(n,...e){lp.logLevel<=We.WARN&&lp.warn(`Auth (${La}): ${n}`,...e)}function Zf(n,...e){lp.logLevel<=We.ERROR&&lp.error(`Auth (${La}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(n,...e){throw qx(n,...e)}function lr(n,...e){return qx(n,...e)}function zx(n,e,t){const r={...uU(),[e]:t};return new Ma("auth","Firebase",r).create(e,{appName:n.name})}function On(n){return zx(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Uc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Sr(n,"argument-error"),zx(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function qx(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return XD.create(n,...e)}function J(n,e,...t){if(!n)throw qx(e,...t)}function Rs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Zf(e),new Error(e)}function mi(n,e){n||Rs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Wx(){return wT()==="http:"||wT()==="https:"}function wT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Wx()||Q_()||"connection"in navigator)?navigator.onLine:!0}function fU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(e,t){this.shortDelay=e,this.longDelay=t,mi(t>e,"Short delay should be less than long delay!"),this.isMobile=H_()||RN()}get(){return hU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gx(n,e){mi(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],gU=new bh(3e4,6e4);function Vt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Ft(n,e,t,r,s={}){return eP(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Oa({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:c,...i};return NO()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&vi(n.emulatorConfig.host)&&(u.credentials="include"),ZD.fetch()(await tP(n,n.config.apiHost,t,a),u)})}async function eP(n,e,t){n._canInitEmulator=!1;const r={...mU,...e};try{const s=new vU(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Au(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Au(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Au(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Au(n,"user-disabled",o);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw zx(n,h,u);Sr(n,h)}}catch(s){if(s instanceof ys)throw s;Sr(n,"network-request-failed",{message:String(s)})}}async function Ii(n,e,t,r,s={}){const i=await Ft(n,e,t,r,s);return"mfaPendingCredential"in i&&Sr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function tP(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?Gx(n.config,s):`${n.config.apiScheme}://${s}`;return pU.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function yU(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class vU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(lr(this.auth,"network-request-failed")),gU.get())})}}function Au(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=lr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xT(n){return n!==void 0&&n.getResponse!==void 0}function ST(n){return n!==void 0&&n.enterprise!==void 0}class nP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return yU(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _U(n){return(await Ft(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function rP(n,e){return Ft(n,"GET","/v2/recaptchaConfig",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wU(n,e){return Ft(n,"POST","/v1/accounts:delete",e)}async function xU(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function cp(n,e){return Ft(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ju(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JW(n,e=!1){return le(n).getIdToken(e)}async function SU(n,e=!1){const t=le(n),r=await t.getIdToken(e),s=Rg(r);J(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ju(qy(s.auth_time)),issuedAtTime:Ju(qy(s.iat)),expirationTime:Ju(qy(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function qy(n){return Number(n)*1e3}function Rg(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Zf("JWT malformed, contained fewer than 3 sections"),null;try{const s=Cm(t);return s?JSON.parse(s):(Zf("Failed to decode base64 JWT payload"),null)}catch(s){return Zf("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function IT(n){const e=Rg(n);return J(e,"internal-error"),J(typeof e.exp<"u","internal-error"),J(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pi(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ys&&IU(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function IU({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ju(this.lastLoginAt),this.creationTime=Ju(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qd(n){var f;const e=n.auth,t=await n.getIdToken(),r=await pi(n,cp(e,{idToken:t}));J(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?sP(s.providerUserInfo):[],o=TU(n.providerData,i),a=n.isAnonymous,c=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?c:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Gv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function bU(n){const e=le(n);await qd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function TU(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function sP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AU(n,e){const t=await eP(n,{},async()=>{const r=Oa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await tP(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:r};return n.emulatorConfig&&vi(n.emulatorConfig.host)&&(c.credentials="include"),ZD.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function NU(n,e){return Ft(n,"POST","/v2/accounts:revokeToken",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){J(e.idToken,"internal-error"),J(typeof e.idToken<"u","internal-error"),J(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):IT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){J(e.length!==0,"internal-error");const t=IT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(J(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await AU(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Ol;return r&&(J(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(J(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(J(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ol,this.toJSON())}_performRefresh(){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Di(n,e){J(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class us{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new EU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Gv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await pi(this,this.stsTokenManager.getToken(this.auth,e));return J(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return SU(this,e)}reload(){return bU(this)}_assign(e){this!==e&&(J(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new us({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){J(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await qd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(zt(this.auth.app))return Promise.reject(On(this.auth));const e=await this.getIdToken();return await pi(this,wU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,c=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:g,providerData:v,stsTokenManager:_}=t;J(f&&_,e,"internal-error");const R=Ol.fromJSON(this.name,_);J(typeof f=="string",e,"internal-error"),Di(r,e.name),Di(s,e.name),J(typeof m=="boolean",e,"internal-error"),J(typeof g=="boolean",e,"internal-error"),Di(i,e.name),Di(o,e.name),Di(a,e.name),Di(c,e.name),Di(u,e.name),Di(h,e.name);const x=new us({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:g,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:R,createdAt:u,lastLoginAt:h});return v&&Array.isArray(v)&&(x.providerData=v.map(I=>({...I}))),c&&(x._redirectEventId=c),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new Ol;s.updateFromServerResponse(t);const i=new us({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await qd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];J(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?sP(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Ol;a.updateFromIdToken(r);const c=new us({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Gv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ET=new Map;function ni(n){mi(n instanceof Function,"Expected a class definition");let e=ET.get(n);return e?(mi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ET.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}iP.type="NONE";const bT=iP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function em(n,e,t){return`firebase:${n}:${e}:${t}`}class Ll{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=em(this.userKey,s.apiKey,i),this.fullPersistenceKey=em("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await cp(this.auth,{idToken:e}).catch(()=>{});return t?us._fromGetAccountInfoResponse(this.auth,t,e):null}return us._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ll(ni(bT),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||ni(bT);const o=em(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const m=await cp(e,{idToken:h}).catch(()=>{});if(!m)break;f=await us._fromGetAccountInfoResponse(e,m,h)}else f=us._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Ll(i,e,r):(i=c[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Ll(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TT(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(cP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(oP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(dP(e))return"Blackberry";if(hP(e))return"Webos";if(aP(e))return"Safari";if((e.includes("chrome/")||lP(e))&&!e.includes("edge/"))return"Chrome";if(uP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function oP(n=bn()){return/firefox\//i.test(n)}function aP(n=bn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function lP(n=bn()){return/crios\//i.test(n)}function cP(n=bn()){return/iemobile/i.test(n)}function uP(n=bn()){return/android/i.test(n)}function dP(n=bn()){return/blackberry/i.test(n)}function hP(n=bn()){return/webos/i.test(n)}function Hx(n=bn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function CU(n=bn()){var e;return Hx(n)&&!!((e=window.navigator)!=null&&e.standalone)}function kU(){return CO()&&document.documentMode===10}function fP(n=bn()){return Hx(n)||uP(n)||hP(n)||dP(n)||/windows phone/i.test(n)||cP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mP(n,e=[]){let t;switch(n){case"Browser":t=TT(bn());break;case"Worker":t=`${TT(bn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${La}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const c=e(i);o(c)}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DU(n,e={}){return Ft(n,"GET","/v2/passwordPolicy",Vt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PU=6;class jU{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??PU,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new AT(this),this.idTokenSubscription=new AT(this),this.beforeStateQueue=new RU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=XD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ni(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Ll.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await cp(this,{idToken:e}),r=await us._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(zt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return J(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=fU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(zt(this.app))return Promise.reject(On(this));const t=e?le(e):null;return t&&J(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&J(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return zt(this.app)?Promise.reject(On(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return zt(this.app)?Promise.reject(On(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ni(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await DU(this),t=new jU(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ma("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await NU(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ni(e)||this._popupRedirectResolver;J(t,this,"argument-error"),this.redirectPersistenceManager=await Ll.create(this,[ni(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(J(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return J(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(zt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&dU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function cn(n){return le(n)}class AT{constructor(e){this.auth=e,this.observer=null,this.addObserver=OO(t=>this.observer=t)}get next(){return J(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Th={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function OU(n){Th=n}function Qx(n){return Th.loadJS(n)}function LU(){return Th.recaptchaV2Script}function VU(){return Th.recaptchaEnterpriseScript}function FU(){return Th.gapiScript}function pP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $U=500,UU=6e4,wf=1e12;class BU{constructor(e){this.auth=e,this.counter=wf,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new WU(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||wf;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||wf;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||wf;return(r=this._widgets.get(t))==null||r.execute(),""}}class zU{constructor(){this.enterprise=new qU}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class qU{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class WU{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;J(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=GU(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},UU)},$U))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function GU(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const HU="recaptcha-enterprise",Xu="NO_RECAPTCHA";class gP{constructor(e){this.type=HU,this.auth=cn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{rP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new nP(c);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(c=>{a(c)})})}function s(i,o,a){const c=window.grecaptcha;ST(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(Xu)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new zU().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&ST(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=VU();c.length!==0&&(c+=a),Qx(c).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function fu(n,e,t,r=!1,s=!1){const i=new gP(n);let o;if(s)o=Xu;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const c=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function co(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await fu(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await fu(n,e,t,t==="getOobCode");return r(n,c)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await fu(n,e,t);return r(n,a).catch(async c=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await fu(n,e,t,!1,!0);return r(n,h)}return Promise.reject(c)})}else{const a=await fu(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function yP(n){const e=cn(n),t=await rP(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new nP(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new gP(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QU(n,e){const t=qs(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Or(i,e??{}))return s;Sr(s,"already-initialized")}return t.initialize({options:e})}function KU(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ni);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function YU(n,e,t){const r=cn(n);J(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=vP(e),{host:o,port:a}=JU(e),c=a===null?"":`:${a}`,u={url:`${i}//${o}${c}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){J(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),J(Or(u,r.config.emulator)&&Or(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,vi(o)?(Op(`${i}//${o}${c}`),G_("Auth",!0)):s||XU()}function vP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function JU(n){const e=vP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:NT(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:NT(o)}}}function NT(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function XU(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rs("not implemented")}_getIdTokenResponse(e){return Rs("not implemented")}_linkToIdToken(e,t){return Rs("not implemented")}_getReauthenticationResolver(e){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _P(n,e){return Ft(n,"POST","/v1/accounts:resetPassword",Vt(n,e))}async function ZU(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function eB(n,e){return Ft(n,"POST","/v1/accounts:signUp",e)}async function tB(n,e){return Ft(n,"POST","/v1/accounts:update",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nB(n,e){return Ii(n,"POST","/v1/accounts:signInWithPassword",Vt(n,e))}async function Dg(n,e){return Ft(n,"POST","/v1/accounts:sendOobCode",Vt(n,e))}async function rB(n,e){return Dg(n,e)}async function sB(n,e){return Dg(n,e)}async function iB(n,e){return Dg(n,e)}async function oB(n,e){return Dg(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aB(n,e){return Ii(n,"POST","/v1/accounts:signInWithEmailLink",Vt(n,e))}async function lB(n,e){return Ii(n,"POST","/v1/accounts:signInWithEmailLink",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd extends Ah{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Wd(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Wd(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return co(e,t,"signInWithPassword",nB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return aB(e,{email:this._email,oobCode:this._password});default:Sr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return co(e,r,"signUpPassword",eB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return lB(e,{idToken:t,email:this._email,oobCode:this._password});default:Sr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ii(n,e){return Ii(n,"POST","/v1/accounts:signInWithIdp",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cB="http://localhost";class gi extends Ah{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new gi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Sr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new gi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return ii(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ii(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ii(e,t)}buildRequest(){const e={requestUri:cB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Oa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CT(n,e){return Ft(n,"POST","/v1/accounts:sendVerificationCode",Vt(n,e))}async function uB(n,e){return Ii(n,"POST","/v1/accounts:signInWithPhoneNumber",Vt(n,e))}async function dB(n,e){const t=await Ii(n,"POST","/v1/accounts:signInWithPhoneNumber",Vt(n,e));if(t.temporaryProof)throw Au(n,"account-exists-with-different-credential",t);return t}const hB={USER_NOT_FOUND:"user-not-found"};async function fB(n,e){const t={...e,operation:"REAUTH"};return Ii(n,"POST","/v1/accounts:signInWithPhoneNumber",Vt(n,t),hB)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua extends Ah{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ua({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ua({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return uB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return dB(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return fB(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ua({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mB(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function pB(n){const e=wu(xu(n)).link,t=e?wu(xu(e)).deep_link_id:null,r=wu(xu(n)).deep_link_id;return(r?wu(xu(r)).link:null)||r||t||e||n}class Nh{constructor(e){const t=wu(xu(e)),r=t.apiKey??null,s=t.oobCode??null,i=mB(t.mode??null);J(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=pB(e);try{return new Nh(t)}catch{return null}}}function XW(n){return Nh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(){this.providerId=Ha.PROVIDER_ID}static credential(e,t){return Wd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Nh.parseLink(t);return J(r,"argument-error"),Wd._fromEmailAndCode(e,r.code,r.tenantId)}}Ha.PROVIDER_ID="password";Ha.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ha.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc extends Ei{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tm extends Bc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return J("providerId"in t&&"signInMethod"in t,"argument-error"),gi._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return J(e.idToken||e.accessToken,"argument-error"),gi._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return tm.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return tm.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new tm(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi extends Bc{constructor(){super("facebook.com")}static credential(e){return gi._fromParams({providerId:Fi.PROVIDER_ID,signInMethod:Fi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fi.credentialFromTaggedObject(e)}static credentialFromError(e){return Fi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Fi.credential(e.oauthAccessToken)}catch{return null}}}Fi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Fi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends Bc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return gi._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ys.credential(t,r)}catch{return null}}}Ys.GOOGLE_SIGN_IN_METHOD="google.com";Ys.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i extends Bc{constructor(){super("github.com")}static credential(e){return gi._fromParams({providerId:$i.PROVIDER_ID,signInMethod:$i.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $i.credentialFromTaggedObject(e)}static credentialFromError(e){return $i.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return $i.credential(e.oauthAccessToken)}catch{return null}}}$i.GITHUB_SIGN_IN_METHOD="github.com";$i.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gB="http://localhost";class Gd extends Ah{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return ii(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ii(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ii(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Gd(r,i)}static _create(e,t){return new Gd(e,t)}buildRequest(){return{requestUri:gB,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yB="saml.";class Hv extends Ei{constructor(e){J(e.startsWith(yB),"argument-error"),super(e)}static credentialFromResult(e){return Hv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Hv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Gd.fromJSON(e);return J(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Gd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui extends Bc{constructor(){super("twitter.com")}static credential(e,t){return gi._fromParams({providerId:Ui.PROVIDER_ID,signInMethod:Ui.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ui.credentialFromTaggedObject(e)}static credentialFromError(e){return Ui.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ui.credential(t,r)}catch{return null}}}Ui.TWITTER_SIGN_IN_METHOD="twitter.com";Ui.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wP(n,e){return Ii(n,"POST","/v1/accounts:signUp",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await us._fromIdTokenResponse(e,r,s),o=kT(r);return new Zr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=kT(r);return new Zr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function kT(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZW(n){var s;if(zt(n.app))return Promise.reject(On(n));const e=cn(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Zr({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await wP(e,{returnSecureToken:!0}),r=await Zr._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up extends ys{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,up.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new up(e,t,r,s)}}function xP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?up._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SP(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eG(n,e){const t=le(n);await Pg(!0,t,e);const{providerUserInfo:r}=await xU(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=SP(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Kx(n,e,t=!1){const r=await pi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Zr._forOperation(n,"link",r)}async function Pg(n,e,t){await qd(e);const r=SP(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";J(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IP(n,e,t=!1){const{auth:r}=n;if(zt(r.app))return Promise.reject(On(r));const s="reauthenticate";try{const i=await pi(n,xP(r,s,e,n),t);J(i.idToken,r,"internal-error");const o=Rg(i.idToken);J(o,r,"internal-error");const{sub:a}=o;return J(n.uid===a,r,"user-mismatch"),Zr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Sr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EP(n,e,t=!1){if(zt(n.app))return Promise.reject(On(n));const r="signIn",s=await xP(n,r,e),i=await Zr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Yx(n,e){return EP(cn(n),e)}async function vB(n,e){const t=le(n);return await Pg(!1,t,e.providerId),Kx(t,e)}async function _B(n,e){return IP(le(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wB(n,e){return Ii(n,"POST","/v1/accounts:signInWithCustomToken",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tG(n,e){if(zt(n.app))return Promise.reject(On(n));const t=cn(n),r=await wB(t,{token:e,returnSecureToken:!0}),s=await Zr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Jx._fromServerResponse(e,t):"totpInfo"in t?Xx._fromServerResponse(e,t):Sr(e,"internal-error")}}class Jx extends Ch{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Jx(t)}}class Xx extends Ch{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Xx(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jg(n,e,t){var r;J(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),J(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),J(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(J(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(J(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zx(n){const e=cn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function xB(n,e,t){const r=cn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&jg(r,s,t),await co(r,s,"getOobCode",sB,"EMAIL_PASSWORD_PROVIDER")}async function nG(n,e,t){await _P(le(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Zx(n),r})}async function rG(n,e){await tB(le(n),{oobCode:e})}async function SB(n,e){const t=le(n),r=await _P(t,{oobCode:e}),s=r.requestType;switch(J(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":J(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":J(r.mfaInfo,t,"internal-error");default:J(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Ch._fromServerResponse(cn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function sG(n,e){const{data:t}=await SB(le(n),e);return t.email}async function bP(n,e,t){if(zt(n.app))return Promise.reject(On(n));const r=cn(n),o=await co(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",wP,"EMAIL_PASSWORD_PROVIDER").catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&Zx(n),c}),a=await Zr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function TP(n,e,t){return zt(n.app)?Promise.reject(On(n)):Yx(le(n),Ha.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Zx(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iG(n,e,t){const r=cn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){J(a.handleCodeInApp,r,"argument-error"),a&&jg(r,o,a)}i(s,t),await co(r,s,"getOobCode",iB,"EMAIL_PASSWORD_PROVIDER")}function oG(n,e){const t=Nh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function aG(n,e,t){if(zt(n.app))return Promise.reject(On(n));const r=le(n),s=Ha.credentialWithLink(e,t||zd());return J(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Yx(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IB(n,e){return Ft(n,"POST","/v1/accounts:createAuthUri",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lG(n,e){const t=Wx()?zd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await IB(le(n),r);return s||[]}async function EB(n,e){const t=le(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&jg(t.auth,s,e);const{email:i}=await rB(t.auth,s);i!==n.email&&await n.reload()}async function cG(n,e,t){const r=le(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&jg(r.auth,i,t);const{email:o}=await oB(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bB(n,e){return Ft(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uG(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=le(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await pi(r,bB(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function dG(n,e){const t=le(n);return zt(t.auth.app)?Promise.reject(On(t.auth)):AP(t,e,null)}function hG(n,e){return AP(le(n),null,e)}async function AP(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await pi(n,ZU(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TB(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Rg(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Vl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new AB(r,t);case"github.com":return new NB(r,t);case"google.com":return new CB(r,t);case"twitter.com":return new kB(r,t,n.screenName||null);case"custom":case"anonymous":return new Vl(r,null);default:return new Vl(r,e,t)}}class Vl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class NP extends Vl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class AB extends Vl{constructor(e,t){super(e,"facebook.com",t)}}class NB extends NP{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class CB extends Vl{constructor(e,t){super(e,"google.com",t)}}class kB extends NP{constructor(e,t,r){super(e,"twitter.com",t,r)}}function fG(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:TB(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(n,e){return le(n).setPersistence(e)}function mG(n){return yP(n)}async function pG(n,e){return cn(n).validatePassword(e)}function RB(n,e,t,r){return le(n).onIdTokenChanged(e,t,r)}function DB(n,e,t){return le(n).beforeAuthStateChanged(e,t)}function PB(n,e,t,r){return le(n).onAuthStateChanged(e,t,r)}function gG(n){le(n).useDeviceLanguage()}function yG(n,e){return le(n).updateCurrentUser(e)}function jB(n){return le(n).signOut()}function vG(n,e){return cn(n).revokeAccessToken(e)}async function _G(n){return le(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ta("enroll",e,t)}static _fromMfaPendingCredential(e){return new ta("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return ta._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return ta._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=cn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Ch._fromServerResponse(r,a));J(s.mfaPendingCredential,r,"internal-error");const o=ta._fromMfaPendingCredential(s.mfaPendingCredential);return new tS(o,i,async a=>{const c=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:c.idToken,refreshToken:c.refreshToken};switch(t.operationType){case"signIn":const h=await Zr._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return J(t.user,r,"internal-error"),Zr._forOperation(t.user,t.operationType,u);default:Sr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function wG(n,e){var s;const t=le(n),r=e;return J(e.customData.operationType,t,"argument-error"),J((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),tS._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RT(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Vt(n,e))}function MB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Vt(n,e))}function OB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Vt(n,e))}function LB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Vt(n,e))}function VB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Vt(n,e))}class nS{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Ch._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new nS(e)}async getSession(){return ta._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await pi(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await pi(this.user,VB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Wy=new WeakMap;function xG(n){const e=le(n);return Wy.has(e)||Wy.set(e,nS._fromUser(e)),Wy.get(e)}const dp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(dp,"1"),this.storage.removeItem(dp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FB=1e3,$B=10;class kP extends CP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=fP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);kU()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,$B):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},FB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}kP.type="LOCAL";const Fl=kP;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UB=1e3;function Gy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function Hy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class RP{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Hy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return Gy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=Hy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=Hy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(m=>m.name===r);h&&t(h.value),u.deleted.find(m=>m.name===r)&&t(null)},c=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,c),window.cookieStore.addEventListener("change",a)}let s=Gy(r);const i=setInterval(()=>{const a=Gy(r);a!==s&&(t(a),s=a)},UB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}RP.type="COOKIE";const SG=RP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP extends CP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}DP.type="SESSION";const Zu=DP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Mg(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),c=await BB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Mg.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Og(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,c)=>{const u=Og("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(){return window}function qB(n){vn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rS(){return typeof vn().WorkerGlobalScope<"u"&&typeof vn().importScripts=="function"}async function WB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function GB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function HB(){return rS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP="firebaseLocalStorageDb",QB=1,hp="firebaseLocalStorage",jP="fbase_key";class kh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Lg(n,e){return n.transaction([hp],e?"readwrite":"readonly").objectStore(hp)}function KB(){const n=indexedDB.deleteDatabase(PP);return new kh(n).toPromise()}function Qv(){const n=indexedDB.open(PP,QB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(hp,{keyPath:jP})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(hp)?e(r):(r.close(),await KB(),e(await Qv()))})})}async function DT(n,e,t){const r=Lg(n,!0).put({[jP]:e,value:t});return new kh(r).toPromise()}async function YB(n,e){const t=Lg(n,!1).get(e),r=await new kh(t).toPromise();return r===void 0?null:r.value}function PT(n,e){const t=Lg(n,!0).delete(e);return new kh(t).toPromise()}const JB=800,XB=3;class MP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Qv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>XB)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Mg._getInstance(HB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await WB(),!this.activeServiceWorker)return;this.sender=new zB(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||GB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Qv();return await DT(e,dp,"1"),await PT(e,dp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>DT(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>YB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>PT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Lg(s,!1).getAll();return new kh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),JB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}MP.type="LOCAL";const ZB=MP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jT(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:start",Vt(n,e))}function ez(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Vt(n,e))}function tz(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy=pP("rcb"),nz=new bh(3e4,6e4);class rz{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=vn().grecaptcha)!=null&&e.render)}load(e,t=""){return J(sz(t),e,"argument-error"),this.shouldResolveImmediately(t)&&xT(vn().grecaptcha)?Promise.resolve(vn().grecaptcha):new Promise((r,s)=>{const i=vn().setTimeout(()=>{s(lr(e,"network-request-failed"))},nz.get());vn()[Qy]=()=>{vn().clearTimeout(i),delete vn()[Qy];const a=vn().grecaptcha;if(!a||!xT(a)){s(lr(e,"internal-error"));return}const c=a.render;a.render=(u,h)=>{const f=c(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${LU()}?${Oa({onload:Qy,render:"explicit",hl:t})}`;Qx(o).catch(()=>{clearTimeout(i),s(lr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=vn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function sz(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class iz{async load(e){return new BU(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ed="recaptcha",oz={theme:"light",type:"image"};class IG{constructor(e,t,r={...oz}){this.parameters=r,this.type=ed,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=cn(e),this.isInvisible=this.parameters.size==="invisible",J(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;J(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new iz:new rz,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){J(!this.parameters.sitekey,this.auth,"argument-error"),J(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),J(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=vn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){J(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){J(Wx()&&!rS(),this.auth,"internal-error"),await az(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await _U(this.auth);J(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return J(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function az(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ua._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function EG(n,e,t){if(zt(n.app))return Promise.reject(On(n));const r=cn(n),s=await Vg(r,e,le(t));return new sS(s,i=>Yx(r,i))}async function bG(n,e,t){const r=le(n);await Pg(!1,r,"phone");const s=await Vg(r.auth,e,le(t));return new sS(s,i=>vB(r,i))}async function TG(n,e,t){const r=le(n);if(zt(r.auth.app))return Promise.reject(On(r.auth));const s=await Vg(r.auth,e,le(t));return new sS(s,i=>_B(r,i))}async function Vg(n,e,t){var r;if(!n._getRecaptchaConfig())try{await yP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){J(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await co(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===Xu){J((t==null?void 0:t.type)===ed,h,"argument-error");const m=await Ky(h,f,t);return RT(h,m)}return RT(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{J(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;J(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await co(n,a,"mfaSmsSignIn",async(f,m)=>{if(m.phoneSignInInfo.captchaResponse===Xu){J((t==null?void 0:t.type)===ed,f,"argument-error");const g=await Ky(f,m,t);return jT(f,g)}return jT(f,m)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await co(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===Xu){J((t==null?void 0:t.type)===ed,u,"argument-error");const f=await Ky(u,h,t);return CT(u,f)}return CT(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function AG(n,e){const t=le(n);if(zt(t.auth.app))return Promise.reject(On(t.auth));await Kx(t,e)}async function Ky(n,e,t){J(t.type===ed,n,"argument-error");const r=await t.verify();J(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,c=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:c}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e){this.providerId=$l.PROVIDER_ID,this.auth=cn(e)}verifyPhoneNumber(e,t){return Vg(this.auth,e,le(t))}static credential(e,t){return ua._fromVerification(e,t)}static credentialFromResult(e){const t=e;return $l.credentialFromTaggedObject(t)}static credentialFromError(e){return $l.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ua._fromTokenResponse(t,r):null}}$l.PROVIDER_ID="phone";$l.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(n,e){return e?ni(e):(J(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS extends Ah{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ii(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ii(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ii(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function lz(n){return EP(n.auth,new iS(n),n.bypassAuthState)}function cz(n){const{auth:e,user:t}=n;return J(t,e,"internal-error"),IP(t,new iS(n),n.bypassAuthState)}async function uz(n){const{auth:e,user:t}=n;return J(t,e,"internal-error"),Kx(t,new iS(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return lz;case"linkViaPopup":case"linkViaRedirect":return uz;case"reauthViaPopup":case"reauthViaRedirect":return cz;default:Sr(this.auth,"internal-error")}}resolve(e){mi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){mi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz=new bh(2e3,1e4);async function hz(n,e,t){if(zt(n.app))return Promise.reject(lr(n,"operation-not-supported-in-this-environment"));const r=cn(n);Uc(n,e,Ei);const s=Qa(r,t);return new ri(r,"signInViaPopup",e,s).executeNotNull()}async function NG(n,e,t){const r=le(n);if(zt(r.auth.app))return Promise.reject(lr(r.auth,"operation-not-supported-in-this-environment"));Uc(r.auth,e,Ei);const s=Qa(r.auth,t);return new ri(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function CG(n,e,t){const r=le(n);Uc(r.auth,e,Ei);const s=Qa(r.auth,t);return new ri(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class ri extends OP{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ri.currentPopupAction&&ri.currentPopupAction.cancel(),ri.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return J(e,this.auth,"internal-error"),e}async onExecution(){mi(this.filter.length===1,"Popup operations only handle one event");const e=Og();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(lr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(lr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ri.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(lr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,dz.get())};e()}}ri.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fz="pendingRedirect",nm=new Map;class mz extends OP{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=nm.get(this.auth._key());if(!e){try{const r=await pz(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}nm.set(this.auth._key(),e)}return this.bypassAuthState||nm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function pz(n,e){const t=VP(e),r=LP(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function oS(n,e){return LP(n)._set(VP(e),"true")}function gz(n,e){nm.set(n._key(),e)}function LP(n){return ni(n._redirectPersistence)}function VP(n){return em(fz,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kG(n,e,t){return yz(n,e,t)}async function yz(n,e,t){if(zt(n.app))return Promise.reject(On(n));const r=cn(n);Uc(n,e,Ei),await r._initializationPromise;const s=Qa(r,t);return await oS(s,r),s._openRedirect(r,e,"signInViaRedirect")}function RG(n,e,t){return vz(n,e,t)}async function vz(n,e,t){const r=le(n);if(Uc(r.auth,e,Ei),zt(r.auth.app))return Promise.reject(On(r.auth));await r.auth._initializationPromise;const s=Qa(r.auth,t);await oS(s,r.auth);const i=await $P(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function DG(n,e,t){return _z(n,e,t)}async function _z(n,e,t){const r=le(n);Uc(r.auth,e,Ei),await r.auth._initializationPromise;const s=Qa(r.auth,t);await Pg(!1,r,e.providerId),await oS(s,r.auth);const i=await $P(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function PG(n,e){return await cn(n)._initializationPromise,FP(n,e,!1)}async function FP(n,e,t=!1){if(zt(n.app))return Promise.reject(On(n));const r=cn(n),s=Qa(r,e),o=await new mz(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function $P(n){const e=Og(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz=10*60*1e3;class xz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Sz(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!UP(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(lr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=wz&&this.cachedEventUids.clear(),this.cachedEventUids.has(MT(e))}saveEventToCache(e){this.cachedEventUids.add(MT(e)),this.lastProcessedEventTime=Date.now()}}function MT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function UP({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Sz(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return UP(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iz(n,e={}){return Ft(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ez=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,bz=/^https?/;async function Tz(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Iz(n);for(const t of e)try{if(Az(t))return}catch{}Sr(n,"unauthorized-domain")}function Az(n){const e=zd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!bz.test(t))return!1;if(Ez.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz=new bh(3e4,6e4);function OT(){const n=vn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Cz(n){return new Promise((e,t)=>{var s,i,o;function r(){OT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{OT(),t(lr(n,"network-request-failed"))},timeout:Nz.get()})}if((i=(s=vn().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=vn().gapi)!=null&&o.load)r();else{const a=pP("iframefcb");return vn()[a]=()=>{gapi.load?r():t(lr(n,"network-request-failed"))},Qx(`${FU()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw rm=null,e})}let rm=null;function kz(n){return rm=rm||Cz(n),rm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rz=new bh(5e3,15e3),Dz="__/auth/iframe",Pz="emulator/auth/iframe",jz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Mz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Oz(n){const e=n.config;J(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Gx(e,Pz):`https://${n.config.authDomain}/${Dz}`,r={apiKey:e.apiKey,appName:n.name,v:La},s=Mz.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Oa(r).slice(1)}`}async function Lz(n){const e=await kz(n),t=vn().gapi;return J(t,n,"internal-error"),e.open({where:document.body,url:Oz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jz,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=lr(n,"network-request-failed"),a=vn().setTimeout(()=>{i(o)},Rz.get());function c(){vn().clearTimeout(a),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Fz=500,$z=600,Uz="_blank",Bz="http://localhost";class LT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function zz(n,e,t,r=Fz,s=$z){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c={...Vz,width:r.toString(),height:s.toString(),top:i,left:o},u=bn().toLowerCase();t&&(a=lP(u)?Uz:t),oP(u)&&(e=e||Bz,c.scrollbars="yes");const h=Object.entries(c).reduce((m,[g,v])=>`${m}${g}=${v},`,"");if(CU(u)&&a!=="_self")return qz(e||"",a),new LT(null);const f=window.open(e||"",a,h);J(f,n,"popup-blocked");try{f.focus()}catch{}return new LT(f)}function qz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wz="__/auth/handler",Gz="emulator/auth/handler",Hz=encodeURIComponent("fac");async function VT(n,e,t,r,s,i){J(n.config.authDomain,n,"auth-domain-config-required"),J(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:La,eventId:s};if(e instanceof Ei){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",km(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Bc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const c=await n._getAppCheckToken(),u=c?`#${Hz}=${encodeURIComponent(c)}`:"";return`${Qz(n)}?${Oa(a).slice(1)}${u}`}function Qz({config:n}){return n.emulator?Gx(n,Gz):`https://${n.authDomain}/${Wz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yy="webStorageSupport";class Kz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Zu,this._completeRedirectFn=FP,this._overrideRedirectResult=gz}async _openPopup(e,t,r,s){var o;mi((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await VT(e,t,r,zd(),s);return zz(e,i,Og())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await VT(e,t,r,zd(),s);return qB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(mi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Lz(e),r=new xz(e);return t.register("authEvent",s=>(J(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Yy,{type:Yy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Yy];i!==void 0&&t(!!i),Sr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Tz(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return fP()||aP()||Hx()}}const Yz=Kz;class BP{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Rs("unexpected MultiFactorSessionType")}}}class aS extends BP{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new aS(e)}_finalizeEnroll(e,t,r){return MB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return ez(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Jz{constructor(){}static assertion(e){return aS._fromCredential(e)}}Jz.FACTOR_ID="phone";class Xz{static assertionForEnrollment(e,t){return Hd._fromSecret(e,t)}static assertionForSignIn(e,t){return Hd._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;J(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await OB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return lS._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}Xz.FACTOR_ID="totp";class Hd extends BP{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Hd(t,void 0,e)}static _fromEnrollmentId(e,t){return new Hd(t,e)}async _finalizeEnroll(e,t,r){return J(typeof this.secret<"u",e,"argument-error"),LB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){J(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return tz(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class lS{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new lS(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(xf(e)||xf(t))&&(r=!0),r&&(xf(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),xf(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function xf(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var FT="@firebase/auth",$T="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){J(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e9(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function t9(n){gs(new xr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;J(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mP(n)},u=new MU(r,s,i,c);return KU(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),gs(new xr("auth-internal",e=>{const t=cn(e.getProvider("auth").getImmediate());return(r=>new Zz(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),_r(FT,$T,e9(n)),_r(FT,$T,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n9=5*60,r9=NN("authIdTokenMaxAge")||n9;let UT=null;const s9=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>r9)return;const s=t==null?void 0:t.token;UT!==s&&(UT=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function zP(n=Tc()){const e=qs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=QU(n,{popupRedirectResolver:Yz,persistence:[ZB,Fl,Zu]}),r=NN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=s9(i.toString());DB(t,o,()=>o(t.currentUser)),RB(t,a=>o(a))}}const s=bN("auth");return s&&YU(t,`http://${s}`),t}function i9(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}OU({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=lr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",i9().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});t9("Browser");const qP="@firebase/installations",cS="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WP=1e4,GP=`w:${cS}`,HP="FIS_v2",o9="https://firebaseinstallations.googleapis.com/v1",a9=60*60*1e3,l9="installations",c9="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u9={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ra=new Ma(l9,c9,u9);function QP(n){return n instanceof ys&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KP({projectId:n}){return`${o9}/projects/${n}/installations`}function YP(n){return{token:n.token,requestStatus:2,expiresIn:h9(n.expiresIn),creationTime:Date.now()}}async function JP(n,e){const r=(await e.json()).error;return Ra.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function XP({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function d9(n,{refreshToken:e}){const t=XP(n);return t.append("Authorization",f9(e)),t}async function ZP(n){const e=await n();return e.status>=500&&e.status<600?n():e}function h9(n){return Number(n.replace("s","000"))}function f9(n){return`${HP} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m9({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=KP(n),s=XP(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:HP,appId:n.appId,sdkVersion:GP},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await ZP(()=>fetch(r,a));if(c.ok){const u=await c.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:YP(u.authToken)}}else throw await JP("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p9(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g9=/^[cdef][\w-]{21}$/,Kv="";function y9(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=v9(n);return g9.test(t)?t:Kv}catch{return Kv}}function v9(n){return p9(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t2=new Map;function n2(n,e){const t=Fg(n);r2(t,e),_9(t,e)}function r2(n,e){const t=t2.get(n);if(t)for(const r of t)r(e)}function _9(n,e){const t=w9();t&&t.postMessage({key:n,fid:e}),x9()}let na=null;function w9(){return!na&&"BroadcastChannel"in self&&(na=new BroadcastChannel("[Firebase] FID Change"),na.onmessage=n=>{r2(n.data.key,n.data.fid)}),na}function x9(){t2.size===0&&na&&(na.close(),na=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S9="firebase-installations-database",I9=1,Da="firebase-installations-store";let Jy=null;function uS(){return Jy||(Jy=J_(S9,I9,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Da)}}})),Jy}async function fp(n,e){const t=Fg(n),s=(await uS()).transaction(Da,"readwrite"),i=s.objectStore(Da),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&n2(n,e.fid),e}async function s2(n){const e=Fg(n),r=(await uS()).transaction(Da,"readwrite");await r.objectStore(Da).delete(e),await r.done}async function $g(n,e){const t=Fg(n),s=(await uS()).transaction(Da,"readwrite"),i=s.objectStore(Da),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&n2(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dS(n){let e;const t=await $g(n.appConfig,r=>{const s=E9(r),i=b9(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Kv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function E9(n){const e=n||{fid:y9(),registrationStatus:0};return i2(e)}function b9(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Ra.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=T9(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:A9(n)}:{installationEntry:e}}async function T9(n,e){try{const t=await m9(n,e);return fp(n.appConfig,t)}catch(t){throw QP(t)&&t.customData.serverCode===409?await s2(n.appConfig):await fp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function A9(n){let e=await BT(n.appConfig);for(;e.registrationStatus===1;)await e2(100),e=await BT(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await dS(n);return r||t}return e}function BT(n){return $g(n,e=>{if(!e)throw Ra.create("installation-not-found");return i2(e)})}function i2(n){return N9(n)?{fid:n.fid,registrationStatus:0}:n}function N9(n){return n.registrationStatus===1&&n.registrationTime+WP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C9({appConfig:n,heartbeatServiceProvider:e},t){const r=k9(n,t),s=d9(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:GP,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await ZP(()=>fetch(r,a));if(c.ok){const u=await c.json();return YP(u)}else throw await JP("Generate Auth Token",c)}function k9(n,{fid:e}){return`${KP(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hS(n,e=!1){let t;const r=await $g(n.appConfig,i=>{if(!o2(i))throw Ra.create("not-registered");const o=i.authToken;if(!e&&P9(o))return i;if(o.requestStatus===1)return t=R9(n,e),i;{if(!navigator.onLine)throw Ra.create("app-offline");const a=M9(i);return t=D9(n,a),a}});return t?await t:r.authToken}async function R9(n,e){let t=await zT(n.appConfig);for(;t.authToken.requestStatus===1;)await e2(100),t=await zT(n.appConfig);const r=t.authToken;return r.requestStatus===0?hS(n,e):r}function zT(n){return $g(n,e=>{if(!o2(e))throw Ra.create("not-registered");const t=e.authToken;return O9(t)?{...e,authToken:{requestStatus:0}}:e})}async function D9(n,e){try{const t=await C9(n,e),r={...e,authToken:t};return await fp(n.appConfig,r),t}catch(t){if(QP(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await s2(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await fp(n.appConfig,r)}throw t}}function o2(n){return n!==void 0&&n.registrationStatus===2}function P9(n){return n.requestStatus===2&&!j9(n)}function j9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+a9}function M9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function O9(n){return n.requestStatus===1&&n.requestTime+WP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L9(n){const e=n,{installationEntry:t,registrationPromise:r}=await dS(e);return r?r.catch(console.error):hS(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V9(n,e=!1){const t=n;return await F9(t),(await hS(t,e)).token}async function F9(n){const{registrationPromise:e}=await dS(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $9(n){if(!n||!n.options)throw Xy("App Configuration");if(!n.name)throw Xy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Xy(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Xy(n){return Ra.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a2="installations",U9="installations-internal",B9=n=>{const e=n.getProvider("app").getImmediate(),t=$9(e),r=qs(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},z9=n=>{const e=n.getProvider("app").getImmediate(),t=qs(e,a2).getImmediate();return{getId:()=>L9(t),getToken:s=>V9(t,s)}};function q9(){gs(new xr(a2,B9,"PUBLIC")),gs(new xr(U9,z9,"PRIVATE"))}q9();_r(qP,cS);_r(qP,cS,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp="analytics",W9="firebase_id",G9="origin",H9=60*1e3,Q9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",fS="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wr=new eh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},jr=new Ma("analytics","Analytics",K9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y9(n){if(!n.startsWith(fS)){const e=jr.create("invalid-gtag-resource",{gtagURL:n});return wr.warn(e.message),""}return n}function l2(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function J9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function X9(n,e){const t=J9("firebase-js-sdk-policy",{createScriptURL:Y9}),r=document.createElement("script"),s=`${fS}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function Z9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function eq(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const c=(await l2(t)).find(u=>u.measurementId===s);c&&await e[c.appId]}}catch(a){wr.error(a)}n("config",s,i)}async function tq(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await l2(t);for(const c of o){const u=a.find(f=>f.measurementId===c),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){wr.error(i)}}function nq(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,c]=o;await tq(n,e,t,a,c)}else if(i==="config"){const[a,c]=o;await eq(n,e,t,r,a,c)}else if(i==="consent"){const[a,c]=o;n("consent",a,c)}else if(i==="get"){const[a,c,u]=o;n("get",a,c,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){wr.error(a)}}return s}function rq(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=nq(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function sq(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(fS)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iq=30,oq=1e3;class aq{constructor(e={},t=oq){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const c2=new aq;function lq(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function cq(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:lq(t)},s=Q9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const c=await i.json();(o=c.error)!=null&&o.message&&(a=c.error.message)}catch{}throw jr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function uq(n,e=c2,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw jr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw jr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new fq;return setTimeout(async()=>{a.abort()},t!==void 0?t:H9),u2({appId:r,apiKey:s,measurementId:i},o,a,e)}async function u2(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=c2){var a;const{appId:i,measurementId:o}=n;try{await dq(r,e)}catch(c){if(o)return wr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw c}try{const c=await cq(n);return s.deleteThrottleMetadata(i),c}catch(c){const u=c;if(!hq(u)){if(s.deleteThrottleMetadata(i),o)return wr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw c}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?oE(t,s.intervalMillis,iq):oE(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),wr.debug(`Calling attemptFetch again in ${h} millis`),u2(n,f,r,s)}}function dq(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(jr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function hq(n){if(!(n instanceof ys)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class fq{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function mq(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pq(){if(Lp())try{await K_()}catch(n){return wr.warn(jr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return wr.warn(jr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function gq(n,e,t,r,s,i,o){const a=uq(n);a.then(m=>{t[m.measurementId]=m.appId,n.options.measurementId&&m.measurementId!==n.options.measurementId&&wr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>wr.error(m)),e.push(a);const c=pq().then(m=>{if(m)return r.getId()}),[u,h]=await Promise.all([a,c]);sq(i)||X9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[G9]="firebase",f.update=!0,h!=null&&(f[W9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yq{constructor(e){this.app=e}_delete(){return delete td[this.app.options.appId],Promise.resolve()}}let td={},qT=[];const WT={};let Zy="dataLayer",vq="gtag",GT,d2,HT=!1;function _q(){const n=[];if(Q_()&&n.push("This is a browser extension environment."),MN()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=jr.create("invalid-analytics-context",{errorInfo:e});wr.warn(t.message)}}function wq(n,e,t){_q();const r=n.options.appId;if(!r)throw jr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)wr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw jr.create("no-api-key");if(td[r]!=null)throw jr.create("already-exists",{id:r});if(!HT){Z9(Zy);const{wrappedGtag:i,gtagCore:o}=rq(td,qT,WT,Zy,vq);d2=i,GT=o,HT=!0}return td[r]=gq(n,qT,WT,e,GT,Zy,t),new yq(n)}function h2(n=Tc()){n=le(n);const e=qs(n,mp);return e.isInitialized()?e.getImmediate():xq(n)}function xq(n,e={}){const t=qs(n,mp);if(t.isInitialized()){const s=t.getImmediate();if(Or(e,t.getOptions()))return s;throw jr.create("already-initialized")}return t.initialize({options:e})}async function f2(){if(Q_()||!MN()||!Lp())return!1;try{return await K_()}catch{return!1}}function Sq(n,e,t,r){n=le(n),mq(d2,td[n.app.options.appId],e,t,r).catch(s=>wr.error(s))}const QT="@firebase/analytics",KT="0.10.18";function Iq(){gs(new xr(mp,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return wq(r,s,t)},"PUBLIC")),gs(new xr("analytics-internal",n,"PRIVATE")),_r(QT,KT),_r(QT,KT,"esm2020");function n(e){try{const t=e.getProvider(mp).getImmediate();return{logEvent:(r,s,i)=>Sq(t,r,s,i)}}catch(t){throw jr.create("interop-component-reg-failed",{reason:t})}}}Iq();const m2={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},Ug=$N().length?Tc():X_(m2),ae=ck(Ug,m2.databaseURL),Yv=jD(Ug),pp=zP(Ug);console.log(" Firebase services initialized:",{db:!!ae,firestore:!!Yv,auth:!!pp});eS(pp,Fl).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let Eq=null;(async()=>{try{await f2()&&(Eq=h2(Ug))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();class Bg{constructor(e,t){this.db=e,this.userUID=t,this.userRef=H(e,`users/${t}`),this.statsRef=H(e,`users/${t}/stats`),this.profileRef=H(e,`users/${t}/profile`),this.behaviorLogRef=H(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(` StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await _e(this.statsRef);if(!s.exists())return console.error(` StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(` StatManager: ${e} change: ${o}  ${a} (${t>0?"+":""}${t})`),console.log(` StatManager: About to write to Firebase - ${e}: ${a}`),console.log(" StatManager: Writing to path:",this.statsRef.toString()),console.log(" StatManager: Full stats object to write:",{...i,[e]:a});try{await Ie(this.statsRef,{...i,[e]:a}),console.log(` StatManager: Successfully updated ${e} in Firebase`)}catch(c){throw console.error(` StatManager: Firebase write failed for ${e}:`,c),c}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(` StatManager: CRITICAL ERROR updating ${e}:`,s),console.error(" StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await _e(H(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await _e(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log(" StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await _e(H(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await _e(H(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log(" StatManager: Last relapse exists:",t.exists()),console.log(" StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),c=r.exists()?r.val():1;console.log(` StatManager: Current escalation level from Firebase: ${c}`),console.log(` StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(` StatManager: After 7+ days clean  escalation level reset to: ${s}`)):(s=c+1,console.log(` StatManager: Within ${a} days  escalation level: ${c} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(` StatManager: Escalation level ${s}  addiction increase: +${i}`),console.log(" StatManager: Updating all stats in single write operation...");try{const o=await _e(this.statsRef);if(!o.exists())return console.error(" StatManager: No stats found for user"),!1;const a=o.val();console.log(" StatManager: Current stats before relapse:",a);const c=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(` StatManager: addictionLevel change: ${a.addictionLevel}  ${c} (+${i})`),console.log(` StatManager: mentalStrength change: ${a.mentalStrength}  ${u} (-3)`),console.log(` StatManager: triggerDefense change: ${a.triggerDefense}  ${h} (-3)`);const f={...a,addictionLevel:c,mentalStrength:u,triggerDefense:h};console.log(" StatManager: Writing complete updated stats:",f),await Ie(this.statsRef,f),console.log(" StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error(" StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([Ie(H(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),Ie(H(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),Ie(H(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await Ie(H(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await _e(H(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await _e(H(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await _e(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,c=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:c,cleanWeeks:u,isCleanFor7Days:c>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await _e(H(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Ie(H(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await _e(H(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await _e(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const c of a)if(o>=c.days){const u=`milestone_${c.days}`;(await _e(H(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",c.bonus,`${c.name} milestone bonus`),Ie(H(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Ie(H(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await _e(H(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await _e(H(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await _e(H(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=new Date().toDateString(),t=`lastInactivityCheck_${this.userUID}_${e}`;if(localStorage.getItem(t)){console.log(`Inactivity penalty already checked today for user ${this.userUID}, skipping...`);return}console.log(` Checking inactivity penalty for user ${this.userUID}...`);const s=await _e(this.userRef);if(!s.exists())return;const i=s.val(),o=new Date,a=i.createdAt?new Date(i.createdAt):i.quitStartDate?new Date(i.quitStartDate):o,c=Math.floor((o-a)/(1e3*60*60*24));if(c<1)return;const u=await _e(H(this.db,`users/${this.userUID}/profile/lastActivity`));if(u.exists()){const m=new Date(u.val()),g=Math.floor((o-m)/(1e3*60*60*24)),v=Math.floor((o-m)/(1e3*60*60));if(console.log(` User has lastActivity timestamp: ${m.toISOString()}, days since: ${g}, hours since: ${v}, days since registration: ${c}`),v<24){console.log(` User logged in today (${v} hours ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(v<2){console.log(` User logged in very recently (${v} hours ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(v<24){console.log(` User logged in today (${v} hours ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(g<7){console.log(` User logged in within last 7 days (${g} days ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(g>=7&&c>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${g} days since last activity`),localStorage.setItem(t,"checked");return}else{console.log(`No inactivity penalty needed: last activity was ${g} days ago`),localStorage.setItem(t,"checked");return}}console.log(" No lastActivity timestamp found, checking daily activity records...");let h=!1,f=null;console.log(" Checking daily activity records for the last 10 days...");for(let m=0;m<10;m++){const g=new Date;g.setDate(g.getDate()-m);const v=g.toDateString(),_=await _e(H(this.db,`users/${this.userUID}/profile/daily/${v}/logged`));if(console.log(` Checking ${v}: ${_.exists()?"Activity found":"No activity"}`),_.exists()&&_.val()){h=!0,f=g,console.log(` Found activity on ${v}`);break}}if(!h)console.log(" No activity found in the last 10 days"),c>=7?(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${c} days since registration with no activity`)):console.log(`No penalty applied: user registered only ${c} days ago`);else if(f){const m=Math.floor((o-f)/864e5);console.log(` Activity found on ${f.toDateString()}, days since: ${m}, days since registration: ${c}`),m>=7&&c>=7?(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${m} days since last activity`)):console.log(`No inactivity penalty needed: last activity was ${m} days ago`)}localStorage.setItem(t,"checked")}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await _e(H(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await Ie(H(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await rk(H(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"":""}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await _e(H(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await _e(H(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await _e(H(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Ie(H(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Ie(H(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await _e(H(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Ie(H(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await _e(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await _e(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,c=t.canAwardTriggerDefense?3:0;await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+c)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await _e(H(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await _e(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await _e(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,c=t.canAwardTriggerDefense?.25:0;await Ie(H(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+c)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await _e(H(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const bq=Object.freeze(Object.defineProperty({__proto__:null,default:Bg},Symbol.toStringTag,{value:"Module"}));class p2{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log(" FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await Br(Cn(this.firestore,this.collections.cravings),r);return console.log(" Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await Br(Cn(this.firestore,this.collections.relapses),r);return console.log(" Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await Br(Cn(this.firestore,this.collections.hydration),r);return console.log(" Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await Br(Cn(this.firestore,this.collections.breathing),r);return console.log(" Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await Br(Cn(this.firestore,this.collections.meditation),r);return console.log(" Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await Br(Cn(this.firestore,this.collections.physicalActivity),r);return console.log(" Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await Br(Cn(this.firestore,this.collections.moodTracking),r);return console.log(" Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=Hi(Cn(this.firestore,this.collections[t]),ti("userId","==",e),ap("timestamp","desc"));r&&(i=Hi(i,ti("timestamp",">=",Fe.fromDate(new Date(r))))),s&&(i=Hi(i,ti("timestamp","<=",Fe.fromDate(new Date(s)))));const o=await xc(i),a=[];return o.forEach(c=>{var u;a.push({id:c.id,...c.data(),timestamp:((u=c.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(` Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(` Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(` Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,c,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(g=>(console.warn(" Cravings data not available yet (indexes building):",g.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(g=>(console.warn(" Relapses data not available yet (indexes building):",g.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(g=>(console.warn(" Hydration data not available yet (indexes building):",g.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(g=>(console.warn(" Breathing data not available yet (indexes building):",g.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(g=>(console.warn(" Meditation data not available yet (indexes building):",g.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(g=>(console.warn(" Physical activity data not available yet (indexes building):",g.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(g=>(console.warn(" Mood data not available yet (indexes building):",g.message),[]))]),m={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(g=>g.outcome==="resisted").length,relapsed:i.filter(g=>g.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((g,v)=>g+(v.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((g,v)=>g+(v.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(g=>g.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(g=>g.achievedTarget).length,breathingExercises:c.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:c.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((g,v)=>g+(v.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,c,u,h,f),generatedAt:new Date};return console.log(" Behavioral analytics generated:",m),m}catch(r){throw console.error(" Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const c=[],u=e.filter(g=>g.outcome==="resisted").length,h=e.length;if(h>0){const g=u/h*100;c.push(`Craving resistance rate: ${g.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&c.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const m=r.filter(g=>g.achievedTarget).length;return m>0&&c.push(`Achieved hydration target on ${m} days`),c}async migrateUserData(e,t){try{console.log(` Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let c=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?Fe.fromDate(new Date(h.timestamp)):aU(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await Br(Cn(this.firestore,this.collections.cravings),f),c++}catch(f){console.error(` Error migrating craving ${u}:`,f)}console.log(` Migrated ${c} cravings to Firestore`)}return console.log(` Data migration completed for user ${e}`),!0}catch(r){throw console.error(" Error during data migration:",r),r}}async testConnectivity(){try{return console.log(" FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log(" FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn(" FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn(" FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(` Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=Hi(Cn(this.db,s),ti("userId","==",e)),o=await xc(i);r[s]=o.size}catch(i){console.warn(` Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error(" Error generating basic analytics:",t),t}}}const jG=Object.freeze(Object.defineProperty({__proto__:null,default:p2},Symbol.toStringTag,{value:"Module"})),g2={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},Rh=$N().length?Tc():X_(g2),$t=ck(Rh,g2.databaseURL),$s=jD(Rh),ra=zP(Rh);console.log(" Firebase services initialized:",{db:!!$t,firestore:!!$s,auth:!!ra});eS(ra,Fl).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let y2=null;(async()=>{try{await f2()&&(y2=h2(Rh))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();const MG=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return y2},app:Rh,auth:ra,db:$t,firestore:$s},Symbol.toStringTag,{value:"Module"}));class YT{constructor(e,t,r=null){this.db=e,this.userId=t,this.authGuard=r,this.statsRef=H(e,`users/${t}/stats`),this.profileRef=H(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{let e,t,r;if(this.authGuard)[e,t,r]=await Promise.all([this.authGuard.databaseGet(`users/${this.userId}/profile`),this.authGuard.databaseGet(`users/${this.userId}/stats`),this.authGuard.databaseGet(`users/${this.userId}`)]);else{const[R,x,I]=await Promise.all([_e(this.profileRef),_e(this.statsRef),_e(H(this.db,`users/${this.userId}`))]);e=R.exists()?R.val():{},t=x.exists()?x.val():{},r=I.exists()?I.val():{}}const s={...e,createdAt:e.createdAt||r.createdAt||null,quitDate:e.quitDate||r.quitDate||r.quitStartDate||null,lastQuitDate:e.lastQuitDate||r.lastQuitDate||null};if(!s.lastRelapseDate&&!s.quitDate&&s.createdAt)try{await Ie(H(this.db,`users/${this.userId}/profile/quitDate`),s.createdAt),s.quitDate=s.createdAt,console.log(` CentralizedStats: Seeded missing quitDate with createdAt for ${this.userId}: ${s.createdAt}`)}catch(R){console.warn(` CentralizedStats: Could not seed quitDate for ${this.userId}:`,R.message)}const i=t||this.getDefaultStats(),o=this.calculateEffectiveQuitDate(s),a=this.calculateStreakFromRelapse(s),c=await this.calculateCravingsResisted(),u=await this.calculateAddictionLevel(s,o),h=this.calculateMentalStrength(i,c),f=h.strength,m=h.cravingsApplied,g=await this.checkMilestonesFromRelapse(s,i),v=await this.generateSpecialFeatures(s),_={...i,...g,streakDays:a.value,streakUnit:a.unit,streakDisplayText:a.displayText,cravingsResisted:c,addictionLevel:u,mentalStrength:f,mentalStrengthCravingsApplied:m,specialFeatures:v,lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,_):await Ie(this.statsRef,_),console.log(` CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:a.displayText,cravingsResisted:c,addictionLevel:u,mentalStrength:f,specialFeatures:(v==null?void 0:v.length)||0,effectiveQuitDate:o}),_}catch(e){throw console.error(` CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||null;if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(` CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(` CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const c=e.lastQuitDate||e.originalQuitDate||e.quitDate||e.createdAt||null;return console.log(` CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${c}`),c?this.calculateStreak(c):{value:0,unit:"hours",displayText:"0 hours",streakDays:0}}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([_e(H(this.db,`users/${this.userId}/profile/cravingsResisted`)),_e(H(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(` CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length}return r}catch(e){return console.warn(` CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}calculateMentalStrength(e,t){try{const r=e.mentalStrength||50,s=e.mentalStrengthCravingsApplied||0;return{strength:r,cravingsApplied:s}}catch(r){return console.warn(` CentralizedStats: Could not calculate mental strength for ${this.userId}:`,r.message),{strength:e.mentalStrength||50,cravingsApplied:e.mentalStrengthCravingsApplied||0}}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([_e(this.statsRef),_e(H(this.db,`users/${this.userId}/profile/lastRelapseDate`)),_e(H(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(` CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(` CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(` CentralizedStats: Days since last relapse: ${u}`),console.log(` CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await Ie(H(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const m=Math.floor(u/7),g=m*2;let v=Math.max(30,o-g);return console.log(` CentralizedStats: Base addiction: ${o}, Weeks clean: ${m}, Decay: -${g}, Final: ${v}`),v}catch(r){return console.error(" CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(` CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},c=!1;for(const u of o)if(i>=u.days){const h=H(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await _e(h)).exists()){const m=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=m,c=!0,await Ie(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(` CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(` CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(` CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(` CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let c={},u=!1;for(const h of a)if(o>=h.days){const f=H(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await _e(f)).exists()){const g=Math.min(100,(t.mentalStrength||50)+h.bonus);c.mentalStrength=g,u=!0,await Ie(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(` CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return c}catch(r){return console.error(` CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await _e(H(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(` CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await _e(H(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(` CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(` CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(` CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(` CentralizedStats: Generated ${o.length} personalized features:`,o);const c=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=c[Math.floor(Math.random()*c.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await Ie(H(this.db,`users/${this.userId}/specialFeatures`),u),console.log(` CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(` CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=Mw(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(` CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:" First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! `},30:{title:" One Month Champion!",message:`Amazing! You've reached 30 days clean!

 Mental Strength: +${e.bonus} points

You're proving your strength every day! `},90:{title:" Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

 Mental Strength: +${e.bonus} points

You're a true inspiration! `}}[e.days]||{title:" Milestone Achieved!",message:`You've reached ${t} days clean!

 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(` Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(` CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=H(this.db,`users/${this.userId}/profile/milestones`);await Ie(e,null),console.log(` CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(` CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(` CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([_e(H(this.db,`users/${this.userId}/profile/lastRelapseDate`)),_e(H(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),_e(this.statsRef)]);let o=1;if(r.exists()){const m=new Date(r.val()),g=Math.floor((e-m)/(1e3*60*60*24)),v=s.exists()?s.val():1;console.log(` CentralizedStats: Current escalation level: ${v}`),console.log(` CentralizedStats: Days since last relapse: ${g}`),g>=7?(o=1,console.log(` CentralizedStats: After 7+ days clean  escalation level reset to: ${o}`)):(o=v+1,console.log(` CentralizedStats: Within ${g} days  escalation level: ${v} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(` CentralizedStats: Escalation level ${o}  addiction increase: +${a}`);const c=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(c.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(c.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(c.triggerDefense||30)-3));console.log(` CentralizedStats: addictionLevel change: ${c.addictionLevel}  ${u} (+${a})`),console.log(` CentralizedStats: mentalStrength change: ${c.mentalStrength}  ${h} (-3)`),console.log(` CentralizedStats: triggerDefense change: ${c.triggerDefense}  ${f} (-3)`),await Promise.all([Ie(H(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),Ie(H(this.db,`users/${this.userId}/profile/relapseDate`),t),Ie(H(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),Ie(H(this.db,`users/${this.userId}/lastQuitDate`),t),Ie(H(this.db,`users/${this.userId}/profile/lastQuitDate`),t),this.resetMilestones(),Ie(this.statsRef,{...c,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(` CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(` CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async getCurrentStats(){try{const e=await _e(this.statsRef);return e.exists()?e.val():this.getDefaultStats()}catch(e){return console.error(` CentralizedStats: Error getting current stats for ${this.userId}:`,e),this.getDefaultStats()}}async handleCravingResisted(){try{console.log(` CentralizedStats: Handling craving resisted for ${this.userId}`),await this.checkAndResetDailyCounter();const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsApplied||0;if(console.log(` CentralizedStats: Current mental strength cravings applied: ${t}`),t<3){const r=Math.min(100,(e.mentalStrength||50)+1),s=t+1,i={...e,mentalStrength:r,mentalStrengthCravingsApplied:s,mentalStrengthCravingsAppliedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,i):await Ie(this.statsRef,i),console.log(` CentralizedStats: Applied +1 mental strength (${e.mentalStrength}  ${r}), cravings applied: ${s}/3`),await this.refreshAllStats(),console.log(` CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!0,cravingsApplied:s,limitReached:s>=3}}else return console.log(` CentralizedStats: Daily mental strength limit reached (${t}/3), no bonus applied`),await this.refreshAllStats(),console.log(` CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!1,cravingsApplied:t,limitReached:!0}}catch(e){throw console.error(` CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}async checkAndResetDailyCounter(){try{const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsAppliedDate,r=new Date,s=r.toDateString();if(!t){const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Ie(this.statsRef,o),console.log(` CentralizedStats: Initialized daily counter for ${this.userId} (reset to 0)`);return}if(new Date(t).toDateString()!==s){console.log(` CentralizedStats: New day detected, resetting daily mental strength counter for ${this.userId}`);const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Ie(this.statsRef,o),console.log(` CentralizedStats: Daily mental strength counter reset for ${this.userId}`)}}catch(e){console.warn(` CentralizedStats: Could not check/reset daily counter for ${this.userId}:`,e.message)}}}const mS=(n,e={})=>{const{threshold:t=100,velocity:r=.5,enabled:s=!0}=e,[i,o]=D.useState(!1),[a,c]=D.useState(null),[u,h]=D.useState(0),f=D.useRef(null),m=D.useRef(0),g=D.useRef(0),v=D.useRef(0),_=D.useRef(0),R=D.useRef(0);return D.useEffect(()=>{if(!s||!f.current)return;const x=f.current;let I=!1;const C=A=>{if(!s)return;const S=A.touches[0];m.current=S.clientY,g.current=S.clientX,v.current=Date.now(),_.current=S.clientY,R.current=Date.now(),I=!0,o(!0),x.classList.add("swiping")},P=A=>{if(!I||!s)return;A.preventDefault();const S=A.touches[0],E=S.clientY-m.current,N=S.clientX-g.current;Math.abs(N)>Math.abs(E)||(h(E),E>0?(c("down"),x.style.transform=`translateY(${Math.min(E,t*1.5)}px)`,x.style.opacity=Math.max(.3,1-E/(t*2))):E<0&&(c("up"),x.style.transform=`translateY(${Math.max(E,-t*1.5)}px)`,x.style.opacity=Math.max(.3,1-Math.abs(E)/(t*2))),_.current=S.clientY,R.current=Date.now())},$=A=>{if(!I||!s)return;I=!1,o(!1);const E=A.changedTouches[0].clientY-m.current,N=Date.now()-v.current,k=Math.abs(E)/N;x.style.transform="",x.style.opacity="",x.classList.remove("swiping"),(Math.abs(E)>t||k>r)&&(E>0&&a==="down"?V("down"):E<0&&a==="up"&&V("up")),c(null),h(0)},V=A=>{x.classList.add(`swipe-${A}`),setTimeout(()=>{typeof n=="function"&&n()},200)};return x.addEventListener("touchstart",C,{passive:!1}),x.addEventListener("touchmove",P,{passive:!1}),x.addEventListener("touchend",$,{passive:!0}),()=>{x.removeEventListener("touchstart",C),x.removeEventListener("touchmove",P),x.removeEventListener("touchend",$)}},[s,t,r,a]),{modalRef:f,isSwipping:i,swipeDirection:a,swipeDistance:u,classes:`modal-swipe-dismiss ${i?"swiping":""} ${a?`swipe-${a}`:""}`}};var Tq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Aq=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Nq=(n,e)=>{const t=D.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...c},u)=>D.createElement("svg",{ref:u,...Tq,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${Aq(n)}`,...c},[...e.map(([h,f])=>D.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var pt=Nq;const gp=pt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Qd=pt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Cq=pt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),yp=pt("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),kq=pt("Bug",[["rect",{width:"8",height:"14",x:"8",y:"6",rx:"4",key:"hq8nra"}],["path",{d:"m19 7-3 2",key:"fmg8ec"}],["path",{d:"m5 7 3 2",key:"dkxqes"}],["path",{d:"m19 19-3-2",key:"1hbhi4"}],["path",{d:"m5 19 3-2",key:"dvt2ee"}],["path",{d:"M20 13h-4",key:"1agfp2"}],["path",{d:"M4 13h4",key:"1bwh8b"}],["path",{d:"m10 4 1 2",key:"1pot59"}],["path",{d:"m14 4-1 2",key:"m8sn0o"}]]),v2=pt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),JT=pt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Rq=pt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),vp=pt("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Dq=pt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Pq=pt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),jq=pt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),_2=pt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),XT=pt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Sf=pt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Ul=pt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),w2=pt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),uo=pt("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),ZT=pt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),If=pt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),x2=pt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Mq=pt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Oq=pt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Lq=pt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Vq=pt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Fq=pt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),S2=pt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),e0=pt("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),$q=pt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Uq=({isOpen:n,onClose:e})=>{var R,x,I,C,P,$,V,A,S,E,N,k,b,w,U,q,ve,Te,z,ne;const[t,r]=D.useState(null),[s,i]=D.useState([]),[o,a]=D.useState(!1),[c,u]=D.useState("overview"),[h,f]=D.useState(!0);D.useEffect(()=>{if(!n)return;const W=()=>{if(window.performanceIntegrationService){const Q=window.performanceIntegrationService.getMetricsSummary(),Z=window.performanceIntegrationService.getRecentAlerts(20);r(Q),i(Z)}};if(W(),h){const Q=setInterval(W,5e3);return()=>clearInterval(Q)}},[n,h]);const m=async W=>{if(window.stressTestService){a(!0);try{let Q;switch(W){case"database":Q=await window.stressTestService.databaseLoadTest({concurrentUsers:5,operationsPerUser:3});break;case"auth":Q=await window.stressTestService.authLoadTest({concurrentAttempts:10});break;case"offline":Q=await window.stressTestService.offlineOnlineTest({transitionCount:3});break;case"memory":Q=await window.stressTestService.memoryUsageTest({iterations:50});break;default:throw new Error("Unknown test type")}console.log(" Stress test completed:",Q)}catch(Q){console.error(" Stress test failed:",Q)}finally{a(!1)}}},g=()=>{window.performanceIntegrationService&&(window.performanceIntegrationService.clearAllMetrics(),r(null),i([]))},v=W=>W.includes("slow")?l.jsx(Rq,{className:"w-4 h-4 text-yellow-500"}):W.includes("failure")||W.includes("error")?l.jsx(Qd,{className:"w-4 h-4 text-red-500"}):l.jsx(JT,{className:"w-4 h-4 text-green-500"}),_=W=>W.includes("slow")?"bg-yellow-50 border-yellow-200":W.includes("failure")||W.includes("error")?"bg-red-50 border-red-200":"bg-green-50 border-green-200";return n?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx(gp,{className:"w-6 h-6 text-blue-600"}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Performance Dashboard"})]}),l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsxs("button",{onClick:()=>f(!h),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${h?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[l.jsx(Ul,{className:`w-4 h-4 ${h?"animate-spin":""}`}),l.jsx("span",{children:"Auto Refresh"})]}),l.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:l.jsx($q,{className:"w-6 h-6"})})]})]}),l.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview",icon:yp},{id:"database",label:"Database",icon:vp},{id:"auth",label:"Authentication",icon:uo},{id:"offline",label:"Offline Queue",icon:e0},{id:"alerts",label:"Alerts",icon:Qd}].map(W=>{const Q=W.icon;return l.jsxs("button",{onClick:()=>u(W.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${c===W.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[l.jsx(Q,{className:"w-4 h-4"}),l.jsx("span",{children:W.label})]},W.id)})}),l.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[c==="overview"&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Database Queries"}),l.jsx("p",{className:"text-2xl font-bold text-blue-900",children:((R=t==null?void 0:t.database)==null?void 0:R.totalQueries)||0})]}),l.jsx(vp,{className:"w-8 h-8 text-blue-500"})]}),l.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Avg: ",((x=t==null?void 0:t.database)==null?void 0:x.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-green-600",children:"Auth Success Rate"}),l.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[((I=t==null?void 0:t.authentication)==null?void 0:I.successRate)||0,"%"]})]}),l.jsx(uo,{className:"w-8 h-8 text-green-500"})]}),l.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[((C=t==null?void 0:t.authentication)==null?void 0:C.totalAttempts)||0," attempts"]})]}),l.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Offline Operations"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:((P=t==null?void 0:t.offlineQueue)==null?void 0:P.totalOperations)||0})]}),l.jsx(e0,{className:"w-8 h-8 text-purple-500"})]}),l.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["Success: ",(($=t==null?void 0:t.offlineQueue)==null?void 0:$.successRate)||0,"%"]})]}),l.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Page Loads"}),l.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((V=t==null?void 0:t.general)==null?void 0:V.totalPageLoads)||0})]}),l.jsx(gp,{className:"w-8 h-8 text-orange-500"})]}),l.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Avg: ",((A=t==null?void 0:t.general)==null?void 0:A.averagePageLoadTime)||0,"ms"]})]})]}),l.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Stress Testing"}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("button",{onClick:()=>m("database"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(If,{className:"w-4 h-4"}):l.jsx(Sf,{className:"w-4 h-4"}),l.jsx("span",{children:"Database Load"})]}),l.jsxs("button",{onClick:()=>m("auth"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(If,{className:"w-4 h-4"}):l.jsx(Sf,{className:"w-4 h-4"}),l.jsx("span",{children:"Auth Load"})]}),l.jsxs("button",{onClick:()=>m("offline"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(If,{className:"w-4 h-4"}):l.jsx(Sf,{className:"w-4 h-4"}),l.jsx("span",{children:"Offline/Online"})]}),l.jsxs("button",{onClick:()=>m("memory"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(If,{className:"w-4 h-4"}):l.jsx(Sf,{className:"w-4 h-4"}),l.jsx("span",{children:"Memory Usage"})]})]}),o&&l.jsx("div",{className:"mt-4 text-center",children:l.jsxs("div",{className:"inline-flex items-center space-x-2 text-blue-600",children:[l.jsx(Ul,{className:"w-4 h-4 animate-spin"}),l.jsx("span",{children:"Running stress test..."})]})})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("button",{onClick:g,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Clear All Metrics"}),l.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),c==="database"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Database Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Query Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Queries:"}),l.jsx("span",{className:"font-medium",children:((S=t==null?void 0:t.database)==null?void 0:S.totalQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((E=t==null?void 0:t.database)==null?void 0:E.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Queries:"}),l.jsx("span",{className:"font-medium text-yellow-600",children:((N=t==null?void 0:t.database)==null?void 0:N.slowQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Query Rate:"}),l.jsxs("span",{className:"font-medium",children:[((k=t==null?void 0:t.database)==null?void 0:k.slowQueryRate)||0,"%"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Trends"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(yp,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Performance trends will be displayed here"})]})]})]})]}),c==="auth"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Authentication Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Auth Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Attempts:"}),l.jsx("span",{className:"font-medium",children:((b=t==null?void 0:t.authentication)==null?void 0:b.totalAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((w=t==null?void 0:t.authentication)==null?void 0:w.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Failed Attempts:"}),l.jsx("span",{className:"font-medium text-red-600",children:((U=t==null?void 0:t.authentication)==null?void 0:U.failedAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((q=t==null?void 0:t.authentication)==null?void 0:q.averageLoginTime)||0,"ms"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Attempts"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(uo,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Recent authentication attempts will be displayed here"})]})]})]})]}),c==="offline"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Offline Queue Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Operations:"}),l.jsx("span",{className:"font-medium",children:((ve=t==null?void 0:t.offlineQueue)==null?void 0:ve.totalOperations)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((Te=t==null?void 0:t.offlineQueue)==null?void 0:Te.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Failed Operations:"}),l.jsx("span",{className:"font-medium text-red-600",children:((z=t==null?void 0:t.offlineQueue)==null?void 0:z.failedOperations)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((ne=t==null?void 0:t.offlineQueue)==null?void 0:ne.averageProcessTime)||0,"ms"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Status"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(e0,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Offline queue status will be displayed here"})]})]})]})]}),c==="alerts"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Alerts"}),l.jsx("div",{className:"space-y-3",children:s.length===0?l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(JT,{className:"w-12 h-12 mx-auto mb-2 text-green-400"}),l.jsx("p",{children:"No alerts at this time"})]}):s.map((W,Q)=>l.jsx("div",{className:`p-4 rounded-lg border ${_(W.type)}`,children:l.jsxs("div",{className:"flex items-start space-x-3",children:[v(W.type),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h4",{className:"font-medium text-gray-900 capitalize",children:W.type.replace(/_/g," ")}),l.jsx("span",{className:"text-xs text-gray-500",children:new Date(W.timestamp).toLocaleTimeString()})]}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:JSON.stringify(W.data,null,2)})]})]})},Q))})]})]})]})}):null};class Bq{constructor(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[],this.thresholds={slowQuery:1e3,slowLogin:3e3,slowOperation:2e3,slowPageLoad:5e3},this.isEnabled=!0,this.maxMetricsHistory=1e3}startTimer(e){return{operationId:e,startTime:performance.now(),timestamp:new Date().toISOString()}}endTimer(e,t,r,s={}){if(!this.isEnabled)return;const o=performance.now()-e.startTime,a={operationId:e.operationId,operation:r,duration:o,timestamp:e.timestamp,endTime:new Date().toISOString(),metadata:s};if(this.metrics[t]){this.metrics[t].operations=this.metrics[t].operations||[],this.metrics[t].operations.push(a),this.metrics[t].totalOperations=(this.metrics[t].totalOperations||0)+1;const c=this.metrics[t].operations.reduce((h,f)=>h+f.duration,0);this.metrics[t].averageProcessTime=c/this.metrics[t].operations.length;const u=this.thresholds[`slow${t.charAt(0).toUpperCase()+t.slice(1)}`]||this.thresholds.slowOperation;o>u&&(this.metrics[t].slowOperations=(this.metrics[t].slowOperations||0)+1,this.createAlert("slow_operation",{category:t,operation:r,duration:o,threshold:u})),this.metrics[t].operations.length>this.maxMetricsHistory&&(this.metrics[t].operations=this.metrics[t].operations.slice(-this.maxMetricsHistory))}return a}recordDatabaseQuery(e,t,r={}){if(!this.isEnabled)return;const s={operation:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.database.queries.push(s),this.metrics.database.totalQueries++;const i=this.metrics.database.queries.reduce((o,a)=>o+a.duration,0);this.metrics.database.averageQueryTime=i/this.metrics.database.queries.length,t>this.thresholds.slowQuery&&(this.metrics.database.slowQueries++,this.createAlert("slow_query",{operation:e,duration:t,threshold:this.thresholds.slowQuery})),this.metrics.database.queries.length>this.maxMetricsHistory&&(this.metrics.database.queries=this.metrics.database.queries.slice(-this.maxMetricsHistory))}recordAuthAttempt(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.authentication.loginAttempts.push(i),this.metrics.authentication.totalAttempts++,r||(this.metrics.authentication.failedAttempts++,this.createAlert("auth_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.authentication.loginAttempts.reduce((a,c)=>a+c.duration,0);this.metrics.authentication.averageLoginTime=o/this.metrics.authentication.loginAttempts.length,t>this.thresholds.slowLogin&&this.createAlert("slow_login",{operation:e,duration:t,threshold:this.thresholds.slowLogin}),this.metrics.authentication.loginAttempts.length>this.maxMetricsHistory&&(this.metrics.authentication.loginAttempts=this.metrics.authentication.loginAttempts.slice(-this.maxMetricsHistory))}recordOfflineOperation(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.offlineQueue.operations.push(i),this.metrics.offlineQueue.totalOperations++,r||(this.metrics.offlineQueue.failedOperations++,this.createAlert("offline_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.offlineQueue.operations.reduce((a,c)=>a+c.duration,0);this.metrics.offlineQueue.averageProcessTime=o/this.metrics.offlineQueue.operations.length,t>this.thresholds.slowOperation&&this.createAlert("slow_offline_operation",{operation:e,duration:t,threshold:this.thresholds.slowOperation}),this.metrics.offlineQueue.operations.length>this.maxMetricsHistory&&(this.metrics.offlineQueue.operations=this.metrics.offlineQueue.operations.slice(-this.maxMetricsHistory))}recordPageLoad(e,t,r={}){if(!this.isEnabled)return;const s={page:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.general.pageLoads.push(s),this.metrics.general.totalPageLoads++;const i=this.metrics.general.pageLoads.reduce((o,a)=>o+a.duration,0);this.metrics.general.averagePageLoadTime=i/this.metrics.general.pageLoads.length,t>this.thresholds.slowPageLoad&&this.createAlert("slow_page_load",{page:e,duration:t,threshold:this.thresholds.slowPageLoad}),this.metrics.general.pageLoads.length>this.maxMetricsHistory&&(this.metrics.general.pageLoads=this.metrics.general.pageLoads.slice(-this.maxMetricsHistory))}createAlert(e,t){const r={id:Date.now()+Math.random(),type:e,data:t,timestamp:new Date().toISOString(),severity:this.getAlertSeverity(e)};return this.alerts.push(r),this.alerts.length>100&&(this.alerts=this.alerts.slice(-100)),r}getAlertSeverity(e){return{slow_query:"warning",slow_login:"warning",slow_operation:"warning",slow_offline_operation:"warning",slow_page_load:"warning",auth_failure:"error",offline_failure:"error"}[e]||"info"}getMetricsSummary(){return{database:{totalQueries:this.metrics.database.totalQueries,averageQueryTime:Math.round(this.metrics.database.averageQueryTime),slowQueries:this.metrics.database.slowQueries,slowQueryRate:this.metrics.database.totalQueries>0?(this.metrics.database.slowQueries/this.metrics.database.totalQueries*100).toFixed(2):0},authentication:{totalAttempts:this.metrics.authentication.totalAttempts,averageLoginTime:Math.round(this.metrics.authentication.averageLoginTime),failedAttempts:this.metrics.authentication.failedAttempts,successRate:this.metrics.authentication.totalAttempts>0?((this.metrics.authentication.totalAttempts-this.metrics.authentication.failedAttempts)/this.metrics.authentication.totalAttempts*100).toFixed(2):0},offlineQueue:{totalOperations:this.metrics.offlineQueue.totalOperations,averageProcessTime:Math.round(this.metrics.offlineQueue.averageProcessTime),failedOperations:this.metrics.offlineQueue.failedOperations,successRate:this.metrics.offlineQueue.totalOperations>0?((this.metrics.offlineQueue.totalOperations-this.metrics.offlineQueue.failedOperations)/this.metrics.offlineQueue.totalOperations*100).toFixed(2):0},general:{totalPageLoads:this.metrics.general.totalPageLoads,averagePageLoadTime:Math.round(this.metrics.general.averagePageLoadTime)},alerts:{total:this.alerts.length,recent:this.alerts.slice(-10),byType:this.getAlertsByType()}}}getAlertsByType(){const e={};return this.alerts.forEach(t=>{e[t.type]=(e[t.type]||0)+1}),e}clearMetrics(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[]}setEnabled(e){this.isEnabled=e}updateThresholds(e){this.thresholds={...this.thresholds,...e}}exportMetrics(){return{metrics:this.metrics,alerts:this.alerts,thresholds:this.thresholds,exportedAt:new Date().toISOString()}}}const de=new Bq;class zq{constructor(){this.originalMethods={ref:H,get:_e,set:Ie,push:rk,update:YF,remove:KF,onValue:Mw,off:JF,query:a3}}ref(e,t){const r=de.startTimer(`ref_${t}`),s=this.originalMethods.ref(e,t);return de.endTimer(r,"database","ref",{path:t}),s}async get(e){const t=de.startTimer(`get_${e.key||"unknown"}`);try{const r=await this.originalMethods.get(e);return de.endTimer(t,"database","get",{path:e.key||"unknown",success:!0,hasData:r.exists()}),r}catch(r){throw de.endTimer(t,"database","get",{path:e.key||"unknown",success:!1,error:r.message}),r}}async set(e,t){const r=de.startTimer(`set_${e.key||"unknown"}`);try{const s=await this.originalMethods.set(e,t);return de.endTimer(r,"database","set",{path:e.key||"unknown",success:!0,dataSize:JSON.stringify(t).length}),s}catch(s){throw de.endTimer(r,"database","set",{path:e.key||"unknown",success:!1,error:s.message}),s}}push(e){const t=de.startTimer(`push_${e.key||"unknown"}`),r=this.originalMethods.push(e);return de.endTimer(t,"database","push",{path:e.key||"unknown",newKey:r.key}),r}async update(e,t){const r=de.startTimer(`update_${e.key||"unknown"}`);try{const s=await this.originalMethods.update(e,t);return de.endTimer(r,"database","update",{path:e.key||"unknown",success:!0,updateCount:Object.keys(t).length}),s}catch(s){throw de.endTimer(r,"database","update",{path:e.key||"unknown",success:!1,error:s.message}),s}}async remove(e){const t=de.startTimer(`remove_${e.key||"unknown"}`);try{const r=await this.originalMethods.remove(e);return de.endTimer(t,"database","remove",{path:e.key||"unknown",success:!0}),r}catch(r){throw de.endTimer(t,"database","remove",{path:e.key||"unknown",success:!1,error:r.message}),r}}onValue(e,t,r,s){const i=de.startTimer(`onValue_${e.key||"unknown"}`),o=a=>{de.endTimer(i,"database","onValue",{path:e.key||"unknown",success:!0,hasData:a.exists()}),t(a)};return this.originalMethods.onValue(e,o,r,s)}off(e,t){const r=de.startTimer(`off_${e.key||"unknown"}`),s=this.originalMethods.off(e,t);return de.endTimer(r,"database","off",{path:e.key||"unknown"}),s}query(e,...t){const r=de.startTimer(`query_${e.key||"unknown"}`),s=this.originalMethods.query(e,...t);return de.endTimer(r,"database","query",{path:e.key||"unknown",constraintCount:t.length}),s}async trackOperation(e,t,r={}){const s=de.startTimer(e);try{const i=await t();return de.endTimer(s,"database",e,{...r,success:!0}),i}catch(i){throw de.endTimer(s,"database",e,{...r,success:!1,error:i.message}),i}}getDatabaseMetrics(){return de.getMetricsSummary().database}getSlowQueries(e=10){return de.metrics.database.queries.filter(t=>t.duration>de.thresholds.slowQuery).sort((t,r)=>r.duration-t.duration).slice(0,e)}getRecentQueries(e=20){return de.metrics.database.queries.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}}const Ef=new zq;class qq{constructor(){this.originalMethods={signInWithEmailAndPassword:TP,createUserWithEmailAndPassword:bP,signOut:jB,onAuthStateChanged:PB,setPersistence:eS,browserLocalPersistence:Fl,browserSessionPersistence:Zu}}async signInWithEmailAndPassword(e,t,r){const s=de.startTimer(`signIn_${t}`);try{const i=await this.originalMethods.signInWithEmailAndPassword(e,t,r);return de.recordAuthAttempt("signIn",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw de.recordAuthAttempt("signIn",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async createUserWithEmailAndPassword(e,t,r){const s=de.startTimer(`createUser_${t}`);try{const i=await this.originalMethods.createUserWithEmailAndPassword(e,t,r);return de.recordAuthAttempt("createUser",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw de.recordAuthAttempt("createUser",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async signOut(e){const t=de.startTimer("signOut");try{const r=await this.originalMethods.signOut(e);return de.recordAuthAttempt("signOut",t.duration,!0,{method:"signOut"}),r}catch(r){throw de.recordAuthAttempt("signOut",t.duration,!1,{error:r.code,method:"signOut"}),r}}onAuthStateChanged(e,t,r,s){const i=de.startTimer("onAuthStateChanged"),o=u=>{const h=performance.now()-i.startTime;de.recordAuthAttempt("authStateChange",h,!0,{hasUser:!!u,uid:u==null?void 0:u.uid,method:"onAuthStateChanged"}),typeof t=="function"?t(u):t&&t.next&&t.next(u)},a=u=>{const h=performance.now()-i.startTime;de.recordAuthAttempt("authStateChange",h,!1,{error:(u==null?void 0:u.code)||"unknown",method:"onAuthStateChanged"}),u&&typeof u=="function"?u(u):u&&u.error&&u.error(u)},c=()=>{const u=performance.now()-i.startTime;de.recordAuthAttempt("authStateChange",u,!0,{method:"onAuthStateChanged",completed:!0}),s&&typeof s=="function"?s():s&&s.complete&&s.complete()};return this.originalMethods.onAuthStateChanged(e,o,a,c)}async setPersistence(e,t){const r=de.startTimer("setPersistence");try{const s=await this.originalMethods.setPersistence(e,t);return de.recordAuthAttempt("setPersistence",r.duration,!0,{persistence:t===Fl?"local":t===Zu?"session":"unknown"}),s}catch(s){throw de.recordAuthAttempt("setPersistence",r.duration,!1,{error:s.code,persistence:t===Fl?"local":t===Zu?"session":"unknown"}),s}}async trackAuthOperation(e,t,r={}){const s=de.startTimer(e);try{const i=await t();return de.recordAuthAttempt(e,s.duration,!0,r),i}catch(i){throw de.recordAuthAttempt(e,s.duration,!1,{...r,error:i.code||i.message}),i}}getAuthMetrics(){return de.getMetricsSummary().authentication}getFailedAttempts(e=10){return de.metrics.authentication.loginAttempts.filter(t=>!t.success).sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getRecentAttempts(e=20){return de.metrics.authentication.loginAttempts.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getSlowOperations(e=10){return de.metrics.authentication.loginAttempts.filter(t=>t.duration>de.thresholds.slowLogin).sort((t,r)=>r.duration-t.duration).slice(0,e)}getSuccessRateByOperation(){const e={};return de.metrics.authentication.loginAttempts.forEach(t=>{e[t.operation]||(e[t.operation]={total:0,successful:0}),e[t.operation].total++,t.success&&e[t.operation].successful++}),Object.keys(e).forEach(t=>{const r=e[t];r.successRate=r.total>0?(r.successful/r.total*100).toFixed(2):0}),e}}const cl=new qq;class Wq{constructor(){this.isRunning=!1,this.activeTests=new Map,this.testResults=[]}async runStressTest(e,t={}){if(this.isRunning)throw new Error("Stress test already running");this.isRunning=!0;const r=Date.now().toString();try{console.log(` Starting stress test: ${e.name}`);const s=await this.executeScenario(e,t);return this.testResults.push({id:r,scenario:e.name,startTime:new Date().toISOString(),endTime:new Date().toISOString(),duration:s.duration,success:s.success,metrics:s.metrics,errors:s.errors}),console.log(` Stress test completed: ${e.name}`),s}catch(s){throw console.error(` Stress test failed: ${e.name}`,s),s}finally{this.isRunning=!1}}async executeScenario(e,t){const r=performance.now(),s=[],i={operations:0,successfulOperations:0,failedOperations:0,averageResponseTime:0,maxResponseTime:0,minResponseTime:1/0};try{await e.execute(t,{onOperation:(c,u,h)=>{i.operations++,h?i.successfulOperations++:i.failedOperations++,i.averageResponseTime=(i.averageResponseTime+u)/2,i.maxResponseTime=Math.max(i.maxResponseTime,u),i.minResponseTime=Math.min(i.minResponseTime,u)},onError:c=>{s.push({message:c.message,timestamp:new Date().toISOString(),stack:c.stack})}});const a=performance.now()-r;return{success:s.length===0,duration:a,metrics:i,errors:s}}catch(o){const c=performance.now()-r;return s.push({message:o.message,timestamp:new Date().toISOString(),stack:o.stack}),{success:!1,duration:c,metrics:i,errors:s}}}async databaseLoadTest(e={}){const{concurrentUsers:t=10,operationsPerUser:r=5,operationDelay:s=100}=e,i={name:"Database Load Test",execute:async(o,a)=>{const c=[];for(let u=0;u<t;u++){const h=this.simulateUserDatabaseOperations(`test_user_${u}`,r,s,a);c.push(h)}await Promise.all(c)}};return this.runStressTest(i,e)}async simulateUserDatabaseOperations(e,t,r,s){for(let i=0;i<t;i++)try{const o=performance.now(),a=[()=>this.simulateReadOperation(e,i),()=>this.simulateWriteOperation(e,i),()=>this.simulateUpdateOperation(e,i),()=>this.simulateQueryOperation(e,i)],c=a[i%a.length];await c();const u=performance.now()-o;s.onOperation(`db_operation_${i}`,u,!0),r>0&&await new Promise(h=>setTimeout(h,r))}catch(o){const a=performance.now()-startTime;s.onOperation(`db_operation_${i}`,a,!1),s.onError(o)}}async simulateReadOperation(e,t){const r=H($t,`stress_test/${e}/read_${t}`);await _e(r)}async simulateWriteOperation(e,t){const r=H($t,`stress_test/${e}/write_${t}`);await Ie(r,{data:`test_data_${t}`,timestamp:Date.now(),index:t})}async simulateUpdateOperation(e,t){const r=H($t,`stress_test/${e}/update_${t}`);await Ie(r,{data:`updated_data_${t}`,timestamp:Date.now(),index:t,updated:!0})}async simulateQueryOperation(e,t){const r=H($t,`stress_test/${e}`);await _e(r)}async authLoadTest(e={}){const{concurrentAttempts:t=20,delayBetweenAttempts:r=50}=e,s={name:"Authentication Load Test",execute:async(i,o)=>{const a=[];for(let c=0;c<t;c++){const u=this.simulateAuthAttempt(c,r,o);a.push(u)}await Promise.all(a)}};return this.runStressTest(s,e)}async simulateAuthAttempt(e,t,r){try{const s=performance.now();await new Promise(a=>setTimeout(a,Math.random()*1e3+100));const i=performance.now()-s,o=Math.random()>.1;r.onOperation(`auth_attempt_${e}`,i,o),o||r.onError(new Error(`Simulated auth failure ${e}`)),t>0&&await new Promise(a=>setTimeout(a,t))}catch(s){r.onError(s)}}async offlineOnlineTest(e={}){const{transitionCount:t=5,offlineDuration:r=2e3,onlineDuration:s=2e3}=e,i={name:"Offline/Online Transition Test",execute:async(o,a)=>{for(let c=0;c<t;c++)a.onOperation(`offline_transition_${c}`,0,!0),await new Promise(u=>setTimeout(u,r)),a.onOperation(`online_transition_${c}`,0,!0),await new Promise(u=>setTimeout(u,s))}};return this.runStressTest(i,e)}async memoryUsageTest(e={}){const{iterations:t=100,dataSize:r=1e3}=e,s={name:"Memory Usage Test",execute:async(i,o)=>{for(let a=0;a<t;a++){const c=performance.now();new Array(r).fill(0).map((h,f)=>({id:f,data:`test_data_${a}_${f}`,timestamp:Date.now()}));const u=performance.now()-c;o.onOperation(`memory_allocation_${a}`,u,!0)}}};return this.runStressTest(s,e)}getTestResults(e=10){return this.testResults.sort((t,r)=>new Date(r.startTime)-new Date(t.startTime)).slice(0,e)}clearTestResults(){this.testResults=[]}getPerformanceSummary(){return de.getMetricsSummary()}stopAllTests(){this.isRunning=!1,this.activeTests.clear()}isTestRunning(){return this.isRunning}}const mu=new Wq;class Gq{constructor(){this.isInitialized=!1,this.originalFirebaseMethods=null,this.originalAuthMethods=null}initialize(){if(this.isInitialized){console.log("Performance monitoring already initialized");return}try{this.storeOriginalMethods(),de.setEnabled(!0),typeof window<"u"&&(window.performanceMonitor=de,window.databasePerformanceWrapper=Ef,window.authPerformanceWrapper=cl,window.stressTestService=mu,window.performanceIntegrationService=this),this.isInitialized=!0,console.log(" Performance monitoring system initialized")}catch(e){throw console.error(" Failed to initialize performance monitoring:",e),e}}storeOriginalMethods(){}getMetricsSummary(){return de.getMetricsSummary()}getRecentAlerts(e=20){return de.alerts.slice(-e)}clearAllMetrics(){de.clearMetrics(),mu.clearTestResults()}getDatabaseMetrics(){return Ef.getDatabaseMetrics()}getAuthMetrics(){return cl.getAuthMetrics()}getStressTestResults(e=10){return mu.getTestResults(e)}async runStressTest(e,t={}){return await mu.runStressTest(e,t)}getAlertsByType(){return de.getAlertsByType()}getSlowOperations(e="database",t=10){switch(e){case"database":return Ef.getSlowQueries(t);case"auth":return cl.getSlowOperations(t);default:return[]}}getRecentOperations(e="database",t=20){switch(e){case"database":return Ef.getRecentQueries(t);case"auth":return cl.getRecentAttempts(t);default:return[]}}getFailedOperations(e="auth",t=10){switch(e){case"auth":return cl.getFailedAttempts(t);default:return[]}}getSuccessRatesByOperation(e="auth"){switch(e){case"auth":return cl.getSuccessRateByOperation();default:return{}}}setMonitoringEnabled(e){de.setEnabled(e)}updateThresholds(e){de.updateThresholds(e)}exportPerformanceData(){return{metrics:de.exportMetrics(),stressTests:mu.getTestResults(),exportedAt:new Date().toISOString(),version:"1.0.0"}}getPerformanceHealthScore(){const e=this.getMetricsSummary();let t=100;e.database.slowQueryRate>10?t-=20:e.database.slowQueryRate>5&&(t-=10),e.authentication.successRate<90?t-=15:e.authentication.successRate<95&&(t-=5),e.offlineQueue.successRate<90&&(t-=10),e.general.averagePageLoadTime>3e3?t-=15:e.general.averagePageLoadTime>2e3&&(t-=5);const s=this.getRecentAlerts(10).filter(i=>i.severity==="error").length;return t-=s*5,Math.max(0,Math.min(100,t))}getPerformanceRecommendations(){const e=[],t=this.getMetricsSummary();return this.getPerformanceHealthScore()<70&&e.push({type:"critical",message:"Performance health is below 70%. Consider optimizing database queries and reducing load.",action:"Review slow queries and optimize database operations"}),t.database.slowQueryRate>10&&e.push({type:"warning",message:`High slow query rate: ${t.database.slowQueryRate}%. Consider adding database indexes.`,action:"Add database indexes for frequently queried fields"}),t.authentication.successRate<95&&e.push({type:"warning",message:`Low authentication success rate: ${t.authentication.successRate}%. Check for auth issues.`,action:"Review authentication flow and error handling"}),t.general.averagePageLoadTime>2e3&&e.push({type:"info",message:`Slow page load times: ${t.general.averagePageLoadTime}ms average. Consider optimizing assets.`,action:"Optimize images, reduce bundle size, and implement lazy loading"}),t.offlineQueue.failedOperations>0&&e.push({type:"info",message:`${t.offlineQueue.failedOperations} offline operations failed. Check sync reliability.`,action:"Review offline queue error handling and retry logic"}),e}startContinuousMonitoring(e=3e4){this.monitoringInterval&&clearInterval(this.monitoringInterval),this.monitoringInterval=setInterval(()=>{const t=this.getPerformanceHealthScore(),r=this.getPerformanceRecommendations();t<50?console.warn(" Critical performance issues detected:",r):t<80&&console.warn(" Performance warnings:",r)},e)}stopContinuousMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}getSystemStatus(){return{isInitialized:this.isInitialized,isMonitoring:de.isEnabled,healthScore:this.getPerformanceHealthScore(),lastUpdate:new Date().toISOString(),recommendations:this.getPerformanceRecommendations()}}}const Hq=new Gq;class Qq extends yA.Component{constructor(t){super(t);Wh(this,"handleRetry",()=>{this.setState(t=>({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:t.retryCount+1}))});Wh(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}),window.location&&(window.location.href="/")});Wh(this,"handleReportBug",()=>{var r,s,i;const t={errorId:this.state.errorId,message:(r=this.state.error)==null?void 0:r.message,stack:(s=this.state.error)==null?void 0:s.stack,componentStack:(i=this.state.errorInfo)==null?void 0:i.componentStack,userAgent:navigator.userAgent,url:window.location.href,timestamp:new Date().toISOString()};navigator.clipboard.writeText(JSON.stringify(t,null,2)).then(()=>{alert("Error details copied to clipboard. Please share this with the development team.")}).catch(()=>{alert(`Error ID: ${this.state.errorId}

Please report this error to the development team.`)})});this.state={hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorId:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(t,r){this.setState({error:t,errorInfo:r}),this.logError(t,r)}logError(t,r){window.errorLoggingService&&window.errorLoggingService.logError("react_error_boundary",{message:t.message,stack:t.stack,componentStack:r.componentStack,errorId:this.state.errorId,retryCount:this.state.retryCount,severity:"critical"})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-900 via-red-800 to-red-900 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 text-center",children:[l.jsx("div",{className:"flex justify-center mb-4",children:l.jsx(Qd,{className:"w-16 h-16 text-red-500"})}),l.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Oops! Something went wrong"}),l.jsx("p",{className:"text-gray-600 mb-6",children:"We're sorry, but something unexpected happened. Don't worry, your data is safe."}),this.state.errorId&&l.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mb-6",children:[l.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Error ID:"}),l.jsx("p",{className:"font-mono text-xs text-gray-800 break-all",children:this.state.errorId})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("button",{onClick:this.handleRetry,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(Ul,{className:"w-4 h-4"}),l.jsx("span",{children:"Try Again"})]}),l.jsxs("button",{onClick:this.handleReset,className:"w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(_2,{className:"w-4 h-4"}),l.jsx("span",{children:"Go to Home"})]}),l.jsxs("button",{onClick:this.handleReportBug,className:"w-full bg-orange-600 hover:bg-orange-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(kq,{className:"w-4 h-4"}),l.jsx("span",{children:"Report Bug"})]})]}),this.state.retryCount>0&&l.jsxs("p",{className:"text-xs text-gray-500 mt-4",children:["Retry attempt: ",this.state.retryCount]}),!1]})}):this.props.children}}const Kq=({isOpen:n,onClose:e})=>{var V,A,S,E,N,k,b,w,U,q,ve,Te,z,ne,W,Q,Z,me,we,De,Re,vt,Ne,Ae,Pe,Ee,Je,Et,ut,ee,xe,pe,je,be,ge,at,bt,dt,Xe,st,Le,he,Me,Ht,Tt,tn,mn,Qt,xn,nn,pn,un,Kt,Hn,qe,Qe,rn;const[t,r]=D.useState("overview"),[s,i]=D.useState(null),[o,a]=D.useState(!0),[c,u]=D.useState(!0),[h,f]=D.useState(!1),m=async()=>{if(n){f(!0);try{const oe=await g();i(oe)}catch(oe){console.error(" BetaMonitoringDashboard: Error refreshing data:",oe)}finally{f(!1)}}},g=async()=>({timestamp:new Date().toISOString(),userMetrics:await v(),systemHealth:await _(),errorStats:await R(),performanceMetrics:await x(),privacyCompliance:await I(),rateLimiting:await C(),dataBackup:await P()}),v=async()=>{var Dt;if(!window.privacyProtectionService)return null;const oe=window.privacyProtectionService.getPrivacySettings(),lt=window.privacyProtectionService.getAuditLog();return{hasConsent:oe.hasConsent,privacyMode:oe.isPrivacyModeEnabled,dataRetentionDays:oe.dataRetentionDays,auditEvents:lt.length,lastConsentUpdate:(Dt=lt.find(es=>es.eventType==="consent_granted"))==null?void 0:Dt.timestamp}},_=async()=>{if(!window.gracefulDegradationService)return null;const oe=window.gracefulDegradationService.getServiceStatus();return{firebase:oe.firebase,firestore:oe.firestore,offline:oe.offline,degradationMode:oe.degradationMode,fallbackDataCount:oe.fallbackDataCount}},R=async()=>{if(!window.errorLoggingService)return null;const oe=window.errorLoggingService.getErrorQueueStatus(),lt=await window.errorLoggingService.getRecentErrors(10);return{queueLength:oe.queueLength,isOnline:oe.isOnline,errorCounts:oe.errorCounts,recentErrors:lt.slice(0,5),criticalErrors:lt.filter(Dt=>Dt.severity==="critical").length}},x=async()=>{if(!window.performanceIntegrationService)return null;const oe=window.performanceIntegrationService.getMetricsSummary(),lt=window.performanceIntegrationService.getPerformanceHealthScore(),Dt=window.performanceIntegrationService.getPerformanceRecommendations();return{healthScore:lt,database:oe.database,authentication:oe.authentication,offlineQueue:oe.offlineQueue,general:oe.general,recommendations:Dt.slice(0,3)}},I=async()=>{if(!window.privacyProtectionService)return null;const oe=window.privacyProtectionService.getPrivacySettings();return{anonymizationEnabled:oe.anonymizationEnabled,encryptionEnabled:oe.encryptionEnabled,dataRetentionCompliant:oe.dataRetentionDays<=30,consentValid:oe.hasConsent,gdprCompliant:oe.hasConsent&&oe.anonymizationEnabled}},C=async()=>{if(!window.rateLimitingService)return null;const oe=window.rateLimitingService.getRateLimitStatus(),lt=window.rateLimitingService.getSuspiciousUsers(),Dt=window.rateLimitingService.getBlockedUsers();return{isBlocked:(oe==null?void 0:oe.isBlocked)||!1,isSuspicious:(oe==null?void 0:oe.isSuspicious)||!1,suspiciousUserCount:lt.length,blockedUserCount:Dt.length,limits:(oe==null?void 0:oe.limits)||{}}},P=async()=>{if(!window.dataBackupService)return null;const oe=window.dataBackupService.getBackupStatus(),lt=await window.dataBackupService.getBackupHistory(5);return{isEnabled:oe.isEnabled,lastBackupTime:oe.lastBackupTime,backupCount:oe.backupCount,nextBackupIn:oe.nextBackupIn,recentBackups:lt}};D.useEffect(()=>{if(n&&(m(),c)){const oe=setInterval(m,3e4);return()=>clearInterval(oe)}},[n,c]);const $=async()=>{try{const lt={...await g(),exportMetadata:{exportedAt:new Date().toISOString(),version:"1.0.0",privacyMode:o}},Dt=new Blob([JSON.stringify(lt,null,2)],{type:"application/json"}),es=URL.createObjectURL(Dt),An=document.createElement("a");An.href=es,An.download=`beta-monitoring-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(An),An.click(),document.body.removeChild(An),URL.revokeObjectURL(es)}catch(oe){console.error(" BetaMonitoringDashboard: Error exporting data:",oe),alert("Error exporting data. Please try again.")}};return n?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx(uo,{className:"w-6 h-6 text-blue-600"}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Beta Monitoring Dashboard"}),o&&l.jsxs("div",{className:"flex items-center space-x-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs",children:[l.jsx(XT,{className:"w-3 h-3"}),l.jsx("span",{children:"Privacy Mode"})]})]}),l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsxs("button",{onClick:()=>a(!o),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${o?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[o?l.jsx(XT,{className:"w-4 h-4"}):l.jsx(Vq,{className:"w-4 h-4"}),l.jsx("span",{children:o?"Privacy On":"Privacy Off"})]}),l.jsxs("button",{onClick:()=>u(!c),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${c?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[l.jsx(Ul,{className:`w-4 h-4 ${c?"animate-spin":""}`}),l.jsx("span",{children:"Auto Refresh"})]}),l.jsxs("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:[l.jsx("span",{className:"sr-only",children:"Close"}),l.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]})]}),l.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview",icon:yp},{id:"users",label:"Users",icon:S2},{id:"system",label:"System",icon:gp},{id:"errors",label:"Errors",icon:Qd},{id:"privacy",label:"Privacy",icon:uo},{id:"performance",label:"Performance",icon:vp}].map(oe=>{const lt=oe.icon;return l.jsxs("button",{onClick:()=>r(oe.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${t===oe.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[l.jsx(lt,{className:"w-4 h-4"}),l.jsx("span",{children:oe.label})]},oe.id)})}),l.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[h&&l.jsxs("div",{className:"flex items-center justify-center py-8",children:[l.jsx(Ul,{className:"w-6 h-6 animate-spin text-blue-600"}),l.jsx("span",{className:"ml-2 text-gray-600",children:"Loading monitoring data..."})]}),!h&&s&&l.jsxs(l.Fragment,{children:[t==="overview"&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-600",children:"System Health"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[((V=s.performanceMetrics)==null?void 0:V.healthScore)||0,"%"]})]}),l.jsx(gp,{className:"w-8 h-8 text-blue-500"})]})}),l.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-green-600",children:"Privacy Compliance"}),l.jsx("p",{className:"text-2xl font-bold text-green-900",children:(A=s.privacyCompliance)!=null&&A.gdprCompliant?"100%":"0%"})]}),l.jsx(uo,{className:"w-8 h-8 text-green-500"})]})}),l.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Error Rate"}),l.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((S=s.errorStats)==null?void 0:S.criticalErrors)||0})]}),l.jsx(Qd,{className:"w-8 h-8 text-orange-500"})]})}),l.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Backup Status"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(E=s.dataBackup)!=null&&E.isEnabled?"Active":"Inactive"})]}),l.jsx(vp,{className:"w-8 h-8 text-purple-500"})]})})]}),l.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),l.jsxs("div",{className:"flex flex-wrap gap-3",children:[l.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[l.jsx(Ul,{className:"w-4 h-4"}),l.jsx("span",{children:"Refresh Data"})]}),l.jsxs("button",{onClick:$,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[l.jsx(Pq,{className:"w-4 h-4"}),l.jsx("span",{children:"Export Data"})]})]})]})]}),t==="users"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"User Metrics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Privacy Status"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Consent Given:"}),l.jsx("span",{className:`font-medium ${(N=s.userMetrics)!=null&&N.hasConsent?"text-green-600":"text-red-600"}`,children:(k=s.userMetrics)!=null&&k.hasConsent?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Privacy Mode:"}),l.jsx("span",{className:`font-medium ${(b=s.userMetrics)!=null&&b.privacyMode?"text-green-600":"text-red-600"}`,children:(w=s.userMetrics)!=null&&w.privacyMode?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Data Retention:"}),l.jsxs("span",{className:"font-medium",children:[((U=s.userMetrics)==null?void 0:U.dataRetentionDays)||0," days"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Rate Limiting"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"User Blocked:"}),l.jsx("span",{className:`font-medium ${(q=s.rateLimiting)!=null&&q.isBlocked?"text-red-600":"text-green-600"}`,children:(ve=s.rateLimiting)!=null&&ve.isBlocked?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Suspicious Activity:"}),l.jsx("span",{className:`font-medium ${(Te=s.rateLimiting)!=null&&Te.isSuspicious?"text-orange-600":"text-green-600"}`,children:(z=s.rateLimiting)!=null&&z.isSuspicious?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Suspicious Users:"}),l.jsx("span",{className:"font-medium",children:((ne=s.rateLimiting)==null?void 0:ne.suspiciousUserCount)||0})]})]})]})]})]}),t==="system"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Health"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Service Status"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Firebase:"}),l.jsx("span",{className:`font-medium ${((W=s.systemHealth)==null?void 0:W.firebase)==="healthy"?"text-green-600":"text-red-600"}`,children:((Q=s.systemHealth)==null?void 0:Q.firebase)||"Unknown"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Firestore:"}),l.jsx("span",{className:`font-medium ${((Z=s.systemHealth)==null?void 0:Z.firestore)==="healthy"?"text-green-600":"text-red-600"}`,children:((me=s.systemHealth)==null?void 0:me.firestore)||"Unknown"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Offline Mode:"}),l.jsx("span",{className:`font-medium ${(we=s.systemHealth)!=null&&we.offline?"text-orange-600":"text-green-600"}`,children:(De=s.systemHealth)!=null&&De.offline?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Degradation Mode:"}),l.jsx("span",{className:`font-medium ${(Re=s.systemHealth)!=null&&Re.degradationMode?"text-orange-600":"text-green-600"}`,children:(vt=s.systemHealth)!=null&&vt.degradationMode?"Active":"Inactive"})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Data Backup"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Backup Enabled:"}),l.jsx("span",{className:`font-medium ${(Ne=s.dataBackup)!=null&&Ne.isEnabled?"text-green-600":"text-red-600"}`,children:(Ae=s.dataBackup)!=null&&Ae.isEnabled?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Backup Count:"}),l.jsx("span",{className:"font-medium",children:((Pe=s.dataBackup)==null?void 0:Pe.backupCount)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Last Backup:"}),l.jsx("span",{className:"font-medium text-xs",children:(Ee=s.dataBackup)!=null&&Ee.lastBackupTime?new Date(s.dataBackup.lastBackupTime).toLocaleString():"Never"})]})]})]})]})]}),t==="errors"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Error Statistics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Error Queue"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Queue Length:"}),l.jsx("span",{className:"font-medium",children:((Je=s.errorStats)==null?void 0:Je.queueLength)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Online Status:"}),l.jsx("span",{className:`font-medium ${(Et=s.errorStats)!=null&&Et.isOnline?"text-green-600":"text-red-600"}`,children:(ut=s.errorStats)!=null&&ut.isOnline?"Online":"Offline"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Critical Errors:"}),l.jsx("span",{className:"font-medium text-red-600",children:((ee=s.errorStats)==null?void 0:ee.criticalErrors)||0})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Errors"}),l.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:((pe=(xe=s.errorStats)==null?void 0:xe.recentErrors)==null?void 0:pe.length)>0?s.errorStats.recentErrors.map((oe,lt)=>l.jsxs("div",{className:"text-xs p-2 bg-gray-50 rounded",children:[l.jsx("div",{className:"font-medium",children:oe.type}),l.jsx("div",{className:"text-gray-600",children:oe.message}),l.jsx("div",{className:"text-gray-500",children:new Date(oe.timestamp).toLocaleString()})]},lt)):l.jsx("div",{className:"text-gray-500 text-sm",children:"No recent errors"})})]})]})]}),t==="privacy"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Privacy Compliance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Privacy Settings"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Anonymization:"}),l.jsx("span",{className:`font-medium ${(je=s.privacyCompliance)!=null&&je.anonymizationEnabled?"text-green-600":"text-red-600"}`,children:(be=s.privacyCompliance)!=null&&be.anonymizationEnabled?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Encryption:"}),l.jsx("span",{className:`font-medium ${(ge=s.privacyCompliance)!=null&&ge.encryptionEnabled?"text-green-600":"text-red-600"}`,children:(at=s.privacyCompliance)!=null&&at.encryptionEnabled?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Data Retention:"}),l.jsx("span",{className:`font-medium ${(bt=s.privacyCompliance)!=null&&bt.dataRetentionCompliant?"text-green-600":"text-red-600"}`,children:(dt=s.privacyCompliance)!=null&&dt.dataRetentionCompliant?"Compliant":"Non-compliant"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"GDPR Compliant:"}),l.jsx("span",{className:`font-medium ${(Xe=s.privacyCompliance)!=null&&Xe.gdprCompliant?"text-green-600":"text-red-600"}`,children:(st=s.privacyCompliance)!=null&&st.gdprCompliant?"Yes":"No"})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"User Consent"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Consent Valid:"}),l.jsx("span",{className:`font-medium ${(Le=s.privacyCompliance)!=null&&Le.consentValid?"text-green-600":"text-red-600"}`,children:(he=s.privacyCompliance)!=null&&he.consentValid?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Audit Events:"}),l.jsx("span",{className:"font-medium",children:((Me=s.userMetrics)==null?void 0:Me.auditEvents)||0})]})]})]})]})]}),t==="performance"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Metrics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Database Performance"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Queries:"}),l.jsx("span",{className:"font-medium",children:((Tt=(Ht=s.performanceMetrics)==null?void 0:Ht.database)==null?void 0:Tt.totalQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((mn=(tn=s.performanceMetrics)==null?void 0:tn.database)==null?void 0:mn.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Queries:"}),l.jsx("span",{className:"font-medium text-orange-600",children:((xn=(Qt=s.performanceMetrics)==null?void 0:Qt.database)==null?void 0:xn.slowQueries)||0})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Authentication Performance"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Attempts:"}),l.jsx("span",{className:"font-medium",children:((pn=(nn=s.performanceMetrics)==null?void 0:nn.authentication)==null?void 0:pn.totalAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((Kt=(un=s.performanceMetrics)==null?void 0:un.authentication)==null?void 0:Kt.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((qe=(Hn=s.performanceMetrics)==null?void 0:Hn.authentication)==null?void 0:qe.averageLoginTime)||0,"ms"]})]})]})]})]}),((rn=(Qe=s.performanceMetrics)==null?void 0:Qe.recommendations)==null?void 0:rn.length)>0&&l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Recommendations"}),l.jsx("div",{className:"space-y-2",children:s.performanceMetrics.recommendations.map((oe,lt)=>l.jsxs("div",{className:`p-3 rounded-lg ${oe.type==="critical"?"bg-red-50 border border-red-200":oe.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:[l.jsx("div",{className:"font-medium text-sm",children:oe.message}),l.jsx("div",{className:"text-xs text-gray-600 mt-1",children:oe.action})]},lt))})]})]})]})]})]})}):null};class Yq{constructor(){this.backupInterval=null,this.isBackupEnabled=!0,this.maxBackupRetries=3,this.backupRetryDelay=5e3,this.lastBackupTime=null,this.backupHistory=[]}initialize(e){if(!e){console.error(" DataBackupService: User ID required for initialization");return}this.userId=e,this.startAutomaticBackups(),console.log(" DataBackupService: Initialized for user",e)}startAutomaticBackups(){this.backupInterval&&clearInterval(this.backupInterval),this.backupInterval=setInterval(()=>{this.performBackup("scheduled")},30*60*1e3),this.performBackup("initial")}stopAutomaticBackups(){this.backupInterval&&(clearInterval(this.backupInterval),this.backupInterval=null)}async performBackup(e="manual"){if(!this.userId)return console.error(" DataBackupService: User ID not set"),!1;const t=`backup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=Date.now();try{console.log(` DataBackupService: Starting backup ${t} (trigger: ${e})`);const s=await this.collectUserData(),i={id:t,userId:this.userId,timestamp:new Date().toISOString(),trigger:e,dataSize:JSON.stringify(s).length,version:"1.0.0",status:"in_progress"};return await this.storeBackup(i,s),i.status="completed",i.duration=Date.now()-r,await this.updateBackupStatus(i),this.backupHistory.push(i),this.lastBackupTime=new Date,console.log(` DataBackupService: Backup ${t} completed in ${i.duration}ms`),!0}catch(s){console.error(` DataBackupService: Backup ${t} failed:`,s);const i={id:t,userId:this.userId,timestamp:new Date().toISOString(),trigger:e,status:"failed",error:s.message,duration:Date.now()-r};return this.backupHistory.push(i),!1}}async collectUserData(){if(!this.userId)throw new Error("User ID not set - cannot collect user data");const e={profile:null,stats:null,behavioralData:[],settings:null,backupMetadata:{collectedAt:new Date().toISOString(),version:"1.0.0"}};try{const t=H($t,`users/${this.userId}/profile`),r=await _e(t);r.exists()&&(e.profile=r.val());const s=H($t,`users/${this.userId}/stats`),i=await _e(s);i.exists()&&(e.stats=i.val());try{const c=Hi(Cn($s,"behavioral_cravings"),ti("userId","==",this.userId),ap("timestamp","desc"),G$(100)),u=await xc(c);e.behavioralData=u.docs.map(h=>({id:h.id,...h.data()}))}catch(c){console.warn(" DataBackupService: Could not collect behavioral data from Firestore:",c.message),e.behavioralData=[]}const o=H($t,`users/${this.userId}/settings`),a=await _e(o);return a.exists()&&(e.settings=a.val()),e}catch(t){throw console.error(" DataBackupService: Error collecting user data:",t),t}}async storeBackup(e,t){try{const r=H($t,`backups/${this.userId}/${e.id}`);await Ie(r,e);const s={...t,userId:this.userId,timestamp:new Date,backupId:e.id},i=H($t,`backup_data/${this.userId}/${e.id}`);await Ie(i,s);try{await Br(Cn($s,"backup_data"),s),console.log(` DataBackupService: Backup data stored in both databases for ${e.id}`)}catch(o){console.warn(" DataBackupService: Could not store backup in Firestore:",o.message),console.log(` DataBackupService: Backup data stored in Realtime Database for ${e.id}`)}}catch(r){throw console.error(" DataBackupService: Error storing backup:",r),r}}async updateBackupStatus(e){try{const t=H($t,`backups/${this.userId}/${e.id}`);await Ie(t,e)}catch(t){console.error(" DataBackupService: Error updating backup status:",t)}}async restoreFromBackup(e){if(!this.userId)throw new Error("User ID not set");try{console.log(` DataBackupService: Restoring from backup ${e}`);const t=H($t,`backup_data/${this.userId}/${e}`),r=await _e(t);if(!r.exists())throw new Error("Backup data not found");const s=r.val();if(s.profile){const i=H($t,`users/${this.userId}/profile`);await Ie(i,s.profile)}if(s.stats){const i=H($t,`users/${this.userId}/stats`);await Ie(i,s.stats)}if(s.settings){const i=H($t,`users/${this.userId}/settings`);await Ie(i,s.settings)}return console.log(` DataBackupService: Successfully restored from backup ${e}`),!0}catch(t){throw console.error(` DataBackupService: Error restoring from backup ${e}:`,t),t}}async getBackupHistory(e=10){if(!this.userId)return[];try{const t=H($t,`backups/${this.userId}`),r=await _e(t);return r.exists()?Object.values(r.val()).sort((i,o)=>new Date(o.timestamp)-new Date(i.timestamp)).slice(0,e):[]}catch(t){return console.error(" DataBackupService: Error getting backup history:",t),[]}}async cleanupOldBackups(){if(this.userId)try{const e=await this.getBackupHistory(50);if(e.length>10){const t=e.slice(10);for(const r of t){const s=H($t,`backups/${this.userId}/${r.id}`);await Ie(s,null);const i=H($t,`backup_data/${this.userId}/${r.id}`);await Ie(i,null)}console.log(` DataBackupService: Cleaned up ${t.length} old backups`)}}catch(e){console.error(" DataBackupService: Error cleaning up old backups:",e)}}getBackupStatus(){return{isEnabled:this.isBackupEnabled,lastBackupTime:this.lastBackupTime,backupCount:this.backupHistory.length,nextBackupIn:this.backupInterval?"30 minutes":"disabled"}}setBackupEnabled(e){this.isBackupEnabled=e,e&&this.userId?this.startAutomaticBackups():this.stopAutomaticBackups()}async exportBackupData(e){if(!this.userId)throw new Error("User ID not set");try{const t=H($t,`backup_data/${this.userId}/${e}`),r=await _e(t);if(!r.exists())throw new Error("Backup data not found");return{...r.val(),exportMetadata:{exportedAt:new Date().toISOString(),backupId:e,userId:this.userId,version:"1.0.0"}}}catch(t){throw console.error(" DataBackupService: Error exporting backup data:",t),t}}}const eA=new Yq;class Jq{constructor(){this.isPrivacyModeEnabled=!0,this.dataRetentionDays=30,this.anonymizationEnabled=!0,this.consentRequired=!0,this.encryptionEnabled=!0,this.auditLog=[]}initialize(e){this.userId=e,this.setupPrivacyControls(),console.log(" PrivacyProtectionService: Initialized for user",e)}setupPrivacyControls(){this.getUserConsent()||this.requestConsent(),this.setupDataRetentionTimer(),this.setupAnonymization()}getUserConsent(){const e=localStorage.getItem(`privacy_consent_${this.userId}`);return e?JSON.parse(e):null}requestConsent(){const e={dataCollection:!0,analytics:!0,behavioralTracking:!0,dataRetention:this.dataRetentionDays,anonymization:this.anonymizationEnabled,timestamp:new Date().toISOString(),version:"1.0.0"};return localStorage.setItem(`privacy_consent_request_${this.userId}`,JSON.stringify(e)),this.logPrivacyEvent("consent_requested",{userId:this.anonymizeUserId(this.userId),timestamp:new Date().toISOString()}),e}recordConsent(e){const t={...e,grantedAt:new Date().toISOString(),userId:this.userId};localStorage.setItem(`privacy_consent_${this.userId}`,JSON.stringify(t)),this.logPrivacyEvent("consent_granted",{userId:this.anonymizeUserId(this.userId),dataCollection:t.dataCollection,analytics:t.analytics,behavioralTracking:t.behavioralTracking}),console.log(" PrivacyProtectionService: User consent recorded")}anonymizeUserId(e){if(!this.anonymizationEnabled)return e;let t=0;for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);t=(t<<5)-t+s,t=t&t}return`user_${Math.abs(t).toString(36)}`}anonymizeData(e,t=[]){if(!this.anonymizationEnabled)return e;const r={...e};return[...["email","name","phone","address"],...t].forEach(o=>{r[o]&&(r[o]=this.anonymizeString(r[o]))}),r}anonymizeString(e){return!e||typeof e!="string"?e:e.length<=3?"*".repeat(e.length):e.charAt(0)+"*".repeat(e.length-2)+e.charAt(e.length-1)}encryptData(e){if(!this.encryptionEnabled)return e;try{return{encrypted:!0,data:btoa(JSON.stringify(e)),timestamp:new Date().toISOString()}}catch(t){return console.error(" PrivacyProtectionService: Encryption failed:",t),e}}decryptData(e){if(!e.encrypted)return e;try{return JSON.parse(atob(e.data))}catch(t){return console.error(" PrivacyProtectionService: Decryption failed:",t),e}}sanitizeData(e){const t={...e};return["password","ssn","creditCard","bankAccount"].forEach(s=>{delete t[s]}),this.anonymizationEnabled?this.anonymizeData(t):t}setupDataRetentionTimer(){setInterval(()=>{this.cleanupExpiredData()},60*60*1e3)}async cleanupExpiredData(){try{const e=new Date;e.setDate(e.getDate()-this.dataRetentionDays),this.cleanupLocalStorage(e),this.logPrivacyEvent("data_cleanup",{userId:this.anonymizeUserId(this.userId),cutoffDate:e.toISOString(),retentionDays:this.dataRetentionDays}),console.log(" PrivacyProtectionService: Expired data cleaned up")}catch(e){console.error(" PrivacyProtectionService: Error cleaning up expired data:",e)}}cleanupLocalStorage(e){["offline_userData","offline_profileData","offline_cachedStats","behavioral_logs","session_data"].forEach(r=>{try{const s=localStorage.getItem(r);if(s){const i=JSON.parse(s);i.timestamp&&new Date(i.timestamp)<e&&(localStorage.removeItem(r),console.log(` PrivacyProtectionService: Cleaned up expired ${r}`))}}catch(s){console.warn(` PrivacyProtectionService: Error cleaning up ${r}:`,s)}})}setupAnonymization(){const e=console.log;console.log=(...t)=>{const r=t.map(s=>typeof s=="object"&&s!==null?this.anonymizeData(s):s);e.apply(console,r)}}logPrivacyEvent(e,t){const r={id:Date.now().toString(),eventType:e,data:this.anonymizeData(t),timestamp:new Date().toISOString(),userId:this.anonymizeUserId(this.userId)};this.auditLog.push(r),this.auditLog.length>100&&(this.auditLog=this.auditLog.slice(-100)),localStorage.setItem(`privacy_audit_${this.userId}`,JSON.stringify(this.auditLog))}getAuditLog(){return this.auditLog}async exportUserData(){if(!this.userId)throw new Error("User ID not set");try{return{profile:this.getStoredData("profile"),stats:this.getStoredData("stats"),behavioralData:this.getStoredData("behavioralData"),settings:this.getStoredData("settings"),auditLog:this.auditLog,exportMetadata:{exportedAt:new Date().toISOString(),userId:this.anonymizeUserId(this.userId),version:"1.0.0",dataRetentionDays:this.dataRetentionDays}}}catch(e){throw console.error(" PrivacyProtectionService: Error exporting user data:",e),e}}getStoredData(e){try{const t=localStorage.getItem(`offline_${e}`);return t?JSON.parse(t):null}catch(t){return console.warn(` PrivacyProtectionService: Error getting ${e}:`,t),null}}async deleteAllUserData(){if(!this.userId)throw new Error("User ID not set");try{return[`privacy_consent_${this.userId}`,`privacy_consent_request_${this.userId}`,`privacy_audit_${this.userId}`,"offline_userData","offline_profileData","offline_cachedStats","behavioral_logs","session_data"].forEach(t=>{localStorage.removeItem(t)}),this.logPrivacyEvent("data_deletion",{userId:this.anonymizeUserId(this.userId),deletedAt:new Date().toISOString()}),console.log(" PrivacyProtectionService: All user data deleted"),!0}catch(e){throw console.error(" PrivacyProtectionService: Error deleting user data:",e),e}}getPrivacySettings(){return{isPrivacyModeEnabled:this.isPrivacyModeEnabled,dataRetentionDays:this.dataRetentionDays,anonymizationEnabled:this.anonymizationEnabled,consentRequired:this.consentRequired,encryptionEnabled:this.encryptionEnabled,hasConsent:!!this.getUserConsent()}}updatePrivacySettings(e){e.dataRetentionDays&&(this.dataRetentionDays=e.dataRetentionDays),typeof e.anonymizationEnabled=="boolean"&&(this.anonymizationEnabled=e.anonymizationEnabled),typeof e.encryptionEnabled=="boolean"&&(this.encryptionEnabled=e.encryptionEnabled),this.logPrivacyEvent("settings_updated",{userId:this.anonymizeUserId(this.userId),settings:this.anonymizeData(e)})}isDataCollectionAllowed(){const e=this.getUserConsent();return e&&e.dataCollection}isAnalyticsAllowed(){const e=this.getUserConsent();return e&&e.analytics}isBehavioralTrackingAllowed(){const e=this.getUserConsent();return e&&e.behavioralTracking}}const tA=new Jq;class Xq{constructor(){this.errorQueue=[],this.isOnline=navigator.onLine,this.maxRetries=3,this.retryDelay=5e3,this.errorThresholds={critical:5,warning:20,info:100},this.errorCounts={critical:0,warning:0,info:0,lastReset:Date.now()},this.setupErrorHandlers()}initialize(e){this.userId=e,this.setupNetworkListeners(),this.startErrorProcessing(),console.log(" ErrorLoggingService: Initialized for user",e)}setupErrorHandlers(){window.addEventListener("error",e=>{var t;this.logError("javascript_error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:(t=e.error)==null?void 0:t.stack,severity:"critical"})}),window.addEventListener("unhandledrejection",e=>{var t,r;this.logError("unhandled_promise_rejection",{reason:(t=e.reason)==null?void 0:t.toString(),stack:(r=e.reason)==null?void 0:r.stack,severity:"critical"})})}setupNetworkListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.processErrorQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1})}startErrorProcessing(){setInterval(()=>{this.processErrorQueue()},3e4),setInterval(()=>{this.resetErrorCounts()},60*60*1e3)}logError(e,t){const r={id:this.generateErrorId(),type:e,userId:this.userId,timestamp:new Date().toISOString(),severity:t.severity||"info",data:this.sanitizeErrorData(t),userAgent:navigator.userAgent,url:window.location.href,sessionId:this.getSessionId(),version:"1.0.0"};this.shouldLogError(r)&&(this.errorQueue.push(r),this.isOnline&&this.processErrorQueue())}generateErrorId(){return`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}sanitizeErrorData(e){const t={...e};return["password","token","key","secret","ssn","email"].forEach(s=>{t[s]&&(t[s]="[REDACTED]")}),Object.keys(t).forEach(s=>{typeof t[s]=="string"&&t[s].length>1e3&&(t[s]=t[s].substring(0,1e3)+"...[TRUNCATED]")}),t}shouldLogError(e){const t=e.severity,r=this.errorThresholds[t];return r?(Date.now()-this.errorCounts.lastReset>60*60*1e3&&this.resetErrorCounts(),this.errorCounts[t]<r):!0}resetErrorCounts(){this.errorCounts={critical:0,warning:0,info:0,lastReset:Date.now()}}async processErrorQueue(){if(!this.isOnline||this.errorQueue.length===0)return;const e=[...this.errorQueue];this.errorQueue=[];for(const t of e)try{await this.sendErrorToServer(t),this.errorCounts[t.severity]++}catch(r){console.error(" ErrorLoggingService: Failed to send error to server:",r),this.errorQueue.push(t)}}async sendErrorToServer(e){try{if(!this.userId){console.log(" ErrorLoggingService: Skipping error log - no user ID");return}const t={...e,userId:this.userId,timestamp:e.timestamp||new Date,type:e.type||"unknown_error",severity:e.severity||"info"},r=H($t,`error_logs/${this.userId}/${e.id}`);await Ie(r,t);try{await Br(Cn($s,"error_logs"),t),console.log(` ErrorLoggingService: Error ${e.id} sent to both databases`)}catch(s){console.warn(" ErrorLoggingService: Could not store error in Firestore:",s.message),console.log(` ErrorLoggingService: Error ${e.id} sent to Realtime Database`)}}catch(t){throw console.error(" ErrorLoggingService: Error sending to server:",t),t}}getSessionId(){let e=sessionStorage.getItem("session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("session_id",e)),e}logCustomError(e,t,r="info",s={}){this.logError(e,{message:t,severity:r,...s})}logApiError(e,t,r,s,i={}){this.logError("api_error",{endpoint:e,method:t,status:r,response:this.sanitizeErrorData(s),requestData:this.sanitizeErrorData(i),severity:r>=500?"critical":r>=400?"warning":"info"})}logAuthError(e,t,r={}){this.logError("auth_error",{errorType:e,message:t,severity:"critical",...r})}logDatabaseError(e,t,r={}){this.logError("database_error",{operation:e,message:t.message,code:t.code,queryData:this.sanitizeErrorData(r),severity:"critical"})}logPerformanceError(e,t,r,s={}){this.logError("performance_error",{operation:e,duration:t,threshold:r,severity:"warning",...s})}async getErrorStatistics(e=24){try{const t=new Date;t.setHours(t.getHours()-e);const r=Hi(Cn($s,"error_logs"),ti("userId","==",this.userId),ti("timestamp",">=",t.toISOString()),ap("timestamp","desc")),i=(await xc(r)).docs.map(a=>a.data()),o={total:i.length,bySeverity:{critical:i.filter(a=>a.severity==="critical").length,warning:i.filter(a=>a.severity==="warning").length,info:i.filter(a=>a.severity==="info").length},byType:{},recentErrors:i.slice(0,10),timeRange:`${e} hours`};return i.forEach(a=>{o.byType[a.type]=(o.byType[a.type]||0)+1}),o}catch(t){return console.error(" ErrorLoggingService: Error getting statistics:",t),null}}async getRecentErrors(e=20){try{const t=Hi(Cn($s,"error_logs"),ti("userId","==",this.userId),ap("timestamp","desc"),e(e));return(await xc(t)).docs.map(s=>s.data())}catch(t){return console.error(" ErrorLoggingService: Error getting recent errors:",t),[]}}async clearOldErrors(e=7){try{const t=new Date;t.setDate(t.getDate()-e),console.log(` ErrorLoggingService: Would clear errors older than ${e} days`)}catch(t){console.error(" ErrorLoggingService: Error clearing old errors:",t)}}getErrorQueueStatus(){return{queueLength:this.errorQueue.length,isOnline:this.isOnline,errorCounts:this.errorCounts,thresholds:this.errorThresholds}}setErrorThresholds(e){this.errorThresholds={...this.errorThresholds,...e}}async exportErrorData(e=24){try{const t=await this.getRecentErrors(1e3),r=new Date;r.setHours(r.getHours()-e);const s=t.filter(i=>new Date(i.timestamp)>=r);return{errors:s,exportMetadata:{exportedAt:new Date().toISOString(),userId:this.userId,timeRange:`${e} hours`,totalErrors:s.length,version:"1.0.0"}}}catch(t){throw console.error(" ErrorLoggingService: Error exporting error data:",t),t}}}const nA=new Xq;class Zq{constructor(){this.serviceStatus={firebase:"unknown",firestore:"unknown",auth:"unknown",offline:!1},this.fallbackData=new Map,this.retryAttempts=new Map,this.maxRetries=3,this.retryDelay=2e3,this.degradationMode=!1,this.setupServiceMonitoring()}initialize(e){this.userId=e,this.setupFallbackData(),this.startServiceHealthChecks(),console.log(" GracefulDegradationService: Initialized for user",e)}setupServiceMonitoring(){window.addEventListener("online",()=>{this.serviceStatus.offline=!1,this.attemptServiceRecovery()}),window.addEventListener("offline",()=>{this.serviceStatus.offline=!0,this.enableDegradationMode()}),this.monitorFirebaseConnection()}monitorFirebaseConnection(){setInterval(async()=>{await this.checkFirebaseHealth()},3e4)}async checkFirebaseHealth(){try{const e=H($t,"health_check");await _e(e),this.serviceStatus.firebase="healthy"}catch(e){this.serviceStatus.firebase="unhealthy",this.handleServiceFailure("firebase",e)}try{if(!this.userId){console.log(" GracefulDegradationService: Skipping Firestore health check - no user ID"),this.serviceStatus.firestore="unknown";return}const e=Cn($s,"health_check"),t={userId:this.userId,timestamp:new Date,service:"health_check",status:"testing"};await(await Br(e,t)).delete(),this.serviceStatus.firestore="healthy"}catch(e){e.code==="permission-denied"||e.message.includes("Missing or insufficient permissions")?(console.log(" GracefulDegradationService: Firestore health check skipped due to permissions"),this.serviceStatus.firestore="unknown"):(this.serviceStatus.firestore="unhealthy",this.handleServiceFailure("firestore",e))}}handleServiceFailure(e,t){if(t.code==="permission-denied"||t.message.includes("Missing or insufficient permissions")){console.log(` GracefulDegradationService: ${e} service access denied - not treating as failure`);return}console.warn(` GracefulDegradationService: ${e} service failure:`,t),(e==="firebase"||e==="firestore")&&this.enableDegradationMode(),window.errorLoggingService&&window.errorLoggingService.logError("service_failure",{service:e,error:t.message,severity:"warning"})}enableDegradationMode(){this.degradationMode=!0,console.log(" GracefulDegradationService: Degradation mode enabled"),this.notifyUserOfDegradation()}disableDegradationMode(){this.degradationMode=!1,console.log(" GracefulDegradationService: Degradation mode disabled")}notifyUserOfDegradation(){window.showQuickActionPopup&&window.showQuickActionPopup("Service Temporarily Unavailable","Some features may be limited while we restore full service. Your data is safe.","info")}setupFallbackData(){this.loadCachedData()}loadCachedData(){try{const e={profile:this.getCachedData("offline_profileData"),stats:this.getCachedData("offline_cachedStats"),userData:this.getCachedData("offline_userData")};Object.entries(e).forEach(([t,r])=>{r&&this.fallbackData.set(t,r)}),console.log(" GracefulDegradationService: Cached data loaded")}catch(e){console.error(" GracefulDegradationService: Error loading cached data:",e)}}getCachedData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.warn(` GracefulDegradationService: Error getting cached ${e}:`,t),null}}startServiceHealthChecks(){this.checkFirebaseHealth(),setInterval(()=>{this.checkFirebaseHealth()},6e4)}async attemptServiceRecovery(){console.log(" GracefulDegradationService: Attempting service recovery..."),await this.checkFirebaseHealth(),this.serviceStatus.firebase==="healthy"&&this.serviceStatus.firestore==="healthy"&&(this.disableDegradationMode(),this.syncCachedData())}async syncCachedData(){if(console.log(" GracefulDegradationService: Syncing cached data..."),window.offlineManager)try{await window.offlineManager.syncOperations(),console.log(" GracefulDegradationService: Cached data synced")}catch(e){console.error(" GracefulDegradationService: Error syncing cached data:",e)}}async getDataWithFallback(e,t,r){try{if(!this.degradationMode&&this.serviceStatus.firebase==="healthy"){const i=H($t,t),o=await _e(i);if(o.exists()){const a=o.val();return this.fallbackData.set(r,a),a}}const s=this.fallbackData.get(r);return s?(console.log(` GracefulDegradationService: Using cached ${e} data`),s):this.getDefaultData(e)}catch(s){console.warn(` GracefulDegradationService: Error getting ${e}:`,s);const i=this.fallbackData.get(r);return i||this.getDefaultData(e)}}async setDataWithFallback(e,t,r,s){try{if(!this.degradationMode&&this.serviceStatus.firebase==="healthy"){const i=H($t,t);await Ie(i,r),console.log(` GracefulDegradationService: ${e} data saved to Firebase`)}else console.log(` GracefulDegradationService: ${e} data cached (offline mode)`);return this.fallbackData.set(s,r),this.cacheData(s,r),!0}catch(i){return console.warn(` GracefulDegradationService: Error setting ${e}:`,i),this.fallbackData.set(s,r),this.cacheData(s,r),!1}}cacheData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(r){console.warn(` GracefulDegradationService: Error caching ${e}:`,r)}}getDefaultData(e){return{profile:{heroName:"Anonymous Hero",archetype:"DETERMINED",avatar:null,quitDate:new Date().toISOString(),triggers:[],dailyPatterns:[],copingStrategies:[]},stats:{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0,experiencePoints:0},userData:{email:"",displayName:"Anonymous User",photoURL:null,lastLogin:new Date().toISOString()}}[e]||{}}getServiceStatus(){return{...this.serviceStatus,degradationMode:this.degradationMode,fallbackDataCount:this.fallbackData.size,retryAttempts:Object.fromEntries(this.retryAttempts)}}isServiceAvailable(e){return this.serviceStatus.offline?!1:this.serviceStatus[e]==="healthy"}async getUserProfile(){return this.getDataWithFallback("profile",`users/${this.userId}/profile`,"profile")}async setUserProfile(e){return this.setDataWithFallback("profile",`users/${this.userId}/profile`,e,"profile")}async getUserStats(){return this.getDataWithFallback("stats",`users/${this.userId}/stats`,"stats")}async setUserStats(e){return this.setDataWithFallback("stats",`users/${this.userId}/stats`,e,"stats")}async getBehavioralData(e=10){try{if(!this.degradationMode&&this.serviceStatus.firestore==="healthy"){const r=Hi(Cn($s,"behavioral_cravings"),ti("userId","==",this.userId),e(e));return(await xc(r)).docs.map(i=>({id:i.id,...i.data()}))}return(this.fallbackData.get("behavioralData")||[]).slice(0,e)}catch(t){return console.warn(" GracefulDegradationService: Error getting behavioral data:",t),this.fallbackData.get("behavioralData")||[]}}async setBehavioralData(e){try{if(!this.degradationMode&&this.serviceStatus.firestore==="healthy"){const r={...e,userId:this.userId,timestamp:e.timestamp||new Date};await Br(Cn($s,"behavioral_cravings"),r),console.log(" GracefulDegradationService: Behavioral data saved to Firestore")}else console.log(" GracefulDegradationService: Behavioral data cached (offline mode)");const t=this.fallbackData.get("behavioralData")||[];return t.unshift(e),this.fallbackData.set("behavioralData",t.slice(0,100)),!0}catch(t){return console.warn(" GracefulDegradationService: Error setting behavioral data:",t),!1}}async forceRecovery(){console.log(" GracefulDegradationService: Forcing service recovery..."),await this.checkFirebaseHealth(),await this.attemptServiceRecovery()}}const rA=new Zq;class e8{constructor(){this.rateLimits={apiCalls:{limit:60,window:6e4},authAttempts:{limit:5,window:6e4},databaseWrites:{limit:30,window:6e4},databaseReads:{limit:100,window:6e4},behavioralLogs:{limit:50,window:36e5},stressTests:{limit:3,window:36e5},errorReports:{limit:10,window:6e4},profileUpdates:{limit:10,window:36e5}},this.userLimits=new Map,this.globalLimits=new Map,this.blockedUsers=new Set,this.suspiciousActivity=new Map,this.setupRateLimitCleanup()}initialize(e){this.userId=e,this.initializeUserLimits(),console.log(" RateLimitingService: Initialized for user",e)}initializeUserLimits(){if(!this.userId)return;const e={apiCalls:[],authAttempts:[],databaseWrites:[],databaseReads:[],behavioralLogs:[],stressTests:[],errorReports:[],profileUpdates:[]};this.userLimits.set(this.userId,e)}isAllowed(e,t=null){const r=t||this.userId;if(!r)return console.error(" RateLimitingService: User ID required for rate limiting"),!1;if(this.blockedUsers.has(r))return console.warn(` RateLimitingService: User ${r} is blocked`),!1;if(this.isSuspiciousUser(r))return console.warn(` RateLimitingService: User ${r} has suspicious activity`),!1;const s=this.rateLimits[e];if(!s)return console.warn(` RateLimitingService: Unknown action: ${e}`),!0;const i=this.userLimits.get(r);if(!i)return this.initializeUserLimits(),!0;const o=Date.now(),a=o-s.window;return i[e]=i[e].filter(c=>c>a),i[e].length>=s.limit?(this.recordRateLimitExceeded(e,r),!1):(i[e].push(o),this.userLimits.set(r,i),!0)}recordRateLimitExceeded(e,t){console.warn(` RateLimitingService: Rate limit exceeded for ${e} by user ${t}`),window.errorLoggingService&&window.errorLoggingService.logError("rate_limit_exceeded",{action:e,userId:t,severity:"warning"}),this.trackSuspiciousActivity(t,e)}trackSuspiciousActivity(e,t){this.suspiciousActivity.has(e)||this.suspiciousActivity.set(e,[]);const r=this.suspiciousActivity.get(e);r.push({action:t,timestamp:Date.now()}),r.length>10&&r.splice(0,r.length-10),this.suspiciousActivity.set(e,r),this.checkForBlocking(e)}checkForBlocking(e){const t=this.suspiciousActivity.get(e)||[],r=Date.now();t.filter(i=>r-i.timestamp<3e5).length>5&&this.blockUser(e,"Excessive rate limit violations")}blockUser(e,t){this.blockedUsers.add(e),console.warn(` RateLimitingService: User ${e} blocked. Reason: ${t}`),window.errorLoggingService&&window.errorLoggingService.logError("user_blocked",{userId:e,reason:t,severity:"critical"});const r=JSON.parse(localStorage.getItem("blocked_users")||"[]");r.push({userId:e,reason:t,timestamp:Date.now()}),localStorage.setItem("blocked_users",JSON.stringify(r))}unblockUser(e){this.blockedUsers.delete(e),console.log(` RateLimitingService: User ${e} unblocked`);const r=JSON.parse(localStorage.getItem("blocked_users")||"[]").filter(s=>s.userId!==e);localStorage.setItem("blocked_users",JSON.stringify(r))}isSuspiciousUser(e){const t=this.suspiciousActivity.get(e)||[],r=Date.now();return t.filter(i=>r-i.timestamp<6e5).length>3}getRemainingAttempts(e,t=null){const r=t||this.userId;if(!r)return 0;const s=this.rateLimits[e];if(!s)return 0;const i=this.userLimits.get(r);if(!i)return s.limit;const a=Date.now()-s.window;return i[e]=i[e].filter(c=>c>a),Math.max(0,s.limit-i[e].length)}getTimeUntilReset(e,t=null){const r=t||this.userId;if(!r)return 0;const s=this.rateLimits[e];if(!s)return 0;const i=this.userLimits.get(r);if(!i||i[e].length===0)return 0;const a=Math.min(...i[e])+s.window;return Math.max(0,a-Date.now())}setupRateLimitCleanup(){setInterval(()=>{this.cleanupOldEntries()},5*60*1e3),this.loadBlockedUsers()}cleanupOldEntries(){const e=Date.now();this.userLimits.forEach((t,r)=>{Object.keys(t).forEach(s=>{const i=this.rateLimits[s];if(i){const o=e-i.window;t[s]=t[s].filter(a=>a>o)}})}),this.suspiciousActivity.forEach((t,r)=>{const s=t.filter(i=>e-i.timestamp<36e5);s.length===0?this.suspiciousActivity.delete(r):this.suspiciousActivity.set(r,s)})}loadBlockedUsers(){try{const e=JSON.parse(localStorage.getItem("blocked_users")||"[]"),t=Date.now();e.forEach(r=>{t-r.timestamp<24*60*60*1e3&&this.blockedUsers.add(r.userId)})}catch(e){console.error(" RateLimitingService: Error loading blocked users:",e)}}getRateLimitStatus(e=null){const t=e||this.userId;if(!t)return null;const r={userId:t,isBlocked:this.blockedUsers.has(t),isSuspicious:this.isSuspiciousUser(t),limits:{}};return Object.keys(this.rateLimits).forEach(s=>{r.limits[s]={remaining:this.getRemainingAttempts(s,t),resetIn:this.getTimeUntilReset(s,t),limit:this.rateLimits[s].limit,window:this.rateLimits[s].window}}),r}updateRateLimits(e){this.rateLimits={...this.rateLimits,...e},console.log(" RateLimitingService: Rate limits updated")}resetUserLimits(e=null){const t=e||this.userId;t&&(this.userLimits.delete(t),this.suspiciousActivity.delete(t),this.unblockUser(t),console.log(` RateLimitingService: Limits reset for user ${t}`))}getSuspiciousUsers(){const e=[];return this.suspiciousActivity.forEach((t,r)=>{t.length>0&&e.push({userId:r,activityCount:t.length,lastActivity:Math.max(...t.map(s=>s.timestamp)),activities:t.slice(-5)})}),e.sort((t,r)=>r.activityCount-t.activityCount)}getBlockedUsers(){return Array.from(this.blockedUsers)}canPerformAction(e,t=null){var a;const r=t||this.userId;if(!r)return{allowed:!1,reason:"User ID required",remaining:0,resetIn:0};const s=this.isAllowed(e,r),i=this.getRemainingAttempts(e,r),o=this.getTimeUntilReset(e,r);return{allowed:s,reason:s?"Allowed":"Rate limit exceeded",remaining:i,resetIn:o,limit:((a=this.rateLimits[e])==null?void 0:a.limit)||0}}}const sA=new e8,t8=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=D.useState("signin"),[s,i]=D.useState(""),[o,a]=D.useState(""),[c,u]=D.useState(""),[h,f]=D.useState(!1),[m,g]=D.useState(!1),[v,_]=D.useState(""),[R,x]=D.useState(""),[I,C]=D.useState(!1);D.useEffect(()=>()=>{m&&g(!1)},[m]);const P=new Ys;P.addScope("email"),P.addScope("profile"),P.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const $=()=>{i(""),a(""),u(""),_(""),x("")},V=async()=>{f(!0),g(!0),_("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:P.scopes,customParameters:P.customParameters});const k=hz(ra,P),b=new Promise((U,q)=>{setTimeout(()=>q(new Error("Popup timeout - please try again")),6e4)}),w=await Promise.race([k,b]);if(w&&w.user){const U=w.user;console.log("Google sign-in successful for:",U.email,"UID:",U.uid),console.log("User display name:",U.displayName),console.log("User photo URL:",U.photoURL),await new Promise(q=>setTimeout(q,800)),n(U)}else throw new Error("No user data received from Google authentication")}catch(k){console.error("Google sign-in error:",k),k.code==="auth/popup-closed-by-user"?_("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):k.code==="auth/popup-blocked"?_("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):k.code==="auth/cancelled-popup-request"?_("Google sign-in was cancelled. Please try again and complete the authentication process."):k.code==="auth/account-exists-with-different-credential"?_("An account already exists with this email using a different sign-in method. Please use email/password instead."):k.message==="Popup timeout - please try again"?_("Google sign-in popup timed out. Please try again and complete the account selection quickly."):k.code==="auth/network-request-failed"?_("Network error during Google sign-in. Please check your internet connection and try again."):k.code==="auth/operation-not-allowed"?_("Google sign-in is not enabled for this app. Please contact support."):_(N(k.code))}finally{f(!1),g(!1)}},A=async k=>{k.preventDefault(),f(!0),_("");try{const w=(await TP(ra,s,o)).user;console.log("Email sign-in successful for:",w.email),n(w)}catch(b){console.error("Email sign-in error:",b),_(N(b.code))}finally{f(!1)}},S=async k=>{if(k.preventDefault(),f(!0),_(""),o!==c){_("Passwords do not match"),f(!1);return}if(o.length<6){_("Password must be at least 6 characters long"),f(!1);return}try{const w=(await bP(ra,s,o)).user;console.log("Email sign-up successful for:",w.email),await EB(w),n(w)}catch(b){console.error("Email sign-up error:",b),_(N(b.code))}finally{f(!1)}},E=async k=>{if(k.preventDefault(),!s){_("Please enter your email address");return}f(!0),_("");try{await xB(ra,s),x("Password reset email sent! Check your inbox.")}catch(b){console.error("Password reset error:",b),_(N(b.code))}finally{f(!1)}},N=k=>{switch(k){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return I?l.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),l.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),l.jsxs("form",{onSubmit:E,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"email",type:"email",value:s,onChange:k=>i(k.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),v&&l.jsx("div",{className:"text-red-400 text-sm",children:v}),R&&l.jsx("div",{className:"text-green-400 text-sm",children:R}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{type:"button",onClick:()=>{C(!1),_(""),x("")},className:"flex-1 px-4 py-3 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 min-h-[44px]",children:"Back to Login"}),l.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-3 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Sending...":"Send Reset Link"})]})]})]})}):l.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),l.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),l.jsxs("div",{children:[m&&l.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[l.jsx("div",{className:"animate-pulse mr-2",children:""}),"Google popup is open - please complete your account selection"]})}),l.jsx("button",{onClick:V,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):l.jsxs(l.Fragment,{children:[l.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[l.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),l.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),l.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),l.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),l.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:m?l.jsx("span",{className:"text-blue-400 font-medium",children:" Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),v&&l.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[l.jsx("div",{className:"text-red-300 text-sm mb-2",children:v}),v.includes("Google sign-in")&&!m&&l.jsx("button",{onClick:V,disabled:h,className:"w-full px-3 py-3 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50 min-h-[44px]",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 flex items-center",children:l.jsx("div",{className:"w-full border-t border-gray-600"})}),l.jsx("div",{className:"relative flex justify-center text-sm",children:l.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),l.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[l.jsx("button",{onClick:()=>{r("signin"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),l.jsx("button",{onClick:()=>{r("signup"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&l.jsxs("form",{onSubmit:A,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"signin-email",type:"email",value:s,onChange:k=>i(k.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),l.jsx("input",{id:"signin-password",type:"password",value:o,onChange:k=>a(k.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("button",{type:"button",onClick:()=>C(!0),className:"text-sm text-blue-400 hover:text-blue-300 py-2 px-2 min-h-[44px] min-w-[44px]",children:"Forgot your password?"})}),v&&l.jsx("div",{className:"text-red-400 text-sm",children:v}),l.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&l.jsxs("form",{onSubmit:S,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"signup-email",type:"email",value:s,onChange:k=>i(k.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),l.jsx("input",{id:"signup-password",type:"password",value:o,onChange:k=>a(k.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),l.jsx("input",{id:"confirm-password",type:"password",value:c,onChange:k=>u(k.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),v&&l.jsx("div",{className:"text-red-400 text-sm",children:v}),R&&l.jsx("div",{className:"text-green-400 text-sm",children:R}),l.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Creating account...":"Create Account"})]})]})})},n8=({offlineManager:n})=>{const[e,t]=D.useState(navigator.onLine),[r,s]=D.useState(!1),[i,o]=D.useState(0),[a,c]=D.useState(!1);return D.useEffect(()=>{const u=()=>{t(!0),s(!1),console.log(" Connection restored"),n&&i>0&&(c(!0),setTimeout(()=>{c(!1),o(0)},2e3))},h=()=>{t(!1),s(!0),console.log(" Connection lost")};window.addEventListener("online",u),window.addEventListener("offline",h),t(navigator.onLine);const f=async()=>{if(n)try{const g=await n.getQueuedActionsCount();o(g)}catch(g){console.warn("Could not get queued actions count:",g)}};f();const m=setInterval(f,5e3);return()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),clearInterval(m)}},[n,i]),e&&a?l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white p-3 text-center shadow-lg",children:l.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[l.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),l.jsxs("span",{className:"font-medium",children:["Syncing ",i," offline actions..."]})]})}):e&&!a&&i===0||e?null:l.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[l.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),l.jsxs("span",{className:"font-medium",children:["You're offline. Some features may be limited.",i>0&&` (${i} actions queued)`]}),l.jsx("button",{onClick:()=>s(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&l.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[l.jsx("p",{className:"mb-2",children:"While offline, you can:"}),l.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[l.jsx("li",{children:" View your current stats and progress"}),l.jsx("li",{children:" Track habits and cravings"}),l.jsx("li",{children:" Log water intake and breathing exercises"}),l.jsx("li",{children:" Record craving assessments and resistance"}),l.jsx("li",{children:" Play distraction games"}),l.jsx("li",{children:" View your profile information"})]}),l.jsxs("p",{className:"mt-2 text-yellow-200",children:["All changes will sync automatically when you're back online.",i>0&&l.jsxs("span",{className:"block mt-1 font-medium",children:[" ",i," action",i!==1?"s":""," queued for sync"]})]})]})]})},r8=({offlineManager:n})=>{const[e,t]=D.useState({isOnline:navigator.onLine,queuedOperations:0,failedOperations:0,syncInProgress:!1,lastSyncTime:null}),[r,s]=D.useState(!1),[i,o]=D.useState(0),[a,c]=D.useState(null);D.useEffect(()=>{if(!n||!n.progressManager)return;const _=C=>{o(C.progress),c(C.currentOperation)},R=C=>{t(P=>({...P,syncInProgress:C.status==="syncing",lastSyncTime:C.endTime||P.lastSyncTime}))};n.progressManager.addProgressCallback(_),n.progressManager.addStatusCallback(R);const x=()=>{const C=n.getStatus();t(P=>({...P,isOnline:C.isOnline,queuedOperations:C.queue.queuedOperations,failedOperations:C.queue.failedOperations,syncInProgress:C.queue.syncInProgress}))};x();const I=setInterval(x,1e3);return()=>{n&&n.progressManager&&(n.progressManager.removeProgressCallback(_),n.progressManager.removeStatusCallback(R)),clearInterval(I)}},[n]);const u=async()=>{n&&await n.retryFailedOperations()},h=async()=>{n&&await n.attemptSync()},f=_=>{if(!_)return"Never";const x=Date.now()-_,I=Math.floor(x/6e4),C=Math.floor(I/60),P=Math.floor(C/24);return P>0?`${P}d ago`:C>0?`${C}h ago`:I>0?`${I}m ago`:"Just now"},m=()=>e.isOnline?e.failedOperations>0?"text-red-600":e.queuedOperations>0?"text-blue-600":"text-green-600":"text-yellow-600",g=()=>e.isOnline?e.syncInProgress?"":e.failedOperations>0?"":e.queuedOperations>0?"":"":"",v=()=>e.isOnline?e.syncInProgress?"Syncing...":e.failedOperations>0?`${e.failedOperations} failed`:e.queuedOperations>0?`${e.queuedOperations} queued`:"Synced":"Offline";return n?l.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[l.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${m()}`,onClick:()=>s(!r),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:g()}),l.jsx("div",{className:"text-sm font-medium",children:v()}),e.syncInProgress&&l.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"})]}),e.syncInProgress&&l.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:l.jsx("div",{className:"bg-current h-1 rounded-full transition-all duration-300",style:{width:`${i}%`}})})]}),r&&l.jsxs("div",{className:"absolute top-16 right-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsx("h3",{className:"font-semibold text-gray-800",children:"Sync Status"}),l.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:""})]}),l.jsxs("div",{className:"mb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("span",{className:`w-2 h-2 rounded-full ${e.isOnline?"bg-green-500":"bg-yellow-500"}`}),l.jsx("span",{className:"text-sm font-medium",children:e.isOnline?"Online":"Offline"})]}),l.jsxs("div",{className:"text-xs text-gray-500",children:["Last sync: ",f(e.lastSyncTime)]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Queue Status"}),l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Queued:"}),l.jsx("span",{className:"text-blue-600",children:e.queuedOperations})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Failed:"}),l.jsx("span",{className:"text-red-600",children:e.failedOperations})]})]})]}),a&&l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Current Operation"}),l.jsxs("div",{className:"text-xs text-gray-600",children:[a.type," - ",Math.round(i),"%"]})]}),l.jsxs("div",{className:"flex gap-2",children:[e.failedOperations>0&&l.jsx("button",{onClick:u,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Retry Failed"}),e.queuedOperations>0&&e.isOnline&&l.jsx("button",{onClick:h,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Sync Now"})]}),l.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:l.jsx("div",{className:"text-xs text-gray-500",children:l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Success Rate:"}),l.jsxs("span",{children:[n.getStatus().sync.successRate,"%"]})]})})})]})]}):null},s8=({sessionManager:n,authGuard:e})=>{const[t,r]=D.useState({isActive:!1,duration:0,timeUntilTimeout:0,timeUntilWarning:0}),[s,i]=D.useState(!1),[o,a]=D.useState(!1);D.useEffect(()=>{if(!n)return;const _=()=>{const x=n.getSessionInfo();r(x),a(x.timeUntilWarning<=0&&x.timeUntilTimeout>0)};_();const R=setInterval(_,1e3);return()=>clearInterval(R)},[n]);const c=_=>{if(_<=0)return"0:00";const R=Math.floor(_/60),x=_%60;return`${R}:${x.toString().padStart(2,"0")}`},u=_=>_<60?`${_}s`:_<3600?`${Math.floor(_/60)}m`:`${Math.floor(_/3600)}h ${Math.floor(_%3600/60)}m`,h=()=>t.isActive?o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600":"text-gray-500",f=()=>t.isActive?o?"":t.timeUntilTimeout<=60?"":"":"",m=()=>t.isActive?o?"Warning":t.timeUntilTimeout<=60?"Expiring":"Active":"Inactive",g=()=>{n&&n.extendSession()},v=async()=>{if(e)try{await e.logout()}catch(_){console.error("Logout failed:",_)}};return t.isActive?l.jsxs("div",{className:"fixed top-4 left-4 z-50",children:[l.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${h()}`,onClick:()=>i(!s),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:f()}),l.jsx("div",{className:"text-sm font-medium",children:m()}),t.timeUntilTimeout>0&&l.jsx("div",{className:"text-xs opacity-75",children:c(t.timeUntilTimeout)})]}),t.timeUntilTimeout>0&&l.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:l.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${o?"bg-yellow-500":t.timeUntilTimeout<=60?"bg-red-500":"bg-green-500"}`,style:{width:`${Math.max(0,Math.min(100,t.timeUntilTimeout/1800*100))}%`}})})]}),s&&l.jsxs("div",{className:"absolute top-16 left-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsx("h3",{className:"font-semibold text-gray-800",children:"Session Status"}),l.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:""})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Session Duration"}),l.jsx("div",{className:"text-lg font-mono text-gray-900",children:u(t.duration)})]}),t.timeUntilTimeout>0&&l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Time Until Timeout"}),l.jsx("div",{className:`text-lg font-mono ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-gray-900"}`,children:c(t.timeUntilTimeout)})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Status"}),l.jsx("div",{className:`text-sm font-medium ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600"}`,children:m()})]}),l.jsxs("div",{className:"flex gap-2",children:[o&&l.jsx("button",{onClick:g,className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Extend Session"}),l.jsx("button",{onClick:v,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Logout"})]}),e&&l.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:l.jsxs("div",{className:"text-xs text-gray-500",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Operations:"}),l.jsx("span",{children:e.getOperationStats().total})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Success Rate:"}),l.jsxs("span",{children:[e.getOperationStats().successRate,"%"]})]})]})})]})]}):null},i8=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>l.jsxs("div",{className:"p-4 sm:p-6",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),l.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your breathing session"})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:[l.jsxs("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[l.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[l.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:l.jsx("span",{className:"text-lg",children:""})}),l.jsx("div",{className:"text-white font-semibold text-sm",children:"BREATHING RATE"})]}),l.jsx("div",{className:"text-white font-bold text-sm",children:n.name}),l.jsxs("div",{className:"text-slate-400 text-xs",children:[n.inhale,"s | ",n.exhale,"s"]})]}),l.jsxs("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[l.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[l.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:l.jsx("span",{className:"text-lg",children:""})}),l.jsx("div",{className:"text-white font-semibold text-sm",children:"DURATION"})]}),l.jsxs("div",{className:"text-white font-bold text-sm",children:[e,"min."]}),l.jsx("div",{className:"text-slate-400 text-xs",children:"Total time"})]})]}),l.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-base sm:text-lg py-3 sm:py-4 px-4 sm:px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl min-h-[44px]",children:"START EXERCISE"}),l.jsx("div",{className:"mt-4 sm:mt-6 text-center",children:l.jsx("p",{className:"text-slate-400 text-xs sm:text-sm",children:"Find a comfortable position and prepare to relax"})})]}),o8=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return l.jsxs("div",{className:"p-8",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),l.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),l.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>l.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"text-left",children:[l.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),l.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&l.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:l.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:l.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),l.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},a8=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=D.useState(n),i=2,o=10;D.useEffect(()=>{s(n)},[n]);const a=f=>{const m=parseInt(f.target.value);s(m),navigator.vibrate&&navigator.vibrate(50),console.log(` Duration picker: Selected ${m} minutes`)},c=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return l.jsxs("div",{className:"p-8",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),l.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),l.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),l.jsx("div",{className:"mb-8",children:l.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4",autoComplete:"off"})}),l.jsx("button",{onClick:c,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),l.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},l8=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=D.useState(e*60),[m,g]=D.useState("inhale"),[v,_]=D.useState(0),[R,x]=D.useState(!1),[I,C]=D.useState(.1),[P,$]=D.useState(!1),[V,A]=D.useState(!1),S=D.useRef(null),E=D.useRef(null);D.useEffect(()=>{h===0&&R&&!V&&(console.log(" Exercise completed, calling onComplete"),A(!0),t())},[h,R,V,t]);const N=()=>{console.log(` Starting main timer for ${e} minutes`),E.current&&(console.log(" Timer already exists, clearing previous timer"),clearInterval(E.current)),E.current=setInterval(()=>{f(Z=>{if(Z<=1)return console.log(` Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(E.current),E.current=null,0;const me=Z-1;return me%10===0&&console.log(` Main timer: ${me}s remaining`),me})},1e3),console.log(" Main timer started successfully")},k=()=>{console.log(` Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),S.current&&(console.log(" Animation already running, clearing previous animation"),cancelAnimationFrame(S.current));const Z=n.inhale+n.exhale;let me=0,we=0,De="inhale";console.log(` Cycle duration: ${Z}s, starting animation loop...`);const Re=()=>{if(me+=16,me>=Z*1e3&&(console.log(` Breathing cycle completed, resetting to 0ms. Current phase: ${De}, phaseTime: ${v}`),me=0,we=0,De="inhale",g("inhale"),_(0)),me<n.inhale*1e3){De!=="inhale"&&(console.log(` Switching to INHALE phase at ${me}ms`),De="inhale",g("inhale"),_(0),we=0);const vt=me/(n.inhale*1e3),Ae=.1+b(vt)*3.9;C(Ae);const Pe=Math.floor(vt*n.inhale);Pe!==we&&(_(Pe),we=Pe,console.log(` INHALE: ${Pe}/${n.inhale}s (phase: ${De}, scale: ${Ae.toFixed(3)})`))}else{De!=="exhale"&&(console.log(` Switching to EXHALE phase at ${me}ms`),De="exhale",g("exhale"),_(0),we=0);const vt=(me-n.inhale*1e3)/(n.exhale*1e3),Ae=4-b(vt)*3.9;C(Ae);const Pe=Math.floor(vt*n.exhale);Pe!==we&&(_(Pe),we=Pe,console.log(` EXHALE: ${Pe}/${n.exhale}s (phase: ${De}, scale: ${Ae.toFixed(3)})`))}S.current=requestAnimationFrame(Re)};Re(),console.log(" Breathing cycle animation started successfully")},b=Z=>Z<.5?2*Z*Z:-1+(4-2*Z)*Z;D.useEffect(()=>(R&&(N(),k()),()=>{R&&Q()}),[R]);const w=Z=>{const me=Math.floor(Z/60),we=Z%60;return`${me.toString().padStart(2,"0")}:${we.toString().padStart(2,"0")}`},U=()=>v,q=()=>m==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",ve=()=>m==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",Te=()=>{console.log(" User clicked close button, showing confirmation popup"),$(!0)},z=()=>{console.log(" User confirmed leaving exercise, cleaning up..."),Q(),s?s():r()},ne=()=>{$(!1)},W=()=>{if(R){console.log(" Exercise already active, ignoring start request");return}console.log(` Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(` Initial state - isActive: ${R}, progress: ${I}, currentPhase: ${m}`),C(.1),g("inhale"),_(0),f(e*60),x(!0),console.log(" isActive set to true, starting timers..."),setTimeout(()=>{console.log(" Starting main timer and breathing cycle..."),N(),k()},0)},Q=()=>{console.log(" Cleaning up breathing exercise resources"),S.current&&(cancelAnimationFrame(S.current),S.current=null),E.current&&(clearInterval(E.current),E.current=null),x(!1),f(0),C(.1),g("inhale"),_(0)};return D.useEffect(()=>{R||(console.log(" Component mounted, starting breathing exercise automatically"),W())},[]),l.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[l.jsxs("div",{className:"flex items-center justify-between p-6",children:[l.jsx("button",{onClick:Te,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50 min-h-[44px] min-w-[44px]",title:"End breathing exercise",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"text-white text-2xl font-mono",children:w(h)})}),l.jsx("div",{className:"w-11"})," "]}),l.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[l.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),l.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${q()} rounded-full shadow-2xl`,style:{transform:`scale(${I})`,transition:"none",boxShadow:`0 0 ${Math.max(I*40,10)}px ${Math.max(I*15,5)}px ${m==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),l.jsxs("div",{className:"p-6 text-center",children:[l.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:l.jsx("span",{className:"text-white text-lg leading-tight",children:ve()})}),l.jsxs("div",{className:"text-slate-400 text-sm",children:[U(),"/",m==="inhale"?n.inhale:n.exhale,"s"]})]}),l.jsx("div",{className:"px-6 pb-6",children:l.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:l.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),P&&l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600/50 max-w-sm",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),l.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{onClick:z,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Leave"}),l.jsx("button",{onClick:ne,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Stay"})]})]})})})]})},c8=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=D.useState("setup"),[o,a]=D.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[c,u]=D.useState(4),[h,f]=D.useState(!1);D.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const m=I=>{a(I),i("setup")},g=I=>{u(I),i("setup")},v=()=>{f(!0),i("exercise")},_=()=>{f(!1),i("setup"),r&&r(),e()},R=()=>{s==="exercise"&&h||e()},x=()=>{console.log(" User leaving breathing exercise via close button"),e(),t&&t()};return n?l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:R}),l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-900 border-slate-700/50 max-w-md sm:max-w-2xl mx-auto w-full",children:[!(s==="exercise"&&h)&&l.jsx("button",{onClick:R,className:"absolute top-4 left-4 z-10 w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors min-h-[44px] min-w-[44px]",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&l.jsx(i8,{selectedRate:o,duration:c,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:v}),s==="rate"&&l.jsx(o8,{selectedRate:o,onSelect:m,onBack:()=>i("setup")}),s==="duration"&&l.jsx(a8,{selectedDuration:c,onSelect:g,onBack:()=>i("setup")}),s==="exercise"&&l.jsx(l8,{rate:o,duration:c,onComplete:_,onClose:R,onLeave:x})]})})]}):null},u8=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=D.useState(null),[i,o]=D.useState(!0),[a,c]=D.useState(30);D.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content bg-slate-800 max-w-4xl",children:l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(yp,{className:"w-6 h-6 text-blue-400"}),l.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("select",{value:a,onChange:h=>c(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-3 rounded border border-slate-600 min-h-[44px]",children:[l.jsx("option",{value:7,children:"Last 7 days"}),l.jsx("option",{value:30,children:"Last 30 days"}),l.jsx("option",{value:90,children:"Last 90 days"})]}),l.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:""})]})]}),l.jsx("div",{className:"p-6",children:i?l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Mq,{className:"w-5 h-5 text-green-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),l.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Oq,{className:"w-5 h-5 text-blue-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),l.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(v2,{className:"w-5 h-5 text-purple-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),l.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("span",{className:"text-orange-400",children:""}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),l.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),l.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),l.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),l.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>l.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Breathing Exercises"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Meditation Sessions"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Physical Activities"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Hydration Goals Met"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>l.jsxs("div",{className:"flex justify-between",children:[l.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),l.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),l.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>l.jsxs("p",{className:"text-gray-300 text-sm",children:[" ",h]},f)),r.insights.length===0&&l.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:" System Status"}),l.jsxs("div",{className:"space-y-2 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),l.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),l.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),l.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),m=document.createElement("a");m.href=f,m.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,m.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Export Analytics Data"})]})]}):l.jsxs("div",{className:"text-center py-8",children:[l.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),l.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})})})}):l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 p-6",children:[l.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),l.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),l.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Close"})]})})})},d8=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],h8=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],f8=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],m8=[{value:.5,label:"0.5 pods"},{value:1,label:"1 pod"},{value:2,label:"2 pods"},{value:3,label:"3 pods"},{value:4,label:"4 pods"},{value:5,label:"5 pods"},{value:6,label:"6 pods"},{value:7,label:"7 pods"},{value:8,label:"8+ pods"}],p8=["3mg","6mg","12mg","18mg","20mg","50mg"],g8=[{value:"first",label:"This is my first attempt"},{value:"1",label:"Once before"},{value:"2",label:"Twice before"},{value:"3",label:"3-5 times"},{value:"5",label:"More than 5 times"}],y8=[{id:"vaping",label:"Vaping",emoji:""},{id:"smoking",label:"Smoking",emoji:""}],v8={heroName:"",quittingTypes:[],startDate:"",quitDate:new Date().toISOString().split("T")[0],weeklySpend:0,archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5};function _8(n,e="adventurer"){const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`}function w8(n){const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`}function x8(n,e,t){const r=new Date(n).getTime(),i=(new Date(e).getTime()-r)/(365*24*60*60*1e3),o=Math.min(1,t/150);let a;i<.5?a=20:i<1?a=35:i<2?a=50:i<5?a=65:i<10?a=80:a=90;const c=o*30,u=Math.min(100,a+c);return{baseAddiction:u,yearsOfUse:i,category:S8(u)}}function S8(n){return n<30?"Light":n<50?"Moderate":n<70?"Heavy":"Severe"}function I8(n,e){const t=new Date(n).getTime(),r=Math.floor((Date.now()-t)/(24*60*60*1e3)),s=1+e/200,i=r/s;let o;if(i<1)o=5;else if(i<=3)o=5+i*5;else if(i<=7)o=20+(i-3)*5;else if(i<=14)o=40+(i-7)*2.14;else if(i<=30)o=55+(i-14)*.94;else if(i<=90)o=70+(i-30)*.25;else if(i<=180)o=85+(i-90)*.089;else if(i<=365)o=93+(i-180)*.022;else{const a=(i-365)/365;o=97+2*(1-Math.exp(-a))}return Math.min(99,o)}function E8(n,e,t,r=0,s=0){const{baseAddiction:i,yearsOfUse:o}=x8(n,e,t),a=I8(e,i),c=100-i,u=i,h=a/100*u,f=c+h;let m=0;s>0&&(m=r/s*10);const g=Math.min(99,f+m);return{addictionFreedom:Math.round(g),baseAddiction:i,recoveryPercent:Math.round(a),yearsOfUse:o,breakdown:{starting:Math.round(c),gained:Math.round(h),engagement:Math.round(m)}}}function b8(n){console.log("Calculating stats with userData:",n);const t=100-E8(n.startDate,n.quitDate,n.weeklySpend,0,0).addictionFreedom;let r=25;n.confidence>=9?r+=35:n.confidence>=7?r+=25:n.confidence>=4?r+=15:r+=0,n.quitAttempts==="first"?r+=15:parseInt(n.quitAttempts)<=3?r+=10:r+=5,n.copingStrategies.length>=3?r+=15:n.copingStrategies.length>=1?r+=10:r+=0,r=Math.min(r,80);let s=35;s+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[n.archetype]||0,n.confidence>=8?s+=25:n.confidence>=5?s+=15:s+=0,n.quitAttempts==="first"?s+=10:parseInt(n.quitAttempts)<=3?s+=5:s+=15,s=Math.min(s,90);let o=15;n.triggers.length<=2?o+=15:n.triggers.length<=4?o+=10:o+=5;const a=n.triggers.includes("Drinking alcohol"),c=n.triggers.includes("Social situations");return a&&c?o+=0:n.triggers.length>3?o+=5:o+=10,n.copingStrategies.length>=3?o+=25:n.copingStrategies.length>=1?o+=15:o+=0,n.dailyPatterns.includes("Throughout the day")?o+=0:n.dailyPatterns.length>2?o+=5:o+=10,o=Math.min(o,60),{addictionLevel:t,mentalStrength:r,motivation:s,triggerDefense:o}}function bf(n){return n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e"}async function Tf(n,e,t,r){if(!e){console.warn("No userId provided, skipping Firebase save");return}try{await Ie(H(n,`users/${e}/onboarding/step${r}`),{...t,stepNumber:r,timestamp:Date.now()}),await Ie(H(n,`users/${e}/onboarding/progress`),{currentStep:r,completedSteps:Array.from({length:r},(s,i)=>i+1),lastUpdated:Date.now()}),console.log(`Step ${r} saved to Firebase successfully`)}catch(s){console.error(`Error saving step ${r} to Firebase:`,s)}}function T8({currentStep:n,totalSteps:e=11}){return l.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:Array.from({length:e},(t,r)=>r+1).map(t=>l.jsxs("div",{className:"flex items-center flex-shrink-0",children:[l.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${t<=n?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:t<n?"":t}),t<e&&l.jsx("div",{className:`w-4 h-1 mx-1 ${t<n?"bg-blue-500":"bg-slate-600"}`})]},t))})}function A8({step:n,canProceed:e,onBack:t,onNext:r,isLastStep:s=!1}){return l.jsxs("div",{className:"flex justify-between",children:[n>1&&l.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),l.jsxs("button",{onClick:r,disabled:!e,className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${e?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[s?"Start Journey":"Next",l.jsx(Cq,{className:"w-4 h-4"})]})]})}function t0({items:n,selectedIndex:e,onChange:t,itemHeight:r=40}){const s=D.useRef(null),[i,o]=D.useState(!1),[a,c]=D.useState(0),[u,h]=D.useState(0);D.useEffect(()=>{h(-e*r)},[e,r]);const f=_=>{o(!0),c(_.touches[0].clientY)},m=_=>{if(!i)return;const x=_.touches[0].clientY-a;h(-e*r+x)},g=()=>{if(!i)return;o(!1);const _=Math.round(-u/r),R=Math.max(0,Math.min(n.length-1,_));t(R)},v=_=>{_.preventDefault();const R=_.deltaY>0?1:-1,x=Math.max(0,Math.min(n.length-1,e+R));t(x)};return l.jsxs("div",{className:"relative h-[200px] overflow-hidden",children:[l.jsx("div",{className:"absolute left-0 right-0 top-1/2 -translate-y-1/2 pointer-events-none z-10",style:{height:`${r}px`},children:l.jsx("div",{className:"h-full border-y-2 border-blue-500 bg-blue-500/5"})}),l.jsx("div",{className:"absolute inset-x-0 top-0 h-20 bg-gradient-to-b from-white to-transparent pointer-events-none z-20"}),l.jsx("div",{className:"absolute inset-x-0 bottom-0 h-20 bg-gradient-to-t from-white to-transparent pointer-events-none z-20"}),l.jsx("div",{ref:s,className:"absolute inset-0 flex flex-col items-center cursor-grab active:cursor-grabbing",style:{paddingTop:"80px",paddingBottom:"80px"},onTouchStart:f,onTouchMove:m,onTouchEnd:g,onWheel:v,children:l.jsx("div",{className:"transition-transform duration-200",style:{transform:`translateY(${u}px)`,transitionProperty:i?"none":"transform"},children:n.map((_,R)=>{const x=Math.abs(R-e),I=Math.max(.2,1-x*.3),C=Math.max(.7,1-x*.15);return l.jsx("div",{className:"flex items-center justify-center font-medium select-none",style:{height:`${r}px`,opacity:I,transform:`scale(${C})`,transition:i?"none":"all 0.2s ease-out"},onClick:()=>t(R),children:_.label},_.value)})})})]})}function iA({value:n,onChange:e,minDate:t=new Date(new Date().getFullYear()-50,0,1),maxDate:r=new Date,label:s}){const i=["January","February","March","April","May","June","July","August","September","October","November","December"],o=n.getMonth(),a=n.getFullYear(),c=n.getDate(),u=Array.from({length:r.getFullYear()-t.getFullYear()+1},(R,x)=>({value:t.getFullYear()+x,label:String(t.getFullYear()+x)})),h=i.map((R,x)=>({value:x,label:R})),f=new Date(a,o+1,0).getDate(),m=Array.from({length:f},(R,x)=>({value:x+1,label:String(x+1)})),g=R=>{const x=new Date(a,R,Math.min(c,new Date(a,R+1,0).getDate()));e(x)},v=R=>{const x=new Date(a,o,R+1);e(x)},_=R=>{const x=u[R].value,I=new Date(x,o,Math.min(c,new Date(x,o+1,0).getDate()));e(I)};return l.jsxs("div",{className:"w-full",children:[s&&l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:s}),l.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-4",children:l.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[l.jsxs("div",{children:[l.jsx("div",{className:"text-xs font-medium text-gray-500 text-center mb-2",children:"Month"}),l.jsx(t0,{items:h,selectedIndex:o,onChange:g})]}),l.jsxs("div",{children:[l.jsx("div",{className:"text-xs font-medium text-gray-500 text-center mb-2",children:"Day"}),l.jsx(t0,{items:m,selectedIndex:c-1,onChange:v})]}),l.jsxs("div",{children:[l.jsx("div",{className:"text-xs font-medium text-gray-500 text-center mb-2",children:"Year"}),l.jsx(t0,{items:u,selectedIndex:u.findIndex(R=>R.value===a),onChange:_})]})]})})]})}const N8=(n,e)=>{const r=1+e/70*.5,s=n*(r-1);return{years:s.toFixed(1),description:C8(s)}},C8=n=>n<1?"Your cells aged slightly faster":n<3?"Your body aged faster than it should have":n<5?"Significant accelerated aging occurred":n<10?"Your body aged nearly a decade faster":"Extreme accelerated biological aging",k8=n=>n<1?["Even short-term nicotine use begins to reduce lung capacity and slow your body's oxygen uptake.","Early signs of tooth enamel erosion and gum irritation can appear within months of regular use."]:n<3?["You've likely already lost up to 5% of your lung efficiency  similar to someone a decade older.","Nicotine has started to impact your cardiovascular system, increasing blood pressure and heart rate."]:n<5?["Your body's ability to recover from exercise drops, with a notable decline in cardiovascular endurance.","Blood vessel damage begins to impact circulation, potentially causing cold hands and feet."]:n<8?["Chronic lung inflammation becomes established, often leading to persistent shortness of breath or coughing.","Your immune system weakens, making you more susceptible to infections and slower to heal."]:["The risk of developing COPD or chronic bronchitis skyrockets  permanent lung damage becomes increasingly likely.","Your arteries have likely stiffened, raising your heart attack and stroke risk by over 200% compared to non-users."],R8=n=>n<1e3?["Enough for a new iPhone SE or AirPods Max  instead, it went up in smoke.","Could've funded a weekend city break in Europe or 3 months of gym membership."]:n<2e3?["Equal to a MacBook Air M2, a quality mountain bike, or half a year's rent in a shared flat outside London.","Could've paid for an all-inclusive holiday for two in Spain or Greece."]:n<5e3?["That's a brand-new MacBook Pro, one year of London rent contribution, or a round-the-world flight ticket.","Could've fully funded a year of professional fitness coaching or a high-end gaming PC setup."]:n<1e4?["Enough to buy a used car (e.g. Mini Cooper, VW Golf) or 610 months of central London rent.","Equivalent to a luxury 2-week Maldives holiday or investment in a side-business."]:n<15e3?["Could've covered a postgraduate course, a designer wardrobe overhaul, or a year of global travel.","Equal to a small wedding, premium gym membership for 5 years, or a new electric scooter + laptop combo."]:n<2e4?["Enough for a deposit on a flat in many UK cities or a new car outright.","Could've funded a year-long sabbatical or seed money for your own startup."]:["That's life-changing money  equivalent to a house deposit, MBA tuition, or two luxury round-the-world trips.","You've literally smoked the value of a Tesla Model 3 or five years of rent outside London."],D8=({value:n,onChange:e})=>{const t=D.useRef(null),r=Array.from({length:51},(o,a)=>a*10),s=48;D.useEffect(()=>{if(t.current&&n!==void 0){const o=r.indexOf(n);o!==-1&&(t.current.scrollTop=o*s)}},[n]);const i=o=>{const a=o.target.scrollTop,c=Math.round(a/s),u=r[c]||0;u!==n&&e(u)};return l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute left-0 right-0 top-1/2 -translate-y-1/2 h-12 bg-blue-500/20 border-y-2 border-blue-500 pointer-events-none z-10"}),l.jsx("div",{className:"absolute top-0 left-0 right-0 h-20 bg-gradient-to-b from-slate-800 to-transparent pointer-events-none z-10"}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-slate-800 to-transparent pointer-events-none z-10"}),l.jsxs("div",{ref:t,onScroll:i,className:"h-60 overflow-y-scroll snap-y snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:[l.jsx("div",{style:{height:`${s*2}px`}}),r.map(o=>{const a=o===n;return l.jsx("div",{className:`flex items-center justify-center snap-center transition-all duration-200 ${a?"text-white font-bold text-2xl scale-110":"text-gray-400 text-lg"}`,style:{height:`${s}px`},onClick:()=>{e(o);const c=r.indexOf(o);t.current.scrollTo({top:c*s,behavior:"smooth"})},children:l.jsxs("span",{className:"cursor-pointer",children:["",o]})},o)}),l.jsx("div",{style:{height:`${s*2}px`}})]})]})};function P8({onComplete:n,authUser:e,db:t,pwaInstallAvailable:r,promptInstall:s}){const[i,o]=D.useState(1),[a,c]=D.useState(v8);D.useState(!1),D.useState(!1),D.useState(null),D.useState(null),D.useEffect(()=>{if(!a.avatar)try{const g=_8(a.avatarSeed);c(v=>({...v,avatar:g}))}catch(g){console.error("Failed to generate initial avatar:",g);const v=w8(a.avatarSeed);c(_=>({..._,avatar:v}))}},[]);const u=async()=>{if(i<12)e&&await Tf(t,e.uid,a,i),o(i+1);else try{console.log("Completing onboarding with userData:",a);const g=b8(a);console.log("Calculated stats:",g);const v={...a,stats:{...g,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};e&&await Tf(t,e.uid,v,12),console.log("Final user data:",v),n(v)}catch(g){console.error("Error completing onboarding:",g);const _={...a,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};if(e)try{await Tf(t,e.uid,_,12)}catch(R){console.error("Failed to save fallback data to Firebase:",R)}console.log("Using fallback stats:",_),n(_)}},h=()=>{i>1&&o(i-1)},f=()=>{switch(i){case 1:return a.heroName.trim().length>0;case 2:return a.quittingTypes.length>0;case 3:return a.startDate!==""&&a.quitDate!==""&&a.weeklySpend>0;case 4:return!0;case 5:return a.triggers.length>0;case 6:return a.dailyPatterns.length>0;case 7:return a.copingStrategies.length>0;case 8:return a.vapePodsPerWeek>0;case 9:return a.nicotineStrength!=="";case 10:return a.quitAttempts!=="";case 11:return a.confidence>0;default:return!1}},m=async(g,v)=>{const _={...a,[g]:v};c(_),e&&f()&&await Tf(t,e.uid,_,i)};return l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[r&&l.jsxs("div",{className:"mb-4 p-3 rounded-lg border border-blue-600 bg-blue-900/40 text-blue-100 flex items-center justify-between",children:[l.jsx("div",{className:"mr-3",children:"Install QuitArena for a faster, full-screen experience."}),l.jsx("button",{onClick:s,className:"px-4 py-3 rounded-md bg-blue-600 hover:bg-blue-500 text-white text-sm font-semibold min-h-[44px] min-w-[44px]",children:"Install"})]}),l.jsx(T8,{currentStep:i}),i===1&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(ZT,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Welcome to QuitCard Arena"}),l.jsx("p",{className:"text-gray-300 mb-2",children:"You're about to start your freedom journey"}),l.jsx("p",{className:"text-gray-300 mb-6 font-medium",children:"What should we call you?"}),l.jsx("div",{className:"mb-6",children:l.jsx("input",{type:"text",value:a.heroName,onChange:g=>m("heroName",g.target.value),placeholder:"Your name or nickname",autoComplete:"name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),i===2&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(ZT,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"What are you quitting?"}),l.jsx("div",{className:"space-y-4 mb-6",children:y8.map(g=>l.jsx("button",{onClick:()=>{const v=a.quittingTypes.includes(g.id)?a.quittingTypes.filter(_=>_!==g.id):[...a.quittingTypes,g.id];m("quittingTypes",v)},className:`w-full p-6 rounded-xl border-2 transition-all duration-300 transform hover:scale-[1.02] ${a.quittingTypes.includes(g.id)?"border-blue-500 bg-gradient-to-r from-blue-500/20 to-blue-600/20 shadow-lg shadow-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500 hover:bg-slate-700"}`,children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:`text-5xl transition-transform duration-300 ${a.quittingTypes.includes(g.id)?"scale-110":""}`,children:g.emoji}),l.jsx("span",{className:`font-bold text-2xl transition-colors duration-300 ${a.quittingTypes.includes(g.id)?"text-blue-300":"text-white"}`,children:g.label})]})},g.id))})]}),i===3&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-cyan-500 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-4xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Your Usage History"}),l.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Let's understand your journey so we can show you what you've gained by quitting"}),l.jsx("div",{className:"w-full h-px bg-gradient-to-r from-transparent via-slate-500 to-transparent mb-6"}),l.jsxs("div",{className:"mb-6 text-left",children:[l.jsxs("label",{className:"flex items-center gap-2 text-white font-semibold mb-3",children:[l.jsx("span",{className:"text-lg",children:"1"}),l.jsx("span",{children:"When did you START using nicotine regularly?"})]}),l.jsx(iA,{value:a.startDate?new Date(a.startDate):new Date(2020,0,1),onChange:g=>m("startDate",g.toISOString().split("T")[0]),minDate:new Date(new Date().getFullYear()-70,0,1),maxDate:new Date}),l.jsx("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"Approximate date is fine"})]}),l.jsx("div",{className:"w-full h-px bg-gradient-to-r from-transparent via-slate-500 to-transparent mb-6"}),l.jsxs("div",{className:"mb-6 text-left",children:[l.jsxs("label",{className:"flex items-center gap-2 text-white font-semibold mb-3",children:[l.jsx("span",{className:"text-lg",children:"2"}),l.jsx("span",{children:"When did you QUIT?"})]}),l.jsx(iA,{value:a.quitDate?new Date(a.quitDate):new Date,onChange:g=>m("quitDate",g.toISOString().split("T")[0]),minDate:a.startDate?new Date(a.startDate):new Date(2020,0,1),maxDate:new Date}),l.jsx("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"If you haven't quit yet, select today's date"})]}),l.jsx("div",{className:"w-full h-px bg-gradient-to-r from-transparent via-slate-500 to-transparent mb-6"}),l.jsxs("div",{className:"mb-6 text-left",children:[l.jsxs("label",{className:"flex items-center gap-2 text-white font-semibold mb-3",children:[l.jsx("span",{className:"text-lg",children:"3"}),l.jsx("span",{children:"How much did you spend on nicotine per WEEK?"}),l.jsx("span",{className:"text-xl",children:""})]}),l.jsx("div",{className:"bg-slate-800/80 border border-slate-600 rounded-lg p-4",children:l.jsx(D8,{value:a.weeklySpend||0,onChange:g=>m("weeklySpend",g)})}),l.jsxs("div",{className:"mt-3 p-3 bg-slate-700/40 rounded-lg",children:[l.jsx("p",{className:"text-gray-300 text-xs font-medium mb-2",children:"Common ranges:"}),l.jsxs("div",{className:"space-y-1 text-xs text-gray-400",children:[l.jsx("p",{children:" Light user: 20-40/week"}),l.jsx("p",{children:" Moderate: 40-70/week"}),l.jsx("p",{children:" Heavy: 70-150/week"})]})]})]})]}),i===4&&(()=>{const g=new Date(a.startDate),v=new Date(a.quitDate),_=(v-g)/(365*24*60*60*1e3),R=(v-g)/(7*24*60*60*1e3),x=Math.round((v-g)/(24*60*60*1e3)),I=Math.round(a.weeklySpend*R),P=Math.round(x/6205*100),$=N8(_,a.weeklySpend),V=k8(_),A=R8(I);return l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-4xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"The Real Cost"}),l.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Here's what nicotine has really taken from you"}),l.jsxs("div",{className:"mb-6 text-left",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx("span",{className:"text-2xl",children:""}),l.jsxs("h3",{className:"text-white font-bold text-lg",children:[x.toLocaleString()," Days of Use"]})]}),l.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:l.jsxs("p",{className:"text-gray-200 text-sm",children:["That's ",l.jsxs("span",{className:"text-white font-bold text-lg",children:[P,"%"]})," of the average UK smoker's lifetime usage"]})}),l.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-red-500/20 to-orange-500/20 border-2 border-red-500/40 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-xs mb-1",children:"Biological Aging Impact"}),l.jsxs("p",{className:"text-white font-bold text-2xl",children:["+",$.years," Years"]}),l.jsx("p",{className:"text-red-300 text-sm mt-1 italic",children:$.description})]}),l.jsx("span",{className:"text-4xl",children:""})]})}),l.jsx("div",{className:"space-y-3",children:V.map((S,E)=>l.jsxs("div",{className:"flex gap-3 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[l.jsx("span",{className:"text-red-400 mt-0.5",children:""}),l.jsx("p",{className:"text-gray-200 text-sm leading-relaxed",children:S})]},E))})]}),l.jsx("div",{className:"w-full h-px bg-gradient-to-r from-transparent via-slate-500 to-transparent my-6"}),l.jsxs("div",{className:"mb-6 text-left",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx("span",{className:"text-2xl",children:""}),l.jsxs("h3",{className:"text-white font-bold text-lg",children:["You've Spent ",I.toLocaleString()]})]}),l.jsx("div",{className:"space-y-3",children:A.map((S,E)=>l.jsxs("div",{className:"flex gap-3 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:[l.jsx("span",{className:"text-amber-400 mt-0.5",children:""}),l.jsx("p",{className:"text-gray-200 text-sm leading-relaxed",children:S})]},E))})]}),l.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-500/30 rounded-lg",children:l.jsxs("p",{className:"text-white font-semibold text-center",children:[" But here's the good news: ",l.jsx("span",{className:"text-blue-300",children:"Every day you quit is a day you're getting it all back."})]})})]})})(),i===5&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:d8.map(g=>l.jsx("button",{onClick:()=>{const v=a.triggers.includes(g)?a.triggers.filter(_=>_!==g):[...a.triggers,g];m("triggers",v)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${a.triggers.includes(g)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${a.triggers.includes(g)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:a.triggers.includes(g)&&l.jsx("span",{className:"text-white text-sm",children:""})}),l.jsx("span",{className:"text-white font-semibold",children:g})]})},g))})]}),i===6&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:h8.map(g=>l.jsx("button",{onClick:()=>{const v=a.dailyPatterns.includes(g)?a.dailyPatterns.filter(_=>_!==g):[...a.dailyPatterns,g];m("dailyPatterns",v)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${a.dailyPatterns.includes(g)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${a.dailyPatterns.includes(g)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:a.dailyPatterns.includes(g)&&l.jsx("span",{className:"text-white text-sm",children:""})}),l.jsx("span",{className:"text-white font-semibold",children:g})]})},g))})]}),i===7&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:f8.map(g=>l.jsx("button",{onClick:()=>{const v=a.copingStrategies.includes(g)?a.copingStrategies.filter(_=>_!==g):[...a.copingStrategies,g];m("copingStrategies",v)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${a.copingStrategies.includes(g)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${a.copingStrategies.includes(g)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:a.copingStrategies.includes(g)&&l.jsx("span",{className:"text-white text-sm",children:""})}),l.jsx("span",{className:"text-white font-semibold",children:g})]})},g))})]}),i===8&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:a.vapePodsPerWeek,onChange:g=>m("vapePodsPerWeek",parseFloat(g.target.value)||0),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select pods per week"}),m8.map(g=>l.jsx("option",{value:g.value,children:g.label},g.value))]})})]}),i===9&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:a.nicotineStrength,onChange:g=>m("nicotineStrength",g.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select nicotine strength"}),p8.map(g=>l.jsx("option",{value:g,children:g},g))]})})]}),i===10&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:a.quitAttempts,onChange:g=>m("quitAttempts",g.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select option"}),g8.map(g=>l.jsx("option",{value:g.value,children:g.label},g.value))]})})]}),i===11&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),l.jsx("input",{type:"range",min:"1",max:"10",value:a.confidence,onChange:g=>m("confidence",parseInt(g.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${bf(a.confidence)} 0%, ${bf(a.confidence)} ${a.confidence/10*100}%, #475569 ${a.confidence/10*100}%, #475569 100%)`}}),l.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),l.jsxs("div",{className:"text-center mt-4",children:[l.jsx("span",{className:"font-bold text-4xl",style:{color:bf(a.confidence)},children:a.confidence}),l.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),l.jsx("div",{className:"text-center mt-2",children:l.jsx("span",{className:"text-sm font-medium",style:{color:bf(a.confidence)},children:a.confidence<=3?"You can do this! ":a.confidence<=6?"Good confidence! ":a.confidence<=9?"Great confidence! ":"Excellent confidence! "})})]})]}),l.jsx(A8,{step:i,canProceed:f(),onBack:h,onNext:u,isLastStep:i===11})]})})}const pu=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},Hs=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},n0={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:uo},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:S2},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:jq},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:Dq}},j8={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},oA={WEEK_WARRIOR:{name:"Week Warrior",icon:v2,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:Lq,description:"30 days clean"},LEGEND:{name:"Legend",icon:x2,description:"90 days clean"}},M8=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",O8=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction Freedom",description:"Your freedom from nicotine addiction - increases with clean time, decreases with relapses",impacts:["What increases it:"," Clean time: +2 points per week","","What decreases it:"," First relapse (after clean period): -4 points"," Second relapse (within 7 days): -6 additional points"," Third relapse and on (within 3 days): -8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:"," Successful craving resistance: +1 point"," Using app during cravings every 3 times with no relapse: +1 point"," Completing breathing exercises 3 days straight: +1 point"," Staying hydrated for 3 days straight: +1 point"," Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:"," Giving in to cravings: -3 points"," Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:"," Regular logging (3+ days per week): +2 points (weekly)"," Sharing achievements: +3 points per share (weekly)","","What decreases it:"," Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:"," Surviving trigger situations without vaping: +3 points"," Pre-planning for known triggers: +1 point"," Updating your trigger list: +1 point","","What decreases it:"," Relapsing to known triggers: -3 points"," Entering trigger situations unprepared: -1 point"]}}[t];return s?l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),l.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),l.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>l.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[l.jsx("span",{className:"text-blue-400 mr-2",children:""}),i]},o))})]}),l.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300 min-h-[44px]",children:"Got it"})]})})]}):null},Af=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return l.jsxs("div",{className:"mb-0.5 sm:mb-1",children:[l.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&l.jsx("button",{onClick:()=>i(s),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{fontSize:"4px"},title:`Learn about ${n}`,children:"i"})]}),l.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),l.jsx("div",{className:"stat-bar-interactive w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:l.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},L8=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=D.useState(!1),[a,c]=D.useState(null),[u,h]=D.useState([]),[f,m]=D.useState({});if(D.useEffect(()=>{let A=!1;return(async()=>{try{if(n&&n.uid)if(n.specialFeatures)A||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),m({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),m(n.specialFeatures.categories||{})):(h([]),m({})));else{const E=await R(n);A||(Array.isArray(E)?(h(E),m({})):E&&E.features?(h(E.features),m(E.categories||{})):(h([]),m({})))}else A||(h([]),m({}))}catch(E){console.error(" TradingCard: Error loading Special Features:",E),A||(h([]),m({}))}})(),()=>{A=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-4xl text-slate-400",children:""})}),l.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),l.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});let g=n0[n.archetype];if(!g){const A=Object.entries(n0).find(([S,E])=>E.name===n.archetype);A&&(g=A[1],console.log(` TradingCard: Converted archetype name "${n.archetype}" to ID format`))}if(!g)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(n0)),l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsxs("div",{children:[l.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),l.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const v=j8[M8(n.stats.streakDays)],_=g.icon;async function R(A){if(A!=null&&A.isRealBuddy){try{const{ref:U,get:q}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),ve=U(ae,`users/${A.uid}/stats`),Te=await q(ve);if(Te.exists()){const W=Te.val();if(W.specialFeatures&&Array.isArray(W.specialFeatures))return W.specialFeatures}const z=U(ae,`users/${A.uid}/specialFeatures`),ne=await q(z);if(ne.exists())return ne.val()}catch(U){console.warn(" TradingCard: Could not load centralized Special Features for buddy:",U.message)}return["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let S=null;if(A.uid)try{const{ref:U,get:q}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),ve=U(ae,`users/${A.uid}/specialFeatures`),Te=await q(ve);Te.exists()&&(S=Te.val())}catch(U){console.error("Error fetching special features from Firebase:",U)}if(!S){const U=`specialFeatures_${A.heroName||A.id||"default"}`,q=localStorage.getItem(U);q&&(S=JSON.parse(q))}if(S){if(Array.isArray(S))return S;if(S&&S.features)return S}const E=[],N={};for(A.triggers&&A.triggers.length>0&&A.triggers.forEach(U=>{let q="";switch(U){case"Stress/anxiety":q="Stress Vaper";break;case"Social situations":q="Social Vaper";break;case"Boredom":q="Boredom Fighter";break;case"After meals":q="Habit Former";break;case"Drinking alcohol":q="Party Animal";break;case"Work breaks":q="Work Breaker";break;case"Driving":q="Driving Vaper";break;default:q="Trigger Aware"}q&&!E.includes(q)&&(E.push(q),N[q]="triggers")}),A.dailyPatterns&&A.dailyPatterns.length>0&&A.dailyPatterns.forEach(U=>{let q="";switch(U){case"Morning routine":q="Morning Struggler";break;case"Evening wind-down":q="Night Owl";break;case"Throughout the day":q="All-Day Warrior";break;default:q="Routine Builder"}q&&!E.includes(q)&&(E.push(q),N[q]="dailyPatterns")}),A.copingStrategies&&A.copingStrategies.length>0&&(A.copingStrategies.includes("Nothing - this is new to me")?(E.push("First Timer"),N["First Timer"]="copingStrategies"):A.copingStrategies.length>2?(E.push("Veteran Quitter"),N["Veteran Quitter"]="copingStrategies"):(E.push("Cold Turkey"),N["Cold Turkey"]="copingStrategies"));E.length<4;){const U=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],q=U[Math.floor(Math.random()*U.length)];E.includes(q.name)||(E.push(q.name),N[q.name]=q.category)}const k=E.slice(0,4),b={};k.forEach(U=>{b[U]=N[U]||"copingStrategies"});const w={features:k,categories:b};if(A.uid)try{const{ref:U,set:q}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),ve=U(ae,`users/${A.uid}/specialFeatures`);await q(ve,w),console.log("Special features with categories saved to Firebase successfully")}catch(U){console.error("Error saving special features to Firebase:",U);const q=`specialFeatures_${A.heroName||A.id||"default"}`;localStorage.setItem(q,JSON.stringify(w))}else{const U=`specialFeatures_${A.heroName||A.id||"default"}`;localStorage.setItem(U,JSON.stringify(k))}return k}const I=100-(n.stats.addictionLevel||50),C=n.stats.mentalStrength||50,P=n.stats.motivation||50,$=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const V=A=>{c(A),o(!0)};return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:`touch-card relative w-72 sm:w-80 min-h-[480px] sm:min-h-[520px] rounded-xl ${v.color} border-4 ${v.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 mx-auto`,children:[l.jsxs("div",{className:"text-center mb-3",children:[l.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),l.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:g.name})]}),l.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?l.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):l.jsx("div",{className:`w-full h-full ${g.color} flex items-center justify-center`,children:l.jsx(_,{className:"w-12 h-12 text-white"})})}),l.jsxs("div",{className:"mb-2 sm:mb-3",children:[l.jsx(Af,{label:"Addiction Freedom",value:I,max:100,color:"bg-green-500",statType:e?null:"addiction",onInfoClick:e?null:V}),l.jsx(Af,{label:"Mental Strength",value:C,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:V}),l.jsx(Af,{label:"Motivation",value:P,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:V}),l.jsx(Af,{label:"Trigger Defense",value:$,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:V})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),l.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((A,S)=>{const E=f[A]||"copingStrategies",N=k=>{switch(k){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return l.jsx("div",{className:`px-2 py-1 ${N(E)} text-white text-xs rounded-full font-medium`,title:`${A} (${E})`,children:A},S)})})]}),l.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-2 sm:left-3 right-2 sm:right-3 bg-black/30 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 backdrop-blur-sm",children:[l.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[l.jsx("span",{className:"text-gray-300",children:"Streak:"}),l.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const A=n.stats.streakDays;return`${A} day${A===1?"":"s"}`})(),n.stats.streakDays>0&&l.jsx("span",{className:"text-xs",children:""})]})]}),l.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[l.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),l.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,l.jsx("span",{className:"text-xs",children:""})]})]})]}),n.achievements&&n.achievements.length>0&&l.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((A,S)=>{var N,k;const E=((N=oA[A])==null?void 0:N.icon)||x2;return l.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(k=oA[A])==null?void 0:k.description,children:l.jsx(E,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},S)}),n.achievements.length>4&&l.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),l.jsx(O8,{isOpen:i,onClose:()=>o(!1),statType:a})]})},V8=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"My Card",icon:_2},{id:"craving-support",label:"Craving Support",icon:uo},{id:"profile",label:"Progress",icon:Fq},{id:"settings",label:"Explore",icon:w2}];return l.jsx(l.Fragment,{children:l.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:l.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,c=n===o.id;return l.jsxs("button",{onClick:()=>e(o.id),className:`tab-interactive flex flex-col items-center min-h-[44px] min-w-[44px] justify-center ${c?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[l.jsx(a,{className:"w-5 h-5"}),l.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},F8=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:c,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),l.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),l.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});D.useState(!1);const[h,f]=D.useState(null),[m,g]=D.useState(null);D.useEffect(()=>{const b=()=>{const w=document.querySelector(".battle-cards-container");w&&(window.innerWidth<1024?(w.style.flexDirection="column",w.style.gap="1rem"):(w.style.flexDirection="row",w.style.gap="3rem"))};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),D.useEffect(()=>{m&&n&&(async()=>{if(m&&n)try{console.log(" App: Refreshing stats on page load for user:",n.uid),await m.refreshAllStats(),console.log(" App: Stats refreshed on page load")}catch(w){console.error(" App: Error refreshing stats on page load:",w)}})()},[m,n]);const v=async b=>{if((b==null?void 0:b.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!b.quitDate||new Date(b.quitDate)>new Date("2025-09-19")))if(console.log(" TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),b.lastRelapseDate){const U=new Date(b.lastRelapseDate),q=new Date("2025-09-18T13:56:46.584Z");b.quitDate=U>q?b.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(` TEMPORARY FIX: User 3 quit date set to ${b.quitDate} (considering relapse: ${b.lastRelapseDate})`)}else b.quitDate="2025-09-18T13:56:46.584Z";if((b==null?void 0:b.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!b.quitDate||new Date(b.quitDate)>new Date("2025-09-19")))if(console.log(" TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),b.lastRelapseDate){const U=new Date(b.lastRelapseDate),q=new Date("2025-09-18T13:56:46.584Z");b.quitDate=U>q?b.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(` TEMPORARY FIX: User 2 quit date set to ${b.quitDate} (considering relapse: ${b.lastRelapseDate})`)}else b.quitDate="2025-09-18T13:56:46.584Z";let w={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(b!=null&&b.isRealBuddy){if(b.stats&&Object.assign(w,b.stats),b.quitDate){const U=new Date(b.quitDate),q=Hs(U);w.streakDays=q.value,w.streakUnit=q.unit,w.streakDisplayText=q.displayText}try{const{ref:U,get:q}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),ve=U(ae,`users/${b.uid}/cravings`),Te=await q(ve);let z=0;Te.exists()&&(Te.forEach(ne=>{ne.val().outcome==="resisted"&&z++}),w.cravingsResisted=z)}catch{console.log(" Arena: Could not read buddy cravings, using default"),w.cravingsResisted=0}return w}if(!(b!=null&&b.uid)){const U=localStorage.getItem("quitCoachRelapseDate");if(U){const Te=new Date(U),ne=new Date().getTime()-Te.getTime(),W=Math.floor(ne/(1e3*3600*24));w.streakDays=W,w.streakUnit="days",w.streakDisplayText=`${W} day${W===1?"":"s"}`}else{const Te=b.quitDate?new Date(b.quitDate):new Date,z=Hs(Te);w.streakDays=z.value,w.streakUnit=z.unit,w.streakDisplayText=z.displayText}const q=parseInt(localStorage.getItem("cravingWins")||0);w.cravingsResisted=q,new Date().toDateString();let ve=0;for(let Te=0;Te<7;Te++){const z=new Date;z.setDate(z.getDate()-Te);const ne=z.toDateString(),W=localStorage.getItem(`water_${b.uid}_${ne}`);if(W&&parseInt(W)>0)ve++;else break}return ve>=3&&(w.mentalStrength=Math.min(80,(w.mentalStrength||50)+1)),w}try{const{ref:U,get:q}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),ve=U(ae,`users/${b.uid}/cravings`);try{const Q=await q(ve);let Z=0,me=0;if(Q.exists()){const Re=Q.val();Q.forEach(vt=>{const Ne=vt.val();Ne.outcome==="resisted"?Z++:Ne.outcome==="relapsed"&&me++})}w.cravingsResisted=Z;const we=U(ae,`users/${b.uid}/profile/cravingsResisted`),De=await q(we);if(De.exists()){const Re=De.val();console.log(` Arena: Profile cravingsResisted field value: ${Re}`),w.cravingsResisted=Math.max(Z,Re)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const Z=U(ae,`users/${b.uid}/profile/cravingsResisted`),me=await q(Z);w.cravingsResisted=me.exists()?me.val():0}let Te=0;const z=U(ae,`users/${b.uid}/profile/relapseDate`),ne=await q(z);if(ne.exists()){const Q=ne.val(),Z=new Date(Q),we=new Date().getTime()-Z.getTime();Te=Math.floor(we/(1e3*3600*24))}else{const Q=b.quitDate?new Date(b.quitDate):new Date,Z=Hs(Q);Te=Z.value,w.streakUnit=Z.unit,w.streakDisplayText=Z.displayText,console.log(` Arena: Calculated streak from quit date: ${Z.displayText} (quit: ${Q.toISOString()})`),console.log(` Arena: Setting streak fields - streakDays: ${Te}, streakUnit: ${w.streakUnit}, streakDisplayText: ${w.streakDisplayText}`)}w.streakDays=Te;let W=0;for(let Q=0;Q<7;Q++){const Z=new Date;Z.setDate(Z.getDate()-Q);const me=Z.toDateString(),we=U(ae,`users/${b.uid}/profile/daily/${me}/water`),De=await q(we);if(De.exists()&&De.val()>0)W++;else break}W>=3&&(w.mentalStrength=Math.min(80,(w.mentalStrength||50)+1))}catch(U){console.error("Error fetching profile data from Firebase:",U);const q=localStorage.getItem("quitCoachRelapseDate");if(q){const z=new Date(q),W=new Date().getTime()-z.getTime(),Q=Math.floor(W/(1e3*3600*24));w.streakDays=Q,w.streakUnit="days",w.streakDisplayText=`${Q} day${Q===1?"":"s"}`}else{const z=b.quitDate?new Date(b.quitDate):new Date,ne=Hs(z);w.streakDays=ne.value,w.streakUnit=ne.unit,w.streakDisplayText=ne.displayText}const ve=parseInt(localStorage.getItem("cravingWins")||0);w.cravingsResisted=ve,new Date().toDateString();let Te=0;for(let z=0;z<7;z++){const ne=new Date;ne.setDate(ne.getDate()-z);const W=ne.toDateString(),Q=localStorage.getItem(`water_${b.uid}_${W}`);if(Q&&parseInt(Q)>0)Te++;else break}Te>=3&&(w.mentalStrength=Math.min(80,(w.mentalStrength||50)+1))}if(b!=null&&b.uid&&!(b!=null&&b.isRealBuddy))try{const{ref:U,get:q}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),ve=Date.now();await new Promise(z=>setTimeout(z,800));const Te=await q(U(ae,`users/${b.uid}/stats`));if(Te.exists()){const z=Te.val();Object.assign(w,z)}else Object.assign(w,b.stats),console.log(" Arena: Using user.stats as fallback:",w);if(h){await h.updateAddictionFromCleanTime();const z=await q(U(ae,`users/${b.uid}/stats`));if(z.exists()){const ne=z.val();if(Object.assign(w,ne),b.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||b.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(` Arena: Using Firebase stats directly for ${b.uid} - no client-side calculation`),w}}}catch(U){console.error("Error reading/updating stats from Firebase:",U),Object.assign(w,b.stats)}return w},[_,R]=D.useState(()=>{const b={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{...b,...n.stats}:b}),[x,I]=D.useState(()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0}));D.useEffect(()=>{e&&Object.keys(e).length>0&&R(e)},[e]);const[C,P]=D.useState({streakDisplayText:null,streakDays:0,streakUnit:"hours"}),[$,V]=D.useState({}),A=async()=>{if(n&&window.centralizedStatService)try{const b=await window.centralizedStatService.getCurrentStats();V(b),console.log(" Arena: Recalculating real-time stats to update streak...");const w=await v(n);return w&&(console.log(" Arena: Updated real-time stats with new streak:",w.streakDisplayText),R(w)),b}catch(b){return console.warn(" Arena: Could not fetch latest stats from CentralizedStatService:",b),null}return null},S=async()=>{if(n)try{if(console.log(" Arena: Comprehensive refresh after relapse..."),window.centralizedStatService){const w=await window.centralizedStatService.getCurrentStats();V(w)}const b=await v(n);b&&(console.log(" Arena: Updated real-time stats with new streak after relapse:",b.streakDisplayText),R(b)),typeof E=="function"&&E(),console.log(" Arena: Comprehensive refresh after relapse completed")}catch(b){console.error(" Arena: Error during comprehensive refresh after relapse:",b)}};D.useEffect(()=>{A();const b=setInterval(A,3e4);return()=>clearInterval(b)},[n]),D.useEffect(()=>{typeof window<"u"&&(window.refreshArenaStats=A,window.refreshAfterRelapse=S,window.setLatestUserStats=V)},[n]),D.useEffect(()=>{if(!(n!=null&&n.uid))return;let b=!0;return(async()=>{await(async()=>{if(b)try{const ve=new Bg(ae,n.uid);await ve.initialize(),b&&f(ve)}catch(ve){console.error("Error initializing StatManager:",ve)}})(),await(async()=>{if(b){if(n&&b){const ve=await v(n);b&&R(ve)}t&&t.uid&&b&&console.log(` Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{b=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),D.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(` Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let b=!0;const U=(async()=>{try{const{ref:q,onValue:ve}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),Te=q(ae,`users/${t.uid}/stats`),z=ve(Te,Q=>{if(b&&Q.exists()){const Z=Q.val();if(Z.streakDisplayText&&Z.streakUnit){const me={streakDays:Z.streakDays||0,streakUnit:Z.streakUnit,streakDisplayText:Z.streakDisplayText};P(me)}else{let me=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(me){const we=Hs(new Date(me)),De={streakDays:we.value,streakUnit:we.unit,streakDisplayText:we.displayText};P(De),Z.streakDays=we.value,Z.streakUnit=we.unit,Z.streakDisplayText=we.displayText}else Z.streakUnit="hours",Z.streakDisplayText="0 hours"}I(me=>({...me,...Z}))}},Q=>{Q.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",Q)}),ne=q(ae,`users/${t.uid}/profile`),W=ve(ne,async Q=>{if(b&&Q.exists()){const Z=Q.val(),me=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(!(me==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||me==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")){if(x&&x.addictionLevel!==50){let we={...x};if(Z.quitDate&&Z.quitDate!==t.quitDate){const De=new Date(Z.quitDate),Re=Hs(De);we.streakDays=Re.value,we.streakUnit=Re.unit,we.streakDisplayText=Re.displayText}else if(Z.lastRelapseDate||Z.relapseDate){const De=new Date(Z.lastRelapseDate||Z.relapseDate),Re=Hs(De);we.streakDays=Re.value,we.streakUnit=Re.unit,we.streakDisplayText=Re.displayText,P({streakDays:Re.value,streakUnit:Re.unit,streakDisplayText:Re.displayText})}else if(t!=null&&t.finalQuitDate||a!=null&&a.finalQuitDate){const De=new Date((t==null?void 0:t.finalQuitDate)||(a==null?void 0:a.finalQuitDate)),Re=Hs(De);we.streakDays=Re.value,we.streakUnit=Re.unit,we.streakDisplayText=Re.displayText,P({streakDays:Re.value,streakUnit:Re.unit,streakDisplayText:Re.displayText})}I(De=>({...De,...we,...C}))}}}},Q=>{Q.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",Q)});return()=>{z(),W()}}catch(q){console.error("Error setting up buddy stats listeners:",q)}})();return()=>{b=!1,U.then(q=>{q&&typeof q=="function"&&q()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]),D.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;const b=setInterval(()=>{const w=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(!w)return;const U=Hs(new Date(w));P({streakDays:U.value,streakUnit:U.unit,streakDisplayText:U.displayText}),I(q=>({...q,streakDays:U.value,streakUnit:U.unit,streakDisplayText:U.displayText}))},60*1e3);return()=>clearInterval(b)},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.lastRelapseDate,a==null?void 0:a.originalQuitDate,a==null?void 0:a.lastActivity]);const E=async()=>{if(n){const b=await v(n);R(b)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(` Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const b=await v(t);I(w=>(console.log(" Arena: Preserving locally calculated streak during stats calculation:",C),{...w,...b,...C}))}};D.useEffect(()=>{if(!(n!=null&&n.uid))return;const b=setInterval(E,3e4);return()=>clearInterval(b)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),D.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||E())},[t==null?void 0:t.uid]),D.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||E())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),D.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log(" Arena: Loading buddy data for user:",n.uid),c(v,I,P))},[n==null?void 0:n.uid,a,i,u,P]),D.useEffect(()=>{const b=()=>{console.log(" Internet connection restored")},w=()=>{console.log(" Internet connection lost")};return window.addEventListener("online",b),window.addEventListener("offline",w),()=>{window.removeEventListener("online",b),window.removeEventListener("offline",w)}},[]);const N=b=>{if(!b||!b.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const w=b.stats.mentalStrength||50,U=b.stats.motivation||50,q=b.stats.triggerDefense||30,ve=b.stats.addictionLevel||50;return w*1.5+U*1+q*1.2-ve*1};N({...n,stats:_}),N({...t,stats:x});const k=async()=>{const b=_.streakDisplayText||"0 hours",w=_.cravingsResisted||0,U=` ${b} vape-free!
My quit stats: ${b} | ${w} Cravings Resisted
#QuitVaping #VapeFree #QuitCoach`;try{navigator.share?(await navigator.share({title:"My Quit Journey",text:U}),console.log(" Card shared successfully")):(await navigator.clipboard.writeText(U),alert(" Card text copied to clipboard!"))}catch(q){console.error(" Error sharing:",q)}};return l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:l.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-white mb-2",children:"My Progress Card"}),l.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"Track your journey and share your achievements"})]}),l.jsx("div",{className:"flex justify-center mb-6",children:l.jsxs("button",{onClick:E,className:"touch-interactive ripple-effect px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center gap-2 shadow-lg min-h-[44px] transition-all",title:"Refresh Stats",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold",children:"Refresh Stats"})]})}),l.jsxs("div",{className:"flex flex-col items-center space-y-6 mb-8",children:[l.jsx("div",{className:"w-full max-w-md",children:(()=>{if(!n||!_)return console.log(" TradingCard: Missing data, not rendering user card"),l.jsx("div",{className:"w-full h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsx("div",{className:"animate-pulse",children:"Loading Your Card..."})});const b=$&&Object.keys($).length>0?{...n.stats,...$}:e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,..._};return l.jsx(L8,{user:{...n,stats:b},showComparison:!1,nemesisUser:null},`user-${n.uid}-${n.lastRelapseRefresh||Date.now()}`)})()}),l.jsxs("button",{onClick:k,className:"w-full max-w-md px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-xl font-bold text-lg shadow-2xl transition-all transform hover:scale-105 min-h-[56px] flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-2xl",children:""}),l.jsx("span",{children:"Share My Card"})]}),l.jsxs("div",{className:"w-full max-w-md grid grid-cols-2 gap-4 mt-6",children:[l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:[l.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"Clean Streak"}),l.jsx("div",{className:"text-white text-2xl font-bold",children:_.streakDisplayText||"0 hours"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:[l.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"Cravings Resisted"}),l.jsx("div",{className:"text-white text-2xl font-bold",children:_.cravingsResisted||0})]})]})]})]})})},$8=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"";case"warning":return"";case"info":return"";default:return""}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content bg-slate-800 border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-3xl",children:i()})}),l.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),l.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),l.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})]})},U8=({gameType:n,onClose:e})=>{const[t,r]=D.useState(0),{modalRef:s,classes:i}=mS(e,{threshold:100,velocity:.5,enabled:!0}),o=()=>{const c=D.useRef(null),[u,h]=D.useState([{x:12,y:12}]),[f,m]=D.useState({x:1,y:0}),[g,v]=D.useState({x:1,y:0}),[_,R]=D.useState({x:15,y:15}),[x,I]=D.useState(!1),[C,P]=D.useState(0),[$,V]=D.useState(1),A={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},S={1:5,2:5,3:10};return D.useEffect(()=>{const E=N=>{if(x){N.preventDefault(),h([{x:12,y:12}]),m({x:1,y:0}),v({x:1,y:0}),R({x:15,y:15}),I(!1),P(0),V(1);return}switch(N.key){case"ArrowUp":N.preventDefault(),f.y!==1&&v({x:0,y:-1});break;case"ArrowDown":N.preventDefault(),f.y!==-1&&v({x:0,y:1});break;case"ArrowLeft":N.preventDefault(),f.x!==1&&v({x:-1,y:0});break;case"ArrowRight":N.preventDefault(),f.x!==-1&&v({x:1,y:0});break}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[f,x]),D.useEffect(()=>{if(x)return;const E=setInterval(()=>{h(N=>{const k={x:N[0].x+f.x,y:N[0].y+f.y};if(k.x<0&&(k.x=24),k.x>=25&&(k.x=0),k.y<0&&(k.y=24),k.y>=25&&(k.y=0),N.slice(0,-1).some(q=>q.x===k.x&&q.y===k.y))return I(!0),N;const w=k.x===_.x&&k.y===_.y;let U;return w?(P(q=>q+S[$]),R({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),U=[k,...N]):U=[k,...N.slice(0,-1)],(g.x!==f.x||g.y!==f.y)&&setTimeout(()=>{m(g)},0),U})},A[$]);return()=>clearInterval(E)},[f,g,_,x]),D.useEffect(()=>{const E=c.current;if(!E)return;const N=E.getContext("2d"),k=15,b=25;N.fillStyle="#1f2937",N.fillRect(0,0,375,375),N.strokeStyle="#374151",N.lineWidth=1;for(let w=0;w<=b;w++)N.beginPath(),N.moveTo(w*k,0),N.lineTo(w*k,375),N.stroke(),N.beginPath(),N.moveTo(0,w*k),N.lineTo(375,w*k),N.stroke();u.forEach((w,U)=>{U===0?N.fillStyle="#fbbf24":N.fillStyle="#10b981",N.fillRect(w.x*k+1,w.y*k+1,k-2,k-2)}),N.fillStyle="#ef4444",N.fillRect(_.x*k+2,_.y*k+2,k-4,k-4)},[u,_]),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"mb-4",children:l.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[l.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(E=>l.jsxs("button",{onClick:()=>V(E),className:`
                  px-4 py-3 text-sm font-mono border-2 border-green-500 transition-all min-h-[44px]
                  ${$===E?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[l.jsxs("div",{children:["Level ",E]}),l.jsxs("div",{className:"text-xs mt-1",children:[E===1&&"Normal",E===2&&"Fast",E===3&&"Insane"]})]},E))]})}),l.jsx("canvas",{ref:c,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),l.jsxs("div",{className:"mt-4",children:[l.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",C," | Level: ",$]}),x&&l.jsxs("div",{className:"mt-2",children:[l.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),l.jsx("button",{onClick:()=>{h([{x:12,y:12}]),m({x:1,y:0}),v({x:1,y:0}),R({x:15,y:15}),I(!1),P(0),V(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Restart Game"})]})]})]})},a=()=>{try{return n==="snake"?l.jsx(o,{}):l.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(c){return console.error("Error rendering game:",c),l.jsxs("div",{className:"text-center text-red-600",children:[l.jsx("p",{className:"text-lg font-bold mb-2",children:" Game Error"}),l.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),l.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Reload Game"})]})}};return l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:s,className:`modal-content bg-white max-w-4xl ${i}`,role:"dialog","aria-modal":"true","aria-labelledby":"game-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4 p-4",children:[l.jsx("h3",{id:"game-modal-title",className:"text-xl font-bold text-gray-800",children:" Snake Game"}),l.jsx("button",{onClick:e,className:"modal-close-button","aria-label":"Close game modal",children:""})]}),l.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center relative mx-4",children:a()}),l.jsxs("div",{className:"p-4",children:[l.jsx("div",{className:"flex justify-center items-center gap-4 mb-4",children:l.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:["Score: ",t]})}),l.jsx("div",{className:"modal-actions",children:l.jsx("button",{onClick:e,className:"modal-button modal-button-primary",children:"Close Game"})})]})]})]})})})},B8=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,c]=D.useState(!1),[u,h]=D.useState(null),[f,m]=D.useState(!1),[g,v]=D.useState({title:"",message:"",type:"info"}),[_,R]=D.useState(null),[x,I]=D.useState(!1),[C,P]=D.useState(0),[$,V]=D.useState(!1),[A,S]=D.useState(!1),[E,N]=D.useState(1),[k,b]=D.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[w,U]=D.useState({resisted:0,relapses:0}),[q,ve]=D.useState(0),[Te,z]=D.useState(!1),[ne,W]=D.useState(""),Q=(ee,xe,pe="info")=>{console.log(" showQuickActionPopup called:",{title:ee,message:xe,type:pe}),v({title:ee,message:xe,type:pe}),m(!0),console.log(" showQuickActionPopup: Popup data set and showCustomPopup set to true")};yA.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=Q),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),D.useEffect(()=>n!=null&&n.uid?(P(0),(async()=>{try{const be=new Bg(ae,n.uid);await be.initialize(),R(be)}catch(be){console.error("Error initializing StatManager:",be)}})(),(async()=>{try{const be=new Date().toDateString(),{ref:ge,get:at}=await Ve(()=>import("./index.esm-1f127fec.js"),[]);try{const bt=ge(ae,`users/${n.uid}/profile/dailyCravingLogs/${be}`),dt=await at(bt);if(dt.exists()){const Xe=dt.val();ve(Xe.count||0)}else ve(0)}catch{const dt=`cravingLogs_${n.uid}_${be}`,Xe=localStorage.getItem(dt);if(Xe){const st=JSON.parse(Xe);ve(st.count||0)}else ve(0)}}catch(be){console.error("Error loading daily craving logs:",be),ve(0)}})(),(async()=>{try{const{ref:be,get:ge,onValue:at,query:bt,orderByChild:dt,startAt:Xe,endAt:st,set:Le}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),he=new Date,Me=new Date(he.getTime()-7*24*60*60*1e3),Ht=Me.toDateString(),Tt=he.toDateString();try{const Qe=be(ae,`users/${n.uid}/profile/cravingStats`),rn=await ge(Qe);if(rn.exists()){const oe=rn.val();if(oe.lastUpdated&&new Date(oe.lastUpdated)>Me){U(oe);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:tn,get:mn,query:Qt,orderByChild:xn,startAt:nn,endAt:pn}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),un=tn(ae,`users/${n.uid}/cravings`),Kt=Qt(un,xn("date"),nn(Ht),pn(Tt));try{const Qe=await mn(Kt);let rn=0,oe=0;if(console.log(` Weekly Stats: Checking cravings for ${Ht} to ${Tt}`),console.log(` Weekly Stats: Cravings snapshot exists: ${Qe.exists()}`),Qe.exists()){const Dt=Qe.val();console.log(" Weekly Stats: Raw cravings data:",Dt),Qe.forEach(es=>{const An=es.val();console.log(" Weekly Stats: Individual craving:",An),An.outcome==="resisted"?rn++:An.outcome==="relapsed"&&oe++})}console.log(` Weekly Stats: Calculated - resisted: ${rn}, relapses: ${oe}`);const lt={resisted:rn,relapses:oe,lastUpdated:he.toISOString()};U(lt);try{const Dt=be(ae,`users/${n.uid}/profile/cravingStats`);await Le(Dt,lt)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(lt))}catch{console.log("Could not query cravings, using localStorage fallback");const rn=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');U(rn)}const Hn=be(ae,`users/${n.uid}/profile/cravingStats`);return at(Hn,Qe=>{Qe.exists()&&U(Qe.val())})}catch(be){console.error("Error loading weekly stats:",be);const ge=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');U(ge)}})(),(async()=>{try{const{ref:be,get:ge,onValue:at}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),bt=new Date().toDateString(),dt=be(ae,`users/${n.uid}/profile/daily/${bt}/water`),Xe=await ge(dt);if(Xe.exists())P(Xe.val()||0);else{const Le=parseInt(localStorage.getItem(`water_${n.uid}_${bt}`)||0);P(Le)}return at(dt,Le=>{Le.exists()&&P(Le.val()||0)})}catch(be){console.error("Error loading daily water from Firebase:",be);const ge=new Date().toDateString(),at=parseInt(localStorage.getItem(`water_${n.uid}_${ge}`)||0);P(at)}})(),()=>{P(0),I(!1),U({resisted:0,relapses:0}),S(!1),N(1),b({strength:5,mood:"",context:"",outcome:""}),ve(0),z(!1),W("")}):void 0,[n==null?void 0:n.uid]);const Z=()=>{h("snake"),c(!0)},me=()=>{h(null),c(!1)},we=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const ee=Math.min(C+1,6);P(ee);const xe=new Date().toDateString();if(_){if(await _.handleHydrationUpdate(ee),o)try{const ge=await _.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:ee,targetGlasses:6,currentStreak:ge}),console.log(" Hydration also logged to Firestore for analytics")}catch(ge){console.warn(" Could not log hydration to Firestore:",ge.message),await Ne("hydration",{glassesConsumed:ee,targetGlasses:6,currentStreak:await _.checkHydrationStreak()})}else await Ne("hydration",{glassesConsumed:ee,targetGlasses:6,currentStreak:await _.checkHydrationStreak()});ee===6&&C===5&&await _.checkHydrationStreak()>=3&&(await _.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:pe,set:je}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),be=pe(ae,`users/${n.uid}/profile/daily/${xe}/water`);await je(be,ee),localStorage.setItem(`water_${n.uid}_${xe}`,ee.toString()),console.log("Water intake updated:",ee)}catch(ee){console.error("Error updating water intake:",ee);const xe=Math.min(C+1,6);P(xe);const pe=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${pe}`,xe.toString())}},De=()=>{b({strength:5,mood:"",context:"",outcome:""}),N(1),S(!0)},Re=()=>{E<4&&N(E+1)},vt=()=>{E>1&&N(E-1)},Ne=async(ee,xe)=>{if(!window.offlineManager||!(authUser!=null&&authUser.uid))return!1;const pe={...xe,userId:authUser.uid,timestamp:Date.now()};return await window.offlineManager.handleOfflineBehavioralLog(ee,pe)},Ae=async ee=>{let xe,pe,je;try{je=new Date().toISOString();const be=new Date().toDateString(),ge=new Date;xe={...k,outcome:ee,timestamp:je,date:be,timeOfDay:ge.getHours()<12?"morning":ge.getHours()<17?"afternoon":"evening",dayOfWeek:ge.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((ge.getDate()+new Date(ge.getFullYear(),0,1).getDay())/7),month:ge.toLocaleDateString("en-US",{month:"long"}),year:ge.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:ee==="resisted",relapsed:ee==="relapsed",logged:ee==="logged",usedPractices:ee==="resistance_practices"}};const at=new Date().toDateString(),bt=q+1;ve(bt),pe={resisted:w.resisted,relapses:w.relapses,lastUpdated:je};let dt=!1;if(bt<=2&&_)try{const Kt=await _.handleCravingLogged();Kt&&Kt.applied&&(dt=!0,console.log(" Awareness bonus awarded for craving tracking"))}catch(Kt){console.warn(" Could not award awareness bonus:",Kt)}if(ee==="resisted"){if(pe.resisted=w.resisted+1,_){console.log(" Detailed Craving: Calling StatManager.handleCravingResistance()...");const Kt=await _.handleCravingResistance();console.log(" Detailed Craving: StatManager.handleCravingResistance() result:",Kt)}window.centralizedStatService&&(console.log(" Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleCravingResisted(),console.log(" Detailed Craving: Stats updated via CentralizedStatService"))}else if(ee==="relapsed"){if(pe.relapses=w.relapses+1,_){console.log(" Detailed Craving: Calling StatManager.handleRelapse()...");const Kt=await _.handleRelapse();console.log(" Detailed Craving: StatManager.handleRelapse() result:",Kt)}window.centralizedStatService&&(console.log(" Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log(" Detailed Craving: Stats updated via CentralizedStatService")),typeof window.refreshAfterRelapse=="function"?(console.log(" Detailed Craving: Comprehensive Arena refresh after relapse..."),window.refreshAfterRelapse(),setTimeout(()=>{console.log(" Detailed Craving: Secondary comprehensive Arena refresh..."),window.refreshAfterRelapse()},2e3)):typeof window.refreshArenaStats=="function"?(console.log(" Detailed Craving: Fallback to regular Arena stats refresh..."),window.refreshArenaStats(),setTimeout(()=>{console.log(" Detailed Craving: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3)):console.warn(" Detailed Craving: No Arena refresh functions available")}const{ref:Xe,set:st,push:Le,get:he}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),Me=Xe(ae,`users/${n.uid}/profile/cravingStats`);await st(Me,pe);const Ht=Xe(ae,`users/${n.uid}/cravings`),Tt=Le(Ht);if(await st(Tt,xe),o)try{await o.logCraving(n.uid,{outcome:ee,strength:k.strength,duration:k.duration,context:"detailed_assessment",triggers:k.triggers||[],mood:k.mood,stressLevel:k.stressLevel,copingStrategiesUsed:k.copingStrategies||[],location:k.location,socialSituation:k.socialSituation}),console.log(" Craving also logged to Firestore for analytics")}catch(Kt){console.warn(" Could not log craving to Firestore:",Kt.message),Ne&&await Ne("craving",{outcome:ee,strength:k.strength,duration:k.duration,context:"detailed_assessment",triggers:k.triggers||[],mood:k.mood,stressLevel:k.stressLevel,copingStrategiesUsed:k.copingStrategies||[],location:k.location,socialSituation:k.socialSituation})}const tn=Xe(ae,`users/${n.uid}/profile/cravingHistory/${at}`),mn=await he(tn);let Qt=mn.exists()?mn.val():[];Qt.push({...xe,id:Tt.key,timestamp:je}),Qt.length>30&&(Qt=Qt.slice(-30)),await st(tn,Qt),console.log(` Daily history updated for ${at}:`,Qt.length,"records");const xn=ge.toISOString().substring(0,7),nn=Xe(ae,`users/${n.uid}/profile/cravingTrends/${xn}`),pn=await he(nn);let un=pn.exists()?pn.val():[];un.push({...xe,id:Tt.key,timestamp:je}),un.length>365&&(un=un.slice(-365)),await st(nn,un),console.log(` Monthly trends updated for ${xn}:`,un.length,"records"),U(pe),v(ee==="resisted"?{title:" Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}:ee==="relapsed"?{title:" New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your awareness and tracking skills are improving with each experience. Keep going!`,type:"success"}:{title:" Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"}),m(!0),S(!1),N(1)}catch(be){if(console.error("Error saving craving assessment:",be),xe){const ge=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");ge.push(xe),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(ge))}if(pe){const ge=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');ge.resisted=pe.resisted,ge.relapses=pe.relapses,ge.lastUpdated=je,localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(ge))}v(ee==="resisted"?{title:" Great Job!",message:`You successfully resisted that craving!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:ee==="relapsed"?{title:" New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:{title:" Progress Recorded",message:"Your progress has been recorded locally and will sync when the connection is restored.",type:"info"}),m(!0),S(!1),N(1)}},Pe=async()=>{try{const ee=new Date().toISOString(),xe=new Date().toDateString();let pe=null;const{ref:je,set:be,push:ge,get:at}=await Ve(()=>import("./index.esm-1f127fec.js"),[]);if(n&&n.uid){const bt=je(ae,`users/${n.uid}/cravings`),dt=ge(bt);await be(dt,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:ee,date:xe});const Xe=je(ae,`users/${n.uid}/profile/cravingStats`),st={resisted:w.resisted+1,relapses:w.relapses,lastUpdated:ee};if(await be(Xe,st),U(st),window.centralizedStatService){console.log(" Quick Resistance: Using CentralizedStatService...");const Me=await window.centralizedStatService.getCurrentStats(),Ht=(Me==null?void 0:Me.mentalStrengthCravingsApplied)||0;console.log(" Quick Resistance: Current mental strength bonus before processing:",Ht);const Tt=await window.centralizedStatService.handleCravingResisted();if(console.log(" Quick Resistance: Stats updated via CentralizedStatService"),Tt&&Tt.applied){const tn=Tt.cravingsApplied||0,mn=Math.max(0,3-tn);console.log(" Quick Resistance: Bonus applied, remaining:",mn),mn>0?Q("Craving Resisted! ",`Great job! You earned +1 mental strength point. You can still earn ${mn} more today.`,"success"):Q("Craving Resisted! ","Excellent! You've reached the daily maximum of 3 mental strength points from craving resistance.","success")}else console.log(" Quick Resistance: Daily limit reached, showing limit message"),Q("Daily Mental Strength Limit Reached","You've already earned the maximum 3 mental strength points from craving resistance today. Keep up the great work! Your resistance still counts for your overall progress.","info");typeof window.refreshArenaStats=="function"&&(console.log(" Quick Resistance: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log(" Quick Resistance: Secondary Arena stats refresh..."),window.refreshArenaStats()},1e3)),window.centralizedStatService&&window.centralizedStatService.getCurrentStats().then(tn=>{window.dispatchEvent(new CustomEvent("statsUpdated",{detail:tn}))});return}else _&&(pe=await _.checkDailyCravingResistanceLimits(xe),await _.handleCravingResistance());const Le=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Le.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:ee,date:xe}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Le));const he={resisted:w.resisted+1,relapses:w.relapses,lastUpdated:ee};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(he)),U(he),pe?!pe.canAwardMentalStrength&&!pe.canAwardTriggerDefense?v({title:" Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):pe.canAwardMentalStrength?pe.canAwardTriggerDefense?v({title:" Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):v({title:" Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):v({title:" Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):v({title:" Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),m(!0)}}catch(ee){console.error("Error recording quick resistance:",ee),v({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),m(!0)}},Ee=async()=>{try{const ee=new Date().toISOString(),xe=new Date().toDateString();if(n&&n.uid){const{ref:be,set:ge,push:at}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),bt=be(ae,`users/${n.uid}/cravings`),dt=at(bt);if(await ge(dt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:ee,date:xe}),window.centralizedStatService){if(console.log(" Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log(" Quick Relapse: Stats updated via CentralizedStatService"),console.log(" Quick Relapse: Resetting buddy streak data after relapse..."),typeof setBuddyStreakData=="function"&&(setBuddyStreakData({streakDisplayText:"0 hours",streakDays:0,streakUnit:"hours"}),console.log(" Quick Relapse: Buddy streak data reset to 0 hours")),console.log(" Quick Relapse: Refreshing user stats after relapse..."),typeof calculateRealTimeStats=="function"&&n)try{const Le=await calculateRealTimeStats(n);Le&&(console.log(" Quick Relapse: Updated user stats after relapse:",Le.streakDisplayText),typeof setRealTimeUserStats=="function"&&(setRealTimeUserStats(Le),console.log(" Quick Relapse: User stats refreshed after relapse")))}catch(Le){console.error(" Quick Relapse: Failed to refresh user stats:",Le)}Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! `,"warning")}else if(_){console.log(" Quick Relapse: Calling StatManager.handleRelapse()...");const Le=await _.handleRelapse();if(console.log(" Quick Relapse: StatManager.handleRelapse() result:",Le),o)try{const he=await _.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:he,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:he===1?4:he===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log(" Quick relapse also logged to Firestore for analytics")}catch(he){console.warn(" Could not log quick relapse to Firestore:",he.message),await Ne("relapse",{escalationLevel:await _.getCurrentEscalationLevel(),triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}if(console.log(" Quick Relapse: Resetting buddy streak data after relapse (StatManager path)..."),typeof setBuddyStreakData=="function"&&(setBuddyStreakData({streakDisplayText:"0 hours",streakDays:0,streakUnit:"hours"}),console.log(" Quick Relapse: Buddy streak data reset to 0 hours (StatManager path)")),console.log(" Quick Relapse: Refreshing user stats after relapse (StatManager path)..."),typeof calculateRealTimeStats=="function"&&n)try{const he=await calculateRealTimeStats(n);he&&(console.log(" Quick Relapse: Updated user stats after relapse (StatManager path):",he.streakDisplayText),typeof setRealTimeUserStats=="function"&&(setRealTimeUserStats(he),console.log(" Quick Relapse: User stats refreshed after relapse (StatManager path)")))}catch(he){console.error(" Quick Relapse: Failed to refresh user stats (StatManager path):",he)}try{await new Promise(Tt=>setTimeout(Tt,100));const{ref:he,get:Me}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),Ht=await Me(he(ae,`users/${n.uid}/stats`));if(Ht.exists()){const Tt=Ht.val();console.log(" Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",Tt)}else console.log(" Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(he){console.error(" Quick Relapse: VERIFICATION failed:",he)}try{const he=await _.getCurrentEscalationLevel();let Me=0;switch(he){case 1:Me=4;break;case 2:Me=6;break;default:Me=8;break}Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

 Stat Changes:
 Addiction: +${Me} points
 Mental Strength: -3 points
 Trigger Defense: -3 points

Your journey continues! `,"warning")}catch(he){console.warn("Could not get escalation level for message:",he),Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! `,"warning")}}else console.error(" Quick Relapse: StatManager not available!"),Q(" Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const Xe=be(ae,`users/${n.uid}/profile/cravingStats`),st={resisted:w.resisted,relapses:w.relapses+1,lastUpdated:ee};await ge(Xe,st),U(st),console.log(" Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log(" Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log(" Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)"),typeof window.refreshAfterRelapse=="function"?(console.log(" Quick Relapse: Comprehensive Arena refresh after relapse..."),window.refreshAfterRelapse(),setTimeout(()=>{console.log(" Quick Relapse: Secondary comprehensive Arena refresh..."),window.refreshAfterRelapse()},2e3)):typeof window.refreshArenaStats=="function"?(console.log(" Quick Relapse: Fallback to regular Arena stats refresh..."),window.refreshArenaStats(),setTimeout(()=>{console.log(" Quick Relapse: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3)):console.warn(" Quick Relapse: No Arena refresh functions available"),console.log(" Quick Relapse: Triggering immediate PWA refresh..."),typeof window.refreshArenaStats=="function"&&(console.log(" Quick Relapse: Immediate Arena stats refresh..."),window.refreshArenaStats()),typeof setUser=="function"&&setUser(Le=>({...Le,lastRelapseRefresh:Date.now()})),window.centralizedStatService&&window.centralizedStatService.getCurrentStats().then(Le=>{console.log(" Quick Relapse: Fetched latest stats after relapse:",Le),typeof window.setLatestUserStats=="function"&&window.setLatestUserStats(Le),window.dispatchEvent(new CustomEvent("statsUpdated",{detail:Le}))}).catch(Le=>{console.error(" Quick Relapse: Failed to fetch latest stats:",Le)}),setTimeout(()=>{console.log(" Quick Relapse: Secondary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats(),window.dispatchEvent(new Event("resize"))},100),setTimeout(()=>{console.log(" Quick Relapse: Tertiary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats()},500)}const pe=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");pe.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:ee,date:xe}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(pe));const je={resisted:w.resisted,relapses:w.relapses+1,lastUpdated:ee};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(je)),U(je)}catch(ee){console.error("Error recording quick relapse:",ee),Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! `,"warning")}},Je=async(ee,xe=30)=>{try{if(!ee)return null;const{ref:pe,get:je,query:be,orderByChild:ge,startAt:at,endAt:bt}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),dt=new Date,Xe=new Date(dt.getTime()-xe*24*60*60*1e3),st=pe(ae,`users/${ee}/cravings`),Le=await je(st);if(!Le.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const Me=Object.values(Le.val()||{}).filter(qe=>{const Qe=new Date(qe.timestamp);return Qe>=Xe&&Qe<=dt});if(Me.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const Ht=Me.filter(qe=>qe.outcome==="resisted").length,Tt=Me.filter(qe=>qe.outcome==="relapsed").length,tn=Me.length,mn=Me.reduce((qe,Qe)=>qe+(Qe.strength||0),0)/tn,Qt={},xn={},nn={},pn={};Me.forEach(qe=>{qe.mood&&(Qt[qe.mood]=(Qt[qe.mood]||0)+1),qe.context&&(xn[qe.context]=(xn[qe.context]||0)+1),qe.timeOfDay&&(nn[qe.timeOfDay]=(nn[qe.timeOfDay]||0)+1);const Qe=new Date(qe.timestamp),rn=`${Qe.getFullYear()}-W${Math.ceil((Qe.getDate()+new Date(Qe.getFullYear(),0,1).getDay())/7)}`;pn[rn]=(pn[rn]||0)+1});const un=Object.entries(Qt).sort(([,qe],[,Qe])=>Qe-qe).slice(0,3).map(([qe,Qe])=>({mood:qe,count:Qe})),Kt=Object.entries(xn).sort(([,qe],[,Qe])=>Qe-qe).slice(0,3).map(([qe,Qe])=>({context:qe,count:Qe})),Hn=[];return Ht>Tt&&Hn.push("You're successfully resisting more cravings than giving in - great job!"),mn>7&&Hn.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),nn.afternoon>nn.morning&&nn.afternoon>nn.evening&&Hn.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),un.length>0&&un[0].count>tn*.4&&Hn.push(`You often experience cravings when feeling ${un[0].mood}. This might be a key trigger to address.`),{totalCravings:tn,resistedCount:Ht,relapseCount:Tt,averageStrength:Math.round(mn*10)/10,successRate:tn>0?Math.round(Ht/tn*100):0,commonMoods:un,commonContexts:Kt,timeOfDayPatterns:nn,weeklyTrends:pn,insights:Hn,dateRange:{start:Xe.toDateString(),end:dt.toDateString(),days:xe}}}catch(pe){return console.error("Error getting craving insights:",pe),null}},Et=async(ee,xe="json")=>{try{if(!ee)return null;const{ref:pe,get:je}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),be=pe(ae,`users/${n.uid}/cravings`),ge=await je(be);if(!ge.exists())return console.log("No craving data to export"),null;const at=Object.values(ge.val()||{});if(xe==="json"){const bt=JSON.stringify(at,null,2),dt=new Blob([bt],{type:"application/json"}),Xe=URL.createObjectURL(dt),st=document.createElement("a");return st.href=Xe,st.download=`craving-data-${ee}-${new Date().toISOString().split("T")[0]}.json`,st.click(),URL.revokeObjectURL(Xe),console.log(`Exported ${at.length} craving records for user ${ee}`),at.length}return at.length}catch(pe){return console.error("Error exporting craving data:",pe),null}},ut=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log(" Testing craving insights...");const ee=await Je(n.uid,30);ee?(console.log(" Craving Insights:",ee),v({title:" Your Craving Insights",message:`Last 30 days:

Total cravings: ${ee.totalCravings}
Successfully resisted: ${ee.resistedCount}
Relapses: ${ee.relapseCount}
Success rate: ${ee.successRate}%
Average intensity: ${ee.averageStrength}/10

Top mood triggers: ${ee.commonMoods.map(xe=>`${xe.mood} (${xe.count})`).join(", ")}
Top contexts: ${ee.commonContexts.map(xe=>`${xe.context} (${xe.count})`).join(", ")}

Insights:
${ee.insights.join(`
`)}`,type:"info"}),m(!0)):(console.log("No insights available"),v({title:" No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),m(!0))};return l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[l.jsx("div",{className:"mb-8",children:l.jsxs("div",{className:"flex justify-start gap-3",children:[l.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:" Back to Login"}),!1]})}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[l.jsx("div",{className:"mb-8",children:l.jsx("button",{onClick:De,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-xl",children:""}),l.jsx("span",{children:"I feel like vaping"})]})})}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsx("button",{onClick:Pe,className:"btn-success touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-green-400",children:""}),l.jsx("span",{children:"I resisted craving"})]})}),l.jsx("button",{onClick:Ee,className:"btn-danger touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-red-400",children:""}),l.jsx("span",{children:"I relapsed"})]})})]})]}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:" This Week"}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[l.jsx("div",{className:"text-2xl mb-3 text-green-400",children:""}),l.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:w.resisted}),l.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),l.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[l.jsx("div",{className:"text-2xl mb-3 text-red-400",children:""}),l.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:w.relapses}),l.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),l.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:" Distract Yourself"}),l.jsx("div",{className:"flex justify-center",children:l.jsx("button",{onClick:Z,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:" Play Snake"})})]})}),l.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:" Data Analysis"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx("button",{onClick:ut,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg min-h-[44px]",children:" View Insights"}),l.jsx("button",{onClick:()=>Et(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg min-h-[44px]",children:" Export Data"})]})]})}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:" Quick Actions"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx("button",{onClick:()=>I(!0),className:"btn-primary touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:" Hydration"}),l.jsx("button",{onClick:()=>V(!0),className:"breathing-button touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:" Breathe"}),l.jsx("button",{onClick:async()=>{if(Q(" Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log(" Physical activity (walk) logged to Firestore for analytics")}catch(ee){console.warn(" Could not log physical activity to Firestore:",ee.message),await Ne("walk",{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"})}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:" Walk"}),l.jsx("button",{onClick:async()=>{if(Q(" Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log(" Meditation (quick) logged to Firestore for analytics")}catch(ee){console.warn(" Could not log meditation to Firestore:",ee.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:" Meditate"})]})]}),a&&u&&l.jsx(U8,{gameType:u,onClose:me}),l.jsx($8,{isOpen:f,onClose:()=>m(!1),title:g.title,message:g.message,type:g.type}),x&&l.jsx(q8,{isOpen:x,onClose:()=>I(!1),onLogWater:we,currentWater:C,userId:n.uid}),$&&l.jsx(c8,{isOpen:$,onClose:()=>V(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),A&&l.jsx(z8,{isOpen:A,onClose:()=>S(!1),step:E,cravingData:k,setCravingData:b,onNext:Re,onPrev:vt,onComplete:Ae,dailyCravingLogs:q})]})})},z8=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:c})=>{const u=g=>g<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:g<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"",label:"Stressed"},{id:"lonely",icon:"",label:"Lonely"},{id:"happy",icon:"",label:"Happy"},{id:"bored",icon:"",label:"Bored"},{id:"excited",icon:"",label:"Excited"},{id:"down",icon:"",label:"Down"},{id:"angry",icon:"",label:"Angry"},{id:"anxious",icon:"",label:"Anxious"}],f=[{id:"break",icon:"",label:"I'm taking a break"},{id:"partying",icon:"",label:"I'm partying"},{id:"drinking",icon:"",label:"I'm drinking alcohol"},{id:"car",icon:"",label:"I'm in a car"},{id:"coffee",icon:"",label:"I'm drinking coffee"},{id:"eating",icon:"",label:"I've just finished eating"},{id:"intimate",icon:"",label:"I've made love"},{id:"tv",icon:"",label:"I'm watching TV"},{id:"wake",icon:"",label:"I've just woken up"}],m=()=>{switch(t){case 1:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"mb-8",children:(()=>{const g=u(r.strength);return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:`text-6xl font-bold mb-2 ${g.text} ${g.effect}`,children:r.strength}),l.jsxs("div",{className:`text-lg font-medium mb-6 ${g.text}`,children:[g.label," Craving"]}),l.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:v=>s({...r,strength:parseInt(v.target.value)}),style:{background:`linear-gradient(to right, ${g.slider} 0%, ${g.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${g.thumbClass}`,autoComplete:"off"}),l.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[l.jsx("span",{children:"Not at all"}),l.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(g=>l.jsxs("button",{onClick:()=>s({...r,mood:g.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.mood===g.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[l.jsx("div",{className:"text-3xl mb-2",children:g.icon}),l.jsx("div",{className:"text-xs text-gray-300",children:g.label})]},g.id))})});case 3:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(g=>l.jsxs("button",{onClick:()=>s({...r,context:g.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.context===g.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[l.jsx("div",{className:"text-2xl mb-2",children:g.icon}),l.jsx("div",{className:"text-xs text-gray-300 text-center",children:g.label})]},g.id))})});case 4:return l.jsx("div",{className:"text-center",children:l.jsxs("div",{className:"space-y-4",children:[l.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" I successfully resisted"}),l.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" Use resistance practices"}),l.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" Just log this craving"}),l.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" I had a relapse"})]})});default:return null}};return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 border-slate-600/50 relative overflow-hidden max-w-lg",children:[l.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),l.jsxs("div",{className:"relative z-10",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(g=>l.jsx("div",{className:`w-3 h-3 rounded-full ${g<=t?"bg-orange-400":"bg-slate-600"}`},g))}),l.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),l.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",c,"/2"]})]}),l.jsx("div",{className:"mb-8",children:m()}),l.jsxs("div",{className:"flex justify-between",children:[t>1&&l.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:" Back"}),t<4&&l.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next "})]}),l.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:""})]})]})})}):null},q8=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=D.useState(0),[a,c]=D.useState(0),[u,h]=D.useState(!1);D.useState(!1),D.useEffect(()=>{n&&s&&f()},[n,s,r]);const f=async()=>{try{const{ref:R,get:x}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),I=await m();o(I);const C=await g();c(C)}catch(R){console.error("Error loading hydration data:",R)}},m=async()=>{try{const{ref:R,get:x}=await Ve(()=>import("./index.esm-1f127fec.js"),[]);let I=0;for(let C=0;C<7;C++){const P=new Date;P.setDate(P.getDate()-C);const $=P.toDateString(),V=await x(R(ae,`users/${s}/profile/daily/${$}/water`));if(V.exists()&&V.val()>0)I++;else break}return I}catch(R){return console.error("Error checking hydration streak:",R),0}},g=async()=>{try{const{ref:R,get:x}=await Ve(()=>import("./index.esm-1f127fec.js"),[]);let I=0;for(let C=0;C<7;C++){const P=new Date;P.setDate(P.getDate()-C);const $=P.toDateString(),V=await x(R(ae,`users/${s}/profile/daily/${$}/water`));V.exists()&&V.val()>=6&&I++}return Math.min(I,3)}catch(R){return console.error("Error checking mental strength progress:",R),0}},v=()=>l.jsx("div",{className:"glasses-visual",children:[...Array(6)].map((R,x)=>{const I=x<r;return l.jsx("div",{className:`glass ${I?"filled":""}`},x)})}),_=async()=>{!s||u||r>=6||(h(!0),t(),setTimeout(async()=>{h(!1),await f()},1e3))};return!n||!s?null:l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content",children:l.jsxs("div",{className:"hydration-module",children:[l.jsxs("div",{className:"module-header",children:[l.jsxs("div",{className:"module-title",children:[l.jsx("div",{className:"water-icon",children:""}),"Hydration Tracker"]}),l.jsx("p",{className:"subtitle",children:"Stay hydrated, stay strong"})]}),l.jsxs("div",{className:"progress-container",children:[l.jsxs("div",{className:"progress-header",children:[l.jsx("span",{className:"progress-text",children:"Today's Progress"}),l.jsxs("span",{className:"progress-fraction",children:[r,"/6"]})]}),v(),l.jsx("div",{className:"progress-bar",children:l.jsx("div",{className:"progress-fill",style:{width:`${r/6*100}%`}})}),l.jsxs("div",{className:"progress-percentage",children:[Math.round(r/6*100),"% Complete"]})]}),l.jsxs("div",{className:"streak-section",children:[l.jsxs("div",{className:"streak-card",children:[l.jsx("span",{className:"streak-icon",children:""}),l.jsx("div",{className:"streak-label",children:"Hydration Streak"}),l.jsxs("div",{className:"streak-value",children:[i," days"]})]}),l.jsxs("div",{className:"streak-card",children:[l.jsx("span",{className:"streak-icon",children:""}),l.jsx("div",{className:"streak-label",children:"Mental Strength"}),l.jsxs("div",{className:"streak-value",children:[a,"/3"]})]})]}),r===6&&l.jsx("div",{className:"completion-message",children:" Congratulations! You've completed your daily hydration goal!"}),l.jsx("button",{onClick:_,disabled:r>=6||u,className:"log-button",children:r>=6?" Goal Complete!":u?" Logging...":" Log Water"}),l.jsx("button",{onClick:e,className:"done-button",children:"Done"})]})})})})},W8=({user:n,onNavigate:e})=>{const[t,r]=D.useState(null),[s,i]=D.useState(!1),[o,a]=D.useState(!1),[c,u]=D.useState(!1),[h,f]=D.useState(!1),[m,g]=D.useState(null),[v,_]=D.useState(0),[R,x]=D.useState(null),[I,C]=D.useState(!1),[P,$]=D.useState([]),[V,A]=D.useState(null);D.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const Ee=new Bg(ae,n.uid);await Ee.initialize(),A(Ee)}catch(Ee){console.error("Error initializing StatManager:",Ee)}})();const Ae=async()=>{try{const{ref:Ee,get:Je,onValue:Et}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),ut=Ee(ae,`users/${n.uid}/profile/relapseDate`),ee=await Je(ut);ee.exists()&&r(new Date(ee.val()));const xe=Ee(ae,`users/${n.uid}/profile/scheduledTriggers`),pe=await Je(xe);pe.exists()&&$(pe.val());const je=new Date().toDateString(),be=Ee(ae,`users/${n.uid}/profile/daily/${je}/water`),ge=Et(be,he=>{he.exists()&&_(he.val()||0)}),at=Ee(ae,`users/${n.uid}/profile/daily/${je}/mood`),bt=Et(at,he=>{he.exists()&&x(he.val())}),dt=Ee(ae,`users/${n.uid}/profile/daily/${je}/breathing`),Xe=Et(dt,he=>{he.exists()&&C(he.val()||!1)}),st=Ee(ae,`users/${n.uid}/profile/scheduledTriggers`),Le=Et(st,he=>{he.exists()&&$(he.val()||[])});return()=>{ge(),bt(),Xe(),Le()}}catch(Ee){console.error("Error loading profile data from Firebase:",Ee),Pe()}},Pe=()=>{const Ee=localStorage.getItem("quitCoachRelapseDate");Ee&&r(new Date(Ee));const Je=new Date().toDateString(),Et=localStorage.getItem(`water_${n.uid}_${Je}`),ut=localStorage.getItem(`mood_${n.uid}_${Je}`),ee=localStorage.getItem(`breathing_${n.uid}_${Je}`);Et&&_(parseInt(Et)),ut&&x(JSON.parse(ut)),ee&&C(ee==="true");const xe=localStorage.getItem("scheduledTriggers");xe&&$(JSON.parse(xe))};Ae()},[n==null?void 0:n.uid]),D.useEffect(()=>{V&&V.trackLoggingActivity()},[V]),D.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:Ae,get:Pe,set:Ee}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),Je=Ae(ae,`users/${n.uid}/profile`),Et=await Pe(Je);if(!Et.exists()||Object.keys(Et.val()).length===0){console.log("Migrating localStorage data to Firebase...");const ut=localStorage.getItem("quitCoachRelapseDate");ut&&(await Ee(Ae(ae,`users/${n.uid}/profile/relapseDate`),ut),r(new Date(ut)));const ee=parseInt(localStorage.getItem("cravingWins")||0);ee>0&&await Ee(Ae(ae,`users/${n.uid}/profile/cravingsResisted`),ee);for(let pe=0;pe<7;pe++){const je=new Date;je.setDate(je.getDate()-pe);const be=je.toDateString(),ge=localStorage.getItem(`water_${n.uid}_${be}`);ge&&await Ee(Ae(ae,`users/${n.uid}/profile/daily/${be}/water`),parseInt(ge))}for(let pe=0;pe<7;pe++){const je=new Date;je.setDate(je.getDate()-pe);const be=je.toDateString(),ge=localStorage.getItem(`mood_${n.uid}_${be}`);ge&&await Ee(Ae(ae,`users/${n.uid}/profile/daily/${be}/mood`),JSON.parse(ge))}for(let pe=0;pe<7;pe++){const je=new Date;je.setDate(je.getDate()-pe);const be=je.toDateString(),ge=localStorage.getItem(`breathing_${n.uid}_${be}`);ge&&await Ee(Ae(ae,`users/${n.uid}/profile/daily/${be}/breathing`),ge==="true")}const xe=localStorage.getItem("scheduledTriggers");if(xe){const pe=JSON.parse(xe);await Ee(Ae(ae,`users/${n.uid}/profile/scheduledTriggers`),pe),$(pe)}console.log("localStorage data migration to Firebase completed")}}catch(Ae){console.error("Error migrating localStorage data to Firebase:",Ae)}})()},[n==null?void 0:n.uid]);const S=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,E=()=>{const Ne=new Date,Ae=new Date(Ne);Ae.setHours(24,0,0,0);const Pe=Ae-Ne,Ee=Math.floor(Pe/(1e3*60*60)),Je=Math.floor(Pe%(1e3*60*60)/(1e3*60)),Et=Math.floor(Pe%(1e3*60)/1e3);return{hours:Ee,minutes:Je,seconds:Et}},[N,k]=D.useState(E()),[b,w]=D.useState(0),[U,q]=D.useState(0),[ve,Te]=D.useState(0),[z,ne]=D.useState(0);D.useEffect(()=>{const Ne=setInterval(()=>{k(E());const Ae=S(),Ee=new Date-Ae,Je=Math.floor(Ee/(1e3*60*60*24)),Et=Math.floor(Ee%(1e3*60*60*24)/(1e3*60*60)),ut=Math.floor(Ee%(1e3*60*60)/(1e3*60)),ee=Math.floor(Ee%(1e3*60)/1e3);w(Je),q(Et),Te(ut),ne(ee)},1e3);return()=>clearInterval(Ne)},[t,n==null?void 0:n.quitDate]);const W=async(Ne,Ae)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:Pe,set:Ee}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),Je=Pe(ae,`users/${n.uid}/profile/${Ne}`);return await Ee(Je,Ae),!0}catch(Pe){return console.error("Error saving to Firebase:",Pe),!1}},Q=async()=>{const Ne=new Date;r(Ne),V&&await V.handleRelapse();const Ae=Ne.toISOString(),Pe=await W("relapseDate",Ae),Ee=await W("lastQuitDate",Ae);Pe||localStorage.setItem("quitCoachRelapseDate",Ae),Ee||localStorage.setItem("quitCoachLastQuitDate",Ae),console.log(" Relapse logged - quit date reset to relapse time:",Ae)},me=(()=>{const Ne=new Date,Ae=Ne.getDay(),Pe=Ae===0?6:Ae-1,Ee=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let Je=0;Je<=Pe;Je++)Ee[Je].color="bg-green-500";return t&&t.toDateString()===Ne.toDateString()&&(Ee[Pe].color="bg-red-500"),Ee})(),we=async Ne=>{_(Ne);const Ae=new Date().toDateString();V&&await V.handleHydrationUpdate(Ne),await W(`daily/${Ae}/water`,Ne)||localStorage.setItem(`water_${Ae}`,Ne.toString()),i(!1)},De=async Ne=>{x(Ne);const Ae=new Date().toDateString();await W(`daily/${Ae}/mood`,Ne)||localStorage.setItem(`mood_${Ae}`,JSON.stringify(Ne)),a(!1)},Re=async(Ne,Ae,Pe)=>{const Ee={day:Ne,triggerType:Ae,time:Pe,id:Date.now()},Je=[...P,Ee];$(Je),V&&await V.handleTriggerPlanning(),await W("scheduledTriggers",Je)||localStorage.setItem("scheduledTriggers",JSON.stringify(Je)),u(!1)},vt=async()=>{V&&await V.handleTriggerListUpdate()};return l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[l.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?l.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):l.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white text-lg",children:"Hello,"}),l.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),l.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:l.jsx("span",{className:"font-bold text-slate-900",children:b})})]}),l.jsxs("div",{className:"px-4 space-y-6",children:[l.jsx("div",{className:"mb-6",children:l.jsxs("button",{onClick:Q,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-2xl",children:""}),l.jsx("span",{className:"text-lg",children:"RELAPSE"}),l.jsx("span",{className:"text-2xl",children:""})]}),l.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),l.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[l.jsx("span",{className:"text-white text-sm",children:""}),l.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),l.jsx("div",{className:"flex justify-between items-center mb-4",children:me.map((Ne,Ae)=>l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${Ne.color}`}),l.jsx("p",{className:"text-gray-400 text-xs",children:Ne.name})]},Ne.name))})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"text-white text-3xl font-bold",children:[N.hours.toString().padStart(2,"0"),":",N.minutes.toString().padStart(2,"0"),":",N.seconds.toString().padStart(2,"0")]}),l.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx("span",{className:"text-yellow-400 text-lg",children:""}),l.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),l.jsxs("div",{className:"flex items-baseline gap-4",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:b.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:U.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:ve.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:z.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&l.jsx("div",{className:"mt-3 text-center",children:l.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),l.jsx("p",{className:"text-gray-300 text-sm",children:v>0?`${v} glasses today`:"Tap to log water intake"})]}),l.jsx("div",{className:"text-blue-400 text-2xl",children:""})]})}),l.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),l.jsx("p",{className:"text-gray-300 text-sm",children:R?`You feel ${R.name.toLowerCase()}`:"How do you feel today?"})]}),l.jsx("div",{className:"text-green-400 text-2xl",children:""})]})})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),l.jsx("p",{className:"text-gray-300 text-sm",children:P.length>0?`${P.length} triggers planned`:"Plan your trigger defense strategy"})]}),l.jsx("div",{className:"text-orange-400 text-2xl",children:""})]})}),l.jsx("button",{onClick:vt,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),l.jsx("div",{className:"text-purple-400 text-2xl",children:""})]})})]})]}),l.jsx("div",{children:l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),l.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),l.jsx("div",{className:"text-indigo-400 text-2xl",children:""})]})})]})]}),l.jsx(G8,{isOpen:s,onClose:()=>i(!1),onConfirm:we,currentWater:v}),l.jsx(H8,{isOpen:o,onClose:()=>a(!1),onSelect:De,selectedMood:R}),l.jsx(Q8,{isOpen:c,onClose:()=>u(!1),onSchedule:Re,scheduledTriggers:P}),l.jsx(K8,{isOpen:h,onClose:()=>f(!1),selectedDate:m,onDateSelect:g,dailyData:{water:v,mood:R,breathing:I,relapseDate:t}})]})},G8=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=D.useState(r),{modalRef:o,classes:a}=mS(e,{threshold:80,velocity:.4,enabled:!0});return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:o,className:`modal-content bg-slate-800 border-slate-700 ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"water-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"text-center mb-6 p-4",children:[l.jsx("h3",{id:"water-modal-title",className:"text-xl font-bold text-white mb-2",children:" Water Intake"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),l.jsx("div",{className:"mb-6 px-4",children:l.jsxs("div",{className:"form-group",children:[l.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:c=>i(parseInt(c.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0",autoComplete:"off","aria-label":"Number of glasses of water"}),l.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]})}),l.jsxs("div",{className:"modal-actions px-4 pb-4",children:[l.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"}),l.jsx("button",{onClick:()=>t(s),className:"modal-button modal-button-primary",children:"Confirm"})]})]})]})})}):null},H8=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"",color:"bg-red-500"},{name:"Disgust",icon:"",color:"bg-orange-500"},{name:"Enjoyment",icon:"",color:"bg-yellow-500"},{name:"Calm",icon:"",color:"bg-blue-500"},{name:"Fear",icon:"",color:"bg-purple-500"},{name:"Sadness",icon:"",color:"bg-indigo-500"},{name:"Indifferent",icon:"",color:"bg-gray-500"}],{modalRef:i,classes:o}=mS(e,{threshold:80,velocity:.4,enabled:!0});return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:i,className:`modal-content bg-slate-800 border-slate-700 ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"text-center mb-6 p-4",children:[l.jsx("h3",{id:"mood-modal-title",className:"text-xl font-bold text-white mb-2",children:" How do you feel?"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),l.jsx("div",{className:"modal-grid modal-grid-2 gap-3 mb-6 px-4",children:s.map(a=>l.jsxs("button",{onClick:()=>t(a),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 min-h-[44px] ${(r==null?void 0:r.name)===a.name?"ring-2 ring-blue-400 bg-blue-600":"bg-slate-700 hover:bg-slate-600"}`,"aria-pressed":(r==null?void 0:r.name)===a.name,"aria-label":`Select ${a.name} mood`,children:[l.jsx("div",{className:`w-12 h-12 ${a.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:a.icon}),l.jsx("p",{className:"text-white font-semibold",children:a.name})]},a.name))}),l.jsx("div",{className:"modal-actions px-4 pb-4",children:l.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"})})]})]})})}):null},Q8=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=D.useState(""),[o,a]=D.useState(""),[c,u]=D.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:" Trigger Defense Planning"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),l.jsxs("div",{className:"space-y-4 mb-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),l.jsxs("select",{value:s,onChange:m=>i(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select a day"}),f.map(m=>l.jsx("option",{value:m,children:m},m))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),l.jsxs("select",{value:o,onChange:m=>a(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select trigger type"}),h.map(m=>l.jsx("option",{value:m,children:m},m))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),l.jsx("input",{type:"time",value:c,onChange:m=>u(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",autoComplete:"off"})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),l.jsx("button",{onClick:()=>{s&&o&&c&&t(s,o,c)},disabled:!s||!o||!c,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})})}):null},K8=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:" Daily Summary"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),l.jsxs("div",{className:"space-y-4 mb-6",children:[l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:" Water Intake"}),l.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:" Mood"}),l.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:" Breathing Exercise"}),l.jsx("p",{className:"text-gray-300",children:s.breathing?" Completed":" Not completed"})]}),s.relapseDate&&l.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[l.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:" Relapse"}),l.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),l.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors min-h-[44px]",children:"Close"})]})})}):null,Y8=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,behavioralService:r,user:s,onShowAnalytics:i,onShowPerformanceDashboard:o,onShowBetaMonitoring:a})=>l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:l.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx(w2,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),l.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:" Behavioral Analytics"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),l.jsx("button",{onClick:i,disabled:!r,className:`w-full py-3 rounded-lg transition-colors mb-3 ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:r?" View Analytics Dashboard":" Analytics (Service Loading...)"}),r&&l.jsx("button",{onClick:async()=>{try{await r.logCraving(s.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await r.logBreathingExercise(s.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert(" Test data added to Firestore for analytics demo!")}catch(c){alert(" Error adding test data: "+c.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition-colors text-sm min-h-[44px]",children:" Add Test Data"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:" Performance Monitoring"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Monitor app performance and run stress tests"}),l.jsx("button",{onClick:o,className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors mb-3 min-h-[44px]",children:" Open Performance Dashboard"}),l.jsx("p",{className:"text-gray-500 text-xs",children:"View database performance, authentication metrics, offline queue status, and run stress tests"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:" Beta Safety Monitoring"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Monitor safety measures and beta testing metrics"}),l.jsx("button",{onClick:a,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors mb-3 min-h-[44px]",children:" Open Beta Monitoring Dashboard"}),l.jsx("p",{className:"text-gray-500 text-xs",children:"View data backup status, privacy compliance, error logs, rate limiting, and system health"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),l.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:" Back to Login"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),l.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),l.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),l.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),J8=()=>{const[n,e]=D.useState("arena"),[t,r]=D.useState("auth"),[s,i]=D.useState(null),[o,a]=D.useState(null),[c,u]=D.useState(!1),[h,f]=D.useState(!1),[m,g]=D.useState(!1),[v,_]=D.useState(!1),[R,x]=D.useState(null),[I,C]=D.useState(!0),[P,$]=D.useState(!1),[V,A]=D.useState(0),[S,E]=D.useState(!1),[N,k]=D.useState(0),[b,w]=D.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[U,q]=D.useState([]),[ve,Te]=D.useState(null),[z,ne]=D.useState(null),[W,Q]=D.useState(null);D.useEffect(()=>{const O=te=>{window.deferredPrompt=te,$(!0),console.log(" PWA: beforeinstallprompt captured (App state set)")},Y=()=>{$(!1),console.log(" PWA installed (App state cleared)")};return window.addEventListener("beforeinstallprompt",O),window.addEventListener("appinstalled",Y),()=>{window.removeEventListener("beforeinstallprompt",O),window.removeEventListener("appinstalled",Y)}},[]),D.useEffect(()=>{let O=0,Y=0,te=!1;const et=80,_t=Ye=>{O=Ye.touches[0].clientY,te=!1},gn=Ye=>{if(window.scrollY>0)return;Y=Ye.touches[0].clientY;const it=Y-O;it>0&&(te=!0,Ye.preventDefault(),k(Math.min(it,et*1.5)))},Se=async()=>{if(!te)return;Y-O>et?(E(!0),k(0),typeof window.refreshArenaStats=="function"&&(console.log(" Pull-to-refresh: Refreshing stats..."),await window.refreshArenaStats()),typeof refreshStats=="function"&&(console.log(" Pull-to-refresh: Calling main refresh..."),refreshStats()),setTimeout(()=>{E(!1)},1e3)):k(0),te=!1};return document.addEventListener("touchstart",_t,{passive:!1}),document.addEventListener("touchmove",gn,{passive:!1}),document.addEventListener("touchend",Se,{passive:!1}),()=>{document.removeEventListener("touchstart",_t),document.removeEventListener("touchmove",gn),document.removeEventListener("touchend",Se)}},[]);const Z=async()=>{try{if(window.promptPWAInstall){const te=await window.promptPWAInstall();te&&te.outcome==="accepted"&&$(!1);return}const O=window.deferredPrompt;if(!O)return;O.prompt();const Y=await O.userChoice;window.deferredPrompt=null,Y.outcome==="accepted"&&$(!1)}catch(O){console.warn("PWA install prompt failed:",O==null?void 0:O.message)}},me=async()=>{try{if(!Yv){console.error(" Firestore instance is not available");return}const O=new p2(Yv);await O.testConnectivity()?(Te(O),console.log(" FirestoreBehavioralService initialized successfully")):console.warn(" Firestore behavioral service connectivity test failed")}catch(O){console.error(" Error initializing behavioral service:",O)}},we=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),De=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),Re=O=>{O.relapseDate&&ge(new Date(O.relapseDate)),O.dailyWater!==void 0&&bt(O.dailyWater),O.dailyMood!==void 0&&Xe(O.dailyMood),O.dailyBreathing!==void 0&&Le(O.dailyBreathing),O.scheduledTriggers&&Me(O.scheduledTriggers)},vt=async()=>{const O=new Date().toDateString();try{const{ref:Y,set:te}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),et=Y(ae,`users/${R==null?void 0:R.uid}/profile/daily/${O}/breathing`);await te(et,!0)}catch(Y){console.error("Error saving breathing exercise to Firebase:",Y),localStorage.setItem(`breathing_${R==null?void 0:R.uid}_${O}`,"true")}if(W)try{await W.handleBreathingExercise();const Y=await W.checkBreathingStreak(),te=Math.max(0,3-Y%3),et=Y>=3&&Y%3===0?` Excellent! You've completed a ${Y}-day breathing streak and earned +1 Mental Strength!`:` Breathing exercise completed! Current streak: ${Y} days. Complete ${te} more days to earn +1 Mental Strength.`;if(showQuickActionPopup(" Breathing Exercise Complete",`${et}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),ve)try{await ve.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:Y,mentalStrengthEarned:Y>=3&&Y%3===0}),console.log(" Breathing exercise also logged to Firestore for analytics")}catch(_t){console.warn(" Could not log breathing exercise to Firestore:",_t.message),await handleOfflineBehavioralLog("breathing",{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:Y,mentalStrengthEarned:Y>=3&&Y%3===0})}}catch(Y){console.warn(" Error handling breathing exercise completion:",Y.message),showQuickActionPopup(" Breathing Exercise Complete"," Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},Ne=(O,Y)=>{const te=document.createElement("div");te.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",te.innerHTML=`
      <div class="font-bold">${O}</div>
      <div class="text-sm opacity-90">${Y}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(te),setTimeout(()=>{te.parentNode&&te.parentNode.removeChild(te)},1e4)},Ae=async O=>{if(!O)return!1;w({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:Y,get:te,onValue:et}=await Ve(()=>import("./index.esm-1f127fec.js"),[]);w(Pt=>({...Pt,currentStep:"Loading profile data...",progress:20}));const _t=Y(ae,`users/${O}`),gn=await te(_t);if(!gn.exists())throw new Error("User profile not found");const Se=gn.val(),Ye=Pe(Se);w(Pt=>({...Pt,currentStep:"Loading battle stats...",progress:40}));const it=Y(ae,`users/${O}/stats`),At=await te(it),gt=At.exists()?Ee(At.val()):we();w(Pt=>({...Pt,currentStep:"Loading habits and progress...",progress:60}));const sn=Y(ae,`users/${O}/profile`),bi=await te(sn),Ir=bi.exists()?Je(bi.val()):De();w(Pt=>({...Pt,currentStep:"Loading achievements...",progress:80}));const ot=Y(ae,`users/${O}/profile/cravingsResisted`),wt=await te(ot),$n=wt.exists()?Math.max(0,parseInt(wt.val())||0):0;w(Pt=>({...Pt,currentStep:"Setting up live sync...",progress:90}));const Ya=et(it,Pt=>{if(Pt.exists()){const ts=Ee(Pt.val());if(console.log(" Firebase Listener: Stats changed, new stats:",ts),mn(ts),t==="arena"&&o){console.log(" Firebase Listener: Current user object:",o),console.log(" Firebase Listener: user.quitDate:",o.quitDate),console.log(" Firebase Listener: user.uid:",o.uid);const xs={...o,stats:ts};console.log(" Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",xs),console.log(" Firebase Listener: updatedUser.quitDate:",xs.quitDate),console.log(" Firebase Listener: updatedUser.uid:",xs.uid),calculateRealTimeStats(xs).then(ns=>{console.log(" Firebase Listener: calculateRealTimeStats returned:",ns),console.log(" Firebase Listener: calculatedStats.streakDays:",ns.streakDays),setRealTimeUserStats(ns)})}}}),zg=et(sn,Pt=>{if(Pt.exists()){const ts=Je(Pt.val());t==="profile"&&Re(ts)}}),Ja=et(ot,Pt=>{if(Pt.exists()){const ts=Math.max(0,parseInt(Pt.val())||0);t==="craving-support"&&Tt(ts)}});return q([Ya,zg,Ja]),w(Pt=>({...Pt,currentStep:"Finalizing...",progress:100})),a(Pt=>({...Pt,...Ye,...Ir,stats:gt})),Re(Ir),Tt($n),Ye.onboardingCompleted&&_(!0),w({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log(" All user data loaded successfully:",{profile:Ye,stats:gt,profileData:Ir,cravingsResisted:$n}),!0}catch(Y){return console.error(" Error loading user data:",Y),w({isLoading:!1,progress:0,currentStep:"Failed to load data",error:Y.message,isComplete:!1}),Ne("Failed to load user data",Y.message),!1}},Pe=O=>O?{uid:O.uid||"",email:O.email||"",heroName:O.heroName||"Hero",archetype:O.archetype||"The Determined",avatar:O.avatar||pu("default"),quitDate:O.quitDate,onboardingCompleted:!!O.onboardingCompleted,updatedAt:O.updatedAt||Date.now(),...O}:Et(),Ee=O=>O?{mentalStrength:Math.max(0,Math.min(100,parseInt(O.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(O.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(O.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(O.addictionLevel)||50)),streakDays:Math.max(0,parseInt(O.streakDays)||0),streakUnit:O.streakUnit||"hours",streakDisplayText:O.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(O.cravingsResisted)||0),...O}:we(),Je=O=>O?{dailyWater:Math.max(0,parseInt(O.dailyWater)||0),dailyMood:O.dailyMood||null,dailyBreathing:!!O.dailyBreathing,scheduledTriggers:Array.isArray(O.scheduledTriggers)?O.scheduledTriggers:[],relapseDate:O.relapseDate?new Date(O.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(O.cravingsResisted)||0),...O}:De(),Et=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:pu("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});D.useEffect(()=>()=>{U.forEach(O=>{typeof O=="function"&&O()})},[U]);const[ut,ee]=D.useState(null);D.useEffect(()=>{const O=async()=>{try{const te=(await Ve(()=>import("./offlineManager-8121d05d.js"),[])).default,et=new te;ee(et),window.offlineManager=et,window.refreshUserData=je,console.log(" Offline manager initialized")}catch(te){console.error("Error initializing offline manager:",te)}},Y=async()=>{try{const te=(await Ve(()=>import("./authGuard-97ed8617.js"),[])).default,et=(await Ve(()=>import("./sessionManager-7bebfdae.js"),[])).default,_t=new te,gn=new et;window.authGuard=_t,window.sessionManager=gn,console.log(" Auth services initialized")}catch(te){console.error(" Failed to initialize auth services:",te)}};O(),Y()},[]);const xe=async O=>{if(!O)return!1;const Y=await Ae(O);if(Y&&ut&&(await ut.cacheUserData(o),await ut.cacheProfileData({dailyWater:at,dailyMood:dt,dailyBreathing:st,scheduledTriggers:he,relapseDate:be,cravingsResisted:Ht})),!Y&&ut){console.log(" Loading offline data...");const te=await ut.getCachedUserData(),et=await ut.getCachedProfileData();if(te)return console.log(" Using offline user data"),a(te),_(te.onboardingCompleted),et&&Re(et),!0}return Y},pe=async()=>R!=null&&R.uid?(console.log(" Refreshing user data with offline support..."),await xe(R.uid)):!1,je=async()=>{if(!(R!=null&&R.uid)){Ne("Cannot Refresh","No authenticated user found");return}if(console.log(" Manually refreshing user data..."),await pe()){const Y=document.createElement("div");Y.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",Y.innerHTML=`
        <div class="font-bold"> Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(Y),setTimeout(()=>{Y.parentNode&&Y.parentNode.removeChild(Y)},5e3)}else Ne("Refresh Failed","Could not refresh data. Please try again.")},[be,ge]=D.useState(null),[at,bt]=D.useState(0),[dt,Xe]=D.useState(null),[st,Le]=D.useState(!1),[he,Me]=D.useState([]),[Ht,Tt]=D.useState(0),[tn,mn]=D.useState(we());D.useEffect(()=>{const O=te=>{if(te.message&&te.message.includes("content_script")){console.warn("Browser extension error (ignored):",te.message);return}if(te.message&&(te.message.includes("FrameDoesNotExistError")||te.message.includes("background.js"))){console.warn("Background frame error (ignored):",te.message);return}if(te.message&&te.message.includes("deref")){console.warn("Browser extension deref error (ignored):",te.message);return}if(te.message&&te.message.includes("chrome-extension://")){console.warn("Chrome extension URL error (ignored):",te.message);return}console.error("Global error caught:",te)},Y=te=>{if(te.reason&&te.reason.message&&te.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",te.reason.message);return}if(te.reason&&te.reason.message&&(te.reason.message.includes("FrameDoesNotExistError")||te.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",te.reason.message);return}if(te.reason&&te.reason.message&&te.reason.message.includes("deref")){console.warn("Browser extension deref promise rejection (ignored):",te.reason.message);return}if(te.reason&&te.reason.message&&te.reason.message.includes("chrome-extension://")){console.warn("Chrome extension URL promise rejection (ignored):",te.reason.message);return}console.error("Unhandled promise rejection:",te.reason)};return window.addEventListener("error",O),window.addEventListener("unhandledrejection",Y),()=>{window.removeEventListener("error",O),window.removeEventListener("unhandledrejection",Y)}},[]),D.useEffect(()=>{(()=>{try{ae&&typeof ae.app<"u"&&console.log(" Firebase RTDB initialized successfully")}catch(Y){console.warn(" Firebase initialization check failed (non-critical):",(Y==null?void 0:Y.message)||Y)}})()},[]),D.useEffect(()=>{let O=!0,Y=null;return(async()=>{try{console.log("Initializing authentication state..."),C(!0);const et=async Se=>{const Ye=`quitDateFixed_${Se}_v2`;if(!localStorage.getItem(Ye)&&!(Se!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&Se!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:it,get:At,set:gt}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),sn="2025-09-18T13:56:46.584Z";console.log(` One-time fix: Setting proper quit date for ${Se}...`);const bi=it(ae,`users/${Se}/profile`),Ir=await At(bi);let ot=sn;if(Ir.exists()){const wt=Ir.val();if(wt.lastRelapseDate){const $n=new Date(wt.lastRelapseDate),Ya=new Date(sn);ot=$n>Ya?wt.lastRelapseDate:sn,console.log(` ${Se}: Using quit date ${ot} (considering relapse: ${wt.lastRelapseDate})`)}}await gt(it(ae,`users/${Se}/quitDate`),ot),await gt(it(ae,`users/${Se}/profile/quitDate`),ot),localStorage.setItem(Ye,"true"),console.log(` One-time fix: Quit date fixed for ${Se} in Firebase database`)}catch(it){console.warn(` One-time fix failed for ${Se}:`,it.message)}},{onAuthStateChanged:_t}=await Ve(()=>import("./index.esm-a1ca88c2.js"),[]);Y=_t(pp,async Se=>{if(O)if(console.log("Auth state changed:",Se?`User: ${Se.uid}`:"No user"),Se){console.log(" onAuthStateChanged: User authenticated:",Se.uid,Se.email),x(Se),console.log("User authenticated, checking database for user data..."),console.log(" onAuthStateChanged: Attempting to update lastActivity timestamp for user:",Se.uid);try{const{ref:Ye,set:it}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),At=new Date,gt=Ye(ae,`users/${Se.uid}/profile/lastActivity`);await it(gt,At.toISOString()),console.log(" onAuthStateChanged: Updated lastActivity timestamp for user:",Se.uid,"to:",At.toISOString()),await new Promise(sn=>setTimeout(sn,1e3)),console.log(" onAuthStateChanged: lastActivity update completed and propagated")}catch(Ye){console.warn(" onAuthStateChanged: Could not update lastActivity timestamp:",Ye.message)}(Se.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||Se.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(` Clearing cache for ${Se.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(Ye=>{(Ye.includes("quitCoach")||Ye.includes("quitDate")||Ye.includes("user")||Ye.includes("arena"))&&localStorage.removeItem(Ye)})),et(Se.uid);try{const{ref:Ye,get:it}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),At=Ye(ae,`users/${Se.uid}`),gt=await it(At);if(gt.exists()){const sn=gt.val();console.log("Existing user data found - auto-login successful"),(()=>{const ot=[];for(let wt=0;wt<localStorage.length;wt++){const $n=localStorage.key(wt);$n&&($n.startsWith("water_")||$n.startsWith("mood_")||$n.startsWith("breathing_"))&&ot.push($n)}ot.forEach(wt=>localStorage.removeItem(wt)),console.log("Cleared previous user data from localStorage")})(),a(sn);const Ir=!!sn.onboardingCompleted;_(Ir),console.log(`Onboarding status: ${Ir?"completed":"not completed"}`),r(Ir?"arena":"onboarding");try{await new Promise($n=>setTimeout($n,2e3));const ot=await Ve(()=>Promise.resolve().then(()=>bq),void 0),wt=new ot.default(ae,Se.uid);await wt.initialize(),Q(wt),console.log(" StatManager initialized successfully")}catch(ot){console.error("Error initializing StatManager:",ot)}try{const ot=new YT(ae,Se.uid,window.authGuard);ne(ot),window.centralizedStatService=ot,await ot.refreshAllStats(),console.log(" CentralizedStatService initialized and stats refreshed for user:",Se.uid),ot.setupRealTimeListener(wt=>{if(console.log(" Real-time stats update received:",wt),mn(wt),wt.streakDisplayText&&typeof setBuddyStreakData=="function")try{setBuddyStreakData({streakDays:wt.streakDays||0,streakUnit:wt.streakUnit||"hours",streakDisplayText:wt.streakDisplayText})}catch($n){console.error("Error updating buddy streak data:",$n)}})}catch(ot){console.error("Error initializing CentralizedStatService:",ot)}try{Hq.initialize(),console.log(" Performance monitoring system initialized")}catch(ot){console.error("Error initializing performance monitoring:",ot)}setTimeout(async()=>{try{await new Promise(ot=>setTimeout(ot,3e3)),eA.initialize(Se.uid),window.dataBackupService=eA,console.log(" Data backup service initialized"),tA.initialize(Se.uid),window.privacyProtectionService=tA,console.log(" Privacy protection service initialized"),nA.initialize(Se.uid),window.errorLoggingService=nA,console.log(" Error logging service initialized"),rA.initialize(Se.uid),window.gracefulDegradationService=rA,console.log(" Graceful degradation service initialized"),sA.initialize(Se.uid),window.rateLimitingService=sA,console.log(" Rate limiting service initialized")}catch(ot){console.error("Error initializing safety services:",ot)}},5e3),console.log("User auto-logged in - checking onboarding status")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Ye){console.error("Error fetching user data during auto-login:",Ye),r("onboarding")}}else console.log("No authenticated user - showing login screen"),x(null),a(null),_(!1),r("auth"),(()=>{const it=[];for(let At=0;At<localStorage.length;At++){const gt=localStorage.key(At);gt&&(gt.startsWith("water_")||gt.startsWith("mood_")||gt.startsWith("breathing_"))&&it.push(gt)}it.forEach(At=>localStorage.removeItem(At)),console.log("Cleared user-specific data from localStorage")})()});const gn=setTimeout(()=>{O&&(console.warn("Auth initialization timeout - forcing to auth screen"),C(!1),r("auth"))},1e4);Y&&clearTimeout(gn)}catch(et){console.error("Error initializing authentication:",et),O&&(C(!1),r("auth"))}finally{O&&C(!1)}})(),me(),()=>{O=!1,Y&&Y()}},[]);const Qt=async O=>{console.log(" handleAuthSuccess called for user:",O==null?void 0:O.uid,O==null?void 0:O.email),console.log("Authentication successful, checking for existing user data...",{uid:O==null?void 0:O.uid,email:O==null?void 0:O.email});try{const{ref:Y,get:te,set:et}=await Ve(()=>import("./index.esm-1f127fec.js"),[]);console.log("Checking database for existing user data..."),console.log(" Attempting to update lastActivity timestamp for user:",O.uid);try{const Se=new Date,Ye=Y(ae,`users/${O.uid}/profile/lastActivity`);await et(Ye,Se.toISOString()),console.log(" Updated lastActivity timestamp for user:",O.uid,"to:",Se.toISOString()),await new Promise(it=>setTimeout(it,1e3)),console.log(" lastActivity update completed and propagated")}catch(Se){console.warn(" Could not update lastActivity timestamp:",Se.message)}const _t=Y(ae,`users/${O.uid}`),gn=await te(_t);if(gn.exists()){const Se=gn.val();if(console.log("Existing user data found - loading all user data..."),await xe(O.uid)){const it=!!Se.onboardingCompleted;console.log(` All user data loaded successfully: ${it?"Onboarding completed, going to Arena":"Onboarding not completed, staying on auth"}`);try{const At=new YT(ae,O.uid,window.authGuard);ne(At),window.centralizedStatService=At,await At.refreshAllStats(),console.log(" CentralizedStatService initialized for existing user:",O.uid),At.setupRealTimeListener(gt=>{if(console.log(" Real-time stats update received:",gt),mn(gt),gt.streakDisplayText&&typeof setBuddyStreakData=="function")try{setBuddyStreakData({streakDays:gt.streakDays||0,streakUnit:gt.streakUnit||"hours",streakDisplayText:gt.streakDisplayText})}catch(sn){console.error("Error updating buddy streak data:",sn)}})}catch(At){console.error("Error initializing CentralizedStatService for existing user:",At)}_(it),r(it?"arena":"onboarding")}else{console.log(" Data loading failed, but proceeding with basic data"),a(Se);const it=!!Se.onboardingCompleted;_(it),console.log(`Onboarding status after failed load: ${it?"completed":"not completed"}`),r(it?"arena":"auth")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(Y){console.error("Database check failed:",Y),r("onboarding")}},[xn,nn]=D.useState(null),[pn,un]=D.useState(!1),[Kt,Hn]=D.useState(null),[qe,Qe]=D.useState(!1),rn=async(O,Y,te)=>{console.log(" loadRealBuddy called but buddy matching is disabled"),un(!1),nn(null)};D.useEffect(()=>{Qe(!1),nn(null)},[o==null?void 0:o.uid]),D.useEffect(()=>{o!=null&&o.uid&&!xn&&!pn&&!qe&&console.log(" Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,xn,pn,qe]);const oe={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},lt=()=>pn?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:pu("loading","adventurer"),isLoading:!0}:Kt?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:pu("error","adventurer"),isError:!0,errorMessage:Kt}:xn||oe,Dt=async O=>{console.log("Onboarding completed with user data:",O);try{if(!O||!O.heroName||!O.stats)throw new Error("Invalid user data received from onboarding");if(!R)throw new Error("No authenticated user found");const Y=new Date,te={...O,uid:R.uid,email:R.email,displayName:R.displayName||O.heroName,photoURL:R.photoURL,onboardingCompleted:!0,createdAt:Y.toISOString(),updatedAt:Y.getTime(),originalQuitDate:Y.toISOString(),lastQuitDate:Y.toISOString(),lastRelapseDate:Y.toISOString(),lastActivity:Y.toISOString(),daily:{[Y.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",te);const{ref:et,set:_t}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),gn=et(ae,`users/${R.uid}`);await _t(gn,te),console.log("Firebase save successful, updating app state..."),a(te),_(!0);const Se=await xe(R.uid);console.log(" Onboarding complete, going to Arena"),r("arena")}catch(Y){console.error("Error in handleOnboardingComplete:",Y);const te=new Date,et={heroName:(O==null?void 0:O.heroName)||"Hero",archetype:(O==null?void 0:O.archetype)||"The Determined",avatar:(O==null?void 0:O.avatar)||pu("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:te,createdAt:te.toISOString(),lastActivity:te.toISOString(),lastRelapseDate:te.toISOString(),uid:R==null?void 0:R.uid,email:R==null?void 0:R.email,onboardingCompleted:!0};if(R)try{const{ref:_t,set:gn}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),Se=_t(ae,`users/${R.uid}`);await gn(Se,et)}catch(_t){console.error("Failed to save fallback data to Firebase:",_t)}a(et),_(!0),r("arena")}},es=()=>{a(null),_(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},An=async()=>{try{console.log("Logging out user...");const{signOut:O}=await Ve(()=>import("./index.esm-a1ca88c2.js"),[]);await O(pp),a(null),x(null),_(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(O){console.error("Error during logout:",O),a(null),x(null),_(!1),r("auth")}},Ka=async()=>{if(!R){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:O,set:Y,remove:te}=await Ve(()=>import("./index.esm-1f127fec.js"),[]),et=O(ae,`users/${R.uid}`);await Y(et,null);const _t=O(ae,"users");await Y(_t,null);const gn=O(ae,"buddyPairs");await Y(gn,null);const Se=O(ae,"matchingPool");await Y(Se,null),console.log("All user data and buddy matching data cleared from database"),a(null),_(!1),r("onboarding"),nn(null),un(!1),Hn(null),console.log("Account reset successful - ready for fresh onboarding")}catch(O){console.error("Error resetting account for testing:",O)}},Oo=O=>{console.log("Tab changed to:",O),e(O),r(O),O==="arena"&&(o!=null&&o.uid)&&(console.log(" Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log(" Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},Dh=O=>{r(O==="mood-selector"?"mood-selector":"profile")},Fn=O=>{i(O),r("profile")},Ph=()=>{r("profile")};return I?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),l.jsx("h2",{className:"text-3xl font-bold mb-4",children:" Restoring Session..."}),l.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),l.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:l.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Checking Firebase Auth persistence"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Verifying user session (30 days)"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Loading user data from database"]})]})}),l.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?l.jsx(t8,{onAuthSuccess:Qt}):b.isLoading?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),l.jsx("h2",{className:"text-3xl font-bold mb-4",children:" Loading Your Data..."}),l.jsx("p",{className:"text-xl text-gray-300 mb-4",children:b.currentStep}),l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[l.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:l.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${b.progress}%`}})}),l.jsxs("div",{className:"text-sm text-gray-400",children:[b.progress,"% Complete"]})]}),l.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:l.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Profile and onboarding data"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Battle stats and progress"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Habits and achievements"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Setting up live sync"]})]})}),b.error&&l.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[l.jsxs("p",{className:"text-red-300 text-sm",children:[l.jsx("span",{className:"font-semibold",children:"Error:"})," ",b.error]}),l.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),l.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):l.jsx(Qq,{children:l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative",children:[N>0&&l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white text-center py-2 transition-transform duration-200",style:{transform:`translateY(${Math.max(0,N-60)}px)`},children:N>80?"Release to refresh":"Pull to refresh"}),S&&l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-green-600 text-white text-center py-2",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),l.jsx("span",{children:"Refreshing..."})]})}),l.jsx(n8,{offlineManager:ut}),l.jsx(r8,{offlineManager:ut}),l.jsx(s8,{sessionManager:window.sessionManager,authGuard:window.authGuard}),t==="onboarding"&&l.jsx("div",{children:l.jsx(P8,{onComplete:Dt,authUser:R,db:ae,pwaInstallAvailable:P,promptInstall:Z})}),v&&o?l.jsxs(l.Fragment,{children:[t==="arena"&&l.jsx("div",{children:(()=>{try{const O=lt();return l.jsx(F8,{user:o,userStats:tn,nemesis:O,onBackToLogin:An,onResetForTesting:Ka,buddyLoading:pn,buddyError:Kt,realBuddy:xn,loadRealBuddy:rn,buddyLoadAttempted:qe},`arena-${o.uid}-${V}`)}catch(O){return console.error("Error rendering ArenaView:",O),l.jsxs("div",{className:"text-white text-center p-8",children:[l.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),l.jsx("p",{className:"text-gray-300 mb-4",children:O.message}),l.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-3 rounded hover:bg-blue-700 min-h-[44px]",children:"Reload App"})]})}})()}),t==="craving-support"&&l.jsx("div",{children:l.jsx(B8,{user:o,nemesis:lt(),onBackToLogin:An,onResetForTesting:Ka,behavioralService:ve,onBreathingComplete:async O=>{await vt()},setActiveTab:e})}),t==="profile"&&l.jsx("div",{children:l.jsx(W8,{user:o,onNavigate:Dh})}),t==="mood-selector"&&l.jsx(MoodSelector,{onMoodSelect:Fn,onBack:Ph}),t==="settings"&&l.jsx(Y8,{onResetApp:es,onBackToLogin:An,onResetForTesting:Ka,behavioralService:ve,user:o,onShowAnalytics:()=>u(!0),onShowPerformanceDashboard:()=>f(!0),onShowBetaMonitoring:()=>g(!0)}),c&&l.jsx(u8,{user:o,behavioralService:ve,onClose:()=>u(!1)}),h&&l.jsx(Uq,{isOpen:h,onClose:()=>f(!1)}),m&&l.jsx(Kq,{isOpen:m,onClose:()=>g(!1)}),l.jsx(V8,{activeTab:n,onTabChange:Oo,dataLoadingState:b,onRefreshData:je,offlineManager:ut})]}):l.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),l.jsx("p",{className:"text-gray-300",children:v?"User data missing":"Onboarding not completed"}),l.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),l.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),l.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:v,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 min-h-[44px]",children:"Debug State"})]})})]})})};r0.createRoot(document.getElementById("root")).render(l.jsx(J8,{}));export{YF as $,o7 as A,a7 as B,l7 as C,wa as D,n7 as E,Mw as F,v7 as G,_7 as H,w7 as I,x7 as J,rk as K,a3 as L,H as M,t7 as N,QF as O,KF as P,ws as Q,_s as R,R7 as S,y3 as T,C7 as U,Ie as V,r7 as W,s7 as X,p7 as Y,m7 as Z,j7 as _,f3 as a,xB as a$,QW as a0,Nh as a1,Ah as a2,YW as a3,Wd as a4,Ha as a5,Fi as a6,qW as a7,$i as a8,Ys as a9,fG as aA,zP as aB,JW as aC,SU as aD,wG as aE,PG as aF,bT as aG,ZB as aH,QU as aI,mG as aJ,oG as aK,vB as aL,bG as aM,CG as aN,DG as aO,xG as aP,PB as aQ,RB as aR,XW as aS,uU as aT,_B as aU,TG as aV,NG as aW,RG as aX,bU as aY,vG as aZ,EB as a_,gi as aa,tm as ab,HW as ac,ua as ad,$l as ae,Jz as af,WW as ag,IG as ah,Hv as ai,GW as aj,Xz as ak,lS as al,Ui as am,rG as an,DB as ao,SG as ap,Fl as aq,Yz as ar,Zu as as,SB as at,nG as au,YU as av,bP as aw,KW as ax,_G as ay,lG as az,Ur as b,$7 as b$,iG as b0,eS as b1,ZW as b2,Yx as b3,tG as b4,TP as b5,aG as b6,EG as b7,hz as b8,kG as b9,Vn as bA,$c as bB,Sh as bC,Xf as bD,Cg as bE,Ih as bF,Ag as bG,Fx as bH,Pr as bI,Ng as bJ,Qi as bK,Fe as bL,oU as bM,ms as bN,sU as bO,Lw as bP,ln as bQ,xa as bR,re as bS,V7 as bT,v3 as bU,Wt as bV,zW as bW,Ge as bX,L7 as bY,BW as bZ,UW as b_,jB as ba,eG as bb,yG as bc,dG as bd,hG as be,AG as bf,uG as bg,gG as bh,pG as bi,cG as bj,sG as bk,QD as bl,$d as bm,$$ as bn,Cr as bo,z7 as bp,Vs as bq,yt as br,Dr as bs,za as bt,qa as bu,It as bv,B as bw,Fs as bx,V$ as by,lU as bz,uw as c,vW as c$,Xr as c0,N3 as c1,Br as c2,lW as c3,cW as c4,eW as c5,DW as c6,RW as c7,aW as c8,H7 as c9,gW as cA,yW as cB,jD as cC,LW as cD,PW as cE,q7 as cF,G$ as cG,tW as cH,mT as cI,EW as cJ,TW as cK,bW as cL,F$ as cM,yT as cN,xW as cO,SW as cP,Z7 as cQ,ap as cR,AW as cS,NW as cT,nU as cU,Hi as cV,PD as cW,dW as cX,B7 as cY,CW as cZ,aU as c_,Cn as ca,U7 as cb,O$ as cc,H$ as cd,$W as ce,wW as cf,kW as cg,Y7 as ch,FW as ci,L$ as cj,X7 as ck,uW as cl,W7 as cm,G7 as cn,K7 as co,VW as cp,iW as cq,sW as cr,en as cs,Eh as ct,K$ as cu,IW as cv,fW as cw,mW as cx,pW as cy,xc as cz,Ns as d,OW as d0,O7 as d1,hW as d2,rW as d3,nW as d4,oW as d5,J7 as d6,_W as d7,jW as d8,Q7 as d9,ti as da,MW as db,ra as dc,$t as dd,$s as de,Ve as df,Z8 as dg,jG as dh,MG as di,ec as e,P7 as f,m3 as g,D7 as h,N7 as i,d7 as j,h7 as k,S7 as l,b7 as m,E7 as n,_e as o,ck as p,T7 as q,ak as r,qN as s,A7 as t,k7 as u,Cw as v,g7 as w,y7 as x,JF as y,i7 as z};
