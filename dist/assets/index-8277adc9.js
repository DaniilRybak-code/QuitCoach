(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function t2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var bb={exports:{}},zp={},Ab={exports:{}},De={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xd=Symbol.for("react.element"),n2=Symbol.for("react.portal"),r2=Symbol.for("react.fragment"),s2=Symbol.for("react.strict_mode"),i2=Symbol.for("react.profiler"),o2=Symbol.for("react.provider"),a2=Symbol.for("react.context"),l2=Symbol.for("react.forward_ref"),c2=Symbol.for("react.suspense"),u2=Symbol.for("react.memo"),d2=Symbol.for("react.lazy"),vE=Symbol.iterator;function h2(n){return n===null||typeof n!="object"?null:(n=vE&&n[vE]||n["@@iterator"],typeof n=="function"?n:null)}var Cb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Rb=Object.assign,Nb={};function Hl(n,e,t){this.props=n,this.context=e,this.refs=Nb,this.updater=t||Cb}Hl.prototype.isReactComponent={};Hl.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Hl.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Pb(){}Pb.prototype=Hl.prototype;function Iv(n,e,t){this.props=n,this.context=e,this.refs=Nb,this.updater=t||Cb}var Ev=Iv.prototype=new Pb;Ev.constructor=Iv;Rb(Ev,Hl.prototype);Ev.isPureReactComponent=!0;var wE=Array.isArray,kb=Object.prototype.hasOwnProperty,xv={current:null},Db={key:!0,ref:!0,__self:!0,__source:!0};function Ob(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)kb.call(e,r)&&!Db.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:xd,type:n,key:i,ref:o,props:s,_owner:xv.current}}function f2(n,e){return{$$typeof:xd,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Tv(n){return typeof n=="object"&&n!==null&&n.$$typeof===xd}function p2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var IE=/\/+/g;function xg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?p2(""+n.key):e.toString(36)}function nf(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case xd:case n2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+xg(o,0):r,wE(s)?(t="",n!=null&&(t=n.replace(IE,"$&/")+"/"),nf(s,e,t,"",function(u){return u})):s!=null&&(Tv(s)&&(s=f2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(IE,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",wE(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+xg(i,a);o+=nf(i,e,t,l,s)}else if(l=h2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+xg(i,a++),o+=nf(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function xh(n,e,t){if(n==null)return n;var r=[],s=0;return nf(n,r,"","",function(i){return e.call(t,i,s++)}),r}function m2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var jn={current:null},rf={transition:null},g2={ReactCurrentDispatcher:jn,ReactCurrentBatchConfig:rf,ReactCurrentOwner:xv};function Mb(){throw Error("act(...) is not supported in production builds of React.")}De.Children={map:xh,forEach:function(n,e,t){xh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return xh(n,function(){e++}),e},toArray:function(n){return xh(n,function(e){return e})||[]},only:function(n){if(!Tv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};De.Component=Hl;De.Fragment=r2;De.Profiler=i2;De.PureComponent=Iv;De.StrictMode=s2;De.Suspense=c2;De.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=g2;De.act=Mb;De.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Rb({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=xv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)kb.call(e,l)&&!Db.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:xd,type:n.type,key:s,ref:i,props:r,_owner:o}};De.createContext=function(n){return n={$$typeof:a2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:o2,_context:n},n.Consumer=n};De.createElement=Ob;De.createFactory=function(n){var e=Ob.bind(null,n);return e.type=n,e};De.createRef=function(){return{current:null}};De.forwardRef=function(n){return{$$typeof:l2,render:n}};De.isValidElement=Tv;De.lazy=function(n){return{$$typeof:d2,_payload:{_status:-1,_result:n},_init:m2}};De.memo=function(n,e){return{$$typeof:u2,type:n,compare:e===void 0?null:e}};De.startTransition=function(n){var e=rf.transition;rf.transition={};try{n()}finally{rf.transition=e}};De.unstable_act=Mb;De.useCallback=function(n,e){return jn.current.useCallback(n,e)};De.useContext=function(n){return jn.current.useContext(n)};De.useDebugValue=function(){};De.useDeferredValue=function(n){return jn.current.useDeferredValue(n)};De.useEffect=function(n,e){return jn.current.useEffect(n,e)};De.useId=function(){return jn.current.useId()};De.useImperativeHandle=function(n,e,t){return jn.current.useImperativeHandle(n,e,t)};De.useInsertionEffect=function(n,e){return jn.current.useInsertionEffect(n,e)};De.useLayoutEffect=function(n,e){return jn.current.useLayoutEffect(n,e)};De.useMemo=function(n,e){return jn.current.useMemo(n,e)};De.useReducer=function(n,e,t){return jn.current.useReducer(n,e,t)};De.useRef=function(n){return jn.current.useRef(n)};De.useState=function(n){return jn.current.useState(n)};De.useSyncExternalStore=function(n,e,t){return jn.current.useSyncExternalStore(n,e,t)};De.useTransition=function(){return jn.current.useTransition()};De.version="18.3.1";Ab.exports=De;var j=Ab.exports;const y2=t2(j);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2=j,v2=Symbol.for("react.element"),w2=Symbol.for("react.fragment"),I2=Object.prototype.hasOwnProperty,E2=_2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,x2={key:!0,ref:!0,__self:!0,__source:!0};function Lb(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)I2.call(e,r)&&!x2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:v2,type:n,key:i,ref:o,props:s,_owner:E2.current}}zp.Fragment=w2;zp.jsx=Lb;zp.jsxs=Lb;bb.exports=zp;var d=bb.exports,Ay={},Vb={exports:{}},gr={},Fb={exports:{}},jb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(z,te){var oe=z.length;z.push(te);e:for(;0<oe;){var Ce=oe-1>>>1,fe=z[Ce];if(0<s(fe,te))z[Ce]=te,z[oe]=fe,oe=Ce;else break e}}function t(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var te=z[0],oe=z.pop();if(oe!==te){z[0]=oe;e:for(var Ce=0,fe=z.length,Ue=fe>>>1;Ce<Ue;){var Mt=2*(Ce+1)-1,me=z[Mt],We=Mt+1,Ct=z[We];if(0>s(me,oe))We<fe&&0>s(Ct,me)?(z[Ce]=Ct,z[We]=oe,Ce=We):(z[Ce]=me,z[Mt]=oe,Ce=Mt);else if(We<fe&&0>s(Ct,oe))z[Ce]=Ct,z[We]=oe,Ce=We;else break e}}return te}function s(z,te){var oe=z.sortIndex-te.sortIndex;return oe!==0?oe:z.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,p=3,y=!1,x=!1,T=!1,P=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(z){for(var te=t(u);te!==null;){if(te.callback===null)r(u);else if(te.startTime<=z)r(u),te.sortIndex=te.expirationTime,e(l,te);else break;te=t(u)}}function k(z){if(T=!1,N(z),!x)if(t(l)!==null)x=!0,re(U);else{var te=t(u);te!==null&&Ve(k,te.startTime-z)}}function U(z,te){x=!1,T&&(T=!1,R(v),v=-1),y=!0;var oe=p;try{for(N(te),f=t(l);f!==null&&(!(f.expirationTime>te)||z&&!E());){var Ce=f.callback;if(typeof Ce=="function"){f.callback=null,p=f.priorityLevel;var fe=Ce(f.expirationTime<=te);te=n.unstable_now(),typeof fe=="function"?f.callback=fe:f===t(l)&&r(l),N(te)}else r(l);f=t(l)}if(f!==null)var Ue=!0;else{var Mt=t(u);Mt!==null&&Ve(k,Mt.startTime-te),Ue=!1}return Ue}finally{f=null,p=oe,y=!1}}var V=!1,A=null,v=-1,S=5,_=-1;function E(){return!(n.unstable_now()-_<S)}function C(){if(A!==null){var z=n.unstable_now();_=z;var te=!0;try{te=A(!0,z)}finally{te?w():(V=!1,A=null)}}else V=!1}var w;if(typeof b=="function")w=function(){b(C)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,de=Z.port2;Z.port1.onmessage=C,w=function(){de.postMessage(null)}}else w=function(){P(C,0)};function re(z){A=z,V||(V=!0,w())}function Ve(z,te){v=P(function(){z(n.unstable_now())},te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_continueExecution=function(){x||y||(x=!0,re(U))},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(z){switch(p){case 1:case 2:case 3:var te=3;break;default:te=p}var oe=p;p=te;try{return z()}finally{p=oe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(z,te){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var oe=p;p=z;try{return te()}finally{p=oe}},n.unstable_scheduleCallback=function(z,te,oe){var Ce=n.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?Ce+oe:Ce):oe=Ce,z){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=oe+fe,z={id:h++,callback:te,priorityLevel:z,startTime:oe,expirationTime:fe,sortIndex:-1},oe>Ce?(z.sortIndex=oe,e(u,z),t(l)===null&&z===t(u)&&(T?(R(v),v=-1):T=!0,Ve(k,oe-Ce))):(z.sortIndex=fe,e(l,z),x||y||(x=!0,re(U))),z},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(z){var te=p;return function(){var oe=p;p=te;try{return z.apply(this,arguments)}finally{p=oe}}}})(jb);Fb.exports=jb;var T2=Fb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S2=j,hr=T2;function q(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ub=new Set,Nu={};function ca(n,e){pl(n,e),pl(n+"Capture",e)}function pl(n,e){for(Nu[n]=e,n=0;n<e.length;n++)Ub.add(e[n])}var ks=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cy=Object.prototype.hasOwnProperty,b2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,EE={},xE={};function A2(n){return Cy.call(xE,n)?!0:Cy.call(EE,n)?!1:b2.test(n)?xE[n]=!0:(EE[n]=!0,!1)}function C2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function R2(n,e,t,r){if(e===null||typeof e>"u"||C2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Un(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var wn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){wn[n]=new Un(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];wn[e]=new Un(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){wn[n]=new Un(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){wn[n]=new Un(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){wn[n]=new Un(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){wn[n]=new Un(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){wn[n]=new Un(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){wn[n]=new Un(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){wn[n]=new Un(n,5,!1,n.toLowerCase(),null,!1,!1)});var Sv=/[\-:]([a-z])/g;function bv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Sv,bv);wn[e]=new Un(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Sv,bv);wn[e]=new Un(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Sv,bv);wn[e]=new Un(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){wn[n]=new Un(n,1,!1,n.toLowerCase(),null,!1,!1)});wn.xlinkHref=new Un("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){wn[n]=new Un(n,1,!1,n.toLowerCase(),null,!0,!0)});function Av(n,e,t,r){var s=wn.hasOwnProperty(e)?wn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(R2(e,t,s,r)&&(t=null),r||s===null?A2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var zs=S2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Th=Symbol.for("react.element"),$a=Symbol.for("react.portal"),za=Symbol.for("react.fragment"),Cv=Symbol.for("react.strict_mode"),Ry=Symbol.for("react.profiler"),Bb=Symbol.for("react.provider"),$b=Symbol.for("react.context"),Rv=Symbol.for("react.forward_ref"),Ny=Symbol.for("react.suspense"),Py=Symbol.for("react.suspense_list"),Nv=Symbol.for("react.memo"),li=Symbol.for("react.lazy"),zb=Symbol.for("react.offscreen"),TE=Symbol.iterator;function Sc(n){return n===null||typeof n!="object"?null:(n=TE&&n[TE]||n["@@iterator"],typeof n=="function"?n:null)}var bt=Object.assign,Tg;function zc(n){if(Tg===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Tg=e&&e[1]||""}return`
`+Tg+n}var Sg=!1;function bg(n,e){if(!n||Sg)return"";Sg=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Sg=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?zc(n):""}function N2(n){switch(n.tag){case 5:return zc(n.type);case 16:return zc("Lazy");case 13:return zc("Suspense");case 19:return zc("SuspenseList");case 0:case 2:case 15:return n=bg(n.type,!1),n;case 11:return n=bg(n.type.render,!1),n;case 1:return n=bg(n.type,!0),n;default:return""}}function ky(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case za:return"Fragment";case $a:return"Portal";case Ry:return"Profiler";case Cv:return"StrictMode";case Ny:return"Suspense";case Py:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case $b:return(n.displayName||"Context")+".Consumer";case Bb:return(n._context.displayName||"Context")+".Provider";case Rv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Nv:return e=n.displayName||null,e!==null?e:ky(n.type)||"Memo";case li:e=n._payload,n=n._init;try{return ky(n(e))}catch{}}return null}function P2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ky(e);case 8:return e===Cv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ui(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function qb(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function k2(n){var e=qb(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Sh(n){n._valueTracker||(n._valueTracker=k2(n))}function Wb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=qb(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Df(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Dy(n,e){var t=e.checked;return bt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function SE(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Ui(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Gb(n,e){e=e.checked,e!=null&&Av(n,"checked",e,!1)}function Oy(n,e){Gb(n,e);var t=Ui(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?My(n,e.type,t):e.hasOwnProperty("defaultValue")&&My(n,e.type,Ui(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function bE(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function My(n,e,t){(e!=="number"||Df(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var qc=Array.isArray;function el(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Ui(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Ly(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(q(91));return bt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function AE(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(q(92));if(qc(t)){if(1<t.length)throw Error(q(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Ui(t)}}function Hb(n,e){var t=Ui(e.value),r=Ui(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function CE(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Kb(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vy(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Kb(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var bh,Qb=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(bh=bh||document.createElement("div"),bh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=bh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Pu(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var nu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},D2=["Webkit","ms","Moz","O"];Object.keys(nu).forEach(function(n){D2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),nu[e]=nu[n]})});function Yb(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||nu.hasOwnProperty(n)&&nu[n]?(""+e).trim():e+"px"}function Jb(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Yb(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var O2=bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fy(n,e){if(e){if(O2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(q(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(q(62))}}function jy(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Uy=null;function Pv(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var By=null,tl=null,nl=null;function RE(n){if(n=bd(n)){if(typeof By!="function")throw Error(q(280));var e=n.stateNode;e&&(e=Kp(e),By(n.stateNode,n.type,e))}}function Xb(n){tl?nl?nl.push(n):nl=[n]:tl=n}function Zb(){if(tl){var n=tl,e=nl;if(nl=tl=null,RE(n),e)for(n=0;n<e.length;n++)RE(e[n])}}function e1(n,e){return n(e)}function t1(){}var Ag=!1;function n1(n,e,t){if(Ag)return n(e,t);Ag=!0;try{return e1(n,e,t)}finally{Ag=!1,(tl!==null||nl!==null)&&(t1(),Zb())}}function ku(n,e){var t=n.stateNode;if(t===null)return null;var r=Kp(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(q(231,e,typeof t));return t}var $y=!1;if(ks)try{var bc={};Object.defineProperty(bc,"passive",{get:function(){$y=!0}}),window.addEventListener("test",bc,bc),window.removeEventListener("test",bc,bc)}catch{$y=!1}function M2(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var ru=!1,Of=null,Mf=!1,zy=null,L2={onError:function(n){ru=!0,Of=n}};function V2(n,e,t,r,s,i,o,a,l){ru=!1,Of=null,M2.apply(L2,arguments)}function F2(n,e,t,r,s,i,o,a,l){if(V2.apply(this,arguments),ru){if(ru){var u=Of;ru=!1,Of=null}else throw Error(q(198));Mf||(Mf=!0,zy=u)}}function ua(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function r1(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function NE(n){if(ua(n)!==n)throw Error(q(188))}function j2(n){var e=n.alternate;if(!e){if(e=ua(n),e===null)throw Error(q(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return NE(s),n;if(i===r)return NE(s),e;i=i.sibling}throw Error(q(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(q(189))}}if(t.alternate!==r)throw Error(q(190))}if(t.tag!==3)throw Error(q(188));return t.stateNode.current===t?n:e}function s1(n){return n=j2(n),n!==null?i1(n):null}function i1(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=i1(n);if(e!==null)return e;n=n.sibling}return null}var o1=hr.unstable_scheduleCallback,PE=hr.unstable_cancelCallback,U2=hr.unstable_shouldYield,B2=hr.unstable_requestPaint,Ft=hr.unstable_now,$2=hr.unstable_getCurrentPriorityLevel,kv=hr.unstable_ImmediatePriority,a1=hr.unstable_UserBlockingPriority,Lf=hr.unstable_NormalPriority,z2=hr.unstable_LowPriority,l1=hr.unstable_IdlePriority,qp=null,os=null;function q2(n){if(os&&typeof os.onCommitFiberRoot=="function")try{os.onCommitFiberRoot(qp,n,void 0,(n.current.flags&128)===128)}catch{}}var jr=Math.clz32?Math.clz32:H2,W2=Math.log,G2=Math.LN2;function H2(n){return n>>>=0,n===0?32:31-(W2(n)/G2|0)|0}var Ah=64,Ch=4194304;function Wc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Vf(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Wc(a):(i&=o,i!==0&&(r=Wc(i)))}else o=t&~s,o!==0?r=Wc(o):i!==0&&(r=Wc(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-jr(e),s=1<<t,r|=n[t],e&=~s;return r}function K2(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Q2(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-jr(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=K2(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function qy(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function c1(){var n=Ah;return Ah<<=1,!(Ah&4194240)&&(Ah=64),n}function Cg(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Td(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-jr(e),n[e]=t}function Y2(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-jr(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Dv(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-jr(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var Ye=0;function u1(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var d1,Ov,h1,f1,p1,Wy=!1,Rh=[],Si=null,bi=null,Ai=null,Du=new Map,Ou=new Map,ui=[],J2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kE(n,e){switch(n){case"focusin":case"focusout":Si=null;break;case"dragenter":case"dragleave":bi=null;break;case"mouseover":case"mouseout":Ai=null;break;case"pointerover":case"pointerout":Du.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ou.delete(e.pointerId)}}function Ac(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=bd(e),e!==null&&Ov(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function X2(n,e,t,r,s){switch(e){case"focusin":return Si=Ac(Si,n,e,t,r,s),!0;case"dragenter":return bi=Ac(bi,n,e,t,r,s),!0;case"mouseover":return Ai=Ac(Ai,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Du.set(i,Ac(Du.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ou.set(i,Ac(Ou.get(i)||null,n,e,t,r,s)),!0}return!1}function m1(n){var e=Ao(n.target);if(e!==null){var t=ua(e);if(t!==null){if(e=t.tag,e===13){if(e=r1(t),e!==null){n.blockedOn=e,p1(n.priority,function(){h1(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function sf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Gy(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Uy=r,t.target.dispatchEvent(r),Uy=null}else return e=bd(t),e!==null&&Ov(e),n.blockedOn=t,!1;e.shift()}return!0}function DE(n,e,t){sf(n)&&t.delete(e)}function Z2(){Wy=!1,Si!==null&&sf(Si)&&(Si=null),bi!==null&&sf(bi)&&(bi=null),Ai!==null&&sf(Ai)&&(Ai=null),Du.forEach(DE),Ou.forEach(DE)}function Cc(n,e){n.blockedOn===e&&(n.blockedOn=null,Wy||(Wy=!0,hr.unstable_scheduleCallback(hr.unstable_NormalPriority,Z2)))}function Mu(n){function e(s){return Cc(s,n)}if(0<Rh.length){Cc(Rh[0],n);for(var t=1;t<Rh.length;t++){var r=Rh[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Si!==null&&Cc(Si,n),bi!==null&&Cc(bi,n),Ai!==null&&Cc(Ai,n),Du.forEach(e),Ou.forEach(e),t=0;t<ui.length;t++)r=ui[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<ui.length&&(t=ui[0],t.blockedOn===null);)m1(t),t.blockedOn===null&&ui.shift()}var rl=zs.ReactCurrentBatchConfig,Ff=!0;function eO(n,e,t,r){var s=Ye,i=rl.transition;rl.transition=null;try{Ye=1,Mv(n,e,t,r)}finally{Ye=s,rl.transition=i}}function tO(n,e,t,r){var s=Ye,i=rl.transition;rl.transition=null;try{Ye=4,Mv(n,e,t,r)}finally{Ye=s,rl.transition=i}}function Mv(n,e,t,r){if(Ff){var s=Gy(n,e,t,r);if(s===null)Fg(n,e,r,jf,t),kE(n,r);else if(X2(s,n,e,t,r))r.stopPropagation();else if(kE(n,r),e&4&&-1<J2.indexOf(n)){for(;s!==null;){var i=bd(s);if(i!==null&&d1(i),i=Gy(n,e,t,r),i===null&&Fg(n,e,r,jf,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else Fg(n,e,r,null,t)}}var jf=null;function Gy(n,e,t,r){if(jf=null,n=Pv(r),n=Ao(n),n!==null)if(e=ua(n),e===null)n=null;else if(t=e.tag,t===13){if(n=r1(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return jf=n,null}function g1(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($2()){case kv:return 1;case a1:return 4;case Lf:case z2:return 16;case l1:return 536870912;default:return 16}default:return 16}}var yi=null,Lv=null,of=null;function y1(){if(of)return of;var n,e=Lv,t=e.length,r,s="value"in yi?yi.value:yi.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return of=s.slice(n,1<r?1-r:void 0)}function af(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Nh(){return!0}function OE(){return!1}function yr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Nh:OE,this.isPropagationStopped=OE,this}return bt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Nh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Nh)},persist:function(){},isPersistent:Nh}),e}var Kl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vv=yr(Kl),Sd=bt({},Kl,{view:0,detail:0}),nO=yr(Sd),Rg,Ng,Rc,Wp=bt({},Sd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fv,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Rc&&(Rc&&n.type==="mousemove"?(Rg=n.screenX-Rc.screenX,Ng=n.screenY-Rc.screenY):Ng=Rg=0,Rc=n),Rg)},movementY:function(n){return"movementY"in n?n.movementY:Ng}}),ME=yr(Wp),rO=bt({},Wp,{dataTransfer:0}),sO=yr(rO),iO=bt({},Sd,{relatedTarget:0}),Pg=yr(iO),oO=bt({},Kl,{animationName:0,elapsedTime:0,pseudoElement:0}),aO=yr(oO),lO=bt({},Kl,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),cO=yr(lO),uO=bt({},Kl,{data:0}),LE=yr(uO),dO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=fO[n])?!!e[n]:!1}function Fv(){return pO}var mO=bt({},Sd,{key:function(n){if(n.key){var e=dO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=af(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?hO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fv,charCode:function(n){return n.type==="keypress"?af(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?af(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),gO=yr(mO),yO=bt({},Wp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),VE=yr(yO),_O=bt({},Sd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fv}),vO=yr(_O),wO=bt({},Kl,{propertyName:0,elapsedTime:0,pseudoElement:0}),IO=yr(wO),EO=bt({},Wp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),xO=yr(EO),TO=[9,13,27,32],jv=ks&&"CompositionEvent"in window,su=null;ks&&"documentMode"in document&&(su=document.documentMode);var SO=ks&&"TextEvent"in window&&!su,_1=ks&&(!jv||su&&8<su&&11>=su),FE=String.fromCharCode(32),jE=!1;function v1(n,e){switch(n){case"keyup":return TO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function w1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var qa=!1;function bO(n,e){switch(n){case"compositionend":return w1(e);case"keypress":return e.which!==32?null:(jE=!0,FE);case"textInput":return n=e.data,n===FE&&jE?null:n;default:return null}}function AO(n,e){if(qa)return n==="compositionend"||!jv&&v1(n,e)?(n=y1(),of=Lv=yi=null,qa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return _1&&e.locale!=="ko"?null:e.data;default:return null}}var CO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function UE(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!CO[n.type]:e==="textarea"}function I1(n,e,t,r){Xb(r),e=Uf(e,"onChange"),0<e.length&&(t=new Vv("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var iu=null,Lu=null;function RO(n){k1(n,0)}function Gp(n){var e=Ha(n);if(Wb(e))return n}function NO(n,e){if(n==="change")return e}var E1=!1;if(ks){var kg;if(ks){var Dg="oninput"in document;if(!Dg){var BE=document.createElement("div");BE.setAttribute("oninput","return;"),Dg=typeof BE.oninput=="function"}kg=Dg}else kg=!1;E1=kg&&(!document.documentMode||9<document.documentMode)}function $E(){iu&&(iu.detachEvent("onpropertychange",x1),Lu=iu=null)}function x1(n){if(n.propertyName==="value"&&Gp(Lu)){var e=[];I1(e,Lu,n,Pv(n)),n1(RO,e)}}function PO(n,e,t){n==="focusin"?($E(),iu=e,Lu=t,iu.attachEvent("onpropertychange",x1)):n==="focusout"&&$E()}function kO(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Gp(Lu)}function DO(n,e){if(n==="click")return Gp(e)}function OO(n,e){if(n==="input"||n==="change")return Gp(e)}function MO(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var zr=typeof Object.is=="function"?Object.is:MO;function Vu(n,e){if(zr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Cy.call(e,s)||!zr(n[s],e[s]))return!1}return!0}function zE(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function qE(n,e){var t=zE(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=zE(t)}}function T1(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?T1(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function S1(){for(var n=window,e=Df();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Df(n.document)}return e}function Uv(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function LO(n){var e=S1(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&T1(t.ownerDocument.documentElement,t)){if(r!==null&&Uv(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=qE(t,i);var o=qE(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var VO=ks&&"documentMode"in document&&11>=document.documentMode,Wa=null,Hy=null,ou=null,Ky=!1;function WE(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Ky||Wa==null||Wa!==Df(r)||(r=Wa,"selectionStart"in r&&Uv(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ou&&Vu(ou,r)||(ou=r,r=Uf(Hy,"onSelect"),0<r.length&&(e=new Vv("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Wa)))}function Ph(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ga={animationend:Ph("Animation","AnimationEnd"),animationiteration:Ph("Animation","AnimationIteration"),animationstart:Ph("Animation","AnimationStart"),transitionend:Ph("Transition","TransitionEnd")},Og={},b1={};ks&&(b1=document.createElement("div").style,"AnimationEvent"in window||(delete Ga.animationend.animation,delete Ga.animationiteration.animation,delete Ga.animationstart.animation),"TransitionEvent"in window||delete Ga.transitionend.transition);function Hp(n){if(Og[n])return Og[n];if(!Ga[n])return n;var e=Ga[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in b1)return Og[n]=e[t];return n}var A1=Hp("animationend"),C1=Hp("animationiteration"),R1=Hp("animationstart"),N1=Hp("transitionend"),P1=new Map,GE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function eo(n,e){P1.set(n,e),ca(e,[n])}for(var Mg=0;Mg<GE.length;Mg++){var Lg=GE[Mg],FO=Lg.toLowerCase(),jO=Lg[0].toUpperCase()+Lg.slice(1);eo(FO,"on"+jO)}eo(A1,"onAnimationEnd");eo(C1,"onAnimationIteration");eo(R1,"onAnimationStart");eo("dblclick","onDoubleClick");eo("focusin","onFocus");eo("focusout","onBlur");eo(N1,"onTransitionEnd");pl("onMouseEnter",["mouseout","mouseover"]);pl("onMouseLeave",["mouseout","mouseover"]);pl("onPointerEnter",["pointerout","pointerover"]);pl("onPointerLeave",["pointerout","pointerover"]);ca("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ca("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ca("onBeforeInput",["compositionend","keypress","textInput","paste"]);ca("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ca("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ca("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UO=new Set("cancel close invalid load scroll toggle".split(" ").concat(Gc));function HE(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,F2(r,e,void 0,n),n.currentTarget=null}function k1(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;HE(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;HE(s,a,u),i=l}}}if(Mf)throw n=zy,Mf=!1,zy=null,n}function ht(n,e){var t=e[Zy];t===void 0&&(t=e[Zy]=new Set);var r=n+"__bubble";t.has(r)||(D1(e,n,2,!1),t.add(r))}function Vg(n,e,t){var r=0;e&&(r|=4),D1(t,n,r,e)}var kh="_reactListening"+Math.random().toString(36).slice(2);function Fu(n){if(!n[kh]){n[kh]=!0,Ub.forEach(function(t){t!=="selectionchange"&&(UO.has(t)||Vg(t,!1,n),Vg(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[kh]||(e[kh]=!0,Vg("selectionchange",!1,e))}}function D1(n,e,t,r){switch(g1(e)){case 1:var s=eO;break;case 4:s=tO;break;default:s=Mv}t=s.bind(null,e,t,n),s=void 0,!$y||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function Fg(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Ao(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}n1(function(){var u=i,h=Pv(t),f=[];e:{var p=P1.get(n);if(p!==void 0){var y=Vv,x=n;switch(n){case"keypress":if(af(t)===0)break e;case"keydown":case"keyup":y=gO;break;case"focusin":x="focus",y=Pg;break;case"focusout":x="blur",y=Pg;break;case"beforeblur":case"afterblur":y=Pg;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=ME;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=sO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=vO;break;case A1:case C1:case R1:y=aO;break;case N1:y=IO;break;case"scroll":y=nO;break;case"wheel":y=xO;break;case"copy":case"cut":case"paste":y=cO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=VE}var T=(e&4)!==0,P=!T&&n==="scroll",R=T?p!==null?p+"Capture":null:p;T=[];for(var b=u,N;b!==null;){N=b;var k=N.stateNode;if(N.tag===5&&k!==null&&(N=k,R!==null&&(k=ku(b,R),k!=null&&T.push(ju(b,k,N)))),P)break;b=b.return}0<T.length&&(p=new y(p,x,null,t,h),f.push({event:p,listeners:T}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",p&&t!==Uy&&(x=t.relatedTarget||t.fromElement)&&(Ao(x)||x[Ds]))break e;if((y||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,y?(x=t.relatedTarget||t.toElement,y=u,x=x?Ao(x):null,x!==null&&(P=ua(x),x!==P||x.tag!==5&&x.tag!==6)&&(x=null)):(y=null,x=u),y!==x)){if(T=ME,k="onMouseLeave",R="onMouseEnter",b="mouse",(n==="pointerout"||n==="pointerover")&&(T=VE,k="onPointerLeave",R="onPointerEnter",b="pointer"),P=y==null?p:Ha(y),N=x==null?p:Ha(x),p=new T(k,b+"leave",y,t,h),p.target=P,p.relatedTarget=N,k=null,Ao(h)===u&&(T=new T(R,b+"enter",x,t,h),T.target=N,T.relatedTarget=P,k=T),P=k,y&&x)t:{for(T=y,R=x,b=0,N=T;N;N=Na(N))b++;for(N=0,k=R;k;k=Na(k))N++;for(;0<b-N;)T=Na(T),b--;for(;0<N-b;)R=Na(R),N--;for(;b--;){if(T===R||R!==null&&T===R.alternate)break t;T=Na(T),R=Na(R)}T=null}else T=null;y!==null&&KE(f,p,y,T,!1),x!==null&&P!==null&&KE(f,P,x,T,!0)}}e:{if(p=u?Ha(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var U=NO;else if(UE(p))if(E1)U=OO;else{U=kO;var V=PO}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(U=DO);if(U&&(U=U(n,u))){I1(f,U,t,h);break e}V&&V(n,p,u),n==="focusout"&&(V=p._wrapperState)&&V.controlled&&p.type==="number"&&My(p,"number",p.value)}switch(V=u?Ha(u):window,n){case"focusin":(UE(V)||V.contentEditable==="true")&&(Wa=V,Hy=u,ou=null);break;case"focusout":ou=Hy=Wa=null;break;case"mousedown":Ky=!0;break;case"contextmenu":case"mouseup":case"dragend":Ky=!1,WE(f,t,h);break;case"selectionchange":if(VO)break;case"keydown":case"keyup":WE(f,t,h)}var A;if(jv)e:{switch(n){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else qa?v1(n,t)&&(v="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(v="onCompositionStart");v&&(_1&&t.locale!=="ko"&&(qa||v!=="onCompositionStart"?v==="onCompositionEnd"&&qa&&(A=y1()):(yi=h,Lv="value"in yi?yi.value:yi.textContent,qa=!0)),V=Uf(u,v),0<V.length&&(v=new LE(v,n,null,t,h),f.push({event:v,listeners:V}),A?v.data=A:(A=w1(t),A!==null&&(v.data=A)))),(A=SO?bO(n,t):AO(n,t))&&(u=Uf(u,"onBeforeInput"),0<u.length&&(h=new LE("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=A))}k1(f,e)})}function ju(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Uf(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ku(n,t),i!=null&&r.unshift(ju(n,i,s)),i=ku(n,e),i!=null&&r.push(ju(n,i,s))),n=n.return}return r}function Na(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function KE(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=ku(t,i),l!=null&&o.unshift(ju(t,l,a))):s||(l=ku(t,i),l!=null&&o.push(ju(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var BO=/\r\n?/g,$O=/\u0000|\uFFFD/g;function QE(n){return(typeof n=="string"?n:""+n).replace(BO,`
`).replace($O,"")}function Dh(n,e,t){if(e=QE(e),QE(n)!==e&&t)throw Error(q(425))}function Bf(){}var Qy=null,Yy=null;function Jy(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Xy=typeof setTimeout=="function"?setTimeout:void 0,zO=typeof clearTimeout=="function"?clearTimeout:void 0,YE=typeof Promise=="function"?Promise:void 0,qO=typeof queueMicrotask=="function"?queueMicrotask:typeof YE<"u"?function(n){return YE.resolve(null).then(n).catch(WO)}:Xy;function WO(n){setTimeout(function(){throw n})}function jg(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Mu(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Mu(e)}function Ci(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function JE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ql=Math.random().toString(36).slice(2),es="__reactFiber$"+Ql,Uu="__reactProps$"+Ql,Ds="__reactContainer$"+Ql,Zy="__reactEvents$"+Ql,GO="__reactListeners$"+Ql,HO="__reactHandles$"+Ql;function Ao(n){var e=n[es];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ds]||t[es]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=JE(n);n!==null;){if(t=n[es])return t;n=JE(n)}return e}n=t,t=n.parentNode}return null}function bd(n){return n=n[es]||n[Ds],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ha(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(q(33))}function Kp(n){return n[Uu]||null}var e_=[],Ka=-1;function to(n){return{current:n}}function pt(n){0>Ka||(n.current=e_[Ka],e_[Ka]=null,Ka--)}function it(n,e){Ka++,e_[Ka]=n.current,n.current=e}var Bi={},kn=to(Bi),Kn=to(!1),Bo=Bi;function ml(n,e){var t=n.type.contextTypes;if(!t)return Bi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Qn(n){return n=n.childContextTypes,n!=null}function $f(){pt(Kn),pt(kn)}function XE(n,e,t){if(kn.current!==Bi)throw Error(q(168));it(kn,e),it(Kn,t)}function O1(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(q(108,P2(n)||"Unknown",s));return bt({},t,r)}function zf(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Bi,Bo=kn.current,it(kn,n),it(Kn,Kn.current),!0}function ZE(n,e,t){var r=n.stateNode;if(!r)throw Error(q(169));t?(n=O1(n,e,Bo),r.__reactInternalMemoizedMergedChildContext=n,pt(Kn),pt(kn),it(kn,n)):pt(Kn),it(Kn,t)}var Es=null,Qp=!1,Ug=!1;function M1(n){Es===null?Es=[n]:Es.push(n)}function KO(n){Qp=!0,M1(n)}function no(){if(!Ug&&Es!==null){Ug=!0;var n=0,e=Ye;try{var t=Es;for(Ye=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Es=null,Qp=!1}catch(s){throw Es!==null&&(Es=Es.slice(n+1)),o1(kv,no),s}finally{Ye=e,Ug=!1}}return null}var Qa=[],Ya=0,qf=null,Wf=0,vr=[],wr=0,$o=null,Ts=1,Ss="";function yo(n,e){Qa[Ya++]=Wf,Qa[Ya++]=qf,qf=n,Wf=e}function L1(n,e,t){vr[wr++]=Ts,vr[wr++]=Ss,vr[wr++]=$o,$o=n;var r=Ts;n=Ss;var s=32-jr(r)-1;r&=~(1<<s),t+=1;var i=32-jr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Ts=1<<32-jr(e)+s|t<<s|r,Ss=i+n}else Ts=1<<i|t<<s|r,Ss=n}function Bv(n){n.return!==null&&(yo(n,1),L1(n,1,0))}function $v(n){for(;n===qf;)qf=Qa[--Ya],Qa[Ya]=null,Wf=Qa[--Ya],Qa[Ya]=null;for(;n===$o;)$o=vr[--wr],vr[wr]=null,Ss=vr[--wr],vr[wr]=null,Ts=vr[--wr],vr[wr]=null}var lr=null,ar=null,_t=!1,Lr=null;function V1(n,e){var t=Er(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function ex(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,lr=n,ar=Ci(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,lr=n,ar=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=$o!==null?{id:Ts,overflow:Ss}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Er(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,lr=n,ar=null,!0):!1;default:return!1}}function t_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function n_(n){if(_t){var e=ar;if(e){var t=e;if(!ex(n,e)){if(t_(n))throw Error(q(418));e=Ci(t.nextSibling);var r=lr;e&&ex(n,e)?V1(r,t):(n.flags=n.flags&-4097|2,_t=!1,lr=n)}}else{if(t_(n))throw Error(q(418));n.flags=n.flags&-4097|2,_t=!1,lr=n}}}function tx(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;lr=n}function Oh(n){if(n!==lr)return!1;if(!_t)return tx(n),_t=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Jy(n.type,n.memoizedProps)),e&&(e=ar)){if(t_(n))throw F1(),Error(q(418));for(;e;)V1(n,e),e=Ci(e.nextSibling)}if(tx(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(q(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ar=Ci(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ar=null}}else ar=lr?Ci(n.stateNode.nextSibling):null;return!0}function F1(){for(var n=ar;n;)n=Ci(n.nextSibling)}function gl(){ar=lr=null,_t=!1}function zv(n){Lr===null?Lr=[n]:Lr.push(n)}var QO=zs.ReactCurrentBatchConfig;function Nc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(q(309));var r=t.stateNode}if(!r)throw Error(q(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(q(284));if(!t._owner)throw Error(q(290,n))}return n}function Mh(n,e){throw n=Object.prototype.toString.call(e),Error(q(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function nx(n){var e=n._init;return e(n._payload)}function j1(n){function e(R,b){if(n){var N=R.deletions;N===null?(R.deletions=[b],R.flags|=16):N.push(b)}}function t(R,b){if(!n)return null;for(;b!==null;)e(R,b),b=b.sibling;return null}function r(R,b){for(R=new Map;b!==null;)b.key!==null?R.set(b.key,b):R.set(b.index,b),b=b.sibling;return R}function s(R,b){return R=ki(R,b),R.index=0,R.sibling=null,R}function i(R,b,N){return R.index=N,n?(N=R.alternate,N!==null?(N=N.index,N<b?(R.flags|=2,b):N):(R.flags|=2,b)):(R.flags|=1048576,b)}function o(R){return n&&R.alternate===null&&(R.flags|=2),R}function a(R,b,N,k){return b===null||b.tag!==6?(b=Hg(N,R.mode,k),b.return=R,b):(b=s(b,N),b.return=R,b)}function l(R,b,N,k){var U=N.type;return U===za?h(R,b,N.props.children,k,N.key):b!==null&&(b.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===li&&nx(U)===b.type)?(k=s(b,N.props),k.ref=Nc(R,b,N),k.return=R,k):(k=pf(N.type,N.key,N.props,null,R.mode,k),k.ref=Nc(R,b,N),k.return=R,k)}function u(R,b,N,k){return b===null||b.tag!==4||b.stateNode.containerInfo!==N.containerInfo||b.stateNode.implementation!==N.implementation?(b=Kg(N,R.mode,k),b.return=R,b):(b=s(b,N.children||[]),b.return=R,b)}function h(R,b,N,k,U){return b===null||b.tag!==7?(b=Mo(N,R.mode,k,U),b.return=R,b):(b=s(b,N),b.return=R,b)}function f(R,b,N){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Hg(""+b,R.mode,N),b.return=R,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Th:return N=pf(b.type,b.key,b.props,null,R.mode,N),N.ref=Nc(R,null,b),N.return=R,N;case $a:return b=Kg(b,R.mode,N),b.return=R,b;case li:var k=b._init;return f(R,k(b._payload),N)}if(qc(b)||Sc(b))return b=Mo(b,R.mode,N,null),b.return=R,b;Mh(R,b)}return null}function p(R,b,N,k){var U=b!==null?b.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return U!==null?null:a(R,b,""+N,k);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case Th:return N.key===U?l(R,b,N,k):null;case $a:return N.key===U?u(R,b,N,k):null;case li:return U=N._init,p(R,b,U(N._payload),k)}if(qc(N)||Sc(N))return U!==null?null:h(R,b,N,k,null);Mh(R,N)}return null}function y(R,b,N,k,U){if(typeof k=="string"&&k!==""||typeof k=="number")return R=R.get(N)||null,a(b,R,""+k,U);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Th:return R=R.get(k.key===null?N:k.key)||null,l(b,R,k,U);case $a:return R=R.get(k.key===null?N:k.key)||null,u(b,R,k,U);case li:var V=k._init;return y(R,b,N,V(k._payload),U)}if(qc(k)||Sc(k))return R=R.get(N)||null,h(b,R,k,U,null);Mh(b,k)}return null}function x(R,b,N,k){for(var U=null,V=null,A=b,v=b=0,S=null;A!==null&&v<N.length;v++){A.index>v?(S=A,A=null):S=A.sibling;var _=p(R,A,N[v],k);if(_===null){A===null&&(A=S);break}n&&A&&_.alternate===null&&e(R,A),b=i(_,b,v),V===null?U=_:V.sibling=_,V=_,A=S}if(v===N.length)return t(R,A),_t&&yo(R,v),U;if(A===null){for(;v<N.length;v++)A=f(R,N[v],k),A!==null&&(b=i(A,b,v),V===null?U=A:V.sibling=A,V=A);return _t&&yo(R,v),U}for(A=r(R,A);v<N.length;v++)S=y(A,R,v,N[v],k),S!==null&&(n&&S.alternate!==null&&A.delete(S.key===null?v:S.key),b=i(S,b,v),V===null?U=S:V.sibling=S,V=S);return n&&A.forEach(function(E){return e(R,E)}),_t&&yo(R,v),U}function T(R,b,N,k){var U=Sc(N);if(typeof U!="function")throw Error(q(150));if(N=U.call(N),N==null)throw Error(q(151));for(var V=U=null,A=b,v=b=0,S=null,_=N.next();A!==null&&!_.done;v++,_=N.next()){A.index>v?(S=A,A=null):S=A.sibling;var E=p(R,A,_.value,k);if(E===null){A===null&&(A=S);break}n&&A&&E.alternate===null&&e(R,A),b=i(E,b,v),V===null?U=E:V.sibling=E,V=E,A=S}if(_.done)return t(R,A),_t&&yo(R,v),U;if(A===null){for(;!_.done;v++,_=N.next())_=f(R,_.value,k),_!==null&&(b=i(_,b,v),V===null?U=_:V.sibling=_,V=_);return _t&&yo(R,v),U}for(A=r(R,A);!_.done;v++,_=N.next())_=y(A,R,v,_.value,k),_!==null&&(n&&_.alternate!==null&&A.delete(_.key===null?v:_.key),b=i(_,b,v),V===null?U=_:V.sibling=_,V=_);return n&&A.forEach(function(C){return e(R,C)}),_t&&yo(R,v),U}function P(R,b,N,k){if(typeof N=="object"&&N!==null&&N.type===za&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case Th:e:{for(var U=N.key,V=b;V!==null;){if(V.key===U){if(U=N.type,U===za){if(V.tag===7){t(R,V.sibling),b=s(V,N.props.children),b.return=R,R=b;break e}}else if(V.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===li&&nx(U)===V.type){t(R,V.sibling),b=s(V,N.props),b.ref=Nc(R,V,N),b.return=R,R=b;break e}t(R,V);break}else e(R,V);V=V.sibling}N.type===za?(b=Mo(N.props.children,R.mode,k,N.key),b.return=R,R=b):(k=pf(N.type,N.key,N.props,null,R.mode,k),k.ref=Nc(R,b,N),k.return=R,R=k)}return o(R);case $a:e:{for(V=N.key;b!==null;){if(b.key===V)if(b.tag===4&&b.stateNode.containerInfo===N.containerInfo&&b.stateNode.implementation===N.implementation){t(R,b.sibling),b=s(b,N.children||[]),b.return=R,R=b;break e}else{t(R,b);break}else e(R,b);b=b.sibling}b=Kg(N,R.mode,k),b.return=R,R=b}return o(R);case li:return V=N._init,P(R,b,V(N._payload),k)}if(qc(N))return x(R,b,N,k);if(Sc(N))return T(R,b,N,k);Mh(R,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,b!==null&&b.tag===6?(t(R,b.sibling),b=s(b,N),b.return=R,R=b):(t(R,b),b=Hg(N,R.mode,k),b.return=R,R=b),o(R)):t(R,b)}return P}var yl=j1(!0),U1=j1(!1),Gf=to(null),Hf=null,Ja=null,qv=null;function Wv(){qv=Ja=Hf=null}function Gv(n){var e=Gf.current;pt(Gf),n._currentValue=e}function r_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function sl(n,e){Hf=n,qv=Ja=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(qn=!0),n.firstContext=null)}function br(n){var e=n._currentValue;if(qv!==n)if(n={context:n,memoizedValue:e,next:null},Ja===null){if(Hf===null)throw Error(q(308));Ja=n,Hf.dependencies={lanes:0,firstContext:n}}else Ja=Ja.next=n;return e}var Co=null;function Hv(n){Co===null?Co=[n]:Co.push(n)}function B1(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Hv(e)):(t.next=s.next,s.next=t),e.interleaved=t,Os(n,r)}function Os(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ci=!1;function Kv(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ns(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Ri(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Be&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Os(n,t)}return s=r.interleaved,s===null?(e.next=e,Hv(r)):(e.next=s.next,s.next=e),r.interleaved=e,Os(n,t)}function lf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Dv(n,t)}}function rx(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Kf(n,e,t,r){var s=n.updateQueue;ci=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var p=a.lane,y=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var x=n,T=a;switch(p=e,y=t,T.tag){case 1:if(x=T.payload,typeof x=="function"){f=x.call(y,f,p);break e}f=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=T.payload,p=typeof x=="function"?x.call(y,f,p):x,p==null)break e;f=bt({},f,p);break e;case 2:ci=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[a]:p.push(a))}else y={eventTime:y,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,o|=p;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;p=a,a=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);qo|=o,n.lanes=o,n.memoizedState=f}}function sx(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(q(191,s));s.call(r)}}}var Ad={},as=to(Ad),Bu=to(Ad),$u=to(Ad);function Ro(n){if(n===Ad)throw Error(q(174));return n}function Qv(n,e){switch(it($u,e),it(Bu,n),it(as,Ad),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Vy(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Vy(e,n)}pt(as),it(as,e)}function _l(){pt(as),pt(Bu),pt($u)}function z1(n){Ro($u.current);var e=Ro(as.current),t=Vy(e,n.type);e!==t&&(it(Bu,n),it(as,t))}function Yv(n){Bu.current===n&&(pt(as),pt(Bu))}var xt=to(0);function Qf(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Bg=[];function Jv(){for(var n=0;n<Bg.length;n++)Bg[n]._workInProgressVersionPrimary=null;Bg.length=0}var cf=zs.ReactCurrentDispatcher,$g=zs.ReactCurrentBatchConfig,zo=0,St=null,Ht=null,nn=null,Yf=!1,au=!1,zu=0,YO=0;function Tn(){throw Error(q(321))}function Xv(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!zr(n[t],e[t]))return!1;return!0}function Zv(n,e,t,r,s,i){if(zo=i,St=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,cf.current=n===null||n.memoizedState===null?eM:tM,n=t(r,s),au){i=0;do{if(au=!1,zu=0,25<=i)throw Error(q(301));i+=1,nn=Ht=null,e.updateQueue=null,cf.current=nM,n=t(r,s)}while(au)}if(cf.current=Jf,e=Ht!==null&&Ht.next!==null,zo=0,nn=Ht=St=null,Yf=!1,e)throw Error(q(300));return n}function e0(){var n=zu!==0;return zu=0,n}function Jr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?St.memoizedState=nn=n:nn=nn.next=n,nn}function Ar(){if(Ht===null){var n=St.alternate;n=n!==null?n.memoizedState:null}else n=Ht.next;var e=nn===null?St.memoizedState:nn.next;if(e!==null)nn=e,Ht=n;else{if(n===null)throw Error(q(310));Ht=n,n={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},nn===null?St.memoizedState=nn=n:nn=nn.next=n}return nn}function qu(n,e){return typeof e=="function"?e(n):e}function zg(n){var e=Ar(),t=e.queue;if(t===null)throw Error(q(311));t.lastRenderedReducer=n;var r=Ht,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((zo&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,St.lanes|=h,qo|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,zr(r,e.memoizedState)||(qn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,St.lanes|=i,qo|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function qg(n){var e=Ar(),t=e.queue;if(t===null)throw Error(q(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);zr(i,e.memoizedState)||(qn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function q1(){}function W1(n,e){var t=St,r=Ar(),s=e(),i=!zr(r.memoizedState,s);if(i&&(r.memoizedState=s,qn=!0),r=r.queue,t0(K1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||nn!==null&&nn.memoizedState.tag&1){if(t.flags|=2048,Wu(9,H1.bind(null,t,r,s,e),void 0,null),on===null)throw Error(q(349));zo&30||G1(t,e,s)}return s}function G1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function H1(n,e,t,r){e.value=t,e.getSnapshot=r,Q1(e)&&Y1(n)}function K1(n,e,t){return t(function(){Q1(e)&&Y1(n)})}function Q1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!zr(n,t)}catch{return!0}}function Y1(n){var e=Os(n,1);e!==null&&Ur(e,n,1,-1)}function ix(n){var e=Jr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qu,lastRenderedState:n},e.queue=n,n=n.dispatch=ZO.bind(null,St,n),[e.memoizedState,n]}function Wu(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function J1(){return Ar().memoizedState}function uf(n,e,t,r){var s=Jr();St.flags|=n,s.memoizedState=Wu(1|e,t,void 0,r===void 0?null:r)}function Yp(n,e,t,r){var s=Ar();r=r===void 0?null:r;var i=void 0;if(Ht!==null){var o=Ht.memoizedState;if(i=o.destroy,r!==null&&Xv(r,o.deps)){s.memoizedState=Wu(e,t,i,r);return}}St.flags|=n,s.memoizedState=Wu(1|e,t,i,r)}function ox(n,e){return uf(8390656,8,n,e)}function t0(n,e){return Yp(2048,8,n,e)}function X1(n,e){return Yp(4,2,n,e)}function Z1(n,e){return Yp(4,4,n,e)}function eA(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function tA(n,e,t){return t=t!=null?t.concat([n]):null,Yp(4,4,eA.bind(null,e,n),t)}function n0(){}function nA(n,e){var t=Ar();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Xv(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function rA(n,e){var t=Ar();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Xv(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function sA(n,e,t){return zo&21?(zr(t,e)||(t=c1(),St.lanes|=t,qo|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,qn=!0),n.memoizedState=t)}function JO(n,e){var t=Ye;Ye=t!==0&&4>t?t:4,n(!0);var r=$g.transition;$g.transition={};try{n(!1),e()}finally{Ye=t,$g.transition=r}}function iA(){return Ar().memoizedState}function XO(n,e,t){var r=Pi(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},oA(n))aA(e,t);else if(t=B1(n,e,t,r),t!==null){var s=Vn();Ur(t,n,r,s),lA(t,e,r)}}function ZO(n,e,t){var r=Pi(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(oA(n))aA(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,zr(a,o)){var l=e.interleaved;l===null?(s.next=s,Hv(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=B1(n,e,s,r),t!==null&&(s=Vn(),Ur(t,n,r,s),lA(t,e,r))}}function oA(n){var e=n.alternate;return n===St||e!==null&&e===St}function aA(n,e){au=Yf=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function lA(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Dv(n,t)}}var Jf={readContext:br,useCallback:Tn,useContext:Tn,useEffect:Tn,useImperativeHandle:Tn,useInsertionEffect:Tn,useLayoutEffect:Tn,useMemo:Tn,useReducer:Tn,useRef:Tn,useState:Tn,useDebugValue:Tn,useDeferredValue:Tn,useTransition:Tn,useMutableSource:Tn,useSyncExternalStore:Tn,useId:Tn,unstable_isNewReconciler:!1},eM={readContext:br,useCallback:function(n,e){return Jr().memoizedState=[n,e===void 0?null:e],n},useContext:br,useEffect:ox,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,uf(4194308,4,eA.bind(null,e,n),t)},useLayoutEffect:function(n,e){return uf(4194308,4,n,e)},useInsertionEffect:function(n,e){return uf(4,2,n,e)},useMemo:function(n,e){var t=Jr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Jr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=XO.bind(null,St,n),[r.memoizedState,n]},useRef:function(n){var e=Jr();return n={current:n},e.memoizedState=n},useState:ix,useDebugValue:n0,useDeferredValue:function(n){return Jr().memoizedState=n},useTransition:function(){var n=ix(!1),e=n[0];return n=JO.bind(null,n[1]),Jr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=St,s=Jr();if(_t){if(t===void 0)throw Error(q(407));t=t()}else{if(t=e(),on===null)throw Error(q(349));zo&30||G1(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,ox(K1.bind(null,r,i,n),[n]),r.flags|=2048,Wu(9,H1.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Jr(),e=on.identifierPrefix;if(_t){var t=Ss,r=Ts;t=(r&~(1<<32-jr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=zu++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=YO++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},tM={readContext:br,useCallback:nA,useContext:br,useEffect:t0,useImperativeHandle:tA,useInsertionEffect:X1,useLayoutEffect:Z1,useMemo:rA,useReducer:zg,useRef:J1,useState:function(){return zg(qu)},useDebugValue:n0,useDeferredValue:function(n){var e=Ar();return sA(e,Ht.memoizedState,n)},useTransition:function(){var n=zg(qu)[0],e=Ar().memoizedState;return[n,e]},useMutableSource:q1,useSyncExternalStore:W1,useId:iA,unstable_isNewReconciler:!1},nM={readContext:br,useCallback:nA,useContext:br,useEffect:t0,useImperativeHandle:tA,useInsertionEffect:X1,useLayoutEffect:Z1,useMemo:rA,useReducer:qg,useRef:J1,useState:function(){return qg(qu)},useDebugValue:n0,useDeferredValue:function(n){var e=Ar();return Ht===null?e.memoizedState=n:sA(e,Ht.memoizedState,n)},useTransition:function(){var n=qg(qu)[0],e=Ar().memoizedState;return[n,e]},useMutableSource:q1,useSyncExternalStore:W1,useId:iA,unstable_isNewReconciler:!1};function Dr(n,e){if(n&&n.defaultProps){e=bt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function s_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:bt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Jp={isMounted:function(n){return(n=n._reactInternals)?ua(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Vn(),s=Pi(n),i=Ns(r,s);i.payload=e,t!=null&&(i.callback=t),e=Ri(n,i,s),e!==null&&(Ur(e,n,s,r),lf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Vn(),s=Pi(n),i=Ns(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Ri(n,i,s),e!==null&&(Ur(e,n,s,r),lf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Vn(),r=Pi(n),s=Ns(t,r);s.tag=2,e!=null&&(s.callback=e),e=Ri(n,s,r),e!==null&&(Ur(e,n,r,t),lf(e,n,r))}};function ax(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Vu(t,r)||!Vu(s,i):!0}function cA(n,e,t){var r=!1,s=Bi,i=e.contextType;return typeof i=="object"&&i!==null?i=br(i):(s=Qn(e)?Bo:kn.current,r=e.contextTypes,i=(r=r!=null)?ml(n,s):Bi),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jp,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function lx(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Jp.enqueueReplaceState(e,e.state,null)}function i_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Kv(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=br(i):(i=Qn(e)?Bo:kn.current,s.context=ml(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(s_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Jp.enqueueReplaceState(s,s.state,null),Kf(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function vl(n,e){try{var t="",r=e;do t+=N2(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function Wg(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function o_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var rM=typeof WeakMap=="function"?WeakMap:Map;function uA(n,e,t){t=Ns(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Zf||(Zf=!0,g_=r),o_(n,e)},t}function dA(n,e,t){t=Ns(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){o_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){o_(n,e),typeof r!="function"&&(Ni===null?Ni=new Set([this]):Ni.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function cx(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new rM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=yM.bind(null,n,e,t),e.then(n,n))}function ux(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function dx(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Ns(-1,1),e.tag=2,Ri(t,e,1))),t.lanes|=1),n)}var sM=zs.ReactCurrentOwner,qn=!1;function Mn(n,e,t,r){e.child=n===null?U1(e,null,t,r):yl(e,n.child,t,r)}function hx(n,e,t,r,s){t=t.render;var i=e.ref;return sl(e,s),r=Zv(n,e,t,r,i,s),t=e0(),n!==null&&!qn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ms(n,e,s)):(_t&&t&&Bv(e),e.flags|=1,Mn(n,e,r,s),e.child)}function fx(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!u0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,hA(n,e,i,r,s)):(n=pf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Vu,t(o,r)&&n.ref===e.ref)return Ms(n,e,s)}return e.flags|=1,n=ki(i,r),n.ref=e.ref,n.return=e,e.child=n}function hA(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Vu(i,r)&&n.ref===e.ref)if(qn=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(qn=!0);else return e.lanes=n.lanes,Ms(n,e,s)}return a_(n,e,t,r,s)}function fA(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(Za,nr),nr|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,it(Za,nr),nr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,it(Za,nr),nr|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,it(Za,nr),nr|=r;return Mn(n,e,s,t),e.child}function pA(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function a_(n,e,t,r,s){var i=Qn(t)?Bo:kn.current;return i=ml(e,i),sl(e,s),t=Zv(n,e,t,r,i,s),r=e0(),n!==null&&!qn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ms(n,e,s)):(_t&&r&&Bv(e),e.flags|=1,Mn(n,e,t,s),e.child)}function px(n,e,t,r,s){if(Qn(t)){var i=!0;zf(e)}else i=!1;if(sl(e,s),e.stateNode===null)df(n,e),cA(e,t,r),i_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=br(u):(u=Qn(t)?Bo:kn.current,u=ml(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&lx(e,o,r,u),ci=!1;var p=e.memoizedState;o.state=p,Kf(e,r,o,s),l=e.memoizedState,a!==r||p!==l||Kn.current||ci?(typeof h=="function"&&(s_(e,t,h,r),l=e.memoizedState),(a=ci||ax(e,t,a,r,p,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,$1(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:Dr(e.type,a),o.props=u,f=e.pendingProps,p=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=br(l):(l=Qn(t)?Bo:kn.current,l=ml(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||p!==l)&&lx(e,o,r,l),ci=!1,p=e.memoizedState,o.state=p,Kf(e,r,o,s);var x=e.memoizedState;a!==f||p!==x||Kn.current||ci?(typeof y=="function"&&(s_(e,t,y,r),x=e.memoizedState),(u=ci||ax(e,t,u,r,p,x,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,x,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,x,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=x),o.props=r,o.state=x,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return l_(n,e,t,r,i,s)}function l_(n,e,t,r,s,i){pA(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&ZE(e,t,!1),Ms(n,e,i);r=e.stateNode,sM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=yl(e,n.child,null,i),e.child=yl(e,null,a,i)):Mn(n,e,a,i),e.memoizedState=r.state,s&&ZE(e,t,!0),e.child}function mA(n){var e=n.stateNode;e.pendingContext?XE(n,e.pendingContext,e.pendingContext!==e.context):e.context&&XE(n,e.context,!1),Qv(n,e.containerInfo)}function mx(n,e,t,r,s){return gl(),zv(s),e.flags|=256,Mn(n,e,t,r),e.child}var c_={dehydrated:null,treeContext:null,retryLane:0};function u_(n){return{baseLanes:n,cachePool:null,transitions:null}}function gA(n,e,t){var r=e.pendingProps,s=xt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),it(xt,s&1),n===null)return n_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=em(o,r,0,null),n=Mo(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=u_(t),e.memoizedState=c_,n):r0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return iM(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=ki(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=ki(a,i):(i=Mo(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?u_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=c_,r}return i=n.child,n=i.sibling,r=ki(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function r0(n,e){return e=em({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Lh(n,e,t,r){return r!==null&&zv(r),yl(e,n.child,null,t),n=r0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function iM(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=Wg(Error(q(422))),Lh(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=em({mode:"visible",children:r.children},s,0,null),i=Mo(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&yl(e,n.child,null,o),e.child.memoizedState=u_(o),e.memoizedState=c_,i);if(!(e.mode&1))return Lh(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(q(419)),r=Wg(i,r,void 0),Lh(n,e,o,r)}if(a=(o&n.childLanes)!==0,qn||a){if(r=on,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Os(n,s),Ur(r,n,s,-1))}return c0(),r=Wg(Error(q(421))),Lh(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=_M.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,ar=Ci(s.nextSibling),lr=e,_t=!0,Lr=null,n!==null&&(vr[wr++]=Ts,vr[wr++]=Ss,vr[wr++]=$o,Ts=n.id,Ss=n.overflow,$o=e),e=r0(e,r.children),e.flags|=4096,e)}function gx(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),r_(n.return,e,t)}function Gg(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function yA(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Mn(n,e,r.children,t),r=xt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&gx(n,t,e);else if(n.tag===19)gx(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(it(xt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Qf(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Gg(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Qf(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Gg(e,!0,t,null,i);break;case"together":Gg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function df(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ms(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),qo|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(q(153));if(e.child!==null){for(n=e.child,t=ki(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ki(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function oM(n,e,t){switch(e.tag){case 3:mA(e),gl();break;case 5:z1(e);break;case 1:Qn(e.type)&&zf(e);break;case 4:Qv(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;it(Gf,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(it(xt,xt.current&1),e.flags|=128,null):t&e.child.childLanes?gA(n,e,t):(it(xt,xt.current&1),n=Ms(n,e,t),n!==null?n.sibling:null);it(xt,xt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return yA(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),it(xt,xt.current),r)break;return null;case 22:case 23:return e.lanes=0,fA(n,e,t)}return Ms(n,e,t)}var _A,d_,vA,wA;_A=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};d_=function(){};vA=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Ro(as.current);var i=null;switch(t){case"input":s=Dy(n,s),r=Dy(n,r),i=[];break;case"select":s=bt({},s,{value:void 0}),r=bt({},r,{value:void 0}),i=[];break;case"textarea":s=Ly(n,s),r=Ly(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Bf)}Fy(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Nu.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Nu.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ht("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};wA=function(n,e,t,r){t!==r&&(e.flags|=4)};function Pc(n,e){if(!_t)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Sn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function aM(n,e,t){var r=e.pendingProps;switch($v(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sn(e),null;case 1:return Qn(e.type)&&$f(),Sn(e),null;case 3:return r=e.stateNode,_l(),pt(Kn),pt(kn),Jv(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Oh(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Lr!==null&&(v_(Lr),Lr=null))),d_(n,e),Sn(e),null;case 5:Yv(e);var s=Ro($u.current);if(t=e.type,n!==null&&e.stateNode!=null)vA(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(q(166));return Sn(e),null}if(n=Ro(as.current),Oh(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[es]=e,r[Uu]=i,n=(e.mode&1)!==0,t){case"dialog":ht("cancel",r),ht("close",r);break;case"iframe":case"object":case"embed":ht("load",r);break;case"video":case"audio":for(s=0;s<Gc.length;s++)ht(Gc[s],r);break;case"source":ht("error",r);break;case"img":case"image":case"link":ht("error",r),ht("load",r);break;case"details":ht("toggle",r);break;case"input":SE(r,i),ht("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},ht("invalid",r);break;case"textarea":AE(r,i),ht("invalid",r)}Fy(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Dh(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Dh(r.textContent,a,n),s=["children",""+a]):Nu.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ht("scroll",r)}switch(t){case"input":Sh(r),bE(r,i,!0);break;case"textarea":Sh(r),CE(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Bf)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Kb(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[es]=e,n[Uu]=r,_A(n,e,!1,!1),e.stateNode=n;e:{switch(o=jy(t,r),t){case"dialog":ht("cancel",n),ht("close",n),s=r;break;case"iframe":case"object":case"embed":ht("load",n),s=r;break;case"video":case"audio":for(s=0;s<Gc.length;s++)ht(Gc[s],n);s=r;break;case"source":ht("error",n),s=r;break;case"img":case"image":case"link":ht("error",n),ht("load",n),s=r;break;case"details":ht("toggle",n),s=r;break;case"input":SE(n,r),s=Dy(n,r),ht("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=bt({},r,{value:void 0}),ht("invalid",n);break;case"textarea":AE(n,r),s=Ly(n,r),ht("invalid",n);break;default:s=r}Fy(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?Jb(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Qb(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Pu(n,l):typeof l=="number"&&Pu(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Nu.hasOwnProperty(i)?l!=null&&i==="onScroll"&&ht("scroll",n):l!=null&&Av(n,i,l,o))}switch(t){case"input":Sh(n),bE(n,r,!1);break;case"textarea":Sh(n),CE(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Ui(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?el(n,!!r.multiple,i,!1):r.defaultValue!=null&&el(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Bf)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Sn(e),null;case 6:if(n&&e.stateNode!=null)wA(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(q(166));if(t=Ro($u.current),Ro(as.current),Oh(e)){if(r=e.stateNode,t=e.memoizedProps,r[es]=e,(i=r.nodeValue!==t)&&(n=lr,n!==null))switch(n.tag){case 3:Dh(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Dh(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[es]=e,e.stateNode=r}return Sn(e),null;case 13:if(pt(xt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(_t&&ar!==null&&e.mode&1&&!(e.flags&128))F1(),gl(),e.flags|=98560,i=!1;else if(i=Oh(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(q(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(q(317));i[es]=e}else gl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Sn(e),i=!1}else Lr!==null&&(v_(Lr),Lr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||xt.current&1?Qt===0&&(Qt=3):c0())),e.updateQueue!==null&&(e.flags|=4),Sn(e),null);case 4:return _l(),d_(n,e),n===null&&Fu(e.stateNode.containerInfo),Sn(e),null;case 10:return Gv(e.type._context),Sn(e),null;case 17:return Qn(e.type)&&$f(),Sn(e),null;case 19:if(pt(xt),i=e.memoizedState,i===null)return Sn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Pc(i,!1);else{if(Qt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Qf(n),o!==null){for(e.flags|=128,Pc(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return it(xt,xt.current&1|2),e.child}n=n.sibling}i.tail!==null&&Ft()>wl&&(e.flags|=128,r=!0,Pc(i,!1),e.lanes=4194304)}else{if(!r)if(n=Qf(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Pc(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!_t)return Sn(e),null}else 2*Ft()-i.renderingStartTime>wl&&t!==1073741824&&(e.flags|=128,r=!0,Pc(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ft(),e.sibling=null,t=xt.current,it(xt,r?t&1|2:t&1),e):(Sn(e),null);case 22:case 23:return l0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?nr&1073741824&&(Sn(e),e.subtreeFlags&6&&(e.flags|=8192)):Sn(e),null;case 24:return null;case 25:return null}throw Error(q(156,e.tag))}function lM(n,e){switch($v(e),e.tag){case 1:return Qn(e.type)&&$f(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return _l(),pt(Kn),pt(kn),Jv(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Yv(e),null;case 13:if(pt(xt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(q(340));gl()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return pt(xt),null;case 4:return _l(),null;case 10:return Gv(e.type._context),null;case 22:case 23:return l0(),null;case 24:return null;default:return null}}var Vh=!1,Cn=!1,cM=typeof WeakSet=="function"?WeakSet:Set,ne=null;function Xa(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){kt(n,e,r)}else t.current=null}function h_(n,e,t){try{t()}catch(r){kt(n,e,r)}}var yx=!1;function uM(n,e){if(Qy=Ff,n=S1(),Uv(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,p=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)p=f,f=y;for(;;){if(f===n)break t;if(p===t&&++u===s&&(a=o),p===i&&++h===r&&(l=o),(y=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=y}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Yy={focusedElem:n,selectionRange:t},Ff=!1,ne=e;ne!==null;)if(e=ne,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ne=n;else for(;ne!==null;){e=ne;try{var x=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var T=x.memoizedProps,P=x.memoizedState,R=e.stateNode,b=R.getSnapshotBeforeUpdate(e.elementType===e.type?T:Dr(e.type,T),P);R.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var N=e.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(k){kt(e,e.return,k)}if(n=e.sibling,n!==null){n.return=e.return,ne=n;break}ne=e.return}return x=yx,yx=!1,x}function lu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&h_(e,t,i)}s=s.next}while(s!==r)}}function Xp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function f_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function IA(n){var e=n.alternate;e!==null&&(n.alternate=null,IA(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[es],delete e[Uu],delete e[Zy],delete e[GO],delete e[HO])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function EA(n){return n.tag===5||n.tag===3||n.tag===4}function _x(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||EA(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function p_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Bf));else if(r!==4&&(n=n.child,n!==null))for(p_(n,e,t),n=n.sibling;n!==null;)p_(n,e,t),n=n.sibling}function m_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(m_(n,e,t),n=n.sibling;n!==null;)m_(n,e,t),n=n.sibling}var gn=null,Or=!1;function ri(n,e,t){for(t=t.child;t!==null;)xA(n,e,t),t=t.sibling}function xA(n,e,t){if(os&&typeof os.onCommitFiberUnmount=="function")try{os.onCommitFiberUnmount(qp,t)}catch{}switch(t.tag){case 5:Cn||Xa(t,e);case 6:var r=gn,s=Or;gn=null,ri(n,e,t),gn=r,Or=s,gn!==null&&(Or?(n=gn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):gn.removeChild(t.stateNode));break;case 18:gn!==null&&(Or?(n=gn,t=t.stateNode,n.nodeType===8?jg(n.parentNode,t):n.nodeType===1&&jg(n,t),Mu(n)):jg(gn,t.stateNode));break;case 4:r=gn,s=Or,gn=t.stateNode.containerInfo,Or=!0,ri(n,e,t),gn=r,Or=s;break;case 0:case 11:case 14:case 15:if(!Cn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&h_(t,e,o),s=s.next}while(s!==r)}ri(n,e,t);break;case 1:if(!Cn&&(Xa(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){kt(t,e,a)}ri(n,e,t);break;case 21:ri(n,e,t);break;case 22:t.mode&1?(Cn=(r=Cn)||t.memoizedState!==null,ri(n,e,t),Cn=r):ri(n,e,t);break;default:ri(n,e,t)}}function vx(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new cM),e.forEach(function(r){var s=vM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function kr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:gn=a.stateNode,Or=!1;break e;case 3:gn=a.stateNode.containerInfo,Or=!0;break e;case 4:gn=a.stateNode.containerInfo,Or=!0;break e}a=a.return}if(gn===null)throw Error(q(160));xA(i,o,s),gn=null,Or=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){kt(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)TA(e,n),e=e.sibling}function TA(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(kr(e,n),Yr(n),r&4){try{lu(3,n,n.return),Xp(3,n)}catch(T){kt(n,n.return,T)}try{lu(5,n,n.return)}catch(T){kt(n,n.return,T)}}break;case 1:kr(e,n),Yr(n),r&512&&t!==null&&Xa(t,t.return);break;case 5:if(kr(e,n),Yr(n),r&512&&t!==null&&Xa(t,t.return),n.flags&32){var s=n.stateNode;try{Pu(s,"")}catch(T){kt(n,n.return,T)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Gb(s,i),jy(a,o);var u=jy(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?Jb(s,f):h==="dangerouslySetInnerHTML"?Qb(s,f):h==="children"?Pu(s,f):Av(s,h,f,u)}switch(a){case"input":Oy(s,i);break;case"textarea":Hb(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?el(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?el(s,!!i.multiple,i.defaultValue,!0):el(s,!!i.multiple,i.multiple?[]:"",!1))}s[Uu]=i}catch(T){kt(n,n.return,T)}}break;case 6:if(kr(e,n),Yr(n),r&4){if(n.stateNode===null)throw Error(q(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(T){kt(n,n.return,T)}}break;case 3:if(kr(e,n),Yr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Mu(e.containerInfo)}catch(T){kt(n,n.return,T)}break;case 4:kr(e,n),Yr(n);break;case 13:kr(e,n),Yr(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(o0=Ft())),r&4&&vx(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(Cn=(u=Cn)||h,kr(e,n),Cn=u):kr(e,n),Yr(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(ne=n,h=n.child;h!==null;){for(f=ne=h;ne!==null;){switch(p=ne,y=p.child,p.tag){case 0:case 11:case 14:case 15:lu(4,p,p.return);break;case 1:Xa(p,p.return);var x=p.stateNode;if(typeof x.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,x.props=e.memoizedProps,x.state=e.memoizedState,x.componentWillUnmount()}catch(T){kt(r,t,T)}}break;case 5:Xa(p,p.return);break;case 22:if(p.memoizedState!==null){Ix(f);continue}}y!==null?(y.return=p,ne=y):Ix(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Yb("display",o))}catch(T){kt(n,n.return,T)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(T){kt(n,n.return,T)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:kr(e,n),Yr(n),r&4&&vx(n);break;case 21:break;default:kr(e,n),Yr(n)}}function Yr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(EA(t)){var r=t;break e}t=t.return}throw Error(q(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Pu(s,""),r.flags&=-33);var i=_x(n);m_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=_x(n);p_(n,a,o);break;default:throw Error(q(161))}}catch(l){kt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function dM(n,e,t){ne=n,SA(n)}function SA(n,e,t){for(var r=(n.mode&1)!==0;ne!==null;){var s=ne,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Vh;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Cn;a=Vh;var u=Cn;if(Vh=o,(Cn=l)&&!u)for(ne=s;ne!==null;)o=ne,l=o.child,o.tag===22&&o.memoizedState!==null?Ex(s):l!==null?(l.return=o,ne=l):Ex(s);for(;i!==null;)ne=i,SA(i),i=i.sibling;ne=s,Vh=a,Cn=u}wx(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ne=i):wx(n)}}function wx(n){for(;ne!==null;){var e=ne;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Cn||Xp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Cn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Dr(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&sx(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}sx(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Mu(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}Cn||e.flags&512&&f_(e)}catch(p){kt(e,e.return,p)}}if(e===n){ne=null;break}if(t=e.sibling,t!==null){t.return=e.return,ne=t;break}ne=e.return}}function Ix(n){for(;ne!==null;){var e=ne;if(e===n){ne=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ne=t;break}ne=e.return}}function Ex(n){for(;ne!==null;){var e=ne;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Xp(4,e)}catch(l){kt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){kt(e,s,l)}}var i=e.return;try{f_(e)}catch(l){kt(e,i,l)}break;case 5:var o=e.return;try{f_(e)}catch(l){kt(e,o,l)}}}catch(l){kt(e,e.return,l)}if(e===n){ne=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ne=a;break}ne=e.return}}var hM=Math.ceil,Xf=zs.ReactCurrentDispatcher,s0=zs.ReactCurrentOwner,Tr=zs.ReactCurrentBatchConfig,Be=0,on=null,Wt=null,vn=0,nr=0,Za=to(0),Qt=0,Gu=null,qo=0,Zp=0,i0=0,cu=null,zn=null,o0=0,wl=1/0,ws=null,Zf=!1,g_=null,Ni=null,Fh=!1,_i=null,ep=0,uu=0,y_=null,hf=-1,ff=0;function Vn(){return Be&6?Ft():hf!==-1?hf:hf=Ft()}function Pi(n){return n.mode&1?Be&2&&vn!==0?vn&-vn:QO.transition!==null?(ff===0&&(ff=c1()),ff):(n=Ye,n!==0||(n=window.event,n=n===void 0?16:g1(n.type)),n):1}function Ur(n,e,t,r){if(50<uu)throw uu=0,y_=null,Error(q(185));Td(n,t,r),(!(Be&2)||n!==on)&&(n===on&&(!(Be&2)&&(Zp|=t),Qt===4&&di(n,vn)),Yn(n,r),t===1&&Be===0&&!(e.mode&1)&&(wl=Ft()+500,Qp&&no()))}function Yn(n,e){var t=n.callbackNode;Q2(n,e);var r=Vf(n,n===on?vn:0);if(r===0)t!==null&&PE(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&PE(t),e===1)n.tag===0?KO(xx.bind(null,n)):M1(xx.bind(null,n)),qO(function(){!(Be&6)&&no()}),t=null;else{switch(u1(r)){case 1:t=kv;break;case 4:t=a1;break;case 16:t=Lf;break;case 536870912:t=l1;break;default:t=Lf}t=DA(t,bA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function bA(n,e){if(hf=-1,ff=0,Be&6)throw Error(q(327));var t=n.callbackNode;if(il()&&n.callbackNode!==t)return null;var r=Vf(n,n===on?vn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=tp(n,r);else{e=r;var s=Be;Be|=2;var i=CA();(on!==n||vn!==e)&&(ws=null,wl=Ft()+500,Oo(n,e));do try{mM();break}catch(a){AA(n,a)}while(1);Wv(),Xf.current=i,Be=s,Wt!==null?e=0:(on=null,vn=0,e=Qt)}if(e!==0){if(e===2&&(s=qy(n),s!==0&&(r=s,e=__(n,s))),e===1)throw t=Gu,Oo(n,0),di(n,r),Yn(n,Ft()),t;if(e===6)di(n,r);else{if(s=n.current.alternate,!(r&30)&&!fM(s)&&(e=tp(n,r),e===2&&(i=qy(n),i!==0&&(r=i,e=__(n,i))),e===1))throw t=Gu,Oo(n,0),di(n,r),Yn(n,Ft()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(q(345));case 2:_o(n,zn,ws);break;case 3:if(di(n,r),(r&130023424)===r&&(e=o0+500-Ft(),10<e)){if(Vf(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){Vn(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Xy(_o.bind(null,n,zn,ws),e);break}_o(n,zn,ws);break;case 4:if(di(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-jr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ft()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*hM(r/1960))-r,10<r){n.timeoutHandle=Xy(_o.bind(null,n,zn,ws),r);break}_o(n,zn,ws);break;case 5:_o(n,zn,ws);break;default:throw Error(q(329))}}}return Yn(n,Ft()),n.callbackNode===t?bA.bind(null,n):null}function __(n,e){var t=cu;return n.current.memoizedState.isDehydrated&&(Oo(n,e).flags|=256),n=tp(n,e),n!==2&&(e=zn,zn=t,e!==null&&v_(e)),n}function v_(n){zn===null?zn=n:zn.push.apply(zn,n)}function fM(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!zr(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function di(n,e){for(e&=~i0,e&=~Zp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-jr(e),r=1<<t;n[t]=-1,e&=~r}}function xx(n){if(Be&6)throw Error(q(327));il();var e=Vf(n,0);if(!(e&1))return Yn(n,Ft()),null;var t=tp(n,e);if(n.tag!==0&&t===2){var r=qy(n);r!==0&&(e=r,t=__(n,r))}if(t===1)throw t=Gu,Oo(n,0),di(n,e),Yn(n,Ft()),t;if(t===6)throw Error(q(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,_o(n,zn,ws),Yn(n,Ft()),null}function a0(n,e){var t=Be;Be|=1;try{return n(e)}finally{Be=t,Be===0&&(wl=Ft()+500,Qp&&no())}}function Wo(n){_i!==null&&_i.tag===0&&!(Be&6)&&il();var e=Be;Be|=1;var t=Tr.transition,r=Ye;try{if(Tr.transition=null,Ye=1,n)return n()}finally{Ye=r,Tr.transition=t,Be=e,!(Be&6)&&no()}}function l0(){nr=Za.current,pt(Za)}function Oo(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,zO(t)),Wt!==null)for(t=Wt.return;t!==null;){var r=t;switch($v(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$f();break;case 3:_l(),pt(Kn),pt(kn),Jv();break;case 5:Yv(r);break;case 4:_l();break;case 13:pt(xt);break;case 19:pt(xt);break;case 10:Gv(r.type._context);break;case 22:case 23:l0()}t=t.return}if(on=n,Wt=n=ki(n.current,null),vn=nr=e,Qt=0,Gu=null,i0=Zp=qo=0,zn=cu=null,Co!==null){for(e=0;e<Co.length;e++)if(t=Co[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Co=null}return n}function AA(n,e){do{var t=Wt;try{if(Wv(),cf.current=Jf,Yf){for(var r=St.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Yf=!1}if(zo=0,nn=Ht=St=null,au=!1,zu=0,s0.current=null,t===null||t.return===null){Qt=1,Gu=e,Wt=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=vn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=ux(o);if(y!==null){y.flags&=-257,dx(y,o,a,i,e),y.mode&1&&cx(i,u,e),e=y,l=u;var x=e.updateQueue;if(x===null){var T=new Set;T.add(l),e.updateQueue=T}else x.add(l);break e}else{if(!(e&1)){cx(i,u,e),c0();break e}l=Error(q(426))}}else if(_t&&a.mode&1){var P=ux(o);if(P!==null){!(P.flags&65536)&&(P.flags|=256),dx(P,o,a,i,e),zv(vl(l,a));break e}}i=l=vl(l,a),Qt!==4&&(Qt=2),cu===null?cu=[i]:cu.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var R=uA(i,l,e);rx(i,R);break e;case 1:a=l;var b=i.type,N=i.stateNode;if(!(i.flags&128)&&(typeof b.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(Ni===null||!Ni.has(N)))){i.flags|=65536,e&=-e,i.lanes|=e;var k=dA(i,a,e);rx(i,k);break e}}i=i.return}while(i!==null)}NA(t)}catch(U){e=U,Wt===t&&t!==null&&(Wt=t=t.return);continue}break}while(1)}function CA(){var n=Xf.current;return Xf.current=Jf,n===null?Jf:n}function c0(){(Qt===0||Qt===3||Qt===2)&&(Qt=4),on===null||!(qo&268435455)&&!(Zp&268435455)||di(on,vn)}function tp(n,e){var t=Be;Be|=2;var r=CA();(on!==n||vn!==e)&&(ws=null,Oo(n,e));do try{pM();break}catch(s){AA(n,s)}while(1);if(Wv(),Be=t,Xf.current=r,Wt!==null)throw Error(q(261));return on=null,vn=0,Qt}function pM(){for(;Wt!==null;)RA(Wt)}function mM(){for(;Wt!==null&&!U2();)RA(Wt)}function RA(n){var e=kA(n.alternate,n,nr);n.memoizedProps=n.pendingProps,e===null?NA(n):Wt=e,s0.current=null}function NA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=lM(t,e),t!==null){t.flags&=32767,Wt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Qt=6,Wt=null;return}}else if(t=aM(t,e,nr),t!==null){Wt=t;return}if(e=e.sibling,e!==null){Wt=e;return}Wt=e=n}while(e!==null);Qt===0&&(Qt=5)}function _o(n,e,t){var r=Ye,s=Tr.transition;try{Tr.transition=null,Ye=1,gM(n,e,t,r)}finally{Tr.transition=s,Ye=r}return null}function gM(n,e,t,r){do il();while(_i!==null);if(Be&6)throw Error(q(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(q(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(Y2(n,i),n===on&&(Wt=on=null,vn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Fh||(Fh=!0,DA(Lf,function(){return il(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Tr.transition,Tr.transition=null;var o=Ye;Ye=1;var a=Be;Be|=4,s0.current=null,uM(n,t),TA(t,n),LO(Yy),Ff=!!Qy,Yy=Qy=null,n.current=t,dM(t),B2(),Be=a,Ye=o,Tr.transition=i}else n.current=t;if(Fh&&(Fh=!1,_i=n,ep=s),i=n.pendingLanes,i===0&&(Ni=null),q2(t.stateNode),Yn(n,Ft()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Zf)throw Zf=!1,n=g_,g_=null,n;return ep&1&&n.tag!==0&&il(),i=n.pendingLanes,i&1?n===y_?uu++:(uu=0,y_=n):uu=0,no(),null}function il(){if(_i!==null){var n=u1(ep),e=Tr.transition,t=Ye;try{if(Tr.transition=null,Ye=16>n?16:n,_i===null)var r=!1;else{if(n=_i,_i=null,ep=0,Be&6)throw Error(q(331));var s=Be;for(Be|=4,ne=n.current;ne!==null;){var i=ne,o=i.child;if(ne.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(ne=u;ne!==null;){var h=ne;switch(h.tag){case 0:case 11:case 15:lu(8,h,i)}var f=h.child;if(f!==null)f.return=h,ne=f;else for(;ne!==null;){h=ne;var p=h.sibling,y=h.return;if(IA(h),h===u){ne=null;break}if(p!==null){p.return=y,ne=p;break}ne=y}}}var x=i.alternate;if(x!==null){var T=x.child;if(T!==null){x.child=null;do{var P=T.sibling;T.sibling=null,T=P}while(T!==null)}}ne=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ne=o;else e:for(;ne!==null;){if(i=ne,i.flags&2048)switch(i.tag){case 0:case 11:case 15:lu(9,i,i.return)}var R=i.sibling;if(R!==null){R.return=i.return,ne=R;break e}ne=i.return}}var b=n.current;for(ne=b;ne!==null;){o=ne;var N=o.child;if(o.subtreeFlags&2064&&N!==null)N.return=o,ne=N;else e:for(o=b;ne!==null;){if(a=ne,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Xp(9,a)}}catch(U){kt(a,a.return,U)}if(a===o){ne=null;break e}var k=a.sibling;if(k!==null){k.return=a.return,ne=k;break e}ne=a.return}}if(Be=s,no(),os&&typeof os.onPostCommitFiberRoot=="function")try{os.onPostCommitFiberRoot(qp,n)}catch{}r=!0}return r}finally{Ye=t,Tr.transition=e}}return!1}function Tx(n,e,t){e=vl(t,e),e=uA(n,e,1),n=Ri(n,e,1),e=Vn(),n!==null&&(Td(n,1,e),Yn(n,e))}function kt(n,e,t){if(n.tag===3)Tx(n,n,t);else for(;e!==null;){if(e.tag===3){Tx(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ni===null||!Ni.has(r))){n=vl(t,n),n=dA(e,n,1),e=Ri(e,n,1),n=Vn(),e!==null&&(Td(e,1,n),Yn(e,n));break}}e=e.return}}function yM(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Vn(),n.pingedLanes|=n.suspendedLanes&t,on===n&&(vn&t)===t&&(Qt===4||Qt===3&&(vn&130023424)===vn&&500>Ft()-o0?Oo(n,0):i0|=t),Yn(n,e)}function PA(n,e){e===0&&(n.mode&1?(e=Ch,Ch<<=1,!(Ch&130023424)&&(Ch=4194304)):e=1);var t=Vn();n=Os(n,e),n!==null&&(Td(n,e,t),Yn(n,t))}function _M(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),PA(n,t)}function vM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(q(314))}r!==null&&r.delete(e),PA(n,t)}var kA;kA=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Kn.current)qn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return qn=!1,oM(n,e,t);qn=!!(n.flags&131072)}else qn=!1,_t&&e.flags&1048576&&L1(e,Wf,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;df(n,e),n=e.pendingProps;var s=ml(e,kn.current);sl(e,t),s=Zv(null,e,r,n,s,t);var i=e0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qn(r)?(i=!0,zf(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Kv(e),s.updater=Jp,e.stateNode=s,s._reactInternals=e,i_(e,r,n,t),e=l_(null,e,r,!0,i,t)):(e.tag=0,_t&&i&&Bv(e),Mn(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(df(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=IM(r),n=Dr(r,n),s){case 0:e=a_(null,e,r,n,t);break e;case 1:e=px(null,e,r,n,t);break e;case 11:e=hx(null,e,r,n,t);break e;case 14:e=fx(null,e,r,Dr(r.type,n),t);break e}throw Error(q(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Dr(r,s),a_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Dr(r,s),px(n,e,r,s,t);case 3:e:{if(mA(e),n===null)throw Error(q(387));r=e.pendingProps,i=e.memoizedState,s=i.element,$1(n,e),Kf(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=vl(Error(q(423)),e),e=mx(n,e,r,t,s);break e}else if(r!==s){s=vl(Error(q(424)),e),e=mx(n,e,r,t,s);break e}else for(ar=Ci(e.stateNode.containerInfo.firstChild),lr=e,_t=!0,Lr=null,t=U1(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(gl(),r===s){e=Ms(n,e,t);break e}Mn(n,e,r,t)}e=e.child}return e;case 5:return z1(e),n===null&&n_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,Jy(r,s)?o=null:i!==null&&Jy(r,i)&&(e.flags|=32),pA(n,e),Mn(n,e,o,t),e.child;case 6:return n===null&&n_(e),null;case 13:return gA(n,e,t);case 4:return Qv(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=yl(e,null,r,t):Mn(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Dr(r,s),hx(n,e,r,s,t);case 7:return Mn(n,e,e.pendingProps,t),e.child;case 8:return Mn(n,e,e.pendingProps.children,t),e.child;case 12:return Mn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,it(Gf,r._currentValue),r._currentValue=o,i!==null)if(zr(i.value,o)){if(i.children===s.children&&!Kn.current){e=Ms(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Ns(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),r_(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(q(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),r_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Mn(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,sl(e,t),s=br(s),r=r(s),e.flags|=1,Mn(n,e,r,t),e.child;case 14:return r=e.type,s=Dr(r,e.pendingProps),s=Dr(r.type,s),fx(n,e,r,s,t);case 15:return hA(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Dr(r,s),df(n,e),e.tag=1,Qn(r)?(n=!0,zf(e)):n=!1,sl(e,t),cA(e,r,s),i_(e,r,s,t),l_(null,e,r,!0,n,t);case 19:return yA(n,e,t);case 22:return fA(n,e,t)}throw Error(q(156,e.tag))};function DA(n,e){return o1(n,e)}function wM(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Er(n,e,t,r){return new wM(n,e,t,r)}function u0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function IM(n){if(typeof n=="function")return u0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Rv)return 11;if(n===Nv)return 14}return 2}function ki(n,e){var t=n.alternate;return t===null?(t=Er(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function pf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")u0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case za:return Mo(t.children,s,i,e);case Cv:o=8,s|=8;break;case Ry:return n=Er(12,t,e,s|2),n.elementType=Ry,n.lanes=i,n;case Ny:return n=Er(13,t,e,s),n.elementType=Ny,n.lanes=i,n;case Py:return n=Er(19,t,e,s),n.elementType=Py,n.lanes=i,n;case zb:return em(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Bb:o=10;break e;case $b:o=9;break e;case Rv:o=11;break e;case Nv:o=14;break e;case li:o=16,r=null;break e}throw Error(q(130,n==null?n:typeof n,""))}return e=Er(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Mo(n,e,t,r){return n=Er(7,n,r,e),n.lanes=t,n}function em(n,e,t,r){return n=Er(22,n,r,e),n.elementType=zb,n.lanes=t,n.stateNode={isHidden:!1},n}function Hg(n,e,t){return n=Er(6,n,null,e),n.lanes=t,n}function Kg(n,e,t){return e=Er(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function EM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cg(0),this.expirationTimes=Cg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cg(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function d0(n,e,t,r,s,i,o,a,l){return n=new EM(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Er(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Kv(i),n}function xM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$a,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function OA(n){if(!n)return Bi;n=n._reactInternals;e:{if(ua(n)!==n||n.tag!==1)throw Error(q(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(q(171))}if(n.tag===1){var t=n.type;if(Qn(t))return O1(n,t,e)}return e}function MA(n,e,t,r,s,i,o,a,l){return n=d0(t,r,!0,n,s,i,o,a,l),n.context=OA(null),t=n.current,r=Vn(),s=Pi(t),i=Ns(r,s),i.callback=e??null,Ri(t,i,s),n.current.lanes=s,Td(n,s,r),Yn(n,r),n}function tm(n,e,t,r){var s=e.current,i=Vn(),o=Pi(s);return t=OA(t),e.context===null?e.context=t:e.pendingContext=t,e=Ns(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Ri(s,e,o),n!==null&&(Ur(n,s,o,i),lf(n,s,o)),o}function np(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Sx(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function h0(n,e){Sx(n,e),(n=n.alternate)&&Sx(n,e)}function TM(){return null}var LA=typeof reportError=="function"?reportError:function(n){console.error(n)};function f0(n){this._internalRoot=n}nm.prototype.render=f0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(q(409));tm(n,e,null,null)};nm.prototype.unmount=f0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Wo(function(){tm(null,n,null,null)}),e[Ds]=null}};function nm(n){this._internalRoot=n}nm.prototype.unstable_scheduleHydration=function(n){if(n){var e=f1();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ui.length&&e!==0&&e<ui[t].priority;t++);ui.splice(t,0,n),t===0&&m1(n)}};function p0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function rm(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function bx(){}function SM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=np(o);i.call(u)}}var o=MA(e,r,n,0,null,!1,!1,"",bx);return n._reactRootContainer=o,n[Ds]=o.current,Fu(n.nodeType===8?n.parentNode:n),Wo(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=np(l);a.call(u)}}var l=d0(n,0,!1,null,null,!1,!1,"",bx);return n._reactRootContainer=l,n[Ds]=l.current,Fu(n.nodeType===8?n.parentNode:n),Wo(function(){tm(e,l,t,r)}),l}function sm(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=np(o);a.call(l)}}tm(e,o,n,s)}else o=SM(t,e,n,s,r);return np(o)}d1=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Wc(e.pendingLanes);t!==0&&(Dv(e,t|1),Yn(e,Ft()),!(Be&6)&&(wl=Ft()+500,no()))}break;case 13:Wo(function(){var r=Os(n,1);if(r!==null){var s=Vn();Ur(r,n,1,s)}}),h0(n,1)}};Ov=function(n){if(n.tag===13){var e=Os(n,134217728);if(e!==null){var t=Vn();Ur(e,n,134217728,t)}h0(n,134217728)}};h1=function(n){if(n.tag===13){var e=Pi(n),t=Os(n,e);if(t!==null){var r=Vn();Ur(t,n,e,r)}h0(n,e)}};f1=function(){return Ye};p1=function(n,e){var t=Ye;try{return Ye=n,e()}finally{Ye=t}};By=function(n,e,t){switch(e){case"input":if(Oy(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Kp(r);if(!s)throw Error(q(90));Wb(r),Oy(r,s)}}}break;case"textarea":Hb(n,t);break;case"select":e=t.value,e!=null&&el(n,!!t.multiple,e,!1)}};e1=a0;t1=Wo;var bM={usingClientEntryPoint:!1,Events:[bd,Ha,Kp,Xb,Zb,a0]},kc={findFiberByHostInstance:Ao,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},AM={bundleType:kc.bundleType,version:kc.version,rendererPackageName:kc.rendererPackageName,rendererConfig:kc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zs.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=s1(n),n===null?null:n.stateNode},findFiberByHostInstance:kc.findFiberByHostInstance||TM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jh.isDisabled&&jh.supportsFiber)try{qp=jh.inject(AM),os=jh}catch{}}gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bM;gr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p0(e))throw Error(q(200));return xM(n,e,null,t)};gr.createRoot=function(n,e){if(!p0(n))throw Error(q(299));var t=!1,r="",s=LA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=d0(n,1,!1,null,null,t,!1,r,s),n[Ds]=e.current,Fu(n.nodeType===8?n.parentNode:n),new f0(e)};gr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(q(188)):(n=Object.keys(n).join(","),Error(q(268,n)));return n=s1(e),n=n===null?null:n.stateNode,n};gr.flushSync=function(n){return Wo(n)};gr.hydrate=function(n,e,t){if(!rm(e))throw Error(q(200));return sm(null,n,e,!0,t)};gr.hydrateRoot=function(n,e,t){if(!p0(n))throw Error(q(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=LA;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=MA(e,null,n,1,t??null,s,!1,i,o),n[Ds]=e.current,Fu(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new nm(e)};gr.render=function(n,e,t){if(!rm(e))throw Error(q(200));return sm(null,n,e,!1,t)};gr.unmountComponentAtNode=function(n){if(!rm(n))throw Error(q(40));return n._reactRootContainer?(Wo(function(){sm(null,null,n,!1,function(){n._reactRootContainer=null,n[Ds]=null})}),!0):!1};gr.unstable_batchedUpdates=a0;gr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!rm(t))throw Error(q(200));if(n==null||n._reactInternals===void 0)throw Error(q(38));return sm(n,e,t,!1,r)};gr.version="18.3.1-next-f1338f8080-20240426";function VA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(VA)}catch(n){console.error(n)}}VA(),Vb.exports=gr;var CM=Vb.exports,Ax=CM;Ay.createRoot=Ax.createRoot,Ay.hydrateRoot=Ax.hydrateRoot;const RM="modulepreload",NM=function(n){return"/"+n},Cx={},Ge=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=NM(i),i in Cx)return;Cx[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":RM,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},PM=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G=function(n,e){if(!n)throw Yl(e)},Yl=function(n){return new Error("Firebase Database ("+FA.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jA=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},kM=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},m0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(p=64)),r.push(t[h],t[f],t[p],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(jA(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):kM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new DM;const p=i<<2|a>>4;if(r.push(p),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const x=u<<6&192|f;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class DM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const UA=function(n){const e=jA(n);return m0.encodeByteArray(e,!0)},rp=function(n){return UA(n).replace(/\./g,"")},sp=function(n){try{return m0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OM(n){return BA(void 0,n)}function BA(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!MM(t)||(n[t]=BA(n[t],e[t]));return n}function MM(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $A(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LM=()=>$A().__FIREBASE_DEFAULTS__,VM=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},FM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&sp(n[1]);return e&&JSON.parse(e)},im=()=>{try{return PM()||LM()||VM()||FM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},zA=n=>{var e,t;return(t=(e=im())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},qA=n=>{const e=zA(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},WA=()=>{var n;return(n=im())==null?void 0:n.config},GA=n=>{var e;return(e=im())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qs(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function om(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[rp(JSON.stringify(t)),rp(JSON.stringify(o)),a].join(".")}const du={};function jM(){const n={prod:[],emulator:[]};for(const e of Object.keys(du))du[e]?n.emulator.push(e):n.prod.push(e);return n}function UM(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Rx=!1;function g0(n,e){if(typeof window>"u"||typeof document>"u"||!qs(window.location.host)||du[n]===e||du[n]||Rx)return;du[n]=e;function t(p){return`__firebase__banner__${p}`}const r="__firebase__banner",i=jM().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,y){p.setAttribute("width","24"),p.setAttribute("id",y),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Rx=!0,o()},p}function h(p,y){p.setAttribute("id",y),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=UM(r),y=t("text"),x=document.getElementById(y)||document.createElement("span"),T=t("learnmore"),P=document.getElementById(T)||document.createElement("a"),R=t("preprendIcon"),b=document.getElementById(R)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const N=p.element;a(N),h(P,T);const k=u();l(b,R),N.append(b,x,P,k),document.body.appendChild(N)}i?(x.innerText="Preview backend disconnected.",b.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(b.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function y0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yt())}function KA(){var e;const n=(e=im())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function BM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function _0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function QA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function $M(){const n=Yt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function YA(){return FA.NODE_ADMIN===!0}function JA(){return!KA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function XA(){return!KA()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function am(){try{return typeof indexedDB=="object"}catch{return!1}}function v0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function ZA(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zM="FirebaseError";class Wr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=zM,Object.setPrototypeOf(this,Wr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,da.prototype.create)}}class da{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?qM(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Wr(s,a,r)}}function qM(n,e){return n.replace(WM,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const WM=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hu(n){return JSON.parse(n)}function Kt(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eC=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Hu(sp(i[0])||""),t=Hu(sp(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},GM=function(n){const e=eC(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},HM=function(n){const e=eC(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Go(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function ip(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function op(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function fr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Nx(i)&&Nx(o)){if(!fr(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Nx(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ha(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Hc(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Kc(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KM{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const p=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(p<<1|p>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const p=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=p}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function QM(n,e){const t=new YM(n,e);return t.subscribe.bind(t)}class YM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");JM(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Qg),s.error===void 0&&(s.error=Qg),s.complete===void 0&&(s.complete=Qg);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function JM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Qg(){}function Ho(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XM=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,G(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},lm=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM=1e3,eL=2,tL=4*60*60*1e3,nL=.5;function Px(n,e=ZM,t=eL){const r=e*Math.pow(t,n),s=Math.round(nL*r*(Math.random()-.5)*2);return Math.min(tL,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X(n){return n&&n._delegate?n._delegate:n}class Zn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new ir;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(sL(e))try{this.getOrInitializeService({instanceIdentifier:vo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=vo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=vo){return this.instances.has(e)}getOptions(e=vo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:rL(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=vo){return this.component?this.component.multipleInstances?e:vo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function rL(n){return n===vo?void 0:n}function sL(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new w_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Pe||(Pe={}));const iL={debug:Pe.DEBUG,verbose:Pe.VERBOSE,info:Pe.INFO,warn:Pe.WARN,error:Pe.ERROR,silent:Pe.SILENT},oL=Pe.INFO,aL={[Pe.DEBUG]:"log",[Pe.VERBOSE]:"log",[Pe.INFO]:"info",[Pe.WARN]:"warn",[Pe.ERROR]:"error"},lL=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=aL[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Cd{constructor(e){this.name=e,this._logLevel=oL,this._logHandler=lL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Pe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?iL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Pe.DEBUG,...e),this._logHandler(this,Pe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Pe.VERBOSE,...e),this._logHandler(this,Pe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Pe.INFO,...e),this._logHandler(this,Pe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Pe.WARN,...e),this._logHandler(this,Pe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Pe.ERROR,...e),this._logHandler(this,Pe.ERROR,...e)}}const cL=(n,e)=>e.some(t=>n instanceof t);let kx,Dx;function uL(){return kx||(kx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dL(){return Dx||(Dx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const nC=new WeakMap,I_=new WeakMap,rC=new WeakMap,Yg=new WeakMap,w0=new WeakMap;function hL(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Di(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&nC.set(t,n)}).catch(()=>{}),w0.set(e,n),e}function fL(n){if(I_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});I_.set(n,e)}let E_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return I_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||rC.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Di(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function pL(n){E_=n(E_)}function mL(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Jg(this),e,...t);return rC.set(r,e.sort?e.sort():[e]),Di(r)}:dL().includes(n)?function(...e){return n.apply(Jg(this),e),Di(nC.get(this))}:function(...e){return Di(n.apply(Jg(this),e))}}function gL(n){return typeof n=="function"?mL(n):(n instanceof IDBTransaction&&fL(n),cL(n,uL())?new Proxy(n,E_):n)}function Di(n){if(n instanceof IDBRequest)return hL(n);if(Yg.has(n))return Yg.get(n);const e=gL(n);return e!==n&&(Yg.set(n,e),w0.set(e,n)),e}const Jg=n=>w0.get(n);function sC(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Di(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Di(o.result),l.oldVersion,l.newVersion,Di(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const yL=["get","getKey","getAll","getAllKeys","count"],_L=["put","add","delete","clear"],Xg=new Map;function Ox(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Xg.get(e))return Xg.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=_L.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||yL.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return Xg.set(e,i),i}pL(n=>({...n,get:(e,t,r)=>Ox(e,t)||n.get(e,t,r),has:(e,t)=>!!Ox(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(wL(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function wL(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const x_="@firebase/app",Mx="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=new Cd("@firebase/app"),IL="@firebase/app-compat",EL="@firebase/analytics-compat",xL="@firebase/analytics",TL="@firebase/app-check-compat",SL="@firebase/app-check",bL="@firebase/auth",AL="@firebase/auth-compat",CL="@firebase/database",RL="@firebase/data-connect",NL="@firebase/database-compat",PL="@firebase/functions",kL="@firebase/functions-compat",DL="@firebase/installations",OL="@firebase/installations-compat",ML="@firebase/messaging",LL="@firebase/messaging-compat",VL="@firebase/performance",FL="@firebase/performance-compat",jL="@firebase/remote-config",UL="@firebase/remote-config-compat",BL="@firebase/storage",$L="@firebase/storage-compat",zL="@firebase/firestore",qL="@firebase/ai",WL="@firebase/firestore-compat",GL="firebase",HL="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap="[DEFAULT]",KL={[x_]:"fire-core",[IL]:"fire-core-compat",[xL]:"fire-analytics",[EL]:"fire-analytics-compat",[SL]:"fire-app-check",[TL]:"fire-app-check-compat",[bL]:"fire-auth",[AL]:"fire-auth-compat",[CL]:"fire-rtdb",[RL]:"fire-data-connect",[NL]:"fire-rtdb-compat",[PL]:"fire-fn",[kL]:"fire-fn-compat",[DL]:"fire-iid",[OL]:"fire-iid-compat",[ML]:"fire-fcm",[LL]:"fire-fcm-compat",[VL]:"fire-perf",[FL]:"fire-perf-compat",[jL]:"fire-rc",[UL]:"fire-rc-compat",[BL]:"fire-gcs",[$L]:"fire-gcs-compat",[zL]:"fire-fst",[WL]:"fire-fst-compat",[qL]:"fire-vertex","fire-js":"fire-js",[GL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ku=new Map,QL=new Map,T_=new Map;function Lx(n,e){try{n.container.addComponent(e)}catch(t){Ls.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function qr(n){const e=n.name;if(T_.has(e))return Ls.debug(`There were multiple attempts to register component ${e}.`),!1;T_.set(e,n);for(const t of Ku.values())Lx(t,n);for(const t of QL.values())Lx(t,n);return!0}function gs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function YL(n,e,t=ap){gs(n,e).clearInstance(t)}function vt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Oi=new da("app","Firebase",JL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Zn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Oi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fa=HL;function iC(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:ap,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Oi.create("bad-app-name",{appName:String(s)});if(t||(t=WA()),!t)throw Oi.create("no-options");const i=Ku.get(s);if(i){if(fr(t,i.options)&&fr(r,i.config))return i;throw Oi.create("duplicate-app",{appName:s})}const o=new tC(s);for(const l of T_.values())o.addComponent(l);const a=new XL(t,r,o);return Ku.set(s,a),a}function Rd(n=ap){const e=Ku.get(n);if(!e&&n===ap&&WA())return iC();if(!e)throw Oi.create("no-app",{appName:n});return e}function ZL(){return Array.from(Ku.values())}function Jn(n,e,t){let r=KL[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ls.warn(o.join(" "));return}qr(new Zn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eV="firebase-heartbeat-database",tV=1,Qu="firebase-heartbeat-store";let Zg=null;function oC(){return Zg||(Zg=sC(eV,tV,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Qu)}catch(t){console.warn(t)}}}}).catch(n=>{throw Oi.create("idb-open",{originalErrorMessage:n.message})})),Zg}async function nV(n){try{const t=(await oC()).transaction(Qu),r=await t.objectStore(Qu).get(aC(n));return await t.done,r}catch(e){if(e instanceof Wr)Ls.warn(e.message);else{const t=Oi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ls.warn(t.message)}}}async function Vx(n,e){try{const r=(await oC()).transaction(Qu,"readwrite");await r.objectStore(Qu).put(e,aC(n)),await r.done}catch(t){if(t instanceof Wr)Ls.warn(t.message);else{const r=Oi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ls.warn(r.message)}}}function aC(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rV=1024,sV=30;class iV{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new aV(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Fx();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>sV){const o=lV(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ls.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Fx(),{heartbeatsToSend:r,unsentEntries:s}=oV(this._heartbeatsCache.heartbeats),i=rp(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Ls.warn(t),""}}}function Fx(){return new Date().toISOString().substring(0,10)}function oV(n,e=rV){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),jx(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),jx(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class aV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return am()?v0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await nV(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Vx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Vx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function jx(n){return rp(JSON.stringify({version:2,heartbeats:n})).length}function lV(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cV(n){qr(new Zn("platform-logger",e=>new vL(e),"PRIVATE")),qr(new Zn("heartbeat",e=>new iV(e),"PRIVATE")),Jn(x_,Mx,n),Jn(x_,Mx,"esm2020"),Jn("fire-js","")}cV("");var uV="firebase",dV="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jn(uV,dV,"app");const Ux="@firebase/database",Bx="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lC="";function cC(n){lC=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hV{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Kt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Hu(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Gr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new hV(e)}}catch{}return new fV},No=uC("localStorage"),S_=uC("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ol=new Cd("@firebase/database"),dC=function(){let n=1;return function(){return n++}}(),hC=function(n){const e=XM(n),t=new KM;t.update(e);const r=t.digest();return m0.encodeByteArray(r)},Nd=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Nd.apply(null,r):typeof r=="object"?e+=Kt(r):e+=r,e+=" "}return e};let Lo=null,$x=!0;const fC=function(n,e){G(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(ol.logLevel=Pe.VERBOSE,Lo=ol.log.bind(ol),e&&S_.set("logging_enabled",!0)):typeof n=="function"?Lo=n:(Lo=null,S_.remove("logging_enabled"))},sn=function(...n){if($x===!0&&($x=!1,Lo===null&&S_.get("logging_enabled")===!0&&fC(!0)),Lo){const e=Nd.apply(null,n);Lo(e)}},Pd=function(n){return function(...e){sn(n,...e)}},b_=function(...n){const e="FIREBASE INTERNAL ERROR: "+Nd(...n);ol.error(e)},fs=function(...n){const e=`FIREBASE FATAL ERROR: ${Nd(...n)}`;throw ol.error(e),new Error(e)},Rn=function(...n){const e="FIREBASE WARNING: "+Nd(...n);ol.warn(e)},pV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Rn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},cm=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},mV=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},$i="[MIN_NAME]",Vs="[MAX_NAME]",pa=function(n,e){if(n===e)return 0;if(n===$i||e===Vs)return-1;if(e===$i||n===Vs)return 1;{const t=zx(n),r=zx(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},gV=function(n,e){return n===e?0:n<e?-1:1},Dc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Kt(e))},I0=function(n){if(typeof n!="object"||n===null)return Kt(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Kt(e[r]),t+=":",t+=I0(n[e[r]]);return t+="}",t},pC=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function cn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const mC=function(n){G(!cm(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let p=parseInt(h.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),f=f+p}return f.toLowerCase()},yV=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},_V=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function vV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const wV=new RegExp("^-?(0*)\\d{1,10}$"),IV=-2147483648,EV=2147483647,zx=function(n){if(wV.test(n)){const e=Number(n);if(e>=IV&&e<=EV)return e}return null},Jl=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Rn("Exception was thrown by user callback.",t),e},Math.floor(0))}},xV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},hu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,vt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Rn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SV{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(sn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Rn(e)}}class al{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}al.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E0="5",gC="v",yC="s",_C="r",vC="f",wC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,IC="ls",EC="p",A_="ac",xC="websocket",TC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=No.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&No.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function bV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function bC(n,e,t){G(typeof e=="string","typeof type must == string"),G(typeof t=="object","typeof params must == object");let r;if(e===xC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===TC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);bV(n)&&(t.ns=n.namespace);const s=[];return cn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(){this.counters_={}}incrementCounter(e,t=1){Gr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return OM(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ey={},ty={};function x0(n){const e=n.toString();return ey[e]||(ey[e]=new AV),ey[e]}function CV(n,e){const t=n.toString();return ty[t]||(ty[t]=e()),ty[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Jl(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qx="start",NV="close",PV="pLPCommand",kV="pRTLPCB",AC="id",CC="pw",RC="ser",DV="cb",OV="seg",MV="ts",LV="d",VV="dframe",NC=1870,PC=30,FV=NC-PC,jV=25e3,UV=3e4;class vi{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Pd(e),this.stats_=x0(t),this.urlFn=l=>(this.appCheckToken&&(l[A_]=this.appCheckToken),bC(t,TC,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new RV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(UV)),mV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new T0((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===qx)this.id=a,this.password=l;else if(o===NV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[qx]="t",r[RC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[DV]=this.scriptTagHolder.uniqueCallbackIdentifier),r[gC]=E0,this.transportSessionId&&(r[yC]=this.transportSessionId),this.lastSessionId&&(r[IC]=this.lastSessionId),this.applicationId&&(r[EC]=this.applicationId),this.appCheckToken&&(r[A_]=this.appCheckToken),typeof location<"u"&&location.hostname&&wC.test(location.hostname)&&(r[_C]=vC);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){vi.forceAllow_=!0}static forceDisallow(){vi.forceDisallow_=!0}static isAvailable(){return vi.forceAllow_?!0:!vi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!yV()&&!_V()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Kt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=UA(t),s=pC(r,FV);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[VV]="t",r[AC]=e,r[CC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Kt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class T0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=dC(),window[PV+this.uniqueCallbackIdentifier]=e,window[kV+this.uniqueCallbackIdentifier]=t,this.myIFrame=T0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){sn("frame writing exception"),a.stack&&sn(a.stack),sn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||sn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[AC]=this.myID,e[CC]=this.myPW,e[RC]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+PC+r.length<=NC;){const o=this.pendingSegs.shift();r=r+"&"+OV+s+"="+o.seg+"&"+MV+s+"="+o.ts+"&"+LV+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(jV)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{sn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BV=16384,$V=45e3;let lp=null;typeof MozWebSocket<"u"?lp=MozWebSocket:typeof WebSocket<"u"&&(lp=WebSocket);class Ir{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Pd(this.connId),this.stats_=x0(t),this.connURL=Ir.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[gC]=E0,typeof location<"u"&&location.hostname&&wC.test(location.hostname)&&(o[_C]=vC),t&&(o[yC]=t),r&&(o[IC]=r),s&&(o[A_]=s),i&&(o[EC]=i),bC(e,xC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,No.set("previous_websocket_failure",!0);try{let r;YA(),this.mySock=new lp(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Ir.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&lp!==null&&!Ir.forceDisallow_}static previouslyFailed(){return No.isInMemoryStorage||No.get("previous_websocket_failure")===!0}markConnectionHealthy(){No.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Hu(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(G(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=Kt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=pC(t,BV);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor($V))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ir.responsesRequiredToBeHealthy=2;Ir.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{static get ALL_TRANSPORTS(){return[vi,Ir]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Ir&&Ir.isAvailable();let r=t&&!Ir.previouslyFailed();if(e.webSocketOnly&&(t||Rn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Ir];else{const s=this.transports_=[];for(const i of Il.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Il.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Il.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zV=6e4,qV=5e3,WV=10*1024,GV=100*1024,ny="t",Wx="d",HV="s",Gx="r",KV="e",Hx="o",Kx="a",Qx="n",Yx="p",QV="h";class YV{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Pd("c:"+this.id+":"),this.transportManager_=new Il(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=hu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>GV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>WV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ny in e){const t=e[ny];t===Kx?this.upgradeIfSecondaryHealthy_():t===Gx?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Hx&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Dc("t",e),r=Dc("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Yx,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Kx,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Qx,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Dc("t",e),r=Dc("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Dc(ny,e);if(Wx in e){const r=e[Wx];if(t===QV){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Qx){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===HV?this.onConnectionShutdown_(r):t===Gx?this.onReset_(r):t===KV?b_("Server Error: "+r):t===Hx?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):b_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),E0!==r&&Rn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),hu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(zV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):hu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(qV))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Yx,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(No.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e){this.allowedEvents_=e,this.listeners_={},G(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){G(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp extends DC{static getInstance(){return new cp}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!y0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return G(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jx=32,Xx=768;class He{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function ze(){return new He("")}function xe(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function zi(n){return n.pieces_.length-n.pieceNum_}function tt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new He(n.pieces_,e)}function S0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function JV(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Yu(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function OC(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new He(e,0)}function wt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof He)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new He(t,0)}function Te(n){return n.pieceNum_>=n.pieces_.length}function Ln(n,e){const t=xe(n),r=xe(e);if(t===null)return e;if(t===r)return Ln(tt(n),tt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function XV(n,e){const t=Yu(n,0),r=Yu(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=pa(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function b0(n,e){if(zi(n)!==zi(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function xr(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(zi(n)>zi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class ZV{constructor(e,t){this.errorPrefix_=t,this.parts_=Yu(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=lm(this.parts_[r]);MC(this)}}function eF(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=lm(e),MC(n)}function tF(n){const e=n.parts_.pop();n.byteLength_-=lm(e),n.parts_.length>0&&(n.byteLength_-=1)}function MC(n){if(n.byteLength_>Xx)throw new Error(n.errorPrefix_+"has a key path longer than "+Xx+" bytes ("+n.byteLength_+").");if(n.parts_.length>Jx)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Jx+") or object contains a cycle "+wo(n))}function wo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0 extends DC{static getInstance(){return new A0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return G(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc=1e3,nF=60*5*1e3,Zx=30*1e3,rF=1.3,sF=3e4,iF="server_kill",eT=3;class Sr extends kC{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Sr.nextPersistentConnectionId_++,this.log_=Pd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Oc,this.maxReconnectDelay_=nF,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!YA())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");A0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&cp.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(Kt(i)),G(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new ir,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),G(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),G(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;Sr.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Gr(e,"w")){const r=Go(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Rn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||HM(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Zx)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=GM(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),G(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Kt(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):b_("Unrecognized action received from server: "+Kt(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){G(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Oc,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Oc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>sF&&(this.reconnectDelay_=Oc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*rF)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Sr.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){G(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,p]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?sn("getToken() completed but was canceled"):(sn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=p&&p.token,a=new YV(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{Rn(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(iF)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&Rn(f),l())}}}interrupt(e){sn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){sn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ip(this.interruptReasons_)&&(this.reconnectDelay_=Oc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>I0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new He(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){sn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=eT&&(this.reconnectDelay_=Zx,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){sn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=eT&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+lC.replace(/\./g,"-")]=1,y0()?e["framework.cordova"]=1:QA()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=cp.getInstance().currentlyOnline();return ip(this.interruptReasons_)&&e}}Sr.nextPersistentConnectionId_=0;Sr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new be(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new be($i,e),s=new be($i,t);return this.compare(r,s)!==0}minPost(){return be.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uh;class LC extends um{static get __EMPTY_NODE(){return Uh}static set __EMPTY_NODE(e){Uh=e}compare(e,t){return pa(e.name,t.name)}isDefinedOn(e){throw Yl("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return be.MIN}maxPost(){return new be(Vs,Uh)}makePost(e,t){return G(typeof e=="string","KeyIndex indexValue must always be a string."),new be(e,Uh)}toString(){return".key"}}const ls=new LC;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bh=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},rr=class Qc{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Qc.RED,this.left=s??ts.EMPTY_NODE,this.right=i??ts.EMPTY_NODE}copy(e,t,r,s,i){return new Qc(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return ts.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return ts.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Qc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Qc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};rr.RED=!0;rr.BLACK=!1;class oF{copy(e,t,r,s,i){return this}insert(e,t,r){return new rr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let ts=class mf{constructor(e,t=mf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new mf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,rr.BLACK,null,null))}remove(e){return new mf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,rr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Bh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Bh(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Bh(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Bh(this.root_,null,this.comparator_,!0,e)}};ts.EMPTY_NODE=new oF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aF(n,e){return pa(n.name,e.name)}function C0(n,e){return pa(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let C_;function lF(n){C_=n}const VC=function(n){return typeof n=="number"?"number:"+mC(n):"string:"+n},FC=function(n){if(n.isLeafNode()){const e=n.val();G(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Gr(e,".sv"),"Priority must be a string or number.")}else G(n===C_||n.isEmpty(),"priority of unexpected type.");G(n===C_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tT;class Zt{static set __childrenNodeConstructor(e){tT=e}static get __childrenNodeConstructor(){return tT}constructor(e,t=Zt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,G(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),FC(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Zt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Zt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Te(e)?this:xe(e)===".priority"?this.priorityNode_:Zt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Zt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=xe(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(G(r!==".priority"||zi(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Zt.__childrenNodeConstructor.EMPTY_NODE.updateChild(tt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+VC(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=mC(this.value_):e+=this.value_,this.lazyHash_=hC(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Zt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Zt.__childrenNodeConstructor?-1:(G(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=Zt.VALUE_TYPE_ORDER.indexOf(t),i=Zt.VALUE_TYPE_ORDER.indexOf(r);return G(s>=0,"Unknown leaf type: "+t),G(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Zt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jC,UC;function cF(n){jC=n}function uF(n){UC=n}class dF extends um{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?pa(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return be.MIN}maxPost(){return new be(Vs,new Zt("[PRIORITY-POST]",UC))}makePost(e,t){const r=jC(e);return new be(t,new Zt("[PRIORITY-POST]",r))}toString(){return".priority"}}const ot=new dF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hF=Math.log(2);class fF{constructor(e){const t=i=>parseInt(Math.log(i)/hF,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const up=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,p;if(h===0)return null;if(h===1)return f=n[l],p=t?t(f):f,new rr(p,f.node,rr.BLACK,null,null);{const y=parseInt(h/2,10)+l,x=s(l,y),T=s(y+1,u);return f=n[y],p=t?t(f):f,new rr(p,f.node,rr.BLACK,x,T)}},i=function(l){let u=null,h=null,f=n.length;const p=function(x,T){const P=f-x,R=f;f-=x;const b=s(P+1,R),N=n[P],k=t?t(N):N;y(new rr(k,N.node,T,null,b))},y=function(x){u?(u.left=x,u=x):(h=x,u=x)};for(let x=0;x<l.count;++x){const T=l.nextBitIsOne(),P=Math.pow(2,l.count-(x+1));T?p(P,rr.BLACK):(p(P,rr.BLACK),p(P,rr.RED))}return h},o=new fF(n.length),a=i(o);return new ts(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ry;const Pa={};class bs{static get Default(){return G(Pa&&ot,"ChildrenNode.ts has not been loaded"),ry=ry||new bs({".priority":Pa},{".priority":ot}),ry}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Go(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ts?t:null}hasIndex(e){return Gr(this.indexSet_,e.toString())}addIndex(e,t){G(e!==ls,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(be.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=up(r,e.getCompare()):a=Pa;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new bs(h,u)}addToIndexes(e,t){const r=op(this.indexes_,(s,i)=>{const o=Go(this.indexSet_,i);if(G(o,"Missing index implementation for "+i),s===Pa)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(be.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),up(a,o.getCompare())}else return Pa;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new be(e.name,a))),l.insert(e,e.node)}});return new bs(r,this.indexSet_)}removeFromIndexes(e,t){const r=op(this.indexes_,s=>{if(s===Pa)return s;{const i=t.get(e.name);return i?s.remove(new be(e.name,i)):s}});return new bs(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mc;class ce{static get EMPTY_NODE(){return Mc||(Mc=new ce(new ts(C0),null,bs.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&FC(this.priorityNode_),this.children_.isEmpty()&&G(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Mc}updatePriority(e){return this.children_.isEmpty()?this:new ce(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Mc:t}}getChild(e){const t=xe(e);return t===null?this:this.getImmediateChild(t).getChild(tt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(G(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new be(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Mc:this.priorityNode_;return new ce(s,o,i)}}updateChild(e,t){const r=xe(e);if(r===null)return t;{G(xe(e)!==".priority"||zi(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(tt(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(ot,(o,a)=>{t[o]=a.val(e),r++,i&&ce.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+VC(this.getPriority().val())+":"),this.forEachChild(ot,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":hC(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new be(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new be(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new be(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===kd?-1:0}withIndex(e){if(e===ls||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ce(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ls||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(ot),s=t.getIterator(ot);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ls?null:this.indexMap_.get(e.toString())}}ce.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class pF extends ce{constructor(){super(new ts(C0),ce.EMPTY_NODE,bs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ce.EMPTY_NODE}isEmpty(){return!1}}const kd=new pF;Object.defineProperties(be,{MIN:{value:new be($i,ce.EMPTY_NODE)},MAX:{value:new be(Vs,kd)}});LC.__EMPTY_NODE=ce.EMPTY_NODE;Zt.__childrenNodeConstructor=ce;lF(kd);uF(kd);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mF=!0;function Tt(n,e=null){if(n===null)return ce.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),G(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Zt(t,Tt(e))}if(!(n instanceof Array)&&mF){const t=[];let r=!1;if(cn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=Tt(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new be(o,l)))}}),t.length===0)return ce.EMPTY_NODE;const i=up(t,aF,o=>o.name,C0);if(r){const o=up(t,ot.getCompare());return new ce(i,Tt(e),new bs({".priority":o},{".priority":ot}))}else return new ce(i,Tt(e),bs.Default)}else{let t=ce.EMPTY_NODE;return cn(n,(r,s)=>{if(Gr(n,r)&&r.substring(0,1)!=="."){const i=Tt(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Tt(e))}}cF(Tt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0 extends um{constructor(e){super(),this.indexPath_=e,G(!Te(e)&&xe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?pa(e.name,t.name):i}makePost(e,t){const r=Tt(e),s=ce.EMPTY_NODE.updateChild(this.indexPath_,r);return new be(t,s)}maxPost(){const e=ce.EMPTY_NODE.updateChild(this.indexPath_,kd);return new be(Vs,e)}toString(){return Yu(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF extends um{compare(e,t){const r=e.node.compareTo(t.node);return r===0?pa(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return be.MIN}maxPost(){return be.MAX}makePost(e,t){const r=Tt(e);return new be(t,r)}toString(){return".value"}}const N0=new gF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BC(n){return{type:"value",snapshotNode:n}}function El(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ju(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Xu(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function yF(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){G(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Ju(t,a)):G(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(El(t,r)):o.trackChildChange(Xu(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(ot,(s,i)=>{t.hasChild(s)||r.trackChildChange(Ju(s,i))}),t.isLeafNode()||t.forEachChild(ot,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Xu(s,i,o))}else r.trackChildChange(El(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ce.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.indexedFilter_=new P0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Zu.getStartPost_(e),this.endPost_=Zu.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new be(t,r))||(r=ce.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=ce.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ce.EMPTY_NODE);const i=this;return t.forEachChild(ot,(o,a)=>{i.matches(new be(o,a))||(s=s.updateImmediateChild(o,ce.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _F{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Zu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new be(t,r))||(r=ce.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=ce.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=ce.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(ce.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,ce.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(p,y)=>f(y,p)}else o=this.index_.getCompare();const a=e;G(a.numChildren()===this.limit_,"");const l=new be(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let p=s.getChildAfterChild(this.index_,u,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=s.getChildAfterChild(this.index_,p,this.reverse_);const y=p==null?1:o(p,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Xu(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(Ju(t,f));const T=a.updateImmediateChild(t,ce.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(i!=null&&i.trackChildChange(El(p.name,p.node)),T.updateImmediateChild(p.name,p.node)):T}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(Ju(u.name,u.node)),i.trackChildChange(El(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,ce.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ot}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return G(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return G(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:$i}hasEnd(){return this.endSet_}getIndexEndValue(){return G(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return G(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Vs}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return G(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ot}copy(){const e=new k0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function vF(n){return n.loadsAllData()?new P0(n.getIndex()):n.hasLimit()?new _F(n):new Zu(n)}function wF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function IF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function R_(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function EF(n,e,t){let r;return n.index_===ls||t?r=R_(n,e,t):r=R_(n,e,Vs),r.startAfterSet_=!0,r}function N_(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function xF(n,e,t){let r;return n.index_===ls||t?r=N_(n,e,t):r=N_(n,e,$i),r.endBeforeSet_=!0,r}function dm(n,e){const t=n.copy();return t.index_=e,t}function nT(n){const e={};if(n.isDefault())return e;let t;if(n.index_===ot?t="$priority":n.index_===N0?t="$value":n.index_===ls?t="$key":(G(n.index_ instanceof R0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Kt(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=Kt(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Kt(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Kt(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Kt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function rT(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ot&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp extends kC{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(G(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Pd("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=dp.getListenId_(e,r),a={};this.listens_[o]=a;const l=nT(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Go(this.listens_,o)===a){let p;u?u===401?p="permission_denied":p="rest_error:"+u:p="ok",s(p,null)}})}unlisten(e,t){const r=dp.getListenId_(e,t);delete this.listens_[r]}get(e){const t=nT(e._queryParams),r=e._path.toString(),s=new ir;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ha(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Hu(a.responseText)}catch{Rn("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&Rn("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TF{constructor(){this.rootNode_=ce.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hp(){return{value:null,children:new Map}}function Xl(n,e,t){if(Te(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=xe(e);n.children.has(r)||n.children.set(r,hp());const s=n.children.get(r);e=tt(e),Xl(s,e,t)}}function P_(n,e){if(Te(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(ot,(r,s)=>{Xl(n,new He(r),s)}),P_(n,e)}}else if(n.children.size>0){const t=xe(e);return e=tt(e),n.children.has(t)&&P_(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function k_(n,e,t){n.value!==null?t(e,n.value):SF(n,(r,s)=>{const i=new He(e.toString()+"/"+r);k_(s,i,t)})}function SF(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bF{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&cn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sT=10*1e3,AF=30*1e3,CF=5*60*1e3;class RF{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new bF(e);const r=sT+(AF-sT)*Math.random();hu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;cn(e,(s,i)=>{i>0&&Gr(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),hu(this.reportStats_.bind(this),Math.floor(Math.random()*2*CF))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vr;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Vr||(Vr={}));function D0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function O0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function M0(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Vr.ACK_USER_WRITE,this.source=D0()}operationForChild(e){if(Te(this.path)){if(this.affectedTree.value!=null)return G(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new He(e));return new fp(ze(),t,this.revert)}}else return G(xe(this.path)===e,"operationForChild called for unrelated child."),new fp(tt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e,t){this.source=e,this.path=t,this.type=Vr.LISTEN_COMPLETE}operationForChild(e){return Te(this.path)?new ed(this.source,ze()):new ed(this.source,tt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Vr.OVERWRITE}operationForChild(e){return Te(this.path)?new Ko(this.source,ze(),this.snap.getImmediateChild(e)):new Ko(this.source,tt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Vr.MERGE}operationForChild(e){if(Te(this.path)){const t=this.children.subtree(new He(e));return t.isEmpty()?null:t.value?new Ko(this.source,ze(),t.value):new xl(this.source,ze(),t)}else return G(xe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new xl(this.source,tt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Te(e))return this.isFullyInitialized()&&!this.filtered_;const t=xe(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function PF(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(yF(o.childName,o.snapshotNode))}),Lc(n,s,"child_removed",e,r,t),Lc(n,s,"child_added",e,r,t),Lc(n,s,"child_moved",i,r,t),Lc(n,s,"child_changed",e,r,t),Lc(n,s,"value",e,r,t),s}function Lc(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>DF(n,a,l)),o.forEach(a=>{const l=kF(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function kF(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function DF(n,e,t){if(e.childName==null||t.childName==null)throw Yl("Should only compare child_ events.");const r=new be(e.childName,e.snapshotNode),s=new be(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(n,e){return{eventCache:n,serverCache:e}}function fu(n,e,t,r){return hm(new qi(e,t,r),n.serverCache)}function $C(n,e,t,r){return hm(n.eventCache,new qi(e,t,r))}function pp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Qo(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sy;const OF=()=>(sy||(sy=new ts(gV)),sy);class st{static fromObject(e){let t=new st(null);return cn(e,(r,s)=>{t=t.set(new He(r),s)}),t}constructor(e,t=OF()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ze(),value:this.value};if(Te(e))return null;{const r=xe(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(tt(e),t);return i!=null?{path:wt(new He(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Te(e))return this;{const t=xe(e),r=this.children.get(t);return r!==null?r.subtree(tt(e)):new st(null)}}set(e,t){if(Te(e))return new st(t,this.children);{const r=xe(e),i=(this.children.get(r)||new st(null)).set(tt(e),t),o=this.children.insert(r,i);return new st(this.value,o)}}remove(e){if(Te(e))return this.children.isEmpty()?new st(null):new st(null,this.children);{const t=xe(e),r=this.children.get(t);if(r){const s=r.remove(tt(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new st(null):new st(this.value,i)}else return this}}get(e){if(Te(e))return this.value;{const t=xe(e),r=this.children.get(t);return r?r.get(tt(e)):null}}setTree(e,t){if(Te(e))return t;{const r=xe(e),i=(this.children.get(r)||new st(null)).setTree(tt(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new st(this.value,o)}}fold(e){return this.fold_(ze(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(wt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ze(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(Te(e))return null;{const i=xe(e),o=this.children.get(i);return o?o.findOnPath_(tt(e),wt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ze(),t)}foreachOnPath_(e,t,r){if(Te(e))return this;{this.value&&r(t,this.value);const s=xe(e),i=this.children.get(s);return i?i.foreachOnPath_(tt(e),wt(t,s),r):new st(null)}}foreach(e){this.foreach_(ze(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(wt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(e){this.writeTree_=e}static empty(){return new Br(new st(null))}}function pu(n,e,t){if(Te(e))return new Br(new st(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Ln(s,e);return i=i.updateChild(o,t),new Br(n.writeTree_.set(s,i))}else{const s=new st(t),i=n.writeTree_.setTree(e,s);return new Br(i)}}}function D_(n,e,t){let r=n;return cn(t,(s,i)=>{r=pu(r,wt(e,s),i)}),r}function iT(n,e){if(Te(e))return Br.empty();{const t=n.writeTree_.setTree(e,new st(null));return new Br(t)}}function O_(n,e){return ma(n,e)!=null}function ma(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Ln(t.path,e)):null}function oT(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ot,(r,s)=>{e.push(new be(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new be(r,s.value))}),e}function Mi(n,e){if(Te(e))return n;{const t=ma(n,e);return t!=null?new Br(new st(t)):new Br(n.writeTree_.subtree(e))}}function M_(n){return n.writeTree_.isEmpty()}function Tl(n,e){return zC(ze(),n.writeTree_,e)}function zC(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(G(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=zC(wt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(wt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(n,e){return HC(e,n)}function MF(n,e,t,r,s){G(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=pu(n.visibleWrites,e,t)),n.lastWriteId=r}function LF(n,e,t,r){G(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=D_(n.visibleWrites,e,t),n.lastWriteId=r}function VF(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function FF(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);G(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&jF(a,r.path)?s=!1:xr(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return UF(n),!0;if(r.snap)n.visibleWrites=iT(n.visibleWrites,r.path);else{const a=r.children;cn(a,l=>{n.visibleWrites=iT(n.visibleWrites,wt(r.path,l))})}return!0}else return!1}function jF(n,e){if(n.snap)return xr(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&xr(wt(n.path,t),e))return!0;return!1}function UF(n){n.visibleWrites=qC(n.allWrites,BF,ze()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function BF(n){return n.visible}function qC(n,e,t){let r=Br.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)xr(t,o)?(a=Ln(t,o),r=pu(r,a,i.snap)):xr(o,t)&&(a=Ln(o,t),r=pu(r,ze(),i.snap.getChild(a)));else if(i.children){if(xr(t,o))a=Ln(t,o),r=D_(r,a,i.children);else if(xr(o,t))if(a=Ln(o,t),Te(a))r=D_(r,ze(),i.children);else{const l=Go(i.children,xe(a));if(l){const u=l.getChild(tt(a));r=pu(r,ze(),u)}}}else throw Yl("WriteRecord should have .snap or .children")}}return r}function WC(n,e,t,r,s){if(!r&&!s){const i=ma(n.visibleWrites,e);if(i!=null)return i;{const o=Mi(n.visibleWrites,e);if(M_(o))return t;if(t==null&&!O_(o,ze()))return null;{const a=t||ce.EMPTY_NODE;return Tl(o,a)}}}else{const i=Mi(n.visibleWrites,e);if(!s&&M_(i))return t;if(!s&&t==null&&!O_(i,ze()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(xr(u.path,e)||xr(e,u.path))},a=qC(n.allWrites,o,e),l=t||ce.EMPTY_NODE;return Tl(a,l)}}}function $F(n,e,t){let r=ce.EMPTY_NODE;const s=ma(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(ot,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=Mi(n.visibleWrites,e);return t.forEachChild(ot,(o,a)=>{const l=Tl(Mi(i,new He(o)),a);r=r.updateImmediateChild(o,l)}),oT(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=Mi(n.visibleWrites,e);return oT(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function zF(n,e,t,r,s){G(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=wt(e,t);if(O_(n.visibleWrites,i))return null;{const o=Mi(n.visibleWrites,i);return M_(o)?s.getChild(t):Tl(o,s.getChild(t))}}function qF(n,e,t,r){const s=wt(e,t),i=ma(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=Mi(n.visibleWrites,s);return Tl(o,r.getNode().getImmediateChild(t))}else return null}function WF(n,e){return ma(n.visibleWrites,e)}function GF(n,e,t,r,s,i,o){let a;const l=Mi(n.visibleWrites,e),u=ma(l,ze());if(u!=null)a=u;else if(t!=null)a=Tl(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),p=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=p.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=p.getNext();return h}else return[]}function HF(){return{visibleWrites:Br.empty(),allWrites:[],lastWriteId:-1}}function mp(n,e,t,r){return WC(n.writeTree,n.treePath,e,t,r)}function L0(n,e){return $F(n.writeTree,n.treePath,e)}function aT(n,e,t,r){return zF(n.writeTree,n.treePath,e,t,r)}function gp(n,e){return WF(n.writeTree,wt(n.treePath,e))}function KF(n,e,t,r,s,i){return GF(n.writeTree,n.treePath,e,t,r,s,i)}function V0(n,e,t){return qF(n.writeTree,n.treePath,e,t)}function GC(n,e){return HC(wt(n.treePath,e),n.writeTree)}function HC(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;G(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),G(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Xu(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Ju(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,El(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Xu(r,e.snapshotNode,s.oldSnap));else throw Yl("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const KC=new YF;class F0{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new qi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return V0(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Qo(this.viewCache_),i=KF(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JF(n){return{filter:n}}function XF(n,e){G(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),G(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function ZF(n,e,t,r,s){const i=new QF;let o,a;if(t.type===Vr.OVERWRITE){const u=t;u.source.fromUser?o=L_(n,e,u.path,u.snap,r,s,i):(G(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Te(u.path),o=yp(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===Vr.MERGE){const u=t;u.source.fromUser?o=tj(n,e,u.path,u.children,r,s,i):(G(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=V_(n,e,u.path,u.children,r,s,a,i))}else if(t.type===Vr.ACK_USER_WRITE){const u=t;u.revert?o=sj(n,e,u.path,r,s,i):o=nj(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===Vr.LISTEN_COMPLETE)o=rj(n,e,t.path,r,i);else throw Yl("Unknown operation type: "+t.type);const l=i.getChanges();return ej(e,o,l),{viewCache:o,changes:l}}function ej(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=pp(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(BC(pp(e)))}}function QC(n,e,t,r,s,i){const o=e.eventCache;if(gp(r,t)!=null)return e;{let a,l;if(Te(t))if(G(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Qo(e),h=u instanceof ce?u:ce.EMPTY_NODE,f=L0(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=mp(r,Qo(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=xe(t);if(u===".priority"){G(zi(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=aT(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=tt(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const p=aT(r,t,o.getNode(),l);p!=null?f=o.getNode().getImmediateChild(u).updateChild(h,p):f=o.getNode().getImmediateChild(u)}else f=V0(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return fu(e,a,o.isFullyInitialized()||Te(t),n.filter.filtersNodes())}}function yp(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Te(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=xe(t);if(!l.isCompleteForPath(t)&&zi(t)>1)return e;const x=tt(t),P=l.getNode().getImmediateChild(y).updateChild(x,r);y===".priority"?u=h.updatePriority(l.getNode(),P):u=h.updateChild(l.getNode(),y,P,x,KC,null)}const f=$C(e,u,l.isFullyInitialized()||Te(t),h.filtersNodes()),p=new F0(s,f,i);return QC(n,f,t,s,p,a)}function L_(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new F0(s,e,i);if(Te(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=fu(e,u,!0,n.filter.filtersNodes());else{const f=xe(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=fu(e,u,a.isFullyInitialized(),a.isFiltered());else{const p=tt(t),y=a.getNode().getImmediateChild(f);let x;if(Te(p))x=r;else{const T=h.getCompleteChild(f);T!=null?S0(p)===".priority"&&T.getChild(OC(p)).isEmpty()?x=T:x=T.updateChild(p,r):x=ce.EMPTY_NODE}if(y.equals(x))l=e;else{const T=n.filter.updateChild(a.getNode(),f,x,p,h,o);l=fu(e,T,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function lT(n,e){return n.eventCache.isCompleteForChild(e)}function tj(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=wt(t,l);lT(e,xe(h))&&(a=L_(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=wt(t,l);lT(e,xe(h))||(a=L_(n,a,h,u,s,i,o))}),a}function cT(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function V_(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Te(t)?u=r:u=new st(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,p)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),x=cT(n,y,p);l=yp(n,l,new He(f),x,s,i,o,a)}}),u.children.inorderTraversal((f,p)=>{const y=!e.serverCache.isCompleteForChild(f)&&p.value===null;if(!h.hasChild(f)&&!y){const x=e.serverCache.getNode().getImmediateChild(f),T=cT(n,x,p);l=yp(n,l,new He(f),T,s,i,o,a)}}),l}function nj(n,e,t,r,s,i,o){if(gp(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(Te(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return yp(n,e,t,l.getNode().getChild(t),s,i,a,o);if(Te(t)){let u=new st(null);return l.getNode().forEachChild(ls,(h,f)=>{u=u.set(new He(h),f)}),V_(n,e,t,u,s,i,a,o)}else return e}else{let u=new st(null);return r.foreach((h,f)=>{const p=wt(t,h);l.isCompleteForPath(p)&&(u=u.set(h,l.getNode().getChild(p)))}),V_(n,e,t,u,s,i,a,o)}}function rj(n,e,t,r,s){const i=e.serverCache,o=$C(e,i.getNode(),i.isFullyInitialized()||Te(t),i.isFiltered());return QC(n,o,t,r,KC,s)}function sj(n,e,t,r,s,i){let o;if(gp(r,t)!=null)return e;{const a=new F0(r,e,s),l=e.eventCache.getNode();let u;if(Te(t)||xe(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=mp(r,Qo(e));else{const f=e.serverCache.getNode();G(f instanceof ce,"serverChildren would be complete if leaf node"),h=L0(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=xe(t);let f=V0(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,tt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,ce.EMPTY_NODE,tt(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=mp(r,Qo(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||gp(r,ze())!=null,fu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ij{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new P0(r.getIndex()),i=vF(r);this.processor_=JF(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(ce.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ce.EMPTY_NODE,a.getNode(),null),h=new qi(l,o.isFullyInitialized(),s.filtersNodes()),f=new qi(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=hm(f,h),this.eventGenerator_=new NF(this.query_)}get query(){return this.query_}}function oj(n){return n.viewCache_.serverCache.getNode()}function aj(n){return pp(n.viewCache_)}function lj(n,e){const t=Qo(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Te(e)&&!t.getImmediateChild(xe(e)).isEmpty())?t.getChild(e):null}function uT(n){return n.eventRegistrations_.length===0}function cj(n,e){n.eventRegistrations_.push(e)}function dT(n,e,t){const r=[];if(t){G(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function hT(n,e,t,r){e.type===Vr.MERGE&&e.source.queryId!==null&&(G(Qo(n.viewCache_),"We should always have a full cache before handling merges"),G(pp(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=ZF(n.processor_,s,e,t,r);return XF(n.processor_,i.viewCache),G(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,YC(n,i.changes,i.viewCache.eventCache.getNode(),null)}function uj(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ot,(i,o)=>{r.push(El(i,o))}),t.isFullyInitialized()&&r.push(BC(t.getNode())),YC(n,r,t.getNode(),e)}function YC(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return PF(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _p;class JC{constructor(){this.views=new Map}}function dj(n){G(!_p,"__referenceConstructor has already been defined"),_p=n}function hj(){return G(_p,"Reference.ts has not been loaded"),_p}function fj(n){return n.views.size===0}function j0(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return G(i!=null,"SyncTree gave us an op for an invalid query."),hT(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(hT(o,e,t,r));return i}}function XC(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=mp(t,s?r:null),l=!1;a?l=!0:r instanceof ce?(a=L0(t,r),l=!1):(a=ce.EMPTY_NODE,l=!1);const u=hm(new qi(a,l,!1),new qi(r,s,!1));return new ij(e,u)}return o}function pj(n,e,t,r,s,i){const o=XC(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),cj(o,t),uj(o,t)}function mj(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=Wi(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(dT(u,t,r)),uT(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(dT(l,t,r)),uT(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Wi(n)&&i.push(new(hj())(e._repo,e._path)),{removed:i,events:o}}function ZC(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Li(n,e){let t=null;for(const r of n.views.values())t=t||lj(r,e);return t}function eR(n,e){if(e._queryParams.loadsAllData())return pm(n);{const r=e._queryIdentifier;return n.views.get(r)}}function tR(n,e){return eR(n,e)!=null}function Wi(n){return pm(n)!=null}function pm(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vp;function gj(n){G(!vp,"__referenceConstructor has already been defined"),vp=n}function yj(){return G(vp,"Reference.ts has not been loaded"),vp}let _j=1;class fT{constructor(e){this.listenProvider_=e,this.syncPointTree_=new st(null),this.pendingWriteTree_=HF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function U0(n,e,t,r,s){return MF(n.pendingWriteTree_,e,t,r,s),s?Zl(n,new Ko(D0(),e,t)):[]}function vj(n,e,t,r){LF(n.pendingWriteTree_,e,t,r);const s=st.fromObject(t);return Zl(n,new xl(D0(),e,s))}function wi(n,e,t=!1){const r=VF(n.pendingWriteTree_,e);if(FF(n.pendingWriteTree_,e)){let i=new st(null);return r.snap!=null?i=i.set(ze(),!0):cn(r.children,o=>{i=i.set(new He(o),!0)}),Zl(n,new fp(r.path,i,t))}else return[]}function Dd(n,e,t){return Zl(n,new Ko(O0(),e,t))}function wj(n,e,t){const r=st.fromObject(t);return Zl(n,new xl(O0(),e,r))}function Ij(n,e){return Zl(n,new ed(O0(),e))}function Ej(n,e,t){const r=B0(n,t);if(r){const s=$0(r),i=s.path,o=s.queryId,a=Ln(i,e),l=new ed(M0(o),a);return z0(n,i,l)}else return[]}function wp(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||tR(o,e))){const l=mj(o,e,t,r);fj(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(p=>p._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(p,y)=>Wi(y));if(h&&!f){const p=n.syncPointTree_.subtree(i);if(!p.isEmpty()){const y=Sj(p);for(let x=0;x<y.length;++x){const T=y[x],P=T.query,R=iR(n,T);n.listenProvider_.startListening(mu(P),td(n,P),R.hashFn,R.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(mu(e),null):u.forEach(p=>{const y=n.queryToTagMap.get(gm(p));n.listenProvider_.stopListening(mu(p),y)}))}bj(n,u)}return a}function nR(n,e,t,r){const s=B0(n,r);if(s!=null){const i=$0(s),o=i.path,a=i.queryId,l=Ln(o,e),u=new Ko(M0(a),l,t);return z0(n,o,u)}else return[]}function xj(n,e,t,r){const s=B0(n,r);if(s){const i=$0(s),o=i.path,a=i.queryId,l=Ln(o,e),u=st.fromObject(t),h=new xl(M0(a),l,u);return z0(n,o,h)}else return[]}function F_(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(p,y)=>{const x=Ln(p,s);i=i||Li(y,x),o=o||Wi(y)});let a=n.syncPointTree_.get(s);a?(o=o||Wi(a),i=i||Li(a,ze())):(a=new JC,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=ce.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,x)=>{const T=Li(x,ze());T&&(i=i.updateImmediateChild(y,T))}));const u=tR(a,e);if(!u&&!e._queryParams.loadsAllData()){const p=gm(e);G(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const y=Aj();n.queryToTagMap.set(p,y),n.tagToQueryMap.set(y,p)}const h=fm(n.pendingWriteTree_,s);let f=pj(a,e,t,h,i,l);if(!u&&!o&&!r){const p=eR(a,e);f=f.concat(Cj(n,e,p))}return f}function mm(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=Ln(o,e),u=Li(a,l);if(u)return u});return WC(s,e,i,t,!0)}function Tj(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=Ln(u,t);r=r||Li(h,f)});let s=n.syncPointTree_.get(t);s?r=r||Li(s,ze()):(s=new JC,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new qi(r,!0,!1):null,a=fm(n.pendingWriteTree_,e._path),l=XC(s,e,a,i?o.getNode():ce.EMPTY_NODE,i);return aj(l)}function Zl(n,e){return rR(e,n.syncPointTree_,null,fm(n.pendingWriteTree_,ze()))}function rR(n,e,t,r){if(Te(n.path))return sR(n,e,t,r);{const s=e.get(ze());t==null&&s!=null&&(t=Li(s,ze()));let i=[];const o=xe(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=GC(r,o);i=i.concat(rR(a,l,u,h))}return s&&(i=i.concat(j0(s,n,r,t))),i}}function sR(n,e,t,r){const s=e.get(ze());t==null&&s!=null&&(t=Li(s,ze()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=GC(r,o),h=n.operationForChild(o);h&&(i=i.concat(sR(h,a,l,u)))}),s&&(i=i.concat(j0(s,n,r,t))),i}function iR(n,e){const t=e.query,r=td(n,t);return{hashFn:()=>(oj(e)||ce.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?Ej(n,t._path,r):Ij(n,t._path);{const i=vV(s,t);return wp(n,t,null,i)}}}}function td(n,e){const t=gm(e);return n.queryToTagMap.get(t)}function gm(n){return n._path.toString()+"$"+n._queryIdentifier}function B0(n,e){return n.tagToQueryMap.get(e)}function $0(n){const e=n.indexOf("$");return G(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new He(n.substr(0,e))}}function z0(n,e,t){const r=n.syncPointTree_.get(e);G(r,"Missing sync point for query tag that we're tracking");const s=fm(n.pendingWriteTree_,e);return j0(r,t,s,null)}function Sj(n){return n.fold((e,t,r)=>{if(t&&Wi(t))return[pm(t)];{let s=[];return t&&(s=ZC(t)),cn(r,(i,o)=>{s=s.concat(o)}),s}})}function mu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(yj())(n._repo,n._path):n}function bj(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=gm(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function Aj(){return _j++}function Cj(n,e,t){const r=e._path,s=td(n,e),i=iR(n,t),o=n.listenProvider_.startListening(mu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)G(!Wi(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!Te(u)&&h&&Wi(h))return[pm(h).query];{let p=[];return h&&(p=p.concat(ZC(h).map(y=>y.query))),cn(f,(y,x)=>{p=p.concat(x)}),p}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(mu(h),td(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new q0(t)}node(){return this.node_}}class W0{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=wt(this.path_,e);return new W0(this.syncTree_,t)}node(){return mm(this.syncTree_,this.path_)}}const Rj=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},pT=function(n,e,t){if(!n||typeof n!="object")return n;if(G(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Nj(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Pj(n[".sv"],e);G(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Nj=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:G(!1,"Unexpected server value: "+n)}},Pj=function(n,e,t){n.hasOwnProperty("increment")||G(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&G(!1,"Unexpected increment value: "+r);const s=e.node();if(G(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},oR=function(n,e,t,r){return H0(e,new W0(t,n),r)},G0=function(n,e,t){return H0(n,new q0(e),t)};function H0(n,e,t){const r=n.getPriority().val(),s=pT(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=pT(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Zt(a,Tt(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Zt(s))),o.forEachChild(ot,(a,l)=>{const u=H0(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function ym(n,e){let t=e instanceof He?e:new He(e),r=n,s=xe(t);for(;s!==null;){const i=Go(r.node.children,s)||{children:{},childCount:0};r=new K0(s,r,i),t=tt(t),s=xe(t)}return r}function ga(n){return n.node.value}function Q0(n,e){n.node.value=e,j_(n)}function aR(n){return n.node.childCount>0}function kj(n){return ga(n)===void 0&&!aR(n)}function _m(n,e){cn(n.node.children,(t,r)=>{e(new K0(t,n,r))})}function lR(n,e,t,r){t&&!r&&e(n),_m(n,s=>{lR(s,e,!0,r)}),t&&r&&e(n)}function Dj(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Od(n){return new He(n.parent===null?n.name:Od(n.parent)+"/"+n.name)}function j_(n){n.parent!==null&&Oj(n.parent,n.name,n)}function Oj(n,e,t){const r=kj(t),s=Gr(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,j_(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,j_(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mj=/[\[\].#$\/\u0000-\u001F\u007F]/,Lj=/[\[\].#$\u0000-\u001F\u007F]/,iy=10*1024*1024,vm=function(n){return typeof n=="string"&&n.length!==0&&!Mj.test(n)},cR=function(n){return typeof n=="string"&&n.length!==0&&!Lj.test(n)},Vj=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),cR(n)},nd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!cm(n)||n&&typeof n=="object"&&Gr(n,".sv")},ps=function(n,e,t,r){r&&e===void 0||Md(Ho(n,"value"),e,t)},Md=function(n,e,t){const r=t instanceof He?new ZV(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+wo(r));if(typeof e=="function")throw new Error(n+"contains a function "+wo(r)+" with contents = "+e.toString());if(cm(e))throw new Error(n+"contains "+e.toString()+" "+wo(r));if(typeof e=="string"&&e.length>iy/3&&lm(e)>iy)throw new Error(n+"contains a string greater than "+iy+" utf8 bytes "+wo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(cn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!vm(o)))throw new Error(n+" contains an invalid key ("+o+") "+wo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);eF(r,o),Md(n,a,r),tF(r)}),s&&i)throw new Error(n+' contains ".value" child '+wo(r)+" in addition to actual children.")}},Fj=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Yu(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!vm(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(XV);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&xr(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},uR=function(n,e,t,r){if(r&&e===void 0)return;const s=Ho(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];cn(e,(o,a)=>{const l=new He(o);if(Md(s,a,wt(t,l)),S0(l)===".priority"&&!nd(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),Fj(s,i)},Y0=function(n,e,t){if(!(t&&e===void 0)){if(cm(e))throw new Error(Ho(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!nd(e))throw new Error(Ho(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ld=function(n,e,t,r){if(!(r&&t===void 0)&&!vm(t))throw new Error(Ho(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},J0=function(n,e,t,r){if(!(r&&t===void 0)&&!cR(t))throw new Error(Ho(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},jj=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),J0(n,e,t,r)},ns=function(n,e){if(xe(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},dR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!vm(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Vj(t))throw new Error(Ho(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function wm(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!b0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function hR(n,e,t){wm(n,t),fR(n,r=>b0(r,e))}function pr(n,e,t){wm(n,t),fR(n,r=>xr(r,e)||xr(e,r))}function fR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(Bj(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Bj(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Lo&&sn("event: "+t.toString()),Jl(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pR="repo_interrupt",$j=25;class zj{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Uj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=hp(),this.transactionQueueTree_=new K0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function qj(n,e,t){if(n.stats_=x0(n.repoInfo_),n.forceRestClient_||xV())n.server_=new dp(n.repoInfo_,(r,s,i,o)=>{mT(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>gT(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Kt(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Sr(n.repoInfo_,e,(r,s,i,o)=>{mT(n,r,s,i,o)},r=>{gT(n,r)},r=>{Wj(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=CV(n.repoInfo_,()=>new RF(n.stats_,n.server_)),n.infoData_=new TF,n.infoSyncTree_=new fT({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=Dd(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),X0(n,"connected",!1),n.serverSyncTree_=new fT({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);pr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function mR(n){const t=n.infoData_.getNode(new He(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Vd(n){return Rj({timestamp:mR(n)})}function mT(n,e,t,r,s){n.dataUpdateCount++;const i=new He(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=op(t,u=>Tt(u));o=xj(n.serverSyncTree_,i,l,s)}else{const l=Tt(t);o=nR(n.serverSyncTree_,i,l,s)}else if(r){const l=op(t,u=>Tt(u));o=wj(n.serverSyncTree_,i,l)}else{const l=Tt(t);o=Dd(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=Sl(n,i)),pr(n.eventQueue_,a,o)}function gT(n,e){X0(n,"connected",e),e===!1&&Kj(n)}function Wj(n,e){cn(e,(t,r)=>{X0(n,t,r)})}function X0(n,e,t){const r=new He("/.info/"+e),s=Tt(t);n.infoData_.updateSnapshot(r,s);const i=Dd(n.infoSyncTree_,r,s);pr(n.eventQueue_,r,i)}function Im(n){return n.nextWriteId_++}function Gj(n,e,t){const r=Tj(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=Tt(s).withIndex(e._queryParams.getIndex());F_(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Dd(n.serverSyncTree_,e._path,i);else{const a=td(n.serverSyncTree_,e);o=nR(n.serverSyncTree_,e._path,i,a)}return pr(n.eventQueue_,e._path,o),wp(n.serverSyncTree_,e,t,null,!0),i},s=>(ec(n,"get for query "+Kt(e)+" failed: "+s),Promise.reject(new Error(s))))}function Z0(n,e,t,r,s){ec(n,"set",{path:e.toString(),value:t,priority:r});const i=Vd(n),o=Tt(t,r),a=mm(n.serverSyncTree_,e),l=G0(o,a,i),u=Im(n),h=U0(n.serverSyncTree_,e,l,u,!0);wm(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(p,y)=>{const x=p==="ok";x||Rn("set at "+e+" failed: "+p);const T=wi(n.serverSyncTree_,u,!x);pr(n.eventQueue_,e,T),Gi(n,s,p,y)});const f=tw(n,e);Sl(n,f),pr(n.eventQueue_,f,[])}function Hj(n,e,t,r){ec(n,"update",{path:e.toString(),value:t});let s=!0;const i=Vd(n),o={};if(cn(t,(a,l)=>{s=!1,o[a]=oR(wt(e,a),Tt(l),n.serverSyncTree_,i)}),s)sn("update() called with empty data.  Don't do anything."),Gi(n,r,"ok",void 0);else{const a=Im(n),l=vj(n.serverSyncTree_,e,o,a);wm(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||Rn("update at "+e+" failed: "+u);const p=wi(n.serverSyncTree_,a,!f),y=p.length>0?Sl(n,e):e;pr(n.eventQueue_,y,p),Gi(n,r,u,h)}),cn(t,u=>{const h=tw(n,wt(e,u));Sl(n,h)}),pr(n.eventQueue_,e,[])}}function Kj(n){ec(n,"onDisconnectEvents");const e=Vd(n),t=hp();k_(n.onDisconnect_,ze(),(s,i)=>{const o=oR(s,i,n.serverSyncTree_,e);Xl(t,s,o)});let r=[];k_(t,ze(),(s,i)=>{r=r.concat(Dd(n.serverSyncTree_,s,i));const o=tw(n,s);Sl(n,o)}),n.onDisconnect_=hp(),pr(n.eventQueue_,ze(),r)}function Qj(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&P_(n.onDisconnect_,e),Gi(n,t,r,s)})}function yT(n,e,t,r){const s=Tt(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Xl(n.onDisconnect_,e,s),Gi(n,r,i,o)})}function Yj(n,e,t,r,s){const i=Tt(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Xl(n.onDisconnect_,e,i),Gi(n,s,o,a)})}function Jj(n,e,t,r){if(ip(t)){sn("onDisconnect().update() called with empty data.  Don't do anything."),Gi(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&cn(t,(o,a)=>{const l=Tt(a);Xl(n.onDisconnect_,wt(e,o),l)}),Gi(n,r,s,i)})}function Xj(n,e,t){let r;xe(e._path)===".info"?r=F_(n.infoSyncTree_,e,t):r=F_(n.serverSyncTree_,e,t),hR(n.eventQueue_,e._path,r)}function U_(n,e,t){let r;xe(e._path)===".info"?r=wp(n.infoSyncTree_,e,t):r=wp(n.serverSyncTree_,e,t),hR(n.eventQueue_,e._path,r)}function gR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(pR)}function Zj(n){n.persistentConnection_&&n.persistentConnection_.resume(pR)}function ec(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),sn(t,...e)}function Gi(n,e,t,r){e&&Jl(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function e4(n,e,t,r,s,i){ec(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:dC(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=ew(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Md("transaction failed: Data returned ",l,o.path),o.status=0;const u=ym(n.transactionQueueTree_,e),h=ga(u)||[];h.push(o),Q0(u,h);let f;typeof l=="object"&&l!==null&&Gr(l,".priority")?(f=Go(l,".priority"),G(nd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(mm(n.serverSyncTree_,e)||ce.EMPTY_NODE).getPriority().val();const p=Vd(n),y=Tt(l,f),x=G0(y,a,p);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=x,o.currentWriteId=Im(n);const T=U0(n.serverSyncTree_,e,x,o.currentWriteId,o.applyLocally);pr(n.eventQueue_,e,T),Em(n,n.transactionQueueTree_)}}function ew(n,e,t){return mm(n.serverSyncTree_,e,t)||ce.EMPTY_NODE}function Em(n,e=n.transactionQueueTree_){if(e||xm(n,e),ga(e)){const t=_R(n,e);G(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&t4(n,Od(e),t)}else aR(e)&&_m(e,t=>{Em(n,t)})}function t4(n,e,t){const r=t.map(u=>u.currentWriteId),s=ew(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];G(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=Ln(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{ec(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(wi(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&f.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();xm(n,ym(n.transactionQueueTree_,e)),Em(n,n.transactionQueueTree_),pr(n.eventQueue_,e,h);for(let p=0;p<f.length;p++)Jl(f[p])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Rn("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}Sl(n,e)}},o)}function Sl(n,e){const t=yR(n,e),r=Od(t),s=_R(n,t);return n4(n,s,r),r}function n4(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=Ln(t,l.path);let h=!1,f;if(G(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(wi(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=$j)h=!0,f="maxretry",s=s.concat(wi(n.serverSyncTree_,l.currentWriteId,!0));else{const p=ew(n,l.path,o);l.currentInputSnapshot=p;const y=e[a].update(p.val());if(y!==void 0){Md("transaction failed: Data returned ",y,l.path);let x=Tt(y);typeof y=="object"&&y!=null&&Gr(y,".priority")||(x=x.updatePriority(p.getPriority()));const P=l.currentWriteId,R=Vd(n),b=G0(x,p,R);l.currentOutputSnapshotRaw=x,l.currentOutputSnapshotResolved=b,l.currentWriteId=Im(n),o.splice(o.indexOf(P),1),s=s.concat(U0(n.serverSyncTree_,l.path,b,l.currentWriteId,l.applyLocally)),s=s.concat(wi(n.serverSyncTree_,P,!0))}else h=!0,f="nodata",s=s.concat(wi(n.serverSyncTree_,l.currentWriteId,!0))}pr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}xm(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Jl(r[a]);Em(n,n.transactionQueueTree_)}function yR(n,e){let t,r=n.transactionQueueTree_;for(t=xe(e);t!==null&&ga(r)===void 0;)r=ym(r,t),e=tt(e),t=xe(e);return r}function _R(n,e){const t=[];return vR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function vR(n,e,t){const r=ga(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);_m(e,s=>{vR(n,s,t)})}function xm(n,e){const t=ga(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,Q0(e,t.length>0?t:void 0)}_m(e,r=>{xm(n,r)})}function tw(n,e){const t=Od(yR(n,e)),r=ym(n.transactionQueueTree_,e);return Dj(r,s=>{oy(n,s)}),oy(n,r),lR(r,s=>{oy(n,s)}),t}function oy(n,e){const t=ga(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(G(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(G(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(wi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Q0(e,void 0):t.length=i+1,pr(n.eventQueue_,Od(e),s);for(let o=0;o<r.length;o++)Jl(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r4(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function s4(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Rn(`Invalid query segment '${t}' in query '${n}'`)}return e}const B_=function(n,e){const t=i4(n),r=t.namespace;t.domain==="firebase.com"&&fs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&fs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||pV();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new SC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new He(t.pathString)}},i4=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=r4(n.substring(h,f)));const p=s4(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const x=e.indexOf(".");r=e.substring(0,x).toLowerCase(),t=e.substring(x+1),i=r}"ns"in p&&(i=p.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _T="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",o4=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=_T.charAt(t%64),t=Math.floor(t/64);G(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=_T.charAt(e[s]);return G(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Kt(this.snapshot.exportVal())}}class IR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return G(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new ir;return Qj(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ns("OnDisconnect.remove",this._path);const e=new ir;return yT(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ns("OnDisconnect.set",this._path),ps("OnDisconnect.set",e,this._path,!1);const t=new ir;return yT(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){ns("OnDisconnect.setWithPriority",this._path),ps("OnDisconnect.setWithPriority",e,this._path,!1),Y0("OnDisconnect.setWithPriority",t,!1);const r=new ir;return Yj(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){ns("OnDisconnect.update",this._path),uR("OnDisconnect.update",e,this._path,!1);const t=new ir;return Jj(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return Te(this._path)?null:S0(this._path)}get ref(){return new Hr(this._repo,this._path)}get _queryIdentifier(){const e=rT(this._queryParams),t=I0(e);return t==="{}"?"default":t}get _queryObject(){return rT(this._queryParams)}isEqual(e){if(e=X(e),!(e instanceof _r))return!1;const t=this._repo===e._repo,r=b0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+JV(this._path)}}function Tm(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function ro(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ls){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==$i)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Vs)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===ot){if(e!=null&&!nd(e)||t!=null&&!nd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(G(n.getIndex()instanceof R0||n.getIndex()===N0,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Sm(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Hr extends _r{constructor(e,t){super(e,t,new k0,!1)}get parent(){const e=OC(this._path);return e===null?null:new Hr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Yo{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new He(e),r=bl(this.ref,e);return new Yo(this._node.getChild(t),r,ot)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Yo(s,bl(this.ref,r),ot)))}hasChild(e){const t=new He(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ve(n,e){return n=X(n),n._checkNotDeleted("ref"),e!==void 0?bl(n._root,e):n._root}function _q(n,e){n=X(n),n._checkNotDeleted("refFromURL");const t=B_(e,n._repo.repoInfo_.nodeAdmin);dR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&fs("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),ve(n,t.path.toString())}function bl(n,e){return n=X(n),xe(n._path)===null?jj("child","path",e,!1):J0("child","path",e,!1),new Hr(n._repo,wt(n._path,e))}function vq(n){return n=X(n),new a4(n._repo,n._path)}function ER(n,e){n=X(n),ns("push",n._path),ps("push",e,n._path,!0);const t=mR(n._repo),r=o4(t),s=bl(n,r),i=bl(n,r);let o;return e!=null?o=en(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function l4(n){return ns("remove",n._path),en(n,null)}function en(n,e){n=X(n),ns("set",n._path),ps("set",e,n._path,!1);const t=new ir;return Z0(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function wq(n,e){n=X(n),ns("setPriority",n._path),Y0("setPriority",e,!1);const t=new ir;return Z0(n._repo,wt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Iq(n,e,t){if(ns("setWithPriority",n._path),ps("setWithPriority",e,n._path,!1),Y0("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new ir;return Z0(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function Eq(n,e){uR("update",e,n._path,!1);const t=new ir;return Hj(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Pt(n){n=X(n);const e=new nw(()=>{}),t=new Fd(e);return Gj(n._repo,n,t).then(r=>new Yo(r,new Hr(n._repo,n._path),n._queryParams.getIndex()))}class Fd{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new wR("value",this,new Yo(e.snapshotNode,new Hr(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new IR(this,e,t):null}matches(e){return e instanceof Fd?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class bm{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new IR(this,e,t):null}createEvent(e,t){G(e.childName!=null,"Child events should have a childName.");const r=bl(new Hr(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new wR(e.type,this,new Yo(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof bm?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function jd(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{U_(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new nw(t,i||void 0),a=e==="value"?new Fd(o):new bm(e,o);return Xj(n._repo,n,a),()=>U_(n._repo,n,a)}function $_(n,e,t,r){return jd(n,"value",e,t,r)}function xq(n,e,t,r){return jd(n,"child_added",e,t,r)}function Tq(n,e,t,r){return jd(n,"child_changed",e,t,r)}function Sq(n,e,t,r){return jd(n,"child_moved",e,t,r)}function bq(n,e,t,r){return jd(n,"child_removed",e,t,r)}function Aq(n,e,t){let r=null;const s=t?new nw(t):null;e==="value"?r=new Fd(s):e&&(r=new bm(e,s)),U_(n._repo,n,r)}let Kr=class{},xR=class extends Kr{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){ps("endAt",this._value,e._path,!0);const t=N_(e._queryParams,this._value,this._key);if(Sm(t),ro(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new _r(e._repo,e._path,t,e._orderByCalled)}};function Nq(n,e){return Ld("endAt","key",e,!0),new xR(n,e)}class c4 extends Kr{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){ps("endBefore",this._value,e._path,!1);const t=xF(e._queryParams,this._value,this._key);if(Sm(t),ro(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new _r(e._repo,e._path,t,e._orderByCalled)}}function Pq(n,e){return Ld("endBefore","key",e,!0),new c4(n,e)}let TR=class extends Kr{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){ps("startAt",this._value,e._path,!0);const t=R_(e._queryParams,this._value,this._key);if(Sm(t),ro(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new _r(e._repo,e._path,t,e._orderByCalled)}};function Dq(n=null,e){return Ld("startAt","key",e,!0),new TR(n,e)}class u4 extends Kr{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){ps("startAfter",this._value,e._path,!1);const t=EF(e._queryParams,this._value,this._key);if(Sm(t),ro(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new _r(e._repo,e._path,t,e._orderByCalled)}}function Oq(n,e){return Ld("startAfter","key",e,!0),new u4(n,e)}class d4 extends Kr{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new _r(e._repo,e._path,wF(e._queryParams,this._limit),e._orderByCalled)}}function Mq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new d4(n)}class h4 extends Kr{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new _r(e._repo,e._path,IF(e._queryParams,this._limit),e._orderByCalled)}}function Lq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new h4(n)}class f4 extends Kr{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Tm(e,"orderByChild");const t=new He(this._path);if(Te(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new R0(t),s=dm(e._queryParams,r);return ro(s),new _r(e._repo,e._path,s,!0)}}function Vq(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return J0("orderByChild","path",n,!1),new f4(n)}class p4 extends Kr{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Tm(e,"orderByKey");const t=dm(e._queryParams,ls);return ro(t),new _r(e._repo,e._path,t,!0)}}function Fq(){return new p4}class m4 extends Kr{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Tm(e,"orderByPriority");const t=dm(e._queryParams,ot);return ro(t),new _r(e._repo,e._path,t,!0)}}function jq(){return new m4}class g4 extends Kr{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Tm(e,"orderByValue");const t=dm(e._queryParams,N0);return ro(t),new _r(e._repo,e._path,t,!0)}}function Uq(){return new g4}class y4 extends Kr{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(ps("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new xR(this._value,this._key)._apply(new TR(this._value,this._key)._apply(e))}}function Bq(n,e){return Ld("equalTo","key",e,!0),new y4(n,e)}function $q(n,...e){let t=X(n);for(const r of e)t=r._apply(t);return t}dj(Hr);gj(Hr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4="FIREBASE_DATABASE_EMULATOR_HOST",z_={};let SR=!1;function v4(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=qs(i);n.repoInfo_=new SC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function bR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||fs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),sn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=B_(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[_4]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=B_(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new al(al.OWNER):new SV(n.name,n.options,e);dR("Invalid Firebase Database URL",o),Te(o.path)||fs("Database URL must point to the root of a Firebase Database (not including a child path).");const f=I4(a,n,h,new TV(n,t));return new x4(f,n)}function w4(n,e){const t=z_[e];(!t||t[n.key]!==n)&&fs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),gR(n),delete t[n.key]}function I4(n,e,t,r){let s=z_[e.name];s||(s={},z_[e.name]=s);let i=s[n.toURLString()];return i&&fs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new zj(n,SR,t,r),s[n.toURLString()]=i,i}function E4(n){SR=n}class x4{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(qj(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Hr(this._repo,ze())),this._rootInternal}_delete(){return this._rootInternal!==null&&(w4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&fs("Cannot call "+e+" on a deleted database.")}}function AR(){Il.IS_TRANSPORT_INITIALIZED&&Rn("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function zq(){AR(),vi.forceDisallow()}function qq(){AR(),Ir.forceDisallow(),vi.forceAllow()}function T4(n=Rd(),e){const t=gs(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=qA("database");r&&S4(t,...r)}return t}function S4(n,e,t,r={}){n=X(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&fr(r,i.repoInfo_.emulatorOptions))return;fs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&fs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new al(al.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:HA(r.mockUserToken,n.app.options.projectId);o=new al(a)}qs(e)&&(om(e),g0("Database",!0)),v4(i,s,r,o)}function Wq(n){n=X(n),n._checkNotDeleted("goOffline"),gR(n._repo)}function Gq(n){n=X(n),n._checkNotDeleted("goOnline"),Zj(n._repo)}function Hq(n,e){fC(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b4(n){cC(fa),qr(new Zn("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return bR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Jn(Ux,Bx,n),Jn(Ux,Bx,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4={".sv":"timestamp"};function Kq(){return A4}function Qq(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Yq(n,e,t){if(n=X(n),ns("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new ir,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new Yo(u,new Hr(n._repo,n._path),ot),s.resolve(new C4(l,h)))},o=$_(n,()=>{});return e4(n._repo,n._path,e,i,o,r),s.promise}Sr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Sr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const Jq=function(n){const e=Sr.prototype.put;return Sr.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){Sr.prototype.put=e}},Xq=function(n){E4(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zq({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){cC(t);const o=new tC("database-standalone"),a=new w_("auth-internal",o);let l;return s&&(l=new w_("app-check-internal",o),l.setComponent(new Zn("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Zn("auth-internal",()=>r,"PRIVATE")),bR(n,a,l,e,i)}b4();var vT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Vi,CR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,v){function S(){}S.prototype=v.prototype,A.D=v.prototype,A.prototype=new S,A.prototype.constructor=A,A.C=function(_,E,C){for(var w=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)w[Z-2]=arguments[Z];return v.prototype[E].apply(_,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,v,S){S||(S=0);var _=Array(16);if(typeof v=="string")for(var E=0;16>E;++E)_[E]=v.charCodeAt(S++)|v.charCodeAt(S++)<<8|v.charCodeAt(S++)<<16|v.charCodeAt(S++)<<24;else for(E=0;16>E;++E)_[E]=v[S++]|v[S++]<<8|v[S++]<<16|v[S++]<<24;v=A.g[0],S=A.g[1],E=A.g[2];var C=A.g[3],w=v+(C^S&(E^C))+_[0]+3614090360&4294967295;v=S+(w<<7&4294967295|w>>>25),w=C+(E^v&(S^E))+_[1]+3905402710&4294967295,C=v+(w<<12&4294967295|w>>>20),w=E+(S^C&(v^S))+_[2]+606105819&4294967295,E=C+(w<<17&4294967295|w>>>15),w=S+(v^E&(C^v))+_[3]+3250441966&4294967295,S=E+(w<<22&4294967295|w>>>10),w=v+(C^S&(E^C))+_[4]+4118548399&4294967295,v=S+(w<<7&4294967295|w>>>25),w=C+(E^v&(S^E))+_[5]+1200080426&4294967295,C=v+(w<<12&4294967295|w>>>20),w=E+(S^C&(v^S))+_[6]+2821735955&4294967295,E=C+(w<<17&4294967295|w>>>15),w=S+(v^E&(C^v))+_[7]+4249261313&4294967295,S=E+(w<<22&4294967295|w>>>10),w=v+(C^S&(E^C))+_[8]+1770035416&4294967295,v=S+(w<<7&4294967295|w>>>25),w=C+(E^v&(S^E))+_[9]+2336552879&4294967295,C=v+(w<<12&4294967295|w>>>20),w=E+(S^C&(v^S))+_[10]+4294925233&4294967295,E=C+(w<<17&4294967295|w>>>15),w=S+(v^E&(C^v))+_[11]+2304563134&4294967295,S=E+(w<<22&4294967295|w>>>10),w=v+(C^S&(E^C))+_[12]+1804603682&4294967295,v=S+(w<<7&4294967295|w>>>25),w=C+(E^v&(S^E))+_[13]+4254626195&4294967295,C=v+(w<<12&4294967295|w>>>20),w=E+(S^C&(v^S))+_[14]+2792965006&4294967295,E=C+(w<<17&4294967295|w>>>15),w=S+(v^E&(C^v))+_[15]+1236535329&4294967295,S=E+(w<<22&4294967295|w>>>10),w=v+(E^C&(S^E))+_[1]+4129170786&4294967295,v=S+(w<<5&4294967295|w>>>27),w=C+(S^E&(v^S))+_[6]+3225465664&4294967295,C=v+(w<<9&4294967295|w>>>23),w=E+(v^S&(C^v))+_[11]+643717713&4294967295,E=C+(w<<14&4294967295|w>>>18),w=S+(C^v&(E^C))+_[0]+3921069994&4294967295,S=E+(w<<20&4294967295|w>>>12),w=v+(E^C&(S^E))+_[5]+3593408605&4294967295,v=S+(w<<5&4294967295|w>>>27),w=C+(S^E&(v^S))+_[10]+38016083&4294967295,C=v+(w<<9&4294967295|w>>>23),w=E+(v^S&(C^v))+_[15]+3634488961&4294967295,E=C+(w<<14&4294967295|w>>>18),w=S+(C^v&(E^C))+_[4]+3889429448&4294967295,S=E+(w<<20&4294967295|w>>>12),w=v+(E^C&(S^E))+_[9]+568446438&4294967295,v=S+(w<<5&4294967295|w>>>27),w=C+(S^E&(v^S))+_[14]+3275163606&4294967295,C=v+(w<<9&4294967295|w>>>23),w=E+(v^S&(C^v))+_[3]+4107603335&4294967295,E=C+(w<<14&4294967295|w>>>18),w=S+(C^v&(E^C))+_[8]+1163531501&4294967295,S=E+(w<<20&4294967295|w>>>12),w=v+(E^C&(S^E))+_[13]+2850285829&4294967295,v=S+(w<<5&4294967295|w>>>27),w=C+(S^E&(v^S))+_[2]+4243563512&4294967295,C=v+(w<<9&4294967295|w>>>23),w=E+(v^S&(C^v))+_[7]+1735328473&4294967295,E=C+(w<<14&4294967295|w>>>18),w=S+(C^v&(E^C))+_[12]+2368359562&4294967295,S=E+(w<<20&4294967295|w>>>12),w=v+(S^E^C)+_[5]+4294588738&4294967295,v=S+(w<<4&4294967295|w>>>28),w=C+(v^S^E)+_[8]+2272392833&4294967295,C=v+(w<<11&4294967295|w>>>21),w=E+(C^v^S)+_[11]+1839030562&4294967295,E=C+(w<<16&4294967295|w>>>16),w=S+(E^C^v)+_[14]+4259657740&4294967295,S=E+(w<<23&4294967295|w>>>9),w=v+(S^E^C)+_[1]+2763975236&4294967295,v=S+(w<<4&4294967295|w>>>28),w=C+(v^S^E)+_[4]+1272893353&4294967295,C=v+(w<<11&4294967295|w>>>21),w=E+(C^v^S)+_[7]+4139469664&4294967295,E=C+(w<<16&4294967295|w>>>16),w=S+(E^C^v)+_[10]+3200236656&4294967295,S=E+(w<<23&4294967295|w>>>9),w=v+(S^E^C)+_[13]+681279174&4294967295,v=S+(w<<4&4294967295|w>>>28),w=C+(v^S^E)+_[0]+3936430074&4294967295,C=v+(w<<11&4294967295|w>>>21),w=E+(C^v^S)+_[3]+3572445317&4294967295,E=C+(w<<16&4294967295|w>>>16),w=S+(E^C^v)+_[6]+76029189&4294967295,S=E+(w<<23&4294967295|w>>>9),w=v+(S^E^C)+_[9]+3654602809&4294967295,v=S+(w<<4&4294967295|w>>>28),w=C+(v^S^E)+_[12]+3873151461&4294967295,C=v+(w<<11&4294967295|w>>>21),w=E+(C^v^S)+_[15]+530742520&4294967295,E=C+(w<<16&4294967295|w>>>16),w=S+(E^C^v)+_[2]+3299628645&4294967295,S=E+(w<<23&4294967295|w>>>9),w=v+(E^(S|~C))+_[0]+4096336452&4294967295,v=S+(w<<6&4294967295|w>>>26),w=C+(S^(v|~E))+_[7]+1126891415&4294967295,C=v+(w<<10&4294967295|w>>>22),w=E+(v^(C|~S))+_[14]+2878612391&4294967295,E=C+(w<<15&4294967295|w>>>17),w=S+(C^(E|~v))+_[5]+4237533241&4294967295,S=E+(w<<21&4294967295|w>>>11),w=v+(E^(S|~C))+_[12]+1700485571&4294967295,v=S+(w<<6&4294967295|w>>>26),w=C+(S^(v|~E))+_[3]+2399980690&4294967295,C=v+(w<<10&4294967295|w>>>22),w=E+(v^(C|~S))+_[10]+4293915773&4294967295,E=C+(w<<15&4294967295|w>>>17),w=S+(C^(E|~v))+_[1]+2240044497&4294967295,S=E+(w<<21&4294967295|w>>>11),w=v+(E^(S|~C))+_[8]+1873313359&4294967295,v=S+(w<<6&4294967295|w>>>26),w=C+(S^(v|~E))+_[15]+4264355552&4294967295,C=v+(w<<10&4294967295|w>>>22),w=E+(v^(C|~S))+_[6]+2734768916&4294967295,E=C+(w<<15&4294967295|w>>>17),w=S+(C^(E|~v))+_[13]+1309151649&4294967295,S=E+(w<<21&4294967295|w>>>11),w=v+(E^(S|~C))+_[4]+4149444226&4294967295,v=S+(w<<6&4294967295|w>>>26),w=C+(S^(v|~E))+_[11]+3174756917&4294967295,C=v+(w<<10&4294967295|w>>>22),w=E+(v^(C|~S))+_[2]+718787259&4294967295,E=C+(w<<15&4294967295|w>>>17),w=S+(C^(E|~v))+_[9]+3951481745&4294967295,A.g[0]=A.g[0]+v&4294967295,A.g[1]=A.g[1]+(E+(w<<21&4294967295|w>>>11))&4294967295,A.g[2]=A.g[2]+E&4294967295,A.g[3]=A.g[3]+C&4294967295}r.prototype.u=function(A,v){v===void 0&&(v=A.length);for(var S=v-this.blockSize,_=this.B,E=this.h,C=0;C<v;){if(E==0)for(;C<=S;)s(this,A,C),C+=this.blockSize;if(typeof A=="string"){for(;C<v;)if(_[E++]=A.charCodeAt(C++),E==this.blockSize){s(this,_),E=0;break}}else for(;C<v;)if(_[E++]=A[C++],E==this.blockSize){s(this,_),E=0;break}}this.h=E,this.o+=v},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var v=1;v<A.length-8;++v)A[v]=0;var S=8*this.o;for(v=A.length-8;v<A.length;++v)A[v]=S&255,S/=256;for(this.u(A),A=Array(16),v=S=0;4>v;++v)for(var _=0;32>_;_+=8)A[S++]=this.g[v]>>>_&255;return A};function i(A,v){var S=a;return Object.prototype.hasOwnProperty.call(S,A)?S[A]:S[A]=v(A)}function o(A,v){this.h=v;for(var S=[],_=!0,E=A.length-1;0<=E;E--){var C=A[E]|0;_&&C==v||(S[E]=C,_=!1)}this.g=S}var a={};function l(A){return-128<=A&&128>A?i(A,function(v){return new o([v|0],0>v?-1:0)}):new o([A|0],0>A?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return P(u(-A));for(var v=[],S=1,_=0;A>=S;_++)v[_]=A/S|0,S*=4294967296;return new o(v,0)}function h(A,v){if(A.length==0)throw Error("number format error: empty string");if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(A.charAt(0)=="-")return P(h(A.substring(1),v));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=u(Math.pow(v,8)),_=f,E=0;E<A.length;E+=8){var C=Math.min(8,A.length-E),w=parseInt(A.substring(E,E+C),v);8>C?(C=u(Math.pow(v,C)),_=_.j(C).add(u(w))):(_=_.j(S),_=_.add(u(w)))}return _}var f=l(0),p=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(T(this))return-P(this).m();for(var A=0,v=1,S=0;S<this.g.length;S++){var _=this.i(S);A+=(0<=_?_:4294967296+_)*v,v*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(x(this))return"0";if(T(this))return"-"+P(this).toString(A);for(var v=u(Math.pow(A,6)),S=this,_="";;){var E=k(S,v).g;S=R(S,E.j(v));var C=((0<S.g.length?S.g[0]:S.h)>>>0).toString(A);if(S=E,x(S))return C+_;for(;6>C.length;)C="0"+C;_=C+_}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function x(A){if(A.h!=0)return!1;for(var v=0;v<A.g.length;v++)if(A.g[v]!=0)return!1;return!0}function T(A){return A.h==-1}n.l=function(A){return A=R(this,A),T(A)?-1:x(A)?0:1};function P(A){for(var v=A.g.length,S=[],_=0;_<v;_++)S[_]=~A.g[_];return new o(S,~A.h).add(p)}n.abs=function(){return T(this)?P(this):this},n.add=function(A){for(var v=Math.max(this.g.length,A.g.length),S=[],_=0,E=0;E<=v;E++){var C=_+(this.i(E)&65535)+(A.i(E)&65535),w=(C>>>16)+(this.i(E)>>>16)+(A.i(E)>>>16);_=w>>>16,C&=65535,w&=65535,S[E]=w<<16|C}return new o(S,S[S.length-1]&-2147483648?-1:0)};function R(A,v){return A.add(P(v))}n.j=function(A){if(x(this)||x(A))return f;if(T(this))return T(A)?P(this).j(P(A)):P(P(this).j(A));if(T(A))return P(this.j(P(A)));if(0>this.l(y)&&0>A.l(y))return u(this.m()*A.m());for(var v=this.g.length+A.g.length,S=[],_=0;_<2*v;_++)S[_]=0;for(_=0;_<this.g.length;_++)for(var E=0;E<A.g.length;E++){var C=this.i(_)>>>16,w=this.i(_)&65535,Z=A.i(E)>>>16,de=A.i(E)&65535;S[2*_+2*E]+=w*de,b(S,2*_+2*E),S[2*_+2*E+1]+=C*de,b(S,2*_+2*E+1),S[2*_+2*E+1]+=w*Z,b(S,2*_+2*E+1),S[2*_+2*E+2]+=C*Z,b(S,2*_+2*E+2)}for(_=0;_<v;_++)S[_]=S[2*_+1]<<16|S[2*_];for(_=v;_<2*v;_++)S[_]=0;return new o(S,0)};function b(A,v){for(;(A[v]&65535)!=A[v];)A[v+1]+=A[v]>>>16,A[v]&=65535,v++}function N(A,v){this.g=A,this.h=v}function k(A,v){if(x(v))throw Error("division by zero");if(x(A))return new N(f,f);if(T(A))return v=k(P(A),v),new N(P(v.g),P(v.h));if(T(v))return v=k(A,P(v)),new N(P(v.g),v.h);if(30<A.g.length){if(T(A)||T(v))throw Error("slowDivide_ only works with positive integers.");for(var S=p,_=v;0>=_.l(A);)S=U(S),_=U(_);var E=V(S,1),C=V(_,1);for(_=V(_,2),S=V(S,2);!x(_);){var w=C.add(_);0>=w.l(A)&&(E=E.add(S),C=w),_=V(_,1),S=V(S,1)}return v=R(A,E.j(v)),new N(E,v)}for(E=f;0<=A.l(v);){for(S=Math.max(1,Math.floor(A.m()/v.m())),_=Math.ceil(Math.log(S)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),C=u(S),w=C.j(v);T(w)||0<w.l(A);)S-=_,C=u(S),w=C.j(v);x(C)&&(C=p),E=E.add(C),A=R(A,w)}return new N(E,A)}n.A=function(A){return k(this,A).h},n.and=function(A){for(var v=Math.max(this.g.length,A.g.length),S=[],_=0;_<v;_++)S[_]=this.i(_)&A.i(_);return new o(S,this.h&A.h)},n.or=function(A){for(var v=Math.max(this.g.length,A.g.length),S=[],_=0;_<v;_++)S[_]=this.i(_)|A.i(_);return new o(S,this.h|A.h)},n.xor=function(A){for(var v=Math.max(this.g.length,A.g.length),S=[],_=0;_<v;_++)S[_]=this.i(_)^A.i(_);return new o(S,this.h^A.h)};function U(A){for(var v=A.g.length+1,S=[],_=0;_<v;_++)S[_]=A.i(_)<<1|A.i(_-1)>>>31;return new o(S,A.h)}function V(A,v){var S=v>>5;v%=32;for(var _=A.g.length-S,E=[],C=0;C<_;C++)E[C]=0<v?A.i(C+S)>>>v|A.i(C+S+1)<<32-v:A.i(C+S);return new o(E,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,CR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Vi=o}).apply(typeof vT<"u"?vT:typeof self<"u"?self:typeof window<"u"?window:{});var $h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var RR,Yc,NR,gf,q_,PR,kR,DR;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,m,g){return c==Array.prototype||c==Object.prototype||(c[m]=g.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof $h=="object"&&$h];for(var m=0;m<c.length;++m){var g=c[m];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(c,m){if(m)e:{var g=r;c=c.split(".");for(var I=0;I<c.length-1;I++){var D=c[I];if(!(D in g))break e;g=g[D]}c=c[c.length-1],I=g[c],m=m(I),m!=I&&m!=null&&e(g,c,{configurable:!0,writable:!0,value:m})}}function i(c,m){c instanceof String&&(c+="");var g=0,I=!1,D={next:function(){if(!I&&g<c.length){var F=g++;return{value:m(F,c[F]),done:!1}}return I=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}s("Array.prototype.values",function(c){return c||function(){return i(this,function(m,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var m=typeof c;return m=m!="object"?m:c?Array.isArray(c)?"array":m:"null",m=="array"||m=="object"&&typeof c.length=="number"}function u(c){var m=typeof c;return m=="object"&&c!=null||m=="function"}function h(c,m,g){return c.call.apply(c.bind,arguments)}function f(c,m,g){if(!c)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var D=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(D,I),c.apply(m,D)}}return function(){return c.apply(m,arguments)}}function p(c,m,g){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function y(c,m){var g=Array.prototype.slice.call(arguments,1);return function(){var I=g.slice();return I.push.apply(I,arguments),c.apply(this,I)}}function x(c,m){function g(){}g.prototype=m.prototype,c.aa=m.prototype,c.prototype=new g,c.prototype.constructor=c,c.Qb=function(I,D,F){for(var J=Array(arguments.length-2),et=2;et<arguments.length;et++)J[et-2]=arguments[et];return m.prototype[D].apply(I,J)}}function T(c){const m=c.length;if(0<m){const g=Array(m);for(let I=0;I<m;I++)g[I]=c[I];return g}return[]}function P(c,m){for(let g=1;g<arguments.length;g++){const I=arguments[g];if(l(I)){const D=c.length||0,F=I.length||0;c.length=D+F;for(let J=0;J<F;J++)c[D+J]=I[J]}else c.push(I)}}class R{constructor(m,g){this.i=m,this.j=g,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function b(c){return/^[\s\xa0]*$/.test(c)}function N(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function k(c){return k[" "](c),c}k[" "]=function(){};var U=N().indexOf("Gecko")!=-1&&!(N().toLowerCase().indexOf("webkit")!=-1&&N().indexOf("Edge")==-1)&&!(N().indexOf("Trident")!=-1||N().indexOf("MSIE")!=-1)&&N().indexOf("Edge")==-1;function V(c,m,g){for(const I in c)m.call(g,c[I],I,c)}function A(c,m){for(const g in c)m.call(void 0,c[g],g,c)}function v(c){const m={};for(const g in c)m[g]=c[g];return m}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(c,m){let g,I;for(let D=1;D<arguments.length;D++){I=arguments[D];for(g in I)c[g]=I[g];for(let F=0;F<S.length;F++)g=S[F],Object.prototype.hasOwnProperty.call(I,g)&&(c[g]=I[g])}}function E(c){var m=1;c=c.split(":");const g=[];for(;0<m&&c.length;)g.push(c.shift()),m--;return c.length&&g.push(c.join(":")),g}function C(c){a.setTimeout(()=>{throw c},0)}function w(){var c=te;let m=null;return c.g&&(m=c.g,c.g=c.g.next,c.g||(c.h=null),m.next=null),m}class Z{constructor(){this.h=this.g=null}add(m,g){const I=de.get();I.set(m,g),this.h?this.h.next=I:this.g=I,this.h=I}}var de=new R(()=>new re,c=>c.reset());class re{constructor(){this.next=this.g=this.h=null}set(m,g){this.h=m,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Ve,z=!1,te=new Z,oe=()=>{const c=a.Promise.resolve(void 0);Ve=()=>{c.then(Ce)}};var Ce=()=>{for(var c;c=w();){try{c.h.call(c.g)}catch(g){C(g)}var m=de;m.j(c),100>m.h&&(m.h++,c.next=m.g,m.g=c)}z=!1};function fe(){this.s=this.s,this.C=this.C}fe.prototype.s=!1,fe.prototype.ma=function(){this.s||(this.s=!0,this.N())},fe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ue(c,m){this.type=c,this.g=this.target=m,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var Mt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,m=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const g=()=>{};a.addEventListener("test",g,m),a.removeEventListener("test",g,m)}catch{}return c}();function me(c,m){if(Ue.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var g=this.type=c.type,I=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=m,m=c.relatedTarget){if(U){e:{try{k(m.nodeName);var D=!0;break e}catch{}D=!1}D||(m=null)}}else g=="mouseover"?m=c.fromElement:g=="mouseout"&&(m=c.toElement);this.relatedTarget=m,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:We[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&me.aa.h.call(this)}}x(me,Ue);var We={2:"touch",3:"pen",4:"mouse"};me.prototype.h=function(){me.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ct="closure_listenable_"+(1e6*Math.random()|0),fc=0;function pc(c,m,g,I,D){this.listener=c,this.proxy=null,this.src=m,this.type=g,this.capture=!!I,this.ha=D,this.key=++fc,this.da=this.fa=!1}function Js(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function ys(c){this.src=c,this.g={},this.h=0}ys.prototype.add=function(c,m,g,I,D){var F=c.toString();c=this.g[F],c||(c=this.g[F]=[],this.h++);var J=Re(c,m,I,D);return-1<J?(m=c[J],g||(m.fa=!1)):(m=new pc(m,this.src,F,!!I,D),m.fa=g,c.push(m)),m};function we(c,m){var g=m.type;if(g in c.g){var I=c.g[g],D=Array.prototype.indexOf.call(I,m,void 0),F;(F=0<=D)&&Array.prototype.splice.call(I,D,1),F&&(Js(m),c.g[g].length==0&&(delete c.g[g],c.h--))}}function Re(c,m,g,I){for(var D=0;D<c.length;++D){var F=c[D];if(!F.da&&F.listener==m&&F.capture==!!g&&F.ha==I)return D}return-1}var lt="closure_lm_"+(1e6*Math.random()|0),pe={};function Ie(c,m,g,I,D){if(I&&I.once)return dn(c,m,g,I,D);if(Array.isArray(m)){for(var F=0;F<m.length;F++)Ie(c,m[F],g,I,D);return null}return g=Xs(g),c&&c[Ct]?c.K(m,g,u(I)?!!I.capture:!!I,D):Xe(c,m,g,!1,I,D)}function Xe(c,m,g,I,D,F){if(!m)throw Error("Invalid event type");var J=u(D)?!!D.capture:!!D,et=hn(c);if(et||(c[lt]=et=new ys(c)),g=et.add(m,g,I,J,F),g.proxy)return g;if(I=Xt(),g.proxy=I,I.src=c,I.listener=g,c.addEventListener)Mt||(D=J),D===void 0&&(D=!1),c.addEventListener(m.toString(),I,D);else if(c.attachEvent)c.attachEvent(Rt(m.toString()),I);else if(c.addListener&&c.removeListener)c.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Xt(){function c(g){return m.call(c.src,c.listener,g)}const m=Dn;return c}function dn(c,m,g,I,D){if(Array.isArray(m)){for(var F=0;F<m.length;F++)dn(c,m[F],g,I,D);return null}return g=Xs(g),c&&c[Ct]?c.L(m,g,u(I)?!!I.capture:!!I,D):Xe(c,m,g,!0,I,D)}function $n(c,m,g,I,D){if(Array.isArray(m))for(var F=0;F<m.length;F++)$n(c,m[F],g,I,D);else I=u(I)?!!I.capture:!!I,g=Xs(g),c&&c[Ct]?(c=c.i,m=String(m).toString(),m in c.g&&(F=c.g[m],g=Re(F,g,I,D),-1<g&&(Js(F[g]),Array.prototype.splice.call(F,g,1),F.length==0&&(delete c.g[m],c.h--)))):c&&(c=hn(c))&&(m=c.g[m.toString()],c=-1,m&&(c=Re(m,g,I,D)),(g=-1<c?m[c]:null)&&ct(g))}function ct(c){if(typeof c!="number"&&c&&!c.da){var m=c.src;if(m&&m[Ct])we(m.i,c);else{var g=c.type,I=c.proxy;m.removeEventListener?m.removeEventListener(g,I,c.capture):m.detachEvent?m.detachEvent(Rt(g),I):m.addListener&&m.removeListener&&m.removeListener(I),(g=hn(m))?(we(g,c),g.h==0&&(g.src=null,m[lt]=null)):Js(c)}}}function Rt(c){return c in pe?pe[c]:pe[c]="on"+c}function Dn(c,m){if(c.da)c=!0;else{m=new me(m,this);var g=c.listener,I=c.ha||c.src;c.fa&&ct(c),c=g.call(I,m)}return c}function hn(c){return c=c[lt],c instanceof ys?c:null}var uo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xs(c){return typeof c=="function"?c:(c[uo]||(c[uo]=function(m){return c.handleEvent(m)}),c[uo])}function Bt(){fe.call(this),this.i=new ys(this),this.M=this,this.F=null}x(Bt,fe),Bt.prototype[Ct]=!0,Bt.prototype.removeEventListener=function(c,m,g,I){$n(this,c,m,g,I)};function Lt(c,m){var g,I=c.F;if(I)for(g=[];I;I=I.F)g.push(I);if(c=c.M,I=m.type||m,typeof m=="string")m=new Ue(m,c);else if(m instanceof Ue)m.target=m.target||c;else{var D=m;m=new Ue(I,c),_(m,D)}if(D=!0,g)for(var F=g.length-1;0<=F;F--){var J=m.g=g[F];D=Zs(J,I,!0,m)&&D}if(J=m.g=c,D=Zs(J,I,!0,m)&&D,D=Zs(J,I,!1,m)&&D,g)for(F=0;F<g.length;F++)J=m.g=g[F],D=Zs(J,I,!1,m)&&D}Bt.prototype.N=function(){if(Bt.aa.N.call(this),this.i){var c=this.i,m;for(m in c.g){for(var g=c.g[m],I=0;I<g.length;I++)Js(g[I]);delete c.g[m],c.h--}}this.F=null},Bt.prototype.K=function(c,m,g,I){return this.i.add(String(c),m,!1,g,I)},Bt.prototype.L=function(c,m,g,I){return this.i.add(String(c),m,!0,g,I)};function Zs(c,m,g,I){if(m=c.i.g[String(m)],!m)return!0;m=m.concat();for(var D=!0,F=0;F<m.length;++F){var J=m[F];if(J&&!J.da&&J.capture==g){var et=J.listener,mn=J.ha||J.src;J.fa&&we(c.i,J),D=et.call(mn,I)!==!1&&D}}return D&&!I.defaultPrevented}function Sa(c,m,g){if(typeof c=="function")g&&(c=p(c,g));else if(c&&typeof c.handleEvent=="function")c=p(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(m)?-1:a.setTimeout(c,m||0)}function fn(c){c.g=Sa(()=>{c.g=null,c.i&&(c.i=!1,fn(c))},c.l);const m=c.h;c.h=null,c.m.apply(null,m)}class oh extends fe{constructor(m,g){super(),this.m=m,this.l=g,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:fn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ho(c){fe.call(this),this.h=c,this.g={}}x(ho,fe);var ah=[];function lh(c){V(c.g,function(m,g){this.g.hasOwnProperty(g)&&ct(m)},c),c.g={}}ho.prototype.N=function(){ho.aa.N.call(this),lh(this)},ho.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var mc=a.JSON.stringify,L=a.JSON.parse,H=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function K(){}K.prototype.h=null;function he(c){return c.h||(c.h=c.i())}function ye(){}var le={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ee(){Ue.call(this,"d")}x(Ee,Ue);function Se(){Ue.call(this,"c")}x(Se,Ue);var _e={},rt=null;function Vt(){return rt=rt||new Bt}_e.La="serverreachability";function ut(c){Ue.call(this,_e.La,c)}x(ut,Ue);function Oe(c){const m=Vt();Lt(m,new ut(m))}_e.STAT_EVENT="statevent";function $t(c,m){Ue.call(this,_e.STAT_EVENT,c),this.stat=m}x($t,Ue);function Le(c){const m=Vt();Lt(m,new $t(m,c))}_e.Ma="timingevent";function In(c,m){Ue.call(this,_e.Ma,c),this.size=m}x(In,Ue);function qe(c,m){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},m)}function Ne(){this.g=!0}Ne.prototype.xa=function(){this.g=!1};function On(c,m,g,I,D,F){c.info(function(){if(c.g)if(F)for(var J="",et=F.split("&"),mn=0;mn<et.length;mn++){var $e=et[mn].split("=");if(1<$e.length){var En=$e[0];$e=$e[1];var xn=En.split("_");J=2<=xn.length&&xn[1]=="type"?J+(En+"="+$e+"&"):J+(En+"=redacted&")}}else J=null;else J=F;return"XMLHTTP REQ ("+I+") [attempt "+D+"]: "+m+`
`+g+`
`+J})}function Qr(c,m,g,I,D,F,J){c.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+D+"]: "+m+`
`+g+`
`+F+" "+J})}function Fe(c,m,g,I){c.info(function(){return"XMLHTTP TEXT ("+m+"): "+pn(c,g)+(I?" "+I:"")})}function Nr(c,m){c.info(function(){return"TIMEOUT: "+m})}Ne.prototype.info=function(){};function pn(c,m){if(!c.g)return m;if(!m)return null;try{var g=JSON.parse(m);if(g){for(c=0;c<g.length;c++)if(Array.isArray(g[c])){var I=g[c];if(!(2>I.length)){var D=I[1];if(Array.isArray(D)&&!(1>D.length)){var F=D[0];if(F!="noop"&&F!="stop"&&F!="close")for(var J=1;J<D.length;J++)D[J]=""}}}}return mc(g)}catch{return m}}var ba={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ch={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},gc;function uh(){}x(uh,K),uh.prototype.g=function(){return new XMLHttpRequest},uh.prototype.i=function(){return{}},gc=new uh;function ei(c,m,g,I){this.j=c,this.i=m,this.l=g,this.R=I||1,this.U=new ho(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new MI}function MI(){this.i=null,this.g="",this.h=!1}var LI={},hg={};function fg(c,m,g){c.L=1,c.v=ph(_s(m)),c.m=g,c.P=!0,VI(c,null)}function VI(c,m){c.F=Date.now(),dh(c),c.A=_s(c.v);var g=c.A,I=c.R;Array.isArray(I)||(I=[String(I)]),JI(g.i,"t",I),c.C=0,g=c.j.J,c.h=new MI,c.g=mE(c.j,g?m:null,!c.m),0<c.O&&(c.M=new oh(p(c.Y,c,c.g),c.O)),m=c.U,g=c.g,I=c.ca;var D="readystatechange";Array.isArray(D)||(D&&(ah[0]=D.toString()),D=ah);for(var F=0;F<D.length;F++){var J=Ie(g,D[F],I||m.handleEvent,!1,m.h||m);if(!J)break;m.g[J.key]=J}m=c.H?v(c.H):{},c.m?(c.u||(c.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,m)):(c.u="GET",c.g.ea(c.A,c.u,null,m)),Oe(),On(c.i,c.u,c.A,c.l,c.R,c.m)}ei.prototype.ca=function(c){c=c.target;const m=this.M;m&&vs(c)==3?m.j():this.Y(c)},ei.prototype.Y=function(c){try{if(c==this.g)e:{const xn=vs(this.g);var m=this.g.Ba();const Ra=this.g.Z();if(!(3>xn)&&(xn!=3||this.g&&(this.h.h||this.g.oa()||sE(this.g)))){this.J||xn!=4||m==7||(m==8||0>=Ra?Oe(3):Oe(2)),pg(this);var g=this.g.Z();this.X=g;t:if(FI(this)){var I=sE(this.g);c="";var D=I.length,F=vs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fo(this),yc(this);var J="";break t}this.h.i=new a.TextDecoder}for(m=0;m<D;m++)this.h.h=!0,c+=this.h.i.decode(I[m],{stream:!(F&&m==D-1)});I.length=0,this.h.g+=c,this.C=0,J=this.h.g}else J=this.g.oa();if(this.o=g==200,Qr(this.i,this.u,this.A,this.l,this.R,xn,g),this.o){if(this.T&&!this.K){t:{if(this.g){var et,mn=this.g;if((et=mn.g?mn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!b(et)){var $e=et;break t}}$e=null}if(g=$e)Fe(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,mg(this,g);else{this.o=!1,this.s=3,Le(12),fo(this),yc(this);break e}}if(this.P){g=!0;let Pr;for(;!this.J&&this.C<J.length;)if(Pr=LD(this,J),Pr==hg){xn==4&&(this.s=4,Le(14),g=!1),Fe(this.i,this.l,null,"[Incomplete Response]");break}else if(Pr==LI){this.s=4,Le(15),Fe(this.i,this.l,J,"[Invalid Chunk]"),g=!1;break}else Fe(this.i,this.l,Pr,null),mg(this,Pr);if(FI(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),xn!=4||J.length!=0||this.h.h||(this.s=1,Le(16),g=!1),this.o=this.o&&g,!g)Fe(this.i,this.l,J,"[Invalid Chunked Response]"),fo(this),yc(this);else if(0<J.length&&!this.W){this.W=!0;var En=this.j;En.g==this&&En.ba&&!En.M&&(En.j.info("Great, no buffering proxy detected. Bytes received: "+J.length),Ig(En),En.M=!0,Le(11))}}else Fe(this.i,this.l,J,null),mg(this,J);xn==4&&fo(this),this.o&&!this.J&&(xn==4?dE(this.j,this):(this.o=!1,dh(this)))}else ZD(this.g),g==400&&0<J.indexOf("Unknown SID")?(this.s=3,Le(12)):(this.s=0,Le(13)),fo(this),yc(this)}}}catch{}finally{}};function FI(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function LD(c,m){var g=c.C,I=m.indexOf(`
`,g);return I==-1?hg:(g=Number(m.substring(g,I)),isNaN(g)?LI:(I+=1,I+g>m.length?hg:(m=m.slice(I,I+g),c.C=I+g,m)))}ei.prototype.cancel=function(){this.J=!0,fo(this)};function dh(c){c.S=Date.now()+c.I,jI(c,c.I)}function jI(c,m){if(c.B!=null)throw Error("WatchDog timer not null");c.B=qe(p(c.ba,c),m)}function pg(c){c.B&&(a.clearTimeout(c.B),c.B=null)}ei.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(Nr(this.i,this.A),this.L!=2&&(Oe(),Le(17)),fo(this),this.s=2,yc(this)):jI(this,this.S-c)};function yc(c){c.j.G==0||c.J||dE(c.j,c)}function fo(c){pg(c);var m=c.M;m&&typeof m.ma=="function"&&m.ma(),c.M=null,lh(c.U),c.g&&(m=c.g,c.g=null,m.abort(),m.ma())}function mg(c,m){try{var g=c.j;if(g.G!=0&&(g.g==c||gg(g.h,c))){if(!c.K&&gg(g.h,c)&&g.G==3){try{var I=g.Da.g.parse(m)}catch{I=null}if(Array.isArray(I)&&I.length==3){var D=I;if(D[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<c.F)wh(g),_h(g);else break e;wg(g),Le(18)}}else g.za=D[1],0<g.za-g.T&&37500>D[2]&&g.F&&g.v==0&&!g.C&&(g.C=qe(p(g.Za,g),6e3));if(1>=$I(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else mo(g,11)}else if((c.K||g.g==c)&&wh(g),!b(m))for(D=g.Da.g.parse(m),m=0;m<D.length;m++){let $e=D[m];if(g.T=$e[0],$e=$e[1],g.G==2)if($e[0]=="c"){g.K=$e[1],g.ia=$e[2];const En=$e[3];En!=null&&(g.la=En,g.j.info("VER="+g.la));const xn=$e[4];xn!=null&&(g.Aa=xn,g.j.info("SVER="+g.Aa));const Ra=$e[5];Ra!=null&&typeof Ra=="number"&&0<Ra&&(I=1.5*Ra,g.L=I,g.j.info("backChannelRequestTimeoutMs_="+I)),I=g;const Pr=c.g;if(Pr){const Eh=Pr.g?Pr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Eh){var F=I.h;F.g||Eh.indexOf("spdy")==-1&&Eh.indexOf("quic")==-1&&Eh.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(yg(F,F.h),F.h=null))}if(I.D){const Eg=Pr.g?Pr.g.getResponseHeader("X-HTTP-Session-Id"):null;Eg&&(I.ya=Eg,dt(I.I,I.D,Eg))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-c.F,g.j.info("Handshake RTT: "+g.R+"ms")),I=g;var J=c;if(I.qa=pE(I,I.J?I.ia:null,I.W),J.K){zI(I.h,J);var et=J,mn=I.L;mn&&(et.I=mn),et.B&&(pg(et),dh(et)),I.g=J}else cE(I);0<g.i.length&&vh(g)}else $e[0]!="stop"&&$e[0]!="close"||mo(g,7);else g.G==3&&($e[0]=="stop"||$e[0]=="close"?$e[0]=="stop"?mo(g,7):vg(g):$e[0]!="noop"&&g.l&&g.l.ta($e),g.v=0)}}Oe(4)}catch{}}var VD=class{constructor(c,m){this.g=c,this.map=m}};function UI(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function BI(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function $I(c){return c.h?1:c.g?c.g.size:0}function gg(c,m){return c.h?c.h==m:c.g?c.g.has(m):!1}function yg(c,m){c.g?c.g.add(m):c.h=m}function zI(c,m){c.h&&c.h==m?c.h=null:c.g&&c.g.has(m)&&c.g.delete(m)}UI.prototype.cancel=function(){if(this.i=qI(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function qI(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let m=c.i;for(const g of c.g.values())m=m.concat(g.D);return m}return T(c.i)}function FD(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var m=[],g=c.length,I=0;I<g;I++)m.push(c[I]);return m}m=[],g=0;for(I in c)m[g++]=c[I];return m}function jD(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var m=[];c=c.length;for(var g=0;g<c;g++)m.push(g);return m}m=[],g=0;for(const I in c)m[g++]=I;return m}}}function WI(c,m){if(c.forEach&&typeof c.forEach=="function")c.forEach(m,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,m,void 0);else for(var g=jD(c),I=FD(c),D=I.length,F=0;F<D;F++)m.call(void 0,I[F],g&&g[F],c)}var GI=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function UD(c,m){if(c){c=c.split("&");for(var g=0;g<c.length;g++){var I=c[g].indexOf("="),D=null;if(0<=I){var F=c[g].substring(0,I);D=c[g].substring(I+1)}else F=c[g];m(F,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function po(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof po){this.h=c.h,hh(this,c.j),this.o=c.o,this.g=c.g,fh(this,c.s),this.l=c.l;var m=c.i,g=new wc;g.i=m.i,m.g&&(g.g=new Map(m.g),g.h=m.h),HI(this,g),this.m=c.m}else c&&(m=String(c).match(GI))?(this.h=!1,hh(this,m[1]||"",!0),this.o=_c(m[2]||""),this.g=_c(m[3]||"",!0),fh(this,m[4]),this.l=_c(m[5]||"",!0),HI(this,m[6]||"",!0),this.m=_c(m[7]||"")):(this.h=!1,this.i=new wc(null,this.h))}po.prototype.toString=function(){var c=[],m=this.j;m&&c.push(vc(m,KI,!0),":");var g=this.g;return(g||m=="file")&&(c.push("//"),(m=this.o)&&c.push(vc(m,KI,!0),"@"),c.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&c.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&c.push("/"),c.push(vc(g,g.charAt(0)=="/"?zD:$D,!0))),(g=this.i.toString())&&c.push("?",g),(g=this.m)&&c.push("#",vc(g,WD)),c.join("")};function _s(c){return new po(c)}function hh(c,m,g){c.j=g?_c(m,!0):m,c.j&&(c.j=c.j.replace(/:$/,""))}function fh(c,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);c.s=m}else c.s=null}function HI(c,m,g){m instanceof wc?(c.i=m,GD(c.i,c.h)):(g||(m=vc(m,qD)),c.i=new wc(m,c.h))}function dt(c,m,g){c.i.set(m,g)}function ph(c){return dt(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function _c(c,m){return c?m?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function vc(c,m,g){return typeof c=="string"?(c=encodeURI(c).replace(m,BD),g&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function BD(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var KI=/[#\/\?@]/g,$D=/[#\?:]/g,zD=/[#\?]/g,qD=/[#\?@]/g,WD=/#/g;function wc(c,m){this.h=this.g=null,this.i=c||null,this.j=!!m}function ti(c){c.g||(c.g=new Map,c.h=0,c.i&&UD(c.i,function(m,g){c.add(decodeURIComponent(m.replace(/\+/g," ")),g)}))}n=wc.prototype,n.add=function(c,m){ti(this),this.i=null,c=Aa(this,c);var g=this.g.get(c);return g||this.g.set(c,g=[]),g.push(m),this.h+=1,this};function QI(c,m){ti(c),m=Aa(c,m),c.g.has(m)&&(c.i=null,c.h-=c.g.get(m).length,c.g.delete(m))}function YI(c,m){return ti(c),m=Aa(c,m),c.g.has(m)}n.forEach=function(c,m){ti(this),this.g.forEach(function(g,I){g.forEach(function(D){c.call(m,D,I,this)},this)},this)},n.na=function(){ti(this);const c=Array.from(this.g.values()),m=Array.from(this.g.keys()),g=[];for(let I=0;I<m.length;I++){const D=c[I];for(let F=0;F<D.length;F++)g.push(m[I])}return g},n.V=function(c){ti(this);let m=[];if(typeof c=="string")YI(this,c)&&(m=m.concat(this.g.get(Aa(this,c))));else{c=Array.from(this.g.values());for(let g=0;g<c.length;g++)m=m.concat(c[g])}return m},n.set=function(c,m){return ti(this),this.i=null,c=Aa(this,c),YI(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[m]),this.h+=1,this},n.get=function(c,m){return c?(c=this.V(c),0<c.length?String(c[0]):m):m};function JI(c,m,g){QI(c,m),0<g.length&&(c.i=null,c.g.set(Aa(c,m),T(g)),c.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],m=Array.from(this.g.keys());for(var g=0;g<m.length;g++){var I=m[g];const F=encodeURIComponent(String(I)),J=this.V(I);for(I=0;I<J.length;I++){var D=F;J[I]!==""&&(D+="="+encodeURIComponent(String(J[I]))),c.push(D)}}return this.i=c.join("&")};function Aa(c,m){return m=String(m),c.j&&(m=m.toLowerCase()),m}function GD(c,m){m&&!c.j&&(ti(c),c.i=null,c.g.forEach(function(g,I){var D=I.toLowerCase();I!=D&&(QI(this,I),JI(this,D,g))},c)),c.j=m}function HD(c,m){const g=new Ne;if(a.Image){const I=new Image;I.onload=y(ni,g,"TestLoadImage: loaded",!0,m,I),I.onerror=y(ni,g,"TestLoadImage: error",!1,m,I),I.onabort=y(ni,g,"TestLoadImage: abort",!1,m,I),I.ontimeout=y(ni,g,"TestLoadImage: timeout",!1,m,I),a.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=c}else m(!1)}function KD(c,m){const g=new Ne,I=new AbortController,D=setTimeout(()=>{I.abort(),ni(g,"TestPingServer: timeout",!1,m)},1e4);fetch(c,{signal:I.signal}).then(F=>{clearTimeout(D),F.ok?ni(g,"TestPingServer: ok",!0,m):ni(g,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(D),ni(g,"TestPingServer: error",!1,m)})}function ni(c,m,g,I,D){try{D&&(D.onload=null,D.onerror=null,D.onabort=null,D.ontimeout=null),I(g)}catch{}}function QD(){this.g=new H}function YD(c,m,g){const I=g||"";try{WI(c,function(D,F){let J=D;u(D)&&(J=mc(D)),m.push(I+F+"="+encodeURIComponent(J))})}catch(D){throw m.push(I+"type="+encodeURIComponent("_badmap")),D}}function mh(c){this.l=c.Ub||null,this.j=c.eb||!1}x(mh,K),mh.prototype.g=function(){return new gh(this.l,this.j)},mh.prototype.i=function(c){return function(){return c}}({});function gh(c,m){Bt.call(this),this.D=c,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(gh,Bt),n=gh.prototype,n.open=function(c,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=m,this.readyState=1,Ec(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(m.body=c),(this.D||a).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ic(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Ec(this)),this.g&&(this.readyState=3,Ec(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;XI(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function XI(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var m=c.value?c.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!c.done}))&&(this.response=this.responseText+=m)}c.done?Ic(this):Ec(this),this.readyState==3&&XI(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,Ic(this))},n.Qa=function(c){this.g&&(this.response=c,Ic(this))},n.ga=function(){this.g&&Ic(this)};function Ic(c){c.readyState=4,c.l=null,c.j=null,c.v=null,Ec(c)}n.setRequestHeader=function(c,m){this.u.append(c,m)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],m=this.h.entries();for(var g=m.next();!g.done;)g=g.value,c.push(g[0]+": "+g[1]),g=m.next();return c.join(`\r
`)};function Ec(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(gh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function ZI(c){let m="";return V(c,function(g,I){m+=I,m+=":",m+=g,m+=`\r
`}),m}function _g(c,m,g){e:{for(I in g){var I=!1;break e}I=!0}I||(g=ZI(g),typeof c=="string"?g!=null&&encodeURIComponent(String(g)):dt(c,m,g))}function Nt(c){Bt.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Nt,Bt);var JD=/^https?$/i,XD=["POST","PUT"];n=Nt.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,m,g,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);m=m?m.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gc.g(),this.v=this.o?he(this.o):he(gc),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(m,String(c),!0),this.B=!1}catch(F){eE(this,F);return}if(c=g||"",g=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var D in I)g.set(D,I[D]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(const F of I.keys())g.set(F,I.get(F));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(g.keys()).find(F=>F.toLowerCase()=="content-type"),D=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(XD,m,void 0))||I||D||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,J]of g)this.g.setRequestHeader(F,J);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{rE(this),this.u=!0,this.g.send(c),this.u=!1}catch(F){eE(this,F)}};function eE(c,m){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=m,c.m=5,tE(c),yh(c)}function tE(c){c.A||(c.A=!0,Lt(c,"complete"),Lt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Lt(this,"complete"),Lt(this,"abort"),yh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),yh(this,!0)),Nt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?nE(this):this.bb())},n.bb=function(){nE(this)};function nE(c){if(c.h&&typeof o<"u"&&(!c.v[1]||vs(c)!=4||c.Z()!=2)){if(c.u&&vs(c)==4)Sa(c.Ea,0,c);else if(Lt(c,"readystatechange"),vs(c)==4){c.h=!1;try{const J=c.Z();e:switch(J){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var g;if(!(g=m)){var I;if(I=J===0){var D=String(c.D).match(GI)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),I=!JD.test(D?D.toLowerCase():"")}g=I}if(g)Lt(c,"complete"),Lt(c,"success");else{c.m=6;try{var F=2<vs(c)?c.g.statusText:""}catch{F=""}c.l=F+" ["+c.Z()+"]",tE(c)}}finally{yh(c)}}}}function yh(c,m){if(c.g){rE(c);const g=c.g,I=c.v[0]?()=>{}:null;c.g=null,c.v=null,m||Lt(c,"ready");try{g.onreadystatechange=I}catch{}}}function rE(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function vs(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<vs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var m=this.g.responseText;return c&&m.indexOf(c)==0&&(m=m.substring(c.length)),L(m)}};function sE(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function ZD(c){const m={};c=(c.g&&2<=vs(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<c.length;I++){if(b(c[I]))continue;var g=E(c[I]);const D=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const F=m[D]||[];m[D]=F,F.push(g)}A(m,function(I){return I.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function xc(c,m,g){return g&&g.internalChannelParams&&g.internalChannelParams[c]||m}function iE(c){this.Aa=0,this.i=[],this.j=new Ne,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=xc("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=xc("baseRetryDelayMs",5e3,c),this.cb=xc("retryDelaySeedMs",1e4,c),this.Wa=xc("forwardChannelMaxRetries",2,c),this.wa=xc("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new UI(c&&c.concurrentRequestLimit),this.Da=new QD,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=iE.prototype,n.la=8,n.G=1,n.connect=function(c,m,g,I){Le(0),this.W=c,this.H=m||{},g&&I!==void 0&&(this.H.OSID=g,this.H.OAID=I),this.F=this.X,this.I=pE(this,null,this.W),vh(this)};function vg(c){if(oE(c),c.G==3){var m=c.U++,g=_s(c.I);if(dt(g,"SID",c.K),dt(g,"RID",m),dt(g,"TYPE","terminate"),Tc(c,g),m=new ei(c,c.j,m),m.L=2,m.v=ph(_s(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(m.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=m.v,g=!0),g||(m.g=mE(m.j,null),m.g.ea(m.v)),m.F=Date.now(),dh(m)}fE(c)}function _h(c){c.g&&(Ig(c),c.g.cancel(),c.g=null)}function oE(c){_h(c),c.u&&(a.clearTimeout(c.u),c.u=null),wh(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function vh(c){if(!BI(c.h)&&!c.s){c.s=!0;var m=c.Ga;Ve||oe(),z||(Ve(),z=!0),te.add(m,c),c.B=0}}function e2(c,m){return $I(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=m.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=qe(p(c.Ga,c,m),hE(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const D=new ei(this,this.j,c);let F=this.o;if(this.S&&(F?(F=v(F),_(F,this.S)):F=this.S),this.m!==null||this.O||(D.H=F,F=null),this.P)e:{for(var m=0,g=0;g<this.i.length;g++){t:{var I=this.i[g];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(m+=I,4096<m){m=g;break e}if(m===4096||g===this.i.length-1){m=g+1;break e}}m=1e3}else m=1e3;m=lE(this,D,m),g=_s(this.I),dt(g,"RID",c),dt(g,"CVER",22),this.D&&dt(g,"X-HTTP-Session-Id",this.D),Tc(this,g),F&&(this.O?m="headers="+encodeURIComponent(String(ZI(F)))+"&"+m:this.m&&_g(g,this.m,F)),yg(this.h,D),this.Ua&&dt(g,"TYPE","init"),this.P?(dt(g,"$req",m),dt(g,"SID","null"),D.T=!0,fg(D,g,null)):fg(D,g,m),this.G=2}}else this.G==3&&(c?aE(this,c):this.i.length==0||BI(this.h)||aE(this))};function aE(c,m){var g;m?g=m.l:g=c.U++;const I=_s(c.I);dt(I,"SID",c.K),dt(I,"RID",g),dt(I,"AID",c.T),Tc(c,I),c.m&&c.o&&_g(I,c.m,c.o),g=new ei(c,c.j,g,c.B+1),c.m===null&&(g.H=c.o),m&&(c.i=m.D.concat(c.i)),m=lE(c,g,1e3),g.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),yg(c.h,g),fg(g,I,m)}function Tc(c,m){c.H&&V(c.H,function(g,I){dt(m,I,g)}),c.l&&WI({},function(g,I){dt(m,I,g)})}function lE(c,m,g){g=Math.min(c.i.length,g);var I=c.l?p(c.l.Na,c.l,c):null;e:{var D=c.i;let F=-1;for(;;){const J=["count="+g];F==-1?0<g?(F=D[0].g,J.push("ofs="+F)):F=0:J.push("ofs="+F);let et=!0;for(let mn=0;mn<g;mn++){let $e=D[mn].g;const En=D[mn].map;if($e-=F,0>$e)F=Math.max(0,D[mn].g-100),et=!1;else try{YD(En,J,"req"+$e+"_")}catch{I&&I(En)}}if(et){I=J.join("&");break e}}}return c=c.i.splice(0,g),m.D=c,I}function cE(c){if(!c.g&&!c.u){c.Y=1;var m=c.Fa;Ve||oe(),z||(Ve(),z=!0),te.add(m,c),c.v=0}}function wg(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=qe(p(c.Fa,c),hE(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,uE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=qe(p(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Le(10),_h(this),uE(this))};function Ig(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function uE(c){c.g=new ei(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var m=_s(c.qa);dt(m,"RID","rpc"),dt(m,"SID",c.K),dt(m,"AID",c.T),dt(m,"CI",c.F?"0":"1"),!c.F&&c.ja&&dt(m,"TO",c.ja),dt(m,"TYPE","xmlhttp"),Tc(c,m),c.m&&c.o&&_g(m,c.m,c.o),c.L&&(c.g.I=c.L);var g=c.g;c=c.ia,g.L=1,g.v=ph(_s(m)),g.m=null,g.P=!0,VI(g,c)}n.Za=function(){this.C!=null&&(this.C=null,_h(this),wg(this),Le(19))};function wh(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function dE(c,m){var g=null;if(c.g==m){wh(c),Ig(c),c.g=null;var I=2}else if(gg(c.h,m))g=m.D,zI(c.h,m),I=1;else return;if(c.G!=0){if(m.o)if(I==1){g=m.m?m.m.length:0,m=Date.now()-m.F;var D=c.B;I=Vt(),Lt(I,new In(I,g)),vh(c)}else cE(c);else if(D=m.s,D==3||D==0&&0<m.X||!(I==1&&e2(c,m)||I==2&&wg(c)))switch(g&&0<g.length&&(m=c.h,m.i=m.i.concat(g)),D){case 1:mo(c,5);break;case 4:mo(c,10);break;case 3:mo(c,6);break;default:mo(c,2)}}}function hE(c,m){let g=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(g*=2),g*m}function mo(c,m){if(c.j.info("Error code "+m),m==2){var g=p(c.fb,c),I=c.Xa;const D=!I;I=new po(I||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||hh(I,"https"),ph(I),D?HD(I.toString(),g):KD(I.toString(),g)}else Le(2);c.G=0,c.l&&c.l.sa(m),fE(c),oE(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),Le(2)):(this.j.info("Failed to ping google.com"),Le(1))};function fE(c){if(c.G=0,c.ka=[],c.l){const m=qI(c.h);(m.length!=0||c.i.length!=0)&&(P(c.ka,m),P(c.ka,c.i),c.h.i.length=0,T(c.i),c.i.length=0),c.l.ra()}}function pE(c,m,g){var I=g instanceof po?_s(g):new po(g);if(I.g!="")m&&(I.g=m+"."+I.g),fh(I,I.s);else{var D=a.location;I=D.protocol,m=m?m+"."+D.hostname:D.hostname,D=+D.port;var F=new po(null);I&&hh(F,I),m&&(F.g=m),D&&fh(F,D),g&&(F.l=g),I=F}return g=c.D,m=c.ya,g&&m&&dt(I,g,m),dt(I,"VER",c.la),Tc(c,I),I}function mE(c,m,g){if(m&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return m=c.Ca&&!c.pa?new Nt(new mh({eb:g})):new Nt(c.pa),m.Ha(c.J),m}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function gE(){}n=gE.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ih(){}Ih.prototype.g=function(c,m){return new tr(c,m)};function tr(c,m){Bt.call(this),this.g=new iE(m),this.l=c,this.h=m&&m.messageUrlParams||null,c=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(c?c["X-WebChannel-Content-Type"]=m.messageContentType:c={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(c?c["X-WebChannel-Client-Profile"]=m.va:c={"X-WebChannel-Client-Profile":m.va}),this.g.S=c,(c=m&&m.Sb)&&!b(c)&&(this.g.m=c),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!b(m)&&(this.g.D=m,c=this.h,c!==null&&m in c&&(c=this.h,m in c&&delete c[m])),this.j=new Ca(this)}x(tr,Bt),tr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},tr.prototype.close=function(){vg(this.g)},tr.prototype.o=function(c){var m=this.g;if(typeof c=="string"){var g={};g.__data__=c,c=g}else this.u&&(g={},g.__data__=mc(c),c=g);m.i.push(new VD(m.Ya++,c)),m.G==3&&vh(m)},tr.prototype.N=function(){this.g.l=null,delete this.j,vg(this.g),delete this.g,tr.aa.N.call(this)};function yE(c){Ee.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var m=c.__sm__;if(m){e:{for(const g in m){c=g;break e}c=void 0}(this.i=c)&&(c=this.i,m=m!==null&&c in m?m[c]:void 0),this.data=m}else this.data=c}x(yE,Ee);function _E(){Se.call(this),this.status=1}x(_E,Se);function Ca(c){this.g=c}x(Ca,gE),Ca.prototype.ua=function(){Lt(this.g,"a")},Ca.prototype.ta=function(c){Lt(this.g,new yE(c))},Ca.prototype.sa=function(c){Lt(this.g,new _E)},Ca.prototype.ra=function(){Lt(this.g,"b")},Ih.prototype.createWebChannel=Ih.prototype.g,tr.prototype.send=tr.prototype.o,tr.prototype.open=tr.prototype.m,tr.prototype.close=tr.prototype.close,DR=function(){return new Ih},kR=function(){return Vt()},PR=_e,q_={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ba.NO_ERROR=0,ba.TIMEOUT=8,ba.HTTP_ERROR=6,gf=ba,ch.COMPLETE="complete",NR=ch,ye.EventType=le,le.OPEN="a",le.CLOSE="b",le.ERROR="c",le.MESSAGE="d",Bt.prototype.listen=Bt.prototype.K,Yc=ye,Nt.prototype.listenOnce=Nt.prototype.L,Nt.prototype.getLastError=Nt.prototype.Ka,Nt.prototype.getLastErrorCode=Nt.prototype.Ba,Nt.prototype.getStatus=Nt.prototype.Z,Nt.prototype.getResponseJson=Nt.prototype.Oa,Nt.prototype.getResponseText=Nt.prototype.oa,Nt.prototype.send=Nt.prototype.ea,Nt.prototype.setWithCredentials=Nt.prototype.Ha,RR=Nt}).apply(typeof $h<"u"?$h:typeof self<"u"?self:typeof window<"u"?window:{});const wT="@firebase/firestore",IT="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};rn.UNAUTHENTICATED=new rn(null),rn.GOOGLE_CREDENTIALS=new rn("google-credentials-uid"),rn.FIRST_PARTY=new rn("first-party-uid"),rn.MOCK_USER=new rn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=new Cd("@firebase/firestore");function Fa(){return Hi.logLevel}function t8(n){Hi.setLogLevel(n)}function $(n,...e){if(Hi.logLevel<=Pe.DEBUG){const t=e.map(rw);Hi.debug(`Firestore (${tc}): ${n}`,...t)}}function jt(n,...e){if(Hi.logLevel<=Pe.ERROR){const t=e.map(rw);Hi.error(`Firestore (${tc}): ${n}`,...t)}}function Cr(n,...e){if(Hi.logLevel<=Pe.WARN){const t=e.map(rw);Hi.warn(`Firestore (${tc}): ${n}`,...t)}}function rw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,OR(n,r,t)}function OR(n,e,t){let r=`FIRESTORE (${tc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw jt(r),new Error(r)}function ie(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||OR(e,s,r)}function n8(n,e){n||ee(57014,e)}function Y(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends Wr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class R4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rn.UNAUTHENTICATED))}shutdown(){}}class N4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class P4{constructor(e){this.t=e,this.currentUser=rn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ie(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new an;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new an,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{$("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):($("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new an)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?($("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ie(typeof r.accessToken=="string",31837,{l:r}),new MR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ie(e===null||typeof e=="string",2055,{h:e}),new rn(e)}}class k4{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=rn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class D4{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new k4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(rn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class W_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class O4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ie(this.o===void 0,3512);const r=i=>{i.error!=null&&$("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,$("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{$("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):$("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new W_(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ie(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new W_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class r8{getToken(){return Promise.resolve(new W_(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=M4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function ue(n,e){return n<e?-1:n>e?1:0}function G_(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return ay(s)===ay(i)?ue(s,i):ay(s)?1:-1}return ue(n.length,e.length)}const L4=55296,V4=57343;function ay(n){const e=n.charCodeAt(0);return e>=L4&&e<=V4}function Al(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function LR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H_="__name__";class Xr{constructor(e,t,r){t===void 0?t=0:t>e.length&&ee(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ee(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Xr.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Xr.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return ue(e.length,t.length)}static compareSegments(e,t){const r=Xr.isNumericId(e),s=Xr.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Xr.extractNumericId(e).compare(Xr.extractNumericId(t)):G_(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vi.fromString(e.substring(4,e.length-2))}}class Ae extends Xr{construct(e,t,r){return new Ae(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ae(t)}static emptyPath(){return new Ae([])}}const F4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class It extends Xr{construct(e,t,r){return new It(e,t,r)}static isValidIdentifier(e){return F4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),It.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===H_}static keyField(){return new It([H_])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new B(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new B(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new B(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new It(t)}static emptyPath(){return new It([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(e){this.path=e}static fromPath(e){return new Q(Ae.fromString(e))}static fromName(e){return new Q(Ae.fromString(e).popFirst(5))}static empty(){return new Q(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Q(new Ae(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iw(n,e,t){if(!t)throw new B(M.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function j4(n,e,t,r){if(e===!0&&r===!0)throw new B(M.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ET(n){if(!Q.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function xT(n){if(Q.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function VR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Am(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ee(12329,{type:typeof n})}function ke(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Am(n);throw new B(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function FR(n,e){if(e<=0)throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gt(n,e){const t={typeString:n};return e&&(t.value=e),t}function ya(n,e){if(!VR(n))throw new B(M.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new B(M.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TT=-62135596800,ST=1e6;class Ke{static now(){return Ke.fromMillis(Date.now())}static fromDate(e){return Ke.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ST);return new Ke(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<TT)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ST}_compareTo(e){return this.seconds===e.seconds?ue(this.nanoseconds,e.nanoseconds):ue(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ke._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ya(e,Ke._jsonSchema))return new Ke(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-TT;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ke._jsonSchemaVersion="firestore/timestamp/1.0",Ke._jsonSchema={type:Gt("string",Ke._jsonSchemaVersion),seconds:Gt("number"),nanoseconds:Gt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{static fromTimestamp(e){return new ae(e)}static min(){return new ae(new Ke(0,0))}static max(){return new ae(new Ke(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl=-1;class Rl{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function K_(n){return n.fields.find(e=>e.kind===2)}function Io(n){return n.fields.filter(e=>e.kind!==2)}function U4(n,e){let t=ue(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=B4(n.fields[r],e.fields[r]),t!==0)return t;return ue(n.fields.length,e.fields.length)}Rl.UNKNOWN_ID=-1;class Vo{constructor(e,t){this.fieldPath=e,this.kind=t}}function B4(n,e){const t=It.comparator(n.fieldPath,e.fieldPath);return t!==0?t:ue(n.kind,e.kind)}class Nl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Nl(0,mr.min())}}function jR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ae.fromTimestamp(r===1e9?new Ke(t+1,0):new Ke(t,r));return new mr(s,Q.empty(),e)}function UR(n){return new mr(n.readTime,n.key,Cl)}class mr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new mr(ae.min(),Q.empty(),Cl)}static max(){return new mr(ae.max(),Q.empty(),Cl)}}function ow(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Q.comparator(n.documentKey,e.documentKey),t!==0?t:ue(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class $R{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function so(n){if(n.code!==M.FAILED_PRECONDITION||n.message!==BR)throw n;$("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ee(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sr="SimpleDb";class Cm{static open(e,t,r,s){try{return new Cm(t,e.transaction(s,r))}catch(i){throw new gu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new an,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new gu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=aw(r.target.error);this.S.reject(new gu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||($(sr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new z4(t)}}class cs{static delete(e){return $(sr,"Removing database:",e),xo($A().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!am())return!1;if(cs.F())return!0;const e=Yt(),t=cs.M(e),r=0<t&&t<10,s=zR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,cs.M(Yt())===12.2&&jt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||($(sr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new gu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new B(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new B(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new gu(e,o))},s.onupgradeneeded=i=>{$(sr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{$(sr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Cm.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),O.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if($(sr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function zR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class $4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return xo(this.U.delete())}}class gu extends B{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function io(n){return n.name==="IndexedDbTransactionError"}class z4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?($(sr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):($(sr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),xo(r)}add(e){return $(sr,"ADD",this.store.name,e,e),xo(this.store.add(e))}get(e){return xo(this.store.get(e)).next(t=>(t===void 0&&(t=null),$(sr,"GET",this.store.name,e,t),t))}delete(e){return $(sr,"DELETE",this.store.name,e),xo(this.store.delete(e))}count(){return $(sr,"COUNT",this.store.name),xo(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){$(sr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const o=aw(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new O((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new $4(a),u=t(a.primaryKey,a.value,l);if(u instanceof O){const h=u.catch(f=>(l.done(),O.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function xo(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=aw(r.target.error);t(s)}})}let bT=!1;function aw(n){const e=cs.M(Yt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return bT||(bT=!0,setTimeout(()=>{throw r},0)),r}}return n}const yu="IndexBackfiller";class q4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){$(yu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();$(yu,`Documents written: ${t}`)}catch(t){io(t)?$(yu,"Ignoring IndexedDB error during index backfill: ",t):await so(t)}await this.re(6e4)})}}class W4{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return $(yu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>($(yu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=UR(i);ow(o,r)>0&&(r=o)}),new mr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Wn.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fi=-1;function Ud(n){return n==null}function rd(n){return n===0&&1/n==-1/0}function qR(n){return typeof n=="number"&&Number.isInteger(n)&&!rd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip="";function Nn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=AT(e)),e=G4(n.get(t),e);return AT(e)}function G4(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Ip:t+="";break;default:t+=i}}return t}function AT(n){return n+Ip+""}function rs(n){const e=n.length;if(ie(e>=2,64408,{path:n}),e===2)return ie(n.charAt(0)===Ip&&n.charAt(1)==="",56145,{path:n}),Ae.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Ip,i);switch((o<0||o>t)&&ee(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ee(61167,{path:n})}i=o+2}return new Ae(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eo="remoteDocuments",Bd="owner",ka="owner",sd="mutationQueues",H4="userId",Mr="mutations",CT="batchId",Po="userMutationsIndex",RT=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yf(n,e){return[n,Nn(e)]}function WR(n,e,t){return[n,Nn(e),t]}const K4={},Pl="documentMutations",Ep="remoteDocumentsV14",Q4=["prefixPath","collectionGroup","readTime","documentId"],_f="documentKeyIndex",Y4=["prefixPath","collectionGroup","documentId"],GR="collectionGroupIndex",J4=["collectionGroup","readTime","prefixPath","documentId"],id="remoteDocumentGlobal",Q_="remoteDocumentGlobalKey",kl="targets",HR="queryTargetsIndex",X4=["canonicalId","targetId"],Dl="targetDocuments",Z4=["targetId","path"],lw="documentTargetsIndex",e3=["path","targetId"],xp="targetGlobalKey",Fo="targetGlobal",od="collectionParents",t3=["collectionId","parent"],Ol="clientMetadata",n3="clientId",Rm="bundles",r3="bundleId",Nm="namedQueries",s3="name",cw="indexConfiguration",i3="indexId",Y_="collectionGroupIndex",o3="collectionGroup",_u="indexState",a3=["indexId","uid"],KR="sequenceNumberIndex",l3=["uid","sequenceNumber"],vu="indexEntries",c3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],QR="documentKeyIndex",u3=["indexId","uid","orderedDocumentKey"],Pm="documentOverlays",d3=["userId","collectionPath","documentId"],J_="collectionPathOverlayIndex",h3=["userId","collectionPath","largestBatchId"],YR="collectionGroupOverlayIndex",f3=["userId","collectionGroup","largestBatchId"],uw="globals",p3="name",JR=[sd,Mr,Pl,Eo,kl,Bd,Fo,Dl,Ol,id,od,Rm,Nm],m3=[...JR,Pm],XR=[sd,Mr,Pl,Ep,kl,Bd,Fo,Dl,Ol,id,od,Rm,Nm,Pm],ZR=XR,dw=[...ZR,cw,_u,vu],g3=dw,eN=[...dw,uw],y3=eN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_ extends $R{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Jt(n,e){const t=Y(n);return cs.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NT(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function oo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function tN(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function nN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e,t){this.comparator=e,this.root=t||yn.EMPTY}insert(e,t){return new at(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,yn.BLACK,null,null))}remove(e){return new at(this.comparator,this.root.remove(e,this.comparator).copy(null,null,yn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zh(this.root,e,this.comparator,!1)}getReverseIterator(){return new zh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zh(this.root,e,this.comparator,!0)}}class zh{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class yn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??yn.RED,this.left=s??yn.EMPTY,this.right=i??yn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new yn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return yn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return yn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,yn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,yn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ee(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ee(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ee(27949);return e+(this.isRed()?0:1)}}yn.EMPTY=null,yn.RED=!0,yn.BLACK=!1;yn.EMPTY=new class{constructor(){this.size=0}get key(){throw ee(57766)}get value(){throw ee(16141)}get color(){throw ee(16727)}get left(){throw ee(29726)}get right(){throw ee(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new yn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Je{constructor(e){this.comparator=e,this.data=new at(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new PT(this.data.getIterator())}getIteratorFrom(e){return new PT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Je)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Je(this.comparator);return t.data=e,t}}class PT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Da(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e){this.fields=e,e.sort(It.comparator)}static empty(){return new Gn([])}unionWith(e){let t=new Je(It.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Gn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Al(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i8(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new rN("Invalid base64 string: "+i):i}}(e);return new Dt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Dt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ue(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Dt.EMPTY_BYTE_STRING=new Dt("");const _3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fs(n){if(ie(!!n,39018),typeof n=="string"){let e=0;const t=_3.exec(n);if(ie(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:yt(n.seconds),nanos:yt(n.nanos)}}function yt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function js(n){return typeof n=="string"?Dt.fromBase64String(n):Dt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sN="server_timestamp",iN="__type__",oN="__previous_value__",aN="__local_write_time__";function km(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[iN])==null?void 0:r.stringValue)===sN}function Dm(n){const e=n.mapValue.fields[oN];return km(e)?Dm(e):e}function ad(n){const e=Fs(n.mapValue.fields[aN].timestampValue);return new Ke(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const ld="(default)";class Jo{constructor(e,t){this.projectId=e,this.database=t||ld}static empty(){return new Jo("","")}get isDefaultDatabase(){return this.database===ld}isEqual(e){return e instanceof Jo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hw="__type__",lN="__max__",Ii={mapValue:{fields:{__type__:{stringValue:lN}}}},fw="__vector__",Ml="value",vf={nullValue:"NULL_VALUE"};function Ki(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?km(n)?4:cN(n)?9007199254740991:Om(n)?10:11:ee(28295,{value:n})}function ms(n,e){if(n===e)return!0;const t=Ki(n);if(t!==Ki(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ad(n).isEqual(ad(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Fs(s.timestampValue),a=Fs(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return js(s.bytesValue).isEqual(js(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return yt(s.geoPointValue.latitude)===yt(i.geoPointValue.latitude)&&yt(s.geoPointValue.longitude)===yt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return yt(s.integerValue)===yt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=yt(s.doubleValue),a=yt(i.doubleValue);return o===a?rd(o)===rd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Al(n.arrayValue.values||[],e.arrayValue.values||[],ms);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(NT(o)!==NT(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ms(o[l],a[l])))return!1;return!0}(n,e);default:return ee(52216,{left:n})}}function cd(n,e){return(n.values||[]).find(t=>ms(t,e))!==void 0}function Qi(n,e){if(n===e)return 0;const t=Ki(n),r=Ki(e);if(t!==r)return ue(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ue(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=yt(i.integerValue||i.doubleValue),l=yt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return kT(n.timestampValue,e.timestampValue);case 4:return kT(ad(n),ad(e));case 5:return G_(n.stringValue,e.stringValue);case 6:return function(i,o){const a=js(i),l=js(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=ue(a[u],l[u]);if(h!==0)return h}return ue(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=ue(yt(i.latitude),yt(o.latitude));return a!==0?a:ue(yt(i.longitude),yt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return DT(n.arrayValue,e.arrayValue);case 10:return function(i,o){var p,y,x,T;const a=i.fields||{},l=o.fields||{},u=(p=a[Ml])==null?void 0:p.arrayValue,h=(y=l[Ml])==null?void 0:y.arrayValue,f=ue(((x=u==null?void 0:u.values)==null?void 0:x.length)||0,((T=h==null?void 0:h.values)==null?void 0:T.length)||0);return f!==0?f:DT(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ii.mapValue&&o===Ii.mapValue)return 0;if(i===Ii.mapValue)return 1;if(o===Ii.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const p=G_(l[f],h[f]);if(p!==0)return p;const y=Qi(a[l[f]],u[h[f]]);if(y!==0)return y}return ue(l.length,h.length)}(n.mapValue,e.mapValue);default:throw ee(23264,{he:t})}}function kT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ue(n,e);const t=Fs(n),r=Fs(e),s=ue(t.seconds,r.seconds);return s!==0?s:ue(t.nanos,r.nanos)}function DT(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Qi(t[s],r[s]);if(i)return i}return ue(t.length,r.length)}function Ll(n){return Z_(n)}function Z_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Fs(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return js(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Z_(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Z_(t.fields[o])}`;return s+"}"}(n.mapValue):ee(61005,{value:n})}function wf(n){switch(Ki(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Dm(n);return e?16+wf(e):16;case 5:return 2*n.stringValue.length;case 6:return js(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+wf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return oo(r.fields,(i,o)=>{s+=i.length+wf(o)}),s}(n.mapValue);default:throw ee(13486,{value:n})}}function Xo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ev(n){return!!n&&"integerValue"in n}function ud(n){return!!n&&"arrayValue"in n}function OT(n){return!!n&&"nullValue"in n}function MT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function If(n){return!!n&&"mapValue"in n}function Om(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[hw])==null?void 0:r.stringValue)===fw}function wu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return oo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=wu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wu(n.arrayValue.values[t]);return e}return{...n}}function cN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===lN}const uN={mapValue:{fields:{[hw]:{stringValue:fw},[Ml]:{arrayValue:{}}}}};function w3(n){return"nullValue"in n?vf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Xo(Jo.empty(),Q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Om(n)?uN:{mapValue:{}}:ee(35942,{value:n})}function I3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Xo(Jo.empty(),Q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?uN:"mapValue"in n?Om(n)?{mapValue:{}}:Ii:ee(61959,{value:n})}function LT(n,e){const t=Qi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function VT(n,e){const t=Qi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e){this.value=e}static empty(){return new _n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!If(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wu(t)}setAll(e){let t=It.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=wu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());If(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ms(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];If(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){oo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new _n(wu(this.value))}}function dN(n){const e=[];return oo(n.fields,(t,r)=>{const s=new It([t]);if(If(r)){const i=dN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Gn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ft(e,0,ae.min(),ae.min(),ae.min(),_n.empty(),0)}static newFoundDocument(e,t,r,s){return new ft(e,1,t,ae.min(),r,s,0)}static newNoDocument(e,t){return new ft(e,2,t,ae.min(),ae.min(),_n.empty(),0)}static newUnknownDocument(e,t){return new ft(e,3,t,ae.min(),ae.min(),_n.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_n.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_n.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ft&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ft(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,t){this.position=e,this.inclusive=t}}function FT(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Q.comparator(Q.fromName(o.referenceValue),t.key):r=Qi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function jT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ms(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e,t="asc"){this.field=e,this.dir=t}}function E3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{}class Me extends hN{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new x3(e,t,r):t==="array-contains"?new b3(e,r):t==="in"?new _N(e,r):t==="not-in"?new A3(e,r):t==="array-contains-any"?new C3(e,r):new Me(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new T3(e,r):new S3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Qi(t,this.value)):t!==null&&Ki(this.value)===Ki(t)&&this.matchesComparison(Qi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ee(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Qe extends hN{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Qe(e,t)}matches(e){return Vl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Vl(n){return n.op==="and"}function tv(n){return n.op==="or"}function pw(n){return fN(n)&&Vl(n)}function fN(n){for(const e of n.filters)if(e instanceof Qe)return!1;return!0}function nv(n){if(n instanceof Me)return n.field.canonicalString()+n.op.toString()+Ll(n.value);if(pw(n))return n.filters.map(e=>nv(e)).join(",");{const e=n.filters.map(t=>nv(t)).join(",");return`${n.op}(${e})`}}function pN(n,e){return n instanceof Me?function(r,s){return s instanceof Me&&r.op===s.op&&r.field.isEqual(s.field)&&ms(r.value,s.value)}(n,e):n instanceof Qe?function(r,s){return s instanceof Qe&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&pN(o,s.filters[a]),!0):!1}(n,e):void ee(19439)}function mN(n,e){const t=n.filters.concat(e);return Qe.create(t,n.op)}function gN(n){return n instanceof Me?function(t){return`${t.field.canonicalString()} ${t.op} ${Ll(t.value)}`}(n):n instanceof Qe?function(t){return t.op.toString()+" {"+t.getFilters().map(gN).join(" ,")+"}"}(n):"Filter"}class x3 extends Me{constructor(e,t,r){super(e,t,r),this.key=Q.fromName(r.referenceValue)}matches(e){const t=Q.comparator(e.key,this.key);return this.matchesComparison(t)}}class T3 extends Me{constructor(e,t){super(e,"in",t),this.keys=yN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class S3 extends Me{constructor(e,t){super(e,"not-in",t),this.keys=yN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function yN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>Q.fromName(r.referenceValue))}class b3 extends Me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ud(t)&&cd(t.arrayValue,this.value)}}class _N extends Me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&cd(this.value.arrayValue,t)}}class A3 extends Me{constructor(e,t){super(e,"not-in",t)}matches(e){if(cd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!cd(this.value.arrayValue,t)}}class C3 extends Me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ud(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>cd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function rv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new R3(n,e,t,r,s,i,o)}function Zo(n){const e=Y(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>nv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ud(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ll(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ll(r)).join(",")),e.Te=t}return e.Te}function $d(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!E3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!pN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!jT(n.startAt,e.startAt)&&jT(n.endAt,e.endAt)}function Tp(n){return Q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Sp(n,e){return n.filters.filter(t=>t instanceof Me&&t.field.isEqual(e))}function UT(n,e,t){let r=vf,s=!0;for(const i of Sp(n,e)){let o=vf,a=!0;switch(i.op){case"<":case"<=":o=w3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=vf}LT({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];LT({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function BT(n,e,t){let r=Ii,s=!0;for(const i of Sp(n,e)){let o=Ii,a=!0;switch(i.op){case">=":case">":o=I3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ii}VT({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];VT({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function vN(n,e,t,r,s,i,o,a){return new Ws(n,e,t,r,s,i,o,a)}function nc(n){return new Ws(n)}function $T(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function mw(n){return n.collectionGroup!==null}function ll(n){const e=Y(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Je(It.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new dd(i,r))}),t.has(It.keyField().canonicalString())||e.Ie.push(new dd(It.keyField(),r))}return e.Ie}function Pn(n){const e=Y(n);return e.Ee||(e.Ee=IN(e,ll(n))),e.Ee}function wN(n){const e=Y(n);return e.de||(e.de=IN(e,n.explicitOrderBy)),e.de}function IN(n,e){if(n.limitType==="F")return rv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new dd(s.field,i)});const t=n.endAt?new Yi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Yi(n.startAt.position,n.startAt.inclusive):null;return rv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function sv(n,e){const t=n.filters.concat([e]);return new Ws(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bp(n,e,t){return new Ws(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function zd(n,e){return $d(Pn(n),Pn(e))&&n.limitType===e.limitType}function EN(n){return`${Zo(Pn(n))}|lt:${n.limitType}`}function ja(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>gN(s)).join(", ")}]`),Ud(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ll(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ll(s)).join(",")),`Target(${r})`}(Pn(n))}; limitType=${n.limitType})`}function qd(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Q.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ll(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=FT(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,ll(r),s)||r.endAt&&!function(o,a,l){const u=FT(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,ll(r),s))}(n,e)}function xN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function TN(n){return(e,t)=>{let r=!1;for(const s of ll(n)){const i=N3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function N3(n,e,t){const r=n.field.isKeyField()?Q.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Qi(l,u):ee(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ee(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){oo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return nN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P3=new at(Q.comparator);function Hn(){return P3}const SN=new at(Q.comparator);function Jc(...n){let e=SN;for(const t of n)e=e.insert(t.key,t);return e}function bN(n){let e=SN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ss(){return Iu()}function AN(){return Iu()}function Iu(){return new Gs(n=>n.toString(),(n,e)=>n.isEqual(e))}const k3=new at(Q.comparator),D3=new Je(Q.comparator);function ge(...n){let e=D3;for(const t of n)e=e.add(t);return e}const O3=new Je(ue);function gw(){return O3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rd(e)?"-0":e}}function CN(n){return{integerValue:""+n}}function RN(n,e){return qR(e)?CN(e):yw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(){this._=void 0}}function M3(n,e,t){return n instanceof Fl?function(s,i){const o={fields:{[iN]:{stringValue:sN},[aN]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&km(i)&&(i=Dm(i)),i&&(o.fields[oN]=i),{mapValue:o}}(t,e):n instanceof ea?PN(n,e):n instanceof ta?kN(n,e):function(s,i){const o=NN(s,i),a=zT(o)+zT(s.Ae);return ev(o)&&ev(s.Ae)?CN(a):yw(s.serializer,a)}(n,e)}function L3(n,e,t){return n instanceof ea?PN(n,e):n instanceof ta?kN(n,e):t}function NN(n,e){return n instanceof jl?function(r){return ev(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Fl extends Mm{}class ea extends Mm{constructor(e){super(),this.elements=e}}function PN(n,e){const t=DN(e);for(const r of n.elements)t.some(s=>ms(s,r))||t.push(r);return{arrayValue:{values:t}}}class ta extends Mm{constructor(e){super(),this.elements=e}}function kN(n,e){let t=DN(e);for(const r of n.elements)t=t.filter(s=>!ms(s,r));return{arrayValue:{values:t}}}class jl extends Mm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function zT(n){return yt(n.integerValue||n.doubleValue)}function DN(n){return ud(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e,t){this.field=e,this.transform=t}}function V3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof ea&&s instanceof ea||r instanceof ta&&s instanceof ta?Al(r.elements,s.elements,ms):r instanceof jl&&s instanceof jl?ms(r.Ae,s.Ae):r instanceof Fl&&s instanceof Fl}(n.transform,e.transform)}class F3{constructor(e,t){this.version=e,this.transformResults=t}}class Et{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Et}static exists(e){return new Et(void 0,e)}static updateTime(e){return new Et(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ef(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Lm{}function ON(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new sc(n.key,Et.none()):new rc(n.key,n.data,Et.none());{const t=n.data,r=_n.empty();let s=new Je(It.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Hs(n.key,r,new Gn(s.toArray()),Et.none())}}function j3(n,e,t){n instanceof rc?function(s,i,o){const a=s.value.clone(),l=WT(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Hs?function(s,i,o){if(!Ef(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=WT(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(MN(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Eu(n,e,t,r){return n instanceof rc?function(i,o,a,l){if(!Ef(i.precondition,o))return a;const u=i.value.clone(),h=GT(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Hs?function(i,o,a,l){if(!Ef(i.precondition,o))return a;const u=GT(i.fieldTransforms,l,o),h=o.data;return h.setAll(MN(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Ef(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function U3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=NN(r.transform,s||null);i!=null&&(t===null&&(t=_n.empty()),t.set(r.field,i))}return t||null}function qT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Al(r,s,(i,o)=>V3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class rc extends Lm{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Hs extends Lm{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function MN(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function WT(n,e,t){const r=new Map;ie(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,L3(o,a,t[s]))}return r}function GT(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,M3(i,o,e))}return r}class sc extends Lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _w extends Lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&j3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Eu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Eu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=AN();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=ON(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(ae.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ge())}isEqual(e){return this.batchId===e.batchId&&Al(this.mutations,e.mutations,(t,r)=>qT(t,r))&&Al(this.baseMutations,e.baseMutations,(t,r)=>qT(t,r))}}class ww{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ie(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return k3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new ww(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zt,je;function VN(n){switch(n){case M.OK:return ee(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return ee(15467,{code:n})}}function FN(n){if(n===void 0)return jt("GRPC error has no .code"),M.UNKNOWN;switch(n){case zt.OK:return M.OK;case zt.CANCELLED:return M.CANCELLED;case zt.UNKNOWN:return M.UNKNOWN;case zt.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case zt.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case zt.INTERNAL:return M.INTERNAL;case zt.UNAVAILABLE:return M.UNAVAILABLE;case zt.UNAUTHENTICATED:return M.UNAUTHENTICATED;case zt.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case zt.NOT_FOUND:return M.NOT_FOUND;case zt.ALREADY_EXISTS:return M.ALREADY_EXISTS;case zt.PERMISSION_DENIED:return M.PERMISSION_DENIED;case zt.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case zt.ABORTED:return M.ABORTED;case zt.OUT_OF_RANGE:return M.OUT_OF_RANGE;case zt.UNIMPLEMENTED:return M.UNIMPLEMENTED;case zt.DATA_LOSS:return M.DATA_LOSS;default:return ee(39323,{code:n})}}(je=zt||(zt={}))[je.OK=0]="OK",je[je.CANCELLED=1]="CANCELLED",je[je.UNKNOWN=2]="UNKNOWN",je[je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",je[je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",je[je.NOT_FOUND=5]="NOT_FOUND",je[je.ALREADY_EXISTS=6]="ALREADY_EXISTS",je[je.PERMISSION_DENIED=7]="PERMISSION_DENIED",je[je.UNAUTHENTICATED=16]="UNAUTHENTICATED",je[je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",je[je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",je[je.ABORTED=10]="ABORTED",je[je.OUT_OF_RANGE=11]="OUT_OF_RANGE",je[je.UNIMPLEMENTED=12]="UNIMPLEMENTED",je[je.INTERNAL=13]="INTERNAL",je[je.UNAVAILABLE=14]="UNAVAILABLE",je[je.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $3=new Vi([4294967295,4294967295],0);function HT(n){const e=jN().encode(n),t=new CR;return t.update(e),new Uint8Array(t.digest())}function KT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Vi([t,r],0),new Vi([s,i],0)]}class Ew{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Xc(`Invalid padding: ${t}`);if(r<0)throw new Xc(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Xc(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Xc(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vi.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Vi.fromNumber(r)));return s.compare($3)===1&&(s=new Vi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=HT(e),[r,s]=KT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Ew(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=HT(e),[r,s]=KT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Xc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Hd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Gd(ae.min(),s,new at(ue),Hn(),ge())}}class Hd{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Hd(r,t,ge(),ge(),ge())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class UN{constructor(e,t){this.targetId=e,this.Ce=t}}class BN{constructor(e,t,r=Dt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class QT{constructor(){this.ve=0,this.Fe=YT(),this.Me=Dt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ge(),t=ge(),r=ge();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ee(38017,{changeType:i})}}),new Hd(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=YT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ie(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class z3{constructor(e){this.Ge=e,this.ze=new Map,this.je=Hn(),this.Je=qh(),this.He=qh(),this.Ye=new at(ue)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ee(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Tp(i))if(r===0){const o=new Q(i.path);this.et(t,o,ft.newNoDocument(o,ae.min()))}else ie(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}xu==null||xu.lt(function(h,f,p,y,x){var R,b,N;const T={localCacheCount:h,existenceFilterCount:f.count,databaseId:p.database,projectId:p.projectId},P=f.unchangedNames;return P&&(T.bloomFilter={applied:x===0,hashCount:(P==null?void 0:P.hashCount)??0,bitmapLength:((b=(R=P==null?void 0:P.bits)==null?void 0:R.bitmap)==null?void 0:b.length)??0,padding:((N=P==null?void 0:P.bits)==null?void 0:N.padding)??0,mightContain:k=>(y==null?void 0:y.mightContain(k))??!1}),T}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=js(r).toUint8Array()}catch(l){if(l instanceof rN)return Cr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Ew(o,s,i)}catch(l){return Cr(l instanceof Xc?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Tp(a.target)){const l=new Q(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,ft.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=ge();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Gd(e,t,this.Ye,this.je,r);return this.je=Hn(),this.Je=qh(),this.He=qh(),this.Ye=new at(ue),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new QT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Je(ue),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Je(ue),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||$("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new QT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function qh(){return new at(Q.comparator)}function YT(){return new at(Q.comparator)}const q3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),W3=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),G3=(()=>({and:"AND",or:"OR"}))();class H3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iv(n,e){return n.useProto3Json||Ud(e)?e:{value:e}}function Ul(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $N(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function K3(n,e){return Ul(n,e.toTimestamp())}function Ut(n){return ie(!!n,49232),ae.fromTimestamp(function(t){const r=Fs(t);return new Ke(r.seconds,r.nanos)}(n))}function xw(n,e){return ov(n,e).canonicalString()}function ov(n,e){const t=function(s){return new Ae(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function zN(n){const e=Ae.fromString(n);return ie(XN(e),10190,{key:e.toString()}),e}function hd(n,e){return xw(n.databaseId,e.path)}function us(n,e){const t=zN(e);if(t.get(1)!==n.databaseId.projectId)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Q(GN(t))}function qN(n,e){return xw(n.databaseId,e)}function WN(n){const e=zN(n);return e.length===4?Ae.emptyPath():GN(e)}function av(n){return new Ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function GN(n){return ie(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function JT(n,e,t){return{name:hd(n,e),fields:t.value.mapValue.fields}}function Vm(n,e,t){const r=us(n,e.name),s=Ut(e.updateTime),i=e.createTime?Ut(e.createTime):ae.min(),o=new _n({mapValue:{fields:e.fields}}),a=ft.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Q3(n,e){return"found"in e?function(r,s){ie(!!s.found,43571),s.found.name,s.found.updateTime;const i=us(r,s.found.name),o=Ut(s.found.updateTime),a=s.found.createTime?Ut(s.found.createTime):ae.min(),l=new _n({mapValue:{fields:s.found.fields}});return ft.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){ie(!!s.missing,3894),ie(!!s.readTime,22933);const i=us(r,s.missing),o=Ut(s.readTime);return ft.newNoDocument(i,o)}(n,e):ee(7234,{result:e})}function Y3(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ee(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(ie(h===void 0||typeof h=="string",58123),Dt.fromBase64String(h||"")):(ie(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Dt.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?M.UNKNOWN:FN(u.code);return new B(h,u.message||"")}(o);t=new BN(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=us(n,r.document.name),i=Ut(r.document.updateTime),o=r.document.createTime?Ut(r.document.createTime):ae.min(),a=new _n({mapValue:{fields:r.document.fields}}),l=ft.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new xf(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=us(n,r.document),i=r.readTime?Ut(r.readTime):ae.min(),o=ft.newNoDocument(s,i),a=r.removedTargetIds||[];t=new xf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=us(n,r.document),i=r.removedTargetIds||[];t=new xf([],i,s,null)}else{if(!("filter"in e))return ee(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new B3(s,i),a=r.targetId;t=new UN(a,o)}}return t}function fd(n,e){let t;if(e instanceof rc)t={update:JT(n,e.key,e.value)};else if(e instanceof sc)t={delete:hd(n,e.key)};else if(e instanceof Hs)t={update:JT(n,e.key,e.data),updateMask:n6(e.fieldMask)};else{if(!(e instanceof _w))return ee(16599,{Vt:e.type});t={verify:hd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Fl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ea)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ta)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof jl)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ee(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:K3(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ee(27497)}(n,e.precondition)),t}function lv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Et.updateTime(Ut(i.updateTime)):i.exists!==void 0?Et.exists(i.exists):Et.none()}(e.currentDocument):Et.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)ie(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new Fl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new ea(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new ta(h)}else"increment"in a?l=new jl(o,a.increment):ee(16584,{proto:a});const u=It.fromServerFormat(a.fieldPath);return new Wd(u,l)}(n,s)):[];if(e.update){e.update.name;const s=us(n,e.update.name),i=new _n({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new Gn(u.map(h=>It.fromServerFormat(h)))}(e.updateMask);return new Hs(s,i,o,t,r)}return new rc(s,i,t,r)}if(e.delete){const s=us(n,e.delete);return new sc(s,t)}if(e.verify){const s=us(n,e.verify);return new _w(s,t)}return ee(1463,{proto:e})}function J3(n,e){return n&&n.length>0?(ie(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?Ut(s.updateTime):Ut(i);return o.isEqual(ae.min())&&(o=Ut(i)),new F3(o,s.transformResults||[])}(t,e))):[]}function HN(n,e){return{documents:[qN(n,e.path)]}}function Fm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=qN(n,s);const i=function(u){if(u.length!==0)return JN(Qe.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:hi(p.field),direction:Z3(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=iv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function KN(n,e,t,r){const{ft:s,parent:i}=Fm(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:hi(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:hi(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function QN(n){let e=WN(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ie(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const p=YN(f);return p instanceof Qe&&pw(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(x){return new dd(Ua(x.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,Ud(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(f){const p=!!f.before,y=f.values||[];return new Yi(y,p)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const p=!f.before,y=f.values||[];return new Yi(y,p)}(t.endAt)),vN(e,s,o,i,a,"F",l,u)}function X3(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ee(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function YN(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ua(t.unaryFilter.field);return Me.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ua(t.unaryFilter.field);return Me.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ua(t.unaryFilter.field);return Me.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ua(t.unaryFilter.field);return Me.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ee(61313);default:return ee(60726)}}(n):n.fieldFilter!==void 0?function(t){return Me.create(Ua(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ee(58110);default:return ee(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Qe.create(t.compositeFilter.filters.map(r=>YN(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ee(1026)}}(t.compositeFilter.op))}(n):ee(30097,{filter:n})}function Z3(n){return q3[n]}function e6(n){return W3[n]}function t6(n){return G3[n]}function hi(n){return{fieldPath:n.canonicalString()}}function Ua(n){return It.fromServerFormat(n.fieldPath)}function JN(n){return n instanceof Me?function(t){if(t.op==="=="){if(MT(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NAN"}};if(OT(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(MT(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NOT_NAN"}};if(OT(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hi(t.field),op:e6(t.op),value:t.value}}}(n):n instanceof Qe?function(t){const r=t.getFilters().map(s=>JN(s));return r.length===1?r[0]:{compositeFilter:{op:t6(t.op),filters:r}}}(n):ee(54877,{filter:n})}function n6(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function XN(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e,t,r,s,i=ae.min(),o=ae.min(),a=Dt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new As(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new As(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new As(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new As(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(e){this.yt=e}}function r6(n,e){let t;if(e.document)t=Vm(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Q.fromSegments(e.noDocument.path),s=ra(e.noDocument.readTime);t=ft.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ee(56709);{const r=Q.fromSegments(e.unknownDocument.path),s=ra(e.unknownDocument.version);t=ft.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Ke(s[0],s[1]);return ae.fromTimestamp(i)}(e.readTime)),t}function XT(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ap(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:hd(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ul(i,o.version.toTimestamp()),createTime:Ul(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:na(e.version)};else{if(!e.isUnknownDocument())return ee(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:na(e.version)}}return r}function Ap(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function na(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ra(n){const e=new Ke(n.seconds,n.nanoseconds);return ae.fromTimestamp(e)}function To(n,e){const t=(e.baseMutations||[]).map(i=>lv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>lv(n.yt,i)),s=Ke.fromMillis(e.localWriteTimeMs);return new vw(e.batchId,s,t,r)}function Zc(n){const e=ra(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ra(n.lastLimboFreeSnapshotVersion):ae.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return ie(o===1,1966,{count:o}),Pn(nc(WN(i.documents[0])))}(n.query):function(i){return Pn(QN(i))}(n.query),new As(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Dt.fromBase64String(n.resumeToken))}function eP(n,e){const t=na(e.snapshotVersion),r=na(e.lastLimboFreeSnapshotVersion);let s;s=Tp(e.target)?HN(n.yt,e.target):Fm(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Zo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function jm(n){const e=QN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bp(e,e.limit,"L"):e}function ly(n,e){return new Iw(e.largestBatchId,lv(n.yt,e.overlayMutation))}function ZT(n,e){const t=e.path.lastSegment();return[n,Nn(e.path.popLast()),t]}function eS(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:na(r.readTime),documentKey:Nn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6{getBundleMetadata(e,t){return tS(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ra(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return tS(e).put(function(s){return{bundleId:s.id,createTime:na(Ut(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return nS(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:jm(i.bundledQuery),readTime:ra(i.readTime)}}(r)})}saveNamedQuery(e,t){return nS(e).put(function(s){return{name:s.name,readTime:na(Ut(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function tS(n){return Jt(n,Rm)}function nS(n){return Jt(n,Nm)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new Um(e,r)}getOverlay(e,t){return Vc(e).get(ZT(this.userId,t)).next(r=>r?ly(this.serializer,r):null)}getOverlays(e,t){const r=ss();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Iw(t,o);s.push(this.St(e,a))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Nn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Vc(e).Z(J_,a))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=ss(),i=Nn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Vc(e).J(J_,o).next(a=>{for(const l of a){const u=ly(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=ss();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Vc(e).ee({index:YR,range:a},(l,u,h)=>{const f=ly(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return Vc(e).put(function(s,i,o){const[a,l,u]=ZT(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:fd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function Vc(n){return Jt(n,Pm)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i6{bt(e){return Jt(e,uw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Dt.fromUint8Array(r):Dt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(yt(e.integerValue));else if("doubleValue"in e){const r=yt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),rd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Fs(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(js(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?cN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Om(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ee(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=Ml,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(yt(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),Q.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}So.Kt=new So;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oa=255;function o6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function rS(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=o6(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class a6{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=rS(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=rS(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(Oa),this.sn(255)}_n(){this.an(Oa),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Oa?(this.sn(Oa),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Oa?(this.an(Oa),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class l6{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class c6{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Fc{constructor(){this.cn=new a6,this.ln=new l6(this.cn),this.hn=new c6(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new bo(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Tf(this.En),directionalValue:Tf(this.dn),orderedDocumentKey:Tf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function si(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=sS(n.En,e.En),t!==0?t:(t=sS(n.dn,e.dn),t!==0?t:Q.comparator(n.In,e.In)))}function sS(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Tf(n){return XA()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function iS(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class oS{constructor(e){this.mn=new Je((t,r)=>It.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(ie(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=K_(e);if(t!==void 0&&!this.wn(t))return!1;const r=Io(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Je(It.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Vo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Vo(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Vo(r.field,r.dir==="asc"?0:1)));return new Rl(Rl.UNKNOWN_ID,this.collectionId,t,Nl.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tP(n){var t,r;if(ie(n instanceof Me||n instanceof Qe,20012),n instanceof Me){if(n instanceof _N){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>Me.create(n.field,"==",i)))||[];return Qe.create(s,"or")}return n}const e=n.filters.map(s=>tP(s));return Qe.create(e,n.op)}function u6(n){if(n.getFilters().length===0)return[];const e=dv(tP(n));return ie(nP(e),7391),cv(e)||uv(e)?[e]:e.getFilters()}function cv(n){return n instanceof Me}function uv(n){return n instanceof Qe&&pw(n)}function nP(n){return cv(n)||uv(n)||function(t){if(t instanceof Qe&&tv(t)){for(const r of t.getFilters())if(!cv(r)&&!uv(r))return!1;return!0}return!1}(n)}function dv(n){if(ie(n instanceof Me||n instanceof Qe,34018),n instanceof Me)return n;if(n.filters.length===1)return dv(n.filters[0]);const e=n.filters.map(r=>dv(r));let t=Qe.create(e,n.op);return t=Cp(t),nP(t)?t:(ie(t instanceof Qe,64498),ie(Vl(t),40251),ie(t.filters.length>1,57927),t.filters.reduce((r,s)=>Tw(r,s)))}function Tw(n,e){let t;return ie(n instanceof Me||n instanceof Qe,38388),ie(e instanceof Me||e instanceof Qe,25473),t=n instanceof Me?e instanceof Me?function(s,i){return Qe.create([s,i],"and")}(n,e):aS(n,e):e instanceof Me?aS(e,n):function(s,i){if(ie(s.filters.length>0&&i.filters.length>0,48005),Vl(s)&&Vl(i))return mN(s,i.getFilters());const o=tv(s)?s:i,a=tv(s)?i:s,l=o.filters.map(u=>Tw(u,a));return Qe.create(l,"or")}(n,e),Cp(t)}function aS(n,e){if(Vl(e))return mN(e,n.getFilters());{const t=e.filters.map(r=>Tw(n,r));return Qe.create(t,"or")}}function Cp(n){if(ie(n instanceof Me||n instanceof Qe,11850),n instanceof Me)return n;const e=n.getFilters();if(e.length===1)return Cp(e[0]);if(fN(n))return n;const t=e.map(s=>Cp(s)),r=[];return t.forEach(s=>{s instanceof Me?r.push(s):s instanceof Qe&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Qe.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d6{constructor(){this.Cn=new Sw}addToCollectionParentIndex(e,t){return this.Cn.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(mr.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(mr.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class Sw{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Je(Ae.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Je(Ae.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lS="IndexedDbIndexManager",Wh=new Uint8Array(0);class h6{constructor(e,t){this.databaseId=t,this.vn=new Sw,this.Fn=new Gs(r=>Zo(r),(r,s)=>$d(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:Nn(s)};return cS(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[LR(t),""],!1,!0);return cS(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(rs(o.parent))}return r})}addFieldIndex(e,t){const r=jc(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=La(e);return i.next(a=>{o.put(eS(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=jc(e),s=La(e),i=Ma(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=jc(e),r=Ma(e),s=La(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return O.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new oS(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ma(e);let s=!0;const i=new Map;return O.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=ge();const a=[];return O.forEach(i,(l,u)=>{$(lS,`Using index ${function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map(k=>`${k.fieldPath}:${k.kind}`).join(",")}`}(l)} to execute ${Zo(t)}`);const h=function(N,k){const U=K_(k);if(U===void 0)return null;for(const V of Sp(N,U.fieldPath))switch(V.op){case"array-contains-any":return V.value.arrayValue.values||[];case"array-contains":return[V.value]}return null}(u,l),f=function(N,k){const U=new Map;for(const V of Io(k))for(const A of Sp(N,V.fieldPath))switch(A.op){case"==":case"in":U.set(V.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return U.set(V.fieldPath.canonicalString(),A.value),Array.from(U.values())}return null}(u,l),p=function(N,k){const U=[];let V=!0;for(const A of Io(k)){const v=A.kind===0?UT(N,A.fieldPath,N.startAt):BT(N,A.fieldPath,N.startAt);U.push(v.value),V&&(V=v.inclusive)}return new Yi(U,V)}(u,l),y=function(N,k){const U=[];let V=!0;for(const A of Io(k)){const v=A.kind===0?BT(N,A.fieldPath,N.endAt):UT(N,A.fieldPath,N.endAt);U.push(v.value),V&&(V=v.inclusive)}return new Yi(U,V)}(u,l),x=this.On(l,u,p),T=this.On(l,u,y),P=this.Nn(l,u,f),R=this.Bn(l.indexId,h,x,p.inclusive,T,y.inclusive,P);return O.forEach(R,b=>r.Y(b,t.limit).next(N=>{N.forEach(k=>{const U=Q.fromSegments(k.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}return O.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=u6(Qe.create(e.filters,"and")).map(r=>rv(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const p=t?this.Ln(t[f/u]):Wh,y=this.kn(e,p,r[f%u],s),x=this.qn(e,p,i[f%u],o),T=a.map(P=>this.kn(e,p,P,!0));h.push(...this.createRange(y,x,T))}return h}kn(e,t,r,s){const i=new bo(e,Q.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new bo(e,Q.empty(),t,r);return s?i.An():i}xn(e,t){const r=new oS(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return O.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new Je(It.comparator),h=!1;for(const f of l.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:u=u.add(p.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new Fc;for(const s of Io(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);So.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new Fc;return So.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new Fc;return So.Kt.Dt(Xo(this.databaseId,t),r.Pn(function(i){const o=Io(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new Fc);let i=0;for(const o of Io(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&ud(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);So.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Fc;l.seed(a.un()),So.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof Me&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=jc(e),s=La(e);return(t?r.J(Y_,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return O.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const p=f?new Nl(f.sequenceNumber,new mr(ra(f.readTime),new Q(rs(f.documentKey)),f.largestBatchId)):Nl.empty(),y=h.fields.map(([x,T])=>new Vo(It.fromServerFormat(x),T));return new Rl(h.indexId,h.collectionGroup,y,p)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ue(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=jc(e),i=La(e);return this.Gn(e).next(o=>s.J(Y_,IDBKeyRange.bound(t,t)).next(a=>O.forEach(a,l=>i.put(eS(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?O.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),O.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?O.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return Ma(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return Ma(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=Ma(e);let i=new Je(si);return s.ee({index:QR,range:IDBKeyRange.only([r.indexId,this.uid,Tf(this.$n(r,t))])},(o,a)=>{i=i.add(new bo(r.indexId,t,iS(a.arrayValue),iS(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new Je(si);const s=this.Qn(t,e);if(s==null)return r;const i=K_(t);if(i!=null){const o=e.data.field(i.fieldPath);if(ud(o))for(const a of o.arrayValue.values||[])r=r.add(new bo(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new bo(t.indexId,e.key,Wh,s));return r}Jn(e,t,r,s,i){$(lS,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,p){const y=l.getIterator(),x=u.getIterator();let T=Da(y),P=Da(x);for(;T||P;){let R=!1,b=!1;if(T&&P){const N=h(T,P);N<0?b=!0:N>0&&(R=!0)}else T!=null?b=!0:R=!0;R?(f(P),P=Da(x)):b?(p(T),T=Da(y)):(T=Da(y),P=Da(x))}}(s,i,si,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),O.waitFor(o)}Gn(e){let t=1;return La(e).ee({index:KR,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>si(o,a)).filter((o,a,l)=>!a||si(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=si(o,e),l=si(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,Wh,Q.empty()),l=s[o+1].Vn(this.uid,Wh,Q.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return si(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(uS)}getMinOffset(e,t){return O.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||ee(44426))).next(uS)}}function cS(n){return Jt(n,od)}function Ma(n){return Jt(n,vu)}function jc(n){return Jt(n,cw)}function La(n){return Jt(n,_u)}function uS(n){ie(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;ow(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new mr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},rP=41943040;class An{static withCacheSize(e){return new An(e,An.DEFAULT_COLLECTION_PERCENTILE,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(n,e,t){const r=n.store(Mr),s=n.store(Pl),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,p)=>(a++,p.delete()));i.push(l.next(()=>{ie(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=WR(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return O.waitFor(i).next(()=>u)}function Rp(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ee(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */An.DEFAULT_COLLECTION_PERCENTILE=10,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,An.DEFAULT=new An(rP,An.DEFAULT_COLLECTION_PERCENTILE,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),An.DISABLED=new An(-1,0,0);class Bm{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){ie(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Bm(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ii(e).ee({index:Po,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ba(e),o=ii(e);return o.add({}).next(a=>{ie(typeof a=="number",49019);const l=new vw(a,t,r,s),u=function(y,x,T){const P=T.baseMutations.map(b=>fd(y.yt,b)),R=T.mutations.map(b=>fd(y.yt,b));return{userId:x,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:P,mutations:R}}(this.serializer,this.userId,l),h=[];let f=new Je((p,y)=>ue(p.canonicalString(),y.canonicalString()));for(const p of s){const y=WR(this.userId,p.key.path,a);f=f.add(p.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,K4))}return f.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),O.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return ii(e).get(t).next(r=>r?(ie(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),To(this.serializer,r)):null)}er(e,t){return this.Xn[t]?O.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ii(e).ee({index:Po,range:s},(o,a,l)=>{a.userId===this.userId&&(ie(a.batchId>=r,47524,{tr:r}),i=To(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Fi;return ii(e).ee({index:Po,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Fi],[this.userId,Number.POSITIVE_INFINITY]);return ii(e).J(Po,t).next(r=>r.map(s=>To(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=yf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ba(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,p=rs(h);if(u===this.userId&&t.path.isEqual(p))return ii(e).get(f).next(y=>{if(!y)throw ee(61480,{nr:o,batchId:f});ie(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(To(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Je(ue);const s=[];return t.forEach(i=>{const o=yf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ba(e).ee({range:a},(u,h,f)=>{const[p,y,x]=u,T=rs(y);p===this.userId&&i.path.isEqual(T)?r=r.add(x):f.done()});s.push(l)}),O.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=yf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Je(ue);return Ba(e).ee({range:o},(l,u,h)=>{const[f,p,y]=l,x=rs(p);f===this.userId&&r.isPrefixOf(x)?x.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ii(e).get(i).next(o=>{if(o===null)throw ee(35274,{batchId:i});ie(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(To(this.serializer,o))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return sP(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ba(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=rs(i[1]);s.push(l)}else a.done()}).next(()=>{ie(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return iP(e,this.userId,t)}_r(e){return oP(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Fi,lastStreamToken:""})}}function iP(n,e,t){const r=yf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ba(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,p]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function ii(n){return Jt(n,Mr)}function Ba(n){return Jt(n,Pl)}function oP(n){return Jt(n,sd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new sa(0)}static cr(){return new sa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f6{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new sa(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>ae.fromTimestamp(new Ke(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Va(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(ie(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Va(e).ee((o,a)=>{const l=Zc(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Va(e).ee((r,s)=>{const i=Zc(s);t(i)})}lr(e){return hS(e).get(xp).next(t=>(ie(t!==null,2888),t))}hr(e,t){return hS(e).put(xp,t)}Pr(e,t){return Va(e).put(eP(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Zo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Va(e).ee({range:s,index:HR},(o,a,l)=>{const u=Zc(a);$d(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=fi(e);return t.forEach(o=>{const a=Nn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=fi(e);return O.forEach(t,i=>{const o=Nn(i.path);return O.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=fi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=fi(e);let i=ge();return s.ee({range:r,X:!0},(o,a,l)=>{const u=rs(o[1]),h=new Q(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Nn(t.path),s=IDBKeyRange.bound([r],[LR(r)],!1,!0);let i=0;return fi(e).ee({index:lw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return Va(e).get(t).next(r=>r?Zc(r):null)}}function Va(n){return Jt(n,kl)}function hS(n){return Jt(n,Fo)}function fi(n){return Jt(n,Dl)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fS="LruGarbageCollector",aP=1048576;function pS([n,e],[t,r]){const s=ue(n,t);return s===0?ue(e,r):s}class p6{constructor(e){this.Ir=e,this.buffer=new Je(pS),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();pS(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class lP{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){$(fS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){io(t)?$(fS,"Ignoring IndexedDB error during garbage collection: ",t):await so(t)}await this.Vr(3e5)})}}class m6{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(Wn.ce);const r=new p6(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?($("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(dS)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?($("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dS):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?($("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),Fa()<=Pe.DEBUG&&$("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function cP(n,e){return new m6(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g6{constructor(e,t){this.db=e,this.garbageCollector=cP(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Gh(e,r)}removeReference(e,t,r){return Gh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Gh(e,t)}br(e,t){return function(s,i){let o=!1;return oP(s).te(a=>iP(s,a,i).next(l=>(l&&(o=!0),O.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ae.min()),fi(e).delete(function(f){return[0,Nn(f.path)]}(o))))});s.push(l)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Gh(e,t)}Sr(e,t){const r=fi(e);let s,i=Wn.ce;return r.ee({index:lw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Wn.ce&&t(new Q(rs(s)),i),i=u,s=l):i=Wn.ce}).next(()=>{i!==Wn.ce&&t(new Q(rs(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Gh(n,e){return fi(n).put(function(r,s){return{targetId:0,path:Nn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{constructor(){this.changes=new Gs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y6{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return go(e).put(r)}removeEntry(e,t,r){return go(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Ap(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=ft.newInvalidDocument(t);return go(e).ee({index:_f,range:IDBKeyRange.only(Uc(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:ft.newInvalidDocument(t)};return go(e).ee({index:_f,range:IDBKeyRange.only(Uc(t))},(s,i)=>{r={document:this.Cr(t,i),size:Rp(i)}}).next(()=>r)}getEntries(e,t){let r=Hn();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=Hn(),s=new at(Q.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,Rp(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return O.resolve();let s=new Je(yS);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Uc(s.first()),Uc(s.last())),o=s.getIterator();let a=o.getNext();return go(e).ee({index:_f,range:i},(l,u,h)=>{const f=Q.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&yS(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(Uc(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Ap(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return go(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=Hn();for(const f of u){const p=this.Cr(Q.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(qd(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Hn();const o=gS(t,r),a=gS(t,mr.max());return go(e).ee({index:GR,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(Q.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new _6(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return mS(e).get(Q_).next(t=>(ie(!!t,20021),t))}Dr(e,t){return mS(e).put(Q_,t)}Cr(e,t){if(t){const r=r6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ae.min())))return r}return ft.newInvalidDocument(e)}}function dP(n){return new y6(n)}class _6 extends uP{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Gs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Je((i,o)=>ue(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=XT(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=Rp(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=XT(this.Nr.serializer,o.convertToNoDocument(ae.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function mS(n){return Jt(n,id)}function go(n){return Jt(n,Ep)}function Uc(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function gS(n,e){const t=e.documentKey.path.toArray();return[n,Ap(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function yS(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=ue(t[i],r[i]),s)return s;return s=ue(t.length,r.length),s||(s=ue(t[t.length-2],r[r.length-2]),s||ue(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Eu(r.mutation,s,Gn.empty(),Ke.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ge()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ge()){const s=ss();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Jc();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ss();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ge()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Hn();const o=Iu(),a=function(){return Iu()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Hs)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Eu(h.mutation,u,h.mutation.getFieldMask(),Ke.now())):o.set(u.key,Gn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new v6(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Iu();let s=new at((o,a)=>o-a),i=ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||Gn.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||ge()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=AN();h.forEach(p=>{if(!i.has(p)){const y=ON(t.get(p),r.get(p));y!==null&&f.set(p,y),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return O.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Q.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):mw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(ss());let a=Cl,l=i;return o.next(u=>O.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?O.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,ge())).next(h=>({batchId:a,changes:bN(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Q(t)).next(r=>{let s=Jc();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Jc();return this.indexManager.getCollectionParents(e,i).next(a=>O.forEach(a,l=>{const u=function(f,p){return new Ws(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,ft.newInvalidDocument(h)))});let a=Jc();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&Eu(h.mutation,u,Gn.empty(),Ke.now()),qd(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w6{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return O.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ut(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:jm(s.bundledQuery),readTime:Ut(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I6{constructor(){this.overlays=new at(Q.comparator),this.qr=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ss();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=ss(),i=t.length+1,o=new Q(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new at((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=ss(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=ss(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return O.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Iw(t,r));let i=this.qr.get(t);i===void 0&&(i=ge(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E6{constructor(){this.sessionToken=Dt.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw{constructor(){this.Qr=new Je(tn.$r),this.Ur=new Je(tn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new tn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new tn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new Q(new Ae([])),r=new tn(t,e),s=new tn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Q(new Ae([])),r=new tn(t,e),s=new tn(t,e+1);let i=ge();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new tn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class tn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Q.comparator(e.key,t.key)||ue(e.Yr,t.Yr)}static Kr(e,t){return ue(e.Yr,t.Yr)||Q.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x6{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Je(tn.$r)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new vw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new tn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return O.resolve(o)}lookupMutationBatch(e,t){return O.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?Fi:this.tr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new tn(t,0),s=new tn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Je(ue);return t.forEach(s=>{const i=new tn(s,0),o=new tn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),O.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Q.isDocumentKey(i)||(i=i.child(""));const o=new tn(new Q(i),0);let a=new Je(ue);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),O.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ie(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return O.forEach(t.mutations,s=>{const i=new tn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new tn(t,0),s=this.Zr.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T6{constructor(e){this.ri=e,this.docs=function(){return new at(Q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():ft.newInvalidDocument(t))}getEntries(e,t){let r=Hn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ft.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Hn();const o=t.path,a=new Q(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||ow(UR(h),r)<=0||(s.has(h.key)||qd(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ee(9500)}ii(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new S6(this)}getSize(e){return O.resolve(this.size)}}class S6 extends uP{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b6{constructor(e){this.persistence=e,this.si=new Gs(t=>Zo(t),$d),this.lastRemoteSnapshotVersion=ae.min(),this.highestTargetId=0,this.oi=0,this._i=new bw,this.targetCount=0,this.ai=sa.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),O.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new sa(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Pr(t),O.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e,t){this.ui={},this.overlays={},this.ci=new Wn(0),this.li=!1,this.li=!0,this.hi=new E6,this.referenceDelegate=e(this),this.Pi=new b6(this),this.indexManager=new d6,this.remoteDocumentCache=function(s){return new T6(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new ZN(t),this.Ii=new w6(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new I6,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new x6(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){$("MemoryPersistence","Starting transaction:",e);const s=new A6(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return O.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class A6 extends $R{constructor(e){super(),this.currentSequenceNumber=e}}class $m{constructor(e){this.persistence=e,this.Ri=new bw,this.Vi=null}static mi(e){return new $m(e)}get fi(){if(this.Vi)return this.Vi;throw ee(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),O.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.fi,r=>{const s=Q.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,ae.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return O.or([()=>O.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Np{constructor(e,t){this.persistence=e,this.pi=new Gs(r=>Nn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=cP(this,t)}static mi(e,t){return new Np(e,t)}Ei(){}di(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return O.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?O.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,ae.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),O.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wf(e.data.value)),t}br(e,t,r){return O.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C6{constructor(e){this.serializer=e}k(e,t,r,s){const i=new Cm("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(Bd)}(e),function(l){l.createObjectStore(sd,{keyPath:H4}),l.createObjectStore(Mr,{keyPath:CT,autoIncrement:!0}).createIndex(Po,RT,{unique:!0}),l.createObjectStore(Pl)}(e),_S(e),function(l){l.createObjectStore(Eo)}(e));let o=O.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(Dl),l.deleteObjectStore(kl),l.deleteObjectStore(Fo)}(e),_S(e)),o=o.next(()=>function(l){const u=l.store(Fo),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ae.min().toTimestamp(),targetCount:0};return u.put(xp,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(Mr).J().next(f=>{l.deleteObjectStore(Mr),l.createObjectStore(Mr,{keyPath:CT,autoIncrement:!0}).createIndex(Po,RT,{unique:!0});const p=u.store(Mr),y=f.map(x=>p.put(x));return O.waitFor(y)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(Ol,{keyPath:n3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(id)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(Rm,{keyPath:r3})})(e),function(l){l.createObjectStore(Nm,{keyPath:s3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(Pm,{keyPath:d3});u.createIndex(J_,h3,{unique:!1}),u.createIndex(YR,f3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(Ep,{keyPath:Q4});u.createIndex(_f,Y4),u.createIndex(GR,J4)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Eo))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(cw,{keyPath:i3,autoIncrement:!0}).createIndex(Y_,o3,{unique:!1}),l.createObjectStore(_u,{keyPath:a3}).createIndex(KR,l3,{unique:!1}),l.createObjectStore(vu,{keyPath:c3}).createIndex(QR,u3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(_u).clear()}).next(()=>{t.objectStore(vu).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(uw,{keyPath:p3})})(e)})),r<18&&s>=18&&XA()&&(o=o.next(()=>{t.objectStore(_u).clear()}).next(()=>{t.objectStore(vu).clear()})),o}wi(e){let t=0;return e.store(Eo).ee((r,s)=>{t+=Rp(s)}).next(()=>{const r={byteSize:t};return e.store(id).put(Q_,r)})}yi(e){const t=e.store(sd),r=e.store(Mr);return t.J().next(s=>O.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,Fi],[i.userId,i.lastAcknowledgedBatchId]);return r.J(Po,o).next(a=>O.forEach(a,l=>{ie(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=To(this.serializer,l);return sP(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(Dl),r=e.store(Eo);return e.store(Fo).get(xp).next(s=>{const i=[];return r.ee((o,a)=>{const l=new Ae(o),u=function(f){return[0,Nn(f)]}(l);i.push(t.get(u).next(h=>h?O.resolve():(f=>t.put({targetId:0,path:Nn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>O.waitFor(i))})}bi(e,t){e.createObjectStore(od,{keyPath:t3});const r=t.store(od),s=new Sw,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Nn(l)})}};return t.store(Eo).ee({X:!0},(o,a)=>{const l=new Ae(o);return i(l.popLast())}).next(()=>t.store(Pl).ee({X:!0},([o,a,l],u)=>{const h=rs(a);return i(h.popLast())}))}Di(e){const t=e.store(kl);return t.ee((r,s)=>{const i=Zc(s),o=eP(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(Eo),s=[];return r.ee((i,o)=>{const a=t.store(Ep),l=function(f){return f.document?new Q(Ae.fromString(f.document.name).popFirst(5)):f.noDocument?Q.fromSegments(f.noDocument.path):f.unknownDocument?Q.fromSegments(f.unknownDocument.path):ee(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>O.waitFor(s))}Fi(e,t){const r=t.store(Mr),s=dP(this.serializer),i=new Aw($m.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??ge();To(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),O.forEach(a,(l,u)=>{const h=new rn(u),f=Um.wt(this.serializer,h),p=i.getIndexManager(h),y=Bm.wt(h,this.serializer,p,i.referenceDelegate);return new hP(s,y,f,p).recalculateAndSaveOverlaysForDocumentKeys(new X_(t,Wn.ce),l).next()})})}}function _S(n){n.createObjectStore(Dl,{keyPath:Z4}).createIndex(lw,e3,{unique:!0}),n.createObjectStore(kl,{keyPath:"targetId"}).createIndex(HR,X4,{unique:!0}),n.createObjectStore(Fo)}const oi="IndexedDbPersistence",cy=18e5,uy=5e3,dy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",fP="main";class Cw{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!Cw.v())throw new B(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new g6(this,s),this.$i=t+fP,this.serializer=new ZN(l),this.Ui=new cs(this.$i,this.Ni,new C6(this.serializer)),this.hi=new i6,this.Pi=new f6(this.referenceDelegate,this.serializer),this.remoteDocumentCache=dP(this.serializer),this.Ii=new s6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&jt(oi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,dy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Wn(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Hh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(io(e))return $(oi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return $(oi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Bc(e).get(ka).next(t=>O.resolve(this.es(t)))}ts(e){return Hh(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,cy)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Jt(t,Ol);return r.J().next(s=>{const i=this.ss(s,cy),o=s.filter(a=>i.indexOf(a)===-1);return O.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?O.resolve(!0):Bc(e).get(ka).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,uy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,dy);return!1}}return!(!this.networkEnabled||!this.inForeground)||Hh(e).J().next(r=>this.ss(r,uy).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&$(oi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Bd,Ol],e=>{const t=new X_(e,Wn.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Hh(e).J().next(t=>this.ss(t,cy).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Bm.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new h6(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Um.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){$(oi,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?y3:l===17?eN:l===16?g3:l===15?dw:l===14?ZR:l===13?XR:l===12?m3:l===11?JR:void ee(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new X_(a,this.ci?this.ci.next():Wn.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw jt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new B(M.FAILED_PRECONDITION,BR);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Bc(e).get(ka).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,uy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new B(M.FAILED_PRECONDITION,dy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Bc(e).put(ka,t)}static v(){return cs.v()}Zi(e){const t=Bc(e);return t.get(ka).next(r=>this.es(r)?($(oi,"Releasing primary lease."),t.delete(ka)):O.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(jt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;JA()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return $(oi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return jt(oi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){jt("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Bc(n){return Jt(n,Bd)}function Hh(n){return Jt(n,Ol)}function Rw(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=ge(),s=ge();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Nw(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R6{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return JA()?8:zR(Yt())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new R6;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(Fa()<=Pe.DEBUG&&$("QueryEngine","SDK will not create cache indexes for query:",ja(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),O.resolve()):(Fa()<=Pe.DEBUG&&$("QueryEngine","Query:",ja(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Fa()<=Pe.DEBUG&&$("QueryEngine","The SDK decides to create cache indexes for query:",ja(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pn(t))):O.resolve())}ys(e,t){if($T(t))return O.resolve(null);let r=Pn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=bp(t,null,"F"),r=Pn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ge(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,bp(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return $T(t)||s.isEqual(ae.min())?O.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?O.resolve(null):(Fa()<=Pe.DEBUG&&$("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ja(t)),this.vs(e,o,t,jR(s,Cl)).next(a=>a))})}Ds(e,t){let r=new Je(TN(e));return t.forEach((s,i)=>{qd(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return Fa()<=Pe.DEBUG&&$("QueryEngine","Using full collection scan to execute query:",ja(t)),this.ps.getDocumentsMatchingQuery(e,t,mr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pw="LocalStore",N6=3e8;class P6{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new at(ue),this.xs=new Gs(i=>Zo(i),$d),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hP(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function mP(n,e,t,r){return new P6(n,e,t,r)}async function gP(n,e){const t=Y(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ge();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function k6(n,e){const t=Y(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,p=f.keys();let y=O.resolve();return p.forEach(x=>{y=y.next(()=>h.getEntry(l,x)).next(T=>{const P=u.docVersions.get(x);ie(P!==null,48541),T.version.compareTo(P)<0&&(f.applyToRemoteDocument(T,u),T.isValidDocument()&&(T.setReadTime(u.commitVersion),h.addEntry(T)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ge();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function yP(n){const e=Y(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function D6(n,e){const t=Y(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const p=s.get(f);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Dt.EMPTY_BYTE_STRING,ae.min()).withLastLimboFreeSnapshotVersion(ae.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(T,P,R){return T.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=N6?!0:R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}(p,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let l=Hn(),u=ge();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(_P(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(ae.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return O.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function _P(n,e,t){let r=ge(),s=ge();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Hn();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(ae.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):$(Pw,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function O6(n,e){const t=Y(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Fi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Bl(n,e){const t=Y(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new As(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function $l(n,e,t){const r=Y(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!io(o))throw o;$(Pw,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Pp(n,e,t){const r=Y(n);let s=ae.min(),i=ge();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=Y(l),p=f.xs.get(h);return p!==void 0?O.resolve(f.Ms.get(p)):f.Pi.getTargetData(u,h)}(r,o,Pn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:ae.min(),t?i:ge())).next(a=>(IP(r,xN(e),a),{documents:a,Qs:i})))}function vP(n,e){const t=Y(n),r=Y(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function wP(n,e){const t=Y(n),r=t.Os.get(e)||ae.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,jR(r,Cl),Number.MAX_SAFE_INTEGER)).then(s=>(IP(t,e,s),s))}function IP(n,e,t){let r=n.Os.get(e)||ae.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function M6(n,e,t,r){const s=Y(n);let i=ge(),o=Hn();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Bl(s,function(h){return Pn(nc(Ae.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>_P(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function L6(n,e,t=ge()){const r=await Bl(n,Pn(jm(e.bundledQuery))),s=Y(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Ut(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(Dt.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EP="firestore_clients";function vS(n,e){return`${EP}_${n}_${e}`}const xP="firestore_mutations";function wS(n,e,t){let r=`${xP}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const TP="firestore_targets";function hy(n,e){return`${TP}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zr="SharedClientState";class kp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new B(s.error.code,s.error.message))),o?new kp(e,t,s.state,i):(jt(Zr,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Tu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new B(r.error.code,r.error.message))),i?new Tu(e,r.state,s):(jt(Zr,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Dp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=gw();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=qR(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Dp(e,i):(jt(Zr,`Failed to parse client data for instance '${e}': ${t}`),null)}}class kw{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new kw(t.clientId,t.onlineState):(jt(Zr,`Failed to parse online state: ${e}`),null)}}class hv{constructor(){this.activeTargetIds=gw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class fy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new at(ue),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=vS(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new hv),this.ro=new RegExp(`^${EP}_${o}_([^_]*)$`),this.io=new RegExp(`^${xP}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${TP}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(vS(this.persistenceKey,r));if(s){const i=Dp.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(hy(this.persistenceKey,e));if(s){const i=Tu.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(hy(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return $(Zr,"READ",e,t),t}setItem(e,t){$(Zr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){$(Zr,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if($(Zr,"EVENT",t.key,t.newValue),t.key===this.eo)return void jt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=Wn.ce;if(i!=null)try{const a=JSON.parse(i);ie(typeof a=="number",30636,{So:i}),o=a}catch(a){jt(Zr,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Wn.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new kp(this.currentUser,e,t,r),i=wS(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=wS(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=hy(this.persistenceKey,e),i=new Tu(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return Dp.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return kp.Ws(new rn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return Tu.Ws(s,t)}uo(e){return kw.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);$(Zr,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=gw();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class SP{constructor(){this.Mo=new hv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new hv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IS="ConnectivityMonitor";class ES{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){$(IS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){$(IS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kh=null;function fv(){return Kh===null?Kh=function(){return 268435456+Math.round(2147483648*Math.random())}():Kh++,"0x"+Kh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const py="RestConnection",F6={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class j6{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===ld?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=fv(),a=this.zo(e,t.toUriEncodedString());$(py,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=qs(u);return this.Jo(e,a,l,r,h).then(f=>($(py,`Received RPC '${e}' ${o}: `,f),f),f=>{throw Cr(py,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+tc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=F6[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U6{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bn="WebChannelConnection";class B6 extends j6{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=fv();return new Promise((a,l)=>{const u=new RR;u.setWithCredentials(!0),u.listenOnce(NR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case gf.NO_ERROR:const f=u.getResponseJson();$(bn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case gf.TIMEOUT:$(bn,`RPC '${e}' ${o} timed out`),l(new B(M.DEADLINE_EXCEEDED,"Request time out"));break;case gf.HTTP_ERROR:const p=u.getStatus();if($(bn,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const x=y==null?void 0:y.error;if(x&&x.status&&x.message){const T=function(R){const b=R.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(b)>=0?b:M.UNKNOWN}(x.status);l(new B(T,x.message))}else l(new B(M.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new B(M.UNAVAILABLE,"Connection failed."));break;default:ee(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{$(bn,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);$(bn,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=fv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=DR(),a=kR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");$(bn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,y=!1;const x=new U6({Yo:P=>{y?$(bn,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(p||($(bn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),$(bn,`RPC '${e}' stream ${s} sending:`,P),f.send(P))},Zo:()=>f.close()}),T=(P,R,b)=>{P.listen(R,N=>{try{b(N)}catch(k){setTimeout(()=>{throw k},0)}})};return T(f,Yc.EventType.OPEN,()=>{y||($(bn,`RPC '${e}' stream ${s} transport opened.`),x.o_())}),T(f,Yc.EventType.CLOSE,()=>{y||(y=!0,$(bn,`RPC '${e}' stream ${s} transport closed`),x.a_(),this.E_(f))}),T(f,Yc.EventType.ERROR,P=>{y||(y=!0,Cr(bn,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),x.a_(new B(M.UNAVAILABLE,"The operation could not be completed")))}),T(f,Yc.EventType.MESSAGE,P=>{var R;if(!y){const b=P.data[0];ie(!!b,16349);const N=b,k=(N==null?void 0:N.error)||((R=N[0])==null?void 0:R.error);if(k){$(bn,`RPC '${e}' stream ${s} received error:`,k);const U=k.status;let V=function(S){const _=zt[S];if(_!==void 0)return FN(_)}(U),A=k.message;V===void 0&&(V=M.INTERNAL,A="Unknown error status: "+U+" with message "+k.message),y=!0,x.a_(new B(V,A)),f.close()}else $(bn,`RPC '${e}' stream ${s} received:`,b),x.u_(b)}}),T(a,PR.STAT_EVENT,P=>{P.stat===q_.PROXY?$(bn,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===q_.NOPROXY&&$(bn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.__()},0),x}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bP(){return typeof window<"u"?window:null}function Sf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _a(n){return new H3(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&$("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS="PersistentStream";class AP{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Dw(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(jt(t.toString()),jt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new B(M.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return $(xS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():($(xS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $6 extends AP{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Y3(this.serializer,e),r=function(i){if(!("targetChange"in i))return ae.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ae.min():o.readTime?Ut(o.readTime):ae.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=av(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Tp(l)?{documents:HN(i,l)}:{query:Fm(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=$N(i,o.resumeToken);const u=iv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ae.min())>0){a.readTime=Ul(i,o.snapshotVersion.toTimestamp());const u=iv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=X3(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=av(this.serializer),t.removeTarget=e,this.q_(t)}}class z6 extends AP{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ie(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ie(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ie(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=J3(e.writeResults,e.commitTime),r=Ut(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=av(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>fd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q6{}class W6 extends q6{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,ov(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new B(M.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,ov(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new B(M.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class G6{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(jt(t),this.aa=!1):$("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ia="RemoteStore";class H6{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{ao(this)&&($(ia,"Restarting streams for network reachability change."),await async function(l){const u=Y(l);u.Ea.add(4),await ic(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Kd(u)}(this))})}),this.Ra=new G6(r,s)}}async function Kd(n){if(ao(n))for(const e of n.da)await e(!0)}async function ic(n){for(const e of n.da)await e(!1)}function zm(n,e){const t=Y(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Lw(t)?Mw(t):ac(t).O_()&&Ow(t,e))}function zl(n,e){const t=Y(n),r=ac(t);t.Ia.delete(e),r.O_()&&CP(t,e),t.Ia.size===0&&(r.O_()?r.L_():ao(t)&&t.Ra.set("Unknown"))}function Ow(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ae.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ac(n).Y_(e)}function CP(n,e){n.Va.Ue(e),ac(n).Z_(e)}function Mw(n){n.Va=new z3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),ac(n).start(),n.Ra.ua()}function Lw(n){return ao(n)&&!ac(n).x_()&&n.Ia.size>0}function ao(n){return Y(n).Ea.size===0}function RP(n){n.Va=void 0}async function K6(n){n.Ra.set("Online")}async function Q6(n){n.Ia.forEach((e,t)=>{Ow(n,e)})}async function Y6(n,e){RP(n),Lw(n)?(n.Ra.ha(e),Mw(n)):n.Ra.set("Unknown")}async function J6(n,e,t){if(n.Ra.set("Online"),e instanceof BN&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){$(ia,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Op(n,r)}else if(e instanceof xf?n.Va.Ze(e):e instanceof UN?n.Va.st(e):n.Va.tt(e),!t.isEqual(ae.min()))try{const r=await yP(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(Dt.EMPTY_BYTE_STRING,h.snapshotVersion)),CP(i,l);const f=new As(h.target,l,u,h.sequenceNumber);Ow(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){$(ia,"Failed to raise snapshot:",r),await Op(n,r)}}async function Op(n,e,t){if(!io(e))throw e;n.Ea.add(1),await ic(n),n.Ra.set("Offline"),t||(t=()=>yP(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{$(ia,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Kd(n)})}function NP(n,e){return e().catch(t=>Op(n,t,e))}async function oc(n){const e=Y(n),t=Ji(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Fi;for(;X6(e);)try{const s=await O6(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Z6(e,s)}catch(s){await Op(e,s)}PP(e)&&kP(e)}function X6(n){return ao(n)&&n.Ta.length<10}function Z6(n,e){n.Ta.push(e);const t=Ji(n);t.O_()&&t.X_&&t.ea(e.mutations)}function PP(n){return ao(n)&&!Ji(n).x_()&&n.Ta.length>0}function kP(n){Ji(n).start()}async function eU(n){Ji(n).ra()}async function tU(n){const e=Ji(n);for(const t of n.Ta)e.ea(t.mutations)}async function nU(n,e,t){const r=n.Ta.shift(),s=ww.from(r,e,t);await NP(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await oc(n)}async function rU(n,e){e&&Ji(n).X_&&await async function(r,s){if(function(o){return VN(o)&&o!==M.ABORTED}(s.code)){const i=r.Ta.shift();Ji(r).B_(),await NP(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await oc(r)}}(n,e),PP(n)&&kP(n)}async function TS(n,e){const t=Y(n);t.asyncQueue.verifyOperationInProgress(),$(ia,"RemoteStore received new credentials");const r=ao(t);t.Ea.add(3),await ic(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Kd(t)}async function pv(n,e){const t=Y(n);e?(t.Ea.delete(2),await Kd(t)):e||(t.Ea.add(2),await ic(t),t.Ra.set("Unknown"))}function ac(n){return n.ma||(n.ma=function(t,r,s){const i=Y(t);return i.sa(),new $6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:K6.bind(null,n),t_:Q6.bind(null,n),r_:Y6.bind(null,n),H_:J6.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Lw(n)?Mw(n):n.Ra.set("Unknown")):(await n.ma.stop(),RP(n))})),n.ma}function Ji(n){return n.fa||(n.fa=function(t,r,s){const i=Y(t);return i.sa(),new z6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:eU.bind(null,n),r_:rU.bind(null,n),ta:tU.bind(null,n),na:nU.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await oc(n)):(await n.fa.stop(),n.Ta.length>0&&($(ia,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new an,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Vw(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lc(n,e){if(jt("AsyncQueue",`${e}: ${n}`),io(n))return new B(M.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{static emptySet(e){return new jo(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Q.comparator(t.key,r.key):(t,r)=>Q.comparator(t.key,r.key),this.keyedMap=Jc(),this.sortedSet=new at(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof jo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new jo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SS{constructor(){this.ga=new at(Q.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ee(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class oa{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new oa(e,t,jo.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class iU{constructor(){this.queries=bS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Y(t),i=s.queries;s.queries=bS(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new B(M.ABORTED,"Firestore shutting down"))}}function bS(){return new Gs(n=>EN(n),zd)}async function Fw(n,e){const t=Y(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new sU,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=lc(o,`Initialization of query '${ja(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Uw(t)}async function jw(n,e){const t=Y(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function oU(n,e){const t=Y(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&Uw(t)}function aU(n,e,t){const r=Y(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Uw(n){n.Ca.forEach(e=>{e.next()})}var mv,AS;(AS=mv||(mv={})).Ma="default",AS.Cache="cache";class Bw{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new oa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=oa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==mv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CS{constructor(e){this.serializer=e}$s(e){return us(this.serializer,e)}Us(e){return e.metadata.exists?Vm(this.serializer,e.document,!1):ft.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Ut(e)}}class $w{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=OP(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=Ae.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new CS(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||ge()).add(i);t.set(o,a)}}return t}async ja(e){const t=await M6(e,new CS(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await L6(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function OP(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(e){this.key=e}}class LP{constructor(e){this.key=e}}class VP{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ge(),this.mutatedKeys=ge(),this.eu=TN(e),this.tu=new jo(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new SS,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const p=s.get(h),y=qd(this.query,f)?f:null,x=!!p&&this.mutatedKeys.has(p.key),T=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let P=!1;p&&y?p.data.isEqual(y.data)?x!==T&&(r.track({type:3,doc:y}),P=!0):this.su(p,y)||(r.track({type:2,doc:y}),P=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!p&&y?(r.track({type:0,doc:y}),P=!0):p&&!y&&(r.track({type:1,doc:p}),P=!0,(l||u)&&(a=!0)),P&&(y?(o=o.add(y),i=T?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,x){const T=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ee(20277,{Rt:P})}};return T(y)-T(x)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new oa(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new SS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ge(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new LP(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new MP(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=ge();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return oa.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const lo="SyncEngine";class lU{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class cU{constructor(e){this.key=e,this.hu=!1}}class uU{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Gs(a=>EN(a),zd),this.Iu=new Map,this.Eu=new Set,this.du=new at(Q.comparator),this.Au=new Map,this.Ru=new bw,this.Vu={},this.mu=new Map,this.fu=sa.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function dU(n,e,t=!0){const r=qm(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await FP(r,e,t,!0),s}async function hU(n,e){const t=qm(n);await FP(t,e,!0,!1)}async function FP(n,e,t,r){const s=await Bl(n.localStore,Pn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await zw(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&zm(n.remoteStore,s),a}async function zw(n,e,t,r,s){n.pu=(f,p,y)=>async function(T,P,R,b){let N=P.view.ru(R);N.Cs&&(N=await Pp(T.localStore,P.query,!1).then(({documents:A})=>P.view.ru(A,N)));const k=b&&b.targetChanges.get(P.targetId),U=b&&b.targetMismatches.get(P.targetId)!=null,V=P.view.applyChanges(N,T.isPrimaryClient,k,U);return gv(T,P.targetId,V.au),V.snapshot}(n,f,p,y);const i=await Pp(n.localStore,e,!0),o=new VP(e,i.Qs),a=o.ru(i.documents),l=Hd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);gv(n,t,u.au);const h=new lU(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function fU(n,e,t){const r=Y(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!zd(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await $l(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&zl(r.remoteStore,s.targetId),ql(r,s.targetId)}).catch(so)):(ql(r,s.targetId),await $l(r.localStore,s.targetId,!0))}async function pU(n,e){const t=Y(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),zl(t.remoteStore,r.targetId))}async function mU(n,e,t){const r=Hw(n);try{const s=await function(o,a){const l=Y(o),u=Ke.now(),h=a.reduce((y,x)=>y.add(x.key),ge());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let x=Hn(),T=ge();return l.Ns.getEntries(y,h).next(P=>{x=P,x.forEach((R,b)=>{b.isValidDocument()||(T=T.add(R))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,x)).next(P=>{f=P;const R=[];for(const b of a){const N=U3(b,f.get(b.key).overlayedDocument);N!=null&&R.push(new Hs(b.key,N,dN(N.value.mapValue),Et.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,R,a)}).next(P=>{p=P;const R=P.applyToLocalDocumentSet(f,T);return l.documentOverlayCache.saveOverlays(y,P.batchId,R)})}).then(()=>({batchId:p.batchId,changes:bN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new at(ue)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Ks(r,s.changes),await oc(r.remoteStore)}catch(s){const i=lc(s,"Failed to persist write");t.reject(i)}}async function jP(n,e){const t=Y(n);try{const r=await D6(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(ie(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?ie(o.hu,14607):s.removedDocuments.size>0&&(ie(o.hu,42227),o.hu=!1))}),await Ks(t,r,e)}catch(r){await so(r)}}function RS(n,e,t){const r=Y(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Y(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const p of f.Sa)p.va(a)&&(u=!0)}),u&&Uw(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function gU(n,e,t){const r=Y(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new at(Q.comparator);o=o.insert(i,ft.newNoDocument(i,ae.min()));const a=ge().add(i),l=new Gd(ae.min(),new Map,new at(ue),o,a);await jP(r,l),r.du=r.du.remove(i),r.Au.delete(e),Gw(r)}else await $l(r.localStore,e,!1).then(()=>ql(r,e,t)).catch(so)}async function yU(n,e){const t=Y(n),r=e.batch.batchId;try{const s=await k6(t.localStore,e);Ww(t,r,null),qw(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ks(t,s)}catch(s){await so(s)}}async function _U(n,e,t){const r=Y(n);try{const s=await function(o,a){const l=Y(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(ie(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);Ww(r,e,t),qw(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ks(r,s)}catch(s){await so(s)}}async function vU(n,e){const t=Y(n);ao(t.remoteStore)||$(lo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Y(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===Fi)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=lc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function qw(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Ww(n,e,t){const r=Y(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function ql(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||UP(n,r)})}function UP(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(zl(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Gw(n))}function gv(n,e,t){for(const r of t)r instanceof MP?(n.Ru.addReference(r.key,e),wU(n,r)):r instanceof LP?($(lo,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||UP(n,r.key)):ee(19791,{wu:r})}function wU(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||($(lo,"New document in limbo: "+t),n.Eu.add(r),Gw(n))}function Gw(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Q(Ae.fromString(e)),r=n.fu.next();n.Au.set(r,new cU(t)),n.du=n.du.insert(t,r),zm(n.remoteStore,new As(Pn(nc(t.path)),r,"TargetPurposeLimboResolution",Wn.ce))}}async function Ks(n,e,t){const r=Y(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=Nw.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=Y(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>O.forEach(u,p=>O.forEach(p.Es,y=>h.persistence.referenceDelegate.addReference(f,p.targetId,y)).next(()=>O.forEach(p.ds,y=>h.persistence.referenceDelegate.removeReference(f,p.targetId,y)))))}catch(f){if(!io(f))throw f;$(Pw,"Failed to update sequence numbers: "+f)}for(const f of u){const p=f.targetId;if(!f.fromCache){const y=h.Ms.get(p),x=y.snapshotVersion,T=y.withLastLimboFreeSnapshotVersion(x);h.Ms=h.Ms.insert(p,T)}}}(r.localStore,i))}async function IU(n,e){const t=Y(n);if(!t.currentUser.isEqual(e)){$(lo,"User change. New user:",e.toKey());const r=await gP(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new B(M.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ks(t,r.Ls)}}function EU(n,e){const t=Y(n),r=t.Au.get(e);if(r&&r.hu)return ge().add(r.key);{let s=ge();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function xU(n,e){const t=Y(n),r=await Pp(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&gv(t,e.targetId,s.au),s}async function TU(n,e){const t=Y(n);return wP(t.localStore,e).then(r=>Ks(t,r))}async function SU(n,e,t,r){const s=Y(n),i=await function(a,l){const u=Y(a),h=Y(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(p=>p?u.localDocuments.getDocuments(f,p):O.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await oc(s.remoteStore):t==="acknowledged"||t==="rejected"?(Ww(s,e,r||null),qw(s,e),function(a,l){Y(Y(a).mutationQueue).ir(l)}(s.localStore,e)):ee(6720,"Unknown batchState",{Su:t}),await Ks(s,i)):$(lo,"Cannot apply mutation batch with id: "+e)}async function bU(n,e){const t=Y(n);if(qm(t),Hw(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await NS(t,r.toArray());t.gu=!0,await pv(t.remoteStore,!0);for(const i of s)zm(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(ql(t,o),$l(t.localStore,o,!0))),zl(t.remoteStore,o)}),await s,await NS(t,r),function(o){const a=Y(o);a.Au.forEach((l,u)=>{zl(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new at(Q.comparator)}(t),t.gu=!1,await pv(t.remoteStore,!1)}}async function NS(n,e,t){const r=Y(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Bl(r.localStore,Pn(l[0]));for(const u of l){const h=r.Tu.get(u),f=await xU(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await vP(r.localStore,o);a=await Bl(r.localStore,u),await zw(r,BP(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function BP(n){return vN(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function AU(n){return function(t){return Y(Y(t).persistence).Ts()}(Y(n).localStore)}async function CU(n,e,t,r){const s=Y(n);if(s.gu)return void $(lo,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await wP(s.localStore,xN(i[0])),a=Gd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Dt.EMPTY_BYTE_STRING);await Ks(s,o,a);break}case"rejected":await $l(s.localStore,e,!0),ql(s,e,r);break;default:ee(64155,t)}}async function RU(n,e,t){const r=qm(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){$(lo,"Adding an already active target "+s);continue}const i=await vP(r.localStore,s),o=await Bl(r.localStore,i);await zw(r,BP(i),o.targetId,!1,o.resumeToken),zm(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await $l(r.localStore,s,!1).then(()=>{zl(r.remoteStore,s),ql(r,s)}).catch(so)}}function qm(n){const e=Y(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=jP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=EU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gU.bind(null,e),e.Pu.H_=oU.bind(null,e.eventManager),e.Pu.yu=aU.bind(null,e.eventManager),e}function Hw(n){const e=Y(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=yU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_U.bind(null,e),e}function NU(n,e,t){const r=Y(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,x){const T=Y(y),P=Ut(x.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",R=>T.Ii.getBundleMetadata(R,x.id)).then(R=>!!R&&R.createTime.compareTo(P)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(OP(l));const u=new $w(l,o.serializer);let h=await o.bu();for(;h;){const p=await u.Ga(h);p&&a._updateProgress(p),h=await o.bu()}const f=await u.ja(i.localStore);return await Ks(i,f.Ha,void 0),await function(y,x){const T=Y(y);return T.persistence.runTransaction("Save bundle","readwrite",P=>T.Ii.saveBundleMetadata(P,x))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return Cr(lo,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Wl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_a(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return mP(this.persistence,new pP,e.initialUser,this.serializer)}Cu(e){return new Aw($m.mi,this.serializer)}Du(e){return new SP}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Wl.provider={build:()=>new Wl};class Kw extends Wl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ie(this.persistence.referenceDelegate instanceof Np,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new lP(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?An.withCacheSize(this.cacheSizeBytes):An.DEFAULT;return new Aw(r=>Np.mi(r,t),this.serializer)}}class Qw extends Wl{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Hw(this.xu.syncEngine),await oc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return mP(this.persistence,new pP,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new lP(r,e.asyncQueue,t)}Mu(e,t){const r=new W4(t,this.persistence);return new q4(e.asyncQueue,r)}Cu(e){const t=Rw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?An.withCacheSize(this.cacheSizeBytes):An.DEFAULT;return new Cw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,bP(),Sf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new SP}}class $P extends Qw{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof fy&&(this.sharedClientState.syncEngine={Co:SU.bind(null,t),vo:CU.bind(null,t),Fo:RU.bind(null,t),Ts:AU.bind(null,t),Do:TU.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await bU(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=bP();if(!fy.v(t))throw new B(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Rw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new fy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Xi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>RS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=IU.bind(null,this.syncEngine),await pv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new iU}()}createDatastore(e){const t=_a(e.databaseInfo.databaseId),r=function(i){return new B6(i)}(e.databaseInfo);return function(i,o,a,l){return new W6(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new H6(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>RS(this.syncEngine,t,0),function(){return ES.v()?new ES:new V6}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new uU(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Y(s);$(ia,"RemoteStore shutting down."),i.Ea.add(5),await ic(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Xi.provider={build:()=>new Xi};function PS(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):jt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PU{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new an,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new DP(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kU{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new DP(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new B(M.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DU{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new B(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Y(s),a={documents:i.map(f=>hd(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Ae.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const p=Q3(o.serializer,f);u.set(p.key.toString(),p)});const h=[];return i.forEach(f=>{const p=u.get(f.toString());ie(!!p,55234,{key:f}),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new sc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Q.fromPath(r);this.mutations.push(new _w(s,this.precondition(s)))}),await async function(r,s){const i=Y(r),o={writes:s.map(a=>fd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,Ae.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ee(50498,{Gu:e.constructor.name});t=ae.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new B(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ae.min())?Et.exists(!1):Et.updateTime(t):Et.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ae.min()))throw new B(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Et.updateTime(t)}return Et.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OU{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new Dw(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new DU(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!Ud(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!VN(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi="FirestoreClient";class MU{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=rn.UNAUTHENTICATED,this.clientId=sw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{$(Zi,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>($(Zi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new an;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=lc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function my(n,e){n.asyncQueue.verifyOperationInProgress(),$(Zi,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await gP(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function kS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Yw(n);$(Zi,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>TS(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>TS(e.remoteStore,s)),n._onlineComponents=e}async function Yw(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){$(Zi,"Using user provided OfflineComponentProvider");try{await my(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===M.FAILED_PRECONDITION||s.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Cr("Error using user provided cache. Falling back to memory cache: "+t),await my(n,new Wl)}}else $(Zi,"Using default OfflineComponentProvider"),await my(n,new Kw(void 0));return n._offlineComponents}async function Gm(n){return n._onlineComponents||(n._uninitializedComponentsProvider?($(Zi,"Using user provided OnlineComponentProvider"),await kS(n,n._uninitializedComponentsProvider._online)):($(Zi,"Using default OnlineComponentProvider"),await kS(n,new Xi))),n._onlineComponents}function zP(n){return Yw(n).then(e=>e.persistence)}function cc(n){return Yw(n).then(e=>e.localStore)}function qP(n){return Gm(n).then(e=>e.remoteStore)}function Jw(n){return Gm(n).then(e=>e.syncEngine)}function WP(n){return Gm(n).then(e=>e.datastore)}async function Gl(n){const e=await Gm(n),t=e.eventManager;return t.onListen=dU.bind(null,e.syncEngine),t.onUnlisten=fU.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=hU.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=pU.bind(null,e.syncEngine),t}function LU(n){return n.asyncQueue.enqueue(async()=>{const e=await zP(n),t=await qP(n);return e.setNetworkEnabled(!0),function(s){const i=Y(s);return i.Ea.delete(0),Kd(i)}(t)})}function VU(n){return n.asyncQueue.enqueue(async()=>{const e=await zP(n),t=await qP(n);return e.setNetworkEnabled(!1),async function(s){const i=Y(s);i.Ea.add(0),await ic(i),i.Ra.set("Offline")}(t)})}function FU(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=Y(u);return f.persistence.runTransaction("read document","readonly",p=>f.localDocuments.getDocument(p,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new B(M.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=lc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await cc(n),e,t)),t.promise}function GP(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Wm({next:p=>{h.Nu(),o.enqueueAndForget(()=>jw(i,f));const y=p.docs.has(a);!y&&p.fromCache?u.reject(new B(M.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&l&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new Bw(nc(a.path),h,{includeMetadataChanges:!0,qa:!0});return Fw(i,f)}(await Gl(n),n.asyncQueue,e,t,r)),r.promise}function jU(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Pp(s,i,!0),l=new VP(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=lc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await cc(n),e,t)),t.promise}function HP(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Wm({next:p=>{h.Nu(),o.enqueueAndForget(()=>jw(i,f)),p.fromCache&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new Bw(a,h,{includeMetadataChanges:!0,qa:!0});return Fw(i,f)}(await Gl(n),n.asyncQueue,e,t,r)),r.promise}function UU(n,e,t){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await WP(n);r.resolve(async function(o,a,l){var T;const u=Y(o),{request:h,gt:f,parent:p}=KN(u.serializer,wN(a),l);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,p,h,1)).filter(P=>!!P.result);ie(y.length===1,64727);const x=(T=y[0].result)==null?void 0:T.aggregateFields;return Object.keys(x).reduce((P,R)=>(P[f[R]]=x[R],P),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function BU(n,e){const t=new Wm(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Y(s).Ca.add(i),i.next()}(await Gl(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Y(s).Ca.delete(i)}(await Gl(n),t))}}function $U(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?jN().encode(o):o,function(h,f){return new PU(h,f)}(function(h,f){if(h instanceof Uint8Array)return PS(h,f);if(h instanceof ArrayBuffer)return PS(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,_a(e));n.asyncQueue.enqueueAndForget(async()=>{NU(await Jw(n),s,r)})}function zU(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Y(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await cc(n),e))}function KP(n,e){return function(r,s){return new kU(r,s)}(n,e)}function qU(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Y(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,p,y,x,T){f=[...f],p=[...p],f.sort(y),p.sort(y);const P=f.length,R=p.length;let b=0,N=0;for(;b<R&&N<P;){const k=y(f[N],p[b]);k<0?T(f[N++]):k>0?x(p[b++]):(b++,N++)}for(;b<R;)x(p[b++]);for(;N<P;)T(f[N++])}(u,s,U4,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>O.waitFor(a)))}(await cc(n),e))}function WU(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Y(r).Fs.Vs=s}(await cc(n),e))}function GU(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Y(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await cc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DS=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YP="firestore.googleapis.com",OS=!0;class MS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=YP,this.ssl=OS}else this.host=e.host,this.ssl=e.ssl??OS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=rP;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<aP)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}j4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=QP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qd{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new MS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new MS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new R4;switch(r.type){case"firstParty":return new D4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new B(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=DS.get(t);r&&($("ComponentProvider","Removing Datastore"),DS.delete(t),r.terminate())}(this),Promise.resolve()}}function HU(n,e,t,r={}){var u;n=ke(n,Qd);const s=qs(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(om(`https://${a}`),g0("Firestore",!0)),i.host!==YP&&i.host!==a&&Cr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!fr(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=rn.MOCK_USER;else{h=HA(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new B(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new rn(p)}n._authCredentials=new N4(new MR(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new un(this.firestore,e,this._query)}}class Ze{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ds(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ze(this.firestore,e,this._key)}toJSON(){return{type:Ze._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ya(t,Ze._jsonSchema))return new Ze(e,r||null,new Q(Ae.fromString(t.referencePath)))}}Ze._jsonSchemaVersion="firestore/documentReference/1.0",Ze._jsonSchema={type:Gt("string",Ze._jsonSchemaVersion),referencePath:Gt("string")};class ds extends un{constructor(e,t,r){super(e,t,nc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ze(this.firestore,null,new Q(e))}withConverter(e){return new ds(this.firestore,e,this._path)}}function gy(n,e,...t){if(n=X(n),iw("collection","path",e),n instanceof Qd){const r=Ae.fromString(e,...t);return xT(r),new ds(n,null,r)}{if(!(n instanceof Ze||n instanceof ds))throw new B(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return xT(r),new ds(n.firestore,null,r)}}function o8(n,e){if(n=ke(n,Qd),iw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new un(n,null,function(r){return new Ws(Ae.emptyPath(),r)}(e))}function eu(n,e,...t){if(n=X(n),arguments.length===1&&(e=sw.newId()),iw("doc","path",e),n instanceof Qd){const r=Ae.fromString(e,...t);return ET(r),new Ze(n,null,new Q(r))}{if(!(n instanceof Ze||n instanceof ds))throw new B(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return ET(r),new Ze(n.firestore,n instanceof ds?n.converter:null,new Q(r))}}function a8(n,e){return n=X(n),e=X(e),(n instanceof Ze||n instanceof ds)&&(e instanceof Ze||e instanceof ds)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function JP(n,e){return n=X(n),e=X(e),n instanceof un&&e instanceof un&&n.firestore===e.firestore&&zd(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS="AsyncQueue";class VS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Dw(this,"async_queue_retry"),this._c=()=>{const r=Sf();r&&$(LS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Sf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Sf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new an;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!io(e))throw e;$(LS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,jt("INTERNAL UNHANDLED ERROR: ",FS(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Vw.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ee(47125,{Pc:FS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function FS(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class KU{constructor(){this._progressObserver={},this._taskCompletionResolver=new an,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l8=-1;class nt extends Qd{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new VS,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new VS(e),this._firestoreClient=void 0,await e}}}function c8(n,e,t){t||(t=ld);const r=gs(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(fr(i,e))return s;throw new B(M.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new B(M.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<aP)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&qs(e.host)&&om(e.host),r.initialize({options:e,instanceIdentifier:t})}function QU(n,e){const t=typeof n=="object"?n:Rd(),r=typeof n=="string"?n:e||ld,s=gs(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=qA("firestore");i&&HU(s,...i)}return s}function At(n){if(n._terminated)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||XP(n),n._firestoreClient}function XP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new v3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,QP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new MU(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function u8(n,e){Cr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return ZP(n,Xi.provider,{build:r=>new Qw(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function d8(n){Cr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();ZP(n,Xi.provider,{build:t=>new $P(t,e.cacheSizeBytes)})}function ZP(n,e,t){if((n=ke(n,nt))._firestoreClient||n._terminated)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new B(M.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},XP(n)}function h8(n){if(n._initialized&&!n._terminated)throw new B(M.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new an;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!cs.v())return Promise.resolve();const s=r+fP;await cs.delete(s)}(Rw(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function f8(n){return function(t){const r=new an;return t.asyncQueue.enqueueAndForget(async()=>vU(await Jw(t),r)),r.promise}(At(n=ke(n,nt)))}function p8(n){return LU(At(n=ke(n,nt)))}function m8(n){return VU(At(n=ke(n,nt)))}function g8(n){return YL(n.app,"firestore",n._databaseId.database),n._delete()}function jS(n,e){const t=At(n=ke(n,nt)),r=new KU;return $U(t,n._databaseId,e,r),r}function YU(n,e){return zU(At(n=ke(n,nt)),e).then(t=>t?new un(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pd{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class JU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this._byteString=e}static fromBase64String(e){try{return new or(Dt.fromBase64String(e))}catch(t){throw new B(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new or(Dt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:or._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ya(e,or._jsonSchema))return or.fromBase64String(e.bytes)}}or._jsonSchemaVersion="firestore/bytes/1.0",or._jsonSchema={type:Gt("string",or._jsonSchemaVersion),bytes:Gt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function y8(){return new va(H_)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ue(this._lat,e._lat)||ue(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:hs._jsonSchemaVersion}}static fromJSON(e){if(ya(e,hs._jsonSchema))return new hs(e.latitude,e.longitude)}}hs._jsonSchemaVersion="firestore/geoPoint/1.0",hs._jsonSchema={type:Gt("string",hs._jsonSchemaVersion),latitude:Gt("number"),longitude:Gt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:$r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ya(e,$r._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new $r(e.vectorValues);throw new B(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$r._jsonSchemaVersion="firestore/vectorValue/1.0",$r._jsonSchema={type:Gt("string",$r._jsonSchemaVersion),vectorValues:Gt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XU=/^__.*__$/;class ZU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Hs(e,this.data,this.fieldMask,t,this.fieldTransforms):new rc(e,this.data,t,this.fieldTransforms)}}class ek{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Hs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function tk(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ee(40011,{Ac:n})}}class Hm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Hm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Mp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(tk(this.Ac)&&XU.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class e5{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||_a(e)}Cc(e,t,r,s=!1){return new Hm({Ac:e,methodName:t,Dc:r,path:It.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ia(n){const e=n._freezeSettings(),t=_a(n._databaseId);return new e5(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Km(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);sI("Data must be an object, but it was:",o,r);const a=sk(r,o);let l,u;if(i.merge)l=new Gn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const p=md(e,f,t);if(!o.contains(p))throw new B(M.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);ok(h,p)||h.push(p)}l=new Gn(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new ZU(new _n(a),l,u)}class Yd extends wa{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Yd}}function nk(n,e,t){return new Hm({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Xw extends wa{_toFieldTransform(e){return new Wd(e.path,new Fl)}isEqual(e){return e instanceof Xw}}class Zw extends wa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=nk(this,e,!0),r=this.vc.map(i=>Ea(i,t)),s=new ea(r);return new Wd(e.path,s)}isEqual(e){return e instanceof Zw&&fr(this.vc,e.vc)}}class eI extends wa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=nk(this,e,!0),r=this.vc.map(i=>Ea(i,t)),s=new ta(r);return new Wd(e.path,s)}isEqual(e){return e instanceof eI&&fr(this.vc,e.vc)}}class tI extends wa{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new jl(e.serializer,RN(e.serializer,this.Fc));return new Wd(e.path,t)}isEqual(e){return e instanceof tI&&this.Fc===e.Fc}}function nI(n,e,t,r){const s=n.Cc(1,e,t);sI("Data must be an object, but it was:",s,r);const i=[],o=_n.empty();oo(r,(l,u)=>{const h=Qm(e,l,t);u=X(u);const f=s.yc(h);if(u instanceof Yd)i.push(h);else{const p=Ea(u,f);p!=null&&(i.push(h),o.set(h,p))}});const a=new Gn(i);return new ek(o,a,s.fieldTransforms)}function rI(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[md(e,r,t)],l=[s];if(i.length%2!=0)throw new B(M.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(md(e,i[p])),l.push(i[p+1]);const u=[],h=_n.empty();for(let p=a.length-1;p>=0;--p)if(!ok(u,a[p])){const y=a[p];let x=l[p];x=X(x);const T=o.yc(y);if(x instanceof Yd)u.push(y);else{const P=Ea(x,T);P!=null&&(u.push(y),h.set(y,P))}}const f=new Gn(u);return new ek(h,f,o.fieldTransforms)}function rk(n,e,t,r=!1){return Ea(t,n.Cc(r?4:3,e))}function Ea(n,e){if(ik(n=X(n)))return sI("Unsupported field value:",e,n),sk(n,e);if(n instanceof wa)return function(r,s){if(!tk(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Ea(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=X(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return RN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Ke.fromDate(r);return{timestampValue:Ul(s.serializer,i)}}if(r instanceof Ke){const i=new Ke(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ul(s.serializer,i)}}if(r instanceof hs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof or)return{bytesValue:$N(s.serializer,r._byteString)};if(r instanceof Ze){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:xw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof $r)return function(o,a){return{mapValue:{fields:{[hw]:{stringValue:fw},[Ml]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return yw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${Am(r)}`)}(n,e)}function sk(n,e){const t={};return nN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oo(n,(r,s)=>{const i=Ea(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function ik(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ke||n instanceof hs||n instanceof or||n instanceof Ze||n instanceof wa||n instanceof $r)}function sI(n,e,t){if(!ik(t)||!VR(t)){const r=Am(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function md(n,e,t){if((e=X(e))instanceof va)return e._internalPath;if(typeof e=="string")return Qm(n,e);throw Mp("Field path arguments must be of type string or ",n,!1,void 0,t)}const t5=new RegExp("[~\\*/\\[\\]]");function Qm(n,e,t){if(e.search(t5)>=0)throw Mp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new va(...e.split("."))._internalPath}catch{throw Mp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Mp(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new B(M.INVALID_ARGUMENT,a+n+l)}function ok(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ze(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new n5(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ym("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class n5 extends gd{data(){return super.data()}}function Ym(n,e){return typeof e=="string"?Qm(n,e):e instanceof va?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ak(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class iI{}class Jd extends iI{}function _8(n,e,...t){let r=[];e instanceof iI&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof uc).length,a=i.filter(l=>l instanceof Xd).length;if(o>1||o>0&&a>0)throw new B(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Xd extends Jd{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Xd(e,t,r)}_apply(e){const t=this._parse(e);return ck(e._query,t),new un(e.firestore,e.converter,sv(e._query,t))}_parse(e){const t=Ia(e.firestore);return function(i,o,a,l,u,h,f){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new B(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){BS(f,h);const x=[];for(const T of f)x.push(US(l,i,T));p={arrayValue:{values:x}}}else p=US(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||BS(f,h),p=rk(a,o,f,h==="in"||h==="not-in");return Me.create(u,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function v8(n,e,t){const r=e,s=Ym("where",n);return Xd._create(s,r,t)}class uc extends iI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Qe.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)ck(o,l),o=sv(o,l)}(e._query,t),new un(e.firestore,e.converter,sv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function w8(...n){return n.forEach(e=>uk("or",e)),uc._create("or",n)}function I8(...n){return n.forEach(e=>uk("and",e)),uc._create("and",n)}class oI extends Jd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new oI(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dd(i,o)}(e._query,this._field,this._direction);return new un(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ws(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function E8(n,e="asc"){const t=e,r=Ym("orderBy",n);return oI._create(r,t)}class Jm extends Jd{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Jm(e,t,r)}_apply(e){return new un(e.firestore,e.converter,bp(e._query,this._limit,this._limitType))}}function x8(n){return FR("limit",n),Jm._create("limit",n,"F")}function T8(n){return FR("limitToLast",n),Jm._create("limitToLast",n,"L")}class Xm extends Jd{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Xm(e,t,r)}_apply(e){const t=lk(e,this.type,this._docOrFields,this._inclusive);return new un(e.firestore,e.converter,function(s,i){return new Ws(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function S8(...n){return Xm._create("startAt",n,!0)}function b8(...n){return Xm._create("startAfter",n,!1)}class Zm extends Jd{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Zm(e,t,r)}_apply(e){const t=lk(e,this.type,this._docOrFields,this._inclusive);return new un(e.firestore,e.converter,function(s,i){return new Ws(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function A8(...n){return Zm._create("endBefore",n,!1)}function C8(...n){return Zm._create("endAt",n,!0)}function lk(n,e,t,r){if(t[0]=X(t[0]),t[0]instanceof gd)return function(i,o,a,l,u){if(!l)throw new B(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of ll(i))if(f.field.isKeyField())h.push(Xo(o,l.key));else{const p=l.data.field(f.field);if(km(p))throw new B(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const y=f.field.canonicalString();throw new B(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(p)}return new Yi(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ia(n.firestore);return function(o,a,l,u,h,f){const p=o.explicitOrderBy;if(h.length>p.length)throw new B(M.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let x=0;x<h.length;x++){const T=h[x];if(p[x].field.isKeyField()){if(typeof T!="string")throw new B(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof T}`);if(!mw(o)&&T.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${T}' contains a slash.`);const P=o.path.child(Ae.fromString(T));if(!Q.isDocumentKey(P))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${P}' is not because it contains an odd number of segments.`);const R=new Q(P);y.push(Xo(a,R))}else{const P=rk(l,u,T);y.push(P)}}return new Yi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function US(n,e,t){if(typeof(t=X(t))=="string"){if(t==="")throw new B(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!mw(e)&&t.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ae.fromString(t));if(!Q.isDocumentKey(r))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Xo(n,new Q(r))}if(t instanceof Ze)return Xo(n,t._key);throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Am(t)}.`)}function BS(n,e){if(!Array.isArray(n)||n.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ck(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function uk(n,e){if(!(e instanceof Xd||e instanceof uc))throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class dk{convertValue(e,t="none"){switch(Ki(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(js(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ee(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return oo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[Ml].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>yt(o.doubleValue));return new $r(t)}convertGeoPoint(e){return new hs(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Dm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ad(e));default:return null}}convertTimestamp(e){const t=Fs(e);return new Ke(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ae.fromString(e);ie(XN(r),9688,{name:e});const s=new Jo(r.get(1),r.get(3)),i=new Q(r.popFirst(5));return s.isEqual(t)||jt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class aI extends dk{constructor(e){super(),this.firestore=e}convertBytes(e){return new or(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ze(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R8(n){return new pd("sum",md("sum",n))}function N8(n){return new pd("avg",md("average",n))}function r5(){return new pd("count")}function P8(n,e){var t,r;return n instanceof pd&&e instanceof pd&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function k8(n,e){return JP(n.query,e.query)&&fr(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="NOT SUPPORTED";class Ei{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class cr extends gd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new bf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ym("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=cr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function D8(n,e,t){if(ya(e,cr._jsonSchema)){if(e.bundle===hk)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=_a(n._databaseId),s=KP(e.bundle,r),i=s.Wu(),o=new $w(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new B(M.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Vm(r,a[0].document),u=new Q(Ae.fromString(e.bundleName));return new cr(n,new aI(n),u,l,new Ei(!1,!1),t||null)}}cr._jsonSchemaVersion="firestore/documentSnapshot/1.0",cr._jsonSchema={type:Gt("string",cr._jsonSchemaVersion),bundleSource:Gt("string","DocumentSnapshot"),bundleName:Gt("string"),bundle:Gt("string")};class bf extends cr{data(e={}){return super.data(e)}}class ur{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ei(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new bf(this._firestore,this._userDataWriter,r.key,r,new Ei(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new bf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ei(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new bf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ei(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:s5(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ur._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=sw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function O8(n,e,t){if(ya(e,ur._jsonSchema)){if(e.bundle===hk)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=_a(n._databaseId),s=KP(e.bundle,r),i=s.Wu(),o=new $w(s.getMetadata(),r);for(const p of i)o.Ga(p);if(o.queries.length!==1)throw new B(M.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=jm(o.queries[0].bundledQuery),l=o.documents;let u=new jo;l.map(p=>{const y=Vm(r,p.document);u=u.add(y)});const h=oa.fromInitialDocuments(a,u,ge(),!1,!1),f=new un(n,t||null,a);return new ur(n,new aI(n),f,h)}}function s5(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ee(61501,{type:n})}}function M8(n,e){return n instanceof cr&&e instanceof cr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ur&&e instanceof ur&&n._firestore===e._firestore&&JP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i5(n){n=ke(n,Ze);const e=ke(n.firestore,nt);return GP(At(e),n._key).then(t=>lI(e,n,t))}ur._jsonSchemaVersion="firestore/querySnapshot/1.0",ur._jsonSchema={type:Gt("string",ur._jsonSchemaVersion),bundleSource:Gt("string","QuerySnapshot"),bundleName:Gt("string"),bundle:Gt("string")};class co extends dk{constructor(e){super(),this.firestore=e}convertBytes(e){return new or(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ze(this.firestore,null,t)}}function L8(n){n=ke(n,Ze);const e=ke(n.firestore,nt),t=At(e),r=new co(e);return FU(t,n._key).then(s=>new cr(e,r,n._key,s,new Ei(s!==null&&s.hasLocalMutations,!0),n.converter))}function V8(n){n=ke(n,Ze);const e=ke(n.firestore,nt);return GP(At(e),n._key,{source:"server"}).then(t=>lI(e,n,t))}function o5(n){n=ke(n,un);const e=ke(n.firestore,nt),t=At(e),r=new co(e);return ak(n._query),HP(t,n._query).then(s=>new ur(e,r,n,s))}function F8(n){n=ke(n,un);const e=ke(n.firestore,nt),t=At(e),r=new co(e);return jU(t,n._query).then(s=>new ur(e,r,n,s))}function j8(n){n=ke(n,un);const e=ke(n.firestore,nt),t=At(e),r=new co(e);return HP(t,n._query,{source:"server"}).then(s=>new ur(e,r,n,s))}function $S(n,e,t){n=ke(n,Ze);const r=ke(n.firestore,nt),s=eg(n.converter,e,t);return Zd(r,[Km(Ia(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Et.none())])}function U8(n,e,t,...r){n=ke(n,Ze);const s=ke(n.firestore,nt),i=Ia(s);let o;return o=typeof(e=X(e))=="string"||e instanceof va?rI(i,"updateDoc",n._key,e,t,r):nI(i,"updateDoc",n._key,e),Zd(s,[o.toMutation(n._key,Et.exists(!0))])}function zS(n){return Zd(ke(n.firestore,nt),[new sc(n._key,Et.none())])}function a5(n,e){const t=ke(n.firestore,nt),r=eu(n),s=eg(n.converter,e);return Zd(t,[Km(Ia(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Et.exists(!1))]).then(()=>r)}function qS(n,...e){var l,u,h;n=X(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||cl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(cl(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof Ze)o=ke(n.firestore,nt),a=nc(n._key.path),i={next:f=>{e[r]&&e[r](lI(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=ke(n,un);o=ke(f.firestore,nt),a=f._query;const p=new co(o);i={next:y=>{e[r]&&e[r](new ur(o,p,f,y))},error:e[r+1],complete:e[r+2]},ak(n._query)}return function(p,y,x,T){const P=new Wm(T),R=new Bw(y,P,x);return p.asyncQueue.enqueueAndForget(async()=>Fw(await Gl(p),R)),()=>{P.Nu(),p.asyncQueue.enqueueAndForget(async()=>jw(await Gl(p),R))}}(At(o),a,s,i)}function B8(n,e,...t){const r=X(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const p=l[f];if(typeof p!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(p.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=p:f==="bundleName"?u.bundleName=p:f==="bundleSource"&&(u.bundleSource=p)}return u}(e);if(s.error)throw new B(M.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||cl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&cl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,y){let x,T=!1;return jS(u,h.bundle).then(()=>YU(u,h.bundleName)).then(R=>{R&&!T&&(y&&R.withConverter(y),x=qS(R,f||{},p))}).catch(R=>(p.error&&p.error(R),()=>{})),()=>{T||(T=!0,x&&x())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&cl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,y){let x,T=!1;return jS(u,h.bundle).then(()=>{if(!T){const R=new Ze(u,y||null,Q.fromPath(h.bundleName));x=qS(R,f||{},p)}}).catch(R=>(p.error&&p.error(R),()=>{})),()=>{T||(T=!0,x&&x())}}(r,s,i,a,t[o])}throw new B(M.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function $8(n,e){return BU(At(n=ke(n,nt)),cl(e)?e:{next:e})}function Zd(n,e){return function(r,s){const i=new an;return r.asyncQueue.enqueueAndForget(async()=>mU(await Jw(r),s,i)),i.promise}(At(n),e)}function lI(n,e,t){const r=t.docs.get(e._key),s=new co(n);return new cr(n,s,e._key,r,new Ei(t.hasPendingWrites,t.fromCache),e.converter)}function z8(n){return l5(n,{count:r5()})}function l5(n,e){const t=ke(n.firestore,nt),r=At(t),s=tN(e,(i,o)=>new LN(o,i.aggregateType,i._internalFieldPath));return UU(r,n._query,s).then(i=>function(a,l,u){const h=new co(a);return new JU(l,h,u)}(t,n,i))}class c5{constructor(e){this.kind="memory",this._onlineComponentProvider=Xi.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Kw(void 0)}}toJSON(){return{kind:this.kind}}}class u5{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=m5(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class d5{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Wl.provider}toJSON(){return{kind:this.kind}}}class h5{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Kw(e)}}toJSON(){return{kind:this.kind}}}function q8(){return new d5}function W8(n){return new h5(n==null?void 0:n.cacheSizeBytes)}function G8(n){return new c5(n)}function H8(n){return new u5(n)}class f5{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Xi.provider,this._offlineComponentProvider={build:t=>new Qw(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class p5{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Xi.provider,this._offlineComponentProvider={build:t=>new $P(t,e==null?void 0:e.cacheSizeBytes)}}}function m5(n){return new f5(n==null?void 0:n.forceOwnership)}function K8(){return new p5}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ia(e)}set(e,t,r){this._verifyNotCommitted();const s=xi(e,this._firestore),i=eg(s.converter,t,r),o=Km(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Et.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=xi(e,this._firestore);let o;return o=typeof(t=X(t))=="string"||t instanceof va?rI(this._dataReader,"WriteBatch.update",i._key,t,r,s):nI(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Et.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=xi(e,this._firestore);return this._mutations=this._mutations.concat(new sc(t._key,Et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function xi(n,e){if((n=X(n)).firestore!==e)throw new B(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ia(e)}get(e){const t=xi(e,this._firestore),r=new aI(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return ee(24041);const i=s[0];if(i.isFoundDocument())return new gd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new gd(this._firestore,r,t._key,null,t.converter);throw ee(18433,{doc:i})})}set(e,t,r){const s=xi(e,this._firestore),i=eg(s.converter,t,r),o=Km(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=xi(e,this._firestore);let o;return o=typeof(t=X(t))=="string"||t instanceof va?rI(this._dataReader,"Transaction.update",i._key,t,r,s):nI(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=xi(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5 extends _5{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=xi(e,this._firestore),r=new co(this._firestore);return super.get(e).then(s=>new cr(this._firestore,r,t._key,s._document,new Ei(!1,!1),t.converter))}}function Q8(n,e,t){n=ke(n,nt);const r={...g5,...t};return function(i){if(i.maxAttempts<1)throw new B(M.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new an;return i.asyncQueue.enqueueAndForget(async()=>{const u=await WP(i);new OU(i.asyncQueue,u,a,o,l).ju()}),l.promise}(At(n),s=>e(new v5(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y8(){return new Yd("deleteField")}function Qh(){return new Xw("serverTimestamp")}function J8(...n){return new Zw("arrayUnion",n)}function X8(...n){return new eI("arrayRemove",n)}function Z8(n){return new tI("increment",n)}function e7(n){return new $r(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t7(n){return At(n=ke(n,nt)),new y5(n,e=>Zd(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n7(n,e){const t=At(n=ke(n,nt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Cr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new B(M.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=WS(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const p=Qm("setIndexConfiguration",WS(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Vo(p,2)):f.order==="ASCENDING"?h.push(new Vo(p,0)):f.order==="DESCENDING"&&h.push(new Vo(p,1))}a.push(new Rl(Rl.UNKNOWN_ID,u,h,Nl.empty()))}return a}(e);return qU(t,r)}function WS(n,e){if(typeof n[e]!="string")throw new B(M.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function r7(n){var s;n=ke(n,nt);const e=GS.get(n);if(e)return e;if(((s=At(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new w5(n);return GS.set(n,r),r}function s7(n){fk(n,!0)}function i7(n){fk(n,!1)}function o7(n){GU(At(n._firestore)).then(e=>$("deleting all persistent cache indexes succeeded")).catch(e=>Cr("deleting all persistent cache indexes failed",e))}function fk(n,e){WU(At(n._firestore),e).then(t=>$(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Cr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const GS=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a7(n){var r;const e=At(ke(n.firestore,nt)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:Fm(t,Pn(n._query)).ft}function l7(n,e){var i;const t=tN(e,(o,a)=>new LN(a,o.aggregateType,o._internalFieldPath)),r=At(ke(n.firestore,nt)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:KN(s,wN(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c7{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return cI.instance.onExistenceFilterMismatch(e)}}class cI{constructor(){this.Mc=new Map}static get instance(){return Yh||(Yh=new cI,function(t){if(xu)throw new Error("a TestingHooksSpi instance is already set");xu=t}(Yh)),Yh}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let Yh=null;(function(e,t=!0){(function(s){tc=s})(fa),qr(new Zn("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new nt(new P4(r.getProvider("auth-internal")),new O4(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new B(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jo(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Jn(wT,IT,e),Jn(wT,IT,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u7={PHONE:"phone",TOTP:"totp"},d7={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},h7={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},f7={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},p7={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I5(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function pk(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const m7=I5,E5=pk,mk=new da("auth","Firebase",pk()),g7={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lp=new Cd("@firebase/auth");function x5(n,...e){Lp.logLevel<=Pe.WARN&&Lp.warn(`Auth (${fa}): ${n}`,...e)}function Af(n,...e){Lp.logLevel<=Pe.ERROR&&Lp.error(`Auth (${fa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(n,...e){throw dI(n,...e)}function Fn(n,...e){return dI(n,...e)}function uI(n,e,t){const r={...E5(),[e]:t};return new da("auth","Firebase",r).create(e,{appName:n.name})}function ln(n){return uI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&er(n,"argument-error"),uI(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function dI(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return mk.create(n,...e)}function W(n,e,...t){if(!n)throw dI(e,...t)}function is(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Af(e),new Error(e)}function Us(n,e){n||is(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function hI(){return HS()==="http:"||HS()==="https:"}function HS(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T5(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(hI()||_0()||"connection"in navigator)?navigator.onLine:!0}function S5(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Us(t>e,"Short delay should be less than long delay!"),this.isMobile=y0()||QA()}get(){return T5()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fI(n,e){Us(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;is("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;is("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;is("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b5={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A5=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],C5=new eh(3e4,6e4);function mt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function gt(n,e,t,r,s={}){return yk(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=ha({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return BM()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&qs(n.emulatorConfig.host)&&(u.credentials="include"),gk.fetch()(await _k(n,n.config.apiHost,t,a),u)})}async function yk(n,e,t){n._canInitEmulator=!1;const r={...b5,...e};try{const s=new N5(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw tu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw tu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw tu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw tu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw uI(n,h,u);er(n,h)}}catch(s){if(s instanceof Wr)throw s;er(n,"network-request-failed",{message:String(s)})}}async function Qs(n,e,t,r,s={}){const i=await gt(n,e,t,r,s);return"mfaPendingCredential"in i&&er(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function _k(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?fI(n.config,s):`${n.config.apiScheme}://${s}`;return A5.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function R5(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class N5{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Fn(this.auth,"network-request-failed")),C5.get())})}}function tu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Fn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KS(n){return n!==void 0&&n.getResponse!==void 0}function QS(n){return n!==void 0&&n.enterprise!==void 0}class vk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return R5(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P5(n){return(await gt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function wk(n,e){return gt(n,"GET","/v2/recaptchaConfig",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k5(n,e){return gt(n,"POST","/v1/accounts:delete",e)}async function D5(n,e){return gt(n,"POST","/v1/accounts:update",e)}async function Vp(n,e){return gt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y7(n,e=!1){return X(n).getIdToken(e)}async function O5(n,e=!1){const t=X(n),r=await t.getIdToken(e),s=tg(r);W(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Su(yy(s.auth_time)),issuedAtTime:Su(yy(s.iat)),expirationTime:Su(yy(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function yy(n){return Number(n)*1e3}function tg(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Af("JWT malformed, contained fewer than 3 sections"),null;try{const s=sp(t);return s?JSON.parse(s):(Af("Failed to decode base64 JWT payload"),null)}catch(s){return Af("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function YS(n){const e=tg(n);return W(e,"internal-error"),W(typeof e.exp<"u","internal-error"),W(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Wr&&M5(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function M5({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Su(this.lastLoginAt),this.creationTime=Su(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _d(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Bs(n,Vp(e,{idToken:t}));W(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?Ik(s.providerUserInfo):[],o=F5(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new yv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function V5(n){const e=X(n);await _d(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function F5(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Ik(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j5(n,e){const t=await yk(n,{},async()=>{const r=ha({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await _k(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&qs(n.emulatorConfig.host)&&(l.credentials="include"),gk.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function U5(n,e){return gt(n,"POST","/v2/accounts:revokeToken",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){W(e.idToken,"internal-error"),W(typeof e.idToken<"u","internal-error"),W(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):YS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){W(e.length!==0,"internal-error");const t=YS(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(W(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await j5(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ul;return r&&(W(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(W(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(W(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ul,this.toJSON())}_performRefresh(){return is("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ai(n,e){W(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Fr{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new L5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new yv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Bs(this,this.stsTokenManager.getToken(this.auth,e));return W(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return O5(this,e)}reload(){return V5(this)}_assign(e){this!==e&&(W(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Fr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){W(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await _d(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(vt(this.auth.app))return Promise.reject(ln(this.auth));const e=await this.getIdToken();return await Bs(this,k5(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:y,providerData:x,stsTokenManager:T}=t;W(f&&T,e,"internal-error");const P=ul.fromJSON(this.name,T);W(typeof f=="string",e,"internal-error"),ai(r,e.name),ai(s,e.name),W(typeof p=="boolean",e,"internal-error"),W(typeof y=="boolean",e,"internal-error"),ai(i,e.name),ai(o,e.name),ai(a,e.name),ai(l,e.name),ai(u,e.name),ai(h,e.name);const R=new Fr({uid:f,auth:e,email:s,emailVerified:p,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:P,createdAt:u,lastLoginAt:h});return x&&Array.isArray(x)&&(R.providerData=x.map(b=>({...b}))),l&&(R._redirectEventId=l),R}static async _fromIdTokenResponse(e,t,r=!1){const s=new ul;s.updateFromServerResponse(t);const i=new Fr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await _d(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];W(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Ik(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ul;a.updateFromIdToken(r);const l=new Fr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new yv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JS=new Map;function Cs(n){Us(n instanceof Function,"Expected a class definition");let e=JS.get(n);return e?(Us(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,JS.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ek.type="NONE";const XS=Ek;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(n,e,t){return`firebase:${n}:${e}:${t}`}class dl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Cf(this.userKey,s.apiKey,i),this.fullPersistenceKey=Cf("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Vp(this.auth,{idToken:e}).catch(()=>{});return t?Fr._fromGetAccountInfoResponse(this.auth,t,e):null}return Fr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new dl(Cs(XS),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Cs(XS);const o=Cf(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const p=await Vp(e,{idToken:h}).catch(()=>{});if(!p)break;f=await Fr._fromGetAccountInfoResponse(e,p,h)}else f=Fr._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new dl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new dl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZS(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(bk(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(xk(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ck(e))return"Blackberry";if(Rk(e))return"Webos";if(Tk(e))return"Safari";if((e.includes("chrome/")||Sk(e))&&!e.includes("edge/"))return"Chrome";if(Ak(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function xk(n=Yt()){return/firefox\//i.test(n)}function Tk(n=Yt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Sk(n=Yt()){return/crios\//i.test(n)}function bk(n=Yt()){return/iemobile/i.test(n)}function Ak(n=Yt()){return/android/i.test(n)}function Ck(n=Yt()){return/blackberry/i.test(n)}function Rk(n=Yt()){return/webos/i.test(n)}function pI(n=Yt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function B5(n=Yt()){var e;return pI(n)&&!!((e=window.navigator)!=null&&e.standalone)}function $5(){return $M()&&document.documentMode===10}function Nk(n=Yt()){return pI(n)||Ak(n)||Rk(n)||Ck(n)||/windows phone/i.test(n)||bk(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pk(n,e=[]){let t;switch(n){case"Browser":t=ZS(Yt());break;case"Worker":t=`${ZS(Yt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${fa}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z5{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q5(n,e={}){return gt(n,"GET","/v2/passwordPolicy",mt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W5=6;class G5{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??W5,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H5{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eb(this),this.idTokenSubscription=new eb(this),this.beforeStateQueue=new z5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mk,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Cs(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await dl.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Vp(this,{idToken:e}),r=await Fr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(vt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return W(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _d(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=S5()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(vt(this.app))return Promise.reject(ln(this));const t=e?X(e):null;return t&&W(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&W(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return vt(this.app)?Promise.reject(ln(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return vt(this.app)?Promise.reject(ln(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Cs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await q5(this),t=new G5(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new da("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await U5(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Cs(e)||this._popupRedirectResolver;W(t,this,"argument-error"),this.redirectPersistenceManager=await dl.create(this,[Cs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(W(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return W(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Pk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(vt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&x5(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Ot(n){return X(n)}class eb{constructor(e){this.auth=e,this.observer=null,this.addObserver=QM(t=>this.observer=t)}get next(){return W(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let th={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function K5(n){th=n}function mI(n){return th.loadJS(n)}function Q5(){return th.recaptchaV2Script}function Y5(){return th.recaptchaEnterpriseScript}function J5(){return th.gapiScript}function kk(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5=500,Z5=6e4,Jh=1e12;class eB{constructor(e){this.auth=e,this.counter=Jh,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new rB(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||Jh;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||Jh;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||Jh;return(r=this._widgets.get(t))==null||r.execute(),""}}class tB{constructor(){this.enterprise=new nB}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nB{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class rB{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;W(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=sB(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Z5)},X5))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function sB(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const iB="recaptcha-enterprise",bu="NO_RECAPTCHA";class Dk{constructor(e){this.type=iB,this.auth=Ot(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{wk(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new vk(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;QS(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(bu)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new tB().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&QS(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Y5();l.length!==0&&(l+=a),mI(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function $c(n,e,t,r=!1,s=!1){const i=new Dk(n);let o;if(s)o=bu;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function ji(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await $c(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await $c(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await $c(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await $c(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await $c(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function Ok(n){const e=Ot(n),t=await wk(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new vk(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new Dk(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oB(n,e){const t=gs(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(fr(i,e??{}))return s;er(s,"already-initialized")}return t.initialize({options:e})}function aB(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Cs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function lB(n,e,t){const r=Ot(n);W(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=Mk(e),{host:o,port:a}=cB(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){W(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),W(fr(u,r.config.emulator)&&fr(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,qs(o)?(om(`${i}//${o}${l}`),g0("Auth",!0)):s||uB()}function Mk(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function cB(n){const e=Mk(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:tb(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:tb(o)}}}function tb(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function uB(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return is("not implemented")}_getIdTokenResponse(e){return is("not implemented")}_linkToIdToken(e,t){return is("not implemented")}_getReauthenticationResolver(e){return is("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lk(n,e){return gt(n,"POST","/v1/accounts:resetPassword",mt(n,e))}async function dB(n,e){return gt(n,"POST","/v1/accounts:update",e)}async function hB(n,e){return gt(n,"POST","/v1/accounts:signUp",e)}async function fB(n,e){return gt(n,"POST","/v1/accounts:update",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pB(n,e){return Qs(n,"POST","/v1/accounts:signInWithPassword",mt(n,e))}async function ng(n,e){return gt(n,"POST","/v1/accounts:sendOobCode",mt(n,e))}async function mB(n,e){return ng(n,e)}async function gB(n,e){return ng(n,e)}async function yB(n,e){return ng(n,e)}async function _B(n,e){return ng(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vB(n,e){return Qs(n,"POST","/v1/accounts:signInWithEmailLink",mt(n,e))}async function wB(n,e){return Qs(n,"POST","/v1/accounts:signInWithEmailLink",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd extends nh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new vd(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new vd(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ji(e,t,"signInWithPassword",pB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return vB(e,{email:this._email,oobCode:this._password});default:er(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ji(e,r,"signUpPassword",hB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return wB(e,{idToken:t,email:this._email,oobCode:this._password});default:er(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ps(n,e){return Qs(n,"POST","/v1/accounts:signInWithIdp",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IB="http://localhost";class $s extends nh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new $s(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):er("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new $s(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ps(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ps(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ps(e,t)}buildRequest(){const e={requestUri:IB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ha(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nb(n,e){return gt(n,"POST","/v1/accounts:sendVerificationCode",mt(n,e))}async function EB(n,e){return Qs(n,"POST","/v1/accounts:signInWithPhoneNumber",mt(n,e))}async function xB(n,e){const t=await Qs(n,"POST","/v1/accounts:signInWithPhoneNumber",mt(n,e));if(t.temporaryProof)throw tu(n,"account-exists-with-different-credential",t);return t}const TB={USER_NOT_FOUND:"user-not-found"};async function SB(n,e){const t={...e,operation:"REAUTH"};return Qs(n,"POST","/v1/accounts:signInWithPhoneNumber",mt(n,t),TB)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo extends nh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Uo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Uo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return EB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return xB(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return SB(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Uo({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bB(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function AB(n){const e=Hc(Kc(n)).link,t=e?Hc(Kc(e)).deep_link_id:null,r=Hc(Kc(n)).deep_link_id;return(r?Hc(Kc(r)).link:null)||r||t||e||n}class rh{constructor(e){const t=Hc(Kc(e)),r=t.apiKey??null,s=t.oobCode??null,i=bB(t.mode??null);W(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=AB(e);try{return new rh(t)}catch{return null}}}function _7(n){return rh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.providerId=xa.PROVIDER_ID}static credential(e,t){return vd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=rh.parseLink(t);return W(r,"argument-error"),vd._fromEmailAndCode(e,r.code,r.tenantId)}}xa.PROVIDER_ID="password";xa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc extends Ys{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Rf extends hc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return W("providerId"in t&&"signInMethod"in t,"argument-error"),$s._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return W(e.idToken||e.accessToken,"argument-error"),$s._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return Rf.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Rf.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Rf(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi extends hc{constructor(){super("facebook.com")}static credential(e){return $s._fromParams({providerId:pi.PROVIDER_ID,signInMethod:pi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pi.credentialFromTaggedObject(e)}static credentialFromError(e){return pi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pi.credential(e.oauthAccessToken)}catch{return null}}}pi.FACEBOOK_SIGN_IN_METHOD="facebook.com";pi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs extends hc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return $s._fromParams({providerId:xs.PROVIDER_ID,signInMethod:xs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return xs.credentialFromTaggedObject(e)}static credentialFromError(e){return xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return xs.credential(t,r)}catch{return null}}}xs.GOOGLE_SIGN_IN_METHOD="google.com";xs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi extends hc{constructor(){super("github.com")}static credential(e){return $s._fromParams({providerId:mi.PROVIDER_ID,signInMethod:mi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mi.credentialFromTaggedObject(e)}static credentialFromError(e){return mi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return mi.credential(e.oauthAccessToken)}catch{return null}}}mi.GITHUB_SIGN_IN_METHOD="github.com";mi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB="http://localhost";class wd extends nh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ps(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ps(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ps(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new wd(r,i)}static _create(e,t){return new wd(e,t)}buildRequest(){return{requestUri:CB,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RB="saml.";class _v extends Ys{constructor(e){W(e.startsWith(RB),"argument-error"),super(e)}static credentialFromResult(e){return _v.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return _v.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=wd.fromJSON(e);return W(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return wd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi extends hc{constructor(){super("twitter.com")}static credential(e,t){return $s._fromParams({providerId:gi.PROVIDER_ID,signInMethod:gi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return gi.credentialFromTaggedObject(e)}static credentialFromError(e){return gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return gi.credential(t,r)}catch{return null}}}gi.TWITTER_SIGN_IN_METHOD="twitter.com";gi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n,e){return Qs(n,"POST","/v1/accounts:signUp",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Fr._fromIdTokenResponse(e,r,s),o=rb(r);return new Rr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=rb(r);return new Rr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function rb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v7(n){var s;if(vt(n.app))return Promise.reject(ln(n));const e=Ot(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Rr({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await Vk(e,{returnSecureToken:!0}),r=await Rr._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp extends Wr{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Fp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Fp(e,t,r,s)}}function Fk(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Fp._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jk(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w7(n,e){const t=X(n);await rg(!0,t,e);const{providerUserInfo:r}=await D5(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=jk(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function gI(n,e,t=!1){const r=await Bs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Rr._forOperation(n,"link",r)}async function rg(n,e,t){await _d(e);const r=jk(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";W(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(n,e,t=!1){const{auth:r}=n;if(vt(r.app))return Promise.reject(ln(r));const s="reauthenticate";try{const i=await Bs(n,Fk(r,s,e,n),t);W(i.idToken,r,"internal-error");const o=tg(i.idToken);W(o,r,"internal-error");const{sub:a}=o;return W(n.uid===a,r,"user-mismatch"),Rr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&er(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bk(n,e,t=!1){if(vt(n.app))return Promise.reject(ln(n));const r="signIn",s=await Fk(n,r,e),i=await Rr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function yI(n,e){return Bk(Ot(n),e)}async function NB(n,e){const t=X(n);return await rg(!1,t,e.providerId),gI(t,e)}async function PB(n,e){return Uk(X(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kB(n,e){return Qs(n,"POST","/v1/accounts:signInWithCustomToken",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I7(n,e){if(vt(n.app))return Promise.reject(ln(n));const t=Ot(n),r=await kB(t,{token:e,returnSecureToken:!0}),s=await Rr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?_I._fromServerResponse(e,t):"totpInfo"in t?vI._fromServerResponse(e,t):er(e,"internal-error")}}class _I extends sh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new _I(t)}}class vI extends sh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new vI(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sg(n,e,t){var r;W(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),W(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),W(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(W(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(W(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wI(n){const e=Ot(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function DB(n,e,t){const r=Ot(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&sg(r,s,t),await ji(r,s,"getOobCode",gB,"EMAIL_PASSWORD_PROVIDER")}async function E7(n,e,t){await Lk(X(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&wI(n),r})}async function x7(n,e){await fB(X(n),{oobCode:e})}async function OB(n,e){const t=X(n),r=await Lk(t,{oobCode:e}),s=r.requestType;switch(W(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":W(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":W(r.mfaInfo,t,"internal-error");default:W(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=sh._fromServerResponse(Ot(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function T7(n,e){const{data:t}=await OB(X(n),e);return t.email}async function MB(n,e,t){if(vt(n.app))return Promise.reject(ln(n));const r=Ot(n),o=await ji(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Vk,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&wI(n),l}),a=await Rr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function LB(n,e,t){return vt(n.app)?Promise.reject(ln(n)):yI(X(n),xa.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&wI(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S7(n,e,t){const r=Ot(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){W(a.handleCodeInApp,r,"argument-error"),a&&sg(r,o,a)}i(s,t),await ji(r,s,"getOobCode",yB,"EMAIL_PASSWORD_PROVIDER")}function b7(n,e){const t=rh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function A7(n,e,t){if(vt(n.app))return Promise.reject(ln(n));const r=X(n),s=xa.credentialWithLink(e,t||yd());return W(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),yI(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VB(n,e){return gt(n,"POST","/v1/accounts:createAuthUri",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C7(n,e){const t=hI()?yd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await VB(X(n),r);return s||[]}async function FB(n,e){const t=X(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&sg(t.auth,s,e);const{email:i}=await mB(t.auth,s);i!==n.email&&await n.reload()}async function R7(n,e,t){const r=X(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&sg(r.auth,i,t);const{email:o}=await _B(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jB(n,e){return gt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N7(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=X(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Bs(r,jB(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function P7(n,e){const t=X(n);return vt(t.auth.app)?Promise.reject(ln(t.auth)):$k(t,e,null)}function k7(n,e){return $k(X(n),null,e)}async function $k(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Bs(n,dB(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UB(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=tg(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new hl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new BB(r,t);case"github.com":return new $B(r,t);case"google.com":return new zB(r,t);case"twitter.com":return new qB(r,t,n.screenName||null);case"custom":case"anonymous":return new hl(r,null);default:return new hl(r,e,t)}}class hl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class zk extends hl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class BB extends hl{constructor(e,t){super(e,"facebook.com",t)}}class $B extends zk{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class zB extends hl{constructor(e,t){super(e,"google.com",t)}}class qB extends zk{constructor(e,t,r){super(e,"twitter.com",t,r)}}function D7(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:UB(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WB(n,e){return X(n).setPersistence(e)}function O7(n){return Ok(n)}async function M7(n,e){return Ot(n).validatePassword(e)}function GB(n,e,t,r){return X(n).onIdTokenChanged(e,t,r)}function HB(n,e,t){return X(n).beforeAuthStateChanged(e,t)}function L7(n,e,t,r){return X(n).onAuthStateChanged(e,t,r)}function V7(n){X(n).useDeviceLanguage()}function F7(n,e){return X(n).updateCurrentUser(e)}function j7(n){return X(n).signOut()}function U7(n,e){return Ot(n).revokeAccessToken(e)}async function B7(n){return X(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ko("enroll",e,t)}static _fromMfaPendingCredential(e){return new ko("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return ko._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return ko._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Ot(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>sh._fromServerResponse(r,a));W(s.mfaPendingCredential,r,"internal-error");const o=ko._fromMfaPendingCredential(s.mfaPendingCredential);return new II(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await Rr._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return W(t.user,r,"internal-error"),Rr._forOperation(t.user,t.operationType,u);default:er(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function $7(n,e){var s;const t=X(n),r=e;return W(e.customData.operationType,t,"argument-error"),W((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),II._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sb(n,e){return gt(n,"POST","/v2/accounts/mfaEnrollment:start",mt(n,e))}function KB(n,e){return gt(n,"POST","/v2/accounts/mfaEnrollment:finalize",mt(n,e))}function QB(n,e){return gt(n,"POST","/v2/accounts/mfaEnrollment:start",mt(n,e))}function YB(n,e){return gt(n,"POST","/v2/accounts/mfaEnrollment:finalize",mt(n,e))}function JB(n,e){return gt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",mt(n,e))}class EI{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>sh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new EI(e)}async getSession(){return ko._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Bs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Bs(this.user,JB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const _y=new WeakMap;function z7(n){const e=X(n);return _y.has(e)||_y.set(e,EI._fromUser(e)),_y.get(e)}const jp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(jp,"1"),this.storage.removeItem(jp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XB=1e3,ZB=10;class Wk extends qk{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Nk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);$5()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,ZB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},XB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Wk.type="LOCAL";const Gk=Wk;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e$=1e3;function vy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function wy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class Hk{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=wy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return vy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=wy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=wy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(p=>p.name===r);h&&t(h.value),u.deleted.find(p=>p.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=vy(r);const i=setInterval(()=>{const a=vy(r);a!==s&&(t(a),s=a)},e$),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}Hk.type="COOKIE";const q7=Hk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk extends qk{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Kk.type="SESSION";const Qk=Kk;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t$(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ig(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await t$(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ig.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n${constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=og("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qt(){return window}function r$(n){qt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xI(){return typeof qt().WorkerGlobalScope<"u"&&typeof qt().importScripts=="function"}async function s$(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function i$(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function o$(){return xI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yk="firebaseLocalStorageDb",a$=1,Up="firebaseLocalStorage",Jk="fbase_key";class ih{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ag(n,e){return n.transaction([Up],e?"readwrite":"readonly").objectStore(Up)}function l$(){const n=indexedDB.deleteDatabase(Yk);return new ih(n).toPromise()}function vv(){const n=indexedDB.open(Yk,a$);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Up,{keyPath:Jk})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Up)?e(r):(r.close(),await l$(),e(await vv()))})})}async function ib(n,e,t){const r=ag(n,!0).put({[Jk]:e,value:t});return new ih(r).toPromise()}async function c$(n,e){const t=ag(n,!1).get(e),r=await new ih(t).toPromise();return r===void 0?null:r.value}function ob(n,e){const t=ag(n,!0).delete(e);return new ih(t).toPromise()}const u$=800,d$=3;class Xk{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await vv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>d$)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return xI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ig._getInstance(o$()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await s$(),!this.activeServiceWorker)return;this.sender=new n$(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||i$()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await vv();return await ib(e,jp,"1"),await ob(e,jp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>ib(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>c$(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ob(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=ag(s,!1).getAll();return new ih(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),u$)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Xk.type="LOCAL";const h$=Xk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ab(n,e){return gt(n,"POST","/v2/accounts/mfaSignIn:start",mt(n,e))}function f$(n,e){return gt(n,"POST","/v2/accounts/mfaSignIn:finalize",mt(n,e))}function p$(n,e){return gt(n,"POST","/v2/accounts/mfaSignIn:finalize",mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iy=kk("rcb"),m$=new eh(3e4,6e4);class g${constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=qt().grecaptcha)!=null&&e.render)}load(e,t=""){return W(y$(t),e,"argument-error"),this.shouldResolveImmediately(t)&&KS(qt().grecaptcha)?Promise.resolve(qt().grecaptcha):new Promise((r,s)=>{const i=qt().setTimeout(()=>{s(Fn(e,"network-request-failed"))},m$.get());qt()[Iy]=()=>{qt().clearTimeout(i),delete qt()[Iy];const a=qt().grecaptcha;if(!a||!KS(a)){s(Fn(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${Q5()}?${ha({onload:Iy,render:"explicit",hl:t})}`;mI(o).catch(()=>{clearTimeout(i),s(Fn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=qt().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function y$(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class _${async load(e){return new eB(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Au="recaptcha",v$={theme:"light",type:"image"};class W7{constructor(e,t,r={...v$}){this.parameters=r,this.type=Au,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ot(e),this.isInvisible=this.parameters.size==="invisible",W(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;W(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new _$:new g$,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){W(!this.parameters.sitekey,this.auth,"argument-error"),W(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),W(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=qt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){W(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){W(hI()&&!xI(),this.auth,"internal-error"),await w$(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await P5(this.auth);W(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return W(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function w$(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TI{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Uo._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function G7(n,e,t){if(vt(n.app))return Promise.reject(ln(n));const r=Ot(n),s=await lg(r,e,X(t));return new TI(s,i=>yI(r,i))}async function H7(n,e,t){const r=X(n);await rg(!1,r,"phone");const s=await lg(r.auth,e,X(t));return new TI(s,i=>NB(r,i))}async function K7(n,e,t){const r=X(n);if(vt(r.auth.app))return Promise.reject(ln(r.auth));const s=await lg(r.auth,e,X(t));return new TI(s,i=>PB(r,i))}async function lg(n,e,t){var r;if(!n._getRecaptchaConfig())try{await Ok(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){W(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await ji(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===bu){W((t==null?void 0:t.type)===Au,h,"argument-error");const p=await Ey(h,f,t);return sb(h,p)}return sb(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{W(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;W(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await ji(n,a,"mfaSmsSignIn",async(f,p)=>{if(p.phoneSignInInfo.captchaResponse===bu){W((t==null?void 0:t.type)===Au,f,"argument-error");const y=await Ey(f,p,t);return ab(f,y)}return ab(f,p)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await ji(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===bu){W((t==null?void 0:t.type)===Au,u,"argument-error");const f=await Ey(u,h,t);return nb(u,f)}return nb(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function Q7(n,e){const t=X(n);if(vt(t.auth.app))return Promise.reject(ln(t.auth));await gI(t,e)}async function Ey(n,e,t){W(t.type===Au,n,"argument-error");const r=await t.verify();W(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(e){this.providerId=fl.PROVIDER_ID,this.auth=Ot(e)}verifyPhoneNumber(e,t){return lg(this.auth,e,X(t))}static credential(e,t){return Uo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return fl.credentialFromTaggedObject(t)}static credentialFromError(e){return fl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Uo._fromTokenResponse(t,r):null}}fl.PROVIDER_ID="phone";fl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ta(n,e){return e?Cs(e):(W(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI extends nh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ps(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ps(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ps(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function I$(n){return Bk(n.auth,new SI(n),n.bypassAuthState)}function E$(n){const{auth:e,user:t}=n;return W(t,e,"internal-error"),Uk(t,new SI(n),n.bypassAuthState)}async function x$(n){const{auth:e,user:t}=n;return W(t,e,"internal-error"),gI(t,new SI(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zk{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return I$;case"linkViaPopup":case"linkViaRedirect":return x$;case"reauthViaPopup":case"reauthViaRedirect":return E$;default:er(this.auth,"internal-error")}}resolve(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T$=new eh(2e3,1e4);async function S$(n,e,t){if(vt(n.app))return Promise.reject(Fn(n,"operation-not-supported-in-this-environment"));const r=Ot(n);dc(n,e,Ys);const s=Ta(r,t);return new Rs(r,"signInViaPopup",e,s).executeNotNull()}async function Y7(n,e,t){const r=X(n);if(vt(r.auth.app))return Promise.reject(Fn(r.auth,"operation-not-supported-in-this-environment"));dc(r.auth,e,Ys);const s=Ta(r.auth,t);return new Rs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function J7(n,e,t){const r=X(n);dc(r.auth,e,Ys);const s=Ta(r.auth,t);return new Rs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Rs extends Zk{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Rs.currentPopupAction&&Rs.currentPopupAction.cancel(),Rs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return W(e,this.auth,"internal-error"),e}async onExecution(){Us(this.filter.length===1,"Popup operations only handle one event");const e=og();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Fn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Fn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Rs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,T$.get())};e()}}Rs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b$="pendingRedirect",Nf=new Map;class A$ extends Zk{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Nf.get(this.auth._key());if(!e){try{const r=await C$(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Nf.set(this.auth._key(),e)}return this.bypassAuthState||Nf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function C$(n,e){const t=tD(e),r=eD(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function bI(n,e){return eD(n)._set(tD(e),"true")}function R$(n,e){Nf.set(n._key(),e)}function eD(n){return Cs(n._redirectPersistence)}function tD(n){return Cf(b$,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X7(n,e,t){return N$(n,e,t)}async function N$(n,e,t){if(vt(n.app))return Promise.reject(ln(n));const r=Ot(n);dc(n,e,Ys),await r._initializationPromise;const s=Ta(r,t);return await bI(s,r),s._openRedirect(r,e,"signInViaRedirect")}function Z7(n,e,t){return P$(n,e,t)}async function P$(n,e,t){const r=X(n);if(dc(r.auth,e,Ys),vt(r.auth.app))return Promise.reject(ln(r.auth));await r.auth._initializationPromise;const s=Ta(r.auth,t);await bI(s,r.auth);const i=await rD(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function eW(n,e,t){return k$(n,e,t)}async function k$(n,e,t){const r=X(n);dc(r.auth,e,Ys),await r.auth._initializationPromise;const s=Ta(r.auth,t);await rg(!1,r,e.providerId),await bI(s,r.auth);const i=await rD(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function tW(n,e){return await Ot(n)._initializationPromise,nD(n,e,!1)}async function nD(n,e,t=!1){if(vt(n.app))return Promise.reject(ln(n));const r=Ot(n),s=Ta(r,e),o=await new A$(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function rD(n){const e=og(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D$=10*60*1e3;class O${constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!M$(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!sD(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(Fn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=D$&&this.cachedEventUids.clear(),this.cachedEventUids.has(lb(e))}saveEventToCache(e){this.cachedEventUids.add(lb(e)),this.lastProcessedEventTime=Date.now()}}function lb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function sD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function M$(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L$(n,e={}){return gt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V$=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,F$=/^https?/;async function j$(n){if(n.config.emulator)return;const{authorizedDomains:e}=await L$(n);for(const t of e)try{if(U$(t))return}catch{}er(n,"unauthorized-domain")}function U$(n){const e=yd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!F$.test(t))return!1;if(V$.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B$=new eh(3e4,6e4);function cb(){const n=qt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function $$(n){return new Promise((e,t)=>{var s,i,o;function r(){cb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{cb(),t(Fn(n,"network-request-failed"))},timeout:B$.get()})}if((i=(s=qt().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=qt().gapi)!=null&&o.load)r();else{const a=kk("iframefcb");return qt()[a]=()=>{gapi.load?r():t(Fn(n,"network-request-failed"))},mI(`${J5()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Pf=null,e})}let Pf=null;function z$(n){return Pf=Pf||$$(n),Pf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q$=new eh(5e3,15e3),W$="__/auth/iframe",G$="emulator/auth/iframe",H$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},K$=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Q$(n){const e=n.config;W(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?fI(e,G$):`https://${n.config.authDomain}/${W$}`,r={apiKey:e.apiKey,appName:n.name,v:fa},s=K$.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${ha(r).slice(1)}`}async function Y$(n){const e=await z$(n),t=qt().gapi;return W(t,n,"internal-error"),e.open({where:document.body,url:Q$(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:H$,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Fn(n,"network-request-failed"),a=qt().setTimeout(()=>{i(o)},q$.get());function l(){qt().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J$={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},X$=500,Z$=600,e9="_blank",t9="http://localhost";class ub{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function n9(n,e,t,r=X$,s=Z$){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...J$,width:r.toString(),height:s.toString(),top:i,left:o},u=Yt().toLowerCase();t&&(a=Sk(u)?e9:t),xk(u)&&(e=e||t9,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[y,x])=>`${p}${y}=${x},`,"");if(B5(u)&&a!=="_self")return r9(e||"",a),new ub(null);const f=window.open(e||"",a,h);W(f,n,"popup-blocked");try{f.focus()}catch{}return new ub(f)}function r9(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s9="__/auth/handler",i9="emulator/auth/handler",o9=encodeURIComponent("fac");async function db(n,e,t,r,s,i){W(n.config.authDomain,n,"auth-domain-config-required"),W(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:fa,eventId:s};if(e instanceof Ys){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",ip(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof hc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${o9}=${encodeURIComponent(l)}`:"";return`${a9(n)}?${ha(a).slice(1)}${u}`}function a9({config:n}){return n.emulator?fI(n,i9):`https://${n.authDomain}/${s9}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xy="webStorageSupport";class l9{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Qk,this._completeRedirectFn=nD,this._overrideRedirectResult=R$}async _openPopup(e,t,r,s){var o;Us((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await db(e,t,r,yd(),s);return n9(e,i,og())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await db(e,t,r,yd(),s);return r$(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Us(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Y$(e),r=new O$(e);return t.register("authEvent",s=>(W(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(xy,{type:xy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[xy];i!==void 0&&t(!!i),er(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=j$(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Nk()||Tk()||pI()}}const c9=l9;class iD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return is("unexpected MultiFactorSessionType")}}}class AI extends iD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new AI(e)}_finalizeEnroll(e,t,r){return KB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return f$(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class u9{constructor(){}static assertion(e){return AI._fromCredential(e)}}u9.FACTOR_ID="phone";class d9{static assertionForEnrollment(e,t){return Id._fromSecret(e,t)}static assertionForSignIn(e,t){return Id._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;W(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await QB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return CI._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}d9.FACTOR_ID="totp";class Id extends iD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Id(t,void 0,e)}static _fromEnrollmentId(e,t){return new Id(t,e)}async _finalizeEnroll(e,t,r){return W(typeof this.secret<"u",e,"argument-error"),YB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){W(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return p$(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class CI{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new CI(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(Xh(e)||Xh(t))&&(r=!0),r&&(Xh(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),Xh(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Xh(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var hb="@firebase/auth",fb="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h9{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){W(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f9(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function p9(n){qr(new Zn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;W(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Pk(n)},u=new H5(r,s,i,l);return aB(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),qr(new Zn("auth-internal",e=>{const t=Ot(e.getProvider("auth").getImmediate());return(r=>new h9(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Jn(hb,fb,f9(n)),Jn(hb,fb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m9=5*60,g9=GA("authIdTokenMaxAge")||m9;let pb=null;const y9=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>g9)return;const s=t==null?void 0:t.token;pb!==s&&(pb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function _9(n=Rd()){const e=gs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=oB(n,{popupRedirectResolver:c9,persistence:[h$,Gk,Qk]}),r=GA("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=y9(i.toString());HB(t,o,()=>o(t.currentUser)),GB(t,a=>o(a))}}const s=zA("auth");return s&&lB(t,`http://${s}`),t}function v9(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}K5({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Fn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",v9().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});p9("Browser");const oD="@firebase/installations",RI="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD=1e4,lD=`w:${RI}`,cD="FIS_v2",w9="https://firebaseinstallations.googleapis.com/v1",I9=60*60*1e3,E9="installations",x9="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T9={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},aa=new da(E9,x9,T9);function uD(n){return n instanceof Wr&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dD({projectId:n}){return`${w9}/projects/${n}/installations`}function hD(n){return{token:n.token,requestStatus:2,expiresIn:b9(n.expiresIn),creationTime:Date.now()}}async function fD(n,e){const r=(await e.json()).error;return aa.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function pD({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function S9(n,{refreshToken:e}){const t=pD(n);return t.append("Authorization",A9(e)),t}async function mD(n){const e=await n();return e.status>=500&&e.status<600?n():e}function b9(n){return Number(n.replace("s","000"))}function A9(n){return`${cD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C9({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=dD(n),s=pD(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:cD,appId:n.appId,sdkVersion:lD},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await mD(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:hD(u.authToken)}}else throw await fD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R9(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N9=/^[cdef][\w-]{21}$/,wv="";function P9(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=k9(n);return N9.test(t)?t:wv}catch{return wv}}function k9(n){return R9(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD=new Map;function _D(n,e){const t=cg(n);vD(t,e),D9(t,e)}function vD(n,e){const t=yD.get(n);if(t)for(const r of t)r(e)}function D9(n,e){const t=O9();t&&t.postMessage({key:n,fid:e}),M9()}let Do=null;function O9(){return!Do&&"BroadcastChannel"in self&&(Do=new BroadcastChannel("[Firebase] FID Change"),Do.onmessage=n=>{vD(n.data.key,n.data.fid)}),Do}function M9(){yD.size===0&&Do&&(Do.close(),Do=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L9="firebase-installations-database",V9=1,la="firebase-installations-store";let Ty=null;function NI(){return Ty||(Ty=sC(L9,V9,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(la)}}})),Ty}async function Bp(n,e){const t=cg(n),s=(await NI()).transaction(la,"readwrite"),i=s.objectStore(la),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&_D(n,e.fid),e}async function wD(n){const e=cg(n),r=(await NI()).transaction(la,"readwrite");await r.objectStore(la).delete(e),await r.done}async function ug(n,e){const t=cg(n),s=(await NI()).transaction(la,"readwrite"),i=s.objectStore(la),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&_D(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PI(n){let e;const t=await ug(n.appConfig,r=>{const s=F9(r),i=j9(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===wv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function F9(n){const e=n||{fid:P9(),registrationStatus:0};return ID(e)}function j9(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(aa.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=U9(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:B9(n)}:{installationEntry:e}}async function U9(n,e){try{const t=await C9(n,e);return Bp(n.appConfig,t)}catch(t){throw uD(t)&&t.customData.serverCode===409?await wD(n.appConfig):await Bp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function B9(n){let e=await mb(n.appConfig);for(;e.registrationStatus===1;)await gD(100),e=await mb(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await PI(n);return r||t}return e}function mb(n){return ug(n,e=>{if(!e)throw aa.create("installation-not-found");return ID(e)})}function ID(n){return $9(n)?{fid:n.fid,registrationStatus:0}:n}function $9(n){return n.registrationStatus===1&&n.registrationTime+aD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z9({appConfig:n,heartbeatServiceProvider:e},t){const r=q9(n,t),s=S9(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:lD,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await mD(()=>fetch(r,a));if(l.ok){const u=await l.json();return hD(u)}else throw await fD("Generate Auth Token",l)}function q9(n,{fid:e}){return`${dD(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kI(n,e=!1){let t;const r=await ug(n.appConfig,i=>{if(!ED(i))throw aa.create("not-registered");const o=i.authToken;if(!e&&H9(o))return i;if(o.requestStatus===1)return t=W9(n,e),i;{if(!navigator.onLine)throw aa.create("app-offline");const a=Q9(i);return t=G9(n,a),a}});return t?await t:r.authToken}async function W9(n,e){let t=await gb(n.appConfig);for(;t.authToken.requestStatus===1;)await gD(100),t=await gb(n.appConfig);const r=t.authToken;return r.requestStatus===0?kI(n,e):r}function gb(n){return ug(n,e=>{if(!ED(e))throw aa.create("not-registered");const t=e.authToken;return Y9(t)?{...e,authToken:{requestStatus:0}}:e})}async function G9(n,e){try{const t=await z9(n,e),r={...e,authToken:t};return await Bp(n.appConfig,r),t}catch(t){if(uD(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await wD(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Bp(n.appConfig,r)}throw t}}function ED(n){return n!==void 0&&n.registrationStatus===2}function H9(n){return n.requestStatus===2&&!K9(n)}function K9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+I9}function Q9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function Y9(n){return n.requestStatus===1&&n.requestTime+aD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J9(n){const e=n,{installationEntry:t,registrationPromise:r}=await PI(e);return r?r.catch(console.error):kI(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X9(n,e=!1){const t=n;return await Z9(t),(await kI(t,e)).token}async function Z9(n){const{registrationPromise:e}=await PI(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ez(n){if(!n||!n.options)throw Sy("App Configuration");if(!n.name)throw Sy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Sy(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Sy(n){return aa.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD="installations",tz="installations-internal",nz=n=>{const e=n.getProvider("app").getImmediate(),t=ez(e),r=gs(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},rz=n=>{const e=n.getProvider("app").getImmediate(),t=gs(e,xD).getImmediate();return{getId:()=>J9(t),getToken:s=>X9(t,s)}};function sz(){qr(new Zn(xD,nz,"PUBLIC")),qr(new Zn(tz,rz,"PRIVATE"))}sz();Jn(oD,RI);Jn(oD,RI,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $p="analytics",iz="firebase_id",oz="origin",az=60*1e3,lz="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",DI="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xn=new Cd("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cz={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},dr=new da("analytics","Analytics",cz);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uz(n){if(!n.startsWith(DI)){const e=dr.create("invalid-gtag-resource",{gtagURL:n});return Xn.warn(e.message),""}return n}function TD(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function dz(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function hz(n,e){const t=dz("firebase-js-sdk-policy",{createScriptURL:uz}),r=document.createElement("script"),s=`${DI}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function fz(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function pz(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await TD(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){Xn.error(a)}n("config",s,i)}async function mz(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await TD(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Xn.error(i)}}function gz(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await mz(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await pz(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Xn.error(a)}}return s}function yz(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=gz(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function _z(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(DI)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vz=30,wz=1e3;class Iz{constructor(e={},t=wz){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const SD=new Iz;function Ez(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function xz(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:Ez(t)},s=lz.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw dr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function Tz(n,e=SD,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw dr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw dr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Az;return setTimeout(async()=>{a.abort()},t!==void 0?t:az),bD({appId:r,apiKey:s,measurementId:i},o,a,e)}async function bD(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=SD){var a;const{appId:i,measurementId:o}=n;try{await Sz(r,e)}catch(l){if(o)return Xn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await xz(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!bz(u)){if(s.deleteThrottleMetadata(i),o)return Xn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?Px(t,s.intervalMillis,vz):Px(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),Xn.debug(`Calling attemptFetch again in ${h} millis`),bD(n,f,r,s)}}function Sz(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(dr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function bz(n){if(!(n instanceof Wr)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class Az{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Cz(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rz(){if(am())try{await v0()}catch(n){return Xn.warn(dr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Xn.warn(dr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Nz(n,e,t,r,s,i,o){const a=Tz(n);a.then(p=>{t[p.measurementId]=p.appId,n.options.measurementId&&p.measurementId!==n.options.measurementId&&Xn.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>Xn.error(p)),e.push(a);const l=Rz().then(p=>{if(p)return r.getId()}),[u,h]=await Promise.all([a,l]);_z(i)||hz(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[oz]="firebase",f.update=!0,h!=null&&(f[iz]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pz{constructor(e){this.app=e}_delete(){return delete Cu[this.app.options.appId],Promise.resolve()}}let Cu={},yb=[];const _b={};let by="dataLayer",kz="gtag",vb,AD,wb=!1;function Dz(){const n=[];if(_0()&&n.push("This is a browser extension environment."),ZA()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=dr.create("invalid-analytics-context",{errorInfo:e});Xn.warn(t.message)}}function Oz(n,e,t){Dz();const r=n.options.appId;if(!r)throw dr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Xn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw dr.create("no-api-key");if(Cu[r]!=null)throw dr.create("already-exists",{id:r});if(!wb){fz(by);const{wrappedGtag:i,gtagCore:o}=yz(Cu,yb,_b,by,kz);AD=i,vb=o,wb=!0}return Cu[r]=Nz(n,yb,_b,e,vb,by,t),new Pz(n)}function Mz(n=Rd()){n=X(n);const e=gs(n,$p);return e.isInitialized()?e.getImmediate():Lz(n)}function Lz(n,e={}){const t=gs(n,$p);if(t.isInitialized()){const s=t.getImmediate();if(fr(e,t.getOptions()))return s;throw dr.create("already-initialized")}return t.initialize({options:e})}async function Vz(){if(_0()||!ZA()||!am())return!1;try{return await v0()}catch{return!1}}function Fz(n,e,t,r){n=X(n),Cz(AD,Cu[n.app.options.appId],e,t,r).catch(s=>Xn.error(s))}const Ib="@firebase/analytics",Eb="0.10.18";function jz(){qr(new Zn($p,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return Oz(r,s,t)},"PUBLIC")),qr(new Zn("analytics-internal",n,"PRIVATE")),Jn(Ib,Eb),Jn(Ib,Eb,"esm2020");function n(e){try{const t=e.getProvider($p).getImmediate();return{logEvent:(r,s,i)=>Fz(t,r,s,i)}}catch(t){throw dr.create("interop-component-reg-failed",{reason:t})}}}jz();const CD={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},dg=ZL().length?Rd():iC(CD),se=T4(dg,CD.databaseURL),kf=QU(dg),Ti=_9(dg);console.log("✅ Firebase services initialized:",{db:!!se,firestore:!!kf,auth:!!Ti});WB(Ti,Gk).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let Uz=null;(async()=>{try{await Vz()&&(Uz=Mz(dg))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();class OI{constructor(e,t){this.db=e,this.userUID=t,this.userRef=ve(e,`users/${t}`),this.statsRef=ve(e,`users/${t}/stats`),this.profileRef=ve(e,`users/${t}/profile`),this.behaviorLogRef=ve(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{const s=await Pt(this.statsRef);if(!s.exists())return!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));return await en(this.statsRef,{...i,[e]:a}),await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`Error updating ${e}:`,s),!1}}async updateAddictionFromCleanTime(){try{const e=await Pt(ve(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Pt(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapsePenaltyLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{const e=new Date,t=await Pt(ve(this.db,`users/${this.userUID}/profile/relapseDate`));let r=1;if(t.exists()){const i=new Date(t.val()),o=Math.floor((e-i)/(1e3*60*60*24));o<=3?r=3:o<=7?r=2:r=1}let s=0;switch(r){case 1:s=4;break;case 2:s=6;break;case 3:s=8;break}return await Promise.all([this.updateStat("addictionLevel",s,`Relapse penalty level ${r}`),this.updateStat("mentalStrength",-3,"Relapse setback"),this.updateStat("triggerDefense",-3,"Relapse to known trigger")]),await en(ve(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),await this.logBehavior("relapse",r,`Penalty level ${r} - ${s} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapsePenaltyLevel(){try{await en(ve(this.db,`users/${this.userUID}/profile/relapsePenaltyLevel`),1),console.log("Relapse penalty level reset")}catch(e){console.error("Error resetting relapse penalty level:",e)}}async handleCravingResistance(){try{return await Promise.all([this.updateStat("mentalStrength",1,"Successful craving resistance"),this.updateStat("triggerDefense",3,"Surviving trigger situation")]),await this.trackAppUsageDuringCravings(),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await en(ve(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await en(ve(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await Pt(ve(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Pt(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await Pt(ve(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),en(ve(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString();return await en(ve(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),await this.checkInactivityPenalty(),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async checkMoneyMilestones(){var e;try{const t=await Pt(ve(this.db,`users/${this.userUID}/profile/relapseDate`)),r=await Pt(this.userRef);if(!r.exists())return;const s=r.val(),i=t.exists()?new Date(t.val()):new Date(s.quitDate||Date.now()),u=Math.floor((new Date-i)/(1e3*60*60*24))*10,h=[50,100,200,500,1e3];for(const f of h)if(u>=f){const p=`moneyMilestone_${f}`;(await Pt(ve(this.db,`users/${this.userUID}/profile/${p}`))).exists()||await Promise.all([this.updateStat("motivation",2,`$${f} saved milestone`),en(ve(this.db,`users/${this.userUID}/profile/${p}`),!0)])}await this.updateStat("moneySaved",u-(((e=r.val().stats)==null?void 0:e.moneySaved)||0),"Money saved calculation")}catch(t){console.error("Error checking money milestones:",t)}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Pt(ve(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Pt(ve(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Pt(ve(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{let e=null;for(let t=0;t<10;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Pt(ve(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));if(i.exists()&&i.val()){e=t;break}}(e===null||e>=7)&&await this.updateStat("motivation",-3,"Long period inactive (7+ days)")}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await Pt(ve(this.db,`users/${this.userUID}/profile/${t}`));let s=r.exists()?r.val():0;s++,await en(ve(this.db,`users/${this.userUID}/profile/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await ER(ve(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkMoneyMilestones(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates(),console.log("StatManager initialized successfully")}catch(e){console.error("Error initializing StatManager:",e)}}}class Bz{constructor(e){this.db=e,this.matchingPoolRef=ve(e,"matchingPool"),this.buddyPairsRef=ve(e,"buddyPairs"),this.usersRef=ve(e,"users")}async addToMatchingPool(e,t){var r;try{const s={userId:e,quitStartDate:t.quitDate||new Date().toISOString(),addictionLevel:((r=t.stats)==null?void 0:r.addictionLevel)||50,triggers:t.triggers||[],timezone:t.timezone||"UTC",quitExperience:t.quitExperience||"first-timer",availableForMatching:!0,lastActive:new Date().toISOString(),createdAt:new Date().toISOString(),archetype:t.archetype||"DETERMINED",dailyPatterns:t.dailyPatterns||[],copingStrategies:t.copingStrategies||[],confidence:t.confidence||5,preferredContactMethod:"chat",availabilityHours:t.availabilityHours||"anytime",language:t.language||"en"};return await en(ve(this.db,`matchingPool/${e}`),s),console.log(`✅ User ${e} added to matching pool`),!0}catch(s){return console.error("❌ Error adding user to matching pool:",s),!1}}async removeFromMatchingPool(e){try{return await l4(ve(this.db,`matchingPool/${e}`)),console.log(`✅ User ${e} removed from matching pool`),!0}catch(t){return console.error("❌ Error removing user from matching pool:",t),!1}}async updateMatchingAvailability(e,t){try{return await en(ve(this.db,`matchingPool/${e}/availableForMatching`),t),await en(ve(this.db,`matchingPool/${e}/lastActive`),new Date().toISOString()),console.log(`✅ User ${e} matching availability updated to: ${t}`),!0}catch(r){return console.error("❌ Error updating matching availability:",r),!1}}async updateLastActive(e){try{return await en(ve(this.db,`matchingPool/${e}/lastActive`),new Date().toISOString()),!0}catch(t){return console.error("❌ Error updating last active:",t),!1}}async findCompatibleMatches(e,t=5){try{const r=await Pt(ve(this.db,`matchingPool/${e}`));if(!r.exists())return console.log("❌ User not found in matching pool"),[];const s=r.val(),i=await Pt(this.matchingPoolRef);if(!i.exists())return console.log("❌ No users in matching pool"),[];const o=i.val(),a=[];for(const[l,u]of Object.entries(o)){if(l===e||!u.availableForMatching)continue;const h=this.calculateCompatibilityScore(s,u);h>=.1&&a.push({userId:l,profile:u,compatibilityScore:h,matchReasons:this.getMatchReasons(s,u)})}return a.sort((l,u)=>u.compatibilityScore-l.compatibilityScore),a.slice(0,t)}catch(r){return console.error("❌ Error finding compatible matches:",r),[]}}calculateCompatibilityScore(e,t){let r=0,s=0;const i=new Date(e.quitStartDate),o=new Date(t.quitStartDate),a=Math.abs(i-o)/(1e3*60*60*24),l=Math.max(0,1-a/30);r+=l*.3,s+=.3;const u=Math.abs(e.addictionLevel-t.addictionLevel),h=Math.max(0,1-u/100);r+=h*.25,s+=.25;const f=e.timezone===t.timezone?1:.5;r+=f*.2,s+=.2;const p=e.quitExperience===t.quitExperience?1:.7;r+=p*.15,s+=.15;const y=e.triggers.filter(T=>t.triggers.includes(T)).length,x=Math.min(1,y/Math.max(e.triggers.length,1));return r+=x*.1,s+=.1,r/s}getMatchReasons(e,t){const r=[],s=new Date(e.quitStartDate),i=new Date(t.quitStartDate),o=Math.abs(s-i)/(1e3*60*60*24);o<=7?r.push("Started quitting around the same time"):o<=30&&r.push("Similar quit journey timeline"),Math.abs(e.addictionLevel-t.addictionLevel)<=10&&r.push("Similar addiction levels"),e.timezone===t.timezone&&r.push("Same timezone for easy communication"),e.quitExperience===t.quitExperience&&r.push(`Both ${e.quitExperience}s`);const l=e.triggers.filter(u=>t.triggers.includes(u));return l.length>0&&r.push(`Shared triggers: ${l.join(", ")}`),r}async createBuddyPair(e,t,r={}){try{const s=ER(this.buddyPairsRef).key,i={pairId:s,users:[e,t],matchedAt:new Date().toISOString(),compatibilityScore:r.compatibilityScore||0,matchReasons:r.matchReasons||[],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};return await en(ve(this.db,`buddyPairs/${s}`),i),await Promise.all([this.removeFromMatchingPool(e),this.removeFromMatchingPool(t)]),await Promise.all([en(ve(this.db,`users/${e}/buddyInfo`),{hasBuddy:!0,buddyId:t,pairId:s,matchedAt:i.matchedAt}),en(ve(this.db,`users/${t}/buddyInfo`),{hasBuddy:!0,buddyId:e,pairId:s,matchedAt:i.matchedAt})]),console.log(`✅ Buddy pair created between ${e} and ${t}`),!0}catch(s){return console.error("❌ Error creating buddy pair:",s),!1}}async getUserBuddyInfo(e){try{const t=await Pt(ve(this.db,`users/${e}/buddyInfo`));return t.exists()?t.val():null}catch(t){return console.error("❌ Error getting user buddy info:",t),null}}async getBuddyPairInfo(e){try{const t=await Pt(ve(this.db,`buddyPairs/${e}`));return t.exists()?t.val():null}catch(t){return console.error("❌ Error getting buddy pair info:",t),null}}async forceMatchUsers(e,t){try{console.log(`🔧 Force matching users ${e} and ${t}`);const r={compatibilityScore:.95,matchReasons:["Force matched for testing","High compatibility detected"],matchedAt:Date.now()},s=await this.createBuddyPair(e,t,r);return s&&console.log(`✅ Force match successful between ${e} and ${t}`),s}catch(r){return console.error("❌ Error force matching users:",r),!1}}async cleanupInactiveUsers(e=30){try{const t=await Pt(this.matchingPoolRef);if(!t.exists())return 0;const r=t.val(),s=new Date;s.setDate(s.getDate()-e);let i=0;for(const[o,a]of Object.entries(r))new Date(a.lastActive)<s&&(await this.removeFromMatchingPool(o),i++);return console.log(`✅ Cleaned up ${i} inactive users from matching pool`),i}catch(t){return console.error("❌ Error cleaning up inactive users:",t),0}}async getMatchingPoolStats(){try{const e=await Pt(this.matchingPoolRef);if(!e.exists())return{totalUsers:0,availableUsers:0,averageAddictionLevel:0,topTriggers:[],timezoneDistribution:{}};const t=e.val(),r=Object.values(t);return{totalUsers:r.length,availableUsers:r.filter(i=>i.availableForMatching).length,averageAddictionLevel:r.reduce((i,o)=>i+(o.addictionLevel||0),0)/r.length,topTriggers:this.getTopTriggers(r),timezoneDistribution:this.getTimezoneDistribution(r),quitExperienceDistribution:this.getQuitExperienceDistribution(r)}}catch(e){return console.error("❌ Error getting matching pool stats:",e),null}}getTopTriggers(e){const t={};return e.forEach(r=>{var s;(s=r.triggers)==null||s.forEach(i=>{t[i]=(t[i]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimezoneDistribution(e){const t={};return e.forEach(r=>{const s=r.timezone||"Unknown";t[s]=(t[s]||0)+1}),t}getQuitExperienceDistribution(e){const t={};return e.forEach(r=>{const s=r.quitExperience||"unknown";t[s]=(t[s]||0)+1}),t}listenToMatchingPoolStatus(e,t){const r=ve(this.db,`matchingPool/${e}`);return $_(r,i=>{i.exists()?t(i.val()):t(null)})}listenToBuddyPair(e,t){const r=ve(this.db,`buddyPairs/${e}`);return $_(r,i=>{i.exists()?t(i.val()):t(null)})}async getAllMatchingPoolUsers(){try{const e=await Pt(this.matchingPoolRef);if(!e.exists())return console.log("❌ No users in matching pool"),[];const t=e.val(),r=Object.entries(t).map(([s,i])=>({id:s,...i}));return console.log("📊 Matching pool users:",r),r}catch(e){return console.error("❌ Error getting matching pool users:",e),[]}}async forceMatchUsers(e,t){try{console.log(`🔧 Force matching users ${e} and ${t}`);const r={compatibilityScore:.95,matchReasons:["Force matched for testing","High compatibility detected"],matchedAt:Date.now()},s=await this.createBuddyPair(e,t,r);return s&&console.log(`✅ Force match successful between ${e} and ${t}`),s}catch(r){return console.error("❌ Error force matching users:",r),!1}}}class Ru{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=gy(e,"matchingPool"),this.buddyPairsCollection=gy(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:Qh(),lastActive:Qh(),status:"waiting"};return await $S(eu(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await zS(eu(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:Qh(),status:"active",...r},i=await a5(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await o5(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=eu(this.matchingPoolCollection,e),r=await i5(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async testConnectivity(){try{console.log("🧪 Firestore: Testing connectivity...");const e=gy(this.firestore,"connectionTest"),t=eu(e,"test-"+Date.now()),r={test:!0,timestamp:Qh(),message:"Firestore connectivity test",service:"FirestoreBuddyService"};return await $S(t,r),console.log("✅ Firestore: Connectivity test successful"),await zS(t),console.log("🧹 Firestore: Test document cleaned up"),!0}catch(e){return console.error("❌ Firestore: Connectivity test failed:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}const $z=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=j.useState("signin"),[s,i]=j.useState(""),[o,a]=j.useState(""),[l,u]=j.useState(""),[h,f]=j.useState(!1),[p,y]=j.useState(!1),[x,T]=j.useState(""),[P,R]=j.useState(""),[b,N]=j.useState(!1);j.useEffect(()=>()=>{p&&y(!1)},[p]);const k=new xs;k.addScope("email"),k.addScope("profile"),k.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const U=()=>{i(""),a(""),u(""),T(""),R("")},V=async()=>{f(!0),y(!0),T("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:k.scopes,customParameters:k.customParameters});const E=S$(Ti,k),C=new Promise((Z,de)=>{setTimeout(()=>de(new Error("Popup timeout - please try again")),6e4)}),w=await Promise.race([E,C]);if(w&&w.user){const Z=w.user;console.log("Google sign-in successful for:",Z.email,"UID:",Z.uid),console.log("User display name:",Z.displayName),console.log("User photo URL:",Z.photoURL),await new Promise(de=>setTimeout(de,800)),n(Z)}else throw new Error("No user data received from Google authentication")}catch(E){console.error("Google sign-in error:",E),E.code==="auth/popup-closed-by-user"?T("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):E.code==="auth/popup-blocked"?T("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):E.code==="auth/cancelled-popup-request"?T("Google sign-in was cancelled. Please try again and complete the authentication process."):E.code==="auth/account-exists-with-different-credential"?T("An account already exists with this email using a different sign-in method. Please use email/password instead."):E.message==="Popup timeout - please try again"?T("Google sign-in popup timed out. Please try again and complete the account selection quickly."):E.code==="auth/network-request-failed"?T("Network error during Google sign-in. Please check your internet connection and try again."):E.code==="auth/operation-not-allowed"?T("Google sign-in is not enabled for this app. Please contact support."):T(_(E.code))}finally{f(!1),y(!1)}},A=async E=>{E.preventDefault(),f(!0),T("");try{const w=(await LB(Ti,s,o)).user;console.log("Email sign-in successful for:",w.email),n(w)}catch(C){console.error("Email sign-in error:",C),T(_(C.code))}finally{f(!1)}},v=async E=>{if(E.preventDefault(),f(!0),T(""),o!==l){T("Passwords do not match"),f(!1);return}if(o.length<6){T("Password must be at least 6 characters long"),f(!1);return}try{const w=(await MB(Ti,s,o)).user;console.log("Email sign-up successful for:",w.email),await FB(w),n(w)}catch(C){console.error("Email sign-up error:",C),T(_(C.code))}finally{f(!1)}},S=async E=>{if(E.preventDefault(),!s){T("Please enter your email address");return}f(!0),T("");try{await DB(Ti,s),R("Password reset email sent! Check your inbox.")}catch(C){console.error("Password reset error:",C),T(_(C.code))}finally{f(!1)}},_=E=>{switch(E){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return b?d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),d.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),d.jsxs("form",{onSubmit:S,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:s,onChange:E=>i(E.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),x&&d.jsx("div",{className:"text-red-400 text-sm",children:x}),P&&d.jsx("div",{className:"text-green-400 text-sm",children:P}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"button",onClick:()=>{N(!1),T(""),R("")},className:"flex-1 px-4 py-2 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Back to Login"}),d.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Sending...":"Send Reset Link"})]})]})]})}):d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),d.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),d.jsxs("div",{children:[p&&d.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[d.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),d.jsx("button",{onClick:V,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),d.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:p?d.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,x&&d.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[d.jsx("div",{className:"text-red-300 text-sm mb-2",children:x}),x.includes("Google sign-in")&&!p&&d.jsx("button",{onClick:V,disabled:h,className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),d.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[d.jsx("button",{onClick:()=>{r("signin"),U()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),d.jsx("button",{onClick:()=>{r("signup"),U()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&d.jsxs("form",{onSubmit:A,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signin-email",type:"email",value:s,onChange:E=>i(E.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signin-password",type:"password",value:o,onChange:E=>a(E.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("button",{type:"button",onClick:()=>N(!0),className:"text-sm text-blue-400 hover:text-blue-300",children:"Forgot your password?"})}),x&&d.jsx("div",{className:"text-red-400 text-sm",children:x}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&d.jsxs("form",{onSubmit:v,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signup-email",type:"email",value:s,onChange:E=>i(E.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signup-password",type:"password",value:o,onChange:E=>a(E.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),d.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:E=>u(E.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),x&&d.jsx("div",{className:"text-red-400 text-sm",children:x}),P&&d.jsx("div",{className:"text-green-400 text-sm",children:P}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Creating account...":"Create Account"})]})]})})},zz=()=>{const[n,e]=j.useState(navigator.onLine),[t,r]=j.useState(!1);return j.useEffect(()=>{const s=()=>{e(!0),r(!1),console.log("🌐 Connection restored")},i=()=>{e(!1),r(!0),console.log("📡 Connection lost")};return window.addEventListener("online",s),window.addEventListener("offline",i),e(navigator.onLine),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",i)}},[]),n?null:d.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),d.jsx("span",{className:"font-medium",children:"You're offline. Some features may be limited."}),d.jsx("button",{onClick:()=>r(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors",children:d.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t&&d.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[d.jsx("p",{className:"mb-2",children:"While offline, you can:"}),d.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[d.jsx("li",{children:"• View your current stats and progress"}),d.jsx("li",{children:"• Track habits and cravings"}),d.jsx("li",{children:"• Play distraction games"}),d.jsx("li",{children:"• View your profile information"})]}),d.jsx("p",{className:"mt-2 text-yellow-200",children:"Changes will sync when you're back online."})]})]})};var qz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Wz=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Gz=(n,e)=>{const t=j.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>j.createElement("svg",{ref:u,...qz,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${Wz(n)}`,...l},[...e.map(([h,f])=>j.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var Bn=Gz;const Hz=Bn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Kz=Bn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),RD=Bn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),ND=Bn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Qz=Bn("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Yz=Bn("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Zh=Bn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),PD=Bn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ed=Bn("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Jz=Bn("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),kD=Bn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Xz=Bn("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),DD=Bn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),OD=Bn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),MD=Bn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);console.log("🧪 FirestoreBuddyService import check:",!!Ru);console.log("🧪 FirestoreBuddyService type:",typeof Ru);console.log("🧪 FirestoreBuddyService constructor:",Ru==null?void 0:Ru.name);const Is=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},ef=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},Zz=({onComplete:n,authUser:e})=>{const[t,r]=j.useState(1),[s,i]=j.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[h,f]=j.useState(null),[p,y]=j.useState(null),x=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:Ed},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:MD},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:ND},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:RD}],T=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],P=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],R=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],b=()=>{console.log("Calculating stats with userData:",s);let _=40;s.vapePodsPerWeek<=1?_+=5:s.vapePodsPerWeek<=3?_+=15:s.vapePodsPerWeek<=5?_+=25:s.vapePodsPerWeek<=7?_+=35:_+=40;const E=s.nicotineStrength||"",C=parseInt(E.replace("mg",""))||0;C<=5?_+=0:C<=11?_+=10:C<=20?_+=20:_+=25,s.dailyPatterns.includes("Throughout the day")?_+=20:s.dailyPatterns.length>2?_+=10:_+=0,_=Math.min(_,100);let w=25;s.confidence>=9?w+=35:s.confidence>=7?w+=25:s.confidence>=4?w+=15:w+=0,s.quitAttempts==="first"?w+=15:parseInt(s.quitAttempts)<=3?w+=10:w+=5,s.copingStrategies.length>=3?w+=15:s.copingStrategies.length>=1?w+=10:w+=0,w=Math.min(w,80);let Z=35;Z+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[s.archetype]||0,s.confidence>=8?Z+=25:s.confidence>=5?Z+=15:Z+=0,s.quitAttempts==="first"?Z+=10:parseInt(s.quitAttempts)<=3?Z+=5:Z+=15,Z=Math.min(Z,90);let re=15;s.triggers.length<=2?re+=15:s.triggers.length<=4?re+=10:re+=5;const Ve=s.triggers.includes("Drinking alcohol"),z=s.triggers.includes("Social situations");return Ve&&z?re+=0:s.triggers.length>3?re+=5:re+=10,s.copingStrategies.length>=3?re+=25:s.copingStrategies.length>=1?re+=15:re+=0,s.dailyPatterns.includes("Throughout the day")?re+=0:s.dailyPatterns.length>2?re+=5:re+=10,re=Math.min(re,60),{addictionLevel:_,mentalStrength:w,motivation:Z,triggerDefense:re}},N=_=>{const E=_.target.files[0];if(E){f(E);const C=new FileReader;C.onload=w=>y(w.target.result),C.readAsDataURL(E)}},k=async()=>{if(h){u(!0);try{const _=document.createElement("canvas"),E=_.getContext("2d"),C=new Image;C.onload=()=>{_.width=200,_.height=200,E.filter="contrast(1.2) saturate(1.3) brightness(1.1)",E.drawImage(C,0,0,200,200),E.globalCompositeOperation="overlay",E.fillStyle="rgba(255, 200, 200, 0.1)",E.fillRect(0,0,200,200);const w=_.toDataURL("image/png"),Z={...s,avatar:w};i(Z),S(Z,3),u(!1)},C.src=p}catch(_){console.error("Photo processing failed:",_);const E=ef(s.avatarSeed);i(C=>({...C,avatar:E})),u(!1)}}},U=()=>{a(!0);const _=Math.random().toString(36).substring(7);(async()=>{try{const C=Is(_),w={...s,avatarSeed:_,avatar:C};i(w),S(w,3)}catch{const w=ef(_),Z={...s,avatarSeed:_,avatar:w};i(Z),S(Z,3)}})(),setTimeout(()=>a(!1),500)},V=async()=>{if(t<10)await S(s,t),r(t+1);else try{console.log("Completing onboarding with userData:",s);const _=b();console.log("Calculated stats:",_);const E={...s,stats:{..._,streakDays:0,moneySaved:0,experiencePoints:0},achievements:[],quitDate:new Date};await S(E,10),console.log("Final user data:",E),n(E)}catch(_){console.error("Error completing onboarding:",_);const C={...s,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,moneySaved:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await S(C,10)}catch(w){console.error("Failed to save fallback data to Firebase:",w)}console.log("Using fallback stats:",C),n(C)}},A=()=>{t>1&&r(t-1)},v=()=>{switch(t){case 1:return s.heroName.trim().length>0;case 2:return s.archetype!=="";case 3:return s.avatar!==null;case 4:return s.triggers.length>0;case 5:return s.dailyPatterns.length>0;case 6:return s.copingStrategies.length>0;case 7:return s.vapePodsPerWeek>0;case 8:return s.nicotineStrength!=="";case 9:return s.quitAttempts!=="";case 10:return s.confidence>0;default:return!1}},S=async(_,E)=>{if(e)try{const{ref:C,set:w}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Z=C(se,`users/${e.uid}/onboarding`);await w(C(se,`users/${e.uid}/onboarding/step${E}`),{..._,stepNumber:E,timestamp:Date.now()}),await w(C(se,`users/${e.uid}/onboarding/progress`),{currentStep:E,completedSteps:Array.from({length:E},(de,re)=>re+1),lastUpdated:Date.now()}),console.log(`Step ${E} saved to Firebase successfully`)}catch(C){console.error(`Error saving step ${E} to Firebase:`,C)}};return j.useEffect(()=>{if(!s.avatar){const _=Is(s.avatarSeed);i(E=>({...E,avatar:_}))}},[]),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(_=>d.jsxs("div",{className:"flex items-center flex-shrink-0",children:[d.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${_<=t?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:_<t?"✓":_}),_<10&&d.jsx("div",{className:`w-4 h-1 mx-1 ${_<t?"bg-blue-500":"bg-slate-600"}`})]},_))}),t===1&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(Jz,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),d.jsx("input",{type:"text",value:s.heroName,onChange:_=>{const E={...s,heroName:_.target.value};i(E),_.target.value.trim().length>0&&S(E,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t===2&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(Ed,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),d.jsx("div",{className:"space-y-3 mb-6",children:x.map(_=>{const E=_.icon;return d.jsx("button",{onClick:()=>{const C={...s,archetype:_.id};i(C),S(C,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.archetype===_.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 ${_.color} rounded-lg flex items-center justify-center`,children:d.jsx(E,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-white font-semibold",children:_.name}),d.jsx("p",{className:"text-gray-400 text-sm",children:_.description})]})]})},_.id)})})]}),t===3&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(OD,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:s.avatar?d.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{i(_=>({..._,avatar:ef(_.avatarSeed)}))}}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(Zh,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),d.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden",id:"photo-upload"}),d.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),p&&d.jsx("div",{className:"mb-4",children:d.jsx("button",{onClick:k,disabled:l,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?d.jsxs(d.Fragment,{children:[d.jsx(Zh,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):d.jsx(d.Fragment,{children:"✨ Convert to Anime"})})}),d.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),d.jsx("button",{onClick:U,disabled:o,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:o?d.jsxs(d.Fragment,{children:[d.jsx(Zh,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):d.jsxs(d.Fragment,{children:[d.jsx(Zh,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),d.jsx("button",{onClick:()=>{const _=ef(s.avatarSeed),E={...s,avatar:_};i(E),S(E,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),t===4&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:T.map(_=>d.jsx("button",{onClick:()=>{const E={...s,triggers:s.triggers.includes(_)?s.triggers.filter(C=>C!==_):[...s.triggers,_]};i(E),S(E,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.triggers.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.triggers.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.triggers.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===5&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📅"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:P.map(_=>d.jsx("button",{onClick:()=>{const E={...s,dailyPatterns:s.dailyPatterns.includes(_)?s.dailyPatterns.filter(C=>C!==_):[...s.dailyPatterns,_]};i(E),S(E,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.dailyPatterns.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.dailyPatterns.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.dailyPatterns.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===6&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🛡️"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:R.map(_=>d.jsx("button",{onClick:()=>{const E={...s,copingStrategies:s.copingStrategies.includes(_)?s.copingStrategies.filter(C=>C!==_):[...s.copingStrategies,_]};i(E),S(E,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.copingStrategies.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.copingStrategies.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.copingStrategies.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===7&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🚬"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.vapePodsPerWeek,onChange:_=>{const E={...s,vapePodsPerWeek:parseFloat(_.target.value)||0};i(E),E.vapePodsPerWeek>0&&S(E,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select pods per week"}),d.jsx("option",{value:"0.5",children:"0.5 pods"}),d.jsx("option",{value:"1",children:"1 pod"}),d.jsx("option",{value:"2",children:"2 pods"}),d.jsx("option",{value:"3",children:"3 pods"}),d.jsx("option",{value:"4",children:"4 pods"}),d.jsx("option",{value:"5",children:"5 pods"}),d.jsx("option",{value:"6",children:"6 pods"}),d.jsx("option",{value:"7",children:"7 pods"}),d.jsx("option",{value:"8",children:"8+ pods"})]})})]}),t===8&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"⚡"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.nicotineStrength,onChange:_=>{const E={...s,nicotineStrength:_.target.value};i(E),E.nicotineStrength&&S(E,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select nicotine strength"}),d.jsx("option",{value:"3mg",children:"3mg"}),d.jsx("option",{value:"6mg",children:"6mg"}),d.jsx("option",{value:"12mg",children:"12mg"}),d.jsx("option",{value:"18mg",children:"18mg"}),d.jsx("option",{value:"20mg",children:"20mg"}),d.jsx("option",{value:"50mg",children:"50mg"})]})})]}),t===9&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📚"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.quitAttempts,onChange:_=>{const E={...s,quitAttempts:_.target.value};i(E),E.quitAttempts&&S(E,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select option"}),d.jsx("option",{value:"first",children:"This is my first attempt"}),d.jsx("option",{value:"1",children:"Once before"}),d.jsx("option",{value:"2",children:"Twice before"}),d.jsx("option",{value:"3",children:"3-5 times"}),d.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),t===10&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),d.jsx("input",{type:"range",min:"1",max:"10",value:s.confidence,onChange:_=>{const E={...s,confidence:parseInt(_.target.value)};i(E),S(E,10)},className:"flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider"}),d.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),d.jsxs("div",{className:"text-center mt-2",children:[d.jsx("span",{className:"text-white font-bold text-lg",children:s.confidence}),d.jsx("span",{className:"text-gray-400 text-sm ml-2",children:"/ 10"})]})]})]}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:A,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),d.jsxs("button",{onClick:V,disabled:!v(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${v()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[t===10?"Start Journey":"Next",d.jsx(Hz,{className:"w-4 h-4"})]})]})]})})},xb={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:Ed},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:MD},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:ND},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:RD}},eq={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},Tb={WEEK_WARRIOR:{name:"Week Warrior",icon:Kz,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:DD,description:"30 days clean"},LEGEND:{name:"Legend",icon:kD,description:"90 days clean"}},tq=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",nq=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Time since last vape - decreases as your body heals",impacts:["What decreases it:","• Clean time: -2 points per week (standard recovery)","• Cold turkey approach: -3 points per week (faster healing)","• Tapering approach: -1.5 points per week (gentler decline)","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","• Reset: Penalty level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","• Reaching money saved milestones: +2 points","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),d.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),d.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>d.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[d.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300",children:"Got it"})]})}):null},tf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return d.jsxs("div",{className:"mb-2",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{children:n}),s&&i&&d.jsx("button",{onClick:()=>i(s),className:"w-4 h-4 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold transition-colors",title:`Learn about ${n}`,children:"i"})]}),d.jsxs("span",{children:[o,"/",t]})]}),d.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:`${r} h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},Sb=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=j.useState(!1),[a,l]=j.useState(null),[u,h]=j.useState([]);if(j.useEffect(()=>{let k=!1;return(async()=>{try{if(n&&n.uid){const V=await x(n);k||h(V)}else k||h([])}catch{k||h([])}})(),()=>{k=!0}},[n==null?void 0:n.uid]),n.isEmpty)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),d.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for Buddy"}),d.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We are searching for a suitable quit buddy for you. This may take a few minutes."}),d.jsx("div",{className:"mt-4 p-3 bg-slate-700/50 rounded-lg",children:d.jsx("p",{className:"text-slate-300 text-xs",children:"💡 Tip: Complete your profile to help us find better matches"})})]})});if(!n||!n.archetype||!n.stats)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const f=xb[n.archetype];if(!f)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(xb)),d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),d.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const p=eq[tq(n.stats.streakDays)],y=f.icon,x=async k=>{let U=null;if(k.uid)try{const{ref:v,get:S}=await Ge(()=>import("./index.esm-76803d89.js"),[]),_=v(se,`users/${k.uid}/specialFeatures`),E=await S(_);E.exists()&&(U=E.val())}catch(v){console.error("Error fetching special features from Firebase:",v)}if(!U){const v=`specialFeatures_${k.heroName||k.id||"default"}`,S=localStorage.getItem(v);S&&(U=JSON.parse(S))}if(U)return U;const V=[];for(k.triggers&&k.triggers.length>0&&k.triggers.forEach(v=>{switch(v){case"Stress/anxiety":V.push("Stress Vaper");break;case"Social situations":V.push("Social Vaper");break;case"Boredom":V.push("Boredom Vaper");break;case"After meals":V.push("Habit Vaper");break;case"Drinking alcohol":V.push("Party Vaper");break;case"Work breaks":V.push("Break Vaper");break;case"Driving":V.push("Driving Vaper");break}}),k.dailyPatterns&&k.dailyPatterns.length>0&&k.dailyPatterns.forEach(v=>{switch(v){case"Morning routine":V.push("Morning Struggler");break;case"Evening wind-down":V.push("Late Night Lurker");break;case"Throughout the day":V.push("All-Day Addict");break}}),k.copingStrategies&&k.copingStrategies.length>0&&(k.copingStrategies.includes("Nothing - this is new to me")?V.push("First Timer"):k.copingStrategies.length>2&&V.push("Veteran Quitter"));V.length<4;){const v=["Nicotine Fighter","Health Seeker","Freedom Chaser","Willpower Warrior"],S=v[Math.floor(Math.random()*v.length)];V.includes(S)||V.push(S)}const A=V.slice(0,4);if(k.uid)try{const{ref:v,set:S}=await Ge(()=>import("./index.esm-76803d89.js"),[]),_=v(se,`users/${k.uid}/specialFeatures`);await S(_,A),console.log("Special features saved to Firebase successfully")}catch(v){console.error("Error saving special features to Firebase:",v);const S=`specialFeatures_${k.heroName||k.id||"default"}`;localStorage.setItem(S,JSON.stringify(A))}else{const v=`specialFeatures_${k.heroName||k.id||"default"}`;localStorage.setItem(v,JSON.stringify(A))}return A},T=n.stats.addictionLevel||50,P=n.stats.mentalStrength||50,R=n.stats.motivation||50,b=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const N=k=>{l(k),o(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`relative w-80 h-[520px] rounded-xl ${p.color} border-4 ${p.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-4 transform transition-all duration-300 hover:scale-105 mx-auto overflow-hidden`,children:[d.jsxs("div",{className:"text-center mb-3",children:[d.jsx("h3",{className:"text-white font-bold text-lg leading-tight break-words px-1",children:n.heroName}),d.jsx("p",{className:"text-gray-300 text-base",children:f.name})]}),d.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):d.jsx("div",{className:`w-full h-full ${f.color} flex items-center justify-center`,children:d.jsx(y,{className:"w-12 h-12 text-white"})})}),d.jsxs("div",{className:"space-y-2 mb-4",children:[d.jsx(tf,{label:"Addiction",value:T,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:N}),d.jsx(tf,{label:"Mental Strength",value:P,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:N}),d.jsx(tf,{label:"Motivation",value:R,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:N}),d.jsx(tf,{label:"Trigger Defense",value:b,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:N})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),d.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((k,U)=>d.jsx("div",{className:"px-2 py-1 bg-blue-600/80 text-white text-xs rounded-full font-medium",title:k,children:k},U))})]}),d.jsxs("div",{className:"bg-black/30 rounded-lg p-3 space-y-2 mb-3 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex justify-between text-white text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Streak:"}),d.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[n.stats.streakDays," days",n.stats.streakDays>0&&d.jsx("span",{className:"text-xs",children:"🔥"})]})]}),d.jsxs("div",{className:"flex justify-between text-white text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),d.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,d.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&d.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((k,U)=>{var A,v;const V=((A=Tb[k])==null?void 0:A.icon)||kD;return d.jsx("div",{className:"w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(v=Tb[k])==null?void 0:v.description,children:d.jsx(V,{className:"w-3 h-3 text-white"})},U)}),n.achievements.length>4&&d.jsxs("div",{className:"w-6 h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),d.jsx(nq,{isOpen:i,onClose:()=>o(!1),statType:a})]})},rq=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:Qz},{id:"craving-support",label:"Craving Support",icon:Ed},{id:"profile",label:"Profile",icon:OD},{id:"buddy-chat",label:"Chat with Buddy",icon:Yz},{id:"settings",label:"Explore",icon:PD}];return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed bottom-20 left-0 right-0 bg-slate-700/90 backdrop-blur-sm border-t border-slate-600 px-4 py-2 z-30",children:d.jsxs("div",{className:"flex justify-center items-center gap-2 text-sm",children:[d.jsx("span",{className:"text-green-400",children:"🔐"}),d.jsx("span",{className:"text-white",children:"Session Active"}),d.jsx("span",{className:"text-gray-400",children:"•"}),d.jsx("span",{className:"text-gray-300",children:"30 days persistence"}),t&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"text-gray-400",children:"•"}),t.isComplete?d.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"✓"}),d.jsx("span",{children:"Synced"})]}):t.error?d.jsxs("span",{className:"text-red-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"⚠"}),d.jsx("span",{children:"Sync Error"})]}):d.jsxs("span",{className:"text-yellow-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"⟳"}),d.jsx("span",{children:"Syncing..."})]}),t.isComplete&&d.jsx("button",{onClick:r,className:"ml-2 px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors",title:"Refresh data from server",children:"🔄"})]}),s&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"text-gray-400",children:"•"}),s.isOnline?d.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"🌐"}),d.jsx("span",{children:"Online"})]}):d.jsxs("span",{className:"text-yellow-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"📡"}),d.jsx("span",{children:"Offline"})]}),s.syncQueue.length>0&&d.jsxs("span",{className:"text-blue-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"📝"}),d.jsxs("span",{children:[s.syncQueue.length," pending"]})]})]})]})}),d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:d.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return d.jsxs("button",{onClick:()=>e(o.id),className:`flex flex-col items-center transition-colors ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[d.jsx(a,{className:"w-5 h-5"}),d.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})]})},sq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,buddyLoading:s,buddyError:i,realBuddy:o})=>{if(console.log("🔍 ArenaView: Props received:",{hasUser:!!n,hasNemesis:!!e,userUid:n==null?void 0:n.uid,nemesisUid:e==null?void 0:e.uid}),!n)return console.warn("ArenaView: user prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),d.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!e)return console.warn("ArenaView: nemesis prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),d.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[a,l]=j.useState(!1),[u,h]=j.useState(null);j.useEffect(()=>{o&&console.log("🔍 Arena: Real buddy loaded:",o.heroName)},[o]);const f=async()=>{u&&await u.handleAchievementShare()},p=async C=>{const w={...C.stats};if(!(C!=null&&C.uid)){const Z=localStorage.getItem("quitCoachRelapseDate");if(Z){const Ve=new Date(Z),te=new Date().getTime()-Ve.getTime(),oe=Math.floor(te/(1e3*3600*24));w.streakDays=oe}else{const Ve=C.quitDate?new Date(C.quitDate):new Date,te=new Date().getTime()-Ve.getTime();w.streakDays=Math.floor(te/(1e3*3600*24))}const de=parseInt(localStorage.getItem("cravingWins")||0);w.cravingsResisted=de,new Date().toDateString();let re=0;for(let Ve=0;Ve<7;Ve++){const z=new Date;z.setDate(z.getDate()-Ve);const te=z.toDateString(),oe=localStorage.getItem(`water_${te}`);if(oe&&parseInt(oe)>0)re++;else break}return re>=3&&(w.mentalStrength=Math.min(80,(w.mentalStrength||50)+1)),w}try{const{ref:Z,get:de}=await Ge(()=>import("./index.esm-76803d89.js"),[]),re=Z(se,`users/${C.uid}/profile/relapseDate`),Ve=await de(re);if(Ve.exists()){const fe=new Date(Ve.val()),Mt=new Date().getTime()-fe.getTime(),me=Math.floor(Mt/(1e3*3600*24));w.streakDays=me}else{const fe=C.quitDate?new Date(C.quitDate):new Date,Mt=new Date().getTime()-fe.getTime();w.streakDays=Math.floor(Mt/(1e3*3600*24))}const z=Z(se,`users/${C.uid}/profile/cravingsResisted`),te=await de(z);w.cravingsResisted=te.exists()?te.val():0;const oe=new Date().toDateString();let Ce=0;for(let fe=0;fe<7;fe++){const Ue=new Date;Ue.setDate(Ue.getDate()-fe);const Mt=Ue.toDateString(),me=Z(se,`users/${C.uid}/profile/daily/${Mt}/water`),We=await de(me);if(We.exists()&&We.val()>0)Ce++;else break}Ce>=3&&(w.mentalStrength=Math.min(80,(w.mentalStrength||50)+1))}catch(Z){console.error("Error fetching profile data from Firebase:",Z);const de=localStorage.getItem("quitCoachRelapseDate");if(de){const z=new Date(de),oe=new Date().getTime()-z.getTime(),Ce=Math.floor(oe/(1e3*3600*24));w.streakDays=Ce}else{const z=C.quitDate?new Date(C.quitDate):new Date,oe=new Date().getTime()-z.getTime();w.streakDays=Math.floor(oe/(1e3*3600*24))}const re=parseInt(localStorage.getItem("cravingWins")||0);w.cravingsResisted=re,new Date().toDateString();let Ve=0;for(let z=0;z<7;z++){const te=new Date;te.setDate(te.getDate()-z);const oe=te.toDateString(),Ce=localStorage.getItem(`water_${oe}`);if(Ce&&parseInt(Ce)>0)Ve++;else break}Ve>=3&&(w.mentalStrength=Math.min(80,(w.mentalStrength||50)+1))}return w},[y,x]=j.useState(()=>{const C={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50},w=n!=null&&n.stats?{...C,...n.stats}:C;return console.log("🔍 ArenaView: Initializing realTimeUserStats:",w),w}),[T,P]=j.useState(()=>{const C={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50},w=e!=null&&e.stats?{...C,...e.stats}:C;return console.log("🔍 ArenaView: Initializing realTimeNemesisStats:",w),w});j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{const w=async()=>{try{const re=new OI(se,n.uid);await re.initialize(),h(re)}catch(re){console.error("Error initializing StatManager:",re)}},Z=async()=>{try{const re=new Bz(se);setBuddyMatchingService(re),console.log("✅ BuddyMatchingService initialized successfully")}catch(re){console.error("Error initializing BuddyMatchingService:",re)}};await w(),await Z(),await(async()=>{if(n){const re=await p(n);x(re)}if(e){const re=await p(e);P(re)}})()})()},[n,e]),j.useEffect(()=>{const C=()=>{console.log("🌐 Internet connection restored")},w=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",C),window.addEventListener("offline",w),()=>{window.removeEventListener("online",C),window.removeEventListener("offline",w)}},[]);const R=C=>{if(!C||!C.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const w=C.stats.mentalStrength||50,Z=C.stats.motivation||50,de=C.stats.triggerDefense||30,re=C.stats.addictionLevel||50;return w*1.5+Z*1+de*1.2-re*1},b=R({...n,stats:y}),N=R({...e,stats:T}),k=typeof b=="number"&&!isNaN(b)?b:0,U=typeof N=="number"&&!isNaN(N)?N:0,V=k>U?"WINNING":k===U?"TIED":"LOSING",A=()=>{if(V==="WINNING")return null;if(!y||!T)return console.warn("Stats not available for recommendations calculation"),[];const C=U-k+1,w=[],Z=(y==null?void 0:y.mentalStrength)||50,de=(y==null?void 0:y.motivation)||50,re=(y==null?void 0:y.triggerDefense)||30,Ve=(y==null?void 0:y.addictionLevel)||50,z=(T==null?void 0:T.mentalStrength)||50,te=(T==null?void 0:T.motivation)||50;T!=null&&T.triggerDefense;const oe=(T==null?void 0:T.addictionLevel)||50,Ce=z-Z,fe=te-de,Ue=Ve-oe,Mt=[{name:"Mental Strength",multiplier:1.5,gap:Ce,current:Z,max:100},{name:"Trigger Defense",multiplier:1.2,gap:fe,current:re,max:100},{name:"Motivation",multiplier:1,gap:fe,current:de,max:100},{name:"Addiction",multiplier:1,gap:Ue,current:Ve,min:0,isReduction:!0}];if(Mt.sort((me,We)=>me.multiplier!==We.multiplier?We.multiplier-me.multiplier:Math.abs(We.gap)-Math.abs(me.gap)),Mt.forEach(me=>{if(me.isReduction){const We=Math.min(me.current-me.min,50),Ct=We*me.multiplier;Ct>0&&w.push({stat:me.name,change:We,action:v(We),priority:Ct,canWin:Ct>=C,isReduction:!0,efficiency:me.multiplier,gap:me.gap})}else{const We=Math.min(me.max-me.current,50),Ct=We*me.multiplier;Ct>0&&w.push({stat:me.name,change:We,action:S(me.name,We),priority:Ct,canWin:Ct>=C,efficiency:me.multiplier,gap:me.gap})}}),w.sort((me,We)=>We.priority-me.priority),w.length>0&&!w.some(me=>me.canWin)){const me=_(w,C);me&&w.unshift(me)}return w.slice(0,3)},v=C=>C>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":C>=20?"Reduce nicotine intake significantly, avoid high-risk situations":C>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",S=(C,w)=>{switch(C){case"Mental Strength":return w>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":w>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return w>=30?"Log progress daily, share achievements weekly, track money saved milestones":w>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return w>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":w>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},_=(C,w)=>{let Z=0;const de=[];for(const re of C){if(Z>=w)break;const Ve=w-Z,z=Math.min(re.priority,Ve);z>0&&(de.push({stat:re.stat,change:Math.ceil(z/re.efficiency),contribution:z}),Z+=z)}return de.length>0?{stat:"Combination Strategy",change:Math.ceil(w),action:`Focus on: ${de.map(re=>`${re.stat} (+${re.change})`).join(", ")}`,priority:Z,canWin:Z>=w,isCombination:!0,strategy:de}:null},E=A()||[];return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:[d.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[d.jsxs("div",{className:"flex justify-start mb-6 gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1,!1]}),d.jsx("div",{className:"text-center mb-8",children:d.jsxs("div",{className:"inline-flex items-center gap-4",children:[d.jsxs("div",{className:`inline-flex items-center px-6 py-3 rounded-full font-bold text-lg shadow-xl ${V==="WINNING"?"bg-green-600":V==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[V==="WINNING"?d.jsx(DD,{className:"w-5 h-5 mr-2"}):V==="TIED"?d.jsx(Ed,{className:"w-5 h-5 mr-2"}):d.jsx("span",{className:"mr-2",children:"📉"}),"You are ",V]}),d.jsx("button",{onClick:()=>l(!0),className:"w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Battle Algorithm Info",children:d.jsx("span",{className:"text-lg font-bold",children:"i"})})]})}),d.jsxs("div",{className:"flex justify-center gap-12 mb-6",children:[d.jsx("div",{className:"w-80 text-center",children:d.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-full font-bold text-sm shadow-lg ${V==="WINNING"?"bg-green-600":V==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:V==="WINNING"?"WINNING":V==="TIED"?"TIED":"LOSING"})}),d.jsx("div",{className:"w-24"})," ",d.jsx("div",{className:"w-80 text-center",children:d.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-full font-bold text-sm shadow-lg ${V==="WINNING"?"bg-red-600":V==="TIED"?"bg-yellow-600":"bg-green-600"} text-white`,children:V==="WINNING"?"LOSING":V==="TIED"?"TIED":"WINNING"})})]}),d.jsxs("div",{className:"flex flex-row items-center justify-center gap-12 mb-8 w-full max-w-7xl mx-auto",children:[d.jsx("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:d.jsx(Sb,{user:{...n,stats:y},showComparison:!1,nemesisUser:e})}),d.jsxs("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:[d.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:d.jsx(Xz,{className:"w-12 h-12 text-white"})}),d.jsx("div",{className:"bg-red-600 px-8 py-3 rounded-full",children:d.jsx("p",{className:"text-white font-bold text-2xl",children:"VS"})})]}),d.jsxs("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:[e.isEmpty&&!o&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-slate-600/20 border border-slate-500/50 rounded-lg px-4 py-2",children:[d.jsx("p",{className:"text-slate-400 text-sm font-semibold",children:"🔍 Looking for Buddy"}),d.jsx("p",{className:"text-slate-300 text-xs",children:"We are searching for a suitable match"})]})}),s&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-yellow-600/20 border border-yellow-500/50 rounded-lg px-4 py-2",children:[d.jsx("p",{className:"text-yellow-400 text-sm font-semibold",children:"🔍 Loading Buddy..."}),d.jsx("p",{className:"text-yellow-300 text-xs",children:"Please wait while we find your match"})]})}),i&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-red-600/20 border border-red-500/50 rounded-lg px-4 py-2 mb-2",children:[d.jsx("p",{className:"text-red-400 text-sm font-semibold",children:"❌ Error Loading Buddy"}),d.jsx("p",{className:"text-red-300 text-xs",children:i})]})}),o&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-green-600/20 border border-green-500/50 rounded-lg px-4 py-2",children:[d.jsx("p",{className:"text-green-400 text-sm font-semibold",children:"✅ Connected with Buddy"}),d.jsxs("p",{className:"text-green-300 text-xs",children:["You're battling ",o.heroName,"!"]})]})}),d.jsx(Sb,{user:o||e,isNemesis:!0,showComparison:!1,nemesisUser:n})]})]}),V==="LOSING"&&E&&E.length>0&&d.jsxs("div",{className:"max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-6 border border-slate-700",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),d.jsx("div",{className:"space-y-4",children:E.slice(0,3).map((C,w)=>d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-4 border-l-4 border-blue-500",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:C.isReduction?d.jsxs(d.Fragment,{children:["🎯 Reduce your ",C.stat," by ",C.change," points!"]}):C.isCombination?d.jsxs(d.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",C.change," total points!"]}):C.isMajor?d.jsxs(d.Fragment,{children:["🎯 Major improvement needed: ",C.change," total points!"]}):d.jsxs(d.Fragment,{children:["🎯 Increase your ",C.stat," by ",C.change," points!"]})}),d.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",C.action]})]}),d.jsxs("div",{className:`font-bold text-2xl ml-4 ${C.isReduction?"text-green-400":C.isCombination?"text-purple-400":C.isMajor?"text-orange-400":"text-blue-400"}`,children:[C.isReduction?"-":"+",C.change]})]})},w))}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),a&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-md w-full border border-slate-600",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm transition-colors",title:"Share achievement for Motivation bonus",children:"📤 Share"}),d.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-white text-2xl",children:"×"})]})]}),d.jsxs("div",{className:"space-y-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),d.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),d.jsxs("p",{className:"text-green-400 font-mono",children:["(",y.mentalStrength||50," × 1.5) + (",y.motivation||50," × 1.0) + (",y.triggerDefense||30," × 1.2) - (",y.addictionLevel||50," × 1.0) = ",b.toFixed(1)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),d.jsxs("p",{className:"text-red-400 font-mono",children:["(",T.mentalStrength||50," × 1.5) + (",T.motivation||50," × 1.0) + (",T.triggerDefense||30," × 1.2) - (",T.addictionLevel||50," × 1.0) = ",N.toFixed(1)]})]}),d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:d.jsxs("p",{className:"text-gray-300 text-xs",children:[d.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",d.jsx("br",{}),d.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",d.jsx("br",{}),d.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",d.jsx("br",{}),d.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})},iq=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full border border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-3xl",children:i()})}),d.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),d.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),d.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})},oq=({gameType:n,onClose:e})=>{j.useState(0);const[t,r]=j.useState(!1),s=()=>r(!t),i=()=>{const l=j.useRef(null),[u,h]=j.useState([{x:7,y:7}]),[f,p]=j.useState({x:1,y:0}),[y,x]=j.useState({x:1,y:0}),[T,P]=j.useState({x:10,y:10}),[R,b]=j.useState(!1),[N,k]=j.useState(0),[U,V]=j.useState(1),A={1:160,2:Math.round(160/1.25),3:Math.round(160/1.25/1.25)},v={1:2,2:5,3:10};return j.useEffect(()=>{const S=_=>{if(R){_.preventDefault(),h([{x:7,y:7}]),p({x:1,y:0}),x({x:1,y:0}),P({x:10,y:10}),b(!1),k(0),V(1);return}switch(_.key){case"ArrowUp":_.preventDefault(),f.y!==1&&x({x:0,y:-1});break;case"ArrowDown":_.preventDefault(),f.y!==-1&&x({x:0,y:1});break;case"ArrowLeft":_.preventDefault(),f.x!==1&&x({x:-1,y:0});break;case"ArrowRight":_.preventDefault(),f.x!==-1&&x({x:1,y:0});break}};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[f,R]),j.useEffect(()=>{if(t||R)return;const S=setInterval(()=>{h(_=>{const E={x:_[0].x+f.x,y:_[0].y+f.y};if(E.x<0&&(E.x=14),E.x>=15&&(E.x=0),E.y<0&&(E.y=14),E.y>=15&&(E.y=0),_.slice(0,-1).some(de=>de.x===E.x&&de.y===E.y))return b(!0),_;const w=E.x===T.x&&E.y===T.y;let Z;return w?(k(de=>de+v[U]),P({x:Math.floor(Math.random()*15),y:Math.floor(Math.random()*15)}),Z=[E,..._]):Z=[E,..._.slice(0,-1)],(y.x!==f.x||y.y!==f.y)&&setTimeout(()=>{p(y)},0),Z})},A[U]);return()=>clearInterval(S)},[f,y,T,t,R]),j.useEffect(()=>{const S=l.current;if(!S)return;const _=S.getContext("2d"),E=20,C=15;_.fillStyle="#1f2937",_.fillRect(0,0,300,300),_.strokeStyle="#374151",_.lineWidth=1;for(let w=0;w<=C;w++)_.beginPath(),_.moveTo(w*E,0),_.lineTo(w*E,300),_.stroke(),_.beginPath(),_.moveTo(0,w*E),_.lineTo(300,w*E),_.stroke();u.forEach((w,Z)=>{Z===0?_.fillStyle="#fbbf24":_.fillStyle="#10b981",_.fillRect(w.x*E+1,w.y*E+1,E-2,E-2)}),_.fillStyle="#ef4444",_.fillRect(T.x*E+2,T.y*E+2,E-4,E-4)},[u,T]),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"mb-4",children:[d.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[d.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(S=>d.jsxs("button",{onClick:()=>V(S),className:`
                  px-4 py-2 text-sm font-mono border-2 border-green-500 transition-all
                  ${U===S?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[d.jsxs("div",{children:["Level ",S]}),d.jsxs("div",{className:"text-xs mt-1",children:[S===1&&"Normal",S===2&&"Fast",S===3&&"Insane"]})]},S))]}),d.jsxs("div",{className:"text-center text-yellow-400 text-xs mb-3",children:[d.jsxs("div",{children:["Speed: ",A[U],"ms | Points: ",v[U]," per food"]}),U===1&&"Good for beginners",U===2&&"For experienced players",U===3&&"Ultimate challenge"]})]}),d.jsx("canvas",{ref:l,width:"300",height:"300",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",N," | Level: ",U]}),d.jsxs("div",{className:"flex justify-center gap-4 mb-2 text-sm",children:[d.jsxs("div",{className:"text-gray-600",children:[d.jsx("span",{className:"font-semibold",children:"Current:"}),f.x===1&&"→",f.x===-1&&"←",f.y===1&&"↓",f.y===-1&&"↑"]}),y.x!==f.x||y.y!==f.y?d.jsxs("div",{className:"text-blue-600",children:[d.jsx("span",{className:"font-semibold",children:"Next:"}),y.x===1&&"→",y.x===-1&&"←",y.y===1&&"↓",y.y===-1&&"↑"]}):null]}),d.jsx("p",{className:"text-sm text-gray-600",children:"Use arrow keys to control the snake"}),R&&d.jsxs("div",{className:"mt-2",children:[d.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),d.jsx("button",{onClick:()=>{h([{x:7,y:7}]),p({x:1,y:0}),x({x:1,y:0}),P({x:10,y:10}),b(!1),k(0),V(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",children:"Restart Game"})]})]})]})},o=()=>{const[l,u]=j.useState(0),[h,f]=j.useState(0),[p]=j.useState(Date.now()),y=()=>{u(x=>x+1)};return j.useEffect(()=>{const x=(Date.now()-p)/1e3;x>0&&f((l/x).toFixed(1))},[l,p]),d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Click as Fast as You Can!"}),d.jsxs("div",{className:"text-lg text-gray-700 mb-2",children:["Total Clicks: ",l]}),d.jsxs("div",{className:"text-lg text-gray-700 mb-2",children:["Clicks/Second: ",h]}),d.jsx("button",{onClick:y,className:"w-48 h-48 text-2xl font-bold bg-orange-500 hover:bg-orange-600 border-none rounded-full text-white cursor-pointer transition-colors shadow-lg",children:"CLICK ME!"}),d.jsx("div",{className:"mt-4 text-sm text-gray-600",children:"Challenge: Try to reach 500 clicks!"})]})},a=()=>{try{switch(n){case"snake":return d.jsx(i,{});case"click-counter":return d.jsx(o,{});default:return d.jsx("div",{children:"Game not found"})}}catch(l){return console.error("Error rendering game:",l),d.jsxs("div",{className:"text-center text-red-600",children:[d.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),d.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm",children:"Reload Game"})]})}};return d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:[n==="snake"&&"🐍 Snake Game",n==="puzzle"&&"🧠 Memory Puzzle"]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{onClick:s,className:"bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm",children:t?"Resume":"Pause"}),d.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]})]}),d.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[500px] flex items-center justify-center relative",children:[a(),d.jsxs("div",{className:"absolute top-2 left-2 bg-black/70 text-white p-2 rounded text-xs max-w-48",children:[d.jsx("p",{className:"font-bold mb-1",children:"Controls:"}),n==="snake"&&d.jsx("p",{children:"Arrow keys to move"}),n==="click-counter"&&d.jsx("p",{children:"Click the button rapidly!"})]}),d.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white p-2 rounded text-xs",children:[d.jsx("p",{className:"font-bold mb-1",children:"Status:"}),d.jsx("p",{children:t?"⏸️ Paused":"▶️ Playing"})]})]}),d.jsx("div",{className:"mt-4 text-center",children:d.jsx("p",{className:"text-sm text-gray-500",children:"Games now run without time limits - play as long as you need!"})})]})})},aq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r})=>{const[s,i]=j.useState(!1),[o,a]=j.useState(!1),[l,u]=j.useState(null),[h,f]=j.useState(!1),[p,y]=j.useState({title:"",message:"",type:"info"}),[x,T]=j.useState(0),[P,R]=j.useState(null);j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const S=new OI(se,n.uid);await S.initialize(),R(S)}catch(S){console.error("Error initializing StatManager:",S)}})(),(async()=>{try{const{ref:S,get:_,onValue:E}=await Ge(()=>import("./index.esm-76803d89.js"),[]),C=S(se,`users/${n.uid}/profile/cravingsResisted`),w=await _(C);if(w.exists())T(w.val()||0);else{const de=parseInt(localStorage.getItem("cravingWins")||0);T(de)}return E(C,de=>{de.exists()&&T(de.val()||0)})}catch(S){console.error("Error loading cravings resisted from Firebase:",S);const _=parseInt(localStorage.getItem("cravingWins")||0);T(_)}})()},[n==null?void 0:n.uid]);const b=()=>{console.log("SOS sent to nemesis:",e.heroName);const A={timestamp:new Date().toISOString(),nemesis:e.heroName,status:"sent"};localStorage.setItem("lastSOS",JSON.stringify(A)),a(!0),setTimeout(()=>a(!1),5e3),P&&P.trackAppUsageDuringCravings()},N=A=>{u(A),i(!0)},k=()=>{u(null),i(!1)},U=async()=>{try{const A=x;if(localStorage.setItem("cravingWins",A+1),n&&n.uid){const{ref:v,set:S}=await Ge(()=>import("./index.esm-76803d89.js"),[]),_=v(se,`users/${n.uid}/profile/cravingsResisted`);await S(_,A+1),T(A+1),console.log("Cravings resisted updated in profile:",A+1)}P&&await P.handleCravingResistance(),y({title:"Congratulations!",message:`🎉 Great job resisting that craving!

Every trigger survival increases:
• Mental Strength +1 point
• Trigger Defense +3 points

Keep up the amazing work!`,type:"success"}),f(!0)}catch(A){console.error("Error updating stats:",A),y({title:"Congratulations!",message:`🎉 Great job resisting that craving!

Your progress has been recorded locally.

Keep up the amazing work!`,type:"success"}),f(!0)}},V=(A,v)=>{y({title:A,message:v,type:"info"}),f(!0)};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsx("div",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-start gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),d.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8 border-2 border-red-200",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse",children:d.jsx("span",{className:"text-4xl",children:"🆘"})}),d.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Need Immediate Help?"}),d.jsx("p",{className:"text-gray-600 mb-6",children:"Press the SOS button to alert your nemesis and get instant support"}),d.jsx("button",{onClick:b,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-6 px-8 rounded-xl text-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🆘 SOS - Get Help Now"}),(()=>{const A=localStorage.getItem("lastSOS");if(A){const v=JSON.parse(A),S=Math.floor((Date.now()-new Date(v.timestamp))/(1e3*60));return d.jsx("div",{className:"mt-4 p-3 bg-red-50 rounded-lg border border-red-200",children:d.jsxs("p",{className:"text-sm text-red-600",children:["Last SOS sent ",S," minutes ago to ",v.nemesis]})})}return null})()]})}),d.jsx("div",{className:"bg-slate-800/50 rounded-xl p-6 mb-6 border border-slate-600",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"🎮 Distract Yourself"}),d.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[d.jsx("button",{onClick:()=>N("snake"),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 hover:from-orange-500/30 hover:to-orange-600/30 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-orange-500/30",children:"🐍 Play Snake"}),d.jsx("button",{onClick:()=>N("click-counter"),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 hover:from-blue-500/30 hover:to-blue-600/30 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-blue-500/30",children:"⚡ Click Counter"})]})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-600",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4 text-center",children:"⚡ Quick Actions"}),d.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.jsx("button",{onClick:()=>V("💧 Drink Water",`Hydration helps reduce cravings!

Drink a full glass of water slowly.

This will help you feel full and reduce the urge to vape.`),className:"bg-gradient-to-r from-blue-500/20 to-blue-600/20 hover:from-blue-500/30 hover:to-blue-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-blue-500/30 hover:scale-105",children:"💧 Drink Water"}),d.jsx("button",{onClick:()=>V("🫁 Breathe",`Take 3 deep breaths:

1. Inhale for 4 seconds
2. Hold for 4 seconds
3. Exhale for 4 seconds

Repeat 3 times`),className:"bg-gradient-to-r from-blue-500/20 to-blue-600/20 hover:from-blue-500/30 hover:to-blue-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-blue-500/30 hover:scale-105",children:"🫁 Breathe"}),d.jsx("button",{onClick:()=>V("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),className:"bg-gradient-to-r from-purple-500/20 to-purple-600/20 hover:from-purple-500/30 hover:to-purple-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-purple-500/30 hover:scale-105",children:"🚶‍♂️ Walk"}),d.jsx("button",{onClick:()=>V("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),className:"bg-gradient-to-r from-green-500/20 to-green-600/20 hover:from-green-500/30 hover:to-green-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-green-500/30 hover:scale-105",children:"🧘‍♀️ Meditate"})]})]}),o&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-2xl",children:"✅"})}),d.jsx("h3",{className:"text-xl font-bold text-green-600 mb-2",children:"Help is on the way!"}),d.jsxs("p",{className:"text-gray-600 mb-4",children:["Your nemesis ",d.jsx("strong",{children:e.heroName})," has been notified and will reach out soon."]}),d.jsx("button",{onClick:()=>a(!1),className:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Got it"})]})}),s&&l&&d.jsx(oq,{gameType:l,onClose:k}),d.jsx(iq,{isOpen:h,onClose:()=>f(!1),title:p.title,message:p.message,type:p.type}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-600 mt-6",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4 text-center",children:"📊 Cravings Resisted"}),d.jsxs("div",{className:"text-center p-6 bg-slate-700/50 rounded-lg border border-slate-500/30",children:[d.jsx("div",{className:"text-4xl mb-3",children:"🎯"}),d.jsx("p",{className:"text-lg font-bold text-white mb-2",children:"Total Wins"}),d.jsx("p",{className:"text-3xl font-bold text-green-400 mb-3",children:x}),d.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Times you successfully resisted cravings"}),d.jsx("button",{onClick:U,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🎯 I Resisted a Craving!"})]})]})]})})},lq=({user:n,onNavigate:e})=>{var ys;const[t,r]=j.useState(null),[s,i]=j.useState(!1),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[h,f]=j.useState(!1),[p,y]=j.useState(!1),[x,T]=j.useState(null),[P,R]=j.useState(0),[b,N]=j.useState(null),[k,U]=j.useState(!1),[V,A]=j.useState([]),[v,S]=j.useState(null);j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const pe=new OI(se,n.uid);await pe.initialize(),S(pe)}catch(pe){console.error("Error initializing StatManager:",pe)}})();const Re=async()=>{try{const{ref:pe,get:Ie,onValue:Xe}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Xt=pe(se,`users/${n.uid}/profile/relapseDate`),dn=await Ie(Xt);dn.exists()&&r(new Date(dn.val()));const $n=pe(se,`users/${n.uid}/profile/scheduledTriggers`),ct=await Ie($n);ct.exists()&&A(ct.val());const Rt=new Date().toDateString(),Dn=pe(se,`users/${n.uid}/profile/daily/${Rt}/water`),hn=Xe(Dn,fn=>{fn.exists()&&R(fn.val()||0)}),uo=pe(se,`users/${n.uid}/profile/daily/${Rt}/mood`),Xs=Xe(uo,fn=>{fn.exists()&&N(fn.val())}),Bt=pe(se,`users/${n.uid}/profile/daily/${Rt}/breathing`),Lt=Xe(Bt,fn=>{fn.exists()&&U(fn.val()||!1)}),Zs=pe(se,`users/${n.uid}/profile/scheduledTriggers`),Sa=Xe(Zs,fn=>{fn.exists()&&A(fn.val()||[])});return()=>{hn(),Xs(),Lt(),Sa()}}catch(pe){console.error("Error loading profile data from Firebase:",pe),lt()}},lt=()=>{const pe=localStorage.getItem("quitCoachRelapseDate");pe&&r(new Date(pe));const Ie=new Date().toDateString(),Xe=localStorage.getItem(`water_${Ie}`),Xt=localStorage.getItem(`mood_${Ie}`),dn=localStorage.getItem(`breathing_${Ie}`);Xe&&R(parseInt(Xe)),Xt&&N(JSON.parse(Xt)),dn&&U(dn==="true");const $n=localStorage.getItem("scheduledTriggers");$n&&A(JSON.parse($n))};Re()},[n==null?void 0:n.uid]),j.useEffect(()=>{v&&v.trackLoggingActivity()},[v]),j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:Re,get:lt,set:pe}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Ie=Re(se,`users/${n.uid}/profile`),Xe=await lt(Ie);if(!Xe.exists()||Object.keys(Xe.val()).length===0){console.log("Migrating localStorage data to Firebase...");const Xt=localStorage.getItem("quitCoachRelapseDate");Xt&&(await pe(Re(se,`users/${n.uid}/profile/relapseDate`),Xt),r(new Date(Xt)));const dn=parseInt(localStorage.getItem("cravingWins")||0);dn>0&&await pe(Re(se,`users/${n.uid}/profile/cravingsResisted`),dn);for(let ct=0;ct<7;ct++){const Rt=new Date;Rt.setDate(Rt.getDate()-ct);const Dn=Rt.toDateString(),hn=localStorage.getItem(`water_${Dn}`);hn&&await pe(Re(se,`users/${n.uid}/profile/daily/${Dn}/water`),parseInt(hn))}for(let ct=0;ct<7;ct++){const Rt=new Date;Rt.setDate(Rt.getDate()-ct);const Dn=Rt.toDateString(),hn=localStorage.getItem(`mood_${Dn}`);hn&&await pe(Re(se,`users/${n.uid}/profile/daily/${Dn}/mood`),JSON.parse(hn))}for(let ct=0;ct<7;ct++){const Rt=new Date;Rt.setDate(Rt.getDate()-ct);const Dn=Rt.toDateString(),hn=localStorage.getItem(`breathing_${Dn}`);hn&&await pe(Re(se,`users/${n.uid}/profile/daily/${Dn}/breathing`),hn==="true")}const $n=localStorage.getItem("scheduledTriggers");if($n){const ct=JSON.parse($n);await pe(Re(se,`users/${n.uid}/profile/scheduledTriggers`),ct),A(ct)}console.log("localStorage data migration to Firebase completed")}}catch(Re){console.error("Error migrating localStorage data to Firebase:",Re)}})()},[n==null?void 0:n.uid]);const _=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,E=()=>{const we=new Date,Re=new Date(we);Re.setHours(24,0,0,0);const lt=Re-we,pe=Math.floor(lt/(1e3*60*60)),Ie=Math.floor(lt%(1e3*60*60)/(1e3*60)),Xe=Math.floor(lt%(1e3*60)/1e3);return{hours:pe,minutes:Ie,seconds:Xe}},[C,w]=j.useState(E()),[Z,de]=j.useState(0),[re,Ve]=j.useState(0),[z,te]=j.useState(0),[oe,Ce]=j.useState(0);j.useEffect(()=>{const we=setInterval(()=>{w(E());const Re=_(),pe=new Date-Re,Ie=Math.floor(pe/(1e3*60*60*24)),Xe=Math.floor(pe%(1e3*60*60*24)/(1e3*60*60)),Xt=Math.floor(pe%(1e3*60*60)/(1e3*60)),dn=Math.floor(pe%(1e3*60)/1e3);de(Ie),Ve(Xe),te(Xt),Ce(dn)},1e3);return()=>clearInterval(we)},[t,n==null?void 0:n.quitDate]);const fe=async(we,Re)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:lt,set:pe}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Ie=lt(se,`users/${n.uid}/profile/${we}`);return await pe(Ie,Re),!0}catch(lt){return console.error("Error saving to Firebase:",lt),!1}},Ue=async()=>{const we=new Date;r(we),v&&await v.handleRelapse(),await fe("relapseDate",we.toISOString())||localStorage.setItem("quitCoachRelapseDate",we.toISOString())},me=(()=>{const we=new Date,Re=we.getDay(),lt=Re===0?6:Re-1,pe=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let Ie=0;Ie<=lt;Ie++)pe[Ie].color="bg-green-500";return t&&t.toDateString()===we.toDateString()&&(pe[lt].color="bg-red-500"),pe})(),We=async we=>{R(we);const Re=new Date().toDateString();v&&await v.handleHydrationUpdate(we),await fe(`daily/${Re}/water`,we)||localStorage.setItem(`water_${Re}`,we.toString()),i(!1)},Ct=async we=>{N(we);const Re=new Date().toDateString();await fe(`daily/${Re}/mood`,we)||localStorage.setItem(`mood_${Re}`,JSON.stringify(we)),u(!1)},fc=async()=>{U(!0);const we=new Date().toDateString();v&&await v.handleBreathingExercise(),await fe(`daily/${we}/breathing`,!0)||localStorage.setItem(`breathing_${we}`,"true"),a(!1)},pc=async(we,Re,lt)=>{const pe={day:we,triggerType:Re,time:lt,id:Date.now()},Ie=[...V,pe];A(Ie),v&&await v.handleTriggerPlanning(),await fe("scheduledTriggers",Ie)||localStorage.setItem("scheduledTriggers",JSON.stringify(Ie)),f(!1)},Js=async()=>{v&&await v.handleTriggerListUpdate()};return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-white text-lg",children:"Hello,"}),d.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),d.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:d.jsx("span",{className:"font-bold text-slate-900",children:Z})})]}),d.jsxs("div",{className:"px-4 space-y-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("button",{onClick:Ue,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-2xl",children:"⚠️"}),d.jsx("span",{className:"text-lg",children:"RELAPSE"}),d.jsx("span",{className:"text-2xl",children:"⚠️"})]}),d.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),d.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[d.jsx("span",{className:"text-white text-sm",children:"✓"}),d.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),d.jsx("div",{className:"flex justify-between items-center mb-4",children:me.map((we,Re)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${we.color}`}),d.jsx("p",{className:"text-gray-400 text-xs",children:we.name})]},we.name))})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-white text-3xl font-bold",children:[C.hours.toString().padStart(2,"0"),":",C.minutes.toString().padStart(2,"0"),":",C.seconds.toString().padStart(2,"0")]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),d.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),d.jsxs("div",{className:"flex items-baseline gap-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:Z.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:re.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:z.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:oe.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&d.jsx("div",{className:"mt-3 text-center",children:d.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),d.jsx("p",{className:"text-gray-300 text-sm",children:P>0?`${P} glasses today`:"Tap to log water intake"})]}),d.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🫁"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Complete breathing exercise"}),d.jsx("p",{className:"text-gray-300 text-sm",children:k?"Completed! Stay calm!":"Tap to start 4-cycle breathing"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),d.jsx("p",{className:"text-gray-300 text-sm",children:b?`You feel ${b.name.toLowerCase()}`:"How do you feel today?"})]}),d.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:V.length>0?`${V.length} triggers planned`:"Plan your trigger defense strategy"})]}),d.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:Js,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400",children:"$"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Money saved"})]}),d.jsx("div",{className:"text-white text-2xl font-bold",children:((ys=n==null?void 0:n.stats)==null?void 0:ys.moneySaved)||0}),d.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Work in progress"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),d.jsx("button",{onClick:()=>y(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),d.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),d.jsx(cq,{isOpen:s,onClose:()=>i(!1),onConfirm:We,currentWater:P}),d.jsx(uq,{isOpen:o,onClose:()=>a(!1),onComplete:fc}),d.jsx(dq,{isOpen:l,onClose:()=>u(!1),onSelect:Ct,selectedMood:b}),d.jsx(hq,{isOpen:h,onClose:()=>f(!1),onSchedule:pc,scheduledTriggers:V}),d.jsx(fq,{isOpen:p,onClose:()=>y(!1),selectedDate:x,onDateSelect:T,dailyData:{water:P,mood:b,breathing:k,relapseDate:t}})]})},cq=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=j.useState(r);return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:o=>i(parseInt(o.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0"}),d.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>t(s),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Confirm"})]})]})}):null},uq=({isOpen:n,onClose:e,onComplete:t})=>{const[r,s]=j.useState(1),[i,o]=j.useState("exhale"),[a,l]=j.useState(5),[u,h]=j.useState(!1);j.useEffect(()=>{if(!n||!u)return;const x=setInterval(()=>{l(T=>{if(T<=1){if(i==="exhale")o("inhale"),l(4);else if(i==="inhale")o("hold"),l(7);else if(i==="hold")if(r<4)s(P=>P+1),o("exhale"),l(5);else return h(!1),t(),0;return T}return T-1})},1e3);return()=>clearInterval(x)},[n,u,i,r,t]);const f=()=>{h(!0),s(1),o("exhale"),l(5)};if(!n)return null;const p=()=>{switch(i){case"exhale":return"Exhale, empty lungs";case"inhale":return"Inhale quietly through nose";case"hold":return"Hold your breath";default:return""}},y=()=>{switch(i){case"exhale":return"w-32 h-32";case"inhale":return"w-48 h-48";case"hold":return"w-40 h-40";default:return"w-40 h-40"}};return d.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"text-center text-white",children:u?d.jsxs(d.Fragment,{children:[d.jsxs("h3",{className:"text-2xl font-bold mb-4",children:["Cycle ",r,"/4"]}),d.jsx("p",{className:"text-xl text-gray-300 mb-8",children:p()}),d.jsx("div",{className:"flex justify-center mb-8",children:d.jsx("div",{className:`${y()} rounded-full border-4 border-blue-400 flex items-center justify-center transition-all duration-1000 ${i==="hold"?"animate-pulse":""}`,children:d.jsx("span",{className:"text-4xl font-bold",children:a})})}),d.jsx("button",{onClick:e,className:"bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Stop"})]}):d.jsxs("div",{className:"mb-8",children:[d.jsx("h3",{className:"text-3xl font-bold mb-4",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-xl text-gray-300 mb-6",children:"4-cycle breathing pattern"}),d.jsx("button",{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition-colors",children:"Start Exercise"})]})})})},dq=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),d.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:s.map(i=>d.jsxs("button",{onClick:()=>t(i),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 ${(r==null?void 0:r.name)===i.name?"ring-2 ring-blue-400":"bg-slate-700 hover:bg-slate-600"}`,children:[d.jsx("div",{className:`w-12 h-12 ${i.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:i.icon}),d.jsx("p",{className:"text-white font-semibold",children:i.name})]},i.name))}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"})]})}):null},hq=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=j.useState(""),[o,a]=j.useState(""),[l,u]=j.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),d.jsxs("select",{value:s,onChange:p=>i(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select a day"}),f.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),d.jsxs("select",{value:o,onChange:p=>a(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select trigger type"}),h.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),d.jsx("input",{type:"time",value:l,onChange:p=>u(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none"})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})}):null},fq=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),d.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),d.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&d.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[d.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),d.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Close"})]})}):null,pq=({onResetApp:n})=>d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:d.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx(PD,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),d.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),d.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),mq=({user:n,nemesis:e,buddyMatchingService:t})=>{const[r,s]=j.useState([{id:1,sender:"buddy",text:"Hey! How's your quit journey going?",timestamp:new Date(Date.now()-6e4).toLocaleTimeString()},{id:2,sender:"user",text:"Going strong! Day 3 now.",timestamp:new Date(Date.now()-3e4).toLocaleTimeString()}]),[i,o]=j.useState(""),[a,l]=j.useState(!1);j.useState(null),j.useState(!1);const[u,h]=j.useState(null);j.useState(!1),j.useState(null);const[f,p]=j.useState(null);j.useEffect(()=>{(async()=>{if(!(!t||!(n!=null&&n.uid)))try{console.log("🔍 Checking for existing buddy pair...");const P=await t.getUserBuddyInfo(n.uid);if(P){console.log("✅ Found existing buddy pair:",P),p(P);const R=await t.getBuddyPairInfo(P.id);R&&h(R)}}catch(P){console.error("Error loading existing buddy pair:",P)}})()},[t,n==null?void 0:n.uid]);const y=()=>{if(i.trim().length===0)return;const T=i.trim().slice(0,20),P={id:Date.now(),sender:"user",text:T,timestamp:new Date().toLocaleTimeString()};s(R=>[...R,P]),o(""),l(!0),setTimeout(()=>{const R=["Keep it up! 💪","You're doing great!","Stay strong today!","One day at a time!","I believe in you!","You've got this!","Every day counts!","Stay focused! 🎯"],b=R[Math.floor(Math.random()*R.length)],N={id:Date.now()+1,sender:"buddy",text:b,timestamp:new Date().toLocaleTimeString()};s(k=>[...k,N]),l(!1)},1500)},x=T=>{T.key==="Enter"&&y()};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"💬 Chat with Buddy"}),d.jsx("p",{className:"text-gray-300",children:"Stay connected with your quit buddy for support"})]}),d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"space-y-4 mb-6 max-h-96 overflow-y-auto",children:[r.map(T=>d.jsx("div",{className:`flex ${T.sender==="user"?"justify-end":"justify-start"}`,children:d.jsxs("div",{className:`max-w-xs px-4 py-2 rounded-2xl ${T.sender==="user"?"bg-blue-600 text-white":"bg-slate-700 text-gray-200"}`,children:[d.jsx("div",{className:"text-sm",children:T.text}),d.jsx("div",{className:"text-xs opacity-70 mt-1",children:T.timestamp})]})},T.id)),a&&d.jsx("div",{className:"flex justify-start",children:d.jsx("div",{className:"bg-slate-700 text-gray-200 px-4 py-2 rounded-2xl",children:d.jsxs("div",{className:"flex items-center space-x-1",children:[d.jsx("span",{className:"text-sm",children:"Buddy is typing"}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:i,onChange:T=>o(T.target.value),onKeyPress:x,placeholder:"Type your message (max 20 chars)...",maxLength:20,className:"flex-1 bg-slate-700 text-white px-4 py-3 rounded-xl border border-slate-600 focus:border-blue-500 focus:outline-none"}),d.jsx("button",{onClick:y,disabled:i.trim().length===0,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 text-white px-6 py-3 rounded-xl transition-colors disabled:cursor-not-allowed",children:"Send"})]}),d.jsx("div",{className:"text-right mt-2",children:d.jsxs("span",{className:`text-xs ${i.length>=18?"text-yellow-400":"text-gray-400"}`,children:[i.length,"/20"]})})]}),d.jsx("div",{className:"mt-6 bg-slate-800 rounded-2xl p-6 shadow-2xl border border-slate-700",children:d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold",children:e.heroName.charAt(0)}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:e.heroName}),d.jsx("p",{className:"text-gray-300",children:"Your Quit Buddy"}),d.jsx("p",{className:"text-sm text-gray-400",children:"Always here to support you"})]})]})})]})})},gq=()=>{console.log("🚀 APP COMPONENT MOUNTING - Component function called"),console.log("🚀 STEP 1: About to declare state variables");const[n,e]=j.useState("arena"),[t,r]=j.useState("auth"),[s,i]=j.useState(null),[o,a]=j.useState(null),[l,u]=j.useState(!1),[h,f]=j.useState(null),[p,y]=j.useState(!0);console.log("🚀 STEP 2: State variables declared successfully"),console.log("🚀 STEP 3: About to declare data loading system state");const[x,T]=j.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1});console.log("🚀 STEP 4: Data loading state declared");const[P,R]=j.useState([]);console.log("🚀 STEP 5: Unsubscribe functions state declared");const[b,N]=j.useState(null);console.log("🚀 STEP 6: Buddy matching service state declared");const[k,U]=j.useState(null),V=j.useRef(null);console.log("🚀 STEP 7: Firestore buddy service state declared");const A=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,moneySaved:0}),v=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),S=L=>{L.relapseDate&&fe(new Date(L.relapseDate)),L.dailyWater!==void 0&&Mt(L.dailyWater),L.dailyMood!==void 0&&We(L.dailyMood),L.dailyBreathing!==void 0&&fc(L.dailyBreathing),L.scheduledTriggers&&Js(L.scheduledTriggers)},_=(L,H)=>{const K=document.createElement("div");K.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",K.innerHTML=`
      <div class="font-bold">${L}</div>
      <div class="text-sm opacity-90">${H}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(K),setTimeout(()=>{K.parentNode&&K.parentNode.removeChild(K)},1e4)},E=async L=>{if(!L)return!1;T({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:H,get:K,onValue:he}=await Ge(()=>import("./index.esm-76803d89.js"),[]);T(Fe=>({...Fe,currentStep:"Loading profile data...",progress:20}));const ye=H(se,`users/${L}`),le=await K(ye);if(!le.exists())throw new Error("User profile not found");const Ee=le.val(),Se=C(Ee);T(Fe=>({...Fe,currentStep:"Loading battle stats...",progress:40}));const _e=H(se,`users/${L}/stats`),rt=await K(_e),Vt=rt.exists()?w(rt.val()):A();T(Fe=>({...Fe,currentStep:"Loading habits and progress...",progress:60}));const ut=H(se,`users/${L}/profile`),Oe=await K(ut),$t=Oe.exists()?Z(Oe.val()):v();T(Fe=>({...Fe,currentStep:"Loading achievements...",progress:80}));const Le=H(se,`users/${L}/profile/cravingsResisted`),In=await K(Le),qe=In.exists()?Math.max(0,parseInt(In.val())||0):0;T(Fe=>({...Fe,currentStep:"Setting up live sync...",progress:90}));const Ne=he(_e,Fe=>{if(Fe.exists()){const Nr=w(Fe.val());if(lt(Nr),t==="arena"&&o){const pn={...o,stats:Nr};calculateRealTimeStats(pn).then(setRealTimeUserStats)}}}),On=he(ut,Fe=>{if(Fe.exists()){const Nr=Z(Fe.val());t==="profile"&&S(Nr)}}),Qr=he(Le,Fe=>{if(Fe.exists()){const Nr=Math.max(0,parseInt(Fe.val())||0);t==="craving-support"&&we(Nr)}});return R([Ne,On,Qr]),T(Fe=>({...Fe,currentStep:"Finalizing...",progress:100})),a(Fe=>({...Fe,...Se,stats:Vt})),S($t),we(qe),Se.onboardingCompleted&&u(!0),T({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:Se,stats:Vt,profileData:$t,cravingsResisted:qe}),!0}catch(H){return console.error("❌ Error loading user data:",H),T({isLoading:!1,progress:0,currentStep:"Failed to load data",error:H.message,isComplete:!1}),_("Failed to load user data",H.message),!1}},C=L=>L?{uid:L.uid||"",email:L.email||"",heroName:L.heroName||"Hero",archetype:L.archetype||"The Determined",avatar:L.avatar||Is("default"),quitDate:L.quitDate||new Date().toISOString(),onboardingCompleted:!!L.onboardingCompleted,updatedAt:L.updatedAt||Date.now(),...L}:de(),w=L=>L?{mentalStrength:Math.max(0,Math.min(100,parseInt(L.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(L.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(L.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(L.addictionLevel)||50)),moneySaved:Math.max(0,parseInt(L.moneySaved)||0),...L}:A(),Z=L=>L?{dailyWater:Math.max(0,parseInt(L.dailyWater)||0),dailyMood:L.dailyMood||null,dailyBreathing:!!L.dailyBreathing,scheduledTriggers:Array.isArray(L.scheduledTriggers)?L.scheduledTriggers:[],relapseDate:L.relapseDate?new Date(L.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(L.cravingsResisted)||0),...L}:v(),de=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:Is("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});j.useEffect(()=>()=>{P.forEach(L=>{typeof L=="function"&&L()})},[P]);const[re,Ve]=j.useState(null);j.useEffect(()=>{(async()=>{try{const H=(await Ge(()=>import("./offlineManager-85616ac4.js"),[])).default,K=new H;Ve(K),window.refreshUserData=oe,console.log("✅ Offline manager initialized")}catch(H){console.error("Error initializing offline manager:",H)}})()},[]);const z=async L=>{if(!L)return!1;const H=await E(L);if(H&&re&&(await re.cacheUserData(o),await re.cacheProfileData({dailyWater:Ue,dailyMood:me,dailyBreathing:Ct,scheduledTriggers:pc,relapseDate:Ce,cravingsResisted:ys})),!H&&re){console.log("📱 Loading offline data...");const K=await re.getCachedUserData(),he=await re.getCachedProfileData();if(K)return console.log("📱 Using offline user data"),a(K),u(K.onboardingCompleted),he&&S(he),!0}return H},te=async()=>h!=null&&h.uid?(console.log("🔄 Refreshing user data with offline support..."),await z(h.uid)):!1,oe=async()=>{if(!(h!=null&&h.uid)){_("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await te()){const H=document.createElement("div");H.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",H.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(H),setTimeout(()=>{H.parentNode&&H.parentNode.removeChild(H)},5e3)}else _("Refresh Failed","Could not refresh data. Please try again.")},[Ce,fe]=j.useState(null),[Ue,Mt]=j.useState(0),[me,We]=j.useState(null),[Ct,fc]=j.useState(!1),[pc,Js]=j.useState([]),[ys,we]=j.useState(0),[Re,lt]=j.useState(A());j.useEffect(()=>{const L=K=>{if(K.message&&K.message.includes("content_script")){console.warn("Browser extension error (ignored):",K.message);return}if(K.message&&(K.message.includes("FrameDoesNotExistError")||K.message.includes("background.js"))){console.warn("Background frame error (ignored):",K.message);return}console.error("Global error caught:",K)},H=K=>{if(K.reason&&K.reason.message&&K.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",K.reason.message);return}if(K.reason&&K.reason.message&&(K.reason.message.includes("FrameDoesNotExistError")||K.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",K.reason.message);return}console.error("Unhandled promise rejection:",K.reason)};return window.addEventListener("error",L),window.addEventListener("unhandledrejection",H),()=>{window.removeEventListener("error",L),window.removeEventListener("unhandledrejection",H)}},[]),j.useEffect(()=>{const L=async(H=0)=>{try{const{ref:K,set:he,get:ye,child:le}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Ee=K(se),Se=le(Ee,"healthchecks/vite_dev");await he(Se,{lastRun:Date.now()});const _e=await ye(Se);console.log("🔥 Firebase RTDB connected. Healthcheck exists:",_e.exists())}catch(K){if(console.error("Firebase connectivity test failed:",(K==null?void 0:K.message)||K),H<3){const he=Math.pow(2,H)*1e3;console.log(`Retrying Firebase connection in ${he}ms... (attempt ${H+1}/3)`),setTimeout(()=>L(H+1),he)}else console.error("Firebase connection failed after 3 retries. Check your internet connection and Firebase configuration.")}};L()},[]),j.useEffect(()=>{let L=!0,H=null;return(async()=>{try{console.log("Initializing authentication state..."),y(!0);const{onAuthStateChanged:he}=await Ge(()=>import("./index.esm-fc8f9120.js"),[]);H=he(Ti,async le=>{if(L)if(console.log("Auth state changed:",le?`User: ${le.uid}`:"No user"),le){f(le),console.log("User authenticated, checking database for user data...");try{const{ref:Ee,get:Se}=await Ge(()=>import("./index.esm-76803d89.js"),[]),_e=Ee(se,`users/${le.uid}`),rt=await Se(_e);if(rt.exists()){const Vt=rt.val();console.log("Existing user data found - auto-login successful"),a(Vt),u(!0),r("arena"),console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Ee){console.error("Error fetching user data during auto-login:",Ee),r("onboarding")}}else console.log("No authenticated user - showing login screen"),f(null),a(null),u(!1),r("auth")});const ye=setTimeout(()=>{L&&(console.warn("Auth initialization timeout - forcing to auth screen"),y(!1),r("auth"))},1e4);H&&clearTimeout(ye)}catch(he){console.error("Error initializing authentication:",he),L&&(y(!1),r("auth"))}finally{L&&y(!1)}})(),()=>{L=!1,H&&H()}},[]);const pe=async L=>{console.log("Authentication successful, checking for existing user data...",{uid:L==null?void 0:L.uid,email:L==null?void 0:L.email});try{const{ref:H,get:K}=await Ge(()=>import("./index.esm-76803d89.js"),[]);console.log("Checking database for existing user data...");const he=H(se,`users/${L.uid}`),ye=await K(he);if(ye.exists()){const le=ye.val();if(console.log("Existing user data found - loading all user data..."),await z(L.uid))console.log("✅ All user data loaded successfully, going to Arena"),r("arena");else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(le);const Se=!!le.onboardingCompleted;u(Se),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(H){console.error("Database check failed:",H),r("onboarding")}},[Ie,Xe]=j.useState(null),[Xt,dn]=j.useState(!1),[$n,ct]=j.useState(null),Rt=async()=>{var L,H,K,he,ye,le,Ee,Se;if(!(!(o!=null&&o.uid)||Xt)){dn(!0),ct(null);try{if(console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!k),console.log("🔄 FirestoreBuddyService type:",typeof k),!(V.current||k)){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Dn();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:rt,query:Vt,where:ut,getDocs:Oe}=await Ge(()=>import("./index.esm-4704b69c.js"),[]),$t=rt(kf,"buddyPairs"),Le=Vt($t,ut("user1Id","==",o.uid)),In=await Oe(Le);let qe=null,Ne=null;if(In.empty){const On=Vt($t,ut("user2Id","==",o.uid)),Qr=await Oe(On);if(!Qr.empty){const Fe=Qr.docs[0];qe={id:Fe.id,...Fe.data()},Ne=qe.user1Id}}else{const On=In.docs[0];qe={id:On.id,...On.data()},Ne=qe.user2Id}if(qe&&Ne){console.log("✅ Firestore: Found buddy pair:",qe.id);const{ref:On,get:Qr}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Fe=On(se,`users/${Ne}`),Nr=await Qr(Fe);if(!Nr.exists()){console.log("⚠️ Firestore: Cleaning up orphaned buddy pair:",qe.id);const{deleteDoc:ch,doc:gc}=await Ge(()=>import("./index.esm-4704b69c.js"),[]);await ch(gc(kf,"buddyPairs",qe.id)),Xe(null);return}const pn=Nr.val(),ba={heroName:pn.heroName||"Buddy",stats:{streakDays:((L=pn.stats)==null?void 0:L.streakDays)||0,addictionLevel:((H=pn.stats)==null?void 0:H.addictionLevel)||50,willpower:((K=pn.stats)==null?void 0:K.mentalStrength)||50,motivation:((he=pn.stats)==null?void 0:he.mentalStrength)||50,cravingResistance:((ye=pn.stats)==null?void 0:ye.mentalStrength)||50,triggerDefense:((le=pn.stats)==null?void 0:le.triggerDefense)||30,moneySaved:((Ee=pn.stats)==null?void 0:Ee.moneySaved)||0,experiencePoints:((Se=pn.stats)==null?void 0:Se.experiencePoints)||0},achievements:pn.achievements||[],archetype:pn.archetype||"The Determined",avatar:pn.avatar||Is(pn.heroName||"buddy","adventurer"),userId:Ne,isRealBuddy:!0,pairId:qe.id};Xe(ba),console.log("✅ Firestore: Buddy data loaded successfully"),await hn(o.uid,Ne)}else console.log("ℹ️ Firestore: No buddy pair found for user"),Xe(null)}catch(_e){console.error("❌ Firestore: Error loading buddy:",_e),console.log("🔄 Falling back to Realtime Database buddy loading..."),await Dn()}finally{dn(!1)}}},Dn=async()=>{var L,H,K,he,ye,le,Ee,Se;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:_e,get:rt}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Vt=_e(se,"buddyPairs"),ut=await rt(Vt);if(!ut.exists()){Xe(null);return}const Oe=ut.val();let $t=null,Le=null;for(const[In,qe]of Object.entries(Oe))if(qe.users&&Array.isArray(qe.users)&&qe.users.includes(o.uid)){$t={...qe,pairId:In},Le=qe.users.find(Ne=>Ne!==o.uid);break}if($t&&Le){const In=_e(se,`users/${Le}`),qe=await rt(In);if(!qe.exists()){const{remove:Qr}=await Ge(()=>import("./index.esm-76803d89.js"),[]);await Qr(_e(se,`buddyPairs/${$t.pairId}`)),Xe(null);return}const Ne=qe.val(),On={heroName:Ne.heroName||"Buddy",stats:{streakDays:((L=Ne.stats)==null?void 0:L.streakDays)||0,addictionLevel:((H=Ne.stats)==null?void 0:H.addictionLevel)||50,willpower:((K=Ne.stats)==null?void 0:K.mentalStrength)||50,motivation:((he=Ne.stats)==null?void 0:he.mentalStrength)||50,cravingResistance:((ye=Ne.stats)==null?void 0:ye.mentalStrength)||50,triggerDefense:((le=Ne.stats)==null?void 0:le.triggerDefense)||30,moneySaved:((Ee=Ne.stats)==null?void 0:Ee.moneySaved)||0,experiencePoints:((Se=Ne.stats)==null?void 0:Se.experiencePoints)||0},achievements:Ne.achievements||[],archetype:Ne.archetype||"The Determined",avatar:Ne.avatar||Is(Ne.heroName||"buddy","adventurer"),userId:Le,isRealBuddy:!0,pairId:$t.pairId};Xe(On),await hn(o.uid,Le)}else Xe(null)}catch(_e){console.error("Error loading buddy from Realtime Database:",_e),ct("Failed to load buddy data"),Xe(null)}},hn=async(L,H)=>{try{const K=V.current||k;if(K&&(Ie!=null&&Ie.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await K.removeFromMatchingPool(L),await K.removeFromMatchingPool(H);const{doc:he,updateDoc:ye}=await Ge(()=>import("./index.esm-4704b69c.js"),[]),le=he(kf,"buddyPairs",Ie.pairId);await ye(le,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:he,remove:ye,set:le}=await Ge(()=>import("./index.esm-76803d89.js"),[]);await ye(he(se,`matchingPool/${L}`)),await ye(he(se,`matchingPool/${H}`)),Ie!=null&&Ie.pairId&&(await le(he(se,`buddyPairs/${Ie.pairId}/user1RemovedFromPool`),!0),await le(he(se,`buddyPairs/${Ie.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(K){console.error("❌ Error removing users from matching pool:",K)}};j.useEffect(()=>{o!=null&&o.uid&&!Ie&&!Xt&&Rt()},[o==null?void 0:o.uid,Ie,Xt]),j.useEffect(()=>{k?(console.log("🎉 FirestoreBuddyService state updated - service is now available!"),console.log("📊 Service details:",k.getServiceStatus()),k.testConnectivity().then(L=>{console.log("🔗 Initial connectivity test result:",L)}).catch(L=>{console.error("❌ Initial connectivity test failed:",L)})):console.log("ℹ️ FirestoreBuddyService state is null/undefined")},[k]);const uo=async()=>{try{const L=V.current||k;if(!L){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Xs();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting automatic user matching...");const H=await L.getAllMatchingPoolUsers();if(H.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing");return}console.log(`🔄 Firestore: Found ${H.length} users in matching pool`);const K=[];for(const ye of H)try{const{ref:le,get:Ee}=await Ge(()=>import("./index.esm-76803d89.js"),[]),Se=le(se,`users/${ye.userId}`);(await Ee(Se)).exists()?K.push(ye):(console.log(`⚠️ Firestore: Removing invalid user from matching pool: ${ye.userId}`),await L.removeFromMatchingPool(ye.userId))}catch(le){console.error("❌ Firestore: Error validating user:",le)}if(K.length<2){console.log("ℹ️ Firestore: Not enough valid users for pairing after validation");return}let he=0;for(let ye=0;ye<K.length-1;ye+=2){const le=K[ye],Ee=K[ye+1];try{console.log(`🔄 Firestore: Creating buddy pair between ${le.userId} and ${Ee.userId}`);const Se={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Sequential auto-match","First-come, first-served pairing"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1},_e=await L.createBuddyPair(le.userId,Ee.userId,Se);if(_e){const{ref:rt,set:Vt}=await Ge(()=>import("./index.esm-76803d89.js"),[]);await Vt(rt(se,`users/${le.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ee.userId,pairId:_e,matchedAt:Se.matchedAt}),await Vt(rt(se,`users/${Ee.userId}/buddyInfo`),{hasBuddy:!0,buddyId:le.userId,pairId:_e,matchedAt:Se.matchedAt}),await L.removeFromMatchingPool(le.userId),await L.removeFromMatchingPool(Ee.userId),he++,console.log(`✅ Firestore: Created buddy pair ${_e} between ${le.userId} and ${Ee.userId}`)}else console.error(`❌ Firestore: Failed to create buddy pair between ${le.userId} and ${Ee.userId}`)}catch(Se){console.error(`❌ Firestore: Failed to create buddy pair between ${le.userId} and ${Ee.userId}:`,Se)}}if(o!=null&&o.uid&&K.some(le=>le.userId===o.uid))try{await Rt()}catch(le){console.error("Error reloading buddy data:",le)}he>0&&console.log(`🎉 Firestore: Auto-matching completed: ${he} pairs created`)}catch(L){console.error("❌ Firestore: Auto-matching failed:",L),console.log("🔄 Falling back to Realtime Database auto-matching..."),await Xs()}},Xs=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:L,get:H,set:K,push:he,remove:ye}=await Ge(()=>import("./index.esm-76803d89.js"),[]),le=L(se,"matchingPool"),Ee=await H(le);if(!Ee.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const Se=Ee.val(),_e=[];if(Object.entries(Se).forEach(([ut,Oe])=>{typeof Oe=="string"?_e.push(Oe):Oe&&typeof Oe=="object"?Oe.uid?_e.push(Oe.uid):Oe.userId?_e.push(Oe.userId):_e.push(ut):_e.push(ut)}),console.log(`🔄 Realtime Database: Found ${_e.length} users in matching pool`),_e.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",_e.length,")");return}const rt=[];for(const ut of _e)try{const Oe=L(se,`users/${ut}`);(await H(Oe)).exists()?rt.push(ut):(console.log(`⚠️ Realtime Database: Removing invalid user from matching pool: ${ut}`),await ye(L(se,`matchingPool/${ut}`)))}catch(Oe){console.error("❌ Realtime Database: Error validating user:",Oe)}if(rt.length<2){console.log("ℹ️ Realtime Database: Not enough valid users for pairing after validation");return}console.log(`🔄 Realtime Database: Valid users for pairing: ${rt.join(", ")}`);let Vt=0;for(let ut=0;ut<rt.length-1;ut+=2){const Oe=rt[ut],$t=rt[ut+1];console.log(`🔄 Realtime Database: Pairing users ${Oe} and ${$t}`);try{const Le=he(L(se,"buddyPairs")).key,In={pairId:Le,users:[Oe,$t],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Sequential auto-match","First-come, first-served pairing"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await K(L(se,`buddyPairs/${Le}`),In),await K(L(se,`users/${Oe}/buddyInfo`),{hasBuddy:!0,buddyId:$t,pairId:Le,matchedAt:In.matchedAt}),await K(L(se,`users/${$t}/buddyInfo`),{hasBuddy:!0,buddyId:Oe,pairId:Le,matchedAt:In.matchedAt}),Object.keys(Se).forEach(async qe=>{const Ne=Se[qe],On=(Ne==null?void 0:Ne.uid)||(Ne==null?void 0:Ne.userId)||qe;(On===Oe||On===$t)&&await ye(L(se,`matchingPool/${qe}`))}),await K(L(se,`buddyPairs/${Le}/user1RemovedFromPool`),!0),await K(L(se,`buddyPairs/${Le}/user2RemovedFromPool`),!0),Vt++}catch(Le){console.error("Error creating buddy pair:",Le)}}if(o!=null&&o.uid&&rt.some(Oe=>Oe===o.uid))try{await Rt()}catch(Oe){console.error("Error reloading buddy data:",Oe)}Vt>0&&console.log(`🎉 Realtime Database: Auto-matching completed: ${Vt} pairs created`)}catch(L){console.error("Error in Realtime Database auto-matching:",L)}};j.useEffect(()=>{const L=H=>{const K=H.detail;console.log("Navigating to tab:",K),K==="buddy-chat"&&(r("buddy-chat"),e("buddy-chat"))};return window.addEventListener("navigateToTab",L),()=>{window.removeEventListener("navigateToTab",L)}},[]);const Bt={heroName:"",stats:{streakDays:0,addictionLevel:0,willpower:0,motivation:0,cravingResistance:0,triggerDefense:0,moneySaved:0,experiencePoints:0},achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},Lt=()=>Xt?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,moneySaved:0,experiencePoints:0},achievements:[],archetype:"LOADING",avatar:Is("loading","adventurer"),isLoading:!0}:$n?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,moneySaved:0,experiencePoints:0},achievements:[],archetype:"ERROR",avatar:Is("error","adventurer"),isError:!0,errorMessage:$n}:Ie||Bt,Zs=async L=>{console.log("Onboarding completed with user data:",L);try{if(!L||!L.heroName||!L.stats)throw new Error("Invalid user data received from onboarding");if(!h)throw new Error("No authenticated user found");const H={...L,uid:h.uid,email:h.email,displayName:h.displayName||L.heroName,photoURL:h.photoURL,onboardingCompleted:!0,updatedAt:Date.now()};console.log("Saving user data to Firebase:",H);const{ref:K,set:he}=await Ge(()=>import("./index.esm-76803d89.js"),[]),ye=K(se,`users/${h.uid}`);await he(ye,H),console.log("Firebase save successful, updating app state..."),a(H),u(!0);try{const Ee=V.current||k;if(Ee){console.log("✅ Using Firestore for matching pool");const Se={quitStartDate:H.quitDate||new Date().toISOString(),addictionLevel:H.stats.addictionLevel||50,triggers:H.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:H.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:h.uid,heroName:H.heroName,archetype:H.archetype};if(await Ee.addToMatchingPool(h.uid,Se))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Se,set:_e}=await Ge(()=>import("./index.esm-76803d89.js"),[]),rt={quitStartDate:H.quitDate||new Date().toISOString(),addictionLevel:H.stats.addictionLevel||50,triggers:H.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:H.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:h.uid,heroName:H.heroName,archetype:H.archetype};await _e(Se(se,`matchingPool/${h.uid}`),rt),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{await uo()}catch(Se){console.error("Automatic matching failed:",Se)}}catch(Ee){console.error("⚠️ Failed to add user to buddy matching pool:",Ee)}const le=await z(h.uid);r("arena")}catch(H){console.error("Error in handleOnboardingComplete:",H);const K={heroName:(L==null?void 0:L.heroName)||"Hero",archetype:(L==null?void 0:L.archetype)||"The Determined",avatar:(L==null?void 0:L.avatar)||Is("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,moneySaved:0,experiencePoints:0},achievements:[],quitDate:new Date,uid:h==null?void 0:h.uid,email:h==null?void 0:h.email,onboardingCompleted:!0};if(h)try{const{ref:he,set:ye}=await Ge(()=>import("./index.esm-76803d89.js"),[]),le=he(se,`users/${h.uid}`);await ye(le,K)}catch(he){console.error("Failed to save fallback data to Firebase:",he)}a(K),u(!0),r("arena")}},Sa=()=>{a(null),u(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},fn=async()=>{try{console.log("Logging out user...");const{signOut:L}=await Ge(()=>import("./index.esm-fc8f9120.js"),[]);await L(Ti),a(null),f(null),u(!1),r("auth"),localStorage.removeItem("lastSOS"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(L){console.error("Error during logout:",L),a(null),f(null),u(!1),r("auth")}},oh=async()=>{if(!h){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:L,set:H,remove:K}=await Ge(()=>import("./index.esm-76803d89.js"),[]),he=L(se,`users/${h.uid}`);await H(he,null);const ye=L(se,"users");await H(ye,null);const le=L(se,"buddyPairs");await H(le,null);const Ee=L(se,"matchingPool");await H(Ee,null),console.log("All user data and buddy matching data cleared from database"),a(null),u(!1),r("onboarding"),Xe(null),dn(!1),ct(null),console.log("Account reset successful - ready for fresh onboarding")}catch(L){console.error("Error resetting account for testing:",L)}},ho=L=>{console.log("Tab changed to:",L),e(L),r(L)},ah=L=>{r(L==="mood-selector"?"mood-selector":"profile")},lh=L=>{i(L),r("profile")},mc=()=>{r("profile")};return p?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?d.jsx($z,{onAuthSuccess:pe}):x.isLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:x.currentStep}),d.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[d.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${x.progress}%`}})}),d.jsxs("div",{className:"text-sm text-gray-400",children:[x.progress,"% Complete"]})]}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),x.error&&d.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[d.jsxs("p",{className:"text-red-300 text-sm",children:[d.jsx("span",{className:"font-semibold",children:"Error:"})," ",x.error]}),d.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:[d.jsx(zz,{}),!1,t==="onboarding"&&d.jsxs("div",{children:[console.log("Rendering OnboardingFlow"),d.jsx(Zz,{onComplete:Zs,authUser:h})]}),l&&o?d.jsxs(d.Fragment,{children:[console.log("Main app rendering with user:",o,"view:",t),t==="arena"&&d.jsxs("div",{children:[console.log("Rendering ArenaView with user:",o),(()=>{try{const L=Lt();return d.jsx(sq,{user:o,nemesis:L,onBackToLogin:fn,onResetForTesting:oh,buddyLoading:Xt,buddyError:$n,realBuddy:Ie})}catch(L){return console.error("Error rendering ArenaView:",L),d.jsxs("div",{className:"text-white text-center p-8",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),d.jsx("p",{className:"text-gray-300 mb-4",children:L.message}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-2 rounded hover:bg-blue-700",children:"Reload App"})]})}})()]}),t==="craving-support"&&d.jsxs("div",{children:[console.log("Rendering CravingSupportView with user:",o),d.jsx(aq,{user:o,nemesis:Lt(),onBackToLogin:fn,onResetForTesting:oh})]}),t==="profile"&&d.jsxs("div",{children:[console.log("Rendering ProfileView with user:",o),d.jsx(lq,{user:o,onNavigate:ah})]}),t==="mood-selector"&&d.jsx(MoodSelector,{onMoodSelect:lh,onBack:mc}),t==="buddy-chat"&&d.jsx(mq,{user:o,nemesis:Lt(),buddyMatchingService:b}),t==="settings"&&d.jsx(pq,{onResetApp:Sa}),d.jsx(rq,{activeTab:n,onTabChange:ho,dataLoadingState:x,onRefreshData:oe,offlineManager:re})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),d.jsx("p",{className:"text-gray-300",children:l?"User data missing":"Onboarding not completed"}),d.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),d.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),d.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:l,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Debug State"})]})})]})};Ay.createRoot(document.getElementById("root")).render(d.jsx(y2.StrictMode,{children:d.jsx(gq,{})}));export{Eq as $,Tq as A,Sq as B,bq as C,Yo as D,vq as E,$_ as F,Vq as G,Fq as H,jq as I,Uq as J,ER as K,$q as L,ve as M,_q as N,a4 as O,l4 as P,Kr as Q,Hr as R,Yq as S,C4 as T,Kq as U,en as V,wq as W,Iq as X,Oq as Y,Dq as Z,Zq as _,x4 as a,DB as a$,p7 as a0,rh as a1,nh as a2,g7 as a3,vd as a4,xa as a5,pi as a6,u7 as a7,mi as a8,xs as a9,D7 as aA,_9 as aB,y7 as aC,O5 as aD,$7 as aE,tW as aF,XS as aG,h$ as aH,oB as aI,O7 as aJ,b7 as aK,NB as aL,H7 as aM,J7 as aN,eW as aO,z7 as aP,L7 as aQ,GB as aR,_7 as aS,E5 as aT,PB as aU,K7 as aV,Y7 as aW,Z7 as aX,V5 as aY,U7 as aZ,FB as a_,$s as aa,Rf as ab,f7 as ac,Uo as ad,fl as ae,u9 as af,d7 as ag,W7 as ah,_v as ai,h7 as aj,d9 as ak,CI as al,gi as am,x7 as an,HB as ao,q7 as ap,Gk as aq,c9 as ar,Qk as as,OB as at,E7 as au,lB as av,MB as aw,m7 as ax,B7 as ay,C7 as az,_r as b,i8 as b$,S7 as b0,WB as b1,v7 as b2,yI as b3,I7 as b4,LB as b5,A7 as b6,G7 as b7,S$ as b8,X7 as b9,un as bA,uc as bB,Jd as bC,bf as bD,Zm as bE,Xd as bF,Jm as bG,oI as bH,ur as bI,Xm as bJ,Ei as bK,Ke as bL,v5 as bM,$r as bN,y5 as bO,sw as bP,Dt as bQ,Jo as bR,Q as bS,r8 as bT,R4 as bU,It as bV,c7 as bW,ke as bX,n8 as bY,l7 as bZ,a7 as b_,j7 as ba,w7 as bb,F7 as bc,P7 as bd,k7 as be,Q7 as bf,N7 as bg,V7 as bh,M7 as bi,R7 as bj,T7 as bk,dk as bl,pd as bm,JU as bn,or as bo,l8 as bp,ds as bq,Ze as br,cr as bs,va as bt,wa as bu,nt as bv,B as bw,hs as bx,KU as by,w5 as bz,k0 as c,$S as c$,Cr as c0,j4 as c1,a5 as c2,P8 as c3,k8 as c4,I8 as c5,X8 as c6,J8 as c7,N8 as c8,h8 as c9,F8 as cA,j8 as cB,QU as cC,r7 as cD,Z8 as cE,c8 as cF,x8 as cG,T8 as cH,jS as cI,q8 as cJ,G8 as cK,W8 as cL,YU as cM,qS as cN,B8 as cO,$8 as cP,w8 as cQ,E8 as cR,H8 as cS,K8 as cT,m5 as cU,_8 as cV,JP as cW,O8 as cX,a8 as cY,Q8 as cZ,Qh as c_,gy as ca,o8 as cb,HU as cc,r5 as cd,o7 as ce,zS as cf,Y8 as cg,m8 as ch,i7 as ci,eu as cj,y8 as ck,D8 as cl,u8 as cm,d8 as cn,p8 as co,s7 as cp,C8 as cq,A8 as cr,At as cs,Zd as ct,l5 as cu,z8 as cv,i5 as cw,L8 as cx,V8 as cy,o5 as cz,ns as d,n7 as d0,t8 as d1,M8 as d2,b8 as d3,S8 as d4,R8 as d5,g8 as d6,U8 as d7,e7 as d8,f8 as d9,v8 as da,t7 as db,Ge as dc,bl as e,Xq as f,S4 as g,Jq as h,Hq as i,Nq as j,Pq as k,Bq as l,qq as m,zq as n,Pt as o,T4 as p,Wq as q,bR as r,cC as s,Gq as t,Qq as u,J0 as v,Mq as w,Lq as x,Aq as y,xq as z};
