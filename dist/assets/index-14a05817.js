(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function b2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var XT={exports:{}},Cp={},ZT={exports:{}},at={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uh=Symbol.for("react.element"),T2=Symbol.for("react.portal"),A2=Symbol.for("react.fragment"),C2=Symbol.for("react.strict_mode"),R2=Symbol.for("react.profiler"),N2=Symbol.for("react.provider"),k2=Symbol.for("react.context"),P2=Symbol.for("react.forward_ref"),D2=Symbol.for("react.suspense"),O2=Symbol.for("react.memo"),M2=Symbol.for("react.lazy"),BS=Symbol.iterator;function L2(n){return n===null||typeof n!="object"?null:(n=BS&&n[BS]||n["@@iterator"],typeof n=="function"?n:null)}var eA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},tA=Object.assign,nA={};function Vc(n,e,t){this.props=n,this.context=e,this.refs=nA,this.updater=t||eA}Vc.prototype.isReactComponent={};Vc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Vc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function rA(){}rA.prototype=Vc.prototype;function t0(n,e,t){this.props=n,this.context=e,this.refs=nA,this.updater=t||eA}var n0=t0.prototype=new rA;n0.constructor=t0;tA(n0,Vc.prototype);n0.isPureReactComponent=!0;var zS=Array.isArray,sA=Object.prototype.hasOwnProperty,r0={current:null},iA={key:!0,ref:!0,__self:!0,__source:!0};function oA(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)sA.call(e,r)&&!iA.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:uh,type:n,key:i,ref:o,props:s,_owner:r0.current}}function j2(n,e){return{$$typeof:uh,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function s0(n){return typeof n=="object"&&n!==null&&n.$$typeof===uh}function V2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var qS=/\/+/g;function sy(n,e){return typeof n=="object"&&n!==null&&n.key!=null?V2(""+n.key):e.toString(36)}function Uf(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case uh:case T2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+sy(o,0):r,zS(s)?(t="",n!=null&&(t=n.replace(qS,"$&/")+"/"),Uf(s,e,t,"",function(u){return u})):s!=null&&(s0(s)&&(s=j2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(qS,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",zS(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+sy(i,a);o+=Uf(i,e,t,l,s)}else if(l=L2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+sy(i,a++),o+=Uf(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function sf(n,e,t){if(n==null)return n;var r=[],s=0;return Uf(n,r,"","",function(i){return e.call(t,i,s++)}),r}function F2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var gr={current:null},$f={transition:null},U2={ReactCurrentDispatcher:gr,ReactCurrentBatchConfig:$f,ReactCurrentOwner:r0};function aA(){throw Error("act(...) is not supported in production builds of React.")}at.Children={map:sf,forEach:function(n,e,t){sf(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return sf(n,function(){e++}),e},toArray:function(n){return sf(n,function(e){return e})||[]},only:function(n){if(!s0(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};at.Component=Vc;at.Fragment=A2;at.Profiler=R2;at.PureComponent=t0;at.StrictMode=C2;at.Suspense=D2;at.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U2;at.act=aA;at.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=tA({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=r0.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)sA.call(e,l)&&!iA.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:uh,type:n.type,key:s,ref:i,props:r,_owner:o}};at.createContext=function(n){return n={$$typeof:k2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:N2,_context:n},n.Consumer=n};at.createElement=oA;at.createFactory=function(n){var e=oA.bind(null,n);return e.type=n,e};at.createRef=function(){return{current:null}};at.forwardRef=function(n){return{$$typeof:P2,render:n}};at.isValidElement=s0;at.lazy=function(n){return{$$typeof:M2,_payload:{_status:-1,_result:n},_init:F2}};at.memo=function(n,e){return{$$typeof:O2,type:n,compare:e===void 0?null:e}};at.startTransition=function(n){var e=$f.transition;$f.transition={};try{n()}finally{$f.transition=e}};at.unstable_act=aA;at.useCallback=function(n,e){return gr.current.useCallback(n,e)};at.useContext=function(n){return gr.current.useContext(n)};at.useDebugValue=function(){};at.useDeferredValue=function(n){return gr.current.useDeferredValue(n)};at.useEffect=function(n,e){return gr.current.useEffect(n,e)};at.useId=function(){return gr.current.useId()};at.useImperativeHandle=function(n,e,t){return gr.current.useImperativeHandle(n,e,t)};at.useInsertionEffect=function(n,e){return gr.current.useInsertionEffect(n,e)};at.useLayoutEffect=function(n,e){return gr.current.useLayoutEffect(n,e)};at.useMemo=function(n,e){return gr.current.useMemo(n,e)};at.useReducer=function(n,e,t){return gr.current.useReducer(n,e,t)};at.useRef=function(n){return gr.current.useRef(n)};at.useState=function(n){return gr.current.useState(n)};at.useSyncExternalStore=function(n,e,t){return gr.current.useSyncExternalStore(n,e,t)};at.useTransition=function(){return gr.current.useTransition()};at.version="18.3.1";ZT.exports=at;var D=ZT.exports;const $2=b2(D);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B2=D,z2=Symbol.for("react.element"),q2=Symbol.for("react.fragment"),W2=Object.prototype.hasOwnProperty,G2=B2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,H2={key:!0,ref:!0,__self:!0,__source:!0};function lA(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)W2.call(e,r)&&!H2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:z2,type:n,key:i,ref:o,props:s,_owner:G2.current}}Cp.Fragment=q2;Cp.jsx=lA;Cp.jsxs=lA;XT.exports=Cp;var c=XT.exports,a_={},cA={exports:{}},Kr={},uA={exports:{}},dA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Y,we){var re=Y.length;Y.push(we);e:for(;0<re;){var Ee=re-1>>>1,Oe=Y[Ee];if(0<s(Oe,we))Y[Ee]=we,Y[re]=Oe,re=Ee;else break e}}function t(Y){return Y.length===0?null:Y[0]}function r(Y){if(Y.length===0)return null;var we=Y[0],re=Y.pop();if(re!==we){Y[0]=re;e:for(var Ee=0,Oe=Y.length,O=Oe>>>1;Ee<O;){var W=2*(Ee+1)-1,ce=Y[W],me=W+1,Te=Y[me];if(0>s(ce,re))me<Oe&&0>s(Te,ce)?(Y[Ee]=Te,Y[me]=re,Ee=me):(Y[Ee]=ce,Y[W]=re,Ee=W);else if(me<Oe&&0>s(Te,re))Y[Ee]=Te,Y[me]=re,Ee=me;else break e}}return we}function s(Y,we){var re=Y.sortIndex-we.sortIndex;return re!==0?re:Y.id-we.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,m=3,y=!1,_=!1,E=!1,k=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(Y){for(var we=t(u);we!==null;){if(we.callback===null)r(u);else if(we.startTime<=Y)r(u),we.sortIndex=we.expirationTime,e(l,we);else break;we=t(u)}}function P(Y){if(E=!1,R(Y),!_)if(t(l)!==null)_=!0,ke($);else{var we=t(u);we!==null&&_t(P,we.startTime-Y)}}function $(Y,we){_=!1,E&&(E=!1,I(w),w=-1),y=!0;var re=m;try{for(R(we),f=t(l);f!==null&&(!(f.expirationTime>we)||Y&&!b());){var Ee=f.callback;if(typeof Ee=="function"){f.callback=null,m=f.priorityLevel;var Oe=Ee(f.expirationTime<=we);we=n.unstable_now(),typeof Oe=="function"?f.callback=Oe:f===t(l)&&r(l),R(we)}else r(l);f=t(l)}if(f!==null)var O=!0;else{var W=t(u);W!==null&&_t(P,W.startTime-we),O=!1}return O}finally{f=null,m=re,y=!1}}var M=!1,N=null,w=-1,T=5,A=-1;function b(){return!(n.unstable_now()-A<T)}function C(){if(N!==null){var Y=n.unstable_now();A=Y;var we=!0;try{we=N(!0,Y)}finally{we?v():(M=!1,N=null)}}else M=!1}var v;if(typeof x=="function")v=function(){x(C)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,ge=B.port2;B.port1.onmessage=C,v=function(){ge.postMessage(null)}}else v=function(){k(C,0)};function ke(Y){N=Y,M||(M=!0,v())}function _t(Y,we){w=k(function(){Y(n.unstable_now())},we)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Y){Y.callback=null},n.unstable_continueExecution=function(){_||y||(_=!0,ke($))},n.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<Y?Math.floor(1e3/Y):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(Y){switch(m){case 1:case 2:case 3:var we=3;break;default:we=m}var re=m;m=we;try{return Y()}finally{m=re}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Y,we){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var re=m;m=Y;try{return we()}finally{m=re}},n.unstable_scheduleCallback=function(Y,we,re){var Ee=n.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?Ee+re:Ee):re=Ee,Y){case 1:var Oe=-1;break;case 2:Oe=250;break;case 5:Oe=1073741823;break;case 4:Oe=1e4;break;default:Oe=5e3}return Oe=re+Oe,Y={id:h++,callback:we,priorityLevel:Y,startTime:re,expirationTime:Oe,sortIndex:-1},re>Ee?(Y.sortIndex=re,e(u,Y),t(l)===null&&Y===t(u)&&(E?(I(w),w=-1):E=!0,_t(P,re-Ee))):(Y.sortIndex=Oe,e(l,Y),_||y||(_=!0,ke($))),Y},n.unstable_shouldYield=b,n.unstable_wrapCallback=function(Y){var we=m;return function(){var re=m;m=we;try{return Y.apply(this,arguments)}finally{m=re}}}})(dA);uA.exports=dA;var Q2=uA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K2=D,Wr=Q2;function X(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var hA=new Set,_d={};function Ya(n,e){ic(n,e),ic(n+"Capture",e)}function ic(n,e){for(_d[n]=e,n=0;n<e.length;n++)hA.add(e[n])}var wi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l_=Object.prototype.hasOwnProperty,Y2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,WS={},GS={};function J2(n){return l_.call(GS,n)?!0:l_.call(WS,n)?!1:Y2.test(n)?GS[n]=!0:(WS[n]=!0,!1)}function X2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Z2(n,e,t,r){if(e===null||typeof e>"u"||X2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yr(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Yn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Yn[n]=new yr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Yn[e]=new yr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Yn[n]=new yr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Yn[n]=new yr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Yn[n]=new yr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Yn[n]=new yr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Yn[n]=new yr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Yn[n]=new yr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Yn[n]=new yr(n,5,!1,n.toLowerCase(),null,!1,!1)});var i0=/[\-:]([a-z])/g;function o0(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(i0,o0);Yn[e]=new yr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(i0,o0);Yn[e]=new yr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(i0,o0);Yn[e]=new yr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Yn[n]=new yr(n,1,!1,n.toLowerCase(),null,!1,!1)});Yn.xlinkHref=new yr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Yn[n]=new yr(n,1,!1,n.toLowerCase(),null,!0,!0)});function a0(n,e,t,r){var s=Yn.hasOwnProperty(e)?Yn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Z2(e,t,s,r)&&(t=null),r||s===null?J2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ki=K2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,of=Symbol.for("react.element"),Rl=Symbol.for("react.portal"),Nl=Symbol.for("react.fragment"),l0=Symbol.for("react.strict_mode"),c_=Symbol.for("react.profiler"),fA=Symbol.for("react.provider"),mA=Symbol.for("react.context"),c0=Symbol.for("react.forward_ref"),u_=Symbol.for("react.suspense"),d_=Symbol.for("react.suspense_list"),u0=Symbol.for("react.memo"),Yi=Symbol.for("react.lazy"),pA=Symbol.for("react.offscreen"),HS=Symbol.iterator;function du(n){return n===null||typeof n!="object"?null:(n=HS&&n[HS]||n["@@iterator"],typeof n=="function"?n:null)}var sn=Object.assign,iy;function Nu(n){if(iy===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);iy=e&&e[1]||""}return`
`+iy+n}var oy=!1;function ay(n,e){if(!n||oy)return"";oy=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{oy=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Nu(n):""}function eO(n){switch(n.tag){case 5:return Nu(n.type);case 16:return Nu("Lazy");case 13:return Nu("Suspense");case 19:return Nu("SuspenseList");case 0:case 2:case 15:return n=ay(n.type,!1),n;case 11:return n=ay(n.type.render,!1),n;case 1:return n=ay(n.type,!0),n;default:return""}}function h_(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Nl:return"Fragment";case Rl:return"Portal";case c_:return"Profiler";case l0:return"StrictMode";case u_:return"Suspense";case d_:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case mA:return(n.displayName||"Context")+".Consumer";case fA:return(n._context.displayName||"Context")+".Provider";case c0:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case u0:return e=n.displayName||null,e!==null?e:h_(n.type)||"Memo";case Yi:e=n._payload,n=n._init;try{return h_(n(e))}catch{}}return null}function tO(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return h_(e);case 8:return e===l0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Co(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function gA(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function nO(n){var e=gA(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function af(n){n._valueTracker||(n._valueTracker=nO(n))}function yA(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=gA(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function _m(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function f_(n,e){var t=e.checked;return sn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function QS(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Co(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function _A(n,e){e=e.checked,e!=null&&a0(n,"checked",e,!1)}function m_(n,e){_A(n,e);var t=Co(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?p_(n,e.type,t):e.hasOwnProperty("defaultValue")&&p_(n,e.type,Co(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function KS(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function p_(n,e,t){(e!=="number"||_m(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var ku=Array.isArray;function ql(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Co(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function g_(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(X(91));return sn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function YS(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(X(92));if(ku(t)){if(1<t.length)throw Error(X(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Co(t)}}function vA(n,e){var t=Co(e.value),r=Co(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function JS(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function wA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function y_(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?wA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var lf,xA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(lf=lf||document.createElement("div"),lf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=lf.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function vd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Bu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rO=["Webkit","ms","Moz","O"];Object.keys(Bu).forEach(function(n){rO.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Bu[e]=Bu[n]})});function SA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Bu.hasOwnProperty(n)&&Bu[n]?(""+e).trim():e+"px"}function IA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=SA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var sO=sn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function __(n,e){if(e){if(sO[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(X(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(X(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(X(61))}if(e.style!=null&&typeof e.style!="object")throw Error(X(62))}}function v_(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var w_=null;function d0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var x_=null,Wl=null,Gl=null;function XS(n){if(n=fh(n)){if(typeof x_!="function")throw Error(X(280));var e=n.stateNode;e&&(e=Dp(e),x_(n.stateNode,n.type,e))}}function EA(n){Wl?Gl?Gl.push(n):Gl=[n]:Wl=n}function bA(){if(Wl){var n=Wl,e=Gl;if(Gl=Wl=null,XS(n),e)for(n=0;n<e.length;n++)XS(e[n])}}function TA(n,e){return n(e)}function AA(){}var ly=!1;function CA(n,e,t){if(ly)return n(e,t);ly=!0;try{return TA(n,e,t)}finally{ly=!1,(Wl!==null||Gl!==null)&&(AA(),bA())}}function wd(n,e){var t=n.stateNode;if(t===null)return null;var r=Dp(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(X(231,e,typeof t));return t}var S_=!1;if(wi)try{var hu={};Object.defineProperty(hu,"passive",{get:function(){S_=!0}}),window.addEventListener("test",hu,hu),window.removeEventListener("test",hu,hu)}catch{S_=!1}function iO(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var zu=!1,vm=null,wm=!1,I_=null,oO={onError:function(n){zu=!0,vm=n}};function aO(n,e,t,r,s,i,o,a,l){zu=!1,vm=null,iO.apply(oO,arguments)}function lO(n,e,t,r,s,i,o,a,l){if(aO.apply(this,arguments),zu){if(zu){var u=vm;zu=!1,vm=null}else throw Error(X(198));wm||(wm=!0,I_=u)}}function Ja(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function RA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function ZS(n){if(Ja(n)!==n)throw Error(X(188))}function cO(n){var e=n.alternate;if(!e){if(e=Ja(n),e===null)throw Error(X(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return ZS(s),n;if(i===r)return ZS(s),e;i=i.sibling}throw Error(X(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(X(189))}}if(t.alternate!==r)throw Error(X(190))}if(t.tag!==3)throw Error(X(188));return t.stateNode.current===t?n:e}function NA(n){return n=cO(n),n!==null?kA(n):null}function kA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=kA(n);if(e!==null)return e;n=n.sibling}return null}var PA=Wr.unstable_scheduleCallback,eI=Wr.unstable_cancelCallback,uO=Wr.unstable_shouldYield,dO=Wr.unstable_requestPaint,yn=Wr.unstable_now,hO=Wr.unstable_getCurrentPriorityLevel,h0=Wr.unstable_ImmediatePriority,DA=Wr.unstable_UserBlockingPriority,xm=Wr.unstable_NormalPriority,fO=Wr.unstable_LowPriority,OA=Wr.unstable_IdlePriority,Rp=null,Hs=null;function mO(n){if(Hs&&typeof Hs.onCommitFiberRoot=="function")try{Hs.onCommitFiberRoot(Rp,n,void 0,(n.current.flags&128)===128)}catch{}}var xs=Math.clz32?Math.clz32:yO,pO=Math.log,gO=Math.LN2;function yO(n){return n>>>=0,n===0?32:31-(pO(n)/gO|0)|0}var cf=64,uf=4194304;function Pu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Sm(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Pu(a):(i&=o,i!==0&&(r=Pu(i)))}else o=t&~s,o!==0?r=Pu(o):i!==0&&(r=Pu(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-xs(e),s=1<<t,r|=n[t],e&=~s;return r}function _O(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vO(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-xs(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=_O(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function E_(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function MA(){var n=cf;return cf<<=1,!(cf&4194240)&&(cf=64),n}function cy(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function dh(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-xs(e),n[e]=t}function wO(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-xs(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function f0(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-xs(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var bt=0;function LA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var jA,m0,VA,FA,UA,b_=!1,df=[],fo=null,mo=null,po=null,xd=new Map,Sd=new Map,Xi=[],xO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tI(n,e){switch(n){case"focusin":case"focusout":fo=null;break;case"dragenter":case"dragleave":mo=null;break;case"mouseover":case"mouseout":po=null;break;case"pointerover":case"pointerout":xd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Sd.delete(e.pointerId)}}function fu(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=fh(e),e!==null&&m0(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function SO(n,e,t,r,s){switch(e){case"focusin":return fo=fu(fo,n,e,t,r,s),!0;case"dragenter":return mo=fu(mo,n,e,t,r,s),!0;case"mouseover":return po=fu(po,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return xd.set(i,fu(xd.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Sd.set(i,fu(Sd.get(i)||null,n,e,t,r,s)),!0}return!1}function $A(n){var e=ma(n.target);if(e!==null){var t=Ja(e);if(t!==null){if(e=t.tag,e===13){if(e=RA(t),e!==null){n.blockedOn=e,UA(n.priority,function(){VA(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Bf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=T_(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);w_=r,t.target.dispatchEvent(r),w_=null}else return e=fh(t),e!==null&&m0(e),n.blockedOn=t,!1;e.shift()}return!0}function nI(n,e,t){Bf(n)&&t.delete(e)}function IO(){b_=!1,fo!==null&&Bf(fo)&&(fo=null),mo!==null&&Bf(mo)&&(mo=null),po!==null&&Bf(po)&&(po=null),xd.forEach(nI),Sd.forEach(nI)}function mu(n,e){n.blockedOn===e&&(n.blockedOn=null,b_||(b_=!0,Wr.unstable_scheduleCallback(Wr.unstable_NormalPriority,IO)))}function Id(n){function e(s){return mu(s,n)}if(0<df.length){mu(df[0],n);for(var t=1;t<df.length;t++){var r=df[t];r.blockedOn===n&&(r.blockedOn=null)}}for(fo!==null&&mu(fo,n),mo!==null&&mu(mo,n),po!==null&&mu(po,n),xd.forEach(e),Sd.forEach(e),t=0;t<Xi.length;t++)r=Xi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Xi.length&&(t=Xi[0],t.blockedOn===null);)$A(t),t.blockedOn===null&&Xi.shift()}var Hl=ki.ReactCurrentBatchConfig,Im=!0;function EO(n,e,t,r){var s=bt,i=Hl.transition;Hl.transition=null;try{bt=1,p0(n,e,t,r)}finally{bt=s,Hl.transition=i}}function bO(n,e,t,r){var s=bt,i=Hl.transition;Hl.transition=null;try{bt=4,p0(n,e,t,r)}finally{bt=s,Hl.transition=i}}function p0(n,e,t,r){if(Im){var s=T_(n,e,t,r);if(s===null)vy(n,e,r,Em,t),tI(n,r);else if(SO(s,n,e,t,r))r.stopPropagation();else if(tI(n,r),e&4&&-1<xO.indexOf(n)){for(;s!==null;){var i=fh(s);if(i!==null&&jA(i),i=T_(n,e,t,r),i===null&&vy(n,e,r,Em,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else vy(n,e,r,null,t)}}var Em=null;function T_(n,e,t,r){if(Em=null,n=d0(r),n=ma(n),n!==null)if(e=Ja(n),e===null)n=null;else if(t=e.tag,t===13){if(n=RA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Em=n,null}function BA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hO()){case h0:return 1;case DA:return 4;case xm:case fO:return 16;case OA:return 536870912;default:return 16}default:return 16}}var io=null,g0=null,zf=null;function zA(){if(zf)return zf;var n,e=g0,t=e.length,r,s="value"in io?io.value:io.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return zf=s.slice(n,1<r?1-r:void 0)}function qf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function hf(){return!0}function rI(){return!1}function Yr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?hf:rI,this.isPropagationStopped=rI,this}return sn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=hf)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=hf)},persist:function(){},isPersistent:hf}),e}var Fc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},y0=Yr(Fc),hh=sn({},Fc,{view:0,detail:0}),TO=Yr(hh),uy,dy,pu,Np=sn({},hh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==pu&&(pu&&n.type==="mousemove"?(uy=n.screenX-pu.screenX,dy=n.screenY-pu.screenY):dy=uy=0,pu=n),uy)},movementY:function(n){return"movementY"in n?n.movementY:dy}}),sI=Yr(Np),AO=sn({},Np,{dataTransfer:0}),CO=Yr(AO),RO=sn({},hh,{relatedTarget:0}),hy=Yr(RO),NO=sn({},Fc,{animationName:0,elapsedTime:0,pseudoElement:0}),kO=Yr(NO),PO=sn({},Fc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),DO=Yr(PO),OO=sn({},Fc,{data:0}),iI=Yr(OO),MO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=jO[n])?!!e[n]:!1}function _0(){return VO}var FO=sn({},hh,{key:function(n){if(n.key){var e=MO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=qf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?LO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_0,charCode:function(n){return n.type==="keypress"?qf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?qf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),UO=Yr(FO),$O=sn({},Np,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oI=Yr($O),BO=sn({},hh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_0}),zO=Yr(BO),qO=sn({},Fc,{propertyName:0,elapsedTime:0,pseudoElement:0}),WO=Yr(qO),GO=sn({},Np,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),HO=Yr(GO),QO=[9,13,27,32],v0=wi&&"CompositionEvent"in window,qu=null;wi&&"documentMode"in document&&(qu=document.documentMode);var KO=wi&&"TextEvent"in window&&!qu,qA=wi&&(!v0||qu&&8<qu&&11>=qu),aI=String.fromCharCode(32),lI=!1;function WA(n,e){switch(n){case"keyup":return QO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function GA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var kl=!1;function YO(n,e){switch(n){case"compositionend":return GA(e);case"keypress":return e.which!==32?null:(lI=!0,aI);case"textInput":return n=e.data,n===aI&&lI?null:n;default:return null}}function JO(n,e){if(kl)return n==="compositionend"||!v0&&WA(n,e)?(n=zA(),zf=g0=io=null,kl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return qA&&e.locale!=="ko"?null:e.data;default:return null}}var XO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!XO[n.type]:e==="textarea"}function HA(n,e,t,r){EA(r),e=bm(e,"onChange"),0<e.length&&(t=new y0("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Wu=null,Ed=null;function ZO(n){s1(n,0)}function kp(n){var e=Ol(n);if(yA(e))return n}function eM(n,e){if(n==="change")return e}var QA=!1;if(wi){var fy;if(wi){var my="oninput"in document;if(!my){var uI=document.createElement("div");uI.setAttribute("oninput","return;"),my=typeof uI.oninput=="function"}fy=my}else fy=!1;QA=fy&&(!document.documentMode||9<document.documentMode)}function dI(){Wu&&(Wu.detachEvent("onpropertychange",KA),Ed=Wu=null)}function KA(n){if(n.propertyName==="value"&&kp(Ed)){var e=[];HA(e,Ed,n,d0(n)),CA(ZO,e)}}function tM(n,e,t){n==="focusin"?(dI(),Wu=e,Ed=t,Wu.attachEvent("onpropertychange",KA)):n==="focusout"&&dI()}function nM(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return kp(Ed)}function rM(n,e){if(n==="click")return kp(e)}function sM(n,e){if(n==="input"||n==="change")return kp(e)}function iM(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var bs=typeof Object.is=="function"?Object.is:iM;function bd(n,e){if(bs(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!l_.call(e,s)||!bs(n[s],e[s]))return!1}return!0}function hI(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function fI(n,e){var t=hI(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=hI(t)}}function YA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?YA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function JA(){for(var n=window,e=_m();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=_m(n.document)}return e}function w0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function oM(n){var e=JA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&YA(t.ownerDocument.documentElement,t)){if(r!==null&&w0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=fI(t,i);var o=fI(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var aM=wi&&"documentMode"in document&&11>=document.documentMode,Pl=null,A_=null,Gu=null,C_=!1;function mI(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;C_||Pl==null||Pl!==_m(r)||(r=Pl,"selectionStart"in r&&w0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Gu&&bd(Gu,r)||(Gu=r,r=bm(A_,"onSelect"),0<r.length&&(e=new y0("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Pl)))}function ff(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Dl={animationend:ff("Animation","AnimationEnd"),animationiteration:ff("Animation","AnimationIteration"),animationstart:ff("Animation","AnimationStart"),transitionend:ff("Transition","TransitionEnd")},py={},XA={};wi&&(XA=document.createElement("div").style,"AnimationEvent"in window||(delete Dl.animationend.animation,delete Dl.animationiteration.animation,delete Dl.animationstart.animation),"TransitionEvent"in window||delete Dl.transitionend.transition);function Pp(n){if(py[n])return py[n];if(!Dl[n])return n;var e=Dl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in XA)return py[n]=e[t];return n}var ZA=Pp("animationend"),e1=Pp("animationiteration"),t1=Pp("animationstart"),n1=Pp("transitionend"),r1=new Map,pI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bo(n,e){r1.set(n,e),Ya(e,[n])}for(var gy=0;gy<pI.length;gy++){var yy=pI[gy],lM=yy.toLowerCase(),cM=yy[0].toUpperCase()+yy.slice(1);Bo(lM,"on"+cM)}Bo(ZA,"onAnimationEnd");Bo(e1,"onAnimationIteration");Bo(t1,"onAnimationStart");Bo("dblclick","onDoubleClick");Bo("focusin","onFocus");Bo("focusout","onBlur");Bo(n1,"onTransitionEnd");ic("onMouseEnter",["mouseout","mouseover"]);ic("onMouseLeave",["mouseout","mouseover"]);ic("onPointerEnter",["pointerout","pointerover"]);ic("onPointerLeave",["pointerout","pointerover"]);Ya("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ya("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ya("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ya("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ya("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ya("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Du="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uM=new Set("cancel close invalid load scroll toggle".split(" ").concat(Du));function gI(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,lO(r,e,void 0,n),n.currentTarget=null}function s1(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;gI(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;gI(s,a,u),i=l}}}if(wm)throw n=I_,wm=!1,I_=null,n}function $t(n,e){var t=e[D_];t===void 0&&(t=e[D_]=new Set);var r=n+"__bubble";t.has(r)||(i1(e,n,2,!1),t.add(r))}function _y(n,e,t){var r=0;e&&(r|=4),i1(t,n,r,e)}var mf="_reactListening"+Math.random().toString(36).slice(2);function Td(n){if(!n[mf]){n[mf]=!0,hA.forEach(function(t){t!=="selectionchange"&&(uM.has(t)||_y(t,!1,n),_y(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[mf]||(e[mf]=!0,_y("selectionchange",!1,e))}}function i1(n,e,t,r){switch(BA(e)){case 1:var s=EO;break;case 4:s=bO;break;default:s=p0}t=s.bind(null,e,t,n),s=void 0,!S_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function vy(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=ma(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}CA(function(){var u=i,h=d0(t),f=[];e:{var m=r1.get(n);if(m!==void 0){var y=y0,_=n;switch(n){case"keypress":if(qf(t)===0)break e;case"keydown":case"keyup":y=UO;break;case"focusin":_="focus",y=hy;break;case"focusout":_="blur",y=hy;break;case"beforeblur":case"afterblur":y=hy;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=sI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=CO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=zO;break;case ZA:case e1:case t1:y=kO;break;case n1:y=WO;break;case"scroll":y=TO;break;case"wheel":y=HO;break;case"copy":case"cut":case"paste":y=DO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=oI}var E=(e&4)!==0,k=!E&&n==="scroll",I=E?m!==null?m+"Capture":null:m;E=[];for(var x=u,R;x!==null;){R=x;var P=R.stateNode;if(R.tag===5&&P!==null&&(R=P,I!==null&&(P=wd(x,I),P!=null&&E.push(Ad(x,P,R)))),k)break;x=x.return}0<E.length&&(m=new y(m,_,null,t,h),f.push({event:m,listeners:E}))}}if(!(e&7)){e:{if(m=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",m&&t!==w_&&(_=t.relatedTarget||t.fromElement)&&(ma(_)||_[xi]))break e;if((y||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,y?(_=t.relatedTarget||t.toElement,y=u,_=_?ma(_):null,_!==null&&(k=Ja(_),_!==k||_.tag!==5&&_.tag!==6)&&(_=null)):(y=null,_=u),y!==_)){if(E=sI,P="onMouseLeave",I="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(E=oI,P="onPointerLeave",I="onPointerEnter",x="pointer"),k=y==null?m:Ol(y),R=_==null?m:Ol(_),m=new E(P,x+"leave",y,t,h),m.target=k,m.relatedTarget=R,P=null,ma(h)===u&&(E=new E(I,x+"enter",_,t,h),E.target=R,E.relatedTarget=k,P=E),k=P,y&&_)t:{for(E=y,I=_,x=0,R=E;R;R=gl(R))x++;for(R=0,P=I;P;P=gl(P))R++;for(;0<x-R;)E=gl(E),x--;for(;0<R-x;)I=gl(I),R--;for(;x--;){if(E===I||I!==null&&E===I.alternate)break t;E=gl(E),I=gl(I)}E=null}else E=null;y!==null&&yI(f,m,y,E,!1),_!==null&&k!==null&&yI(f,k,_,E,!0)}}e:{if(m=u?Ol(u):window,y=m.nodeName&&m.nodeName.toLowerCase(),y==="select"||y==="input"&&m.type==="file")var $=eM;else if(cI(m))if(QA)$=sM;else{$=nM;var M=tM}else(y=m.nodeName)&&y.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&($=rM);if($&&($=$(n,u))){HA(f,$,t,h);break e}M&&M(n,m,u),n==="focusout"&&(M=m._wrapperState)&&M.controlled&&m.type==="number"&&p_(m,"number",m.value)}switch(M=u?Ol(u):window,n){case"focusin":(cI(M)||M.contentEditable==="true")&&(Pl=M,A_=u,Gu=null);break;case"focusout":Gu=A_=Pl=null;break;case"mousedown":C_=!0;break;case"contextmenu":case"mouseup":case"dragend":C_=!1,mI(f,t,h);break;case"selectionchange":if(aM)break;case"keydown":case"keyup":mI(f,t,h)}var N;if(v0)e:{switch(n){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else kl?WA(n,t)&&(w="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(w="onCompositionStart");w&&(qA&&t.locale!=="ko"&&(kl||w!=="onCompositionStart"?w==="onCompositionEnd"&&kl&&(N=zA()):(io=h,g0="value"in io?io.value:io.textContent,kl=!0)),M=bm(u,w),0<M.length&&(w=new iI(w,n,null,t,h),f.push({event:w,listeners:M}),N?w.data=N:(N=GA(t),N!==null&&(w.data=N)))),(N=KO?YO(n,t):JO(n,t))&&(u=bm(u,"onBeforeInput"),0<u.length&&(h=new iI("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=N))}s1(f,e)})}function Ad(n,e,t){return{instance:n,listener:e,currentTarget:t}}function bm(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=wd(n,t),i!=null&&r.unshift(Ad(n,i,s)),i=wd(n,e),i!=null&&r.push(Ad(n,i,s))),n=n.return}return r}function gl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function yI(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=wd(t,i),l!=null&&o.unshift(Ad(t,l,a))):s||(l=wd(t,i),l!=null&&o.push(Ad(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var dM=/\r\n?/g,hM=/\u0000|\uFFFD/g;function _I(n){return(typeof n=="string"?n:""+n).replace(dM,`
`).replace(hM,"")}function pf(n,e,t){if(e=_I(e),_I(n)!==e&&t)throw Error(X(425))}function Tm(){}var R_=null,N_=null;function k_(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var P_=typeof setTimeout=="function"?setTimeout:void 0,fM=typeof clearTimeout=="function"?clearTimeout:void 0,vI=typeof Promise=="function"?Promise:void 0,mM=typeof queueMicrotask=="function"?queueMicrotask:typeof vI<"u"?function(n){return vI.resolve(null).then(n).catch(pM)}:P_;function pM(n){setTimeout(function(){throw n})}function wy(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Id(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Id(e)}function go(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function wI(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Uc=Math.random().toString(36).slice(2),$s="__reactFiber$"+Uc,Cd="__reactProps$"+Uc,xi="__reactContainer$"+Uc,D_="__reactEvents$"+Uc,gM="__reactListeners$"+Uc,yM="__reactHandles$"+Uc;function ma(n){var e=n[$s];if(e)return e;for(var t=n.parentNode;t;){if(e=t[xi]||t[$s]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=wI(n);n!==null;){if(t=n[$s])return t;n=wI(n)}return e}n=t,t=n.parentNode}return null}function fh(n){return n=n[$s]||n[xi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ol(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(X(33))}function Dp(n){return n[Cd]||null}var O_=[],Ml=-1;function zo(n){return{current:n}}function zt(n){0>Ml||(n.current=O_[Ml],O_[Ml]=null,Ml--)}function jt(n,e){Ml++,O_[Ml]=n.current,n.current=e}var Ro={},lr=zo(Ro),Er=zo(!1),Ca=Ro;function oc(n,e){var t=n.type.contextTypes;if(!t)return Ro;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function br(n){return n=n.childContextTypes,n!=null}function Am(){zt(Er),zt(lr)}function xI(n,e,t){if(lr.current!==Ro)throw Error(X(168));jt(lr,e),jt(Er,t)}function o1(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(X(108,tO(n)||"Unknown",s));return sn({},t,r)}function Cm(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ro,Ca=lr.current,jt(lr,n),jt(Er,Er.current),!0}function SI(n,e,t){var r=n.stateNode;if(!r)throw Error(X(169));t?(n=o1(n,e,Ca),r.__reactInternalMemoizedMergedChildContext=n,zt(Er),zt(lr),jt(lr,n)):zt(Er),jt(Er,t)}var ci=null,Op=!1,xy=!1;function a1(n){ci===null?ci=[n]:ci.push(n)}function _M(n){Op=!0,a1(n)}function qo(){if(!xy&&ci!==null){xy=!0;var n=0,e=bt;try{var t=ci;for(bt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ci=null,Op=!1}catch(s){throw ci!==null&&(ci=ci.slice(n+1)),PA(h0,qo),s}finally{bt=e,xy=!1}}return null}var Ll=[],jl=0,Rm=null,Nm=0,es=[],ts=0,Ra=null,di=1,hi="";function sa(n,e){Ll[jl++]=Nm,Ll[jl++]=Rm,Rm=n,Nm=e}function l1(n,e,t){es[ts++]=di,es[ts++]=hi,es[ts++]=Ra,Ra=n;var r=di;n=hi;var s=32-xs(r)-1;r&=~(1<<s),t+=1;var i=32-xs(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,di=1<<32-xs(e)+s|t<<s|r,hi=i+n}else di=1<<i|t<<s|r,hi=n}function x0(n){n.return!==null&&(sa(n,1),l1(n,1,0))}function S0(n){for(;n===Rm;)Rm=Ll[--jl],Ll[jl]=null,Nm=Ll[--jl],Ll[jl]=null;for(;n===Ra;)Ra=es[--ts],es[ts]=null,hi=es[--ts],es[ts]=null,di=es[--ts],es[ts]=null}var $r=null,Ur=null,Kt=!1,_s=null;function c1(n,e){var t=rs(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function II(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,$r=n,Ur=go(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,$r=n,Ur=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ra!==null?{id:di,overflow:hi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=rs(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,$r=n,Ur=null,!0):!1;default:return!1}}function M_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function L_(n){if(Kt){var e=Ur;if(e){var t=e;if(!II(n,e)){if(M_(n))throw Error(X(418));e=go(t.nextSibling);var r=$r;e&&II(n,e)?c1(r,t):(n.flags=n.flags&-4097|2,Kt=!1,$r=n)}}else{if(M_(n))throw Error(X(418));n.flags=n.flags&-4097|2,Kt=!1,$r=n}}}function EI(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;$r=n}function gf(n){if(n!==$r)return!1;if(!Kt)return EI(n),Kt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!k_(n.type,n.memoizedProps)),e&&(e=Ur)){if(M_(n))throw u1(),Error(X(418));for(;e;)c1(n,e),e=go(e.nextSibling)}if(EI(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(X(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ur=go(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ur=null}}else Ur=$r?go(n.stateNode.nextSibling):null;return!0}function u1(){for(var n=Ur;n;)n=go(n.nextSibling)}function ac(){Ur=$r=null,Kt=!1}function I0(n){_s===null?_s=[n]:_s.push(n)}var vM=ki.ReactCurrentBatchConfig;function gu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(X(309));var r=t.stateNode}if(!r)throw Error(X(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(X(284));if(!t._owner)throw Error(X(290,n))}return n}function yf(n,e){throw n=Object.prototype.toString.call(e),Error(X(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function bI(n){var e=n._init;return e(n._payload)}function d1(n){function e(I,x){if(n){var R=I.deletions;R===null?(I.deletions=[x],I.flags|=16):R.push(x)}}function t(I,x){if(!n)return null;for(;x!==null;)e(I,x),x=x.sibling;return null}function r(I,x){for(I=new Map;x!==null;)x.key!==null?I.set(x.key,x):I.set(x.index,x),x=x.sibling;return I}function s(I,x){return I=wo(I,x),I.index=0,I.sibling=null,I}function i(I,x,R){return I.index=R,n?(R=I.alternate,R!==null?(R=R.index,R<x?(I.flags|=2,x):R):(I.flags|=2,x)):(I.flags|=1048576,x)}function o(I){return n&&I.alternate===null&&(I.flags|=2),I}function a(I,x,R,P){return x===null||x.tag!==6?(x=Cy(R,I.mode,P),x.return=I,x):(x=s(x,R),x.return=I,x)}function l(I,x,R,P){var $=R.type;return $===Nl?h(I,x,R.props.children,P,R.key):x!==null&&(x.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Yi&&bI($)===x.type)?(P=s(x,R.props),P.ref=gu(I,x,R),P.return=I,P):(P=Jf(R.type,R.key,R.props,null,I.mode,P),P.ref=gu(I,x,R),P.return=I,P)}function u(I,x,R,P){return x===null||x.tag!==4||x.stateNode.containerInfo!==R.containerInfo||x.stateNode.implementation!==R.implementation?(x=Ry(R,I.mode,P),x.return=I,x):(x=s(x,R.children||[]),x.return=I,x)}function h(I,x,R,P,$){return x===null||x.tag!==7?(x=Sa(R,I.mode,P,$),x.return=I,x):(x=s(x,R),x.return=I,x)}function f(I,x,R){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Cy(""+x,I.mode,R),x.return=I,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case of:return R=Jf(x.type,x.key,x.props,null,I.mode,R),R.ref=gu(I,null,x),R.return=I,R;case Rl:return x=Ry(x,I.mode,R),x.return=I,x;case Yi:var P=x._init;return f(I,P(x._payload),R)}if(ku(x)||du(x))return x=Sa(x,I.mode,R,null),x.return=I,x;yf(I,x)}return null}function m(I,x,R,P){var $=x!==null?x.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return $!==null?null:a(I,x,""+R,P);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case of:return R.key===$?l(I,x,R,P):null;case Rl:return R.key===$?u(I,x,R,P):null;case Yi:return $=R._init,m(I,x,$(R._payload),P)}if(ku(R)||du(R))return $!==null?null:h(I,x,R,P,null);yf(I,R)}return null}function y(I,x,R,P,$){if(typeof P=="string"&&P!==""||typeof P=="number")return I=I.get(R)||null,a(x,I,""+P,$);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case of:return I=I.get(P.key===null?R:P.key)||null,l(x,I,P,$);case Rl:return I=I.get(P.key===null?R:P.key)||null,u(x,I,P,$);case Yi:var M=P._init;return y(I,x,R,M(P._payload),$)}if(ku(P)||du(P))return I=I.get(R)||null,h(x,I,P,$,null);yf(x,P)}return null}function _(I,x,R,P){for(var $=null,M=null,N=x,w=x=0,T=null;N!==null&&w<R.length;w++){N.index>w?(T=N,N=null):T=N.sibling;var A=m(I,N,R[w],P);if(A===null){N===null&&(N=T);break}n&&N&&A.alternate===null&&e(I,N),x=i(A,x,w),M===null?$=A:M.sibling=A,M=A,N=T}if(w===R.length)return t(I,N),Kt&&sa(I,w),$;if(N===null){for(;w<R.length;w++)N=f(I,R[w],P),N!==null&&(x=i(N,x,w),M===null?$=N:M.sibling=N,M=N);return Kt&&sa(I,w),$}for(N=r(I,N);w<R.length;w++)T=y(N,I,w,R[w],P),T!==null&&(n&&T.alternate!==null&&N.delete(T.key===null?w:T.key),x=i(T,x,w),M===null?$=T:M.sibling=T,M=T);return n&&N.forEach(function(b){return e(I,b)}),Kt&&sa(I,w),$}function E(I,x,R,P){var $=du(R);if(typeof $!="function")throw Error(X(150));if(R=$.call(R),R==null)throw Error(X(151));for(var M=$=null,N=x,w=x=0,T=null,A=R.next();N!==null&&!A.done;w++,A=R.next()){N.index>w?(T=N,N=null):T=N.sibling;var b=m(I,N,A.value,P);if(b===null){N===null&&(N=T);break}n&&N&&b.alternate===null&&e(I,N),x=i(b,x,w),M===null?$=b:M.sibling=b,M=b,N=T}if(A.done)return t(I,N),Kt&&sa(I,w),$;if(N===null){for(;!A.done;w++,A=R.next())A=f(I,A.value,P),A!==null&&(x=i(A,x,w),M===null?$=A:M.sibling=A,M=A);return Kt&&sa(I,w),$}for(N=r(I,N);!A.done;w++,A=R.next())A=y(N,I,w,A.value,P),A!==null&&(n&&A.alternate!==null&&N.delete(A.key===null?w:A.key),x=i(A,x,w),M===null?$=A:M.sibling=A,M=A);return n&&N.forEach(function(C){return e(I,C)}),Kt&&sa(I,w),$}function k(I,x,R,P){if(typeof R=="object"&&R!==null&&R.type===Nl&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case of:e:{for(var $=R.key,M=x;M!==null;){if(M.key===$){if($=R.type,$===Nl){if(M.tag===7){t(I,M.sibling),x=s(M,R.props.children),x.return=I,I=x;break e}}else if(M.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Yi&&bI($)===M.type){t(I,M.sibling),x=s(M,R.props),x.ref=gu(I,M,R),x.return=I,I=x;break e}t(I,M);break}else e(I,M);M=M.sibling}R.type===Nl?(x=Sa(R.props.children,I.mode,P,R.key),x.return=I,I=x):(P=Jf(R.type,R.key,R.props,null,I.mode,P),P.ref=gu(I,x,R),P.return=I,I=P)}return o(I);case Rl:e:{for(M=R.key;x!==null;){if(x.key===M)if(x.tag===4&&x.stateNode.containerInfo===R.containerInfo&&x.stateNode.implementation===R.implementation){t(I,x.sibling),x=s(x,R.children||[]),x.return=I,I=x;break e}else{t(I,x);break}else e(I,x);x=x.sibling}x=Ry(R,I.mode,P),x.return=I,I=x}return o(I);case Yi:return M=R._init,k(I,x,M(R._payload),P)}if(ku(R))return _(I,x,R,P);if(du(R))return E(I,x,R,P);yf(I,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,x!==null&&x.tag===6?(t(I,x.sibling),x=s(x,R),x.return=I,I=x):(t(I,x),x=Cy(R,I.mode,P),x.return=I,I=x),o(I)):t(I,x)}return k}var lc=d1(!0),h1=d1(!1),km=zo(null),Pm=null,Vl=null,E0=null;function b0(){E0=Vl=Pm=null}function T0(n){var e=km.current;zt(km),n._currentValue=e}function j_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Ql(n,e){Pm=n,E0=Vl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(wr=!0),n.firstContext=null)}function as(n){var e=n._currentValue;if(E0!==n)if(n={context:n,memoizedValue:e,next:null},Vl===null){if(Pm===null)throw Error(X(308));Vl=n,Pm.dependencies={lanes:0,firstContext:n}}else Vl=Vl.next=n;return e}var pa=null;function A0(n){pa===null?pa=[n]:pa.push(n)}function f1(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,A0(e)):(t.next=s.next,s.next=t),e.interleaved=t,Si(n,r)}function Si(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ji=!1;function C0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function m1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function _i(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function yo(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ft&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Si(n,t)}return s=r.interleaved,s===null?(e.next=e,A0(r)):(e.next=s.next,s.next=e),r.interleaved=e,Si(n,t)}function Wf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,f0(n,t)}}function TI(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Dm(n,e,t,r){var s=n.updateQueue;Ji=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var m=a.lane,y=a.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var _=n,E=a;switch(m=e,y=t,E.tag){case 1:if(_=E.payload,typeof _=="function"){f=_.call(y,f,m);break e}f=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=E.payload,m=typeof _=="function"?_.call(y,f,m):_,m==null)break e;f=sn({},f,m);break e;case 2:Ji=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,m=s.effects,m===null?s.effects=[a]:m.push(a))}else y={eventTime:y,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,o|=m;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;m=a,a=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ka|=o,n.lanes=o,n.memoizedState=f}}function AI(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(X(191,s));s.call(r)}}}var mh={},Qs=zo(mh),Rd=zo(mh),Nd=zo(mh);function ga(n){if(n===mh)throw Error(X(174));return n}function R0(n,e){switch(jt(Nd,e),jt(Rd,n),jt(Qs,mh),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:y_(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=y_(e,n)}zt(Qs),jt(Qs,e)}function cc(){zt(Qs),zt(Rd),zt(Nd)}function p1(n){ga(Nd.current);var e=ga(Qs.current),t=y_(e,n.type);e!==t&&(jt(Rd,n),jt(Qs,t))}function N0(n){Rd.current===n&&(zt(Qs),zt(Rd))}var tn=zo(0);function Om(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Sy=[];function k0(){for(var n=0;n<Sy.length;n++)Sy[n]._workInProgressVersionPrimary=null;Sy.length=0}var Gf=ki.ReactCurrentDispatcher,Iy=ki.ReactCurrentBatchConfig,Na=0,rn=null,An=null,Ln=null,Mm=!1,Hu=!1,kd=0,wM=0;function er(){throw Error(X(321))}function P0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!bs(n[t],e[t]))return!1;return!0}function D0(n,e,t,r,s,i){if(Na=i,rn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Gf.current=n===null||n.memoizedState===null?EM:bM,n=t(r,s),Hu){i=0;do{if(Hu=!1,kd=0,25<=i)throw Error(X(301));i+=1,Ln=An=null,e.updateQueue=null,Gf.current=TM,n=t(r,s)}while(Hu)}if(Gf.current=Lm,e=An!==null&&An.next!==null,Na=0,Ln=An=rn=null,Mm=!1,e)throw Error(X(300));return n}function O0(){var n=kd!==0;return kd=0,n}function Ls(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ln===null?rn.memoizedState=Ln=n:Ln=Ln.next=n,Ln}function ls(){if(An===null){var n=rn.alternate;n=n!==null?n.memoizedState:null}else n=An.next;var e=Ln===null?rn.memoizedState:Ln.next;if(e!==null)Ln=e,An=n;else{if(n===null)throw Error(X(310));An=n,n={memoizedState:An.memoizedState,baseState:An.baseState,baseQueue:An.baseQueue,queue:An.queue,next:null},Ln===null?rn.memoizedState=Ln=n:Ln=Ln.next=n}return Ln}function Pd(n,e){return typeof e=="function"?e(n):e}function Ey(n){var e=ls(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=n;var r=An,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((Na&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,rn.lanes|=h,ka|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,bs(r,e.memoizedState)||(wr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,rn.lanes|=i,ka|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function by(n){var e=ls(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);bs(i,e.memoizedState)||(wr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function g1(){}function y1(n,e){var t=rn,r=ls(),s=e(),i=!bs(r.memoizedState,s);if(i&&(r.memoizedState=s,wr=!0),r=r.queue,M0(w1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Ln!==null&&Ln.memoizedState.tag&1){if(t.flags|=2048,Dd(9,v1.bind(null,t,r,s,e),void 0,null),Fn===null)throw Error(X(349));Na&30||_1(t,e,s)}return s}function _1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=rn.updateQueue,e===null?(e={lastEffect:null,stores:null},rn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function v1(n,e,t,r){e.value=t,e.getSnapshot=r,x1(e)&&S1(n)}function w1(n,e,t){return t(function(){x1(e)&&S1(n)})}function x1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!bs(n,t)}catch{return!0}}function S1(n){var e=Si(n,1);e!==null&&Ss(e,n,1,-1)}function CI(n){var e=Ls();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Pd,lastRenderedState:n},e.queue=n,n=n.dispatch=IM.bind(null,rn,n),[e.memoizedState,n]}function Dd(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=rn.updateQueue,e===null?(e={lastEffect:null,stores:null},rn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function I1(){return ls().memoizedState}function Hf(n,e,t,r){var s=Ls();rn.flags|=n,s.memoizedState=Dd(1|e,t,void 0,r===void 0?null:r)}function Mp(n,e,t,r){var s=ls();r=r===void 0?null:r;var i=void 0;if(An!==null){var o=An.memoizedState;if(i=o.destroy,r!==null&&P0(r,o.deps)){s.memoizedState=Dd(e,t,i,r);return}}rn.flags|=n,s.memoizedState=Dd(1|e,t,i,r)}function RI(n,e){return Hf(8390656,8,n,e)}function M0(n,e){return Mp(2048,8,n,e)}function E1(n,e){return Mp(4,2,n,e)}function b1(n,e){return Mp(4,4,n,e)}function T1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function A1(n,e,t){return t=t!=null?t.concat([n]):null,Mp(4,4,T1.bind(null,e,n),t)}function L0(){}function C1(n,e){var t=ls();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&P0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function R1(n,e){var t=ls();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&P0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function N1(n,e,t){return Na&21?(bs(t,e)||(t=MA(),rn.lanes|=t,ka|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,wr=!0),n.memoizedState=t)}function xM(n,e){var t=bt;bt=t!==0&&4>t?t:4,n(!0);var r=Iy.transition;Iy.transition={};try{n(!1),e()}finally{bt=t,Iy.transition=r}}function k1(){return ls().memoizedState}function SM(n,e,t){var r=vo(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},P1(n))D1(e,t);else if(t=f1(n,e,t,r),t!==null){var s=mr();Ss(t,n,r,s),O1(t,e,r)}}function IM(n,e,t){var r=vo(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(P1(n))D1(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,bs(a,o)){var l=e.interleaved;l===null?(s.next=s,A0(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=f1(n,e,s,r),t!==null&&(s=mr(),Ss(t,n,r,s),O1(t,e,r))}}function P1(n){var e=n.alternate;return n===rn||e!==null&&e===rn}function D1(n,e){Hu=Mm=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function O1(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,f0(n,t)}}var Lm={readContext:as,useCallback:er,useContext:er,useEffect:er,useImperativeHandle:er,useInsertionEffect:er,useLayoutEffect:er,useMemo:er,useReducer:er,useRef:er,useState:er,useDebugValue:er,useDeferredValue:er,useTransition:er,useMutableSource:er,useSyncExternalStore:er,useId:er,unstable_isNewReconciler:!1},EM={readContext:as,useCallback:function(n,e){return Ls().memoizedState=[n,e===void 0?null:e],n},useContext:as,useEffect:RI,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Hf(4194308,4,T1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Hf(4194308,4,n,e)},useInsertionEffect:function(n,e){return Hf(4,2,n,e)},useMemo:function(n,e){var t=Ls();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ls();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=SM.bind(null,rn,n),[r.memoizedState,n]},useRef:function(n){var e=Ls();return n={current:n},e.memoizedState=n},useState:CI,useDebugValue:L0,useDeferredValue:function(n){return Ls().memoizedState=n},useTransition:function(){var n=CI(!1),e=n[0];return n=xM.bind(null,n[1]),Ls().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=rn,s=Ls();if(Kt){if(t===void 0)throw Error(X(407));t=t()}else{if(t=e(),Fn===null)throw Error(X(349));Na&30||_1(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,RI(w1.bind(null,r,i,n),[n]),r.flags|=2048,Dd(9,v1.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Ls(),e=Fn.identifierPrefix;if(Kt){var t=hi,r=di;t=(r&~(1<<32-xs(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=kd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=wM++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},bM={readContext:as,useCallback:C1,useContext:as,useEffect:M0,useImperativeHandle:A1,useInsertionEffect:E1,useLayoutEffect:b1,useMemo:R1,useReducer:Ey,useRef:I1,useState:function(){return Ey(Pd)},useDebugValue:L0,useDeferredValue:function(n){var e=ls();return N1(e,An.memoizedState,n)},useTransition:function(){var n=Ey(Pd)[0],e=ls().memoizedState;return[n,e]},useMutableSource:g1,useSyncExternalStore:y1,useId:k1,unstable_isNewReconciler:!1},TM={readContext:as,useCallback:C1,useContext:as,useEffect:M0,useImperativeHandle:A1,useInsertionEffect:E1,useLayoutEffect:b1,useMemo:R1,useReducer:by,useRef:I1,useState:function(){return by(Pd)},useDebugValue:L0,useDeferredValue:function(n){var e=ls();return An===null?e.memoizedState=n:N1(e,An.memoizedState,n)},useTransition:function(){var n=by(Pd)[0],e=ls().memoizedState;return[n,e]},useMutableSource:g1,useSyncExternalStore:y1,useId:k1,unstable_isNewReconciler:!1};function ps(n,e){if(n&&n.defaultProps){e=sn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function V_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:sn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Lp={isMounted:function(n){return(n=n._reactInternals)?Ja(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=mr(),s=vo(n),i=_i(r,s);i.payload=e,t!=null&&(i.callback=t),e=yo(n,i,s),e!==null&&(Ss(e,n,s,r),Wf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=mr(),s=vo(n),i=_i(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=yo(n,i,s),e!==null&&(Ss(e,n,s,r),Wf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=mr(),r=vo(n),s=_i(t,r);s.tag=2,e!=null&&(s.callback=e),e=yo(n,s,r),e!==null&&(Ss(e,n,r,t),Wf(e,n,r))}};function NI(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!bd(t,r)||!bd(s,i):!0}function M1(n,e,t){var r=!1,s=Ro,i=e.contextType;return typeof i=="object"&&i!==null?i=as(i):(s=br(e)?Ca:lr.current,r=e.contextTypes,i=(r=r!=null)?oc(n,s):Ro),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Lp,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function kI(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Lp.enqueueReplaceState(e,e.state,null)}function F_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},C0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=as(i):(i=br(e)?Ca:lr.current,s.context=oc(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(V_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Lp.enqueueReplaceState(s,s.state,null),Dm(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function uc(n,e){try{var t="",r=e;do t+=eO(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function Ty(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function U_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var AM=typeof WeakMap=="function"?WeakMap:Map;function L1(n,e,t){t=_i(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Vm||(Vm=!0,Y_=r),U_(n,e)},t}function j1(n,e,t){t=_i(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){U_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){U_(n,e),typeof r!="function"&&(_o===null?_o=new Set([this]):_o.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function PI(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new AM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=$M.bind(null,n,e,t),e.then(n,n))}function DI(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function OI(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=_i(-1,1),e.tag=2,yo(t,e,1))),t.lanes|=1),n)}var CM=ki.ReactCurrentOwner,wr=!1;function hr(n,e,t,r){e.child=n===null?h1(e,null,t,r):lc(e,n.child,t,r)}function MI(n,e,t,r,s){t=t.render;var i=e.ref;return Ql(e,s),r=D0(n,e,t,r,i,s),t=O0(),n!==null&&!wr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ii(n,e,s)):(Kt&&t&&x0(e),e.flags|=1,hr(n,e,r,s),e.child)}function LI(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!q0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,V1(n,e,i,r,s)):(n=Jf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:bd,t(o,r)&&n.ref===e.ref)return Ii(n,e,s)}return e.flags|=1,n=wo(i,r),n.ref=e.ref,n.return=e,e.child=n}function V1(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(bd(i,r)&&n.ref===e.ref)if(wr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(wr=!0);else return e.lanes=n.lanes,Ii(n,e,s)}return $_(n,e,t,r,s)}function F1(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},jt(Ul,Mr),Mr|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,jt(Ul,Mr),Mr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,jt(Ul,Mr),Mr|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,jt(Ul,Mr),Mr|=r;return hr(n,e,s,t),e.child}function U1(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function $_(n,e,t,r,s){var i=br(t)?Ca:lr.current;return i=oc(e,i),Ql(e,s),t=D0(n,e,t,r,i,s),r=O0(),n!==null&&!wr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ii(n,e,s)):(Kt&&r&&x0(e),e.flags|=1,hr(n,e,t,s),e.child)}function jI(n,e,t,r,s){if(br(t)){var i=!0;Cm(e)}else i=!1;if(Ql(e,s),e.stateNode===null)Qf(n,e),M1(e,t,r),F_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=as(u):(u=br(t)?Ca:lr.current,u=oc(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&kI(e,o,r,u),Ji=!1;var m=e.memoizedState;o.state=m,Dm(e,r,o,s),l=e.memoizedState,a!==r||m!==l||Er.current||Ji?(typeof h=="function"&&(V_(e,t,h,r),l=e.memoizedState),(a=Ji||NI(e,t,a,r,m,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,m1(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:ps(e.type,a),o.props=u,f=e.pendingProps,m=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=as(l):(l=br(t)?Ca:lr.current,l=oc(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||m!==l)&&kI(e,o,r,l),Ji=!1,m=e.memoizedState,o.state=m,Dm(e,r,o,s);var _=e.memoizedState;a!==f||m!==_||Er.current||Ji?(typeof y=="function"&&(V_(e,t,y,r),_=e.memoizedState),(u=Ji||NI(e,t,u,r,m,_,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,_,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,_,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=_),o.props=r,o.state=_,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),r=!1)}return B_(n,e,t,r,i,s)}function B_(n,e,t,r,s,i){U1(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&SI(e,t,!1),Ii(n,e,i);r=e.stateNode,CM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=lc(e,n.child,null,i),e.child=lc(e,null,a,i)):hr(n,e,a,i),e.memoizedState=r.state,s&&SI(e,t,!0),e.child}function $1(n){var e=n.stateNode;e.pendingContext?xI(n,e.pendingContext,e.pendingContext!==e.context):e.context&&xI(n,e.context,!1),R0(n,e.containerInfo)}function VI(n,e,t,r,s){return ac(),I0(s),e.flags|=256,hr(n,e,t,r),e.child}var z_={dehydrated:null,treeContext:null,retryLane:0};function q_(n){return{baseLanes:n,cachePool:null,transitions:null}}function B1(n,e,t){var r=e.pendingProps,s=tn.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),jt(tn,s&1),n===null)return L_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Fp(o,r,0,null),n=Sa(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=q_(t),e.memoizedState=z_,n):j0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return RM(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=wo(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=wo(a,i):(i=Sa(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?q_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=z_,r}return i=n.child,n=i.sibling,r=wo(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function j0(n,e){return e=Fp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function _f(n,e,t,r){return r!==null&&I0(r),lc(e,n.child,null,t),n=j0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function RM(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=Ty(Error(X(422))),_f(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Fp({mode:"visible",children:r.children},s,0,null),i=Sa(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&lc(e,n.child,null,o),e.child.memoizedState=q_(o),e.memoizedState=z_,i);if(!(e.mode&1))return _f(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(X(419)),r=Ty(i,r,void 0),_f(n,e,o,r)}if(a=(o&n.childLanes)!==0,wr||a){if(r=Fn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Si(n,s),Ss(r,n,s,-1))}return z0(),r=Ty(Error(X(421))),_f(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=BM.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Ur=go(s.nextSibling),$r=e,Kt=!0,_s=null,n!==null&&(es[ts++]=di,es[ts++]=hi,es[ts++]=Ra,di=n.id,hi=n.overflow,Ra=e),e=j0(e,r.children),e.flags|=4096,e)}function FI(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),j_(n.return,e,t)}function Ay(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function z1(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(hr(n,e,r.children,t),r=tn.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&FI(n,t,e);else if(n.tag===19)FI(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(jt(tn,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Om(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Ay(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Om(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Ay(e,!0,t,null,i);break;case"together":Ay(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Qf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ii(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ka|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(X(153));if(e.child!==null){for(n=e.child,t=wo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=wo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function NM(n,e,t){switch(e.tag){case 3:$1(e),ac();break;case 5:p1(e);break;case 1:br(e.type)&&Cm(e);break;case 4:R0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;jt(km,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(jt(tn,tn.current&1),e.flags|=128,null):t&e.child.childLanes?B1(n,e,t):(jt(tn,tn.current&1),n=Ii(n,e,t),n!==null?n.sibling:null);jt(tn,tn.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return z1(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),jt(tn,tn.current),r)break;return null;case 22:case 23:return e.lanes=0,F1(n,e,t)}return Ii(n,e,t)}var q1,W_,W1,G1;q1=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};W_=function(){};W1=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,ga(Qs.current);var i=null;switch(t){case"input":s=f_(n,s),r=f_(n,r),i=[];break;case"select":s=sn({},s,{value:void 0}),r=sn({},r,{value:void 0}),i=[];break;case"textarea":s=g_(n,s),r=g_(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Tm)}__(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(_d.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(_d.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&$t("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};G1=function(n,e,t,r){t!==r&&(e.flags|=4)};function yu(n,e){if(!Kt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function tr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function kM(n,e,t){var r=e.pendingProps;switch(S0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tr(e),null;case 1:return br(e.type)&&Am(),tr(e),null;case 3:return r=e.stateNode,cc(),zt(Er),zt(lr),k0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(gf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,_s!==null&&(Z_(_s),_s=null))),W_(n,e),tr(e),null;case 5:N0(e);var s=ga(Nd.current);if(t=e.type,n!==null&&e.stateNode!=null)W1(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(X(166));return tr(e),null}if(n=ga(Qs.current),gf(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[$s]=e,r[Cd]=i,n=(e.mode&1)!==0,t){case"dialog":$t("cancel",r),$t("close",r);break;case"iframe":case"object":case"embed":$t("load",r);break;case"video":case"audio":for(s=0;s<Du.length;s++)$t(Du[s],r);break;case"source":$t("error",r);break;case"img":case"image":case"link":$t("error",r),$t("load",r);break;case"details":$t("toggle",r);break;case"input":QS(r,i),$t("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},$t("invalid",r);break;case"textarea":YS(r,i),$t("invalid",r)}__(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&pf(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&pf(r.textContent,a,n),s=["children",""+a]):_d.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&$t("scroll",r)}switch(t){case"input":af(r),KS(r,i,!0);break;case"textarea":af(r),JS(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Tm)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=wA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[$s]=e,n[Cd]=r,q1(n,e,!1,!1),e.stateNode=n;e:{switch(o=v_(t,r),t){case"dialog":$t("cancel",n),$t("close",n),s=r;break;case"iframe":case"object":case"embed":$t("load",n),s=r;break;case"video":case"audio":for(s=0;s<Du.length;s++)$t(Du[s],n);s=r;break;case"source":$t("error",n),s=r;break;case"img":case"image":case"link":$t("error",n),$t("load",n),s=r;break;case"details":$t("toggle",n),s=r;break;case"input":QS(n,r),s=f_(n,r),$t("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=sn({},r,{value:void 0}),$t("invalid",n);break;case"textarea":YS(n,r),s=g_(n,r),$t("invalid",n);break;default:s=r}__(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?IA(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&xA(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&vd(n,l):typeof l=="number"&&vd(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(_d.hasOwnProperty(i)?l!=null&&i==="onScroll"&&$t("scroll",n):l!=null&&a0(n,i,l,o))}switch(t){case"input":af(n),KS(n,r,!1);break;case"textarea":af(n),JS(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Co(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?ql(n,!!r.multiple,i,!1):r.defaultValue!=null&&ql(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Tm)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return tr(e),null;case 6:if(n&&e.stateNode!=null)G1(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(X(166));if(t=ga(Nd.current),ga(Qs.current),gf(e)){if(r=e.stateNode,t=e.memoizedProps,r[$s]=e,(i=r.nodeValue!==t)&&(n=$r,n!==null))switch(n.tag){case 3:pf(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&pf(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[$s]=e,e.stateNode=r}return tr(e),null;case 13:if(zt(tn),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Kt&&Ur!==null&&e.mode&1&&!(e.flags&128))u1(),ac(),e.flags|=98560,i=!1;else if(i=gf(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(X(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(X(317));i[$s]=e}else ac(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;tr(e),i=!1}else _s!==null&&(Z_(_s),_s=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||tn.current&1?Rn===0&&(Rn=3):z0())),e.updateQueue!==null&&(e.flags|=4),tr(e),null);case 4:return cc(),W_(n,e),n===null&&Td(e.stateNode.containerInfo),tr(e),null;case 10:return T0(e.type._context),tr(e),null;case 17:return br(e.type)&&Am(),tr(e),null;case 19:if(zt(tn),i=e.memoizedState,i===null)return tr(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)yu(i,!1);else{if(Rn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Om(n),o!==null){for(e.flags|=128,yu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return jt(tn,tn.current&1|2),e.child}n=n.sibling}i.tail!==null&&yn()>dc&&(e.flags|=128,r=!0,yu(i,!1),e.lanes=4194304)}else{if(!r)if(n=Om(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),yu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Kt)return tr(e),null}else 2*yn()-i.renderingStartTime>dc&&t!==1073741824&&(e.flags|=128,r=!0,yu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=yn(),e.sibling=null,t=tn.current,jt(tn,r?t&1|2:t&1),e):(tr(e),null);case 22:case 23:return B0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Mr&1073741824&&(tr(e),e.subtreeFlags&6&&(e.flags|=8192)):tr(e),null;case 24:return null;case 25:return null}throw Error(X(156,e.tag))}function PM(n,e){switch(S0(e),e.tag){case 1:return br(e.type)&&Am(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return cc(),zt(Er),zt(lr),k0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return N0(e),null;case 13:if(zt(tn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(X(340));ac()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return zt(tn),null;case 4:return cc(),null;case 10:return T0(e.type._context),null;case 22:case 23:return B0(),null;case 24:return null;default:return null}}var vf=!1,sr=!1,DM=typeof WeakSet=="function"?WeakSet:Set,ve=null;function Fl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){dn(n,e,r)}else t.current=null}function G_(n,e,t){try{t()}catch(r){dn(n,e,r)}}var UI=!1;function OM(n,e){if(R_=Im,n=JA(),w0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,m=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)m=f,f=y;for(;;){if(f===n)break t;if(m===t&&++u===s&&(a=o),m===i&&++h===r&&(l=o),(y=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=y}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(N_={focusedElem:n,selectionRange:t},Im=!1,ve=e;ve!==null;)if(e=ve,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ve=n;else for(;ve!==null;){e=ve;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var E=_.memoizedProps,k=_.memoizedState,I=e.stateNode,x=I.getSnapshotBeforeUpdate(e.elementType===e.type?E:ps(e.type,E),k);I.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(P){dn(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,ve=n;break}ve=e.return}return _=UI,UI=!1,_}function Qu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&G_(e,t,i)}s=s.next}while(s!==r)}}function jp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function H_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function H1(n){var e=n.alternate;e!==null&&(n.alternate=null,H1(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[$s],delete e[Cd],delete e[D_],delete e[gM],delete e[yM])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Q1(n){return n.tag===5||n.tag===3||n.tag===4}function $I(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Q1(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Q_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Tm));else if(r!==4&&(n=n.child,n!==null))for(Q_(n,e,t),n=n.sibling;n!==null;)Q_(n,e,t),n=n.sibling}function K_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(K_(n,e,t),n=n.sibling;n!==null;)K_(n,e,t),n=n.sibling}var Gn=null,gs=!1;function Wi(n,e,t){for(t=t.child;t!==null;)K1(n,e,t),t=t.sibling}function K1(n,e,t){if(Hs&&typeof Hs.onCommitFiberUnmount=="function")try{Hs.onCommitFiberUnmount(Rp,t)}catch{}switch(t.tag){case 5:sr||Fl(t,e);case 6:var r=Gn,s=gs;Gn=null,Wi(n,e,t),Gn=r,gs=s,Gn!==null&&(gs?(n=Gn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Gn.removeChild(t.stateNode));break;case 18:Gn!==null&&(gs?(n=Gn,t=t.stateNode,n.nodeType===8?wy(n.parentNode,t):n.nodeType===1&&wy(n,t),Id(n)):wy(Gn,t.stateNode));break;case 4:r=Gn,s=gs,Gn=t.stateNode.containerInfo,gs=!0,Wi(n,e,t),Gn=r,gs=s;break;case 0:case 11:case 14:case 15:if(!sr&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&G_(t,e,o),s=s.next}while(s!==r)}Wi(n,e,t);break;case 1:if(!sr&&(Fl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){dn(t,e,a)}Wi(n,e,t);break;case 21:Wi(n,e,t);break;case 22:t.mode&1?(sr=(r=sr)||t.memoizedState!==null,Wi(n,e,t),sr=r):Wi(n,e,t);break;default:Wi(n,e,t)}}function BI(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new DM),e.forEach(function(r){var s=zM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function ms(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Gn=a.stateNode,gs=!1;break e;case 3:Gn=a.stateNode.containerInfo,gs=!0;break e;case 4:Gn=a.stateNode.containerInfo,gs=!0;break e}a=a.return}if(Gn===null)throw Error(X(160));K1(i,o,s),Gn=null,gs=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){dn(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Y1(e,n),e=e.sibling}function Y1(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ms(e,n),Os(n),r&4){try{Qu(3,n,n.return),jp(3,n)}catch(E){dn(n,n.return,E)}try{Qu(5,n,n.return)}catch(E){dn(n,n.return,E)}}break;case 1:ms(e,n),Os(n),r&512&&t!==null&&Fl(t,t.return);break;case 5:if(ms(e,n),Os(n),r&512&&t!==null&&Fl(t,t.return),n.flags&32){var s=n.stateNode;try{vd(s,"")}catch(E){dn(n,n.return,E)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&_A(s,i),v_(a,o);var u=v_(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?IA(s,f):h==="dangerouslySetInnerHTML"?xA(s,f):h==="children"?vd(s,f):a0(s,h,f,u)}switch(a){case"input":m_(s,i);break;case"textarea":vA(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?ql(s,!!i.multiple,y,!1):m!==!!i.multiple&&(i.defaultValue!=null?ql(s,!!i.multiple,i.defaultValue,!0):ql(s,!!i.multiple,i.multiple?[]:"",!1))}s[Cd]=i}catch(E){dn(n,n.return,E)}}break;case 6:if(ms(e,n),Os(n),r&4){if(n.stateNode===null)throw Error(X(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(E){dn(n,n.return,E)}}break;case 3:if(ms(e,n),Os(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Id(e.containerInfo)}catch(E){dn(n,n.return,E)}break;case 4:ms(e,n),Os(n);break;case 13:ms(e,n),Os(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(U0=yn())),r&4&&BI(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(sr=(u=sr)||h,ms(e,n),sr=u):ms(e,n),Os(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(ve=n,h=n.child;h!==null;){for(f=ve=h;ve!==null;){switch(m=ve,y=m.child,m.tag){case 0:case 11:case 14:case 15:Qu(4,m,m.return);break;case 1:Fl(m,m.return);var _=m.stateNode;if(typeof _.componentWillUnmount=="function"){r=m,t=m.return;try{e=r,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(E){dn(r,t,E)}}break;case 5:Fl(m,m.return);break;case 22:if(m.memoizedState!==null){qI(f);continue}}y!==null?(y.return=m,ve=y):qI(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=SA("display",o))}catch(E){dn(n,n.return,E)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(E){dn(n,n.return,E)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ms(e,n),Os(n),r&4&&BI(n);break;case 21:break;default:ms(e,n),Os(n)}}function Os(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Q1(t)){var r=t;break e}t=t.return}throw Error(X(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(vd(s,""),r.flags&=-33);var i=$I(n);K_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=$I(n);Q_(n,a,o);break;default:throw Error(X(161))}}catch(l){dn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function MM(n,e,t){ve=n,J1(n)}function J1(n,e,t){for(var r=(n.mode&1)!==0;ve!==null;){var s=ve,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||vf;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||sr;a=vf;var u=sr;if(vf=o,(sr=l)&&!u)for(ve=s;ve!==null;)o=ve,l=o.child,o.tag===22&&o.memoizedState!==null?WI(s):l!==null?(l.return=o,ve=l):WI(s);for(;i!==null;)ve=i,J1(i),i=i.sibling;ve=s,vf=a,sr=u}zI(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ve=i):zI(n)}}function zI(n){for(;ve!==null;){var e=ve;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:sr||jp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!sr)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:ps(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&AI(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}AI(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Id(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}sr||e.flags&512&&H_(e)}catch(m){dn(e,e.return,m)}}if(e===n){ve=null;break}if(t=e.sibling,t!==null){t.return=e.return,ve=t;break}ve=e.return}}function qI(n){for(;ve!==null;){var e=ve;if(e===n){ve=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ve=t;break}ve=e.return}}function WI(n){for(;ve!==null;){var e=ve;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{jp(4,e)}catch(l){dn(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){dn(e,s,l)}}var i=e.return;try{H_(e)}catch(l){dn(e,i,l)}break;case 5:var o=e.return;try{H_(e)}catch(l){dn(e,o,l)}}}catch(l){dn(e,e.return,l)}if(e===n){ve=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ve=a;break}ve=e.return}}var LM=Math.ceil,jm=ki.ReactCurrentDispatcher,V0=ki.ReactCurrentOwner,is=ki.ReactCurrentBatchConfig,ft=0,Fn=null,bn=null,Kn=0,Mr=0,Ul=zo(0),Rn=0,Od=null,ka=0,Vp=0,F0=0,Ku=null,vr=null,U0=0,dc=1/0,li=null,Vm=!1,Y_=null,_o=null,wf=!1,oo=null,Fm=0,Yu=0,J_=null,Kf=-1,Yf=0;function mr(){return ft&6?yn():Kf!==-1?Kf:Kf=yn()}function vo(n){return n.mode&1?ft&2&&Kn!==0?Kn&-Kn:vM.transition!==null?(Yf===0&&(Yf=MA()),Yf):(n=bt,n!==0||(n=window.event,n=n===void 0?16:BA(n.type)),n):1}function Ss(n,e,t,r){if(50<Yu)throw Yu=0,J_=null,Error(X(185));dh(n,t,r),(!(ft&2)||n!==Fn)&&(n===Fn&&(!(ft&2)&&(Vp|=t),Rn===4&&Zi(n,Kn)),Tr(n,r),t===1&&ft===0&&!(e.mode&1)&&(dc=yn()+500,Op&&qo()))}function Tr(n,e){var t=n.callbackNode;vO(n,e);var r=Sm(n,n===Fn?Kn:0);if(r===0)t!==null&&eI(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&eI(t),e===1)n.tag===0?_M(GI.bind(null,n)):a1(GI.bind(null,n)),mM(function(){!(ft&6)&&qo()}),t=null;else{switch(LA(r)){case 1:t=h0;break;case 4:t=DA;break;case 16:t=xm;break;case 536870912:t=OA;break;default:t=xm}t=iC(t,X1.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function X1(n,e){if(Kf=-1,Yf=0,ft&6)throw Error(X(327));var t=n.callbackNode;if(Kl()&&n.callbackNode!==t)return null;var r=Sm(n,n===Fn?Kn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Um(n,r);else{e=r;var s=ft;ft|=2;var i=eC();(Fn!==n||Kn!==e)&&(li=null,dc=yn()+500,xa(n,e));do try{FM();break}catch(a){Z1(n,a)}while(1);b0(),jm.current=i,ft=s,bn!==null?e=0:(Fn=null,Kn=0,e=Rn)}if(e!==0){if(e===2&&(s=E_(n),s!==0&&(r=s,e=X_(n,s))),e===1)throw t=Od,xa(n,0),Zi(n,r),Tr(n,yn()),t;if(e===6)Zi(n,r);else{if(s=n.current.alternate,!(r&30)&&!jM(s)&&(e=Um(n,r),e===2&&(i=E_(n),i!==0&&(r=i,e=X_(n,i))),e===1))throw t=Od,xa(n,0),Zi(n,r),Tr(n,yn()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(X(345));case 2:ia(n,vr,li);break;case 3:if(Zi(n,r),(r&130023424)===r&&(e=U0+500-yn(),10<e)){if(Sm(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){mr(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=P_(ia.bind(null,n,vr,li),e);break}ia(n,vr,li);break;case 4:if(Zi(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-xs(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=yn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*LM(r/1960))-r,10<r){n.timeoutHandle=P_(ia.bind(null,n,vr,li),r);break}ia(n,vr,li);break;case 5:ia(n,vr,li);break;default:throw Error(X(329))}}}return Tr(n,yn()),n.callbackNode===t?X1.bind(null,n):null}function X_(n,e){var t=Ku;return n.current.memoizedState.isDehydrated&&(xa(n,e).flags|=256),n=Um(n,e),n!==2&&(e=vr,vr=t,e!==null&&Z_(e)),n}function Z_(n){vr===null?vr=n:vr.push.apply(vr,n)}function jM(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!bs(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Zi(n,e){for(e&=~F0,e&=~Vp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-xs(e),r=1<<t;n[t]=-1,e&=~r}}function GI(n){if(ft&6)throw Error(X(327));Kl();var e=Sm(n,0);if(!(e&1))return Tr(n,yn()),null;var t=Um(n,e);if(n.tag!==0&&t===2){var r=E_(n);r!==0&&(e=r,t=X_(n,r))}if(t===1)throw t=Od,xa(n,0),Zi(n,e),Tr(n,yn()),t;if(t===6)throw Error(X(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ia(n,vr,li),Tr(n,yn()),null}function $0(n,e){var t=ft;ft|=1;try{return n(e)}finally{ft=t,ft===0&&(dc=yn()+500,Op&&qo())}}function Pa(n){oo!==null&&oo.tag===0&&!(ft&6)&&Kl();var e=ft;ft|=1;var t=is.transition,r=bt;try{if(is.transition=null,bt=1,n)return n()}finally{bt=r,is.transition=t,ft=e,!(ft&6)&&qo()}}function B0(){Mr=Ul.current,zt(Ul)}function xa(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,fM(t)),bn!==null)for(t=bn.return;t!==null;){var r=t;switch(S0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Am();break;case 3:cc(),zt(Er),zt(lr),k0();break;case 5:N0(r);break;case 4:cc();break;case 13:zt(tn);break;case 19:zt(tn);break;case 10:T0(r.type._context);break;case 22:case 23:B0()}t=t.return}if(Fn=n,bn=n=wo(n.current,null),Kn=Mr=e,Rn=0,Od=null,F0=Vp=ka=0,vr=Ku=null,pa!==null){for(e=0;e<pa.length;e++)if(t=pa[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}pa=null}return n}function Z1(n,e){do{var t=bn;try{if(b0(),Gf.current=Lm,Mm){for(var r=rn.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Mm=!1}if(Na=0,Ln=An=rn=null,Hu=!1,kd=0,V0.current=null,t===null||t.return===null){Rn=1,Od=e,bn=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Kn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=DI(o);if(y!==null){y.flags&=-257,OI(y,o,a,i,e),y.mode&1&&PI(i,u,e),e=y,l=u;var _=e.updateQueue;if(_===null){var E=new Set;E.add(l),e.updateQueue=E}else _.add(l);break e}else{if(!(e&1)){PI(i,u,e),z0();break e}l=Error(X(426))}}else if(Kt&&a.mode&1){var k=DI(o);if(k!==null){!(k.flags&65536)&&(k.flags|=256),OI(k,o,a,i,e),I0(uc(l,a));break e}}i=l=uc(l,a),Rn!==4&&(Rn=2),Ku===null?Ku=[i]:Ku.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var I=L1(i,l,e);TI(i,I);break e;case 1:a=l;var x=i.type,R=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(_o===null||!_o.has(R)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=j1(i,a,e);TI(i,P);break e}}i=i.return}while(i!==null)}nC(t)}catch($){e=$,bn===t&&t!==null&&(bn=t=t.return);continue}break}while(1)}function eC(){var n=jm.current;return jm.current=Lm,n===null?Lm:n}function z0(){(Rn===0||Rn===3||Rn===2)&&(Rn=4),Fn===null||!(ka&268435455)&&!(Vp&268435455)||Zi(Fn,Kn)}function Um(n,e){var t=ft;ft|=2;var r=eC();(Fn!==n||Kn!==e)&&(li=null,xa(n,e));do try{VM();break}catch(s){Z1(n,s)}while(1);if(b0(),ft=t,jm.current=r,bn!==null)throw Error(X(261));return Fn=null,Kn=0,Rn}function VM(){for(;bn!==null;)tC(bn)}function FM(){for(;bn!==null&&!uO();)tC(bn)}function tC(n){var e=sC(n.alternate,n,Mr);n.memoizedProps=n.pendingProps,e===null?nC(n):bn=e,V0.current=null}function nC(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=PM(t,e),t!==null){t.flags&=32767,bn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Rn=6,bn=null;return}}else if(t=kM(t,e,Mr),t!==null){bn=t;return}if(e=e.sibling,e!==null){bn=e;return}bn=e=n}while(e!==null);Rn===0&&(Rn=5)}function ia(n,e,t){var r=bt,s=is.transition;try{is.transition=null,bt=1,UM(n,e,t,r)}finally{is.transition=s,bt=r}return null}function UM(n,e,t,r){do Kl();while(oo!==null);if(ft&6)throw Error(X(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(X(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(wO(n,i),n===Fn&&(bn=Fn=null,Kn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||wf||(wf=!0,iC(xm,function(){return Kl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=is.transition,is.transition=null;var o=bt;bt=1;var a=ft;ft|=4,V0.current=null,OM(n,t),Y1(t,n),oM(N_),Im=!!R_,N_=R_=null,n.current=t,MM(t),dO(),ft=a,bt=o,is.transition=i}else n.current=t;if(wf&&(wf=!1,oo=n,Fm=s),i=n.pendingLanes,i===0&&(_o=null),mO(t.stateNode),Tr(n,yn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Vm)throw Vm=!1,n=Y_,Y_=null,n;return Fm&1&&n.tag!==0&&Kl(),i=n.pendingLanes,i&1?n===J_?Yu++:(Yu=0,J_=n):Yu=0,qo(),null}function Kl(){if(oo!==null){var n=LA(Fm),e=is.transition,t=bt;try{if(is.transition=null,bt=16>n?16:n,oo===null)var r=!1;else{if(n=oo,oo=null,Fm=0,ft&6)throw Error(X(331));var s=ft;for(ft|=4,ve=n.current;ve!==null;){var i=ve,o=i.child;if(ve.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(ve=u;ve!==null;){var h=ve;switch(h.tag){case 0:case 11:case 15:Qu(8,h,i)}var f=h.child;if(f!==null)f.return=h,ve=f;else for(;ve!==null;){h=ve;var m=h.sibling,y=h.return;if(H1(h),h===u){ve=null;break}if(m!==null){m.return=y,ve=m;break}ve=y}}}var _=i.alternate;if(_!==null){var E=_.child;if(E!==null){_.child=null;do{var k=E.sibling;E.sibling=null,E=k}while(E!==null)}}ve=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ve=o;else e:for(;ve!==null;){if(i=ve,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Qu(9,i,i.return)}var I=i.sibling;if(I!==null){I.return=i.return,ve=I;break e}ve=i.return}}var x=n.current;for(ve=x;ve!==null;){o=ve;var R=o.child;if(o.subtreeFlags&2064&&R!==null)R.return=o,ve=R;else e:for(o=x;ve!==null;){if(a=ve,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:jp(9,a)}}catch($){dn(a,a.return,$)}if(a===o){ve=null;break e}var P=a.sibling;if(P!==null){P.return=a.return,ve=P;break e}ve=a.return}}if(ft=s,qo(),Hs&&typeof Hs.onPostCommitFiberRoot=="function")try{Hs.onPostCommitFiberRoot(Rp,n)}catch{}r=!0}return r}finally{bt=t,is.transition=e}}return!1}function HI(n,e,t){e=uc(t,e),e=L1(n,e,1),n=yo(n,e,1),e=mr(),n!==null&&(dh(n,1,e),Tr(n,e))}function dn(n,e,t){if(n.tag===3)HI(n,n,t);else for(;e!==null;){if(e.tag===3){HI(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(_o===null||!_o.has(r))){n=uc(t,n),n=j1(e,n,1),e=yo(e,n,1),n=mr(),e!==null&&(dh(e,1,n),Tr(e,n));break}}e=e.return}}function $M(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=mr(),n.pingedLanes|=n.suspendedLanes&t,Fn===n&&(Kn&t)===t&&(Rn===4||Rn===3&&(Kn&130023424)===Kn&&500>yn()-U0?xa(n,0):F0|=t),Tr(n,e)}function rC(n,e){e===0&&(n.mode&1?(e=uf,uf<<=1,!(uf&130023424)&&(uf=4194304)):e=1);var t=mr();n=Si(n,e),n!==null&&(dh(n,e,t),Tr(n,t))}function BM(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),rC(n,t)}function zM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(X(314))}r!==null&&r.delete(e),rC(n,t)}var sC;sC=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Er.current)wr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return wr=!1,NM(n,e,t);wr=!!(n.flags&131072)}else wr=!1,Kt&&e.flags&1048576&&l1(e,Nm,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Qf(n,e),n=e.pendingProps;var s=oc(e,lr.current);Ql(e,t),s=D0(null,e,r,n,s,t);var i=O0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,br(r)?(i=!0,Cm(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,C0(e),s.updater=Lp,e.stateNode=s,s._reactInternals=e,F_(e,r,n,t),e=B_(null,e,r,!0,i,t)):(e.tag=0,Kt&&i&&x0(e),hr(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Qf(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=WM(r),n=ps(r,n),s){case 0:e=$_(null,e,r,n,t);break e;case 1:e=jI(null,e,r,n,t);break e;case 11:e=MI(null,e,r,n,t);break e;case 14:e=LI(null,e,r,ps(r.type,n),t);break e}throw Error(X(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ps(r,s),$_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ps(r,s),jI(n,e,r,s,t);case 3:e:{if($1(e),n===null)throw Error(X(387));r=e.pendingProps,i=e.memoizedState,s=i.element,m1(n,e),Dm(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=uc(Error(X(423)),e),e=VI(n,e,r,t,s);break e}else if(r!==s){s=uc(Error(X(424)),e),e=VI(n,e,r,t,s);break e}else for(Ur=go(e.stateNode.containerInfo.firstChild),$r=e,Kt=!0,_s=null,t=h1(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ac(),r===s){e=Ii(n,e,t);break e}hr(n,e,r,t)}e=e.child}return e;case 5:return p1(e),n===null&&L_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,k_(r,s)?o=null:i!==null&&k_(r,i)&&(e.flags|=32),U1(n,e),hr(n,e,o,t),e.child;case 6:return n===null&&L_(e),null;case 13:return B1(n,e,t);case 4:return R0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=lc(e,null,r,t):hr(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ps(r,s),MI(n,e,r,s,t);case 7:return hr(n,e,e.pendingProps,t),e.child;case 8:return hr(n,e,e.pendingProps.children,t),e.child;case 12:return hr(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,jt(km,r._currentValue),r._currentValue=o,i!==null)if(bs(i.value,o)){if(i.children===s.children&&!Er.current){e=Ii(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=_i(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),j_(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(X(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),j_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}hr(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ql(e,t),s=as(s),r=r(s),e.flags|=1,hr(n,e,r,t),e.child;case 14:return r=e.type,s=ps(r,e.pendingProps),s=ps(r.type,s),LI(n,e,r,s,t);case 15:return V1(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ps(r,s),Qf(n,e),e.tag=1,br(r)?(n=!0,Cm(e)):n=!1,Ql(e,t),M1(e,r,s),F_(e,r,s,t),B_(null,e,r,!0,n,t);case 19:return z1(n,e,t);case 22:return F1(n,e,t)}throw Error(X(156,e.tag))};function iC(n,e){return PA(n,e)}function qM(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rs(n,e,t,r){return new qM(n,e,t,r)}function q0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function WM(n){if(typeof n=="function")return q0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===c0)return 11;if(n===u0)return 14}return 2}function wo(n,e){var t=n.alternate;return t===null?(t=rs(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Jf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")q0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Nl:return Sa(t.children,s,i,e);case l0:o=8,s|=8;break;case c_:return n=rs(12,t,e,s|2),n.elementType=c_,n.lanes=i,n;case u_:return n=rs(13,t,e,s),n.elementType=u_,n.lanes=i,n;case d_:return n=rs(19,t,e,s),n.elementType=d_,n.lanes=i,n;case pA:return Fp(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case fA:o=10;break e;case mA:o=9;break e;case c0:o=11;break e;case u0:o=14;break e;case Yi:o=16,r=null;break e}throw Error(X(130,n==null?n:typeof n,""))}return e=rs(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Sa(n,e,t,r){return n=rs(7,n,r,e),n.lanes=t,n}function Fp(n,e,t,r){return n=rs(22,n,r,e),n.elementType=pA,n.lanes=t,n.stateNode={isHidden:!1},n}function Cy(n,e,t){return n=rs(6,n,null,e),n.lanes=t,n}function Ry(n,e,t){return e=rs(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function GM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cy(0),this.expirationTimes=cy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cy(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function W0(n,e,t,r,s,i,o,a,l){return n=new GM(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=rs(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},C0(i),n}function HM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rl,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function oC(n){if(!n)return Ro;n=n._reactInternals;e:{if(Ja(n)!==n||n.tag!==1)throw Error(X(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(br(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(X(171))}if(n.tag===1){var t=n.type;if(br(t))return o1(n,t,e)}return e}function aC(n,e,t,r,s,i,o,a,l){return n=W0(t,r,!0,n,s,i,o,a,l),n.context=oC(null),t=n.current,r=mr(),s=vo(t),i=_i(r,s),i.callback=e??null,yo(t,i,s),n.current.lanes=s,dh(n,s,r),Tr(n,r),n}function Up(n,e,t,r){var s=e.current,i=mr(),o=vo(s);return t=oC(t),e.context===null?e.context=t:e.pendingContext=t,e=_i(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=yo(s,e,o),n!==null&&(Ss(n,s,o,i),Wf(n,s,o)),o}function $m(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function QI(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function G0(n,e){QI(n,e),(n=n.alternate)&&QI(n,e)}function QM(){return null}var lC=typeof reportError=="function"?reportError:function(n){console.error(n)};function H0(n){this._internalRoot=n}$p.prototype.render=H0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(X(409));Up(n,e,null,null)};$p.prototype.unmount=H0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Pa(function(){Up(null,n,null,null)}),e[xi]=null}};function $p(n){this._internalRoot=n}$p.prototype.unstable_scheduleHydration=function(n){if(n){var e=FA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Xi.length&&e!==0&&e<Xi[t].priority;t++);Xi.splice(t,0,n),t===0&&$A(n)}};function Q0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Bp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function KI(){}function KM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=$m(o);i.call(u)}}var o=aC(e,r,n,0,null,!1,!1,"",KI);return n._reactRootContainer=o,n[xi]=o.current,Td(n.nodeType===8?n.parentNode:n),Pa(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=$m(l);a.call(u)}}var l=W0(n,0,!1,null,null,!1,!1,"",KI);return n._reactRootContainer=l,n[xi]=l.current,Td(n.nodeType===8?n.parentNode:n),Pa(function(){Up(e,l,t,r)}),l}function zp(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=$m(o);a.call(l)}}Up(e,o,n,s)}else o=KM(t,e,n,s,r);return $m(o)}jA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Pu(e.pendingLanes);t!==0&&(f0(e,t|1),Tr(e,yn()),!(ft&6)&&(dc=yn()+500,qo()))}break;case 13:Pa(function(){var r=Si(n,1);if(r!==null){var s=mr();Ss(r,n,1,s)}}),G0(n,1)}};m0=function(n){if(n.tag===13){var e=Si(n,134217728);if(e!==null){var t=mr();Ss(e,n,134217728,t)}G0(n,134217728)}};VA=function(n){if(n.tag===13){var e=vo(n),t=Si(n,e);if(t!==null){var r=mr();Ss(t,n,e,r)}G0(n,e)}};FA=function(){return bt};UA=function(n,e){var t=bt;try{return bt=n,e()}finally{bt=t}};x_=function(n,e,t){switch(e){case"input":if(m_(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Dp(r);if(!s)throw Error(X(90));yA(r),m_(r,s)}}}break;case"textarea":vA(n,t);break;case"select":e=t.value,e!=null&&ql(n,!!t.multiple,e,!1)}};TA=$0;AA=Pa;var YM={usingClientEntryPoint:!1,Events:[fh,Ol,Dp,EA,bA,$0]},_u={findFiberByHostInstance:ma,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},JM={bundleType:_u.bundleType,version:_u.version,rendererPackageName:_u.rendererPackageName,rendererConfig:_u.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ki.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=NA(n),n===null?null:n.stateNode},findFiberByHostInstance:_u.findFiberByHostInstance||QM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xf.isDisabled&&xf.supportsFiber)try{Rp=xf.inject(JM),Hs=xf}catch{}}Kr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=YM;Kr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Q0(e))throw Error(X(200));return HM(n,e,null,t)};Kr.createRoot=function(n,e){if(!Q0(n))throw Error(X(299));var t=!1,r="",s=lC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=W0(n,1,!1,null,null,t,!1,r,s),n[xi]=e.current,Td(n.nodeType===8?n.parentNode:n),new H0(e)};Kr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(X(188)):(n=Object.keys(n).join(","),Error(X(268,n)));return n=NA(e),n=n===null?null:n.stateNode,n};Kr.flushSync=function(n){return Pa(n)};Kr.hydrate=function(n,e,t){if(!Bp(e))throw Error(X(200));return zp(null,n,e,!0,t)};Kr.hydrateRoot=function(n,e,t){if(!Q0(n))throw Error(X(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=lC;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=aC(e,null,n,1,t??null,s,!1,i,o),n[xi]=e.current,Td(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new $p(e)};Kr.render=function(n,e,t){if(!Bp(e))throw Error(X(200));return zp(null,n,e,!1,t)};Kr.unmountComponentAtNode=function(n){if(!Bp(n))throw Error(X(40));return n._reactRootContainer?(Pa(function(){zp(null,null,n,!1,function(){n._reactRootContainer=null,n[xi]=null})}),!0):!1};Kr.unstable_batchedUpdates=$0;Kr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Bp(t))throw Error(X(200));if(n==null||n._reactInternals===void 0)throw Error(X(38));return zp(n,e,t,!1,r)};Kr.version="18.3.1-next-f1338f8080-20240426";function cC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cC)}catch(n){console.error(n)}}cC(),cA.exports=Kr;var XM=cA.exports,YI=XM;a_.createRoot=YI.createRoot,a_.hydrateRoot=YI.hydrateRoot;const ZM="modulepreload",eL=function(n){return"/"+n},JI={},De=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=eL(i),i in JI)return;JI[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":ZM,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},tL=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const te=function(n,e){if(!n)throw $c(e)},$c=function(n){return new Error("Firebase Database ("+uC.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dC=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},nL=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},K0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(m=64)),r.push(t[h],t[f],t[m],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(dC(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):nL(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new rL;const m=i<<2|a>>4;if(r.push(m),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const _=u<<6&192|f;r.push(_)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class rL extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hC=function(n){const e=dC(n);return K0.encodeByteArray(e,!0)},Bm=function(n){return hC(n).replace(/\./g,"")},zm=function(n){try{return K0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sL(n){return fC(void 0,n)}function fC(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!iL(t)||(n[t]=fC(n[t],e[t]));return n}function iL(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oL=()=>mC().__FIREBASE_DEFAULTS__,aL=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},lL=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&zm(n[1]);return e&&JSON.parse(e)},qp=()=>{try{return tL()||oL()||aL()||lL()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},pC=n=>{var e,t;return(t=(e=qp())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},gC=n=>{const e=pC(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},yC=()=>{var n;return(n=qp())==null?void 0:n.config},_C=n=>{var e;return(e=qp())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Wp(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vC(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Bm(JSON.stringify(t)),Bm(JSON.stringify(o)),a].join(".")}const Ju={};function cL(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ju))Ju[e]?n.emulator.push(e):n.prod.push(e);return n}function uL(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let XI=!1;function Y0(n,e){if(typeof window>"u"||typeof document>"u"||!Pi(window.location.host)||Ju[n]===e||Ju[n]||XI)return;Ju[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=cL().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,y){m.setAttribute("width","24"),m.setAttribute("id",y),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{XI=!0,o()},m}function h(m,y){m.setAttribute("id",y),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=uL(r),y=t("text"),_=document.getElementById(y)||document.createElement("span"),E=t("learnmore"),k=document.getElementById(E)||document.createElement("a"),I=t("preprendIcon"),x=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const R=m.element;a(R),h(k,E);const P=u();l(x,I),R.append(x,_,k,P),document.body.appendChild(R)}i?(_.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function J0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Nn())}function wC(){var e;const n=(e=qp())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dL(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function X0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function xC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hL(){const n=Nn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function SC(){return uC.NODE_ADMIN===!0}function IC(){return!wC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function EC(){return!wC()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Gp(){try{return typeof indexedDB=="object"}catch{return!1}}function Z0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function bC(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fL="FirebaseError";class As extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=fL,Object.setPrototypeOf(this,As.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xa.prototype.create)}}class Xa{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?mL(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new As(s,a,r)}}function mL(n,e){return n.replace(pL,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const pL=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Md(n){return JSON.parse(n)}function Cn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Md(zm(i[0])||""),t=Md(zm(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},gL=function(n){const e=TC(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},yL=function(n){const e=TC(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cs(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Da(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function qm(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Wm(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Gr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(ZI(i)&&ZI(o)){if(!Gr(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function ZI(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ou(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Mu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _L{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const m=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(m<<1|m>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const m=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=m}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function vL(n,e){const t=new wL(n,e);return t.subscribe.bind(t)}class wL{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");xL(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ny),s.error===void 0&&(s.error=Ny),s.complete===void 0&&(s.complete=Ny);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function xL(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ny(){}function Oa(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SL=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,te(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Hp=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL=1e3,EL=2,bL=4*60*60*1e3,TL=.5;function eE(n,e=IL,t=EL){const r=e*Math.pow(t,n),s=Math.round(TL*r*(Math.random()-.5)*2);return Math.min(bL,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(n){return n&&n._delegate?n._delegate:n}class Rr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oa="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Vr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(CL(e))try{this.getOrInitializeService({instanceIdentifier:oa})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=oa){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=oa){return this.instances.has(e)}getOptions(e=oa){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:AL(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=oa){return this.component?this.component.multipleInstances?e:oa:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function AL(n){return n===oa?void 0:n}function CL(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ev(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var it;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(it||(it={}));const RL={debug:it.DEBUG,verbose:it.VERBOSE,info:it.INFO,warn:it.WARN,error:it.ERROR,silent:it.SILENT},NL=it.INFO,kL={[it.DEBUG]:"log",[it.VERBOSE]:"log",[it.INFO]:"info",[it.WARN]:"warn",[it.ERROR]:"error"},PL=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=kL[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ph{constructor(e){this.name=e,this._logLevel=NL,this._logHandler=PL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in it))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?RL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,it.DEBUG,...e),this._logHandler(this,it.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,it.VERBOSE,...e),this._logHandler(this,it.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,it.INFO,...e),this._logHandler(this,it.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,it.WARN,...e),this._logHandler(this,it.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,it.ERROR,...e),this._logHandler(this,it.ERROR,...e)}}const DL=(n,e)=>e.some(t=>n instanceof t);let tE,nE;function OL(){return tE||(tE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ML(){return nE||(nE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const CC=new WeakMap,tv=new WeakMap,RC=new WeakMap,ky=new WeakMap,ew=new WeakMap;function LL(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ks(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&CC.set(t,n)}).catch(()=>{}),ew.set(e,n),e}function jL(n){if(tv.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});tv.set(n,e)}let nv={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return tv.get(n);if(e==="objectStoreNames")return n.objectStoreNames||RC.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ks(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function VL(n){nv=n(nv)}function FL(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Xf(this),e,...t);return RC.set(r,e.sort?e.sort():[e]),Ks(r)}:ML().includes(n)?function(...e){return n.apply(Xf(this),e),Ks(CC.get(this))}:function(...e){return Ks(n.apply(Xf(this),e))}}function UL(n){return typeof n=="function"?FL(n):(n instanceof IDBTransaction&&jL(n),DL(n,OL())?new Proxy(n,nv):n)}function Ks(n){if(n instanceof IDBRequest)return LL(n);if(ky.has(n))return ky.get(n);const e=UL(n);return e!==n&&(ky.set(n,e),ew.set(e,n)),e}const Xf=n=>ew.get(n);function tw(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Ks(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ks(o.result),l.oldVersion,l.newVersion,Ks(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}function $L(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Ks(t).then(()=>{})}const BL=["get","getKey","getAll","getAllKeys","count"],zL=["put","add","delete","clear"],Py=new Map;function rE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Py.get(e))return Py.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=zL.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||BL.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return Py.set(e,i),i}VL(n=>({...n,get:(e,t,r)=>rE(e,t)||n.get(e,t,r),has:(e,t)=>!!rE(e,t)||n.has(e,t)}));const a8=Object.freeze(Object.defineProperty({__proto__:null,deleteDB:$L,openDB:tw,unwrap:Xf,wrap:Ks},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(WL(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function WL(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const rv="@firebase/app",sE="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ei=new ph("@firebase/app"),GL="@firebase/app-compat",HL="@firebase/analytics-compat",QL="@firebase/analytics",KL="@firebase/app-check-compat",YL="@firebase/app-check",JL="@firebase/auth",XL="@firebase/auth-compat",ZL="@firebase/database",ej="@firebase/data-connect",tj="@firebase/database-compat",nj="@firebase/functions",rj="@firebase/functions-compat",sj="@firebase/installations",ij="@firebase/installations-compat",oj="@firebase/messaging",aj="@firebase/messaging-compat",lj="@firebase/performance",cj="@firebase/performance-compat",uj="@firebase/remote-config",dj="@firebase/remote-config-compat",hj="@firebase/storage",fj="@firebase/storage-compat",mj="@firebase/firestore",pj="@firebase/ai",gj="@firebase/firestore-compat",yj="firebase",_j="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm="[DEFAULT]",vj={[rv]:"fire-core",[GL]:"fire-core-compat",[QL]:"fire-analytics",[HL]:"fire-analytics-compat",[YL]:"fire-app-check",[KL]:"fire-app-check-compat",[JL]:"fire-auth",[XL]:"fire-auth-compat",[ZL]:"fire-rtdb",[ej]:"fire-data-connect",[tj]:"fire-rtdb-compat",[nj]:"fire-fn",[rj]:"fire-fn-compat",[sj]:"fire-iid",[ij]:"fire-iid-compat",[oj]:"fire-fcm",[aj]:"fire-fcm-compat",[lj]:"fire-perf",[cj]:"fire-perf-compat",[uj]:"fire-rc",[dj]:"fire-rc-compat",[hj]:"fire-gcs",[fj]:"fire-gcs-compat",[mj]:"fire-fst",[gj]:"fire-fst-compat",[pj]:"fire-vertex","fire-js":"fire-js",[yj]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld=new Map,wj=new Map,sv=new Map;function iE(n,e){try{n.container.addComponent(e)}catch(t){Ei.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ts(n){const e=n.name;if(sv.has(e))return Ei.debug(`There were multiple attempts to register component ${e}.`),!1;sv.set(e,n);for(const t of Ld.values())iE(t,n);for(const t of wj.values())iE(t,n);return!0}function si(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function xj(n,e,t=Gm){si(n,e).clearInstance(t)}function Yt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},xo=new Xa("app","Firebase",Sj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ij{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Rr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw xo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el=_j;function NC(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Gm,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw xo.create("bad-app-name",{appName:String(s)});if(t||(t=yC()),!t)throw xo.create("no-options");const i=Ld.get(s);if(i){if(Gr(t,i.options)&&Gr(r,i.config))return i;throw xo.create("duplicate-app",{appName:s})}const o=new AC(s);for(const l of sv.values())o.addComponent(l);const a=new Ij(t,r,o);return Ld.set(s,a),a}function gh(n=Gm){const e=Ld.get(n);if(!e&&n===Gm&&yC())return NC();if(!e)throw xo.create("no-app",{appName:n});return e}function Ej(){return Array.from(Ld.values())}function Ar(n,e,t){let r=vj[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ei.warn(o.join(" "));return}Ts(new Rr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bj="firebase-heartbeat-database",Tj=1,jd="firebase-heartbeat-store";let Dy=null;function kC(){return Dy||(Dy=tw(bj,Tj,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(jd)}catch(t){console.warn(t)}}}}).catch(n=>{throw xo.create("idb-open",{originalErrorMessage:n.message})})),Dy}async function Aj(n){try{const t=(await kC()).transaction(jd),r=await t.objectStore(jd).get(PC(n));return await t.done,r}catch(e){if(e instanceof As)Ei.warn(e.message);else{const t=xo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ei.warn(t.message)}}}async function oE(n,e){try{const r=(await kC()).transaction(jd,"readwrite");await r.objectStore(jd).put(e,PC(n)),await r.done}catch(t){if(t instanceof As)Ei.warn(t.message);else{const r=xo.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ei.warn(r.message)}}}function PC(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cj=1024,Rj=30;class Nj{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pj(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=aE();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>Rj){const o=Dj(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ei.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=aE(),{heartbeatsToSend:r,unsentEntries:s}=kj(this._heartbeatsCache.heartbeats),i=Bm(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Ei.warn(t),""}}}function aE(){return new Date().toISOString().substring(0,10)}function kj(n,e=Cj){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),lE(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),lE(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Pj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Gp()?Z0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Aj(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return oE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return oE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function lE(n){return Bm(JSON.stringify({version:2,heartbeats:n})).length}function Dj(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oj(n){Ts(new Rr("platform-logger",e=>new qL(e),"PRIVATE")),Ts(new Rr("heartbeat",e=>new Nj(e),"PRIVATE")),Ar(rv,sE,n),Ar(rv,sE,"esm2020"),Ar("fire-js","")}Oj("");var Mj="firebase",Lj="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ar(Mj,Lj,"app");const cE="@firebase/database",uE="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DC="";function OC(n){DC=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jj{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Cn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Md(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vj{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Cs(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new jj(e)}}catch{}return new Vj},ya=MC("localStorage"),iv=MC("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yl=new ph("@firebase/database"),LC=function(){let n=1;return function(){return n++}}(),jC=function(n){const e=SL(n),t=new _L;t.update(e);const r=t.digest();return K0.encodeByteArray(r)},yh=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=yh.apply(null,r):typeof r=="object"?e+=Cn(r):e+=r,e+=" "}return e};let Ia=null,dE=!0;const VC=function(n,e){te(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Yl.logLevel=it.VERBOSE,Ia=Yl.log.bind(Yl),e&&iv.set("logging_enabled",!0)):typeof n=="function"?Ia=n:(Ia=null,iv.remove("logging_enabled"))},Vn=function(...n){if(dE===!0&&(dE=!1,Ia===null&&iv.get("logging_enabled")===!0&&VC(!0)),Ia){const e=yh.apply(null,n);Ia(e)}},_h=function(n){return function(...e){Vn(n,...e)}},ov=function(...n){const e="FIREBASE INTERNAL ERROR: "+yh(...n);Yl.error(e)},ti=function(...n){const e=`FIREBASE FATAL ERROR: ${yh(...n)}`;throw Yl.error(e),new Error(e)},ir=function(...n){const e="FIREBASE WARNING: "+yh(...n);Yl.warn(e)},Fj=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ir("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Qp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Uj=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},No="[MIN_NAME]",bi="[MAX_NAME]",tl=function(n,e){if(n===e)return 0;if(n===No||e===bi)return-1;if(e===No||n===bi)return 1;{const t=hE(n),r=hE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},$j=function(n,e){return n===e?0:n<e?-1:1},vu=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Cn(e))},nw=function(n){if(typeof n!="object"||n===null)return Cn(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Cn(e[r]),t+=":",t+=nw(n[e[r]]);return t+="}",t},FC=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Bn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const UC=function(n){te(!Qp(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let m=parseInt(h.substr(l,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},Bj=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},zj=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function qj(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const Wj=new RegExp("^-?(0*)\\d{1,10}$"),Gj=-2147483648,Hj=2147483647,hE=function(n){if(Wj.test(n)){const e=Number(n);if(e>=Gj&&e<=Hj)return e}return null},Bc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw ir("Exception was thrown by user callback.",t),e},Math.floor(0))}},Qj=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Xu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kj{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Yt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){ir(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yj{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Vn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ir(e)}}class Jl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Jl.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rw="5",$C="v",BC="s",zC="r",qC="f",WC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,GC="ls",HC="p",av="ac",QC="websocket",KC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ya.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ya.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Jj(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function JC(n,e,t){te(typeof e=="string","typeof type must == string"),te(typeof t=="object","typeof params must == object");let r;if(e===QC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===KC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Jj(n)&&(t.ns=n.namespace);const s=[];return Bn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xj{constructor(){this.counters_={}}incrementCounter(e,t=1){Cs(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return sL(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oy={},My={};function sw(n){const e=n.toString();return Oy[e]||(Oy[e]=new Xj),Oy[e]}function Zj(n,e){const t=n.toString();return My[t]||(My[t]=e()),My[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Bc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fE="start",t4="close",n4="pLPCommand",r4="pRTLPCB",XC="id",ZC="pw",eR="ser",s4="cb",i4="seg",o4="ts",a4="d",l4="dframe",tR=1870,nR=30,c4=tR-nR,u4=25e3,d4=3e4;class ao{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=_h(e),this.stats_=sw(t),this.urlFn=l=>(this.appCheckToken&&(l[av]=this.appCheckToken),JC(t,KC,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new e4(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(d4)),Uj(()=>{if(this.isClosed_)return;this.scriptTagHolder=new iw((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===fE)this.id=a,this.password=l;else if(o===t4)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[fE]="t",r[eR]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[s4]=this.scriptTagHolder.uniqueCallbackIdentifier),r[$C]=rw,this.transportSessionId&&(r[BC]=this.transportSessionId),this.lastSessionId&&(r[GC]=this.lastSessionId),this.applicationId&&(r[HC]=this.applicationId),this.appCheckToken&&(r[av]=this.appCheckToken),typeof location<"u"&&location.hostname&&WC.test(location.hostname)&&(r[zC]=qC);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ao.forceAllow_=!0}static forceDisallow(){ao.forceDisallow_=!0}static isAvailable(){return ao.forceAllow_?!0:!ao.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Bj()&&!zj()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Cn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=hC(t),s=FC(r,c4);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[l4]="t",r[XC]=e,r[ZC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Cn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class iw{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=LC(),window[n4+this.uniqueCallbackIdentifier]=e,window[r4+this.uniqueCallbackIdentifier]=t,this.myIFrame=iw.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Vn("frame writing exception"),a.stack&&Vn(a.stack),Vn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Vn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[XC]=this.myID,e[ZC]=this.myPW,e[eR]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+nR+r.length<=tR;){const o=this.pendingSegs.shift();r=r+"&"+i4+s+"="+o.seg+"&"+o4+s+"="+o.ts+"&"+a4+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(u4)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Vn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4=16384,f4=45e3;let Hm=null;typeof MozWebSocket<"u"?Hm=MozWebSocket:typeof WebSocket<"u"&&(Hm=WebSocket);class ns{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=_h(this.connId),this.stats_=sw(t),this.connURL=ns.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[$C]=rw,typeof location<"u"&&location.hostname&&WC.test(location.hostname)&&(o[zC]=qC),t&&(o[BC]=t),r&&(o[GC]=r),s&&(o[av]=s),i&&(o[HC]=i),JC(e,QC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ya.set("previous_websocket_failure",!0);try{let r;SC(),this.mySock=new Hm(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){ns.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Hm!==null&&!ns.forceDisallow_}static previouslyFailed(){return ya.isInMemoryStorage||ya.get("previous_websocket_failure")===!0}markConnectionHealthy(){ya.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Md(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(te(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=Cn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=FC(t,h4);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(f4))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ns.responsesRequiredToBeHealthy=2;ns.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{static get ALL_TRANSPORTS(){return[ao,ns]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=ns&&ns.isAvailable();let r=t&&!ns.previouslyFailed();if(e.webSocketOnly&&(t||ir("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ns];else{const s=this.transports_=[];for(const i of hc.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);hc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}hc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4=6e4,p4=5e3,g4=10*1024,y4=100*1024,Ly="t",mE="d",_4="s",pE="r",v4="e",gE="o",yE="a",_E="n",vE="p",w4="h";class x4{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=_h("c:"+this.id+":"),this.transportManager_=new hc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Xu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>y4?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>g4?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ly in e){const t=e[Ly];t===yE?this.upgradeIfSecondaryHealthy_():t===pE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===gE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=vu("t",e),r=vu("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:vE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:yE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:_E,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=vu("t",e),r=vu("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=vu(Ly,e);if(mE in e){const r=e[mE];if(t===w4){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===_E){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===_4?this.onConnectionShutdown_(r):t===pE?this.onReset_(r):t===v4?ov("Server Error: "+r):t===gE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ov("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),rw!==r&&ir("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Xu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(m4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Xu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(p4))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:vE,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ya.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e){this.allowedEvents_=e,this.listeners_={},te(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){te(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm extends sR{static getInstance(){return new Qm}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!J0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return te(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE=32,xE=768;class St{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function yt(){return new St("")}function Ze(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ko(n){return n.pieces_.length-n.pieceNum_}function Ot(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new St(n.pieces_,e)}function ow(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function S4(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Vd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function iR(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new St(e,0)}function Jt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof St)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new St(t,0)}function et(n){return n.pieceNum_>=n.pieces_.length}function fr(n,e){const t=Ze(n),r=Ze(e);if(t===null)return e;if(t===r)return fr(Ot(n),Ot(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function I4(n,e){const t=Vd(n,0),r=Vd(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=tl(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function aw(n,e){if(ko(n)!==ko(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function ss(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(ko(n)>ko(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class E4{constructor(e,t){this.errorPrefix_=t,this.parts_=Vd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Hp(this.parts_[r]);oR(this)}}function b4(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Hp(e),oR(n)}function T4(n){const e=n.parts_.pop();n.byteLength_-=Hp(e),n.parts_.length>0&&(n.byteLength_-=1)}function oR(n){if(n.byteLength_>xE)throw new Error(n.errorPrefix_+"has a key path longer than "+xE+" bytes ("+n.byteLength_+").");if(n.parts_.length>wE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+wE+") or object contains a cycle "+aa(n))}function aa(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw extends sR{static getInstance(){return new lw}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return te(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu=1e3,A4=60*5*1e3,SE=30*1e3,C4=1.3,R4=3e4,N4="server_kill",IE=3;class os extends rR{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=os.nextPersistentConnectionId_++,this.log_=_h("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=wu,this.maxReconnectDelay_=A4,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!SC())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");lw.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Qm.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(Cn(i)),te(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Vr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),te(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;os.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Cs(e,"w")){const r=Da(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();ir(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||yL(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=SE)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=gL(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Cn(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):ov("Unrecognized action received from server: "+Cn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){te(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=wu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=wu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>R4&&(this.reconnectDelay_=wu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*C4)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+os.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){te(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,m]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Vn("getToken() completed but was canceled"):(Vn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=m&&m.token,a=new x4(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{ir(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(N4)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&ir(f),l())}}}interrupt(e){Vn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Vn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],qm(this.interruptReasons_)&&(this.reconnectDelay_=wu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>nw(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new St(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Vn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=IE&&(this.reconnectDelay_=SE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Vn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=IE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+DC.replace(/\./g,"-")]=1,J0()?e["framework.cordova"]=1:xC()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Qm.getInstance().currentlyOnline();return qm(this.interruptReasons_)&&e}}os.nextPersistentConnectionId_=0;os.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nt(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new nt(No,e),s=new nt(No,t);return this.compare(r,s)!==0}minPost(){return nt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sf;class aR extends Kp{static get __EMPTY_NODE(){return Sf}static set __EMPTY_NODE(e){Sf=e}compare(e,t){return tl(e.name,t.name)}isDefinedOn(e){throw $c("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nt.MIN}maxPost(){return new nt(bi,Sf)}makePost(e,t){return te(typeof e=="string","KeyIndex indexValue must always be a string."),new nt(e,Sf)}toString(){return".key"}}const Ys=new aR;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let If=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Lr=class Lu{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Lu.RED,this.left=s??Bs.EMPTY_NODE,this.right=i??Bs.EMPTY_NODE}copy(e,t,r,s,i){return new Lu(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Bs.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Bs.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Lu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Lu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Lr.RED=!0;Lr.BLACK=!1;class k4{copy(e,t,r,s,i){return this}insert(e,t,r){return new Lr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Bs=class Zf{constructor(e,t=Zf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Zf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Lr.BLACK,null,null))}remove(e){return new Zf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Lr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new If(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new If(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new If(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new If(this.root_,null,this.comparator_,!0,e)}};Bs.EMPTY_NODE=new k4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P4(n,e){return tl(n.name,e.name)}function cw(n,e){return tl(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lv;function D4(n){lv=n}const lR=function(n){return typeof n=="number"?"number:"+UC(n):"string:"+n},cR=function(n){if(n.isLeafNode()){const e=n.val();te(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Cs(e,".sv"),"Priority must be a string or number.")}else te(n===lv||n.isEmpty(),"priority of unexpected type.");te(n===lv||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EE;class On{static set __childrenNodeConstructor(e){EE=e}static get __childrenNodeConstructor(){return EE}constructor(e,t=On.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,te(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),cR(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new On(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:On.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return et(e)?this:Ze(e)===".priority"?this.priorityNode_:On.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:On.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=Ze(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(te(r!==".priority"||ko(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,On.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ot(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+lR(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=UC(this.value_):e+=this.value_,this.lazyHash_=jC(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===On.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof On.__childrenNodeConstructor?-1:(te(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=On.VALUE_TYPE_ORDER.indexOf(t),i=On.VALUE_TYPE_ORDER.indexOf(r);return te(s>=0,"Unknown leaf type: "+t),te(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}On.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uR,dR;function O4(n){uR=n}function M4(n){dR=n}class L4 extends Kp{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?tl(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nt.MIN}maxPost(){return new nt(bi,new On("[PRIORITY-POST]",dR))}makePost(e,t){const r=uR(e);return new nt(t,new On("[PRIORITY-POST]",r))}toString(){return".priority"}}const Vt=new L4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j4=Math.log(2);class V4{constructor(e){const t=i=>parseInt(Math.log(i)/j4,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Km=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,m;if(h===0)return null;if(h===1)return f=n[l],m=t?t(f):f,new Lr(m,f.node,Lr.BLACK,null,null);{const y=parseInt(h/2,10)+l,_=s(l,y),E=s(y+1,u);return f=n[y],m=t?t(f):f,new Lr(m,f.node,Lr.BLACK,_,E)}},i=function(l){let u=null,h=null,f=n.length;const m=function(_,E){const k=f-_,I=f;f-=_;const x=s(k+1,I),R=n[k],P=t?t(R):R;y(new Lr(P,R.node,E,null,x))},y=function(_){u?(u.left=_,u=_):(h=_,u=_)};for(let _=0;_<l.count;++_){const E=l.nextBitIsOne(),k=Math.pow(2,l.count-(_+1));E?m(k,Lr.BLACK):(m(k,Lr.BLACK),m(k,Lr.RED))}return h},o=new V4(n.length),a=i(o);return new Bs(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jy;const yl={};class fi{static get Default(){return te(yl&&Vt,"ChildrenNode.ts has not been loaded"),jy=jy||new fi({".priority":yl},{".priority":Vt}),jy}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Da(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Bs?t:null}hasIndex(e){return Cs(this.indexSet_,e.toString())}addIndex(e,t){te(e!==Ys,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(nt.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Km(r,e.getCompare()):a=yl;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new fi(h,u)}addToIndexes(e,t){const r=Wm(this.indexes_,(s,i)=>{const o=Da(this.indexSet_,i);if(te(o,"Missing index implementation for "+i),s===yl)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(nt.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Km(a,o.getCompare())}else return yl;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new nt(e.name,a))),l.insert(e,e.node)}});return new fi(r,this.indexSet_)}removeFromIndexes(e,t){const r=Wm(this.indexes_,s=>{if(s===yl)return s;{const i=t.get(e.name);return i?s.remove(new nt(e.name,i)):s}});return new fi(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xu;class je{static get EMPTY_NODE(){return xu||(xu=new je(new Bs(cw),null,fi.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&cR(this.priorityNode_),this.children_.isEmpty()&&te(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||xu}updatePriority(e){return this.children_.isEmpty()?this:new je(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?xu:t}}getChild(e){const t=Ze(e);return t===null?this:this.getImmediateChild(t).getChild(Ot(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(te(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new nt(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?xu:this.priorityNode_;return new je(s,o,i)}}updateChild(e,t){const r=Ze(e);if(r===null)return t;{te(Ze(e)!==".priority"||ko(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Ot(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(Vt,(o,a)=>{t[o]=a.val(e),r++,i&&je.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+lR(this.getPriority().val())+":"),this.forEachChild(Vt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":jC(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new nt(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new nt(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new nt(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,nt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,nt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===vh?-1:0}withIndex(e){if(e===Ys||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new je(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ys||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(Vt),s=t.getIterator(Vt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ys?null:this.indexMap_.get(e.toString())}}je.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class F4 extends je{constructor(){super(new Bs(cw),je.EMPTY_NODE,fi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return je.EMPTY_NODE}isEmpty(){return!1}}const vh=new F4;Object.defineProperties(nt,{MIN:{value:new nt(No,je.EMPTY_NODE)},MAX:{value:new nt(bi,vh)}});aR.__EMPTY_NODE=je.EMPTY_NODE;On.__childrenNodeConstructor=je;D4(vh);M4(vh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U4=!0;function nn(n,e=null){if(n===null)return je.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),te(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new On(t,nn(e))}if(!(n instanceof Array)&&U4){const t=[];let r=!1;if(Bn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=nn(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new nt(o,l)))}}),t.length===0)return je.EMPTY_NODE;const i=Km(t,P4,o=>o.name,cw);if(r){const o=Km(t,Vt.getCompare());return new je(i,nn(e),new fi({".priority":o},{".priority":Vt}))}else return new je(i,nn(e),fi.Default)}else{let t=je.EMPTY_NODE;return Bn(n,(r,s)=>{if(Cs(n,r)&&r.substring(0,1)!=="."){const i=nn(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(nn(e))}}O4(nn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw extends Kp{constructor(e){super(),this.indexPath_=e,te(!et(e)&&Ze(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?tl(e.name,t.name):i}makePost(e,t){const r=nn(e),s=je.EMPTY_NODE.updateChild(this.indexPath_,r);return new nt(t,s)}maxPost(){const e=je.EMPTY_NODE.updateChild(this.indexPath_,vh);return new nt(bi,e)}toString(){return Vd(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4 extends Kp{compare(e,t){const r=e.node.compareTo(t.node);return r===0?tl(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nt.MIN}maxPost(){return nt.MAX}makePost(e,t){const r=nn(e);return new nt(t,r)}toString(){return".value"}}const dw=new $4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(n){return{type:"value",snapshotNode:n}}function fc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Fd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ud(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function B4(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){te(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Fd(t,a)):te(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(fc(t,r)):o.trackChildChange(Ud(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Vt,(s,i)=>{t.hasChild(s)||r.trackChildChange(Fd(s,i))}),t.isLeafNode()||t.forEachChild(Vt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Ud(s,i,o))}else r.trackChildChange(fc(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?je.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e){this.indexedFilter_=new hw(e.getIndex()),this.index_=e.getIndex(),this.startPost_=$d.getStartPost_(e),this.endPost_=$d.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new nt(t,r))||(r=je.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=je.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(je.EMPTY_NODE);const i=this;return t.forEachChild(Vt,(o,a)=>{i.matches(new nt(o,a))||(s=s.updateImmediateChild(o,je.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new $d(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new nt(t,r))||(r=je.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=je.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=je.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(je.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,je.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(m,y)=>f(y,m)}else o=this.index_.getCompare();const a=e;te(a.numChildren()===this.limit_,"");const l=new nt(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let m=s.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);const y=m==null?1:o(m,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Ud(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(Fd(t,f));const E=a.updateImmediateChild(t,je.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(i!=null&&i.trackChildChange(fc(m.name,m.node)),E.updateImmediateChild(m.name,m.node)):E}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(Fd(u.name,u.node)),i.trackChildChange(fc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,je.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Vt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return te(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return te(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:No}hasEnd(){return this.endSet_}getIndexEndValue(){return te(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return te(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:bi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return te(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Vt}copy(){const e=new fw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function q4(n){return n.loadsAllData()?new hw(n.getIndex()):n.hasLimit()?new z4(n):new $d(n)}function W4(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function G4(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function cv(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function H4(n,e,t){let r;return n.index_===Ys||t?r=cv(n,e,t):r=cv(n,e,bi),r.startAfterSet_=!0,r}function uv(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function Q4(n,e,t){let r;return n.index_===Ys||t?r=uv(n,e,t):r=uv(n,e,No),r.endBeforeSet_=!0,r}function Yp(n,e){const t=n.copy();return t.index_=e,t}function bE(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Vt?t="$priority":n.index_===dw?t="$value":n.index_===Ys?t="$key":(te(n.index_ instanceof uw,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Cn(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=Cn(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Cn(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Cn(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Cn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function TE(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Vt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym extends rR{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(te(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=_h("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Ym.getListenId_(e,r),a={};this.listens_[o]=a;const l=bE(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Da(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",s(m,null)}})}unlisten(e,t){const r=Ym.getListenId_(e,t);delete this.listens_[r]}get(e){const t=bE(e._queryParams),r=e._path.toString(),s=new Vr;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Za(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Md(a.responseText)}catch{ir("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&ir("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(){this.rootNode_=je.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jm(){return{value:null,children:new Map}}function zc(n,e,t){if(et(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=Ze(e);n.children.has(r)||n.children.set(r,Jm());const s=n.children.get(r);e=Ot(e),zc(s,e,t)}}function dv(n,e){if(et(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(Vt,(r,s)=>{zc(n,new St(r),s)}),dv(n,e)}}else if(n.children.size>0){const t=Ze(e);return e=Ot(e),n.children.has(t)&&dv(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function hv(n,e,t){n.value!==null?t(e,n.value):Y4(n,(r,s)=>{const i=new St(e.toString()+"/"+r);hv(s,i,t)})}function Y4(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Bn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AE=10*1e3,X4=30*1e3,Z4=5*60*1e3;class eV{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new J4(e);const r=AE+(X4-AE)*Math.random();Xu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Bn(e,(s,i)=>{i>0&&Cs(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),Xu(this.reportStats_.bind(this),Math.floor(Math.random()*2*Z4))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vs;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(vs||(vs={}));function mw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function pw(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function gw(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=vs.ACK_USER_WRITE,this.source=mw()}operationForChild(e){if(et(this.path)){if(this.affectedTree.value!=null)return te(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new St(e));return new Xm(yt(),t,this.revert)}}else return te(Ze(this.path)===e,"operationForChild called for unrelated child."),new Xm(Ot(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e,t){this.source=e,this.path=t,this.type=vs.LISTEN_COMPLETE}operationForChild(e){return et(this.path)?new Bd(this.source,yt()):new Bd(this.source,Ot(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=vs.OVERWRITE}operationForChild(e){return et(this.path)?new Ma(this.source,yt(),this.snap.getImmediateChild(e)):new Ma(this.source,Ot(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=vs.MERGE}operationForChild(e){if(et(this.path)){const t=this.children.subtree(new St(e));return t.isEmpty()?null:t.value?new Ma(this.source,yt(),t.value):new mc(this.source,yt(),t)}else return te(Ze(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new mc(this.source,Ot(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(et(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ze(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function nV(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(B4(o.childName,o.snapshotNode))}),Su(n,s,"child_removed",e,r,t),Su(n,s,"child_added",e,r,t),Su(n,s,"child_moved",i,r,t),Su(n,s,"child_changed",e,r,t),Su(n,s,"value",e,r,t),s}function Su(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>sV(n,a,l)),o.forEach(a=>{const l=rV(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function rV(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function sV(n,e,t){if(e.childName==null||t.childName==null)throw $c("Should only compare child_ events.");const r=new nt(e.childName,e.snapshotNode),s=new nt(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jp(n,e){return{eventCache:n,serverCache:e}}function Zu(n,e,t,r){return Jp(new Po(e,t,r),n.serverCache)}function fR(n,e,t,r){return Jp(n.eventCache,new Po(e,t,r))}function Zm(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function La(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vy;const iV=()=>(Vy||(Vy=new Bs($j)),Vy);class Lt{static fromObject(e){let t=new Lt(null);return Bn(e,(r,s)=>{t=t.set(new St(r),s)}),t}constructor(e,t=iV()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:yt(),value:this.value};if(et(e))return null;{const r=Ze(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Ot(e),t);return i!=null?{path:Jt(new St(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(et(e))return this;{const t=Ze(e),r=this.children.get(t);return r!==null?r.subtree(Ot(e)):new Lt(null)}}set(e,t){if(et(e))return new Lt(t,this.children);{const r=Ze(e),i=(this.children.get(r)||new Lt(null)).set(Ot(e),t),o=this.children.insert(r,i);return new Lt(this.value,o)}}remove(e){if(et(e))return this.children.isEmpty()?new Lt(null):new Lt(null,this.children);{const t=Ze(e),r=this.children.get(t);if(r){const s=r.remove(Ot(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new Lt(null):new Lt(this.value,i)}else return this}}get(e){if(et(e))return this.value;{const t=Ze(e),r=this.children.get(t);return r?r.get(Ot(e)):null}}setTree(e,t){if(et(e))return t;{const r=Ze(e),i=(this.children.get(r)||new Lt(null)).setTree(Ot(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Lt(this.value,o)}}fold(e){return this.fold_(yt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Jt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,yt(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(et(e))return null;{const i=Ze(e),o=this.children.get(i);return o?o.findOnPath_(Ot(e),Jt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,yt(),t)}foreachOnPath_(e,t,r){if(et(e))return this;{this.value&&r(t,this.value);const s=Ze(e),i=this.children.get(s);return i?i.foreachOnPath_(Ot(e),Jt(t,s),r):new Lt(null)}}foreach(e){this.foreach_(yt(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(Jt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e){this.writeTree_=e}static empty(){return new Is(new Lt(null))}}function ed(n,e,t){if(et(e))return new Is(new Lt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=fr(s,e);return i=i.updateChild(o,t),new Is(n.writeTree_.set(s,i))}else{const s=new Lt(t),i=n.writeTree_.setTree(e,s);return new Is(i)}}}function fv(n,e,t){let r=n;return Bn(t,(s,i)=>{r=ed(r,Jt(e,s),i)}),r}function CE(n,e){if(et(e))return Is.empty();{const t=n.writeTree_.setTree(e,new Lt(null));return new Is(t)}}function mv(n,e){return nl(n,e)!=null}function nl(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(fr(t.path,e)):null}function RE(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Vt,(r,s)=>{e.push(new nt(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new nt(r,s.value))}),e}function So(n,e){if(et(e))return n;{const t=nl(n,e);return t!=null?new Is(new Lt(t)):new Is(n.writeTree_.subtree(e))}}function pv(n){return n.writeTree_.isEmpty()}function pc(n,e){return mR(yt(),n.writeTree_,e)}function mR(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(te(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=mR(Jt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Jt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xp(n,e){return _R(e,n)}function oV(n,e,t,r,s){te(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=ed(n.visibleWrites,e,t)),n.lastWriteId=r}function aV(n,e,t,r){te(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=fv(n.visibleWrites,e,t),n.lastWriteId=r}function lV(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function cV(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);te(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&uV(a,r.path)?s=!1:ss(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return dV(n),!0;if(r.snap)n.visibleWrites=CE(n.visibleWrites,r.path);else{const a=r.children;Bn(a,l=>{n.visibleWrites=CE(n.visibleWrites,Jt(r.path,l))})}return!0}else return!1}function uV(n,e){if(n.snap)return ss(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&ss(Jt(n.path,t),e))return!0;return!1}function dV(n){n.visibleWrites=pR(n.allWrites,hV,yt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function hV(n){return n.visible}function pR(n,e,t){let r=Is.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)ss(t,o)?(a=fr(t,o),r=ed(r,a,i.snap)):ss(o,t)&&(a=fr(o,t),r=ed(r,yt(),i.snap.getChild(a)));else if(i.children){if(ss(t,o))a=fr(t,o),r=fv(r,a,i.children);else if(ss(o,t))if(a=fr(o,t),et(a))r=fv(r,yt(),i.children);else{const l=Da(i.children,Ze(a));if(l){const u=l.getChild(Ot(a));r=ed(r,yt(),u)}}}else throw $c("WriteRecord should have .snap or .children")}}return r}function gR(n,e,t,r,s){if(!r&&!s){const i=nl(n.visibleWrites,e);if(i!=null)return i;{const o=So(n.visibleWrites,e);if(pv(o))return t;if(t==null&&!mv(o,yt()))return null;{const a=t||je.EMPTY_NODE;return pc(o,a)}}}else{const i=So(n.visibleWrites,e);if(!s&&pv(i))return t;if(!s&&t==null&&!mv(i,yt()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(ss(u.path,e)||ss(e,u.path))},a=pR(n.allWrites,o,e),l=t||je.EMPTY_NODE;return pc(a,l)}}}function fV(n,e,t){let r=je.EMPTY_NODE;const s=nl(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Vt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=So(n.visibleWrites,e);return t.forEachChild(Vt,(o,a)=>{const l=pc(So(i,new St(o)),a);r=r.updateImmediateChild(o,l)}),RE(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=So(n.visibleWrites,e);return RE(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function mV(n,e,t,r,s){te(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Jt(e,t);if(mv(n.visibleWrites,i))return null;{const o=So(n.visibleWrites,i);return pv(o)?s.getChild(t):pc(o,s.getChild(t))}}function pV(n,e,t,r){const s=Jt(e,t),i=nl(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=So(n.visibleWrites,s);return pc(o,r.getNode().getImmediateChild(t))}else return null}function gV(n,e){return nl(n.visibleWrites,e)}function yV(n,e,t,r,s,i,o){let a;const l=So(n.visibleWrites,e),u=nl(l,yt());if(u!=null)a=u;else if(t!=null)a=pc(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),m=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=m.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=m.getNext();return h}else return[]}function _V(){return{visibleWrites:Is.empty(),allWrites:[],lastWriteId:-1}}function ep(n,e,t,r){return gR(n.writeTree,n.treePath,e,t,r)}function yw(n,e){return fV(n.writeTree,n.treePath,e)}function NE(n,e,t,r){return mV(n.writeTree,n.treePath,e,t,r)}function tp(n,e){return gV(n.writeTree,Jt(n.treePath,e))}function vV(n,e,t,r,s,i){return yV(n.writeTree,n.treePath,e,t,r,s,i)}function _w(n,e,t){return pV(n.writeTree,n.treePath,e,t)}function yR(n,e){return _R(Jt(n.treePath,e),n.writeTree)}function _R(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;te(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),te(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Ud(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Fd(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,fc(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Ud(r,e.snapshotNode,s.oldSnap));else throw $c("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const vR=new xV;class vw{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Po(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _w(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:La(this.viewCache_),i=vV(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SV(n){return{filter:n}}function IV(n,e){te(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),te(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function EV(n,e,t,r,s){const i=new wV;let o,a;if(t.type===vs.OVERWRITE){const u=t;u.source.fromUser?o=gv(n,e,u.path,u.snap,r,s,i):(te(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!et(u.path),o=np(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===vs.MERGE){const u=t;u.source.fromUser?o=TV(n,e,u.path,u.children,r,s,i):(te(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=yv(n,e,u.path,u.children,r,s,a,i))}else if(t.type===vs.ACK_USER_WRITE){const u=t;u.revert?o=RV(n,e,u.path,r,s,i):o=AV(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===vs.LISTEN_COMPLETE)o=CV(n,e,t.path,r,i);else throw $c("Unknown operation type: "+t.type);const l=i.getChanges();return bV(e,o,l),{viewCache:o,changes:l}}function bV(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Zm(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(hR(Zm(e)))}}function wR(n,e,t,r,s,i){const o=e.eventCache;if(tp(r,t)!=null)return e;{let a,l;if(et(t))if(te(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=La(e),h=u instanceof je?u:je.EMPTY_NODE,f=yw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=ep(r,La(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Ze(t);if(u===".priority"){te(ko(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=NE(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=Ot(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const m=NE(r,t,o.getNode(),l);m!=null?f=o.getNode().getImmediateChild(u).updateChild(h,m):f=o.getNode().getImmediateChild(u)}else f=_w(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Zu(e,a,o.isFullyInitialized()||et(t),n.filter.filtersNodes())}}function np(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(et(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=Ze(t);if(!l.isCompleteForPath(t)&&ko(t)>1)return e;const _=Ot(t),k=l.getNode().getImmediateChild(y).updateChild(_,r);y===".priority"?u=h.updatePriority(l.getNode(),k):u=h.updateChild(l.getNode(),y,k,_,vR,null)}const f=fR(e,u,l.isFullyInitialized()||et(t),h.filtersNodes()),m=new vw(s,f,i);return wR(n,f,t,s,m,a)}function gv(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new vw(s,e,i);if(et(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Zu(e,u,!0,n.filter.filtersNodes());else{const f=Ze(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=Zu(e,u,a.isFullyInitialized(),a.isFiltered());else{const m=Ot(t),y=a.getNode().getImmediateChild(f);let _;if(et(m))_=r;else{const E=h.getCompleteChild(f);E!=null?ow(m)===".priority"&&E.getChild(iR(m)).isEmpty()?_=E:_=E.updateChild(m,r):_=je.EMPTY_NODE}if(y.equals(_))l=e;else{const E=n.filter.updateChild(a.getNode(),f,_,m,h,o);l=Zu(e,E,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function kE(n,e){return n.eventCache.isCompleteForChild(e)}function TV(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=Jt(t,l);kE(e,Ze(h))&&(a=gv(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=Jt(t,l);kE(e,Ze(h))||(a=gv(n,a,h,u,s,i,o))}),a}function PE(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function yv(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;et(t)?u=r:u=new Lt(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),_=PE(n,y,m);l=np(n,l,new St(f),_,s,i,o,a)}}),u.children.inorderTraversal((f,m)=>{const y=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!h.hasChild(f)&&!y){const _=e.serverCache.getNode().getImmediateChild(f),E=PE(n,_,m);l=np(n,l,new St(f),E,s,i,o,a)}}),l}function AV(n,e,t,r,s,i,o){if(tp(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(et(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return np(n,e,t,l.getNode().getChild(t),s,i,a,o);if(et(t)){let u=new Lt(null);return l.getNode().forEachChild(Ys,(h,f)=>{u=u.set(new St(h),f)}),yv(n,e,t,u,s,i,a,o)}else return e}else{let u=new Lt(null);return r.foreach((h,f)=>{const m=Jt(t,h);l.isCompleteForPath(m)&&(u=u.set(h,l.getNode().getChild(m)))}),yv(n,e,t,u,s,i,a,o)}}function CV(n,e,t,r,s){const i=e.serverCache,o=fR(e,i.getNode(),i.isFullyInitialized()||et(t),i.isFiltered());return wR(n,o,t,r,vR,s)}function RV(n,e,t,r,s,i){let o;if(tp(r,t)!=null)return e;{const a=new vw(r,e,s),l=e.eventCache.getNode();let u;if(et(t)||Ze(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=ep(r,La(e));else{const f=e.serverCache.getNode();te(f instanceof je,"serverChildren would be complete if leaf node"),h=yw(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Ze(t);let f=_w(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,Ot(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,je.EMPTY_NODE,Ot(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ep(r,La(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||tp(r,yt())!=null,Zu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new hw(r.getIndex()),i=q4(r);this.processor_=SV(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(je.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(je.EMPTY_NODE,a.getNode(),null),h=new Po(l,o.isFullyInitialized(),s.filtersNodes()),f=new Po(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Jp(f,h),this.eventGenerator_=new tV(this.query_)}get query(){return this.query_}}function kV(n){return n.viewCache_.serverCache.getNode()}function PV(n){return Zm(n.viewCache_)}function DV(n,e){const t=La(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!et(e)&&!t.getImmediateChild(Ze(e)).isEmpty())?t.getChild(e):null}function DE(n){return n.eventRegistrations_.length===0}function OV(n,e){n.eventRegistrations_.push(e)}function OE(n,e,t){const r=[];if(t){te(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function ME(n,e,t,r){e.type===vs.MERGE&&e.source.queryId!==null&&(te(La(n.viewCache_),"We should always have a full cache before handling merges"),te(Zm(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=EV(n.processor_,s,e,t,r);return IV(n.processor_,i.viewCache),te(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,xR(n,i.changes,i.viewCache.eventCache.getNode(),null)}function MV(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Vt,(i,o)=>{r.push(fc(i,o))}),t.isFullyInitialized()&&r.push(hR(t.getNode())),xR(n,r,t.getNode(),e)}function xR(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return nV(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rp;class SR{constructor(){this.views=new Map}}function LV(n){te(!rp,"__referenceConstructor has already been defined"),rp=n}function jV(){return te(rp,"Reference.ts has not been loaded"),rp}function VV(n){return n.views.size===0}function ww(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return te(i!=null,"SyncTree gave us an op for an invalid query."),ME(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(ME(o,e,t,r));return i}}function IR(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=ep(t,s?r:null),l=!1;a?l=!0:r instanceof je?(a=yw(t,r),l=!1):(a=je.EMPTY_NODE,l=!1);const u=Jp(new Po(a,l,!1),new Po(r,s,!1));return new NV(e,u)}return o}function FV(n,e,t,r,s,i){const o=IR(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),OV(o,t),MV(o,t)}function UV(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=Do(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(OE(u,t,r)),DE(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(OE(l,t,r)),DE(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Do(n)&&i.push(new(jV())(e._repo,e._path)),{removed:i,events:o}}function ER(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Io(n,e){let t=null;for(const r of n.views.values())t=t||DV(r,e);return t}function bR(n,e){if(e._queryParams.loadsAllData())return Zp(n);{const r=e._queryIdentifier;return n.views.get(r)}}function TR(n,e){return bR(n,e)!=null}function Do(n){return Zp(n)!=null}function Zp(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sp;function $V(n){te(!sp,"__referenceConstructor has already been defined"),sp=n}function BV(){return te(sp,"Reference.ts has not been loaded"),sp}let zV=1;class LE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Lt(null),this.pendingWriteTree_=_V(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function xw(n,e,t,r,s){return oV(n.pendingWriteTree_,e,t,r,s),s?qc(n,new Ma(mw(),e,t)):[]}function qV(n,e,t,r){aV(n.pendingWriteTree_,e,t,r);const s=Lt.fromObject(t);return qc(n,new mc(mw(),e,s))}function lo(n,e,t=!1){const r=lV(n.pendingWriteTree_,e);if(cV(n.pendingWriteTree_,e)){let i=new Lt(null);return r.snap!=null?i=i.set(yt(),!0):Bn(r.children,o=>{i=i.set(new St(o),!0)}),qc(n,new Xm(r.path,i,t))}else return[]}function wh(n,e,t){return qc(n,new Ma(pw(),e,t))}function WV(n,e,t){const r=Lt.fromObject(t);return qc(n,new mc(pw(),e,r))}function GV(n,e){return qc(n,new Bd(pw(),e))}function HV(n,e,t){const r=Sw(n,t);if(r){const s=Iw(r),i=s.path,o=s.queryId,a=fr(i,e),l=new Bd(gw(o),a);return Ew(n,i,l)}else return[]}function ip(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||TR(o,e))){const l=UV(o,e,t,r);VV(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(m,y)=>Do(y));if(h&&!f){const m=n.syncPointTree_.subtree(i);if(!m.isEmpty()){const y=YV(m);for(let _=0;_<y.length;++_){const E=y[_],k=E.query,I=NR(n,E);n.listenProvider_.startListening(td(k),zd(n,k),I.hashFn,I.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(td(e),null):u.forEach(m=>{const y=n.queryToTagMap.get(tg(m));n.listenProvider_.stopListening(td(m),y)}))}JV(n,u)}return a}function AR(n,e,t,r){const s=Sw(n,r);if(s!=null){const i=Iw(s),o=i.path,a=i.queryId,l=fr(o,e),u=new Ma(gw(a),l,t);return Ew(n,o,u)}else return[]}function QV(n,e,t,r){const s=Sw(n,r);if(s){const i=Iw(s),o=i.path,a=i.queryId,l=fr(o,e),u=Lt.fromObject(t),h=new mc(gw(a),l,u);return Ew(n,o,h)}else return[]}function _v(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(m,y)=>{const _=fr(m,s);i=i||Io(y,_),o=o||Do(y)});let a=n.syncPointTree_.get(s);a?(o=o||Do(a),i=i||Io(a,yt())):(a=new SR,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=je.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,_)=>{const E=Io(_,yt());E&&(i=i.updateImmediateChild(y,E))}));const u=TR(a,e);if(!u&&!e._queryParams.loadsAllData()){const m=tg(e);te(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const y=XV();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}const h=Xp(n.pendingWriteTree_,s);let f=FV(a,e,t,h,i,l);if(!u&&!o&&!r){const m=bR(a,e);f=f.concat(ZV(n,e,m))}return f}function eg(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=fr(o,e),u=Io(a,l);if(u)return u});return gR(s,e,i,t,!0)}function KV(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=fr(u,t);r=r||Io(h,f)});let s=n.syncPointTree_.get(t);s?r=r||Io(s,yt()):(s=new SR,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Po(r,!0,!1):null,a=Xp(n.pendingWriteTree_,e._path),l=IR(s,e,a,i?o.getNode():je.EMPTY_NODE,i);return PV(l)}function qc(n,e){return CR(e,n.syncPointTree_,null,Xp(n.pendingWriteTree_,yt()))}function CR(n,e,t,r){if(et(n.path))return RR(n,e,t,r);{const s=e.get(yt());t==null&&s!=null&&(t=Io(s,yt()));let i=[];const o=Ze(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=yR(r,o);i=i.concat(CR(a,l,u,h))}return s&&(i=i.concat(ww(s,n,r,t))),i}}function RR(n,e,t,r){const s=e.get(yt());t==null&&s!=null&&(t=Io(s,yt()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=yR(r,o),h=n.operationForChild(o);h&&(i=i.concat(RR(h,a,l,u)))}),s&&(i=i.concat(ww(s,n,r,t))),i}function NR(n,e){const t=e.query,r=zd(n,t);return{hashFn:()=>(kV(e)||je.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?HV(n,t._path,r):GV(n,t._path);{const i=qj(s,t);return ip(n,t,null,i)}}}}function zd(n,e){const t=tg(e);return n.queryToTagMap.get(t)}function tg(n){return n._path.toString()+"$"+n._queryIdentifier}function Sw(n,e){return n.tagToQueryMap.get(e)}function Iw(n){const e=n.indexOf("$");return te(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new St(n.substr(0,e))}}function Ew(n,e,t){const r=n.syncPointTree_.get(e);te(r,"Missing sync point for query tag that we're tracking");const s=Xp(n.pendingWriteTree_,e);return ww(r,t,s,null)}function YV(n){return n.fold((e,t,r)=>{if(t&&Do(t))return[Zp(t)];{let s=[];return t&&(s=ER(t)),Bn(r,(i,o)=>{s=s.concat(o)}),s}})}function td(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(BV())(n._repo,n._path):n}function JV(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=tg(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function XV(){return zV++}function ZV(n,e,t){const r=e._path,s=zd(n,e),i=NR(n,t),o=n.listenProvider_.startListening(td(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)te(!Do(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!et(u)&&h&&Do(h))return[Zp(h).query];{let m=[];return h&&(m=m.concat(ER(h).map(y=>y.query))),Bn(f,(y,_)=>{m=m.concat(_)}),m}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(td(h),zd(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new bw(t)}node(){return this.node_}}class Tw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Jt(this.path_,e);return new Tw(this.syncTree_,t)}node(){return eg(this.syncTree_,this.path_)}}const eF=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},jE=function(n,e,t){if(!n||typeof n!="object")return n;if(te(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return tF(n[".sv"],e,t);if(typeof n[".sv"]=="object")return nF(n[".sv"],e);te(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},tF=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:te(!1,"Unexpected server value: "+n)}},nF=function(n,e,t){n.hasOwnProperty("increment")||te(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&te(!1,"Unexpected increment value: "+r);const s=e.node();if(te(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},kR=function(n,e,t,r){return Cw(e,new Tw(t,n),r)},Aw=function(n,e,t){return Cw(n,new bw(e),t)};function Cw(n,e,t){const r=n.getPriority().val(),s=jE(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=jE(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new On(a,nn(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new On(s))),o.forEachChild(Vt,(a,l)=>{const u=Cw(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function ng(n,e){let t=e instanceof St?e:new St(e),r=n,s=Ze(t);for(;s!==null;){const i=Da(r.node.children,s)||{children:{},childCount:0};r=new Rw(s,r,i),t=Ot(t),s=Ze(t)}return r}function rl(n){return n.node.value}function Nw(n,e){n.node.value=e,vv(n)}function PR(n){return n.node.childCount>0}function rF(n){return rl(n)===void 0&&!PR(n)}function rg(n,e){Bn(n.node.children,(t,r)=>{e(new Rw(t,n,r))})}function DR(n,e,t,r){t&&!r&&e(n),rg(n,s=>{DR(s,e,!0,r)}),t&&r&&e(n)}function sF(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function xh(n){return new St(n.parent===null?n.name:xh(n.parent)+"/"+n.name)}function vv(n){n.parent!==null&&iF(n.parent,n.name,n)}function iF(n,e,t){const r=rF(t),s=Cs(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,vv(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,vv(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oF=/[\[\].#$\/\u0000-\u001F\u007F]/,aF=/[\[\].#$\u0000-\u001F\u007F]/,Fy=10*1024*1024,sg=function(n){return typeof n=="string"&&n.length!==0&&!oF.test(n)},OR=function(n){return typeof n=="string"&&n.length!==0&&!aF.test(n)},lF=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),OR(n)},qd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Qp(n)||n&&typeof n=="object"&&Cs(n,".sv")},ni=function(n,e,t,r){r&&e===void 0||Sh(Oa(n,"value"),e,t)},Sh=function(n,e,t){const r=t instanceof St?new E4(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+aa(r));if(typeof e=="function")throw new Error(n+"contains a function "+aa(r)+" with contents = "+e.toString());if(Qp(e))throw new Error(n+"contains "+e.toString()+" "+aa(r));if(typeof e=="string"&&e.length>Fy/3&&Hp(e)>Fy)throw new Error(n+"contains a string greater than "+Fy+" utf8 bytes "+aa(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Bn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!sg(o)))throw new Error(n+" contains an invalid key ("+o+") "+aa(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);b4(r,o),Sh(n,a,r),T4(r)}),s&&i)throw new Error(n+' contains ".value" child '+aa(r)+" in addition to actual children.")}},cF=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Vd(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!sg(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(I4);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&ss(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},MR=function(n,e,t,r){if(r&&e===void 0)return;const s=Oa(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Bn(e,(o,a)=>{const l=new St(o);if(Sh(s,a,Jt(t,l)),ow(l)===".priority"&&!qd(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),cF(s,i)},kw=function(n,e,t){if(!(t&&e===void 0)){if(Qp(e))throw new Error(Oa(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!qd(e))throw new Error(Oa(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ih=function(n,e,t,r){if(!(r&&t===void 0)&&!sg(t))throw new Error(Oa(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Pw=function(n,e,t,r){if(!(r&&t===void 0)&&!OR(t))throw new Error(Oa(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},uF=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Pw(n,e,t,r)},zs=function(n,e){if(Ze(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},LR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!sg(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!lF(t))throw new Error(Oa(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dF{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ig(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!aw(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function jR(n,e,t){ig(n,t),VR(n,r=>aw(r,e))}function Hr(n,e,t){ig(n,t),VR(n,r=>ss(r,e)||ss(e,r))}function VR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(hF(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function hF(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Ia&&Vn("event: "+t.toString()),Bc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FR="repo_interrupt",fF=25;class mF{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new dF,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Jm(),this.transactionQueueTree_=new Rw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function pF(n,e,t){if(n.stats_=sw(n.repoInfo_),n.forceRestClient_||Qj())n.server_=new Ym(n.repoInfo_,(r,s,i,o)=>{VE(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>FE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Cn(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new os(n.repoInfo_,e,(r,s,i,o)=>{VE(n,r,s,i,o)},r=>{FE(n,r)},r=>{gF(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=Zj(n.repoInfo_,()=>new eV(n.stats_,n.server_)),n.infoData_=new K4,n.infoSyncTree_=new LE({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=wh(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Dw(n,"connected",!1),n.serverSyncTree_=new LE({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);Hr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function UR(n){const t=n.infoData_.getNode(new St(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Eh(n){return eF({timestamp:UR(n)})}function VE(n,e,t,r,s){n.dataUpdateCount++;const i=new St(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=Wm(t,u=>nn(u));o=QV(n.serverSyncTree_,i,l,s)}else{const l=nn(t);o=AR(n.serverSyncTree_,i,l,s)}else if(r){const l=Wm(t,u=>nn(u));o=WV(n.serverSyncTree_,i,l)}else{const l=nn(t);o=wh(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=gc(n,i)),Hr(n.eventQueue_,a,o)}function FE(n,e){Dw(n,"connected",e),e===!1&&vF(n)}function gF(n,e){Bn(e,(t,r)=>{Dw(n,t,r)})}function Dw(n,e,t){const r=new St("/.info/"+e),s=nn(t);n.infoData_.updateSnapshot(r,s);const i=wh(n.infoSyncTree_,r,s);Hr(n.eventQueue_,r,i)}function og(n){return n.nextWriteId_++}function yF(n,e,t){const r=KV(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=nn(s).withIndex(e._queryParams.getIndex());_v(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=wh(n.serverSyncTree_,e._path,i);else{const a=zd(n.serverSyncTree_,e);o=AR(n.serverSyncTree_,e._path,i,a)}return Hr(n.eventQueue_,e._path,o),ip(n.serverSyncTree_,e,t,null,!0),i},s=>(Wc(n,"get for query "+Cn(e)+" failed: "+s),Promise.reject(new Error(s))))}function Ow(n,e,t,r,s){Wc(n,"set",{path:e.toString(),value:t,priority:r});const i=Eh(n),o=nn(t,r),a=eg(n.serverSyncTree_,e),l=Aw(o,a,i),u=og(n),h=xw(n.serverSyncTree_,e,l,u,!0);ig(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(m,y)=>{const _=m==="ok";_||ir("set at "+e+" failed: "+m);const E=lo(n.serverSyncTree_,u,!_);Hr(n.eventQueue_,e,E),Oo(n,s,m,y)});const f=Lw(n,e);gc(n,f),Hr(n.eventQueue_,f,[])}function _F(n,e,t,r){Wc(n,"update",{path:e.toString(),value:t});let s=!0;const i=Eh(n),o={};if(Bn(t,(a,l)=>{s=!1,o[a]=kR(Jt(e,a),nn(l),n.serverSyncTree_,i)}),s)Vn("update() called with empty data.  Don't do anything."),Oo(n,r,"ok",void 0);else{const a=og(n),l=qV(n.serverSyncTree_,e,o,a);ig(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||ir("update at "+e+" failed: "+u);const m=lo(n.serverSyncTree_,a,!f),y=m.length>0?gc(n,e):e;Hr(n.eventQueue_,y,m),Oo(n,r,u,h)}),Bn(t,u=>{const h=Lw(n,Jt(e,u));gc(n,h)}),Hr(n.eventQueue_,e,[])}}function vF(n){Wc(n,"onDisconnectEvents");const e=Eh(n),t=Jm();hv(n.onDisconnect_,yt(),(s,i)=>{const o=kR(s,i,n.serverSyncTree_,e);zc(t,s,o)});let r=[];hv(t,yt(),(s,i)=>{r=r.concat(wh(n.serverSyncTree_,s,i));const o=Lw(n,s);gc(n,o)}),n.onDisconnect_=Jm(),Hr(n.eventQueue_,yt(),r)}function wF(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&dv(n.onDisconnect_,e),Oo(n,t,r,s)})}function UE(n,e,t,r){const s=nn(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&zc(n.onDisconnect_,e,s),Oo(n,r,i,o)})}function xF(n,e,t,r,s){const i=nn(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&zc(n.onDisconnect_,e,i),Oo(n,s,o,a)})}function SF(n,e,t,r){if(qm(t)){Vn("onDisconnect().update() called with empty data.  Don't do anything."),Oo(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Bn(t,(o,a)=>{const l=nn(a);zc(n.onDisconnect_,Jt(e,o),l)}),Oo(n,r,s,i)})}function IF(n,e,t){let r;Ze(e._path)===".info"?r=_v(n.infoSyncTree_,e,t):r=_v(n.serverSyncTree_,e,t),jR(n.eventQueue_,e._path,r)}function wv(n,e,t){let r;Ze(e._path)===".info"?r=ip(n.infoSyncTree_,e,t):r=ip(n.serverSyncTree_,e,t),jR(n.eventQueue_,e._path,r)}function $R(n){n.persistentConnection_&&n.persistentConnection_.interrupt(FR)}function EF(n){n.persistentConnection_&&n.persistentConnection_.resume(FR)}function Wc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Vn(t,...e)}function Oo(n,e,t,r){e&&Bc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function bF(n,e,t,r,s,i){Wc(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:LC(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Mw(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Sh("transaction failed: Data returned ",l,o.path),o.status=0;const u=ng(n.transactionQueueTree_,e),h=rl(u)||[];h.push(o),Nw(u,h);let f;typeof l=="object"&&l!==null&&Cs(l,".priority")?(f=Da(l,".priority"),te(qd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(eg(n.serverSyncTree_,e)||je.EMPTY_NODE).getPriority().val();const m=Eh(n),y=nn(l,f),_=Aw(y,a,m);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=_,o.currentWriteId=og(n);const E=xw(n.serverSyncTree_,e,_,o.currentWriteId,o.applyLocally);Hr(n.eventQueue_,e,E),ag(n,n.transactionQueueTree_)}}function Mw(n,e,t){return eg(n.serverSyncTree_,e,t)||je.EMPTY_NODE}function ag(n,e=n.transactionQueueTree_){if(e||lg(n,e),rl(e)){const t=zR(n,e);te(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&TF(n,xh(e),t)}else PR(e)&&rg(e,t=>{ag(n,t)})}function TF(n,e,t){const r=t.map(u=>u.currentWriteId),s=Mw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];te(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=fr(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Wc(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let m=0;m<t.length;m++)t[m].status=2,h=h.concat(lo(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();lg(n,ng(n.transactionQueueTree_,e)),ag(n,n.transactionQueueTree_),Hr(n.eventQueue_,e,h);for(let m=0;m<f.length;m++)Bc(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{ir("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}gc(n,e)}},o)}function gc(n,e){const t=BR(n,e),r=xh(t),s=zR(n,t);return AF(n,s,r),r}function AF(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=fr(t,l.path);let h=!1,f;if(te(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(lo(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=fF)h=!0,f="maxretry",s=s.concat(lo(n.serverSyncTree_,l.currentWriteId,!0));else{const m=Mw(n,l.path,o);l.currentInputSnapshot=m;const y=e[a].update(m.val());if(y!==void 0){Sh("transaction failed: Data returned ",y,l.path);let _=nn(y);typeof y=="object"&&y!=null&&Cs(y,".priority")||(_=_.updatePriority(m.getPriority()));const k=l.currentWriteId,I=Eh(n),x=Aw(_,m,I);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=x,l.currentWriteId=og(n),o.splice(o.indexOf(k),1),s=s.concat(xw(n.serverSyncTree_,l.path,x,l.currentWriteId,l.applyLocally)),s=s.concat(lo(n.serverSyncTree_,k,!0))}else h=!0,f="nodata",s=s.concat(lo(n.serverSyncTree_,l.currentWriteId,!0))}Hr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}lg(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Bc(r[a]);ag(n,n.transactionQueueTree_)}function BR(n,e){let t,r=n.transactionQueueTree_;for(t=Ze(e);t!==null&&rl(r)===void 0;)r=ng(r,t),e=Ot(e),t=Ze(e);return r}function zR(n,e){const t=[];return qR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function qR(n,e,t){const r=rl(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);rg(e,s=>{qR(n,s,t)})}function lg(n,e){const t=rl(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,Nw(e,t.length>0?t:void 0)}rg(e,r=>{lg(n,r)})}function Lw(n,e){const t=xh(BR(n,e)),r=ng(n.transactionQueueTree_,e);return sF(r,s=>{Uy(n,s)}),Uy(n,r),DR(r,s=>{Uy(n,s)}),t}function Uy(n,e){const t=rl(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(te(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(te(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(lo(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Nw(e,void 0):t.length=i+1,Hr(n.eventQueue_,xh(e),s);for(let o=0;o<r.length;o++)Bc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CF(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function RF(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ir(`Invalid query segment '${t}' in query '${n}'`)}return e}const xv=function(n,e){const t=NF(n),r=t.namespace;t.domain==="firebase.com"&&ti(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&ti("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Fj();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new YC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new St(t.pathString)}},NF=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=CF(n.substring(h,f)));const m=RF(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const _=e.indexOf(".");r=e.substring(0,_).toLowerCase(),t=e.substring(_+1),i=r}"ns"in m&&(i=m.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $E="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",kF=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=$E.charAt(t%64),t=Math.floor(t/64);te(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=$E.charAt(e[s]);return te(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Cn(this.snapshot.exportVal())}}class GR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return te(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PF{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Vr;return wF(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){zs("OnDisconnect.remove",this._path);const e=new Vr;return UE(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){zs("OnDisconnect.set",this._path),ni("OnDisconnect.set",e,this._path,!1);const t=new Vr;return UE(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){zs("OnDisconnect.setWithPriority",this._path),ni("OnDisconnect.setWithPriority",e,this._path,!1),kw("OnDisconnect.setWithPriority",t,!1);const r=new Vr;return xF(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){zs("OnDisconnect.update",this._path),MR("OnDisconnect.update",e,this._path,!1);const t=new Vr;return SF(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return et(this._path)?null:ow(this._path)}get ref(){return new Rs(this._repo,this._path)}get _queryIdentifier(){const e=TE(this._queryParams),t=nw(e);return t==="{}"?"default":t}get _queryObject(){return TE(this._queryParams)}isEqual(e){if(e=le(e),!(e instanceof Jr))return!1;const t=this._repo===e._repo,r=aw(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+S4(this._path)}}function cg(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Wo(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Ys){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==No)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==bi)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===Vt){if(e!=null&&!qd(e)||t!=null&&!qd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(te(n.getIndex()instanceof uw||n.getIndex()===dw,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ug(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Rs extends Jr{constructor(e,t){super(e,t,new fw,!1)}get parent(){const e=iR(this._path);return e===null?null:new Rs(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ja{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new St(e),r=yc(this.ref,e);return new ja(this._node.getChild(t),r,Vt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new ja(s,yc(this.ref,r),Vt)))}hasChild(e){const t=new St(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ae(n,e){return n=le(n),n._checkNotDeleted("ref"),e!==void 0?yc(n._root,e):n._root}function c8(n,e){n=le(n),n._checkNotDeleted("refFromURL");const t=xv(e,n._repo.repoInfo_.nodeAdmin);LR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&ti("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),ae(n,t.path.toString())}function yc(n,e){return n=le(n),Ze(n._path)===null?uF("child","path",e,!1):Pw("child","path",e,!1),new Rs(n._repo,Jt(n._path,e))}function u8(n){return n=le(n),new PF(n._repo,n._path)}function HR(n,e){n=le(n),zs("push",n._path),ni("push",e,n._path,!0);const t=UR(n._repo),r=kF(t),s=yc(n,r),i=yc(n,r);let o;return e!=null?o=Ye(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function DF(n){return zs("remove",n._path),Ye(n,null)}function Ye(n,e){n=le(n),zs("set",n._path),ni("set",e,n._path,!1);const t=new Vr;return Ow(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function d8(n,e){n=le(n),zs("setPriority",n._path),kw("setPriority",e,!1);const t=new Vr;return Ow(n._repo,Jt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function h8(n,e,t){if(zs("setWithPriority",n._path),ni("setWithPriority",e,n._path,!1),kw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Vr;return Ow(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function OF(n,e){MR("update",e,n._path,!1);const t=new Vr;return _F(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function $e(n){n=le(n);const e=new jw(()=>{}),t=new bh(e);return yF(n._repo,n,t).then(r=>new ja(r,new Rs(n._repo,n._path),n._queryParams.getIndex()))}class bh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new WR("value",this,new ja(e.snapshotNode,new Rs(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new GR(this,e,t):null}matches(e){return e instanceof bh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class dg{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new GR(this,e,t):null}createEvent(e,t){te(e.childName!=null,"Child events should have a childName.");const r=yc(new Rs(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new WR(e.type,this,new ja(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof dg?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Th(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{wv(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new jw(t,i||void 0),a=e==="value"?new bh(o):new dg(e,o);return IF(n._repo,n,a),()=>wv(n._repo,n,a)}function Vw(n,e,t,r){return Th(n,"value",e,t,r)}function f8(n,e,t,r){return Th(n,"child_added",e,t,r)}function m8(n,e,t,r){return Th(n,"child_changed",e,t,r)}function p8(n,e,t,r){return Th(n,"child_moved",e,t,r)}function g8(n,e,t,r){return Th(n,"child_removed",e,t,r)}function MF(n,e,t){let r=null;const s=t?new jw(t):null;e==="value"?r=new bh(s):e&&(r=new dg(e,s)),wv(n._repo,n,r)}let Ns=class{},QR=class extends Ns{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){ni("endAt",this._value,e._path,!0);const t=uv(e._queryParams,this._value,this._key);if(ug(t),Wo(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Jr(e._repo,e._path,t,e._orderByCalled)}};function v8(n,e){return Ih("endAt","key",e,!0),new QR(n,e)}class LF extends Ns{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){ni("endBefore",this._value,e._path,!1);const t=Q4(e._queryParams,this._value,this._key);if(ug(t),Wo(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Jr(e._repo,e._path,t,e._orderByCalled)}}function w8(n,e){return Ih("endBefore","key",e,!0),new LF(n,e)}let KR=class extends Ns{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){ni("startAt",this._value,e._path,!0);const t=cv(e._queryParams,this._value,this._key);if(ug(t),Wo(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Jr(e._repo,e._path,t,e._orderByCalled)}};function S8(n=null,e){return Ih("startAt","key",e,!0),new KR(n,e)}class jF extends Ns{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){ni("startAfter",this._value,e._path,!1);const t=H4(e._queryParams,this._value,this._key);if(ug(t),Wo(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Jr(e._repo,e._path,t,e._orderByCalled)}}function I8(n,e){return Ih("startAfter","key",e,!0),new jF(n,e)}class VF extends Ns{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Jr(e._repo,e._path,W4(e._queryParams,this._limit),e._orderByCalled)}}function E8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new VF(n)}class FF extends Ns{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Jr(e._repo,e._path,G4(e._queryParams,this._limit),e._orderByCalled)}}function b8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new FF(n)}class UF extends Ns{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){cg(e,"orderByChild");const t=new St(this._path);if(et(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new uw(t),s=Yp(e._queryParams,r);return Wo(s),new Jr(e._repo,e._path,s,!0)}}function T8(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Pw("orderByChild","path",n,!1),new UF(n)}class $F extends Ns{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){cg(e,"orderByKey");const t=Yp(e._queryParams,Ys);return Wo(t),new Jr(e._repo,e._path,t,!0)}}function A8(){return new $F}class BF extends Ns{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){cg(e,"orderByPriority");const t=Yp(e._queryParams,Vt);return Wo(t),new Jr(e._repo,e._path,t,!0)}}function C8(){return new BF}class zF extends Ns{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){cg(e,"orderByValue");const t=Yp(e._queryParams,dw);return Wo(t),new Jr(e._repo,e._path,t,!0)}}function R8(){return new zF}class qF extends Ns{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(ni("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new QR(this._value,this._key)._apply(new KR(this._value,this._key)._apply(e))}}function N8(n,e){return Ih("equalTo","key",e,!0),new qF(n,e)}function WF(n,...e){let t=le(n);for(const r of e)t=r._apply(t);return t}LV(Rs);$V(Rs);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GF="FIREBASE_DATABASE_EMULATOR_HOST",Sv={};let YR=!1;function HF(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Pi(i);n.repoInfo_=new YC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function JR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||ti("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Vn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=xv(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[GF]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=xv(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new Jl(Jl.OWNER):new Yj(n.name,n.options,e);LR("Invalid Firebase Database URL",o),et(o.path)||ti("Database URL must point to the root of a Firebase Database (not including a child path).");const f=KF(a,n,h,new Kj(n,t));return new JF(f,n)}function QF(n,e){const t=Sv[e];(!t||t[n.key]!==n)&&ti(`Database ${e}(${n.repoInfo_}) has already been deleted.`),$R(n),delete t[n.key]}function KF(n,e,t,r){let s=Sv[e.name];s||(s={},Sv[e.name]=s);let i=s[n.toURLString()];return i&&ti("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new mF(n,YR,t,r),s[n.toURLString()]=i,i}function YF(n){YR=n}let JF=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(pF(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Rs(this._repo,yt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(QF(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ti("Cannot call "+e+" on a deleted database.")}};function XR(){hc.IS_TRANSPORT_INITIALIZED&&ir("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function P8(){XR(),ao.forceDisallow()}function D8(){XR(),ns.forceDisallow(),ao.forceAllow()}function XF(n=gh(),e){const t=si(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=gC("database");r&&ZF(t,...r)}return t}function ZF(n,e,t,r={}){n=le(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Gr(r,i.repoInfo_.emulatorOptions))return;ti("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ti('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Jl(Jl.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:vC(r.mockUserToken,n.app.options.projectId);o=new Jl(a)}Pi(e)&&(Wp(e),Y0("Database",!0)),HF(i,s,r,o)}function O8(n){n=le(n),n._checkNotDeleted("goOffline"),$R(n._repo)}function M8(n){n=le(n),n._checkNotDeleted("goOnline"),EF(n._repo)}function L8(n,e){VC(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e3(n){OC(el),Ts(new Rr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return JR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Ar(cE,uE,n),Ar(cE,uE,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t3={".sv":"timestamp"};function j8(){return t3}function V8(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function F8(n,e,t){if(n=le(n),zs("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new Vr,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new ja(u,new Rs(n._repo,n._path),Vt),s.resolve(new n3(l,h)))},o=Vw(n,()=>{});return bF(n._repo,n._path,e,i,o,r),s.promise}os.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};os.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const U8=function(n){const e=os.prototype.put;return os.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){os.prototype.put=e}},$8=function(n){YF(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B8({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){OC(t);const o=new AC("database-standalone"),a=new ev("auth-internal",o);let l;return s&&(l=new ev("app-check-internal",o),l.setComponent(new Rr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Rr("auth-internal",()=>r,"PRIVATE")),JR(n,a,l,e,i)}e3();var BE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Eo,ZR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(N,w){function T(){}T.prototype=w.prototype,N.D=w.prototype,N.prototype=new T,N.prototype.constructor=N,N.C=function(A,b,C){for(var v=Array(arguments.length-2),B=2;B<arguments.length;B++)v[B-2]=arguments[B];return w.prototype[b].apply(A,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(N,w,T){T||(T=0);var A=Array(16);if(typeof w=="string")for(var b=0;16>b;++b)A[b]=w.charCodeAt(T++)|w.charCodeAt(T++)<<8|w.charCodeAt(T++)<<16|w.charCodeAt(T++)<<24;else for(b=0;16>b;++b)A[b]=w[T++]|w[T++]<<8|w[T++]<<16|w[T++]<<24;w=N.g[0],T=N.g[1],b=N.g[2];var C=N.g[3],v=w+(C^T&(b^C))+A[0]+3614090360&4294967295;w=T+(v<<7&4294967295|v>>>25),v=C+(b^w&(T^b))+A[1]+3905402710&4294967295,C=w+(v<<12&4294967295|v>>>20),v=b+(T^C&(w^T))+A[2]+606105819&4294967295,b=C+(v<<17&4294967295|v>>>15),v=T+(w^b&(C^w))+A[3]+3250441966&4294967295,T=b+(v<<22&4294967295|v>>>10),v=w+(C^T&(b^C))+A[4]+4118548399&4294967295,w=T+(v<<7&4294967295|v>>>25),v=C+(b^w&(T^b))+A[5]+1200080426&4294967295,C=w+(v<<12&4294967295|v>>>20),v=b+(T^C&(w^T))+A[6]+2821735955&4294967295,b=C+(v<<17&4294967295|v>>>15),v=T+(w^b&(C^w))+A[7]+4249261313&4294967295,T=b+(v<<22&4294967295|v>>>10),v=w+(C^T&(b^C))+A[8]+1770035416&4294967295,w=T+(v<<7&4294967295|v>>>25),v=C+(b^w&(T^b))+A[9]+2336552879&4294967295,C=w+(v<<12&4294967295|v>>>20),v=b+(T^C&(w^T))+A[10]+4294925233&4294967295,b=C+(v<<17&4294967295|v>>>15),v=T+(w^b&(C^w))+A[11]+2304563134&4294967295,T=b+(v<<22&4294967295|v>>>10),v=w+(C^T&(b^C))+A[12]+1804603682&4294967295,w=T+(v<<7&4294967295|v>>>25),v=C+(b^w&(T^b))+A[13]+4254626195&4294967295,C=w+(v<<12&4294967295|v>>>20),v=b+(T^C&(w^T))+A[14]+2792965006&4294967295,b=C+(v<<17&4294967295|v>>>15),v=T+(w^b&(C^w))+A[15]+1236535329&4294967295,T=b+(v<<22&4294967295|v>>>10),v=w+(b^C&(T^b))+A[1]+4129170786&4294967295,w=T+(v<<5&4294967295|v>>>27),v=C+(T^b&(w^T))+A[6]+3225465664&4294967295,C=w+(v<<9&4294967295|v>>>23),v=b+(w^T&(C^w))+A[11]+643717713&4294967295,b=C+(v<<14&4294967295|v>>>18),v=T+(C^w&(b^C))+A[0]+3921069994&4294967295,T=b+(v<<20&4294967295|v>>>12),v=w+(b^C&(T^b))+A[5]+3593408605&4294967295,w=T+(v<<5&4294967295|v>>>27),v=C+(T^b&(w^T))+A[10]+38016083&4294967295,C=w+(v<<9&4294967295|v>>>23),v=b+(w^T&(C^w))+A[15]+3634488961&4294967295,b=C+(v<<14&4294967295|v>>>18),v=T+(C^w&(b^C))+A[4]+3889429448&4294967295,T=b+(v<<20&4294967295|v>>>12),v=w+(b^C&(T^b))+A[9]+568446438&4294967295,w=T+(v<<5&4294967295|v>>>27),v=C+(T^b&(w^T))+A[14]+3275163606&4294967295,C=w+(v<<9&4294967295|v>>>23),v=b+(w^T&(C^w))+A[3]+4107603335&4294967295,b=C+(v<<14&4294967295|v>>>18),v=T+(C^w&(b^C))+A[8]+1163531501&4294967295,T=b+(v<<20&4294967295|v>>>12),v=w+(b^C&(T^b))+A[13]+2850285829&4294967295,w=T+(v<<5&4294967295|v>>>27),v=C+(T^b&(w^T))+A[2]+4243563512&4294967295,C=w+(v<<9&4294967295|v>>>23),v=b+(w^T&(C^w))+A[7]+1735328473&4294967295,b=C+(v<<14&4294967295|v>>>18),v=T+(C^w&(b^C))+A[12]+2368359562&4294967295,T=b+(v<<20&4294967295|v>>>12),v=w+(T^b^C)+A[5]+4294588738&4294967295,w=T+(v<<4&4294967295|v>>>28),v=C+(w^T^b)+A[8]+2272392833&4294967295,C=w+(v<<11&4294967295|v>>>21),v=b+(C^w^T)+A[11]+1839030562&4294967295,b=C+(v<<16&4294967295|v>>>16),v=T+(b^C^w)+A[14]+4259657740&4294967295,T=b+(v<<23&4294967295|v>>>9),v=w+(T^b^C)+A[1]+2763975236&4294967295,w=T+(v<<4&4294967295|v>>>28),v=C+(w^T^b)+A[4]+1272893353&4294967295,C=w+(v<<11&4294967295|v>>>21),v=b+(C^w^T)+A[7]+4139469664&4294967295,b=C+(v<<16&4294967295|v>>>16),v=T+(b^C^w)+A[10]+3200236656&4294967295,T=b+(v<<23&4294967295|v>>>9),v=w+(T^b^C)+A[13]+681279174&4294967295,w=T+(v<<4&4294967295|v>>>28),v=C+(w^T^b)+A[0]+3936430074&4294967295,C=w+(v<<11&4294967295|v>>>21),v=b+(C^w^T)+A[3]+3572445317&4294967295,b=C+(v<<16&4294967295|v>>>16),v=T+(b^C^w)+A[6]+76029189&4294967295,T=b+(v<<23&4294967295|v>>>9),v=w+(T^b^C)+A[9]+3654602809&4294967295,w=T+(v<<4&4294967295|v>>>28),v=C+(w^T^b)+A[12]+3873151461&4294967295,C=w+(v<<11&4294967295|v>>>21),v=b+(C^w^T)+A[15]+530742520&4294967295,b=C+(v<<16&4294967295|v>>>16),v=T+(b^C^w)+A[2]+3299628645&4294967295,T=b+(v<<23&4294967295|v>>>9),v=w+(b^(T|~C))+A[0]+4096336452&4294967295,w=T+(v<<6&4294967295|v>>>26),v=C+(T^(w|~b))+A[7]+1126891415&4294967295,C=w+(v<<10&4294967295|v>>>22),v=b+(w^(C|~T))+A[14]+2878612391&4294967295,b=C+(v<<15&4294967295|v>>>17),v=T+(C^(b|~w))+A[5]+4237533241&4294967295,T=b+(v<<21&4294967295|v>>>11),v=w+(b^(T|~C))+A[12]+1700485571&4294967295,w=T+(v<<6&4294967295|v>>>26),v=C+(T^(w|~b))+A[3]+2399980690&4294967295,C=w+(v<<10&4294967295|v>>>22),v=b+(w^(C|~T))+A[10]+4293915773&4294967295,b=C+(v<<15&4294967295|v>>>17),v=T+(C^(b|~w))+A[1]+2240044497&4294967295,T=b+(v<<21&4294967295|v>>>11),v=w+(b^(T|~C))+A[8]+1873313359&4294967295,w=T+(v<<6&4294967295|v>>>26),v=C+(T^(w|~b))+A[15]+4264355552&4294967295,C=w+(v<<10&4294967295|v>>>22),v=b+(w^(C|~T))+A[6]+2734768916&4294967295,b=C+(v<<15&4294967295|v>>>17),v=T+(C^(b|~w))+A[13]+1309151649&4294967295,T=b+(v<<21&4294967295|v>>>11),v=w+(b^(T|~C))+A[4]+4149444226&4294967295,w=T+(v<<6&4294967295|v>>>26),v=C+(T^(w|~b))+A[11]+3174756917&4294967295,C=w+(v<<10&4294967295|v>>>22),v=b+(w^(C|~T))+A[2]+718787259&4294967295,b=C+(v<<15&4294967295|v>>>17),v=T+(C^(b|~w))+A[9]+3951481745&4294967295,N.g[0]=N.g[0]+w&4294967295,N.g[1]=N.g[1]+(b+(v<<21&4294967295|v>>>11))&4294967295,N.g[2]=N.g[2]+b&4294967295,N.g[3]=N.g[3]+C&4294967295}r.prototype.u=function(N,w){w===void 0&&(w=N.length);for(var T=w-this.blockSize,A=this.B,b=this.h,C=0;C<w;){if(b==0)for(;C<=T;)s(this,N,C),C+=this.blockSize;if(typeof N=="string"){for(;C<w;)if(A[b++]=N.charCodeAt(C++),b==this.blockSize){s(this,A),b=0;break}}else for(;C<w;)if(A[b++]=N[C++],b==this.blockSize){s(this,A),b=0;break}}this.h=b,this.o+=w},r.prototype.v=function(){var N=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);N[0]=128;for(var w=1;w<N.length-8;++w)N[w]=0;var T=8*this.o;for(w=N.length-8;w<N.length;++w)N[w]=T&255,T/=256;for(this.u(N),N=Array(16),w=T=0;4>w;++w)for(var A=0;32>A;A+=8)N[T++]=this.g[w]>>>A&255;return N};function i(N,w){var T=a;return Object.prototype.hasOwnProperty.call(T,N)?T[N]:T[N]=w(N)}function o(N,w){this.h=w;for(var T=[],A=!0,b=N.length-1;0<=b;b--){var C=N[b]|0;A&&C==w||(T[b]=C,A=!1)}this.g=T}var a={};function l(N){return-128<=N&&128>N?i(N,function(w){return new o([w|0],0>w?-1:0)}):new o([N|0],0>N?-1:0)}function u(N){if(isNaN(N)||!isFinite(N))return f;if(0>N)return k(u(-N));for(var w=[],T=1,A=0;N>=T;A++)w[A]=N/T|0,T*=4294967296;return new o(w,0)}function h(N,w){if(N.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(N.charAt(0)=="-")return k(h(N.substring(1),w));if(0<=N.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=u(Math.pow(w,8)),A=f,b=0;b<N.length;b+=8){var C=Math.min(8,N.length-b),v=parseInt(N.substring(b,b+C),w);8>C?(C=u(Math.pow(w,C)),A=A.j(C).add(u(v))):(A=A.j(T),A=A.add(u(v)))}return A}var f=l(0),m=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(E(this))return-k(this).m();for(var N=0,w=1,T=0;T<this.g.length;T++){var A=this.i(T);N+=(0<=A?A:4294967296+A)*w,w*=4294967296}return N},n.toString=function(N){if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(_(this))return"0";if(E(this))return"-"+k(this).toString(N);for(var w=u(Math.pow(N,6)),T=this,A="";;){var b=P(T,w).g;T=I(T,b.j(w));var C=((0<T.g.length?T.g[0]:T.h)>>>0).toString(N);if(T=b,_(T))return C+A;for(;6>C.length;)C="0"+C;A=C+A}},n.i=function(N){return 0>N?0:N<this.g.length?this.g[N]:this.h};function _(N){if(N.h!=0)return!1;for(var w=0;w<N.g.length;w++)if(N.g[w]!=0)return!1;return!0}function E(N){return N.h==-1}n.l=function(N){return N=I(this,N),E(N)?-1:_(N)?0:1};function k(N){for(var w=N.g.length,T=[],A=0;A<w;A++)T[A]=~N.g[A];return new o(T,~N.h).add(m)}n.abs=function(){return E(this)?k(this):this},n.add=function(N){for(var w=Math.max(this.g.length,N.g.length),T=[],A=0,b=0;b<=w;b++){var C=A+(this.i(b)&65535)+(N.i(b)&65535),v=(C>>>16)+(this.i(b)>>>16)+(N.i(b)>>>16);A=v>>>16,C&=65535,v&=65535,T[b]=v<<16|C}return new o(T,T[T.length-1]&-2147483648?-1:0)};function I(N,w){return N.add(k(w))}n.j=function(N){if(_(this)||_(N))return f;if(E(this))return E(N)?k(this).j(k(N)):k(k(this).j(N));if(E(N))return k(this.j(k(N)));if(0>this.l(y)&&0>N.l(y))return u(this.m()*N.m());for(var w=this.g.length+N.g.length,T=[],A=0;A<2*w;A++)T[A]=0;for(A=0;A<this.g.length;A++)for(var b=0;b<N.g.length;b++){var C=this.i(A)>>>16,v=this.i(A)&65535,B=N.i(b)>>>16,ge=N.i(b)&65535;T[2*A+2*b]+=v*ge,x(T,2*A+2*b),T[2*A+2*b+1]+=C*ge,x(T,2*A+2*b+1),T[2*A+2*b+1]+=v*B,x(T,2*A+2*b+1),T[2*A+2*b+2]+=C*B,x(T,2*A+2*b+2)}for(A=0;A<w;A++)T[A]=T[2*A+1]<<16|T[2*A];for(A=w;A<2*w;A++)T[A]=0;return new o(T,0)};function x(N,w){for(;(N[w]&65535)!=N[w];)N[w+1]+=N[w]>>>16,N[w]&=65535,w++}function R(N,w){this.g=N,this.h=w}function P(N,w){if(_(w))throw Error("division by zero");if(_(N))return new R(f,f);if(E(N))return w=P(k(N),w),new R(k(w.g),k(w.h));if(E(w))return w=P(N,k(w)),new R(k(w.g),w.h);if(30<N.g.length){if(E(N)||E(w))throw Error("slowDivide_ only works with positive integers.");for(var T=m,A=w;0>=A.l(N);)T=$(T),A=$(A);var b=M(T,1),C=M(A,1);for(A=M(A,2),T=M(T,2);!_(A);){var v=C.add(A);0>=v.l(N)&&(b=b.add(T),C=v),A=M(A,1),T=M(T,1)}return w=I(N,b.j(w)),new R(b,w)}for(b=f;0<=N.l(w);){for(T=Math.max(1,Math.floor(N.m()/w.m())),A=Math.ceil(Math.log(T)/Math.LN2),A=48>=A?1:Math.pow(2,A-48),C=u(T),v=C.j(w);E(v)||0<v.l(N);)T-=A,C=u(T),v=C.j(w);_(C)&&(C=m),b=b.add(C),N=I(N,v)}return new R(b,N)}n.A=function(N){return P(this,N).h},n.and=function(N){for(var w=Math.max(this.g.length,N.g.length),T=[],A=0;A<w;A++)T[A]=this.i(A)&N.i(A);return new o(T,this.h&N.h)},n.or=function(N){for(var w=Math.max(this.g.length,N.g.length),T=[],A=0;A<w;A++)T[A]=this.i(A)|N.i(A);return new o(T,this.h|N.h)},n.xor=function(N){for(var w=Math.max(this.g.length,N.g.length),T=[],A=0;A<w;A++)T[A]=this.i(A)^N.i(A);return new o(T,this.h^N.h)};function $(N){for(var w=N.g.length+1,T=[],A=0;A<w;A++)T[A]=N.i(A)<<1|N.i(A-1)>>>31;return new o(T,N.h)}function M(N,w){var T=w>>5;w%=32;for(var A=N.g.length-T,b=[],C=0;C<A;C++)b[C]=0<w?N.i(C+T)>>>w|N.i(C+T+1)<<32-w:N.i(C+T);return new o(b,N.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ZR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Eo=o}).apply(typeof BE<"u"?BE:typeof self<"u"?self:typeof window<"u"?window:{});var Ef=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var eN,ju,tN,em,Iv,nN,rN,sN;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,p,g){return d==Array.prototype||d==Object.prototype||(d[p]=g.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ef=="object"&&Ef];for(var p=0;p<d.length;++p){var g=d[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(d,p){if(p)e:{var g=r;d=d.split(".");for(var S=0;S<d.length-1;S++){var j=d[S];if(!(j in g))break e;g=g[j]}d=d[d.length-1],S=g[d],p=p(S),p!=S&&p!=null&&e(g,d,{configurable:!0,writable:!0,value:p})}}function i(d,p){d instanceof String&&(d+="");var g=0,S=!1,j={next:function(){if(!S&&g<d.length){var U=g++;return{value:p(U,d[U]),done:!1}}return S=!0,{done:!0,value:void 0}}};return j[Symbol.iterator]=function(){return j},j}s("Array.prototype.values",function(d){return d||function(){return i(this,function(p,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(d){var p=typeof d;return p=p!="object"?p:d?Array.isArray(d)?"array":p:"null",p=="array"||p=="object"&&typeof d.length=="number"}function u(d){var p=typeof d;return p=="object"&&d!=null||p=="function"}function h(d,p,g){return d.call.apply(d.bind,arguments)}function f(d,p,g){if(!d)throw Error();if(2<arguments.length){var S=Array.prototype.slice.call(arguments,2);return function(){var j=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(j,S),d.apply(p,j)}}return function(){return d.apply(p,arguments)}}function m(d,p,g){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function y(d,p){var g=Array.prototype.slice.call(arguments,1);return function(){var S=g.slice();return S.push.apply(S,arguments),d.apply(this,S)}}function _(d,p){function g(){}g.prototype=p.prototype,d.aa=p.prototype,d.prototype=new g,d.prototype.constructor=d,d.Qb=function(S,j,U){for(var oe=Array(arguments.length-2),Dt=2;Dt<arguments.length;Dt++)oe[Dt-2]=arguments[Dt];return p.prototype[j].apply(S,oe)}}function E(d){const p=d.length;if(0<p){const g=Array(p);for(let S=0;S<p;S++)g[S]=d[S];return g}return[]}function k(d,p){for(let g=1;g<arguments.length;g++){const S=arguments[g];if(l(S)){const j=d.length||0,U=S.length||0;d.length=j+U;for(let oe=0;oe<U;oe++)d[j+oe]=S[oe]}else d.push(S)}}class I{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function x(d){return/^[\s\xa0]*$/.test(d)}function R(){var d=a.navigator;return d&&(d=d.userAgent)?d:""}function P(d){return P[" "](d),d}P[" "]=function(){};var $=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function M(d,p,g){for(const S in d)p.call(g,d[S],S,d)}function N(d,p){for(const g in d)p.call(void 0,d[g],g,d)}function w(d){const p={};for(const g in d)p[g]=d[g];return p}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(d,p){let g,S;for(let j=1;j<arguments.length;j++){S=arguments[j];for(g in S)d[g]=S[g];for(let U=0;U<T.length;U++)g=T[U],Object.prototype.hasOwnProperty.call(S,g)&&(d[g]=S[g])}}function b(d){var p=1;d=d.split(":");const g=[];for(;0<p&&d.length;)g.push(d.shift()),p--;return d.length&&g.push(d.join(":")),g}function C(d){a.setTimeout(()=>{throw d},0)}function v(){var d=we;let p=null;return d.g&&(p=d.g,d.g=d.g.next,d.g||(d.h=null),p.next=null),p}class B{constructor(){this.h=this.g=null}add(p,g){const S=ge.get();S.set(p,g),this.h?this.h.next=S:this.g=S,this.h=S}}var ge=new I(()=>new ke,d=>d.reset());class ke{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let _t,Y=!1,we=new B,re=()=>{const d=a.Promise.resolve(void 0);_t=()=>{d.then(Ee)}};var Ee=()=>{for(var d;d=v();){try{d.h.call(d.g)}catch(g){C(g)}var p=ge;p.j(d),100>p.h&&(p.h++,d.next=p.g,p.g=d)}Y=!1};function Oe(){this.s=this.s,this.C=this.C}Oe.prototype.s=!1,Oe.prototype.ma=function(){this.s||(this.s=!0,this.N())},Oe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function O(d,p){this.type=d,this.g=this.target=p,this.defaultPrevented=!1}O.prototype.h=function(){this.defaultPrevented=!0};var W=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var d=!1,p=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const g=()=>{};a.addEventListener("test",g,p),a.removeEventListener("test",g,p)}catch{}return d}();function ce(d,p){if(O.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var g=this.type=d.type,S=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=p,p=d.relatedTarget){if($){e:{try{P(p.nodeName);var j=!0;break e}catch{}j=!1}j||(p=null)}}else g=="mouseover"?p=d.fromElement:g=="mouseout"&&(p=d.toElement);this.relatedTarget=p,S?(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:me[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&ce.aa.h.call(this)}}_(ce,O);var me={2:"touch",3:"pen",4:"mouse"};ce.prototype.h=function(){ce.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var Te="closure_listenable_"+(1e6*Math.random()|0),de=0;function ne(d,p,g,S,j){this.listener=d,this.proxy=null,this.src=p,this.type=g,this.capture=!!S,this.ha=j,this.key=++de,this.da=this.fa=!1}function ye(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function fe(d){this.src=d,this.g={},this.h=0}fe.prototype.add=function(d,p,g,S,j){var U=d.toString();d=this.g[U],d||(d=this.g[U]=[],this.h++);var oe=_e(d,p,S,j);return-1<oe?(p=d[oe],g||(p.fa=!1)):(p=new ne(p,this.src,U,!!S,j),p.fa=g,d.push(p)),p};function pe(d,p){var g=p.type;if(g in d.g){var S=d.g[g],j=Array.prototype.indexOf.call(S,p,void 0),U;(U=0<=j)&&Array.prototype.splice.call(S,j,1),U&&(ye(p),d.g[g].length==0&&(delete d.g[g],d.h--))}}function _e(d,p,g,S){for(var j=0;j<d.length;++j){var U=d[j];if(!U.da&&U.listener==p&&U.capture==!!g&&U.ha==S)return j}return-1}var ze="closure_lm_"+(1e6*Math.random()|0),q={};function Z(d,p,g,S,j){if(S&&S.once)return Pe(d,p,g,S,j);if(Array.isArray(p)){for(var U=0;U<p.length;U++)Z(d,p[U],g,S,j);return null}return g=mt(g),d&&d[Te]?d.K(p,g,u(S)?!!S.capture:!!S,j):J(d,p,g,!1,S,j)}function J(d,p,g,S,j,U){if(!p)throw Error("Invalid event type");var oe=u(j)?!!j.capture:!!j,Dt=vt(d);if(Dt||(d[ze]=Dt=new fe(d)),g=Dt.add(p,g,S,oe,U),g.proxy)return g;if(S=Ve(),g.proxy=S,S.src=d,S.listener=g,d.addEventListener)W||(j=oe),j===void 0&&(j=!1),d.addEventListener(p.toString(),S,j);else if(d.attachEvent)d.attachEvent(Gt(p.toString()),S);else if(d.addListener&&d.removeListener)d.addListener(S);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Ve(){function d(g){return p.call(d.src,d.listener,g)}const p=Nt;return d}function Pe(d,p,g,S,j){if(Array.isArray(p)){for(var U=0;U<p.length;U++)Pe(d,p[U],g,S,j);return null}return g=mt(g),d&&d[Te]?d.L(p,g,u(S)?!!S.capture:!!S,j):J(d,p,g,!0,S,j)}function Ae(d,p,g,S,j){if(Array.isArray(p))for(var U=0;U<p.length;U++)Ae(d,p[U],g,S,j);else S=u(S)?!!S.capture:!!S,g=mt(g),d&&d[Te]?(d=d.i,p=String(p).toString(),p in d.g&&(U=d.g[p],g=_e(U,g,S,j),-1<g&&(ye(U[g]),Array.prototype.splice.call(U,g,1),U.length==0&&(delete d.g[p],d.h--)))):d&&(d=vt(d))&&(p=d.g[p.toString()],d=-1,p&&(d=_e(p,g,S,j)),(g=-1<d?p[d]:null)&&Rt(g))}function Rt(d){if(typeof d!="number"&&d&&!d.da){var p=d.src;if(p&&p[Te])pe(p.i,d);else{var g=d.type,S=d.proxy;p.removeEventListener?p.removeEventListener(g,S,d.capture):p.detachEvent?p.detachEvent(Gt(g),S):p.addListener&&p.removeListener&&p.removeListener(S),(g=vt(p))?(pe(g,d),g.h==0&&(g.src=null,p[ze]=null)):ye(d)}}}function Gt(d){return d in q?q[d]:q[d]="on"+d}function Nt(d,p){if(d.da)d=!0;else{p=new ce(p,this);var g=d.listener,S=d.ha||d.src;d.fa&&Rt(d),d=g.call(S,p)}return d}function vt(d){return d=d[ze],d instanceof fe?d:null}var kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function mt(d){return typeof d=="function"?d:(d[kt]||(d[kt]=function(p){return d.handleEvent(p)}),d[kt])}function Re(){Oe.call(this),this.i=new fe(this),this.M=this,this.F=null}_(Re,Oe),Re.prototype[Te]=!0,Re.prototype.removeEventListener=function(d,p,g,S){Ae(this,d,p,g,S)};function Je(d,p){var g,S=d.F;if(S)for(g=[];S;S=S.F)g.push(S);if(d=d.M,S=p.type||p,typeof p=="string")p=new O(p,d);else if(p instanceof O)p.target=p.target||d;else{var j=p;p=new O(S,d),A(p,j)}if(j=!0,g)for(var U=g.length-1;0<=U;U--){var oe=p.g=g[U];j=wn(oe,S,!0,p)&&j}if(oe=p.g=d,j=wn(oe,S,!0,p)&&j,j=wn(oe,S,!1,p)&&j,g)for(U=0;U<g.length;U++)oe=p.g=g[U],j=wn(oe,S,!1,p)&&j}Re.prototype.N=function(){if(Re.aa.N.call(this),this.i){var d=this.i,p;for(p in d.g){for(var g=d.g[p],S=0;S<g.length;S++)ye(g[S]);delete d.g[p],d.h--}}this.F=null},Re.prototype.K=function(d,p,g,S){return this.i.add(String(d),p,!1,g,S)},Re.prototype.L=function(d,p,g,S){return this.i.add(String(d),p,!0,g,S)};function wn(d,p,g,S){if(p=d.i.g[String(p)],!p)return!0;p=p.concat();for(var j=!0,U=0;U<p.length;++U){var oe=p[U];if(oe&&!oe.da&&oe.capture==g){var Dt=oe.listener,Wn=oe.ha||oe.src;oe.fa&&pe(d.i,oe),j=Dt.call(Wn,S)!==!1&&j}}return j&&!S.defaultPrevented}function an(d,p,g){if(typeof d=="function")g&&(d=m(d,g));else if(d&&typeof d.handleEvent=="function")d=m(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(d,p||0)}function Pn(d){d.g=an(()=>{d.g=null,d.i&&(d.i=!1,Pn(d))},d.l);const p=d.h;d.h=null,d.m.apply(null,p)}class cr extends Oe{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Pn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ln(d){Oe.call(this),this.h=d,this.g={}}_(ln,Oe);var kr=[];function It(d){M(d.g,function(p,g){this.g.hasOwnProperty(g)&&Rt(p)},d),d.g={}}ln.prototype.N=function(){ln.aa.N.call(this),It(this)},ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cn=a.JSON.stringify,mn=a.JSON.parse,xn=class{stringify(d){return a.JSON.stringify(d,void 0)}parse(d){return a.JSON.parse(d,void 0)}};function ur(){}ur.prototype.h=null;function dt(d){return d.h||(d.h=d.i())}function ut(){}var Sn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Pr(){O.call(this,"d")}_(Pr,O);function ks(){O.call(this,"c")}_(ks,O);var dr={},Xo=null;function ds(){return Xo=Xo||new Re}dr.La="serverreachability";function Qh(d){O.call(this,dr.La,d)}_(Qh,O);function Fi(d){const p=ds();Je(p,new Qh(p))}dr.STAT_EVENT="statevent";function Kh(d,p){O.call(this,dr.STAT_EVENT,d),this.stat=p}_(Kh,O);function qn(d){const p=ds();Je(p,new Kh(p,d))}dr.Ma="timingevent";function hl(d,p){O.call(this,dr.Ma,d),this.size=p}_(hl,O);function ii(d,p){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){d()},p)}function Zo(){this.g=!0}Zo.prototype.xa=function(){this.g=!1};function Jg(d,p,g,S,j,U){d.info(function(){if(d.g)if(U)for(var oe="",Dt=U.split("&"),Wn=0;Wn<Dt.length;Wn++){var gt=Dt[Wn].split("=");if(1<gt.length){var Xn=gt[0];gt=gt[1];var Zn=Xn.split("_");oe=2<=Zn.length&&Zn[1]=="type"?oe+(Xn+"="+gt+"&"):oe+(Xn+"=redacted&")}}else oe=null;else oe=U;return"XMLHTTP REQ ("+S+") [attempt "+j+"]: "+p+`
`+g+`
`+oe})}function Xg(d,p,g,S,j,U,oe){d.info(function(){return"XMLHTTP RESP ("+S+") [ attempt "+j+"]: "+p+`
`+g+`
`+U+" "+oe})}function Ui(d,p,g,S){d.info(function(){return"XMLHTTP TEXT ("+p+"): "+Q(d,g)+(S?" "+S:"")})}function L(d,p){d.info(function(){return"TIMEOUT: "+p})}Zo.prototype.info=function(){};function Q(d,p){if(!d.g)return p;if(!p)return null;try{var g=JSON.parse(p);if(g){for(d=0;d<g.length;d++)if(Array.isArray(g[d])){var S=g[d];if(!(2>S.length)){var j=S[1];if(Array.isArray(j)&&!(1>j.length)){var U=j[0];if(U!="noop"&&U!="stop"&&U!="close")for(var oe=1;oe<j.length;oe++)j[oe]=""}}}}return cn(g)}catch{return p}}var z={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ue={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ce;function qe(){}_(qe,ur),qe.prototype.g=function(){return new XMLHttpRequest},qe.prototype.i=function(){return{}},Ce=new qe;function Se(d,p,g,S){this.j=d,this.i=p,this.l=g,this.R=S||1,this.U=new ln(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Me}function Me(){this.i=null,this.g="",this.h=!1}var Fe={},xt={};function He(d,p,g){d.L=1,d.v=Ds(Ht(p)),d.m=g,d.P=!0,Ge(d,null)}function Ge(d,p){d.F=Date.now(),Le(d),d.A=Ht(d.v);var g=d.A,S=d.R;Array.isArray(S)||(S=[String(S)]),wS(g.i,"t",S),d.C=0,g=d.j.J,d.h=new Me,d.g=VS(d.j,g?p:null,!d.m),0<d.O&&(d.M=new cr(m(d.Y,d,d.g),d.O)),p=d.U,g=d.g,S=d.ca;var j="readystatechange";Array.isArray(j)||(j&&(kr[0]=j.toString()),j=kr);for(var U=0;U<j.length;U++){var oe=Z(g,j[U],S||p.handleEvent,!1,p.h||p);if(!oe)break;p.g[oe.key]=oe}p=d.H?w(d.H):{},d.m?(d.u||(d.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,p)):(d.u="GET",d.g.ea(d.A,d.u,null,p)),Fi(),Jg(d.i,d.u,d.A,d.l,d.R,d.m)}Se.prototype.ca=function(d){d=d.target;const p=this.M;p&&oi(d)==3?p.j():this.Y(d)},Se.prototype.Y=function(d){try{if(d==this.g)e:{const Zn=oi(this.g);var p=this.g.Ba();const pl=this.g.Z();if(!(3>Zn)&&(Zn!=3||this.g&&(this.h.h||this.g.oa()||AS(this.g)))){this.J||Zn!=4||p==7||(p==8||0>=pl?Fi(3):Fi(2)),We(this);var g=this.g.Z();this.X=g;t:if(tt(this)){var S=AS(this.g);d="";var j=S.length,U=oi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){st(this),pn(this);var oe="";break t}this.h.i=new a.TextDecoder}for(p=0;p<j;p++)this.h.h=!0,d+=this.h.i.decode(S[p],{stream:!(U&&p==j-1)});S.length=0,this.h.g+=d,this.C=0,oe=this.h.g}else oe=this.g.oa();if(this.o=g==200,Xg(this.i,this.u,this.A,this.l,this.R,Zn,g),this.o){if(this.T&&!this.K){t:{if(this.g){var Dt,Wn=this.g;if((Dt=Wn.g?Wn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Dt)){var gt=Dt;break t}}gt=null}if(g=gt)Ui(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wt(this,g);else{this.o=!1,this.s=3,qn(12),st(this),pn(this);break e}}if(this.P){g=!0;let fs;for(;!this.J&&this.C<oe.length;)if(fs=Ue(this,oe),fs==xt){Zn==4&&(this.s=4,qn(14),g=!1),Ui(this.i,this.l,null,"[Incomplete Response]");break}else if(fs==Fe){this.s=4,qn(15),Ui(this.i,this.l,oe,"[Invalid Chunk]"),g=!1;break}else Ui(this.i,this.l,fs,null),wt(this,fs);if(tt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Zn!=4||oe.length!=0||this.h.h||(this.s=1,qn(16),g=!1),this.o=this.o&&g,!g)Ui(this.i,this.l,oe,"[Invalid Chunked Response]"),st(this),pn(this);else if(0<oe.length&&!this.W){this.W=!0;var Xn=this.j;Xn.g==this&&Xn.ba&&!Xn.M&&(Xn.j.info("Great, no buffering proxy detected. Bytes received: "+oe.length),ny(Xn),Xn.M=!0,qn(11))}}else Ui(this.i,this.l,oe,null),wt(this,oe);Zn==4&&st(this),this.o&&!this.J&&(Zn==4?OS(this.j,this):(this.o=!1,Le(this)))}else I2(this.g),g==400&&0<oe.indexOf("Unknown SID")?(this.s=3,qn(12)):(this.s=0,qn(13)),st(this),pn(this)}}}catch{}finally{}};function tt(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function Ue(d,p){var g=d.C,S=p.indexOf(`
`,g);return S==-1?xt:(g=Number(p.substring(g,S)),isNaN(g)?Fe:(S+=1,S+g>p.length?xt:(p=p.slice(S,S+g),d.C=S+g,p)))}Se.prototype.cancel=function(){this.J=!0,st(this)};function Le(d){d.S=Date.now()+d.I,Ne(d,d.I)}function Ne(d,p){if(d.B!=null)throw Error("WatchDog timer not null");d.B=ii(m(d.ba,d),p)}function We(d){d.B&&(a.clearTimeout(d.B),d.B=null)}Se.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(L(this.i,this.A),this.L!=2&&(Fi(),qn(17)),st(this),this.s=2,pn(this)):Ne(this,this.S-d)};function pn(d){d.j.G==0||d.J||OS(d.j,d)}function st(d){We(d);var p=d.M;p&&typeof p.ma=="function"&&p.ma(),d.M=null,It(d.U),d.g&&(p=d.g,d.g=null,p.abort(),p.ma())}function wt(d,p){try{var g=d.j;if(g.G!=0&&(g.g==d||ea(g.h,d))){if(!d.K&&ea(g.h,d)&&g.G==3){try{var S=g.Da.g.parse(p)}catch{S=null}if(Array.isArray(S)&&S.length==3){var j=S;if(j[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<d.F)tf(g),Zh(g);else break e;ty(g),qn(18)}}else g.za=j[1],0<g.za-g.T&&37500>j[2]&&g.F&&g.v==0&&!g.C&&(g.C=ii(m(g.Za,g),6e3));if(1>=Ps(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else na(g,11)}else if((d.K||g.g==d)&&tf(g),!x(p))for(j=g.Da.g.parse(p),p=0;p<j.length;p++){let gt=j[p];if(g.T=gt[0],gt=gt[1],g.G==2)if(gt[0]=="c"){g.K=gt[1],g.ia=gt[2];const Xn=gt[3];Xn!=null&&(g.la=Xn,g.j.info("VER="+g.la));const Zn=gt[4];Zn!=null&&(g.Aa=Zn,g.j.info("SVER="+g.Aa));const pl=gt[5];pl!=null&&typeof pl=="number"&&0<pl&&(S=1.5*pl,g.L=S,g.j.info("backChannelRequestTimeoutMs_="+S)),S=g;const fs=d.g;if(fs){const rf=fs.g?fs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(rf){var U=S.h;U.g||rf.indexOf("spdy")==-1&&rf.indexOf("quic")==-1&&rf.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(Dn(U,U.h),U.h=null))}if(S.D){const ry=fs.g?fs.g.getResponseHeader("X-HTTP-Session-Id"):null;ry&&(S.ya=ry,Pt(S.I,S.D,ry))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-d.F,g.j.info("Handshake RTT: "+g.R+"ms")),S=g;var oe=d;if(S.qa=jS(S,S.J?S.ia:null,S.W),oe.K){Ke(S.h,oe);var Dt=oe,Wn=S.L;Wn&&(Dt.I=Wn),Dt.B&&(We(Dt),Le(Dt)),S.g=oe}else PS(S);0<g.i.length&&ef(g)}else gt[0]!="stop"&&gt[0]!="close"||na(g,7);else g.G==3&&(gt[0]=="stop"||gt[0]=="close"?gt[0]=="stop"?na(g,7):ey(g):gt[0]!="noop"&&g.l&&g.l.ta(gt),g.v=0)}}Fi(4)}catch{}}var lt=class{constructor(d,p){this.g=d,this.map=p}};function Jn(d){this.l=d||10,a.PerformanceNavigationTiming?(d=a.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function hs(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function Ps(d){return d.h?1:d.g?d.g.size:0}function ea(d,p){return d.h?d.h==p:d.g?d.g.has(p):!1}function Dn(d,p){d.g?d.g.add(p):d.h=p}function Ke(d,p){d.h&&d.h==p?d.h=null:d.g&&d.g.has(p)&&d.g.delete(p)}Jn.prototype.cancel=function(){if(this.i=pt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function pt(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let p=d.i;for(const g of d.g.values())p=p.concat(g.D);return p}return E(d.i)}function gn(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(l(d)){for(var p=[],g=d.length,S=0;S<g;S++)p.push(d[S]);return p}p=[],g=0;for(S in d)p[g++]=d[S];return p}function en(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(l(d)||typeof d=="string"){var p=[];d=d.length;for(var g=0;g<d;g++)p.push(g);return p}p=[],g=0;for(const S in d)p[g++]=S;return p}}}function Dr(d,p){if(d.forEach&&typeof d.forEach=="function")d.forEach(p,void 0);else if(l(d)||typeof d=="string")Array.prototype.forEach.call(d,p,void 0);else for(var g=en(d),S=gn(d),j=S.length,U=0;U<j;U++)p.call(void 0,S[U],g&&g[U],d)}var $i=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Bi(d,p){if(d){d=d.split("&");for(var g=0;g<d.length;g++){var S=d[g].indexOf("="),j=null;if(0<=S){var U=d[g].substring(0,S);j=d[g].substring(S+1)}else U=d[g];p(U,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function _r(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof _r){this.h=d.h,At(this,d.j),this.o=d.o,this.g=d.g,Xr(this,d.s),this.l=d.l;var p=d.i,g=new ou;g.i=p.i,p.g&&(g.g=new Map(p.g),g.h=p.h),ta(this,g),this.m=d.m}else d&&(p=String(d).match($i))?(this.h=!1,At(this,p[1]||"",!0),this.o=su(p[2]||""),this.g=su(p[3]||"",!0),Xr(this,p[4]),this.l=su(p[5]||"",!0),ta(this,p[6]||"",!0),this.m=su(p[7]||"")):(this.h=!1,this.i=new ou(null,this.h))}_r.prototype.toString=function(){var d=[],p=this.j;p&&d.push(iu(p,yS,!0),":");var g=this.g;return(g||p=="file")&&(d.push("//"),(p=this.o)&&d.push(iu(p,yS,!0),"@"),d.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&d.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&d.push("/"),d.push(iu(g,g.charAt(0)=="/"?f2:h2,!0))),(g=this.i.toString())&&d.push("?",g),(g=this.m)&&d.push("#",iu(g,p2)),d.join("")};function Ht(d){return new _r(d)}function At(d,p,g){d.j=g?su(p,!0):p,d.j&&(d.j=d.j.replace(/:$/,""))}function Xr(d,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);d.s=p}else d.s=null}function ta(d,p,g){p instanceof ou?(d.i=p,g2(d.i,d.h)):(g||(p=iu(p,m2)),d.i=new ou(p,d.h))}function Pt(d,p,g){d.i.set(p,g)}function Ds(d){return Pt(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function su(d,p){return d?p?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function iu(d,p,g){return typeof d=="string"?(d=encodeURI(d).replace(p,d2),g&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function d2(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var yS=/[#\/\?@]/g,h2=/[#\?:]/g,f2=/[#\?]/g,m2=/[#\?@]/g,p2=/#/g;function ou(d,p){this.h=this.g=null,this.i=d||null,this.j=!!p}function zi(d){d.g||(d.g=new Map,d.h=0,d.i&&Bi(d.i,function(p,g){d.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}n=ou.prototype,n.add=function(d,p){zi(this),this.i=null,d=fl(this,d);var g=this.g.get(d);return g||this.g.set(d,g=[]),g.push(p),this.h+=1,this};function _S(d,p){zi(d),p=fl(d,p),d.g.has(p)&&(d.i=null,d.h-=d.g.get(p).length,d.g.delete(p))}function vS(d,p){return zi(d),p=fl(d,p),d.g.has(p)}n.forEach=function(d,p){zi(this),this.g.forEach(function(g,S){g.forEach(function(j){d.call(p,j,S,this)},this)},this)},n.na=function(){zi(this);const d=Array.from(this.g.values()),p=Array.from(this.g.keys()),g=[];for(let S=0;S<p.length;S++){const j=d[S];for(let U=0;U<j.length;U++)g.push(p[S])}return g},n.V=function(d){zi(this);let p=[];if(typeof d=="string")vS(this,d)&&(p=p.concat(this.g.get(fl(this,d))));else{d=Array.from(this.g.values());for(let g=0;g<d.length;g++)p=p.concat(d[g])}return p},n.set=function(d,p){return zi(this),this.i=null,d=fl(this,d),vS(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[p]),this.h+=1,this},n.get=function(d,p){return d?(d=this.V(d),0<d.length?String(d[0]):p):p};function wS(d,p,g){_S(d,p),0<g.length&&(d.i=null,d.g.set(fl(d,p),E(g)),d.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],p=Array.from(this.g.keys());for(var g=0;g<p.length;g++){var S=p[g];const U=encodeURIComponent(String(S)),oe=this.V(S);for(S=0;S<oe.length;S++){var j=U;oe[S]!==""&&(j+="="+encodeURIComponent(String(oe[S]))),d.push(j)}}return this.i=d.join("&")};function fl(d,p){return p=String(p),d.j&&(p=p.toLowerCase()),p}function g2(d,p){p&&!d.j&&(zi(d),d.i=null,d.g.forEach(function(g,S){var j=S.toLowerCase();S!=j&&(_S(this,S),wS(this,j,g))},d)),d.j=p}function y2(d,p){const g=new Zo;if(a.Image){const S=new Image;S.onload=y(qi,g,"TestLoadImage: loaded",!0,p,S),S.onerror=y(qi,g,"TestLoadImage: error",!1,p,S),S.onabort=y(qi,g,"TestLoadImage: abort",!1,p,S),S.ontimeout=y(qi,g,"TestLoadImage: timeout",!1,p,S),a.setTimeout(function(){S.ontimeout&&S.ontimeout()},1e4),S.src=d}else p(!1)}function _2(d,p){const g=new Zo,S=new AbortController,j=setTimeout(()=>{S.abort(),qi(g,"TestPingServer: timeout",!1,p)},1e4);fetch(d,{signal:S.signal}).then(U=>{clearTimeout(j),U.ok?qi(g,"TestPingServer: ok",!0,p):qi(g,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(j),qi(g,"TestPingServer: error",!1,p)})}function qi(d,p,g,S,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),S(g)}catch{}}function v2(){this.g=new xn}function w2(d,p,g){const S=g||"";try{Dr(d,function(j,U){let oe=j;u(j)&&(oe=cn(j)),p.push(S+U+"="+encodeURIComponent(oe))})}catch(j){throw p.push(S+"type="+encodeURIComponent("_badmap")),j}}function Yh(d){this.l=d.Ub||null,this.j=d.eb||!1}_(Yh,ur),Yh.prototype.g=function(){return new Jh(this.l,this.j)},Yh.prototype.i=function(d){return function(){return d}}({});function Jh(d,p){Re.call(this),this.D=d,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}_(Jh,Re),n=Jh.prototype,n.open=function(d,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=p,this.readyState=1,lu(this)},n.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(p.body=d),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,au(this)),this.readyState=0},n.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,lu(this)),this.g&&(this.readyState=3,lu(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;xS(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function xS(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}n.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var p=d.value?d.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!d.done}))&&(this.response=this.responseText+=p)}d.done?au(this):lu(this),this.readyState==3&&xS(this)}},n.Ra=function(d){this.g&&(this.response=this.responseText=d,au(this))},n.Qa=function(d){this.g&&(this.response=d,au(this))},n.ga=function(){this.g&&au(this)};function au(d){d.readyState=4,d.l=null,d.j=null,d.v=null,lu(d)}n.setRequestHeader=function(d,p){this.u.append(d,p)},n.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],p=this.h.entries();for(var g=p.next();!g.done;)g=g.value,d.push(g[0]+": "+g[1]),g=p.next();return d.join(`\r
`)};function lu(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(Jh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function SS(d){let p="";return M(d,function(g,S){p+=S,p+=":",p+=g,p+=`\r
`}),p}function Zg(d,p,g){e:{for(S in g){var S=!1;break e}S=!0}S||(g=SS(g),typeof d=="string"?g!=null&&encodeURIComponent(String(g)):Pt(d,p,g))}function un(d){Re.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}_(un,Re);var x2=/^https?$/i,S2=["POST","PUT"];n=un.prototype,n.Ha=function(d){this.J=d},n.ea=function(d,p,g,S){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);p=p?p.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ce.g(),this.v=this.o?dt(this.o):dt(Ce),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(p,String(d),!0),this.B=!1}catch(U){IS(this,U);return}if(d=g||"",g=new Map(this.headers),S)if(Object.getPrototypeOf(S)===Object.prototype)for(var j in S)g.set(j,S[j]);else if(typeof S.keys=="function"&&typeof S.get=="function")for(const U of S.keys())g.set(U,S.get(U));else throw Error("Unknown input type for opt_headers: "+String(S));S=Array.from(g.keys()).find(U=>U.toLowerCase()=="content-type"),j=a.FormData&&d instanceof a.FormData,!(0<=Array.prototype.indexOf.call(S2,p,void 0))||S||j||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,oe]of g)this.g.setRequestHeader(U,oe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{TS(this),this.u=!0,this.g.send(d),this.u=!1}catch(U){IS(this,U)}};function IS(d,p){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=p,d.m=5,ES(d),Xh(d)}function ES(d){d.A||(d.A=!0,Je(d,"complete"),Je(d,"error"))}n.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,Je(this,"complete"),Je(this,"abort"),Xh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xh(this,!0)),un.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?bS(this):this.bb())},n.bb=function(){bS(this)};function bS(d){if(d.h&&typeof o<"u"&&(!d.v[1]||oi(d)!=4||d.Z()!=2)){if(d.u&&oi(d)==4)an(d.Ea,0,d);else if(Je(d,"readystatechange"),oi(d)==4){d.h=!1;try{const oe=d.Z();e:switch(oe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var S;if(S=oe===0){var j=String(d.D).match($i)[1]||null;!j&&a.self&&a.self.location&&(j=a.self.location.protocol.slice(0,-1)),S=!x2.test(j?j.toLowerCase():"")}g=S}if(g)Je(d,"complete"),Je(d,"success");else{d.m=6;try{var U=2<oi(d)?d.g.statusText:""}catch{U=""}d.l=U+" ["+d.Z()+"]",ES(d)}}finally{Xh(d)}}}}function Xh(d,p){if(d.g){TS(d);const g=d.g,S=d.v[0]?()=>{}:null;d.g=null,d.v=null,p||Je(d,"ready");try{g.onreadystatechange=S}catch{}}}function TS(d){d.I&&(a.clearTimeout(d.I),d.I=null)}n.isActive=function(){return!!this.g};function oi(d){return d.g?d.g.readyState:0}n.Z=function(){try{return 2<oi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(d){if(this.g){var p=this.g.responseText;return d&&p.indexOf(d)==0&&(p=p.substring(d.length)),mn(p)}};function AS(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function I2(d){const p={};d=(d.g&&2<=oi(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let S=0;S<d.length;S++){if(x(d[S]))continue;var g=b(d[S]);const j=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const U=p[j]||[];p[j]=U,U.push(g)}N(p,function(S){return S.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function cu(d,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[d]||p}function CS(d){this.Aa=0,this.i=[],this.j=new Zo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=cu("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=cu("baseRetryDelayMs",5e3,d),this.cb=cu("retryDelaySeedMs",1e4,d),this.Wa=cu("forwardChannelMaxRetries",2,d),this.wa=cu("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new Jn(d&&d.concurrentRequestLimit),this.Da=new v2,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=CS.prototype,n.la=8,n.G=1,n.connect=function(d,p,g,S){qn(0),this.W=d,this.H=p||{},g&&S!==void 0&&(this.H.OSID=g,this.H.OAID=S),this.F=this.X,this.I=jS(this,null,this.W),ef(this)};function ey(d){if(RS(d),d.G==3){var p=d.U++,g=Ht(d.I);if(Pt(g,"SID",d.K),Pt(g,"RID",p),Pt(g,"TYPE","terminate"),uu(d,g),p=new Se(d,d.j,p),p.L=2,p.v=Ds(Ht(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=p.v,g=!0),g||(p.g=VS(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Le(p)}LS(d)}function Zh(d){d.g&&(ny(d),d.g.cancel(),d.g=null)}function RS(d){Zh(d),d.u&&(a.clearTimeout(d.u),d.u=null),tf(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&a.clearTimeout(d.s),d.s=null)}function ef(d){if(!hs(d.h)&&!d.s){d.s=!0;var p=d.Ga;_t||re(),Y||(_t(),Y=!0),we.add(p,d),d.B=0}}function E2(d,p){return Ps(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=p.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=ii(m(d.Ga,d,p),MS(d,d.B)),d.B++,!0)}n.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const j=new Se(this,this.j,d);let U=this.o;if(this.S&&(U?(U=w(U),A(U,this.S)):U=this.S),this.m!==null||this.O||(j.H=U,U=null),this.P)e:{for(var p=0,g=0;g<this.i.length;g++){t:{var S=this.i[g];if("__data__"in S.map&&(S=S.map.__data__,typeof S=="string")){S=S.length;break t}S=void 0}if(S===void 0)break;if(p+=S,4096<p){p=g;break e}if(p===4096||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=kS(this,j,p),g=Ht(this.I),Pt(g,"RID",d),Pt(g,"CVER",22),this.D&&Pt(g,"X-HTTP-Session-Id",this.D),uu(this,g),U&&(this.O?p="headers="+encodeURIComponent(String(SS(U)))+"&"+p:this.m&&Zg(g,this.m,U)),Dn(this.h,j),this.Ua&&Pt(g,"TYPE","init"),this.P?(Pt(g,"$req",p),Pt(g,"SID","null"),j.T=!0,He(j,g,null)):He(j,g,p),this.G=2}}else this.G==3&&(d?NS(this,d):this.i.length==0||hs(this.h)||NS(this))};function NS(d,p){var g;p?g=p.l:g=d.U++;const S=Ht(d.I);Pt(S,"SID",d.K),Pt(S,"RID",g),Pt(S,"AID",d.T),uu(d,S),d.m&&d.o&&Zg(S,d.m,d.o),g=new Se(d,d.j,g,d.B+1),d.m===null&&(g.H=d.o),p&&(d.i=p.D.concat(d.i)),p=kS(d,g,1e3),g.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),Dn(d.h,g),He(g,S,p)}function uu(d,p){d.H&&M(d.H,function(g,S){Pt(p,S,g)}),d.l&&Dr({},function(g,S){Pt(p,S,g)})}function kS(d,p,g){g=Math.min(d.i.length,g);var S=d.l?m(d.l.Na,d.l,d):null;e:{var j=d.i;let U=-1;for(;;){const oe=["count="+g];U==-1?0<g?(U=j[0].g,oe.push("ofs="+U)):U=0:oe.push("ofs="+U);let Dt=!0;for(let Wn=0;Wn<g;Wn++){let gt=j[Wn].g;const Xn=j[Wn].map;if(gt-=U,0>gt)U=Math.max(0,j[Wn].g-100),Dt=!1;else try{w2(Xn,oe,"req"+gt+"_")}catch{S&&S(Xn)}}if(Dt){S=oe.join("&");break e}}}return d=d.i.splice(0,g),p.D=d,S}function PS(d){if(!d.g&&!d.u){d.Y=1;var p=d.Fa;_t||re(),Y||(_t(),Y=!0),we.add(p,d),d.v=0}}function ty(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=ii(m(d.Fa,d),MS(d,d.v)),d.v++,!0)}n.Fa=function(){if(this.u=null,DS(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=ii(m(this.ab,this),d)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qn(10),Zh(this),DS(this))};function ny(d){d.A!=null&&(a.clearTimeout(d.A),d.A=null)}function DS(d){d.g=new Se(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var p=Ht(d.qa);Pt(p,"RID","rpc"),Pt(p,"SID",d.K),Pt(p,"AID",d.T),Pt(p,"CI",d.F?"0":"1"),!d.F&&d.ja&&Pt(p,"TO",d.ja),Pt(p,"TYPE","xmlhttp"),uu(d,p),d.m&&d.o&&Zg(p,d.m,d.o),d.L&&(d.g.I=d.L);var g=d.g;d=d.ia,g.L=1,g.v=Ds(Ht(p)),g.m=null,g.P=!0,Ge(g,d)}n.Za=function(){this.C!=null&&(this.C=null,Zh(this),ty(this),qn(19))};function tf(d){d.C!=null&&(a.clearTimeout(d.C),d.C=null)}function OS(d,p){var g=null;if(d.g==p){tf(d),ny(d),d.g=null;var S=2}else if(ea(d.h,p))g=p.D,Ke(d.h,p),S=1;else return;if(d.G!=0){if(p.o)if(S==1){g=p.m?p.m.length:0,p=Date.now()-p.F;var j=d.B;S=ds(),Je(S,new hl(S,g)),ef(d)}else PS(d);else if(j=p.s,j==3||j==0&&0<p.X||!(S==1&&E2(d,p)||S==2&&ty(d)))switch(g&&0<g.length&&(p=d.h,p.i=p.i.concat(g)),j){case 1:na(d,5);break;case 4:na(d,10);break;case 3:na(d,6);break;default:na(d,2)}}}function MS(d,p){let g=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(g*=2),g*p}function na(d,p){if(d.j.info("Error code "+p),p==2){var g=m(d.fb,d),S=d.Xa;const j=!S;S=new _r(S||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||At(S,"https"),Ds(S),j?y2(S.toString(),g):_2(S.toString(),g)}else qn(2);d.G=0,d.l&&d.l.sa(p),LS(d),RS(d)}n.fb=function(d){d?(this.j.info("Successfully pinged google.com"),qn(2)):(this.j.info("Failed to ping google.com"),qn(1))};function LS(d){if(d.G=0,d.ka=[],d.l){const p=pt(d.h);(p.length!=0||d.i.length!=0)&&(k(d.ka,p),k(d.ka,d.i),d.h.i.length=0,E(d.i),d.i.length=0),d.l.ra()}}function jS(d,p,g){var S=g instanceof _r?Ht(g):new _r(g);if(S.g!="")p&&(S.g=p+"."+S.g),Xr(S,S.s);else{var j=a.location;S=j.protocol,p=p?p+"."+j.hostname:j.hostname,j=+j.port;var U=new _r(null);S&&At(U,S),p&&(U.g=p),j&&Xr(U,j),g&&(U.l=g),S=U}return g=d.D,p=d.ya,g&&p&&Pt(S,g,p),Pt(S,"VER",d.la),uu(d,S),S}function VS(d,p,g){if(p&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=d.Ca&&!d.pa?new un(new Yh({eb:g})):new un(d.pa),p.Ha(d.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function FS(){}n=FS.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function nf(){}nf.prototype.g=function(d,p){return new Or(d,p)};function Or(d,p){Re.call(this),this.g=new CS(p),this.l=d,this.h=p&&p.messageUrlParams||null,d=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(d?d["X-WebChannel-Content-Type"]=p.messageContentType:d={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(d?d["X-WebChannel-Client-Profile"]=p.va:d={"X-WebChannel-Client-Profile":p.va}),this.g.S=d,(d=p&&p.Sb)&&!x(d)&&(this.g.m=d),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!x(p)&&(this.g.D=p,d=this.h,d!==null&&p in d&&(d=this.h,p in d&&delete d[p])),this.j=new ml(this)}_(Or,Re),Or.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Or.prototype.close=function(){ey(this.g)},Or.prototype.o=function(d){var p=this.g;if(typeof d=="string"){var g={};g.__data__=d,d=g}else this.u&&(g={},g.__data__=cn(d),d=g);p.i.push(new lt(p.Ya++,d)),p.G==3&&ef(p)},Or.prototype.N=function(){this.g.l=null,delete this.j,ey(this.g),delete this.g,Or.aa.N.call(this)};function US(d){Pr.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var p=d.__sm__;if(p){e:{for(const g in p){d=g;break e}d=void 0}(this.i=d)&&(d=this.i,p=p!==null&&d in p?p[d]:void 0),this.data=p}else this.data=d}_(US,Pr);function $S(){ks.call(this),this.status=1}_($S,ks);function ml(d){this.g=d}_(ml,FS),ml.prototype.ua=function(){Je(this.g,"a")},ml.prototype.ta=function(d){Je(this.g,new US(d))},ml.prototype.sa=function(d){Je(this.g,new $S)},ml.prototype.ra=function(){Je(this.g,"b")},nf.prototype.createWebChannel=nf.prototype.g,Or.prototype.send=Or.prototype.o,Or.prototype.open=Or.prototype.m,Or.prototype.close=Or.prototype.close,sN=function(){return new nf},rN=function(){return ds()},nN=dr,Iv={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},z.NO_ERROR=0,z.TIMEOUT=8,z.HTTP_ERROR=6,em=z,ue.COMPLETE="complete",tN=ue,ut.EventType=Sn,Sn.OPEN="a",Sn.CLOSE="b",Sn.ERROR="c",Sn.MESSAGE="d",Re.prototype.listen=Re.prototype.K,ju=ut,un.prototype.listenOnce=un.prototype.L,un.prototype.getLastError=un.prototype.Ka,un.prototype.getLastErrorCode=un.prototype.Ba,un.prototype.getStatus=un.prototype.Z,un.prototype.getResponseJson=un.prototype.Oa,un.prototype.getResponseText=un.prototype.oa,un.prototype.send=un.prototype.ea,un.prototype.setWithCredentials=un.prototype.Ha,eN=un}).apply(typeof Ef<"u"?Ef:typeof self<"u"?self:typeof window<"u"?window:{});const zE="@firebase/firestore",qE="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};jn.UNAUTHENTICATED=new jn(null),jn.GOOGLE_CREDENTIALS=new jn("google-credentials-uid"),jn.FIRST_PARTY=new jn("first-party-uid"),jn.MOCK_USER=new jn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo=new ph("@firebase/firestore");function bl(){return Mo.logLevel}function q8(n){Mo.setLogLevel(n)}function K(n,...e){if(Mo.logLevel<=it.DEBUG){const t=e.map(Fw);Mo.debug(`Firestore (${Gc}): ${n}`,...t)}}function _n(n,...e){if(Mo.logLevel<=it.ERROR){const t=e.map(Fw);Mo.error(`Firestore (${Gc}): ${n}`,...t)}}function cs(n,...e){if(Mo.logLevel<=it.WARN){const t=e.map(Fw);Mo.warn(`Firestore (${Gc}): ${n}`,...t)}}function Fw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,iN(n,r,t)}function iN(n,e,t){let r=`FIRESTORE (${Gc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw _n(r),new Error(r)}function Ie(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||iN(e,s,r)}function W8(n,e){n||he(57014,e)}function ie(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class G extends As{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oN{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class r3{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(jn.UNAUTHENTICATED))}shutdown(){}}class s3{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class i3{constructor(e){this.t=e,this.currentUser=jn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ie(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Un;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Un,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Un)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ie(typeof r.accessToken=="string",31837,{l:r}),new oN(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ie(e===null||typeof e=="string",2055,{h:e}),new jn(e)}}class o3{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=jn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class a3{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new o3(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(jn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ev{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class l3{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Yt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Ie(this.o===void 0,3512);const r=i=>{i.error!=null&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,K("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ev(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ie(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ev(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class G8{getToken(){return Promise.resolve(new Ev(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c3(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=c3(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Be(n,e){return n<e?-1:n>e?1:0}function bv(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return $y(s)===$y(i)?Be(s,i):$y(s)?1:-1}return Be(n.length,e.length)}const u3=55296,d3=57343;function $y(n){const e=n.charCodeAt(0);return e>=u3&&e<=d3}function _c(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function aN(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tv="__name__";class Vs{constructor(e,t,r){t===void 0?t=0:t>e.length&&he(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&he(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Vs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Vs?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Vs.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Be(e.length,t.length)}static compareSegments(e,t){const r=Vs.isNumericId(e),s=Vs.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Vs.extractNumericId(e).compare(Vs.extractNumericId(t)):bv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Eo.fromString(e.substring(4,e.length-2))}}class rt extends Vs{construct(e,t,r){return new rt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new G(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new rt(t)}static emptyPath(){return new rt([])}}const h3=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xt extends Vs{construct(e,t,r){return new Xt(e,t,r)}static isValidIdentifier(e){return h3.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Tv}static keyField(){return new Xt([Tv])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new G(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new G(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new G(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new G(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Xt(t)}static emptyPath(){return new Xt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e){this.path=e}static fromPath(e){return new se(rt.fromString(e))}static fromName(e){return new se(rt.fromString(e).popFirst(5))}static empty(){return new se(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&rt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return rt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new rt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $w(n,e,t){if(!t)throw new G(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function f3(n,e,t,r){if(e===!0&&r===!0)throw new G(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function WE(n){if(!se.isDocumentKey(n))throw new G(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function GE(n){if(se.isDocumentKey(n))throw new G(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function lN(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function hg(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":he(12329,{type:typeof n})}function ot(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new G(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=hg(n);throw new G(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function cN(n,e){if(e<=0)throw new G(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(n,e){const t={typeString:n};return e&&(t.value=e),t}function sl(n,e){if(!lN(n))throw new G(F.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new G(F.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HE=-62135596800,QE=1e6;class Xe{static now(){return Xe.fromMillis(Date.now())}static fromDate(e){return Xe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*QE);return new Xe(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new G(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new G(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<HE)throw new G(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new G(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/QE}_compareTo(e){return this.seconds===e.seconds?Be(this.nanoseconds,e.nanoseconds):Be(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Xe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(sl(e,Xe._jsonSchema))return new Xe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-HE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Xe._jsonSchemaVersion="firestore/timestamp/1.0",Xe._jsonSchema={type:Tn("string",Xe._jsonSchemaVersion),seconds:Tn("number"),nanoseconds:Tn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{static fromTimestamp(e){return new be(e)}static min(){return new be(new Xe(0,0))}static max(){return new be(new Xe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vc=-1;class wc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Av(n){return n.fields.find(e=>e.kind===2)}function la(n){return n.fields.filter(e=>e.kind!==2)}function m3(n,e){let t=Be(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=p3(n.fields[r],e.fields[r]),t!==0)return t;return Be(n.fields.length,e.fields.length)}wc.UNKNOWN_ID=-1;class Ea{constructor(e,t){this.fieldPath=e,this.kind=t}}function p3(n,e){const t=Xt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Be(n.kind,e.kind)}class xc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new xc(0,Qr.min())}}function uN(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=be.fromTimestamp(r===1e9?new Xe(t+1,0):new Xe(t,r));return new Qr(s,se.empty(),e)}function dN(n){return new Qr(n.readTime,n.key,vc)}class Qr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Qr(be.min(),se.empty(),vc)}static max(){return new Qr(be.max(),se.empty(),vc)}}function Bw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=se.comparator(n.documentKey,e.documentKey),t!==0?t:Be(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Go(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==hN)throw n;K("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&he(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):V.reject(t)}static resolve(e){return new V((t,r)=>{t(e)})}static reject(e){return new V((t,r)=>{r(e)})}static waitFor(e){return new V((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=V.resolve(!1);for(const r of e)t=t.next(s=>s?V.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new V((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new V((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jr="SimpleDb";class fg{static open(e,t,r,s){try{return new fg(t,e.transaction(s,r))}catch(i){throw new nd(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Un,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new nd(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=zw(r.target.error);this.S.reject(new nd(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(K(jr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new y3(t)}}class Js{static delete(e){return K(jr,"Removing database:",e),ua(mC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Gp())return!1;if(Js.F())return!0;const e=Nn(),t=Js.M(e),r=0<t&&t<10,s=mN(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Js.M(Nn())===12.2&&_n("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(K(jr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new nd(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new G(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new G(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new nd(e,o))},s.onupgradeneeded=i=>{K(jr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{K(jr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=fg.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),V.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(K(jr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function mN(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class g3{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ua(this.U.delete())}}class nd extends G{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ho(n){return n.name==="IndexedDbTransactionError"}class y3{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(K(jr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(K(jr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ua(r)}add(e){return K(jr,"ADD",this.store.name,e,e),ua(this.store.add(e))}get(e){return ua(this.store.get(e)).next(t=>(t===void 0&&(t=null),K(jr,"GET",this.store.name,e,t),t))}delete(e){return K(jr,"DELETE",this.store.name,e),ua(this.store.delete(e))}count(){return K(jr,"COUNT",this.store.name),ua(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new V((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new V((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){K(jr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new V((r,s)=>{t.onerror=i=>{const o=zw(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new V((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new g3(a),u=t(a.primaryKey,a.value,l);if(u instanceof V){const h=u.catch(f=>(l.done(),V.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>V.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ua(n){return new V((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=zw(r.target.error);t(s)}})}let KE=!1;function zw(n){const e=Js.M(Nn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new G("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return KE||(KE=!0,setTimeout(()=>{throw r},0)),r}}return n}const rd="IndexBackfiller";class _3{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){K(rd,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();K(rd,`Documents written: ${t}`)}catch(t){Ho(t)?K(rd,"Ignoring IndexedDB error during index backfill: ",t):await Go(t)}await this.re(6e4)})}}class v3{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return V.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return K(rd,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(K(rd,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=dN(i);Bw(o,r)>0&&(r=o)}),new Qr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}xr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bo=-1;function Ah(n){return n==null}function Wd(n){return n===0&&1/n==-1/0}function pN(n){return typeof n=="number"&&Number.isInteger(n)&&!Wd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const op="";function or(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=YE(e)),e=w3(n.get(t),e);return YE(e)}function w3(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case op:t+="";break;default:t+=i}}return t}function YE(n){return n+op+""}function qs(n){const e=n.length;if(Ie(e>=2,64408,{path:n}),e===2)return Ie(n.charAt(0)===op&&n.charAt(1)==="",56145,{path:n}),rt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(op,i);switch((o<0||o>t)&&he(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:he(61167,{path:n})}i=o+2}return new rt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ca="remoteDocuments",Ch="owner",_l="owner",Gd="mutationQueues",x3="userId",ys="mutations",JE="batchId",_a="userMutationsIndex",XE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tm(n,e){return[n,or(e)]}function gN(n,e,t){return[n,or(e),t]}const S3={},Sc="documentMutations",ap="remoteDocumentsV14",I3=["prefixPath","collectionGroup","readTime","documentId"],nm="documentKeyIndex",E3=["prefixPath","collectionGroup","documentId"],yN="collectionGroupIndex",b3=["collectionGroup","readTime","prefixPath","documentId"],Hd="remoteDocumentGlobal",Cv="remoteDocumentGlobalKey",Ic="targets",_N="queryTargetsIndex",T3=["canonicalId","targetId"],Ec="targetDocuments",A3=["targetId","path"],qw="documentTargetsIndex",C3=["path","targetId"],lp="targetGlobalKey",ba="targetGlobal",Qd="collectionParents",R3=["collectionId","parent"],bc="clientMetadata",N3="clientId",mg="bundles",k3="bundleId",pg="namedQueries",P3="name",Ww="indexConfiguration",D3="indexId",Rv="collectionGroupIndex",O3="collectionGroup",sd="indexState",M3=["indexId","uid"],vN="sequenceNumberIndex",L3=["uid","sequenceNumber"],id="indexEntries",j3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wN="documentKeyIndex",V3=["indexId","uid","orderedDocumentKey"],gg="documentOverlays",F3=["userId","collectionPath","documentId"],Nv="collectionPathOverlayIndex",U3=["userId","collectionPath","largestBatchId"],xN="collectionGroupOverlayIndex",$3=["userId","collectionGroup","largestBatchId"],Gw="globals",B3="name",SN=[Gd,ys,Sc,ca,Ic,Ch,ba,Ec,bc,Hd,Qd,mg,pg],z3=[...SN,gg],IN=[Gd,ys,Sc,ap,Ic,Ch,ba,Ec,bc,Hd,Qd,mg,pg,gg],EN=IN,Hw=[...EN,Ww,sd,id],q3=Hw,bN=[...Hw,Gw],W3=bN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv extends fN{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function kn(n,e){const t=ie(n);return Js.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Qo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function TN(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function AN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e,t){this.comparator=e,this.root=t||Hn.EMPTY}insert(e,t){return new Ft(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Hn.BLACK,null,null))}remove(e){return new Ft(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Hn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bf(this.root,e,this.comparator,!1)}getReverseIterator(){return new bf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bf(this.root,e,this.comparator,!0)}}class bf{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Hn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Hn.RED,this.left=s??Hn.EMPTY,this.right=i??Hn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Hn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Hn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Hn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Hn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Hn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw he(43730,{key:this.key,value:this.value});if(this.right.isRed())throw he(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw he(27949);return e+(this.isRed()?0:1)}}Hn.EMPTY=null,Hn.RED=!0,Hn.BLACK=!1;Hn.EMPTY=new class{constructor(){this.size=0}get key(){throw he(57766)}get value(){throw he(16141)}get color(){throw he(16727)}get left(){throw he(29726)}get right(){throw he(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Hn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this.comparator=e,this.data=new Ft(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new eb(this.data.getIterator())}getIteratorFrom(e){return new eb(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Tt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Tt(this.comparator);return t.data=e,t}}class eb{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function vl(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e){this.fields=e,e.sort(Xt.comparator)}static empty(){return new Sr([])}unionWith(e){let t=new Tt(Xt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Sr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _c(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q8(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new CN("Invalid base64 string: "+i):i}}(e);return new hn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new hn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Be(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}hn.EMPTY_BYTE_STRING=new hn("");const G3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(n){if(Ie(!!n,39018),typeof n=="string"){let e=0;const t=G3.exec(n);if(Ie(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Qt(n.seconds),nanos:Qt(n.nanos)}}function Qt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ai(n){return typeof n=="string"?hn.fromBase64String(n):hn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RN="server_timestamp",NN="__type__",kN="__previous_value__",PN="__local_write_time__";function yg(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[NN])==null?void 0:r.stringValue)===RN}function _g(n){const e=n.mapValue.fields[kN];return yg(e)?_g(e):e}function Kd(n){const e=Ti(n.mapValue.fields[PN].timestampValue);return new Xe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const Yd="(default)";class Va{constructor(e,t){this.projectId=e,this.database=t||Yd}static empty(){return new Va("","")}get isDefaultDatabase(){return this.database===Yd}isEqual(e){return e instanceof Va&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qw="__type__",DN="__max__",co={mapValue:{fields:{__type__:{stringValue:DN}}}},Kw="__vector__",Tc="value",rm={nullValue:"NULL_VALUE"};function Lo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?yg(n)?4:ON(n)?9007199254740991:vg(n)?10:11:he(28295,{value:n})}function ri(n,e){if(n===e)return!0;const t=Lo(n);if(t!==Lo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Kd(n).isEqual(Kd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ti(s.timestampValue),a=Ti(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ai(s.bytesValue).isEqual(Ai(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Qt(s.geoPointValue.latitude)===Qt(i.geoPointValue.latitude)&&Qt(s.geoPointValue.longitude)===Qt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Qt(s.integerValue)===Qt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Qt(s.doubleValue),a=Qt(i.doubleValue);return o===a?Wd(o)===Wd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return _c(n.arrayValue.values||[],e.arrayValue.values||[],ri);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(ZE(o)!==ZE(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ri(o[l],a[l])))return!1;return!0}(n,e);default:return he(52216,{left:n})}}function Jd(n,e){return(n.values||[]).find(t=>ri(t,e))!==void 0}function jo(n,e){if(n===e)return 0;const t=Lo(n),r=Lo(e);if(t!==r)return Be(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Be(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Qt(i.integerValue||i.doubleValue),l=Qt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return tb(n.timestampValue,e.timestampValue);case 4:return tb(Kd(n),Kd(e));case 5:return bv(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ai(i),l=Ai(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Be(a[u],l[u]);if(h!==0)return h}return Be(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Be(Qt(i.latitude),Qt(o.latitude));return a!==0?a:Be(Qt(i.longitude),Qt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return nb(n.arrayValue,e.arrayValue);case 10:return function(i,o){var m,y,_,E;const a=i.fields||{},l=o.fields||{},u=(m=a[Tc])==null?void 0:m.arrayValue,h=(y=l[Tc])==null?void 0:y.arrayValue,f=Be(((_=u==null?void 0:u.values)==null?void 0:_.length)||0,((E=h==null?void 0:h.values)==null?void 0:E.length)||0);return f!==0?f:nb(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===co.mapValue&&o===co.mapValue)return 0;if(i===co.mapValue)return 1;if(o===co.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const m=bv(l[f],h[f]);if(m!==0)return m;const y=jo(a[l[f]],u[h[f]]);if(y!==0)return y}return Be(l.length,h.length)}(n.mapValue,e.mapValue);default:throw he(23264,{he:t})}}function tb(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Be(n,e);const t=Ti(n),r=Ti(e),s=Be(t.seconds,r.seconds);return s!==0?s:Be(t.nanos,r.nanos)}function nb(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=jo(t[s],r[s]);if(i)return i}return Be(t.length,r.length)}function Ac(n){return Pv(n)}function Pv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ti(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ai(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return se.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Pv(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Pv(t.fields[o])}`;return s+"}"}(n.mapValue):he(61005,{value:n})}function sm(n){switch(Lo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_g(n);return e?16+sm(e):16;case 5:return 2*n.stringValue.length;case 6:return Ai(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+sm(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Qo(r.fields,(i,o)=>{s+=i.length+sm(o)}),s}(n.mapValue);default:throw he(13486,{value:n})}}function Fa(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Dv(n){return!!n&&"integerValue"in n}function Xd(n){return!!n&&"arrayValue"in n}function rb(n){return!!n&&"nullValue"in n}function sb(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function im(n){return!!n&&"mapValue"in n}function vg(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Qw])==null?void 0:r.stringValue)===Kw}function od(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Qo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=od(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=od(n.arrayValue.values[t]);return e}return{...n}}function ON(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===DN}const MN={mapValue:{fields:{[Qw]:{stringValue:Kw},[Tc]:{arrayValue:{}}}}};function Q3(n){return"nullValue"in n?rm:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Fa(Va.empty(),se.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?vg(n)?MN:{mapValue:{}}:he(35942,{value:n})}function K3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Fa(Va.empty(),se.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?MN:"mapValue"in n?vg(n)?{mapValue:{}}:co:he(61959,{value:n})}function ib(n,e){const t=jo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ob(n,e){const t=jo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.value=e}static empty(){return new Qn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!im(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=od(t)}setAll(e){let t=Xt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=od(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());im(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ri(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];im(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Qo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Qn(od(this.value))}}function LN(n){const e=[];return Qo(n.fields,(t,r)=>{const s=new Xt([t]);if(im(r)){const i=LN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Sr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Bt(e,0,be.min(),be.min(),be.min(),Qn.empty(),0)}static newFoundDocument(e,t,r,s){return new Bt(e,1,t,be.min(),r,s,0)}static newNoDocument(e,t){return new Bt(e,2,t,be.min(),be.min(),Qn.empty(),0)}static newUnknownDocument(e,t){return new Bt(e,3,t,be.min(),be.min(),Qn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(be.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=be.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Bt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e,t){this.position=e,this.inclusive=t}}function ab(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=se.comparator(se.fromName(o.referenceValue),t.key):r=jo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function lb(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ri(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(e,t="asc"){this.field=e,this.dir=t}}function Y3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jN{}class ct extends jN{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new J3(e,t,r):t==="array-contains"?new e6(e,r):t==="in"?new zN(e,r):t==="not-in"?new t6(e,r):t==="array-contains-any"?new n6(e,r):new ct(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new X3(e,r):new Z3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(jo(t,this.value)):t!==null&&Lo(this.value)===Lo(t)&&this.matchesComparison(jo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return he(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Et extends jN{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Et(e,t)}matches(e){return Cc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Cc(n){return n.op==="and"}function Ov(n){return n.op==="or"}function Yw(n){return VN(n)&&Cc(n)}function VN(n){for(const e of n.filters)if(e instanceof Et)return!1;return!0}function Mv(n){if(n instanceof ct)return n.field.canonicalString()+n.op.toString()+Ac(n.value);if(Yw(n))return n.filters.map(e=>Mv(e)).join(",");{const e=n.filters.map(t=>Mv(t)).join(",");return`${n.op}(${e})`}}function FN(n,e){return n instanceof ct?function(r,s){return s instanceof ct&&r.op===s.op&&r.field.isEqual(s.field)&&ri(r.value,s.value)}(n,e):n instanceof Et?function(r,s){return s instanceof Et&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&FN(o,s.filters[a]),!0):!1}(n,e):void he(19439)}function UN(n,e){const t=n.filters.concat(e);return Et.create(t,n.op)}function $N(n){return n instanceof ct?function(t){return`${t.field.canonicalString()} ${t.op} ${Ac(t.value)}`}(n):n instanceof Et?function(t){return t.op.toString()+" {"+t.getFilters().map($N).join(" ,")+"}"}(n):"Filter"}class J3 extends ct{constructor(e,t,r){super(e,t,r),this.key=se.fromName(r.referenceValue)}matches(e){const t=se.comparator(e.key,this.key);return this.matchesComparison(t)}}class X3 extends ct{constructor(e,t){super(e,"in",t),this.keys=BN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Z3 extends ct{constructor(e,t){super(e,"not-in",t),this.keys=BN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function BN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>se.fromName(r.referenceValue))}class e6 extends ct{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Xd(t)&&Jd(t.arrayValue,this.value)}}class zN extends ct{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Jd(this.value.arrayValue,t)}}class t6 extends ct{constructor(e,t){super(e,"not-in",t)}matches(e){if(Jd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Jd(this.value.arrayValue,t)}}class n6 extends ct{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Xd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Jd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r6{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Lv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new r6(n,e,t,r,s,i,o)}function Ua(n){const e=ie(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Mv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ah(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ac(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ac(r)).join(",")),e.Te=t}return e.Te}function Rh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Y3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!FN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!lb(n.startAt,e.startAt)&&lb(n.endAt,e.endAt)}function cp(n){return se.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function up(n,e){return n.filters.filter(t=>t instanceof ct&&t.field.isEqual(e))}function cb(n,e,t){let r=rm,s=!0;for(const i of up(n,e)){let o=rm,a=!0;switch(i.op){case"<":case"<=":o=Q3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=rm}ib({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];ib({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function ub(n,e,t){let r=co,s=!0;for(const i of up(n,e)){let o=co,a=!0;switch(i.op){case">=":case">":o=K3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=co}ob({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];ob({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function qN(n,e,t,r,s,i,o,a){return new Di(n,e,t,r,s,i,o,a)}function Hc(n){return new Di(n)}function db(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Jw(n){return n.collectionGroup!==null}function Xl(n){const e=ie(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Tt(Xt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Zd(i,r))}),t.has(Xt.keyField().canonicalString())||e.Ie.push(new Zd(Xt.keyField(),r))}return e.Ie}function ar(n){const e=ie(n);return e.Ee||(e.Ee=GN(e,Xl(n))),e.Ee}function WN(n){const e=ie(n);return e.de||(e.de=GN(e,n.explicitOrderBy)),e.de}function GN(n,e){if(n.limitType==="F")return Lv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Zd(s.field,i)});const t=n.endAt?new Vo(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vo(n.startAt.position,n.startAt.inclusive):null;return Lv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function jv(n,e){const t=n.filters.concat([e]);return new Di(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function dp(n,e,t){return new Di(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Nh(n,e){return Rh(ar(n),ar(e))&&n.limitType===e.limitType}function HN(n){return`${Ua(ar(n))}|lt:${n.limitType}`}function Tl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>$N(s)).join(", ")}]`),Ah(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ac(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ac(s)).join(",")),`Target(${r})`}(ar(n))}; limitType=${n.limitType})`}function kh(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Xl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=ab(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Xl(r),s)||r.endAt&&!function(o,a,l){const u=ab(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Xl(r),s))}(n,e)}function QN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function KN(n){return(e,t)=>{let r=!1;for(const s of Xl(n)){const i=s6(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function s6(n,e,t){const r=n.field.isKeyField()?se.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?jo(l,u):he(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return he(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Qo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return AN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i6=new Ft(se.comparator);function Ir(){return i6}const YN=new Ft(se.comparator);function Vu(...n){let e=YN;for(const t of n)e=e.insert(t.key,t);return e}function JN(n){let e=YN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ws(){return ad()}function XN(){return ad()}function ad(){return new Oi(n=>n.toString(),(n,e)=>n.isEqual(e))}const o6=new Ft(se.comparator),a6=new Tt(se.comparator);function Qe(...n){let e=a6;for(const t of n)e=e.add(t);return e}const l6=new Tt(Be);function Xw(){return l6}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wd(e)?"-0":e}}function ZN(n){return{integerValue:""+n}}function ek(n,e){return pN(e)?ZN(e):Zw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(){this._=void 0}}function c6(n,e,t){return n instanceof Rc?function(s,i){const o={fields:{[NN]:{stringValue:RN},[PN]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&yg(i)&&(i=_g(i)),i&&(o.fields[kN]=i),{mapValue:o}}(t,e):n instanceof $a?nk(n,e):n instanceof Ba?rk(n,e):function(s,i){const o=tk(s,i),a=hb(o)+hb(s.Ae);return Dv(o)&&Dv(s.Ae)?ZN(a):Zw(s.serializer,a)}(n,e)}function u6(n,e,t){return n instanceof $a?nk(n,e):n instanceof Ba?rk(n,e):t}function tk(n,e){return n instanceof Nc?function(r){return Dv(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Rc extends wg{}class $a extends wg{constructor(e){super(),this.elements=e}}function nk(n,e){const t=sk(e);for(const r of n.elements)t.some(s=>ri(s,r))||t.push(r);return{arrayValue:{values:t}}}class Ba extends wg{constructor(e){super(),this.elements=e}}function rk(n,e){let t=sk(e);for(const r of n.elements)t=t.filter(s=>!ri(s,r));return{arrayValue:{values:t}}}class Nc extends wg{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function hb(n){return Qt(n.integerValue||n.doubleValue)}function sk(n){return Xd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e,t){this.field=e,this.transform=t}}function d6(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof $a&&s instanceof $a||r instanceof Ba&&s instanceof Ba?_c(r.elements,s.elements,ri):r instanceof Nc&&s instanceof Nc?ri(r.Ae,s.Ae):r instanceof Rc&&s instanceof Rc}(n.transform,e.transform)}class h6{constructor(e,t){this.version=e,this.transformResults=t}}class Zt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Zt}static exists(e){return new Zt(void 0,e)}static updateTime(e){return new Zt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function om(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class xg{}function ik(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Kc(n.key,Zt.none()):new Qc(n.key,n.data,Zt.none());{const t=n.data,r=Qn.empty();let s=new Tt(Xt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Mi(n.key,r,new Sr(s.toArray()),Zt.none())}}function f6(n,e,t){n instanceof Qc?function(s,i,o){const a=s.value.clone(),l=mb(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Mi?function(s,i,o){if(!om(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=mb(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(ok(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ld(n,e,t,r){return n instanceof Qc?function(i,o,a,l){if(!om(i.precondition,o))return a;const u=i.value.clone(),h=pb(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Mi?function(i,o,a,l){if(!om(i.precondition,o))return a;const u=pb(i.fieldTransforms,l,o),h=o.data;return h.setAll(ok(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return om(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function m6(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=tk(r.transform,s||null);i!=null&&(t===null&&(t=Qn.empty()),t.set(r.field,i))}return t||null}function fb(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&_c(r,s,(i,o)=>d6(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Qc extends xg{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Mi extends xg{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ok(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function mb(n,e,t){const r=new Map;Ie(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,u6(o,a,t[s]))}return r}function pb(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,c6(i,o,e))}return r}class Kc extends xg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ex extends xg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&f6(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ld(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ld(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=XN();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=ik(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(be.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Qe())}isEqual(e){return this.batchId===e.batchId&&_c(this.mutations,e.mutations,(t,r)=>fb(t,r))&&_c(this.baseMutations,e.baseMutations,(t,r)=>fb(t,r))}}class nx{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ie(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return o6}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new nx(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p6{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var In,ht;function lk(n){switch(n){case F.OK:return he(64938);case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0;default:return he(15467,{code:n})}}function ck(n){if(n===void 0)return _n("GRPC error has no .code"),F.UNKNOWN;switch(n){case In.OK:return F.OK;case In.CANCELLED:return F.CANCELLED;case In.UNKNOWN:return F.UNKNOWN;case In.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case In.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case In.INTERNAL:return F.INTERNAL;case In.UNAVAILABLE:return F.UNAVAILABLE;case In.UNAUTHENTICATED:return F.UNAUTHENTICATED;case In.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case In.NOT_FOUND:return F.NOT_FOUND;case In.ALREADY_EXISTS:return F.ALREADY_EXISTS;case In.PERMISSION_DENIED:return F.PERMISSION_DENIED;case In.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case In.ABORTED:return F.ABORTED;case In.OUT_OF_RANGE:return F.OUT_OF_RANGE;case In.UNIMPLEMENTED:return F.UNIMPLEMENTED;case In.DATA_LOSS:return F.DATA_LOSS;default:return he(39323,{code:n})}}(ht=In||(In={}))[ht.OK=0]="OK",ht[ht.CANCELLED=1]="CANCELLED",ht[ht.UNKNOWN=2]="UNKNOWN",ht[ht.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ht[ht.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ht[ht.NOT_FOUND=5]="NOT_FOUND",ht[ht.ALREADY_EXISTS=6]="ALREADY_EXISTS",ht[ht.PERMISSION_DENIED=7]="PERMISSION_DENIED",ht[ht.UNAUTHENTICATED=16]="UNAUTHENTICATED",ht[ht.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ht[ht.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ht[ht.ABORTED=10]="ABORTED",ht[ht.OUT_OF_RANGE=11]="OUT_OF_RANGE",ht[ht.UNIMPLEMENTED=12]="UNIMPLEMENTED",ht[ht.INTERNAL=13]="INTERNAL",ht[ht.UNAVAILABLE=14]="UNAVAILABLE",ht[ht.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g6=new Eo([4294967295,4294967295],0);function gb(n){const e=uk().encode(n),t=new ZR;return t.update(e),new Uint8Array(t.digest())}function yb(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Eo([t,r],0),new Eo([s,i],0)]}class sx{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Fu(`Invalid padding: ${t}`);if(r<0)throw new Fu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Fu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Fu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Eo.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Eo.fromNumber(r)));return s.compare(g6)===1&&(s=new Eo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=gb(e),[r,s]=yb(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new sx(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=gb(e),[r,s]=yb(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Fu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Oh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Dh(be.min(),s,new Ft(Be),Ir(),Qe())}}class Oh{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Oh(r,t,Qe(),Qe(),Qe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class dk{constructor(e,t){this.targetId=e,this.Ce=t}}class hk{constructor(e,t,r=hn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class _b{constructor(){this.ve=0,this.Fe=vb(),this.Me=hn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Qe(),t=Qe(),r=Qe();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:he(38017,{changeType:i})}}),new Oh(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=vb()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ie(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class y6{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ir(),this.Je=Tf(),this.He=Tf(),this.Ye=new Ft(Be)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:he(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(cp(i))if(r===0){const o=new se(i.path);this.et(t,o,Bt.newNoDocument(o,be.min()))}else Ie(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}cd==null||cd.lt(function(h,f,m,y,_){var I,x,R;const E={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},k=f.unchangedNames;return k&&(E.bloomFilter={applied:_===0,hashCount:(k==null?void 0:k.hashCount)??0,bitmapLength:((x=(I=k==null?void 0:k.bits)==null?void 0:I.bitmap)==null?void 0:x.length)??0,padding:((R=k==null?void 0:k.bits)==null?void 0:R.padding)??0,mightContain:P=>(y==null?void 0:y.mightContain(P))??!1}),E}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ai(r).toUint8Array()}catch(l){if(l instanceof CN)return cs("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new sx(o,s,i)}catch(l){return cs(l instanceof Fu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&cp(a.target)){const l=new se(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Bt.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=Qe();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Dh(e,t,this.Ye,this.je,r);return this.je=Ir(),this.Je=Tf(),this.He=Tf(),this.Ye=new Ft(Be),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new _b,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Tt(Be),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Tt(Be),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||K("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new _b),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Tf(){return new Ft(se.comparator)}function vb(){return new Ft(se.comparator)}const _6=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),v6=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),w6=(()=>({and:"AND",or:"OR"}))();class x6{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Vv(n,e){return n.useProto3Json||Ah(e)?e:{value:e}}function kc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function fk(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function S6(n,e){return kc(n,e.toTimestamp())}function vn(n){return Ie(!!n,49232),be.fromTimestamp(function(t){const r=Ti(t);return new Xe(r.seconds,r.nanos)}(n))}function ix(n,e){return Fv(n,e).canonicalString()}function Fv(n,e){const t=function(s){return new rt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function mk(n){const e=rt.fromString(n);return Ie(Ik(e),10190,{key:e.toString()}),e}function eh(n,e){return ix(n.databaseId,e.path)}function Xs(n,e){const t=mk(e);if(t.get(1)!==n.databaseId.projectId)throw new G(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new G(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new se(yk(t))}function pk(n,e){return ix(n.databaseId,e)}function gk(n){const e=mk(n);return e.length===4?rt.emptyPath():yk(e)}function Uv(n){return new rt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function yk(n){return Ie(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function wb(n,e,t){return{name:eh(n,e),fields:t.value.mapValue.fields}}function Sg(n,e,t){const r=Xs(n,e.name),s=vn(e.updateTime),i=e.createTime?vn(e.createTime):be.min(),o=new Qn({mapValue:{fields:e.fields}}),a=Bt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function I6(n,e){return"found"in e?function(r,s){Ie(!!s.found,43571),s.found.name,s.found.updateTime;const i=Xs(r,s.found.name),o=vn(s.found.updateTime),a=s.found.createTime?vn(s.found.createTime):be.min(),l=new Qn({mapValue:{fields:s.found.fields}});return Bt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Ie(!!s.missing,3894),Ie(!!s.readTime,22933);const i=Xs(r,s.missing),o=vn(s.readTime);return Bt.newNoDocument(i,o)}(n,e):he(7234,{result:e})}function E6(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:he(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(Ie(h===void 0||typeof h=="string",58123),hn.fromBase64String(h||"")):(Ie(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),hn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?F.UNKNOWN:ck(u.code);return new G(h,u.message||"")}(o);t=new hk(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Xs(n,r.document.name),i=vn(r.document.updateTime),o=r.document.createTime?vn(r.document.createTime):be.min(),a=new Qn({mapValue:{fields:r.document.fields}}),l=Bt.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new am(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Xs(n,r.document),i=r.readTime?vn(r.readTime):be.min(),o=Bt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new am([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Xs(n,r.document),i=r.removedTargetIds||[];t=new am([],i,s,null)}else{if(!("filter"in e))return he(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new p6(s,i),a=r.targetId;t=new dk(a,o)}}return t}function th(n,e){let t;if(e instanceof Qc)t={update:wb(n,e.key,e.value)};else if(e instanceof Kc)t={delete:eh(n,e.key)};else if(e instanceof Mi)t={update:wb(n,e.key,e.data),updateMask:N6(e.fieldMask)};else{if(!(e instanceof ex))return he(16599,{Vt:e.type});t={verify:eh(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Rc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof $a)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ba)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Nc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw he(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:S6(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:he(27497)}(n,e.precondition)),t}function $v(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Zt.updateTime(vn(i.updateTime)):i.exists!==void 0?Zt.exists(i.exists):Zt.none()}(e.currentDocument):Zt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Ie(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new Rc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new $a(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Ba(h)}else"increment"in a?l=new Nc(o,a.increment):he(16584,{proto:a});const u=Xt.fromServerFormat(a.fieldPath);return new Ph(u,l)}(n,s)):[];if(e.update){e.update.name;const s=Xs(n,e.update.name),i=new Qn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new Sr(u.map(h=>Xt.fromServerFormat(h)))}(e.updateMask);return new Mi(s,i,o,t,r)}return new Qc(s,i,t,r)}if(e.delete){const s=Xs(n,e.delete);return new Kc(s,t)}if(e.verify){const s=Xs(n,e.verify);return new ex(s,t)}return he(1463,{proto:e})}function b6(n,e){return n&&n.length>0?(Ie(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?vn(s.updateTime):vn(i);return o.isEqual(be.min())&&(o=vn(i)),new h6(o,s.transformResults||[])}(t,e))):[]}function _k(n,e){return{documents:[pk(n,e.path)]}}function Ig(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=pk(n,s);const i=function(u){if(u.length!==0)return Sk(Et.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(m){return{field:eo(m.field),direction:A6(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Vv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function vk(n,e,t,r){const{ft:s,parent:i}=Ig(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:eo(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:eo(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function wk(n){let e=gk(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ie(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const m=xk(f);return m instanceof Et&&Yw(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(_){return new Zd(Al(_.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Ah(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){const m=!!f.before,y=f.values||[];return new Vo(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const m=!f.before,y=f.values||[];return new Vo(y,m)}(t.endAt)),qN(e,s,o,i,a,"F",l,u)}function T6(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return he(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function xk(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Al(t.unaryFilter.field);return ct.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Al(t.unaryFilter.field);return ct.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Al(t.unaryFilter.field);return ct.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Al(t.unaryFilter.field);return ct.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return he(61313);default:return he(60726)}}(n):n.fieldFilter!==void 0?function(t){return ct.create(Al(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return he(58110);default:return he(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Et.create(t.compositeFilter.filters.map(r=>xk(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return he(1026)}}(t.compositeFilter.op))}(n):he(30097,{filter:n})}function A6(n){return _6[n]}function C6(n){return v6[n]}function R6(n){return w6[n]}function eo(n){return{fieldPath:n.canonicalString()}}function Al(n){return Xt.fromServerFormat(n.fieldPath)}function Sk(n){return n instanceof ct?function(t){if(t.op==="=="){if(sb(t.value))return{unaryFilter:{field:eo(t.field),op:"IS_NAN"}};if(rb(t.value))return{unaryFilter:{field:eo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sb(t.value))return{unaryFilter:{field:eo(t.field),op:"IS_NOT_NAN"}};if(rb(t.value))return{unaryFilter:{field:eo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:eo(t.field),op:C6(t.op),value:t.value}}}(n):n instanceof Et?function(t){const r=t.getFilters().map(s=>Sk(s));return r.length===1?r[0]:{compositeFilter:{op:R6(t.op),filters:r}}}(n):he(54877,{filter:n})}function N6(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ik(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e,t,r,s,i=be.min(),o=be.min(),a=hn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new mi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new mi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new mi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new mi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this.yt=e}}function k6(n,e){let t;if(e.document)t=Sg(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=se.fromSegments(e.noDocument.path),s=qa(e.noDocument.readTime);t=Bt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return he(56709);{const r=se.fromSegments(e.unknownDocument.path),s=qa(e.unknownDocument.version);t=Bt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Xe(s[0],s[1]);return be.fromTimestamp(i)}(e.readTime)),t}function xb(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:hp(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:eh(i,o.key),fields:o.data.value.mapValue.fields,updateTime:kc(i,o.version.toTimestamp()),createTime:kc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:za(e.version)};else{if(!e.isUnknownDocument())return he(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:za(e.version)}}return r}function hp(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function za(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function qa(n){const e=new Xe(n.seconds,n.nanoseconds);return be.fromTimestamp(e)}function da(n,e){const t=(e.baseMutations||[]).map(i=>$v(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>$v(n.yt,i)),s=Xe.fromMillis(e.localWriteTimeMs);return new tx(e.batchId,s,t,r)}function Uu(n){const e=qa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?qa(n.lastLimboFreeSnapshotVersion):be.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return Ie(o===1,1966,{count:o}),ar(Hc(gk(i.documents[0])))}(n.query):function(i){return ar(wk(i))}(n.query),new mi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,hn.fromBase64String(n.resumeToken))}function bk(n,e){const t=za(e.snapshotVersion),r=za(e.lastLimboFreeSnapshotVersion);let s;s=cp(e.target)?_k(n.yt,e.target):Ig(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ua(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Eg(n){const e=wk({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?dp(e,e.limit,"L"):e}function By(n,e){return new rx(e.largestBatchId,$v(n.yt,e.overlayMutation))}function Sb(n,e){const t=e.path.lastSegment();return[n,or(e.path.popLast()),t]}function Ib(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:za(r.readTime),documentKey:or(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P6{getBundleMetadata(e,t){return Eb(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:qa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Eb(e).put(function(s){return{bundleId:s.id,createTime:za(vn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return bb(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Eg(i.bundledQuery),readTime:qa(i.readTime)}}(r)})}saveNamedQuery(e,t){return bb(e).put(function(s){return{name:s.name,readTime:za(vn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Eb(n){return kn(n,mg)}function bb(n){return kn(n,pg)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new bg(e,r)}getOverlay(e,t){return Iu(e).get(Sb(this.userId,t)).next(r=>r?By(this.serializer,r):null)}getOverlays(e,t){const r=Ws();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new rx(t,o);s.push(this.St(e,a))}),V.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(or(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Iu(e).Z(Nv,a))}),V.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Ws(),i=or(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Iu(e).J(Nv,o).next(a=>{for(const l of a){const u=By(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Ws();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Iu(e).ee({index:xN,range:a},(l,u,h)=>{const f=By(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return Iu(e).put(function(s,i,o){const[a,l,u]=Sb(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:th(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function Iu(n){return kn(n,gg)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{bt(e){return kn(e,Gw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?hn.fromUint8Array(r):hn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Qt(e.integerValue));else if("doubleValue"in e){const r=Qt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Wd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ti(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ai(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?ON(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):vg(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):he(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=Tc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(Qt(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),se.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}ha.Kt=new ha;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl=255;function O6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Tb(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=O6(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class M6{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=Tb(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=Tb(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(wl),this.sn(255)}_n(){this.an(wl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===wl?(this.sn(wl),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===wl?(this.an(wl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class L6{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class j6{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Eu{constructor(){this.cn=new M6,this.ln=new L6(this.cn),this.hn=new j6(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new fa(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:lm(this.En),directionalValue:lm(this.dn),orderedDocumentKey:lm(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Gi(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=Ab(n.En,e.En),t!==0?t:(t=Ab(n.dn,e.dn),t!==0?t:se.comparator(n.In,e.In)))}function Ab(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function lm(n){return EC()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function Cb(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class Rb{constructor(e){this.mn=new Tt((t,r)=>Xt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(Ie(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Av(e);if(t!==void 0&&!this.wn(t))return!1;const r=la(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Tt(Xt.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ea(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ea(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ea(r.field,r.dir==="asc"?0:1)));return new wc(wc.UNKNOWN_ID,this.collectionId,t,xc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tk(n){var t,r;if(Ie(n instanceof ct||n instanceof Et,20012),n instanceof ct){if(n instanceof zN){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>ct.create(n.field,"==",i)))||[];return Et.create(s,"or")}return n}const e=n.filters.map(s=>Tk(s));return Et.create(e,n.op)}function V6(n){if(n.getFilters().length===0)return[];const e=qv(Tk(n));return Ie(Ak(e),7391),Bv(e)||zv(e)?[e]:e.getFilters()}function Bv(n){return n instanceof ct}function zv(n){return n instanceof Et&&Yw(n)}function Ak(n){return Bv(n)||zv(n)||function(t){if(t instanceof Et&&Ov(t)){for(const r of t.getFilters())if(!Bv(r)&&!zv(r))return!1;return!0}return!1}(n)}function qv(n){if(Ie(n instanceof ct||n instanceof Et,34018),n instanceof ct)return n;if(n.filters.length===1)return qv(n.filters[0]);const e=n.filters.map(r=>qv(r));let t=Et.create(e,n.op);return t=fp(t),Ak(t)?t:(Ie(t instanceof Et,64498),Ie(Cc(t),40251),Ie(t.filters.length>1,57927),t.filters.reduce((r,s)=>ox(r,s)))}function ox(n,e){let t;return Ie(n instanceof ct||n instanceof Et,38388),Ie(e instanceof ct||e instanceof Et,25473),t=n instanceof ct?e instanceof ct?function(s,i){return Et.create([s,i],"and")}(n,e):Nb(n,e):e instanceof ct?Nb(e,n):function(s,i){if(Ie(s.filters.length>0&&i.filters.length>0,48005),Cc(s)&&Cc(i))return UN(s,i.getFilters());const o=Ov(s)?s:i,a=Ov(s)?i:s,l=o.filters.map(u=>ox(u,a));return Et.create(l,"or")}(n,e),fp(t)}function Nb(n,e){if(Cc(e))return UN(e,n.getFilters());{const t=e.filters.map(r=>ox(n,r));return Et.create(t,"or")}}function fp(n){if(Ie(n instanceof ct||n instanceof Et,11850),n instanceof ct)return n;const e=n.getFilters();if(e.length===1)return fp(e[0]);if(VN(n))return n;const t=e.map(s=>fp(s)),r=[];return t.forEach(s=>{s instanceof ct?r.push(s):s instanceof Et&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Et.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F6{constructor(){this.Cn=new ax}addToCollectionParentIndex(e,t){return this.Cn.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(Qr.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(Qr.min())}updateCollectionGroup(e,t,r){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class ax{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Tt(rt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Tt(rt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kb="IndexedDbIndexManager",Af=new Uint8Array(0);class U6{constructor(e,t){this.databaseId=t,this.vn=new ax,this.Fn=new Oi(r=>Ua(r),(r,s)=>Rh(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:or(s)};return Pb(e).put(i)}return V.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[aN(t),""],!1,!0);return Pb(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(qs(o.parent))}return r})}addFieldIndex(e,t){const r=bu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Sl(e);return i.next(a=>{o.put(Ib(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=bu(e),s=Sl(e),i=xl(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=bu(e),r=xl(e),s=Sl(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return V.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Rb(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=xl(e);let s=!0;const i=new Map;return V.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Qe();const a=[];return V.forEach(i,(l,u)=>{K(kb,`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(l)} to execute ${Ua(t)}`);const h=function(R,P){const $=Av(P);if($===void 0)return null;for(const M of up(R,$.fieldPath))switch(M.op){case"array-contains-any":return M.value.arrayValue.values||[];case"array-contains":return[M.value]}return null}(u,l),f=function(R,P){const $=new Map;for(const M of la(P))for(const N of up(R,M.fieldPath))switch(N.op){case"==":case"in":$.set(M.fieldPath.canonicalString(),N.value);break;case"not-in":case"!=":return $.set(M.fieldPath.canonicalString(),N.value),Array.from($.values())}return null}(u,l),m=function(R,P){const $=[];let M=!0;for(const N of la(P)){const w=N.kind===0?cb(R,N.fieldPath,R.startAt):ub(R,N.fieldPath,R.startAt);$.push(w.value),M&&(M=w.inclusive)}return new Vo($,M)}(u,l),y=function(R,P){const $=[];let M=!0;for(const N of la(P)){const w=N.kind===0?ub(R,N.fieldPath,R.endAt):cb(R,N.fieldPath,R.endAt);$.push(w.value),M&&(M=w.inclusive)}return new Vo($,M)}(u,l),_=this.On(l,u,m),E=this.On(l,u,y),k=this.Nn(l,u,f),I=this.Bn(l.indexId,h,_,m.inclusive,E,y.inclusive,k);return V.forEach(I,x=>r.Y(x,t.limit).next(R=>{R.forEach(P=>{const $=se.fromSegments(P.documentKey);o.has($)||(o=o.add($),a.push($))})}))}).next(()=>a)}return V.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=V6(Et.create(e.filters,"and")).map(r=>Lv(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const m=t?this.Ln(t[f/u]):Af,y=this.kn(e,m,r[f%u],s),_=this.qn(e,m,i[f%u],o),E=a.map(k=>this.kn(e,m,k,!0));h.push(...this.createRange(y,_,E))}return h}kn(e,t,r,s){const i=new fa(e,se.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new fa(e,se.empty(),t,r);return s?i.An():i}xn(e,t){const r=new Rb(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return V.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new Tt(Xt.comparator),h=!1;for(const f of l.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:u=u.add(m.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new Eu;for(const s of la(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);ha.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new Eu;return ha.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new Eu;return ha.Kt.Dt(Fa(this.databaseId,t),r.Pn(function(i){const o=la(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new Eu);let i=0;for(const o of la(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&Xd(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);ha.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Eu;l.seed(a.un()),ha.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof ct&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=bu(e),s=Sl(e);return(t?r.J(Rv,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return V.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const m=f?new xc(f.sequenceNumber,new Qr(qa(f.readTime),new se(qs(f.documentKey)),f.largestBatchId)):xc.empty(),y=h.fields.map(([_,E])=>new Ea(Xt.fromServerFormat(_),E));return new wc(h.indexId,h.collectionGroup,y,m)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Be(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=bu(e),i=Sl(e);return this.Gn(e).next(o=>s.J(Rv,IDBKeyRange.bound(t,t)).next(a=>V.forEach(a,l=>i.put(Ib(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return V.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?V.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),V.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?V.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return xl(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return xl(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=xl(e);let i=new Tt(Gi);return s.ee({index:wN,range:IDBKeyRange.only([r.indexId,this.uid,lm(this.$n(r,t))])},(o,a)=>{i=i.add(new fa(r.indexId,t,Cb(a.arrayValue),Cb(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new Tt(Gi);const s=this.Qn(t,e);if(s==null)return r;const i=Av(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Xd(o))for(const a of o.arrayValue.values||[])r=r.add(new fa(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new fa(t.indexId,e.key,Af,s));return r}Jn(e,t,r,s,i){K(kb,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,m){const y=l.getIterator(),_=u.getIterator();let E=vl(y),k=vl(_);for(;E||k;){let I=!1,x=!1;if(E&&k){const R=h(E,k);R<0?x=!0:R>0&&(I=!0)}else E!=null?x=!0:I=!0;I?(f(k),k=vl(_)):x?(m(E),E=vl(y)):(E=vl(y),k=vl(_))}}(s,i,Gi,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),V.waitFor(o)}Gn(e){let t=1;return Sl(e).ee({index:vN,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Gi(o,a)).filter((o,a,l)=>!a||Gi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Gi(o,e),l=Gi(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,Af,se.empty()),l=s[o+1].Vn(this.uid,Af,se.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return Gi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Db)}getMinOffset(e,t){return V.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||he(44426))).next(Db)}}function Pb(n){return kn(n,Qd)}function xl(n){return kn(n,id)}function bu(n){return kn(n,Ww)}function Sl(n){return kn(n,sd)}function Db(n){Ie(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Bw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Qr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ob={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ck=41943040;class rr{static withCacheSize(e){return new rr(e,rr.DEFAULT_COLLECTION_PERCENTILE,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(n,e,t){const r=n.store(ys),s=n.store(Sc),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,m)=>(a++,m.delete()));i.push(l.next(()=>{Ie(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=gN(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return V.waitFor(i).next(()=>u)}function mp(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw he(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rr.DEFAULT_COLLECTION_PERCENTILE=10,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rr.DEFAULT=new rr(Ck,rr.DEFAULT_COLLECTION_PERCENTILE,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rr.DISABLED=new rr(-1,0,0);class Tg{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){Ie(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Tg(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hi(e).ee({index:_a,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Cl(e),o=Hi(e);return o.add({}).next(a=>{Ie(typeof a=="number",49019);const l=new tx(a,t,r,s),u=function(y,_,E){const k=E.baseMutations.map(x=>th(y.yt,x)),I=E.mutations.map(x=>th(y.yt,x));return{userId:_,batchId:E.batchId,localWriteTimeMs:E.localWriteTime.toMillis(),baseMutations:k,mutations:I}}(this.serializer,this.userId,l),h=[];let f=new Tt((m,y)=>Be(m.canonicalString(),y.canonicalString()));for(const m of s){const y=gN(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,S3))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),V.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return Hi(e).get(t).next(r=>r?(Ie(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),da(this.serializer,r)):null)}er(e,t){return this.Xn[t]?V.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Hi(e).ee({index:_a,range:s},(o,a,l)=>{a.userId===this.userId&&(Ie(a.batchId>=r,47524,{tr:r}),i=da(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=bo;return Hi(e).ee({index:_a,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,bo],[this.userId,Number.POSITIVE_INFINITY]);return Hi(e).J(_a,t).next(r=>r.map(s=>da(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=tm(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Cl(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,m=qs(h);if(u===this.userId&&t.path.isEqual(m))return Hi(e).get(f).next(y=>{if(!y)throw he(61480,{nr:o,batchId:f});Ie(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(da(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Tt(Be);const s=[];return t.forEach(i=>{const o=tm(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Cl(e).ee({range:a},(u,h,f)=>{const[m,y,_]=u,E=qs(y);m===this.userId&&i.path.isEqual(E)?r=r.add(_):f.done()});s.push(l)}),V.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=tm(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Tt(Be);return Cl(e).ee({range:o},(l,u,h)=>{const[f,m,y]=l,_=qs(m);f===this.userId&&r.isPrefixOf(_)?_.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Hi(e).get(i).next(o=>{if(o===null)throw he(35274,{batchId:i});Ie(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(da(this.serializer,o))}))}),V.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Rk(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),V.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return V.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Cl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=qs(i[1]);s.push(l)}else a.done()}).next(()=>{Ie(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return Nk(e,this.userId,t)}_r(e){return kk(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:bo,lastStreamToken:""})}}function Nk(n,e,t){const r=tm(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Cl(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function Hi(n){return kn(n,ys)}function Cl(n){return kn(n,Sc)}function kk(n){return kn(n,Gd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Wa(0)}static cr(){return new Wa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Wa(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>be.fromTimestamp(new Xe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Il(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(Ie(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Il(e).ee((o,a)=>{const l=Uu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>V.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Il(e).ee((r,s)=>{const i=Uu(s);t(i)})}lr(e){return Mb(e).get(lp).next(t=>(Ie(t!==null,2888),t))}hr(e,t){return Mb(e).put(lp,t)}Pr(e,t){return Il(e).put(bk(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ua(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Il(e).ee({range:s,index:_N},(o,a,l)=>{const u=Uu(a);Rh(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=to(e);return t.forEach(o=>{const a=or(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),V.waitFor(s)}removeMatchingKeys(e,t,r){const s=to(e);return V.forEach(t,i=>{const o=or(i.path);return V.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=to(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=to(e);let i=Qe();return s.ee({range:r,X:!0},(o,a,l)=>{const u=qs(o[1]),h=new se(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=or(t.path),s=IDBKeyRange.bound([r],[aN(r)],!1,!0);let i=0;return to(e).ee({index:qw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return Il(e).get(t).next(r=>r?Uu(r):null)}}function Il(n){return kn(n,Ic)}function Mb(n){return kn(n,ba)}function to(n){return kn(n,Ec)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lb="LruGarbageCollector",Pk=1048576;function jb([n,e],[t,r]){const s=Be(n,t);return s===0?Be(e,r):s}class B6{constructor(e){this.Ir=e,this.buffer=new Tt(jb),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();jb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Dk{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){K(Lb,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ho(t)?K(Lb,"Ignoring IndexedDB error during garbage collection: ",t):await Go(t)}await this.Vr(3e5)})}}class z6{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return V.resolve(xr.ce);const r=new B6(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(K("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(Ob)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ob):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(K("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),bl()<=it.DEBUG&&K("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function Ok(n,e){return new z6(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q6{constructor(e,t){this.db=e,this.garbageCollector=Ok(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Cf(e,r)}removeReference(e,t,r){return Cf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cf(e,t)}br(e,t){return function(s,i){let o=!1;return kk(s).te(a=>Nk(s,a,i).next(l=>(l&&(o=!0),V.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,be.min()),to(e).delete(function(f){return[0,or(f.path)]}(o))))});s.push(l)}}).next(()=>V.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cf(e,t)}Sr(e,t){const r=to(e);let s,i=xr.ce;return r.ee({index:qw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==xr.ce&&t(new se(qs(s)),i),i=u,s=l):i=xr.ce}).next(()=>{i!==xr.ce&&t(new se(qs(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cf(n,e){return to(n).put(function(r,s){return{targetId:0,path:or(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{constructor(){this.changes=new Oi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Bt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?V.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W6{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ra(e).put(r)}removeEntry(e,t,r){return ra(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],hp(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Bt.newInvalidDocument(t);return ra(e).ee({index:nm,range:IDBKeyRange.only(Tu(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Bt.newInvalidDocument(t)};return ra(e).ee({index:nm,range:IDBKeyRange.only(Tu(t))},(s,i)=>{r={document:this.Cr(t,i),size:mp(i)}}).next(()=>r)}getEntries(e,t){let r=Ir();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=Ir(),s=new Ft(se.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,mp(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return V.resolve();let s=new Tt(Ub);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Tu(s.first()),Tu(s.last())),o=s.getIterator();let a=o.getNext();return ra(e).ee({index:nm,range:i},(l,u,h)=>{const f=se.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Ub(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(Tu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),hp(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ra(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=Ir();for(const f of u){const m=this.Cr(se.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(kh(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Ir();const o=Fb(t,r),a=Fb(t,Qr.max());return ra(e).ee({index:yN,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(se.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new G6(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Vb(e).get(Cv).next(t=>(Ie(!!t,20021),t))}Dr(e,t){return Vb(e).put(Cv,t)}Cr(e,t){if(t){const r=k6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(be.min())))return r}return Bt.newInvalidDocument(e)}}function Lk(n){return new W6(n)}class G6 extends Mk{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Oi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Tt((i,o)=>Be(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=xb(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=mp(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=xb(this.Nr.serializer,o.convertToNoDocument(be.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),V.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Vb(n){return kn(n,Hd)}function ra(n){return kn(n,ap)}function Tu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Fb(n,e){const t=e.documentKey.path.toArray();return[n,hp(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Ub(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Be(t[i],r[i]),s)return s;return s=Be(t.length,r.length),s||(s=Be(t[t.length-2],r[r.length-2]),s||Be(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H6{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&ld(r.mutation,s,Sr.empty(),Xe.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Qe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Qe()){const s=Ws();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Vu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ws();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Qe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Ir();const o=ad(),a=function(){return ad()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Mi)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),ld(h.mutation,u,h.mutation.getFieldMask(),Xe.now())):o.set(u.key,Sr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new H6(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=ad();let s=new Ft((o,a)=>o-a),i=Qe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||Sr.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||Qe()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=XN();h.forEach(m=>{if(!i.has(m)){const y=ik(t.get(m),r.get(m));y!==null&&f.set(m,y),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return V.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Jw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):V.resolve(Ws());let a=vc,l=i;return o.next(u=>V.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?V.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{l=l.insert(h,m)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,Qe())).next(h=>({batchId:a,changes:JN(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new se(t)).next(r=>{let s=Vu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Vu();return this.indexManager.getCollectionParents(e,i).next(a=>V.forEach(a,l=>{const u=function(f,m){return new Di(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Bt.newInvalidDocument(h)))});let a=Vu();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&ld(h.mutation,u,Sr.empty(),Xe.now()),kh(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q6{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return V.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:vn(s.createTime)}}(t)),V.resolve()}getNamedQuery(e,t){return V.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:Eg(s.bundledQuery),readTime:vn(s.readTime)}}(t)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K6{constructor(){this.overlays=new Ft(se.comparator),this.qr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ws();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),V.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),V.resolve()}getOverlaysForCollection(e,t,r){const s=Ws(),i=t.length+1,o=new se(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return V.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ft((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Ws(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Ws(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return V.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new rx(t,r));let i=this.qr.get(t);i===void 0&&(i=Qe(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y6{constructor(){this.sessionToken=hn.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(){this.Qr=new Tt(Mn.$r),this.Ur=new Tt(Mn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Mn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Mn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new se(new rt([])),r=new Mn(t,e),s=new Mn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new se(new rt([])),r=new Mn(t,e),s=new Mn(t,e+1);let i=Qe();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Mn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Mn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return se.comparator(e.key,t.key)||Be(e.Yr,t.Yr)}static Kr(e,t){return Be(e.Yr,t.Yr)||se.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J6{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Tt(Mn.$r)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new tx(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Mn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,t){return V.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return V.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?bo:this.tr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Mn(t,0),s=new Mn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),V.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Tt(Be);return t.forEach(s=>{const i=new Mn(s,0),o=new Mn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),V.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;se.isDocumentKey(i)||(i=i.child(""));const o=new Mn(new se(i),0);let a=new Tt(Be);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),V.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ie(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return V.forEach(t.mutations,s=>{const i=new Mn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new Mn(t,0),s=this.Zr.firstAfterOrEqual(r);return V.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X6{constructor(e){this.ri=e,this.docs=function(){return new Ft(se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return V.resolve(r?r.document.mutableCopy():Bt.newInvalidDocument(t))}getEntries(e,t){let r=Ir();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Bt.newInvalidDocument(s))}),V.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Ir();const o=t.path,a=new se(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Bw(dN(h),r)<=0||(s.has(h.key)||kh(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return V.resolve(i)}getAllFromCollectionGroup(e,t,r,s){he(9500)}ii(e,t){return V.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Z6(this)}getSize(e){return V.resolve(this.size)}}class Z6 extends Mk{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),V.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(e){this.persistence=e,this.si=new Oi(t=>Ua(t),Rh),this.lastRemoteSnapshotVersion=be.min(),this.highestTargetId=0,this.oi=0,this._i=new lx,this.targetCount=0,this.ai=Wa.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),V.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Wa(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Pr(t),V.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),V.waitFor(i).next(()=>s)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return V.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),V.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),V.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return V.resolve(r)}containsKey(e,t){return V.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cx{constructor(e,t){this.ui={},this.overlays={},this.ci=new xr(0),this.li=!1,this.li=!0,this.hi=new Y6,this.referenceDelegate=e(this),this.Pi=new e5(this),this.indexManager=new F6,this.remoteDocumentCache=function(s){return new X6(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new Ek(t),this.Ii=new Q6(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new K6,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new J6(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){K("MemoryPersistence","Starting transaction:",e);const s=new t5(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return V.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class t5 extends fN{constructor(e){super(),this.currentSequenceNumber=e}}class Ag{constructor(e){this.persistence=e,this.Ri=new lx,this.Vi=null}static mi(e){return new Ag(e)}get fi(){if(this.Vi)return this.Vi;throw he(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),V.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),V.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.fi,r=>{const s=se.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,be.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return V.or([()=>V.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class pp{constructor(e,t){this.persistence=e,this.pi=new Oi(r=>or(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Ok(this,t)}static mi(e,t){return new pp(e,t)}Ei(){}di(e){return V.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return V.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?V.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,be.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=sm(e.data.value)),t}br(e,t,r){return V.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5{constructor(e){this.serializer=e}k(e,t,r,s){const i=new fg("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(Ch)}(e),function(l){l.createObjectStore(Gd,{keyPath:x3}),l.createObjectStore(ys,{keyPath:JE,autoIncrement:!0}).createIndex(_a,XE,{unique:!0}),l.createObjectStore(Sc)}(e),$b(e),function(l){l.createObjectStore(ca)}(e));let o=V.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(Ec),l.deleteObjectStore(Ic),l.deleteObjectStore(ba)}(e),$b(e)),o=o.next(()=>function(l){const u=l.store(ba),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:be.min().toTimestamp(),targetCount:0};return u.put(lp,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(ys).J().next(f=>{l.deleteObjectStore(ys),l.createObjectStore(ys,{keyPath:JE,autoIncrement:!0}).createIndex(_a,XE,{unique:!0});const m=u.store(ys),y=f.map(_=>m.put(_));return V.waitFor(y)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(bc,{keyPath:N3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(Hd)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(mg,{keyPath:k3})})(e),function(l){l.createObjectStore(pg,{keyPath:P3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(gg,{keyPath:F3});u.createIndex(Nv,U3,{unique:!1}),u.createIndex(xN,$3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(ap,{keyPath:I3});u.createIndex(nm,E3),u.createIndex(yN,b3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(ca))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(Ww,{keyPath:D3,autoIncrement:!0}).createIndex(Rv,O3,{unique:!1}),l.createObjectStore(sd,{keyPath:M3}).createIndex(vN,L3,{unique:!1}),l.createObjectStore(id,{keyPath:j3}).createIndex(wN,V3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(sd).clear()}).next(()=>{t.objectStore(id).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(Gw,{keyPath:B3})})(e)})),r<18&&s>=18&&EC()&&(o=o.next(()=>{t.objectStore(sd).clear()}).next(()=>{t.objectStore(id).clear()})),o}wi(e){let t=0;return e.store(ca).ee((r,s)=>{t+=mp(s)}).next(()=>{const r={byteSize:t};return e.store(Hd).put(Cv,r)})}yi(e){const t=e.store(Gd),r=e.store(ys);return t.J().next(s=>V.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,bo],[i.userId,i.lastAcknowledgedBatchId]);return r.J(_a,o).next(a=>V.forEach(a,l=>{Ie(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=da(this.serializer,l);return Rk(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(Ec),r=e.store(ca);return e.store(ba).get(lp).next(s=>{const i=[];return r.ee((o,a)=>{const l=new rt(o),u=function(f){return[0,or(f)]}(l);i.push(t.get(u).next(h=>h?V.resolve():(f=>t.put({targetId:0,path:or(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>V.waitFor(i))})}bi(e,t){e.createObjectStore(Qd,{keyPath:R3});const r=t.store(Qd),s=new ax,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:or(l)})}};return t.store(ca).ee({X:!0},(o,a)=>{const l=new rt(o);return i(l.popLast())}).next(()=>t.store(Sc).ee({X:!0},([o,a,l],u)=>{const h=qs(a);return i(h.popLast())}))}Di(e){const t=e.store(Ic);return t.ee((r,s)=>{const i=Uu(s),o=bk(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(ca),s=[];return r.ee((i,o)=>{const a=t.store(ap),l=function(f){return f.document?new se(rt.fromString(f.document.name).popFirst(5)):f.noDocument?se.fromSegments(f.noDocument.path):f.unknownDocument?se.fromSegments(f.unknownDocument.path):he(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>V.waitFor(s))}Fi(e,t){const r=t.store(ys),s=Lk(this.serializer),i=new cx(Ag.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??Qe();da(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),V.forEach(a,(l,u)=>{const h=new jn(u),f=bg.wt(this.serializer,h),m=i.getIndexManager(h),y=Tg.wt(h,this.serializer,m,i.referenceDelegate);return new jk(s,y,f,m).recalculateAndSaveOverlaysForDocumentKeys(new kv(t,xr.ce),l).next()})})}}function $b(n){n.createObjectStore(Ec,{keyPath:A3}).createIndex(qw,C3,{unique:!0}),n.createObjectStore(Ic,{keyPath:"targetId"}).createIndex(_N,T3,{unique:!0}),n.createObjectStore(ba)}const Qi="IndexedDbPersistence",zy=18e5,qy=5e3,Wy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Vk="main";class ux{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!ux.v())throw new G(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new q6(this,s),this.$i=t+Vk,this.serializer=new Ek(l),this.Ui=new Js(this.$i,this.Ni,new n5(this.serializer)),this.hi=new D6,this.Pi=new $6(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Lk(this.serializer),this.Ii=new P6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&_n(Qi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new G(F.FAILED_PRECONDITION,Wy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new xr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Rf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(Ho(e))return K(Qi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return K(Qi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Au(e).get(_l).next(t=>V.resolve(this.es(t)))}ts(e){return Rf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,zy)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=kn(t,bc);return r.J().next(s=>{const i=this.ss(s,zy),o=s.filter(a=>i.indexOf(a)===-1);return V.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?V.resolve(!0):Au(e).get(_l).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,qy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new G(F.FAILED_PRECONDITION,Wy);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rf(e).J().next(r=>this.ss(r,qy).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&K(Qi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Ch,bc],e=>{const t=new kv(e,xr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Rf(e).J().next(t=>this.ss(t,zy).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Tg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new U6(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return bg.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){K(Qi,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?W3:l===17?bN:l===16?q3:l===15?Hw:l===14?EN:l===13?IN:l===12?z3:l===11?SN:void he(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new kv(a,this.ci?this.ci.next():xr.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw _n(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new G(F.FAILED_PRECONDITION,hN);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Au(e).get(_l).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,qy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new G(F.FAILED_PRECONDITION,Wy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Au(e).put(_l,t)}static v(){return Js.v()}Zi(e){const t=Au(e);return t.get(_l).next(r=>this.es(r)?(K(Qi,"Releasing primary lease."),t.delete(_l)):V.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(_n(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;IC()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return K(Qi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return _n(Qi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){_n("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Au(n){return kn(n,Ch)}function Rf(n){return kn(n,bc)}function dx(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hx{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=Qe(),s=Qe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new hx(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return IC()?8:mN(Nn())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new r5;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(bl()<=it.DEBUG&&K("QueryEngine","SDK will not create cache indexes for query:",Tl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),V.resolve()):(bl()<=it.DEBUG&&K("QueryEngine","Query:",Tl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(bl()<=it.DEBUG&&K("QueryEngine","The SDK decides to create cache indexes for query:",Tl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ar(t))):V.resolve())}ys(e,t){if(db(t))return V.resolve(null);let r=ar(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=dp(t,null,"F"),r=ar(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Qe(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,dp(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return db(t)||s.isEqual(be.min())?V.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?V.resolve(null):(bl()<=it.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Tl(t)),this.vs(e,o,t,uN(s,vc)).next(a=>a))})}Ds(e,t){let r=new Tt(KN(e));return t.forEach((s,i)=>{kh(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return bl()<=it.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",Tl(t)),this.ps.getDocumentsMatchingQuery(e,t,Qr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fx="LocalStore",s5=3e8;class i5{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Ft(Be),this.xs=new Oi(i=>Ua(i),Rh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new jk(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Uk(n,e,t,r){return new i5(n,e,t,r)}async function $k(n,e){const t=ie(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Qe();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function o5(n,e){const t=ie(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,m=f.keys();let y=V.resolve();return m.forEach(_=>{y=y.next(()=>h.getEntry(l,_)).next(E=>{const k=u.docVersions.get(_);Ie(k!==null,48541),E.version.compareTo(k)<0&&(f.applyToRemoteDocument(E,u),E.isValidDocument()&&(E.setReadTime(u.commitVersion),h.addEntry(E)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Qe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Bk(n){const e=ie(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function a5(n,e){const t=ie(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(hn.EMPTY_BYTE_STRING,be.min()).withLastLimboFreeSnapshotVersion(be.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(E,k,I){return E.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=s5?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(m,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let l=Ir(),u=Qe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(zk(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(be.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return V.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function zk(n,e,t){let r=Qe(),s=Qe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Ir();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(be.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):K(fx,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function l5(n,e){const t=ie(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=bo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Pc(n,e){const t=ie(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,V.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new mi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function Dc(n,e,t){const r=ie(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ho(o))throw o;K(fx,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function gp(n,e,t){const r=ie(n);let s=be.min(),i=Qe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=ie(l),m=f.xs.get(h);return m!==void 0?V.resolve(f.Ms.get(m)):f.Pi.getTargetData(u,h)}(r,o,ar(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:be.min(),t?i:Qe())).next(a=>(Gk(r,QN(e),a),{documents:a,Qs:i})))}function qk(n,e){const t=ie(n),r=ie(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function Wk(n,e){const t=ie(n),r=t.Os.get(e)||be.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,uN(r,vc),Number.MAX_SAFE_INTEGER)).then(s=>(Gk(t,e,s),s))}function Gk(n,e,t){let r=n.Os.get(e)||be.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function c5(n,e,t,r){const s=ie(n);let i=Qe(),o=Ir();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Pc(s,function(h){return ar(Hc(rt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>zk(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function u5(n,e,t=Qe()){const r=await Pc(n,ar(Eg(e.bundledQuery))),s=ie(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=vn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(hn.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk="firestore_clients";function Bb(n,e){return`${Hk}_${n}_${e}`}const Qk="firestore_mutations";function zb(n,e,t){let r=`${Qk}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const Kk="firestore_targets";function Gy(n,e){return`${Kk}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fs="SharedClientState";class yp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new G(s.error.code,s.error.message))),o?new yp(e,t,s.state,i):(_n(Fs,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ud{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new G(r.error.code,r.error.message))),i?new ud(e,r.state,s):(_n(Fs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _p{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Xw();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=pN(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new _p(e,i):(_n(Fs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class mx{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new mx(t.clientId,t.onlineState):(_n(Fs,`Failed to parse online state: ${e}`),null)}}class Wv{constructor(){this.activeTargetIds=Xw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Hy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Ft(Be),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=Bb(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Wv),this.ro=new RegExp(`^${Hk}_${o}_([^_]*)$`),this.io=new RegExp(`^${Qk}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${Kk}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(Bb(this.persistenceKey,r));if(s){const i=_p.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Gy(this.persistenceKey,e));if(s){const i=ud.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Gy(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return K(Fs,"READ",e,t),t}setItem(e,t){K(Fs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){K(Fs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(K(Fs,"EVENT",t.key,t.newValue),t.key===this.eo)return void _n("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=xr.ce;if(i!=null)try{const a=JSON.parse(i);Ie(typeof a=="number",30636,{So:i}),o=a}catch(a){_n(Fs,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==xr.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new yp(this.currentUser,e,t,r),i=zb(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=zb(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=Gy(this.persistenceKey,e),i=new ud(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return _p.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return yp.Ws(new jn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return ud.Ws(s,t)}uo(e){return mx.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);K(Fs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=Xw();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Yk{constructor(){this.Mo=new Wv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Wv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qb="ConnectivityMonitor";class Wb{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){K(qb,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){K(qb,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nf=null;function Gv(){return Nf===null?Nf=function(){return 268435456+Math.round(2147483648*Math.random())}():Nf++,"0x"+Nf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy="RestConnection",h5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class f5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Yd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=Gv(),a=this.zo(e,t.toUriEncodedString());K(Qy,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=Pi(u);return this.Jo(e,a,l,r,h).then(f=>(K(Qy,`Received RPC '${e}' ${o}: `,f),f),f=>{throw cs(Qy,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=h5[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr="WebChannelConnection";class p5 extends f5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=Gv();return new Promise((a,l)=>{const u=new eN;u.setWithCredentials(!0),u.listenOnce(tN.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case em.NO_ERROR:const f=u.getResponseJson();K(nr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case em.TIMEOUT:K(nr,`RPC '${e}' ${o} timed out`),l(new G(F.DEADLINE_EXCEEDED,"Request time out"));break;case em.HTTP_ERROR:const m=u.getStatus();if(K(nr,`RPC '${e}' ${o} failed with status:`,m,"response text:",u.getResponseText()),m>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const _=y==null?void 0:y.error;if(_&&_.status&&_.message){const E=function(I){const x=I.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(x)>=0?x:F.UNKNOWN}(_.status);l(new G(E,_.message))}else l(new G(F.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new G(F.UNAVAILABLE,"Connection failed."));break;default:he(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{K(nr,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);K(nr,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=Gv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=sN(),a=rN(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");K(nr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let m=!1,y=!1;const _=new m5({Yo:k=>{y?K(nr,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(m||(K(nr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),K(nr,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},Zo:()=>f.close()}),E=(k,I,x)=>{k.listen(I,R=>{try{x(R)}catch(P){setTimeout(()=>{throw P},0)}})};return E(f,ju.EventType.OPEN,()=>{y||(K(nr,`RPC '${e}' stream ${s} transport opened.`),_.o_())}),E(f,ju.EventType.CLOSE,()=>{y||(y=!0,K(nr,`RPC '${e}' stream ${s} transport closed`),_.a_(),this.E_(f))}),E(f,ju.EventType.ERROR,k=>{y||(y=!0,cs(nr,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),_.a_(new G(F.UNAVAILABLE,"The operation could not be completed")))}),E(f,ju.EventType.MESSAGE,k=>{var I;if(!y){const x=k.data[0];Ie(!!x,16349);const R=x,P=(R==null?void 0:R.error)||((I=R[0])==null?void 0:I.error);if(P){K(nr,`RPC '${e}' stream ${s} received error:`,P);const $=P.status;let M=function(T){const A=In[T];if(A!==void 0)return ck(A)}($),N=P.message;M===void 0&&(M=F.INTERNAL,N="Unknown error status: "+$+" with message "+P.message),y=!0,_.a_(new G(M,N)),f.close()}else K(nr,`RPC '${e}' stream ${s} received:`,x),_.u_(x)}}),E(a,nN.STAT_EVENT,k=>{k.stat===Iv.PROXY?K(nr,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===Iv.NOPROXY&&K(nr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{_.__()},0),_}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jk(){return typeof window<"u"?window:null}function cm(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function il(n){return new x6(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class px{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&K("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb="PersistentStream";class Xk{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new px(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(_n(t.toString()),_n("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new G(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return K(Gb,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(K(Gb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class g5 extends Xk{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=E6(this.serializer,e),r=function(i){if(!("targetChange"in i))return be.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?be.min():o.readTime?vn(o.readTime):be.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Uv(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=cp(l)?{documents:_k(i,l)}:{query:Ig(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=fk(i,o.resumeToken);const u=Vv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(be.min())>0){a.readTime=kc(i,o.snapshotVersion.toTimestamp());const u=Vv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=T6(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Uv(this.serializer),t.removeTarget=e,this.q_(t)}}class y5 extends Xk{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Ie(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ie(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ie(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=b6(e.writeResults,e.commitTime),r=vn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Uv(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>th(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{}class v5 extends _5{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new G(F.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Fv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new G(F.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Fv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new G(F.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class w5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(_n(t),this.aa=!1):K("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ga="RemoteStore";class x5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Ko(this)&&(K(Ga,"Restarting streams for network reachability change."),await async function(l){const u=ie(l);u.Ea.add(4),await Yc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Mh(u)}(this))})}),this.Ra=new w5(r,s)}}async function Mh(n){if(Ko(n))for(const e of n.da)await e(!0)}async function Yc(n){for(const e of n.da)await e(!1)}function Cg(n,e){const t=ie(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),_x(t)?yx(t):Xc(t).O_()&&gx(t,e))}function Oc(n,e){const t=ie(n),r=Xc(t);t.Ia.delete(e),r.O_()&&Zk(t,e),t.Ia.size===0&&(r.O_()?r.L_():Ko(t)&&t.Ra.set("Unknown"))}function gx(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(be.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Xc(n).Y_(e)}function Zk(n,e){n.Va.Ue(e),Xc(n).Z_(e)}function yx(n){n.Va=new y6({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Xc(n).start(),n.Ra.ua()}function _x(n){return Ko(n)&&!Xc(n).x_()&&n.Ia.size>0}function Ko(n){return ie(n).Ea.size===0}function eP(n){n.Va=void 0}async function S5(n){n.Ra.set("Online")}async function I5(n){n.Ia.forEach((e,t)=>{gx(n,e)})}async function E5(n,e){eP(n),_x(n)?(n.Ra.ha(e),yx(n)):n.Ra.set("Unknown")}async function b5(n,e,t){if(n.Ra.set("Online"),e instanceof hk&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){K(Ga,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await vp(n,r)}else if(e instanceof am?n.Va.Ze(e):e instanceof dk?n.Va.st(e):n.Va.tt(e),!t.isEqual(be.min()))try{const r=await Bk(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(hn.EMPTY_BYTE_STRING,h.snapshotVersion)),Zk(i,l);const f=new mi(h.target,l,u,h.sequenceNumber);gx(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){K(Ga,"Failed to raise snapshot:",r),await vp(n,r)}}async function vp(n,e,t){if(!Ho(e))throw e;n.Ea.add(1),await Yc(n),n.Ra.set("Offline"),t||(t=()=>Bk(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{K(Ga,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Mh(n)})}function tP(n,e){return e().catch(t=>vp(n,t,e))}async function Jc(n){const e=ie(n),t=Fo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:bo;for(;T5(e);)try{const s=await l5(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,A5(e,s)}catch(s){await vp(e,s)}nP(e)&&rP(e)}function T5(n){return Ko(n)&&n.Ta.length<10}function A5(n,e){n.Ta.push(e);const t=Fo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function nP(n){return Ko(n)&&!Fo(n).x_()&&n.Ta.length>0}function rP(n){Fo(n).start()}async function C5(n){Fo(n).ra()}async function R5(n){const e=Fo(n);for(const t of n.Ta)e.ea(t.mutations)}async function N5(n,e,t){const r=n.Ta.shift(),s=nx.from(r,e,t);await tP(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Jc(n)}async function k5(n,e){e&&Fo(n).X_&&await async function(r,s){if(function(o){return lk(o)&&o!==F.ABORTED}(s.code)){const i=r.Ta.shift();Fo(r).B_(),await tP(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Jc(r)}}(n,e),nP(n)&&rP(n)}async function Hb(n,e){const t=ie(n);t.asyncQueue.verifyOperationInProgress(),K(Ga,"RemoteStore received new credentials");const r=Ko(t);t.Ea.add(3),await Yc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Mh(t)}async function Hv(n,e){const t=ie(n);e?(t.Ea.delete(2),await Mh(t)):e||(t.Ea.add(2),await Yc(t),t.Ra.set("Unknown"))}function Xc(n){return n.ma||(n.ma=function(t,r,s){const i=ie(t);return i.sa(),new g5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:S5.bind(null,n),t_:I5.bind(null,n),r_:E5.bind(null,n),H_:b5.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),_x(n)?yx(n):n.Ra.set("Unknown")):(await n.ma.stop(),eP(n))})),n.ma}function Fo(n){return n.fa||(n.fa=function(t,r,s){const i=ie(t);return i.sa(),new y5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:C5.bind(null,n),r_:k5.bind(null,n),ta:R5.bind(null,n),na:N5.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Jc(n)):(await n.fa.stop(),n.Ta.length>0&&(K(Ga,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Un,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new vx(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new G(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Zc(n,e){if(_n("AsyncQueue",`${e}: ${n}`),Ho(n))return new G(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{static emptySet(e){return new Ta(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||se.comparator(t.key,r.key):(t,r)=>se.comparator(t.key,r.key),this.keyedMap=Vu(),this.sortedSet=new Ft(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ta)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ta;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(){this.ga=new Ft(se.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):he(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ha{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ha(e,t,Ta.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Nh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class D5{constructor(){this.queries=Kb(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=ie(t),i=s.queries;s.queries=Kb(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new G(F.ABORTED,"Firestore shutting down"))}}function Kb(){return new Oi(n=>HN(n),Nh)}async function wx(n,e){const t=ie(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new P5,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Zc(o,`Initialization of query '${Tl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Sx(t)}async function xx(n,e){const t=ie(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function O5(n,e){const t=ie(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&Sx(t)}function M5(n,e,t){const r=ie(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Sx(n){n.Ca.forEach(e=>{e.next()})}var Qv,Yb;(Yb=Qv||(Qv={})).Ma="default",Yb.Cache="cache";class Ix{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ha(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ha.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Qv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e){this.serializer=e}$s(e){return Xs(this.serializer,e)}Us(e){return e.metadata.exists?Sg(this.serializer,e.document,!1):Bt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return vn(e)}}class Ex{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=iP(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=rt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new Jb(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Qe()).add(i);t.set(o,a)}}return t}async ja(e){const t=await c5(e,new Jb(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await u5(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function iP(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(e){this.key=e}}class aP{constructor(e){this.key=e}}class lP{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Qe(),this.mutatedKeys=Qe(),this.eu=KN(e),this.tu=new Ta(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Qb,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),y=kh(this.query,f)?f:null,_=!!m&&this.mutatedKeys.has(m.key),E=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let k=!1;m&&y?m.data.isEqual(y.data)?_!==E&&(r.track({type:3,doc:y}),k=!0):this.su(m,y)||(r.track({type:2,doc:y}),k=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!m&&y?(r.track({type:0,doc:y}),k=!0):m&&!y&&(r.track({type:1,doc:m}),k=!0,(l||u)&&(a=!0)),k&&(y?(o=o.add(y),i=E?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,_){const E=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return he(20277,{Rt:k})}};return E(y)-E(_)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Ha(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Qb,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Qe(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new aP(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new oP(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=Qe();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ha.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Yo="SyncEngine";class L5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class j5{constructor(e){this.key=e,this.hu=!1}}class V5{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Oi(a=>HN(a),Nh),this.Iu=new Map,this.Eu=new Set,this.du=new Ft(se.comparator),this.Au=new Map,this.Ru=new lx,this.Vu={},this.mu=new Map,this.fu=Wa.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function F5(n,e,t=!0){const r=Rg(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await cP(r,e,t,!0),s}async function U5(n,e){const t=Rg(n);await cP(t,e,!0,!1)}async function cP(n,e,t,r){const s=await Pc(n.localStore,ar(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await bx(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Cg(n.remoteStore,s),a}async function bx(n,e,t,r,s){n.pu=(f,m,y)=>async function(E,k,I,x){let R=k.view.ru(I);R.Cs&&(R=await gp(E.localStore,k.query,!1).then(({documents:N})=>k.view.ru(N,R)));const P=x&&x.targetChanges.get(k.targetId),$=x&&x.targetMismatches.get(k.targetId)!=null,M=k.view.applyChanges(R,E.isPrimaryClient,P,$);return Kv(E,k.targetId,M.au),M.snapshot}(n,f,m,y);const i=await gp(n.localStore,e,!0),o=new lP(e,i.Qs),a=o.ru(i.documents),l=Oh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);Kv(n,t,u.au);const h=new L5(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function $5(n,e,t){const r=ie(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Nh(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Dc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Oc(r.remoteStore,s.targetId),Mc(r,s.targetId)}).catch(Go)):(Mc(r,s.targetId),await Dc(r.localStore,s.targetId,!0))}async function B5(n,e){const t=ie(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Oc(t.remoteStore,r.targetId))}async function z5(n,e,t){const r=Rx(n);try{const s=await function(o,a){const l=ie(o),u=Xe.now(),h=a.reduce((y,_)=>y.add(_.key),Qe());let f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let _=Ir(),E=Qe();return l.Ns.getEntries(y,h).next(k=>{_=k,_.forEach((I,x)=>{x.isValidDocument()||(E=E.add(I))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,_)).next(k=>{f=k;const I=[];for(const x of a){const R=m6(x,f.get(x.key).overlayedDocument);R!=null&&I.push(new Mi(x.key,R,LN(R.value.mapValue),Zt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,I,a)}).next(k=>{m=k;const I=k.applyToLocalDocumentSet(f,E);return l.documentOverlayCache.saveOverlays(y,k.batchId,I)})}).then(()=>({batchId:m.batchId,changes:JN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new Ft(Be)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Li(r,s.changes),await Jc(r.remoteStore)}catch(s){const i=Zc(s,"Failed to persist write");t.reject(i)}}async function uP(n,e){const t=ie(n);try{const r=await a5(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(Ie(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?Ie(o.hu,14607):s.removedDocuments.size>0&&(Ie(o.hu,42227),o.hu=!1))}),await Li(t,r,e)}catch(r){await Go(r)}}function Xb(n,e,t){const r=ie(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ie(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const m of f.Sa)m.va(a)&&(u=!0)}),u&&Sx(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function q5(n,e,t){const r=ie(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new Ft(se.comparator);o=o.insert(i,Bt.newNoDocument(i,be.min()));const a=Qe().add(i),l=new Dh(be.min(),new Map,new Ft(Be),o,a);await uP(r,l),r.du=r.du.remove(i),r.Au.delete(e),Cx(r)}else await Dc(r.localStore,e,!1).then(()=>Mc(r,e,t)).catch(Go)}async function W5(n,e){const t=ie(n),r=e.batch.batchId;try{const s=await o5(t.localStore,e);Ax(t,r,null),Tx(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Li(t,s)}catch(s){await Go(s)}}async function G5(n,e,t){const r=ie(n);try{const s=await function(o,a){const l=ie(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(Ie(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);Ax(r,e,t),Tx(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Li(r,s)}catch(s){await Go(s)}}async function H5(n,e){const t=ie(n);Ko(t.remoteStore)||K(Yo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ie(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===bo)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Zc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Tx(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Ax(n,e,t){const r=ie(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Mc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||dP(n,r)})}function dP(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Oc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Cx(n))}function Kv(n,e,t){for(const r of t)r instanceof oP?(n.Ru.addReference(r.key,e),Q5(n,r)):r instanceof aP?(K(Yo,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||dP(n,r.key)):he(19791,{wu:r})}function Q5(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(K(Yo,"New document in limbo: "+t),n.Eu.add(r),Cx(n))}function Cx(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new se(rt.fromString(e)),r=n.fu.next();n.Au.set(r,new j5(t)),n.du=n.du.insert(t,r),Cg(n.remoteStore,new mi(ar(Hc(t.path)),r,"TargetPurposeLimboResolution",xr.ce))}}async function Li(n,e,t){const r=ie(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=hx.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=ie(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>V.forEach(u,m=>V.forEach(m.Es,y=>h.persistence.referenceDelegate.addReference(f,m.targetId,y)).next(()=>V.forEach(m.ds,y=>h.persistence.referenceDelegate.removeReference(f,m.targetId,y)))))}catch(f){if(!Ho(f))throw f;K(fx,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const y=h.Ms.get(m),_=y.snapshotVersion,E=y.withLastLimboFreeSnapshotVersion(_);h.Ms=h.Ms.insert(m,E)}}}(r.localStore,i))}async function K5(n,e){const t=ie(n);if(!t.currentUser.isEqual(e)){K(Yo,"User change. New user:",e.toKey());const r=await $k(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new G(F.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Li(t,r.Ls)}}function Y5(n,e){const t=ie(n),r=t.Au.get(e);if(r&&r.hu)return Qe().add(r.key);{let s=Qe();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function J5(n,e){const t=ie(n),r=await gp(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&Kv(t,e.targetId,s.au),s}async function X5(n,e){const t=ie(n);return Wk(t.localStore,e).then(r=>Li(t,r))}async function Z5(n,e,t,r){const s=ie(n),i=await function(a,l){const u=ie(a),h=ie(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(m=>m?u.localDocuments.getDocuments(f,m):V.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Jc(s.remoteStore):t==="acknowledged"||t==="rejected"?(Ax(s,e,r||null),Tx(s,e),function(a,l){ie(ie(a).mutationQueue).ir(l)}(s.localStore,e)):he(6720,"Unknown batchState",{Su:t}),await Li(s,i)):K(Yo,"Cannot apply mutation batch with id: "+e)}async function eU(n,e){const t=ie(n);if(Rg(t),Rx(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Zb(t,r.toArray());t.gu=!0,await Hv(t.remoteStore,!0);for(const i of s)Cg(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Mc(t,o),Dc(t.localStore,o,!0))),Oc(t.remoteStore,o)}),await s,await Zb(t,r),function(o){const a=ie(o);a.Au.forEach((l,u)=>{Oc(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new Ft(se.comparator)}(t),t.gu=!1,await Hv(t.remoteStore,!1)}}async function Zb(n,e,t){const r=ie(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Pc(r.localStore,ar(l[0]));for(const u of l){const h=r.Tu.get(u),f=await J5(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await qk(r.localStore,o);a=await Pc(r.localStore,u),await bx(r,hP(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function hP(n){return qN(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function tU(n){return function(t){return ie(ie(t).persistence).Ts()}(ie(n).localStore)}async function nU(n,e,t,r){const s=ie(n);if(s.gu)return void K(Yo,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await Wk(s.localStore,QN(i[0])),a=Dh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",hn.EMPTY_BYTE_STRING);await Li(s,o,a);break}case"rejected":await Dc(s.localStore,e,!0),Mc(s,e,r);break;default:he(64155,t)}}async function rU(n,e,t){const r=Rg(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){K(Yo,"Adding an already active target "+s);continue}const i=await qk(r.localStore,s),o=await Pc(r.localStore,i);await bx(r,hP(i),o.targetId,!1,o.resumeToken),Cg(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await Dc(r.localStore,s,!1).then(()=>{Oc(r.remoteStore,s),Mc(r,s)}).catch(Go)}}function Rg(n){const e=ie(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=uP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Y5.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=q5.bind(null,e),e.Pu.H_=O5.bind(null,e.eventManager),e.Pu.yu=M5.bind(null,e.eventManager),e}function Rx(n){const e=ie(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=W5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=G5.bind(null,e),e}function sU(n,e,t){const r=ie(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,_){const E=ie(y),k=vn(_.createTime);return E.persistence.runTransaction("hasNewerBundle","readonly",I=>E.Ii.getBundleMetadata(I,_.id)).then(I=>!!I&&I.createTime.compareTo(k)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(iP(l));const u=new Ex(l,o.serializer);let h=await o.bu();for(;h;){const m=await u.Ga(h);m&&a._updateProgress(m),h=await o.bu()}const f=await u.ja(i.localStore);return await Li(i,f.Ha,void 0),await function(y,_){const E=ie(y);return E.persistence.runTransaction("Save bundle","readwrite",k=>E.Ii.saveBundleMetadata(k,_))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return cs(Yo,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Lc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=il(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Uk(this.persistence,new Fk,e.initialUser,this.serializer)}Cu(e){return new cx(Ag.mi,this.serializer)}Du(e){return new Yk}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Lc.provider={build:()=>new Lc};class Nx extends Lc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Ie(this.persistence.referenceDelegate instanceof pp,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Dk(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?rr.withCacheSize(this.cacheSizeBytes):rr.DEFAULT;return new cx(r=>pp.mi(r,t),this.serializer)}}class kx extends Lc{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Rx(this.xu.syncEngine),await Jc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return Uk(this.persistence,new Fk,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new Dk(r,e.asyncQueue,t)}Mu(e,t){const r=new v3(t,this.persistence);return new _3(e.asyncQueue,r)}Cu(e){const t=dx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?rr.withCacheSize(this.cacheSizeBytes):rr.DEFAULT;return new ux(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Jk(),cm(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Yk}}class fP extends kx{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Hy&&(this.sharedClientState.syncEngine={Co:Z5.bind(null,t),vo:nU.bind(null,t),Fo:rU.bind(null,t),Ts:tU.bind(null,t),Do:X5.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await eU(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=Jk();if(!Hy.v(t))throw new G(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=dx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Hy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Uo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Xb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=K5.bind(null,this.syncEngine),await Hv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new D5}()}createDatastore(e){const t=il(e.databaseInfo.databaseId),r=function(i){return new p5(i)}(e.databaseInfo);return function(i,o,a,l){return new v5(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new x5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Xb(this.syncEngine,t,0),function(){return Wb.v()?new Wb:new d5}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new V5(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ie(s);K(Ga,"RemoteStore shutting down."),i.Ea.add(5),await Yc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Uo.provider={build:()=>new Uo};function eT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):_n("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Un,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new sP(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new sP(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new G(F.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aU{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new G(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ie(s),a={documents:i.map(f=>eh(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,rt.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const m=I6(o.serializer,f);u.set(m.key.toString(),m)});const h=[];return i.forEach(f=>{const m=u.get(f.toString());Ie(!!m,55234,{key:f}),h.push(m)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Kc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=se.fromPath(r);this.mutations.push(new ex(s,this.precondition(s)))}),await async function(r,s){const i=ie(r),o={writes:s.map(a=>th(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,rt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw he(50498,{Gu:e.constructor.name});t=be.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new G(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(be.min())?Zt.exists(!1):Zt.updateTime(t):Zt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(be.min()))throw new G(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Zt.updateTime(t)}return Zt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lU{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new px(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new aU(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!Ah(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!lk(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $o="FirestoreClient";class cU{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=jn.UNAUTHENTICATED,this.clientId=Uw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{K($o,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(K($o,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Un;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Zc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ky(n,e){n.asyncQueue.verifyOperationInProgress(),K($o,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await $k(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function tT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Px(n);K($o,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Hb(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Hb(e.remoteStore,s)),n._onlineComponents=e}async function Px(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){K($o,"Using user provided OfflineComponentProvider");try{await Ky(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;cs("Error using user provided cache. Falling back to memory cache: "+t),await Ky(n,new Lc)}}else K($o,"Using default OfflineComponentProvider"),await Ky(n,new Nx(void 0));return n._offlineComponents}async function kg(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(K($o,"Using user provided OnlineComponentProvider"),await tT(n,n._uninitializedComponentsProvider._online)):(K($o,"Using default OnlineComponentProvider"),await tT(n,new Uo))),n._onlineComponents}function mP(n){return Px(n).then(e=>e.persistence)}function eu(n){return Px(n).then(e=>e.localStore)}function pP(n){return kg(n).then(e=>e.remoteStore)}function Dx(n){return kg(n).then(e=>e.syncEngine)}function gP(n){return kg(n).then(e=>e.datastore)}async function jc(n){const e=await kg(n),t=e.eventManager;return t.onListen=F5.bind(null,e.syncEngine),t.onUnlisten=$5.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=U5.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=B5.bind(null,e.syncEngine),t}function uU(n){return n.asyncQueue.enqueue(async()=>{const e=await mP(n),t=await pP(n);return e.setNetworkEnabled(!0),function(s){const i=ie(s);return i.Ea.delete(0),Mh(i)}(t)})}function dU(n){return n.asyncQueue.enqueue(async()=>{const e=await mP(n),t=await pP(n);return e.setNetworkEnabled(!1),async function(s){const i=ie(s);i.Ea.add(0),await Yc(i),i.Ra.set("Offline")}(t)})}function hU(n,e){const t=new Un;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=ie(u);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new G(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Zc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await eu(n),e,t)),t.promise}function yP(n,e,t={}){const r=new Un;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Ng({next:m=>{h.Nu(),o.enqueueAndForget(()=>xx(i,f));const y=m.docs.has(a);!y&&m.fromCache?u.reject(new G(F.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&l&&l.source==="server"?u.reject(new G(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Ix(Hc(a.path),h,{includeMetadataChanges:!0,qa:!0});return wx(i,f)}(await jc(n),n.asyncQueue,e,t,r)),r.promise}function fU(n,e){const t=new Un;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await gp(s,i,!0),l=new lP(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=Zc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await eu(n),e,t)),t.promise}function _P(n,e,t={}){const r=new Un;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Ng({next:m=>{h.Nu(),o.enqueueAndForget(()=>xx(i,f)),m.fromCache&&l.source==="server"?u.reject(new G(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Ix(a,h,{includeMetadataChanges:!0,qa:!0});return wx(i,f)}(await jc(n),n.asyncQueue,e,t,r)),r.promise}function mU(n,e,t){const r=new Un;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await gP(n);r.resolve(async function(o,a,l){var E;const u=ie(o),{request:h,gt:f,parent:m}=vk(u.serializer,WN(a),l);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,m,h,1)).filter(k=>!!k.result);Ie(y.length===1,64727);const _=(E=y[0].result)==null?void 0:E.aggregateFields;return Object.keys(_).reduce((k,I)=>(k[f[I]]=_[I],k),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function pU(n,e){const t=new Ng(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ie(s).Ca.add(i),i.next()}(await jc(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ie(s).Ca.delete(i)}(await jc(n),t))}}function gU(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?uk().encode(o):o,function(h,f){return new iU(h,f)}(function(h,f){if(h instanceof Uint8Array)return eT(h,f);if(h instanceof ArrayBuffer)return eT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,il(e));n.asyncQueue.enqueueAndForget(async()=>{sU(await Dx(n),s,r)})}function yU(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ie(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await eu(n),e))}function vP(n,e){return function(r,s){return new oU(r,s)}(n,e)}function _U(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ie(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,m,y,_,E){f=[...f],m=[...m],f.sort(y),m.sort(y);const k=f.length,I=m.length;let x=0,R=0;for(;x<I&&R<k;){const P=y(f[R],m[x]);P<0?E(f[R++]):P>0?_(m[x++]):(x++,R++)}for(;x<I;)_(m[x++]);for(;R<k;)E(f[R++])}(u,s,m3,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>V.waitFor(a)))}(await eu(n),e))}function vU(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ie(r).Fs.Vs=s}(await eu(n),e))}function wU(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ie(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await eu(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xP="firestore.googleapis.com",rT=!0;class sT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new G(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=xP,this.ssl=rT}else this.host=e.host,this.ssl=e.ssl??rT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Ck;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Pk)throw new G(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}f3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Lh{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new G(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new G(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new r3;switch(r.type){case"firstParty":return new a3(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new G(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=nT.get(t);r&&(K("ComponentProvider","Removing Datastore"),nT.delete(t),r.terminate())}(this),Promise.resolve()}}function xU(n,e,t,r={}){var u;n=ot(n,Lh);const s=Pi(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Wp(`https://${a}`),Y0("Firestore",!0)),i.host!==xP&&i.host!==a&&cs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Gr(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=jn.MOCK_USER;else{h=vC(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new G(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new jn(m)}n._authCredentials=new s3(new oN(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new zn(this.firestore,e,this._query)}}class Ct{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ct(this.firestore,e,this._key)}toJSON(){return{type:Ct._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(sl(t,Ct._jsonSchema))return new Ct(e,r||null,new se(rt.fromString(t.referencePath)))}}Ct._jsonSchemaVersion="firestore/documentReference/1.0",Ct._jsonSchema={type:Tn("string",Ct._jsonSchemaVersion),referencePath:Tn("string")};class Zs extends zn{constructor(e,t,r){super(e,t,Hc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ct(this.firestore,null,new se(e))}withConverter(e){return new Zs(this.firestore,e,this._path)}}function Zr(n,e,...t){if(n=le(n),$w("collection","path",e),n instanceof Lh){const r=rt.fromString(e,...t);return GE(r),new Zs(n,null,r)}{if(!(n instanceof Ct||n instanceof Zs))throw new G(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return GE(r),new Zs(n.firestore,null,r)}}function K8(n,e){if(n=ot(n,Lh),$w("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new G(F.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new zn(n,null,function(r){return new Di(rt.emptyPath(),r)}(e))}function um(n,e,...t){if(n=le(n),arguments.length===1&&(e=Uw.newId()),$w("doc","path",e),n instanceof Lh){const r=rt.fromString(e,...t);return WE(r),new Ct(n,null,new se(r))}{if(!(n instanceof Ct||n instanceof Zs))throw new G(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return WE(r),new Ct(n.firestore,n instanceof Zs?n.converter:null,new se(r))}}function Y8(n,e){return n=le(n),e=le(e),(n instanceof Ct||n instanceof Zs)&&(e instanceof Ct||e instanceof Zs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function SP(n,e){return n=le(n),e=le(e),n instanceof zn&&e instanceof zn&&n.firestore===e.firestore&&Nh(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="AsyncQueue";class oT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new px(this,"async_queue_retry"),this._c=()=>{const r=cm();r&&K(iT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=cm();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=cm();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Un;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ho(e))throw e;K(iT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,_n("INTERNAL UNHANDLED ERROR: ",aT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=vx.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&he(47125,{Pc:aT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function aT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class SU{constructor(){this._progressObserver={},this._taskCompletionResolver=new Un,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J8=-1;class Mt extends Lh{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new oT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new oT(e),this._firestoreClient=void 0,await e}}}function X8(n,e,t){t||(t=Yd);const r=si(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Gr(i,e))return s;throw new G(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new G(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Pk)throw new G(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Pi(e.host)&&Wp(e.host),r.initialize({options:e,instanceIdentifier:t})}function IU(n,e){const t=typeof n=="object"?n:gh(),r=typeof n=="string"?n:e||Yd,s=si(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=gC("firestore");i&&xU(s,...i)}return s}function on(n){if(n._terminated)throw new G(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||IP(n),n._firestoreClient}function IP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new H3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,wP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new cU(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function Z8(n,e){cs("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return EP(n,Uo.provider,{build:r=>new kx(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function e7(n){cs("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();EP(n,Uo.provider,{build:t=>new fP(t,e.cacheSizeBytes)})}function EP(n,e,t){if((n=ot(n,Mt))._firestoreClient||n._terminated)throw new G(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new G(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},IP(n)}function t7(n){if(n._initialized&&!n._terminated)throw new G(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Un;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Js.v())return Promise.resolve();const s=r+Vk;await Js.delete(s)}(dx(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function n7(n){return function(t){const r=new Un;return t.asyncQueue.enqueueAndForget(async()=>H5(await Dx(t),r)),r.promise}(on(n=ot(n,Mt)))}function r7(n){return uU(on(n=ot(n,Mt)))}function s7(n){return dU(on(n=ot(n,Mt)))}function i7(n){return xj(n.app,"firestore",n._databaseId.database),n._delete()}function lT(n,e){const t=on(n=ot(n,Mt)),r=new SU;return gU(t,n._databaseId,e,r),r}function EU(n,e){return yU(on(n=ot(n,Mt)),e).then(t=>t?new zn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class bU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fr(hn.fromBase64String(e))}catch(t){throw new G(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Fr(hn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(sl(e,Fr._jsonSchema))return Fr.fromBase64String(e.bytes)}}Fr._jsonSchemaVersion="firestore/bytes/1.0",Fr._jsonSchema={type:Tn("string",Fr._jsonSchemaVersion),bytes:Tn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new G(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function o7(){return new ol(Tv)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new G(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new G(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Be(this._lat,e._lat)||Be(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ei._jsonSchemaVersion}}static fromJSON(e){if(sl(e,ei._jsonSchema))return new ei(e.latitude,e.longitude)}}ei._jsonSchemaVersion="firestore/geoPoint/1.0",ei._jsonSchema={type:Tn("string",ei._jsonSchemaVersion),latitude:Tn("number"),longitude:Tn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Es._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(sl(e,Es._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Es(e.vectorValues);throw new G(F.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Es._jsonSchemaVersion="firestore/vectorValue/1.0",Es._jsonSchema={type:Tn("string",Es._jsonSchemaVersion),vectorValues:Tn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TU=/^__.*__$/;class AU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Mi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qc(e,this.data,t,this.fieldTransforms)}}class bP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Mi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function TP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw he(40011,{Ac:n})}}class Pg{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Pg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return wp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(TP(this.Ac)&&TU.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class CU{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||il(e)}Cc(e,t,r,s=!1){return new Pg({Ac:e,methodName:t,Dc:r,path:Xt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ll(n){const e=n._freezeSettings(),t=il(n._databaseId);return new CU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Dg(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Ux("Data must be an object, but it was:",o,r);const a=RP(r,o);let l,u;if(i.merge)l=new Sr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=rh(e,f,t);if(!o.contains(m))throw new G(F.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);kP(h,m)||h.push(m)}l=new Sr(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new AU(new Qn(a),l,u)}class jh extends al{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof jh}}function AP(n,e,t){return new Pg({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ox extends al{_toFieldTransform(e){return new Ph(e.path,new Rc)}isEqual(e){return e instanceof Ox}}class Mx extends al{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=AP(this,e,!0),r=this.vc.map(i=>cl(i,t)),s=new $a(r);return new Ph(e.path,s)}isEqual(e){return e instanceof Mx&&Gr(this.vc,e.vc)}}class Lx extends al{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=AP(this,e,!0),r=this.vc.map(i=>cl(i,t)),s=new Ba(r);return new Ph(e.path,s)}isEqual(e){return e instanceof Lx&&Gr(this.vc,e.vc)}}class jx extends al{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Nc(e.serializer,ek(e.serializer,this.Fc));return new Ph(e.path,t)}isEqual(e){return e instanceof jx&&this.Fc===e.Fc}}function Vx(n,e,t,r){const s=n.Cc(1,e,t);Ux("Data must be an object, but it was:",s,r);const i=[],o=Qn.empty();Qo(r,(l,u)=>{const h=Og(e,l,t);u=le(u);const f=s.yc(h);if(u instanceof jh)i.push(h);else{const m=cl(u,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new Sr(i);return new bP(o,a,s.fieldTransforms)}function Fx(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[rh(e,r,t)],l=[s];if(i.length%2!=0)throw new G(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(rh(e,i[m])),l.push(i[m+1]);const u=[],h=Qn.empty();for(let m=a.length-1;m>=0;--m)if(!kP(u,a[m])){const y=a[m];let _=l[m];_=le(_);const E=o.yc(y);if(_ instanceof jh)u.push(y);else{const k=cl(_,E);k!=null&&(u.push(y),h.set(y,k))}}const f=new Sr(u);return new bP(h,f,o.fieldTransforms)}function CP(n,e,t,r=!1){return cl(t,n.Cc(r?4:3,e))}function cl(n,e){if(NP(n=le(n)))return Ux("Unsupported field value:",e,n),RP(n,e);if(n instanceof al)return function(r,s){if(!TP(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=cl(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ek(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Xe.fromDate(r);return{timestampValue:kc(s.serializer,i)}}if(r instanceof Xe){const i=new Xe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:kc(s.serializer,i)}}if(r instanceof ei)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Fr)return{bytesValue:fk(s.serializer,r._byteString)};if(r instanceof Ct){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ix(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Es)return function(o,a){return{mapValue:{fields:{[Qw]:{stringValue:Kw},[Tc]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return Zw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${hg(r)}`)}(n,e)}function RP(n,e){const t={};return AN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Qo(n,(r,s)=>{const i=cl(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function NP(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Xe||n instanceof ei||n instanceof Fr||n instanceof Ct||n instanceof al||n instanceof Es)}function Ux(n,e,t){if(!NP(t)||!lN(t)){const r=hg(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function rh(n,e,t){if((e=le(e))instanceof ol)return e._internalPath;if(typeof e=="string")return Og(n,e);throw wp("Field path arguments must be of type string or ",n,!1,void 0,t)}const RU=new RegExp("[~\\*/\\[\\]]");function Og(n,e,t){if(e.search(RU)>=0)throw wp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ol(...e.split("."))._internalPath}catch{throw wp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function wp(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new G(F.INVALID_ARGUMENT,a+n+l)}function kP(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new NU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Mg("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class NU extends sh{data(){return super.data()}}function Mg(n,e){return typeof e=="string"?Og(n,e):e instanceof ol?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new G(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class $x{}class Vh extends $x{}function $l(n,e,...t){let r=[];e instanceof $x&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof tu).length,a=i.filter(l=>l instanceof Fh).length;if(o>1||o>0&&a>0)throw new G(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Fh extends Vh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Fh(e,t,r)}_apply(e){const t=this._parse(e);return OP(e._query,t),new zn(e.firestore,e.converter,jv(e._query,t))}_parse(e){const t=ll(e.firestore);return function(i,o,a,l,u,h,f){let m;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new G(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){uT(f,h);const _=[];for(const E of f)_.push(cT(l,i,E));m={arrayValue:{values:_}}}else m=cT(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||uT(f,h),m=CP(a,o,f,h==="in"||h==="not-in");return ct.create(u,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Bl(n,e,t){const r=e,s=Mg("where",n);return Fh._create(s,r,t)}class tu extends $x{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new tu(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Et.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)OP(o,l),o=jv(o,l)}(e._query,t),new zn(e.firestore,e.converter,jv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function a7(...n){return n.forEach(e=>MP("or",e)),tu._create("or",n)}function l7(...n){return n.forEach(e=>MP("and",e)),tu._create("and",n)}class Bx extends Vh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Bx(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new G(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new G(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Zd(i,o)}(e._query,this._field,this._direction);return new zn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Di(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function kU(n,e="asc"){const t=e,r=Mg("orderBy",n);return Bx._create(r,t)}class Lg extends Vh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Lg(e,t,r)}_apply(e){return new zn(e.firestore,e.converter,dp(e._query,this._limit,this._limitType))}}function c7(n){return cN("limit",n),Lg._create("limit",n,"F")}function u7(n){return cN("limitToLast",n),Lg._create("limitToLast",n,"L")}class jg extends Vh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new jg(e,t,r)}_apply(e){const t=DP(e,this.type,this._docOrFields,this._inclusive);return new zn(e.firestore,e.converter,function(s,i){return new Di(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function d7(...n){return jg._create("startAt",n,!0)}function h7(...n){return jg._create("startAfter",n,!1)}class Vg extends Vh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Vg(e,t,r)}_apply(e){const t=DP(e,this.type,this._docOrFields,this._inclusive);return new zn(e.firestore,e.converter,function(s,i){return new Di(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function f7(...n){return Vg._create("endBefore",n,!1)}function m7(...n){return Vg._create("endAt",n,!0)}function DP(n,e,t,r){if(t[0]=le(t[0]),t[0]instanceof sh)return function(i,o,a,l,u){if(!l)throw new G(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Xl(i))if(f.field.isKeyField())h.push(Fa(o,l.key));else{const m=l.data.field(f.field);if(yg(m))throw new G(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const y=f.field.canonicalString();throw new G(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(m)}return new Vo(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ll(n.firestore);return function(o,a,l,u,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new G(F.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let _=0;_<h.length;_++){const E=h[_];if(m[_].field.isKeyField()){if(typeof E!="string")throw new G(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof E}`);if(!Jw(o)&&E.indexOf("/")!==-1)throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${E}' contains a slash.`);const k=o.path.child(rt.fromString(E));if(!se.isDocumentKey(k))throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const I=new se(k);y.push(Fa(a,I))}else{const k=CP(l,u,E);y.push(k)}}return new Vo(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function cT(n,e,t){if(typeof(t=le(t))=="string"){if(t==="")throw new G(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jw(e)&&t.indexOf("/")!==-1)throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(rt.fromString(t));if(!se.isDocumentKey(r))throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fa(n,new se(r))}if(t instanceof Ct)return Fa(n,t._key);throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hg(t)}.`)}function uT(n,e){if(!Array.isArray(n)||n.length===0)throw new G(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function OP(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new G(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new G(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function MP(n,e){if(!(e instanceof Fh||e instanceof tu))throw new G(F.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class LP{convertValue(e,t="none"){switch(Lo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Qt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ai(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw he(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Qo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[Tc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>Qt(o.doubleValue));return new Es(t)}convertGeoPoint(e){return new ei(Qt(e.latitude),Qt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=_g(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Kd(e));default:return null}}convertTimestamp(e){const t=Ti(e);return new Xe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=rt.fromString(e);Ie(Ik(r),9688,{name:e});const s=new Va(r.get(1),r.get(3)),i=new se(r.popFirst(5));return s.isEqual(t)||_n(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class zx extends LP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ct(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p7(n){return new nh("sum",rh("sum",n))}function g7(n){return new nh("avg",rh("average",n))}function PU(){return new nh("count")}function y7(n,e){var t,r;return n instanceof nh&&e instanceof nh&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function _7(n,e){return SP(n.query,e.query)&&Gr(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jP="NOT SUPPORTED";class uo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Br extends sh{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new dm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Mg("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new G(F.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Br._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function v7(n,e,t){if(sl(e,Br._jsonSchema)){if(e.bundle===jP)throw new G(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=il(n._databaseId),s=vP(e.bundle,r),i=s.Wu(),o=new Ex(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new G(F.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Sg(r,a[0].document),u=new se(rt.fromString(e.bundleName));return new Br(n,new zx(n),u,l,new uo(!1,!1),t||null)}}Br._jsonSchemaVersion="firestore/documentSnapshot/1.0",Br._jsonSchema={type:Tn("string",Br._jsonSchemaVersion),bundleSource:Tn("string","DocumentSnapshot"),bundleName:Tn("string"),bundle:Tn("string")};class dm extends Br{data(e={}){return super.data(e)}}class zr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new uo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new dm(this._firestore,this._userDataWriter,r.key,r,new uo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new G(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new dm(s._firestore,s._userDataWriter,a.doc.key,a.doc,new uo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new dm(s._firestore,s._userDataWriter,a.doc.key,a.doc,new uo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:DU(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new G(F.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=zr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Uw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function w7(n,e,t){if(sl(e,zr._jsonSchema)){if(e.bundle===jP)throw new G(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=il(n._databaseId),s=vP(e.bundle,r),i=s.Wu(),o=new Ex(s.getMetadata(),r);for(const m of i)o.Ga(m);if(o.queries.length!==1)throw new G(F.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=Eg(o.queries[0].bundledQuery),l=o.documents;let u=new Ta;l.map(m=>{const y=Sg(r,m.document);u=u.add(y)});const h=Ha.fromInitialDocuments(a,u,Qe(),!1,!1),f=new zn(n,t||null,a);return new zr(n,new zx(n),f,h)}}function DU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return he(61501,{type:n})}}function x7(n,e){return n instanceof Br&&e instanceof Br?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof zr&&e instanceof zr&&n._firestore===e._firestore&&SP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OU(n){n=ot(n,Ct);const e=ot(n.firestore,Mt);return yP(on(e),n._key).then(t=>qx(e,n,t))}zr._jsonSchemaVersion="firestore/querySnapshot/1.0",zr._jsonSchema={type:Tn("string",zr._jsonSchemaVersion),bundleSource:Tn("string","QuerySnapshot"),bundleName:Tn("string"),bundle:Tn("string")};class Jo extends LP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ct(this.firestore,null,t)}}function S7(n){n=ot(n,Ct);const e=ot(n.firestore,Mt),t=on(e),r=new Jo(e);return hU(t,n._key).then(s=>new Br(e,r,n._key,s,new uo(s!==null&&s.hasLocalMutations,!0),n.converter))}function I7(n){n=ot(n,Ct);const e=ot(n.firestore,Mt);return yP(on(e),n._key,{source:"server"}).then(t=>qx(e,n,t))}function dd(n){n=ot(n,zn);const e=ot(n.firestore,Mt),t=on(e),r=new Jo(e);return PP(n._query),_P(t,n._query).then(s=>new zr(e,r,n,s))}function E7(n){n=ot(n,zn);const e=ot(n.firestore,Mt),t=on(e),r=new Jo(e);return fU(t,n._query).then(s=>new zr(e,r,n,s))}function b7(n){n=ot(n,zn);const e=ot(n.firestore,Mt),t=on(e),r=new Jo(e);return _P(t,n._query,{source:"server"}).then(s=>new zr(e,r,n,s))}function MU(n,e,t){n=ot(n,Ct);const r=ot(n.firestore,Mt),s=Fg(n.converter,e,t);return Uh(r,[Dg(ll(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Zt.none())])}function T7(n,e,t,...r){n=ot(n,Ct);const s=ot(n.firestore,Mt),i=ll(s);let o;return o=typeof(e=le(e))=="string"||e instanceof ol?Fx(i,"updateDoc",n._key,e,t,r):Vx(i,"updateDoc",n._key,e),Uh(s,[o.toMutation(n._key,Zt.exists(!0))])}function LU(n){return Uh(ot(n.firestore,Mt),[new Kc(n._key,Zt.none())])}function ai(n,e){const t=ot(n.firestore,Mt),r=um(n),s=Fg(n.converter,e);return Uh(t,[Dg(ll(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Zt.exists(!1))]).then(()=>r)}function dT(n,...e){var l,u,h;n=le(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Zl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Zl(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof Ct)o=ot(n.firestore,Mt),a=Hc(n._key.path),i={next:f=>{e[r]&&e[r](qx(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=ot(n,zn);o=ot(f.firestore,Mt),a=f._query;const m=new Jo(o);i={next:y=>{e[r]&&e[r](new zr(o,m,f,y))},error:e[r+1],complete:e[r+2]},PP(n._query)}return function(m,y,_,E){const k=new Ng(E),I=new Ix(y,k,_);return m.asyncQueue.enqueueAndForget(async()=>wx(await jc(m),I)),()=>{k.Nu(),m.asyncQueue.enqueueAndForget(async()=>xx(await jc(m),I))}}(on(o),a,s,i)}function A7(n,e,...t){const r=le(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const m=l[f];if(typeof m!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(m.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=m:f==="bundleName"?u.bundleName=m:f==="bundleSource"&&(u.bundleSource=m)}return u}(e);if(s.error)throw new G(F.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Zl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Zl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,y){let _,E=!1;return lT(u,h.bundle).then(()=>EU(u,h.bundleName)).then(I=>{I&&!E&&(y&&I.withConverter(y),_=dT(I,f||{},m))}).catch(I=>(m.error&&m.error(I),()=>{})),()=>{E||(E=!0,_&&_())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Zl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,y){let _,E=!1;return lT(u,h.bundle).then(()=>{if(!E){const I=new Ct(u,y||null,se.fromPath(h.bundleName));_=dT(I,f||{},m)}}).catch(I=>(m.error&&m.error(I),()=>{})),()=>{E||(E=!0,_&&_())}}(r,s,i,a,t[o])}throw new G(F.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function C7(n,e){return pU(on(n=ot(n,Mt)),Zl(e)?e:{next:e})}function Uh(n,e){return function(r,s){const i=new Un;return r.asyncQueue.enqueueAndForget(async()=>z5(await Dx(r),s,i)),i.promise}(on(n),e)}function qx(n,e,t){const r=t.docs.get(e._key),s=new Jo(n);return new Br(n,s,e._key,r,new uo(t.hasPendingWrites,t.fromCache),e.converter)}function R7(n){return jU(n,{count:PU()})}function jU(n,e){const t=ot(n.firestore,Mt),r=on(t),s=TN(e,(i,o)=>new ak(o,i.aggregateType,i._internalFieldPath));return mU(r,n._query,s).then(i=>function(a,l,u){const h=new Jo(a);return new bU(l,h,u)}(t,n,i))}class VU{constructor(e){this.kind="memory",this._onlineComponentProvider=Uo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Nx(void 0)}}toJSON(){return{kind:this.kind}}}class FU{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=qU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class UU{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Lc.provider}toJSON(){return{kind:this.kind}}}class $U{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Nx(e)}}toJSON(){return{kind:this.kind}}}function N7(){return new UU}function k7(n){return new $U(n==null?void 0:n.cacheSizeBytes)}function P7(n){return new VU(n)}function D7(n){return new FU(n)}class BU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Uo.provider,this._offlineComponentProvider={build:t=>new kx(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class zU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Uo.provider,this._offlineComponentProvider={build:t=>new fP(t,e==null?void 0:e.cacheSizeBytes)}}}function qU(n){return new BU(n==null?void 0:n.forceOwnership)}function O7(){return new zU}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WU={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ll(e)}set(e,t,r){this._verifyNotCommitted();const s=ho(e,this._firestore),i=Fg(s.converter,t,r),o=Dg(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Zt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ho(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof ol?Fx(this._dataReader,"WriteBatch.update",i._key,t,r,s):Vx(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Zt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ho(e,this._firestore);return this._mutations=this._mutations.concat(new Kc(t._key,Zt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new G(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ho(n,e){if((n=le(n)).firestore!==e)throw new G(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ll(e)}get(e){const t=ho(e,this._firestore),r=new zx(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return he(24041);const i=s[0];if(i.isFoundDocument())return new sh(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new sh(this._firestore,r,t._key,null,t.converter);throw he(18433,{doc:i})})}set(e,t,r){const s=ho(e,this._firestore),i=Fg(s.converter,t,r),o=Dg(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=ho(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof ol?Fx(this._dataReader,"Transaction.update",i._key,t,r,s):Vx(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=ho(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QU extends HU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ho(e,this._firestore),r=new Jo(this._firestore);return super.get(e).then(s=>new Br(this._firestore,r,t._key,s._document,new uo(!1,!1),t.converter))}}function M7(n,e,t){n=ot(n,Mt);const r={...WU,...t};return function(i){if(i.maxAttempts<1)throw new G(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Un;return i.asyncQueue.enqueueAndForget(async()=>{const u=await gP(i);new lU(i.asyncQueue,u,a,o,l).ju()}),l.promise}(on(n),s=>e(new QU(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L7(){return new jh("deleteField")}function hm(){return new Ox("serverTimestamp")}function j7(...n){return new Mx("arrayUnion",n)}function V7(...n){return new Lx("arrayRemove",n)}function F7(n){return new jx("increment",n)}function U7(n){return new Es(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $7(n){return on(n=ot(n,Mt)),new GU(n,e=>Uh(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B7(n,e){const t=on(n=ot(n,Mt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return cs("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new G(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=hT(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const m=Og("setIndexConfiguration",hT(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Ea(m,2)):f.order==="ASCENDING"?h.push(new Ea(m,0)):f.order==="DESCENDING"&&h.push(new Ea(m,1))}a.push(new wc(wc.UNKNOWN_ID,u,h,xc.empty()))}return a}(e);return _U(t,r)}function hT(n,e){if(typeof n[e]!="string")throw new G(F.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function z7(n){var s;n=ot(n,Mt);const e=fT.get(n);if(e)return e;if(((s=on(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new KU(n);return fT.set(n,r),r}function q7(n){VP(n,!0)}function W7(n){VP(n,!1)}function G7(n){wU(on(n._firestore)).then(e=>K("deleting all persistent cache indexes succeeded")).catch(e=>cs("deleting all persistent cache indexes failed",e))}function VP(n,e){vU(on(n._firestore),e).then(t=>K(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>cs(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const fT=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H7(n){var r;const e=on(ot(n.firestore,Mt)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:Ig(t,ar(n._query)).ft}function Q7(n,e){var i;const t=TN(e,(o,a)=>new ak(a,o.aggregateType,o._internalFieldPath)),r=on(ot(n.firestore,Mt)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:vk(s,WN(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K7{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Wx.instance.onExistenceFilterMismatch(e)}}class Wx{constructor(){this.Mc=new Map}static get instance(){return kf||(kf=new Wx,function(t){if(cd)throw new Error("a TestingHooksSpi instance is already set");cd=t}(kf)),kf}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let kf=null;(function(e,t=!0){(function(s){Gc=s})(el),Ts(new Rr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Mt(new i3(r.getProvider("auth-internal")),new l3(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new G(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Va(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Ar(zE,qE,e),Ar(zE,qE,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y7={PHONE:"phone",TOTP:"totp"},J7={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},X7={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},Z7={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},eW={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function FP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tW=YU,JU=FP,UP=new Xa("auth","Firebase",FP()),nW={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp=new ph("@firebase/auth");function XU(n,...e){xp.logLevel<=it.WARN&&xp.warn(`Auth (${el}): ${n}`,...e)}function fm(n,...e){xp.logLevel<=it.ERROR&&xp.error(`Auth (${el}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(n,...e){throw Hx(n,...e)}function pr(n,...e){return Hx(n,...e)}function Gx(n,e,t){const r={...JU(),[e]:t};return new Xa("auth","Firebase",r).create(e,{appName:n.name})}function $n(n){return Gx(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function nu(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Nr(n,"argument-error"),Gx(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Hx(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return UP.create(n,...e)}function ee(n,e,...t){if(!n)throw Hx(e,...t)}function Gs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw fm(e),new Error(e)}function Ci(n,e){n||Gs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ih(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Qx(){return mT()==="http:"||mT()==="https:"}function mT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Qx()||X0()||"connection"in navigator)?navigator.onLine:!0}function e$(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ci(t>e,"Short delay should be less than long delay!"),this.isMobile=J0()||xC()}get(){return ZU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kx(n,e){Ci(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Gs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Gs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Gs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t$={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n$=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],r$=new $h(3e4,6e4);function qt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Wt(n,e,t,r,s={}){return BP(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Za({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return dL()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Pi(n.emulatorConfig.host)&&(u.credentials="include"),$P.fetch()(await zP(n,n.config.apiHost,t,a),u)})}async function BP(n,e,t){n._canInitEmulator=!1;const r={...t$,...e};try{const s=new i$(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw $u(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw $u(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw $u(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw $u(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Gx(n,h,u);Nr(n,h)}}catch(s){if(s instanceof As)throw s;Nr(n,"network-request-failed",{message:String(s)})}}async function ji(n,e,t,r,s={}){const i=await Wt(n,e,t,r,s);return"mfaPendingCredential"in i&&Nr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function zP(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?Kx(n.config,s):`${n.config.apiScheme}://${s}`;return n$.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function s$(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class i${clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(pr(this.auth,"network-request-failed")),r$.get())})}}function $u(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=pr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pT(n){return n!==void 0&&n.getResponse!==void 0}function gT(n){return n!==void 0&&n.enterprise!==void 0}class qP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return s$(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o$(n){return(await Wt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function WP(n,e){return Wt(n,"GET","/v2/recaptchaConfig",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a$(n,e){return Wt(n,"POST","/v1/accounts:delete",e)}async function l$(n,e){return Wt(n,"POST","/v1/accounts:update",e)}async function Sp(n,e){return Wt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rW(n,e=!1){return le(n).getIdToken(e)}async function c$(n,e=!1){const t=le(n),r=await t.getIdToken(e),s=Ug(r);ee(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:hd(Yy(s.auth_time)),issuedAtTime:hd(Yy(s.iat)),expirationTime:hd(Yy(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Yy(n){return Number(n)*1e3}function Ug(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return fm("JWT malformed, contained fewer than 3 sections"),null;try{const s=zm(t);return s?JSON.parse(s):(fm("Failed to decode base64 JWT payload"),null)}catch(s){return fm("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function yT(n){const e=Ug(n);return ee(e,"internal-error"),ee(typeof e.exp<"u","internal-error"),ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ri(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof As&&u$(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function u$({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d${constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=hd(this.lastLoginAt),this.creationTime=hd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oh(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Ri(n,Sp(e,{idToken:t}));ee(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?GP(s.providerUserInfo):[],o=f$(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Yv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function h$(n){const e=le(n);await oh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function f$(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function GP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m$(n,e){const t=await BP(n,{},async()=>{const r=Za({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await zP(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&Pi(n.emulatorConfig.host)&&(l.credentials="include"),$P.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function p$(n,e){return Wt(n,"POST","/v2/accounts:revokeToken",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ee(e.idToken,"internal-error"),ee(typeof e.idToken<"u","internal-error"),ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ee(e.length!==0,"internal-error");const t=yT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await m$(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ec;return r&&(ee(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ee(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ee(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ec,this.toJSON())}_performRefresh(){return Gs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(n,e){ee(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ws{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new d$(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Yv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ri(this,this.stsTokenManager.getToken(this.auth,e));return ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return c$(this,e)}reload(){return h$(this)}_assign(e){this!==e&&(ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ws({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await oh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Yt(this.auth.app))return Promise.reject($n(this.auth));const e=await this.getIdToken();return await Ri(this,a$(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:y,providerData:_,stsTokenManager:E}=t;ee(f&&E,e,"internal-error");const k=ec.fromJSON(this.name,E);ee(typeof f=="string",e,"internal-error"),Ki(r,e.name),Ki(s,e.name),ee(typeof m=="boolean",e,"internal-error"),ee(typeof y=="boolean",e,"internal-error"),Ki(i,e.name),Ki(o,e.name),Ki(a,e.name),Ki(l,e.name),Ki(u,e.name),Ki(h,e.name);const I=new ws({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:k,createdAt:u,lastLoginAt:h});return _&&Array.isArray(_)&&(I.providerData=_.map(x=>({...x}))),l&&(I._redirectEventId=l),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new ec;s.updateFromServerResponse(t);const i=new ws({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await oh(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ee(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?GP(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ec;a.updateFromIdToken(r);const l=new ws({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Yv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _T=new Map;function pi(n){Ci(n instanceof Function,"Expected a class definition");let e=_T.get(n);return e?(Ci(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,_T.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}HP.type="NONE";const vT=HP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(n,e,t){return`firebase:${n}:${e}:${t}`}class tc{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=mm(this.userKey,s.apiKey,i),this.fullPersistenceKey=mm("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Sp(this.auth,{idToken:e}).catch(()=>{});return t?ws._fromGetAccountInfoResponse(this.auth,t,e):null}return ws._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new tc(pi(vT),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||pi(vT);const o=mm(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const m=await Sp(e,{idToken:h}).catch(()=>{});if(!m)break;f=await ws._fromGetAccountInfoResponse(e,m,h)}else f=ws._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new tc(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new tc(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(JP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(QP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ZP(e))return"Blackberry";if(eD(e))return"Webos";if(KP(e))return"Safari";if((e.includes("chrome/")||YP(e))&&!e.includes("edge/"))return"Chrome";if(XP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function QP(n=Nn()){return/firefox\//i.test(n)}function KP(n=Nn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function YP(n=Nn()){return/crios\//i.test(n)}function JP(n=Nn()){return/iemobile/i.test(n)}function XP(n=Nn()){return/android/i.test(n)}function ZP(n=Nn()){return/blackberry/i.test(n)}function eD(n=Nn()){return/webos/i.test(n)}function Yx(n=Nn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function g$(n=Nn()){var e;return Yx(n)&&!!((e=window.navigator)!=null&&e.standalone)}function y$(){return hL()&&document.documentMode===10}function tD(n=Nn()){return Yx(n)||XP(n)||eD(n)||ZP(n)||/windows phone/i.test(n)||JP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nD(n,e=[]){let t;switch(n){case"Browser":t=wT(Nn());break;case"Worker":t=`${wT(Nn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${el}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _${constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v$(n,e={}){return Wt(n,"GET","/v2/passwordPolicy",qt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w$=6;class x${constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??w$,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S${constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xT(this),this.idTokenSubscription=new xT(this),this.beforeStateQueue=new _$(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=UP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=pi(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await tc.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Sp(this,{idToken:e}),r=await ws._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Yt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await oh(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=e$()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Yt(this.app))return Promise.reject($n(this));const t=e?le(e):null;return t&&ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Yt(this.app)?Promise.reject($n(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Yt(this.app)?Promise.reject($n(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(pi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await v$(this),t=new x$(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Xa("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await p$(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&pi(e)||this._popupRedirectResolver;ee(t,this,"argument-error"),this.redirectPersistenceManager=await tc.create(this,[pi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ee(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nD(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Yt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&XU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function fn(n){return le(n)}class xT{constructor(e){this.auth=e,this.observer=null,this.addObserver=vL(t=>this.observer=t)}get next(){return ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function I$(n){Bh=n}function Jx(n){return Bh.loadJS(n)}function E$(){return Bh.recaptchaV2Script}function b$(){return Bh.recaptchaEnterpriseScript}function T$(){return Bh.gapiScript}function rD(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A$=500,C$=6e4,Pf=1e12;class R${constructor(e){this.auth=e,this.counter=Pf,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new P$(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||Pf;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||Pf;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||Pf;return(r=this._widgets.get(t))==null||r.execute(),""}}class N${constructor(){this.enterprise=new k$}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class k${ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class P${constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ee(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=D$(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},C$)},A$))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function D$(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const O$="recaptcha-enterprise",fd="NO_RECAPTCHA";class sD{constructor(e){this.type=O$,this.auth=fn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{WP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new qP(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;gT(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(fd)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new N$().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&gT(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=b$();l.length!==0&&(l+=a),Jx(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Cu(n,e,t,r=!1,s=!1){const i=new sD(n);let o;if(s)o=fd;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function To(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Cu(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Cu(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Cu(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Cu(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await Cu(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function iD(n){const e=fn(n),t=await WP(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new qP(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new sD(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M$(n,e){const t=si(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Gr(i,e??{}))return s;Nr(s,"already-initialized")}return t.initialize({options:e})}function L$(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(pi);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function j$(n,e,t){const r=fn(n);ee(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=oD(e),{host:o,port:a}=V$(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){ee(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ee(Gr(u,r.config.emulator)&&Gr(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Pi(o)?(Wp(`${i}//${o}${l}`),Y0("Auth",!0)):s||F$()}function oD(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function V$(n){const e=oD(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ST(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ST(o)}}}function ST(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function F$(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Gs("not implemented")}_getIdTokenResponse(e){return Gs("not implemented")}_linkToIdToken(e,t){return Gs("not implemented")}_getReauthenticationResolver(e){return Gs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aD(n,e){return Wt(n,"POST","/v1/accounts:resetPassword",qt(n,e))}async function U$(n,e){return Wt(n,"POST","/v1/accounts:update",e)}async function $$(n,e){return Wt(n,"POST","/v1/accounts:signUp",e)}async function B$(n,e){return Wt(n,"POST","/v1/accounts:update",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z$(n,e){return ji(n,"POST","/v1/accounts:signInWithPassword",qt(n,e))}async function $g(n,e){return Wt(n,"POST","/v1/accounts:sendOobCode",qt(n,e))}async function q$(n,e){return $g(n,e)}async function W$(n,e){return $g(n,e)}async function G$(n,e){return $g(n,e)}async function H$(n,e){return $g(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q$(n,e){return ji(n,"POST","/v1/accounts:signInWithEmailLink",qt(n,e))}async function K$(n,e){return ji(n,"POST","/v1/accounts:signInWithEmailLink",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah extends zh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new ah(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ah(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return To(e,t,"signInWithPassword",z$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Q$(e,{email:this._email,oobCode:this._password});default:Nr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return To(e,r,"signUpPassword",$$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return K$(e,{idToken:t,email:this._email,oobCode:this._password});default:Nr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vi(n,e){return ji(n,"POST","/v1/accounts:signInWithIdp",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y$="http://localhost";class Ni extends zh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ni(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Nr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Ni(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return vi(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,vi(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,vi(e,t)}buildRequest(){const e={requestUri:Y$,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Za(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IT(n,e){return Wt(n,"POST","/v1/accounts:sendVerificationCode",qt(n,e))}async function J$(n,e){return ji(n,"POST","/v1/accounts:signInWithPhoneNumber",qt(n,e))}async function X$(n,e){const t=await ji(n,"POST","/v1/accounts:signInWithPhoneNumber",qt(n,e));if(t.temporaryProof)throw $u(n,"account-exists-with-different-credential",t);return t}const Z$={USER_NOT_FOUND:"user-not-found"};async function eB(n,e){const t={...e,operation:"REAUTH"};return ji(n,"POST","/v1/accounts:signInWithPhoneNumber",qt(n,t),Z$)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa extends zh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Aa({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Aa({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return J$(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return X$(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return eB(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Aa({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tB(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function nB(n){const e=Ou(Mu(n)).link,t=e?Ou(Mu(e)).deep_link_id:null,r=Ou(Mu(n)).deep_link_id;return(r?Ou(Mu(r)).link:null)||r||t||e||n}class qh{constructor(e){const t=Ou(Mu(e)),r=t.apiKey??null,s=t.oobCode??null,i=tB(t.mode??null);ee(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=nB(e);try{return new qh(t)}catch{return null}}}function sW(n){return qh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(){this.providerId=ul.PROVIDER_ID}static credential(e,t){return ah._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=qh.parseLink(t);return ee(r,"argument-error"),ah._fromEmailAndCode(e,r.code,r.tenantId)}}ul.PROVIDER_ID="password";ul.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ul.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru extends Vi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class pm extends ru{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ee("providerId"in t&&"signInMethod"in t,"argument-error"),Ni._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return ee(e.idToken||e.accessToken,"argument-error"),Ni._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return pm.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return pm.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new pm(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no extends ru{constructor(){super("facebook.com")}static credential(e){return Ni._fromParams({providerId:no.PROVIDER_ID,signInMethod:no.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return no.credentialFromTaggedObject(e)}static credentialFromError(e){return no.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return no.credential(e.oauthAccessToken)}catch{return null}}}no.FACEBOOK_SIGN_IN_METHOD="facebook.com";no.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui extends ru{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ni._fromParams({providerId:ui.PROVIDER_ID,signInMethod:ui.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ui.credentialFromTaggedObject(e)}static credentialFromError(e){return ui.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ui.credential(t,r)}catch{return null}}}ui.GOOGLE_SIGN_IN_METHOD="google.com";ui.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro extends ru{constructor(){super("github.com")}static credential(e){return Ni._fromParams({providerId:ro.PROVIDER_ID,signInMethod:ro.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ro.credentialFromTaggedObject(e)}static credentialFromError(e){return ro.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ro.credential(e.oauthAccessToken)}catch{return null}}}ro.GITHUB_SIGN_IN_METHOD="github.com";ro.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rB="http://localhost";class lh extends zh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return vi(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,vi(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,vi(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new lh(r,i)}static _create(e,t){return new lh(e,t)}buildRequest(){return{requestUri:rB,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sB="saml.";class Jv extends Vi{constructor(e){ee(e.startsWith(sB),"argument-error"),super(e)}static credentialFromResult(e){return Jv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Jv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=lh.fromJSON(e);return ee(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return lh._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so extends ru{constructor(){super("twitter.com")}static credential(e,t){return Ni._fromParams({providerId:so.PROVIDER_ID,signInMethod:so.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return so.credentialFromTaggedObject(e)}static credentialFromError(e){return so.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return so.credential(t,r)}catch{return null}}}so.TWITTER_SIGN_IN_METHOD="twitter.com";so.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lD(n,e){return ji(n,"POST","/v1/accounts:signUp",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ws._fromIdTokenResponse(e,r,s),o=ET(r);return new us({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=ET(r);return new us({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function ET(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iW(n){var s;if(Yt(n.app))return Promise.reject($n(n));const e=fn(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new us({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await lD(e,{returnSecureToken:!0}),r=await us._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip extends As{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Ip.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Ip(e,t,r,s)}}function cD(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Ip._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uD(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oW(n,e){const t=le(n);await Bg(!0,t,e);const{providerUserInfo:r}=await l$(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=uD(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Xx(n,e,t=!1){const r=await Ri(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return us._forOperation(n,"link",r)}async function Bg(n,e,t){await oh(e);const r=uD(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ee(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dD(n,e,t=!1){const{auth:r}=n;if(Yt(r.app))return Promise.reject($n(r));const s="reauthenticate";try{const i=await Ri(n,cD(r,s,e,n),t);ee(i.idToken,r,"internal-error");const o=Ug(i.idToken);ee(o,r,"internal-error");const{sub:a}=o;return ee(n.uid===a,r,"user-mismatch"),us._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Nr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hD(n,e,t=!1){if(Yt(n.app))return Promise.reject($n(n));const r="signIn",s=await cD(n,r,e),i=await us._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Zx(n,e){return hD(fn(n),e)}async function iB(n,e){const t=le(n);return await Bg(!1,t,e.providerId),Xx(t,e)}async function oB(n,e){return dD(le(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aB(n,e){return ji(n,"POST","/v1/accounts:signInWithCustomToken",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aW(n,e){if(Yt(n.app))return Promise.reject($n(n));const t=fn(n),r=await aB(t,{token:e,returnSecureToken:!0}),s=await us._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?eS._fromServerResponse(e,t):"totpInfo"in t?tS._fromServerResponse(e,t):Nr(e,"internal-error")}}class eS extends Wh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new eS(t)}}class tS extends Wh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new tS(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zg(n,e,t){var r;ee(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),ee(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),ee(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ee(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ee(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nS(n){const e=fn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function lB(n,e,t){const r=fn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&zg(r,s,t),await To(r,s,"getOobCode",W$,"EMAIL_PASSWORD_PROVIDER")}async function lW(n,e,t){await aD(le(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&nS(n),r})}async function cW(n,e){await B$(le(n),{oobCode:e})}async function cB(n,e){const t=le(n),r=await aD(t,{oobCode:e}),s=r.requestType;switch(ee(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ee(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ee(r.mfaInfo,t,"internal-error");default:ee(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Wh._fromServerResponse(fn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function uW(n,e){const{data:t}=await cB(le(n),e);return t.email}async function fD(n,e,t){if(Yt(n.app))return Promise.reject($n(n));const r=fn(n),o=await To(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",lD,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&nS(n),l}),a=await us._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function mD(n,e,t){return Yt(n.app)?Promise.reject($n(n)):Zx(le(n),ul.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&nS(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dW(n,e,t){const r=fn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){ee(a.handleCodeInApp,r,"argument-error"),a&&zg(r,o,a)}i(s,t),await To(r,s,"getOobCode",G$,"EMAIL_PASSWORD_PROVIDER")}function hW(n,e){const t=qh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function fW(n,e,t){if(Yt(n.app))return Promise.reject($n(n));const r=le(n),s=ul.credentialWithLink(e,t||ih());return ee(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Zx(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uB(n,e){return Wt(n,"POST","/v1/accounts:createAuthUri",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mW(n,e){const t=Qx()?ih():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await uB(le(n),r);return s||[]}async function dB(n,e){const t=le(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&zg(t.auth,s,e);const{email:i}=await q$(t.auth,s);i!==n.email&&await n.reload()}async function pW(n,e,t){const r=le(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&zg(r.auth,i,t);const{email:o}=await H$(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hB(n,e){return Wt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gW(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=le(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ri(r,hB(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function yW(n,e){const t=le(n);return Yt(t.auth.app)?Promise.reject($n(t.auth)):pD(t,e,null)}function _W(n,e){return pD(le(n),null,e)}async function pD(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Ri(n,U$(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fB(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Ug(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new nc(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new mB(r,t);case"github.com":return new pB(r,t);case"google.com":return new gB(r,t);case"twitter.com":return new yB(r,t,n.screenName||null);case"custom":case"anonymous":return new nc(r,null);default:return new nc(r,e,t)}}class nc{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class gD extends nc{constructor(e,t,r,s){super(e,t,r),this.username=s}}class mB extends nc{constructor(e,t){super(e,"facebook.com",t)}}class pB extends gD{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class gB extends nc{constructor(e,t){super(e,"google.com",t)}}class yB extends gD{constructor(e,t,r){super(e,"twitter.com",t,r)}}function vW(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:fB(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yD(n,e){return le(n).setPersistence(e)}function wW(n){return iD(n)}async function xW(n,e){return fn(n).validatePassword(e)}function _B(n,e,t,r){return le(n).onIdTokenChanged(e,t,r)}function vB(n,e,t){return le(n).beforeAuthStateChanged(e,t)}function wB(n,e,t,r){return le(n).onAuthStateChanged(e,t,r)}function SW(n){le(n).useDeviceLanguage()}function IW(n,e){return le(n).updateCurrentUser(e)}function xB(n){return le(n).signOut()}function EW(n,e){return fn(n).revokeAccessToken(e)}async function bW(n){return le(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new va("enroll",e,t)}static _fromMfaPendingCredential(e){return new va("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return va._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return va._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=fn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Wh._fromServerResponse(r,a));ee(s.mfaPendingCredential,r,"internal-error");const o=va._fromMfaPendingCredential(s.mfaPendingCredential);return new rS(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await us._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return ee(t.user,r,"internal-error"),us._forOperation(t.user,t.operationType,u);default:Nr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function TW(n,e){var s;const t=le(n),r=e;return ee(e.customData.operationType,t,"argument-error"),ee((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),rS._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bT(n,e){return Wt(n,"POST","/v2/accounts/mfaEnrollment:start",qt(n,e))}function SB(n,e){return Wt(n,"POST","/v2/accounts/mfaEnrollment:finalize",qt(n,e))}function IB(n,e){return Wt(n,"POST","/v2/accounts/mfaEnrollment:start",qt(n,e))}function EB(n,e){return Wt(n,"POST","/v2/accounts/mfaEnrollment:finalize",qt(n,e))}function bB(n,e){return Wt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",qt(n,e))}class sS{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Wh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new sS(e)}async getSession(){return va._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Ri(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Ri(this.user,bB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Jy=new WeakMap;function AW(n){const e=le(n);return Jy.has(e)||Jy.set(e,sS._fromUser(e)),Jy.get(e)}const Ep="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _D{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ep,"1"),this.storage.removeItem(Ep),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TB=1e3,AB=10;class vD extends _D{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tD(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);y$()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,AB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},TB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}vD.type="LOCAL";const md=vD;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB=1e3;function Xy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function Zy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class wD{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Zy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return Xy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=Zy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=Zy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(m=>m.name===r);h&&t(h.value),u.deleted.find(m=>m.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=Xy(r);const i=setInterval(()=>{const a=Xy(r);a!==s&&(t(a),s=a)},CB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}wD.type="COOKIE";const CW=wD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD extends _D{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xD.type="SESSION";const pd=xD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new qg(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await RB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qg.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wg(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Wg("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(){return window}function kB(n){En().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iS(){return typeof En().WorkerGlobalScope<"u"&&typeof En().importScripts=="function"}async function PB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function DB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function OB(){return iS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD="firebaseLocalStorageDb",MB=1,bp="firebaseLocalStorage",ID="fbase_key";class Gh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Gg(n,e){return n.transaction([bp],e?"readwrite":"readonly").objectStore(bp)}function LB(){const n=indexedDB.deleteDatabase(SD);return new Gh(n).toPromise()}function Xv(){const n=indexedDB.open(SD,MB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(bp,{keyPath:ID})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(bp)?e(r):(r.close(),await LB(),e(await Xv()))})})}async function TT(n,e,t){const r=Gg(n,!0).put({[ID]:e,value:t});return new Gh(r).toPromise()}async function jB(n,e){const t=Gg(n,!1).get(e),r=await new Gh(t).toPromise();return r===void 0?null:r.value}function AT(n,e){const t=Gg(n,!0).delete(e);return new Gh(t).toPromise()}const VB=800,FB=3;class ED{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Xv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>FB)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return iS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qg._getInstance(OB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await PB(),!this.activeServiceWorker)return;this.sender=new NB(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||DB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xv();return await TT(e,Ep,"1"),await AT(e,Ep),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>TT(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>jB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>AT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Gg(s,!1).getAll();return new Gh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),VB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ED.type="LOCAL";const UB=ED;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CT(n,e){return Wt(n,"POST","/v2/accounts/mfaSignIn:start",qt(n,e))}function $B(n,e){return Wt(n,"POST","/v2/accounts/mfaSignIn:finalize",qt(n,e))}function BB(n,e){return Wt(n,"POST","/v2/accounts/mfaSignIn:finalize",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e_=rD("rcb"),zB=new $h(3e4,6e4);class qB{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=En().grecaptcha)!=null&&e.render)}load(e,t=""){return ee(WB(t),e,"argument-error"),this.shouldResolveImmediately(t)&&pT(En().grecaptcha)?Promise.resolve(En().grecaptcha):new Promise((r,s)=>{const i=En().setTimeout(()=>{s(pr(e,"network-request-failed"))},zB.get());En()[e_]=()=>{En().clearTimeout(i),delete En()[e_];const a=En().grecaptcha;if(!a||!pT(a)){s(pr(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${E$()}?${Za({onload:e_,render:"explicit",hl:t})}`;Jx(o).catch(()=>{clearTimeout(i),s(pr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=En().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function WB(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class GB{async load(e){return new R$(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gd="recaptcha",HB={theme:"light",type:"image"};class RW{constructor(e,t,r={...HB}){this.parameters=r,this.type=gd,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=fn(e),this.isInvisible=this.parameters.size==="invisible",ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ee(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new GB:new qB,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ee(!this.parameters.sitekey,this.auth,"argument-error"),ee(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=En()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ee(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ee(Qx()&&!iS(),this.auth,"internal-error"),await QB(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await o$(this.auth);ee(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ee(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function QB(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Aa._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function NW(n,e,t){if(Yt(n.app))return Promise.reject($n(n));const r=fn(n),s=await Hg(r,e,le(t));return new oS(s,i=>Zx(r,i))}async function kW(n,e,t){const r=le(n);await Bg(!1,r,"phone");const s=await Hg(r.auth,e,le(t));return new oS(s,i=>iB(r,i))}async function PW(n,e,t){const r=le(n);if(Yt(r.auth.app))return Promise.reject($n(r.auth));const s=await Hg(r.auth,e,le(t));return new oS(s,i=>oB(r,i))}async function Hg(n,e,t){var r;if(!n._getRecaptchaConfig())try{await iD(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){ee(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await To(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===fd){ee((t==null?void 0:t.type)===gd,h,"argument-error");const m=await t_(h,f,t);return bT(h,m)}return bT(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{ee(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;ee(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await To(n,a,"mfaSmsSignIn",async(f,m)=>{if(m.phoneSignInInfo.captchaResponse===fd){ee((t==null?void 0:t.type)===gd,f,"argument-error");const y=await t_(f,m,t);return CT(f,y)}return CT(f,m)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await To(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===fd){ee((t==null?void 0:t.type)===gd,u,"argument-error");const f=await t_(u,h,t);return IT(u,f)}return IT(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function DW(n,e){const t=le(n);if(Yt(t.auth.app))return Promise.reject($n(t.auth));await Xx(t,e)}async function t_(n,e,t){ee(t.type===gd,n,"argument-error");const r=await t.verify();ee(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e){this.providerId=rc.PROVIDER_ID,this.auth=fn(e)}verifyPhoneNumber(e,t){return Hg(this.auth,e,le(t))}static credential(e,t){return Aa._fromVerification(e,t)}static credentialFromResult(e){const t=e;return rc.credentialFromTaggedObject(t)}static credentialFromError(e){return rc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Aa._fromTokenResponse(t,r):null}}rc.PROVIDER_ID="phone";rc.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dl(n,e){return e?pi(e):(ee(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS extends zh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return vi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return vi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return vi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function KB(n){return hD(n.auth,new aS(n),n.bypassAuthState)}function YB(n){const{auth:e,user:t}=n;return ee(t,e,"internal-error"),dD(t,new aS(n),n.bypassAuthState)}async function JB(n){const{auth:e,user:t}=n;return ee(t,e,"internal-error"),Xx(t,new aS(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return KB;case"linkViaPopup":case"linkViaRedirect":return JB;case"reauthViaPopup":case"reauthViaRedirect":return YB;default:Nr(this.auth,"internal-error")}}resolve(e){Ci(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ci(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XB=new $h(2e3,1e4);async function ZB(n,e,t){if(Yt(n.app))return Promise.reject(pr(n,"operation-not-supported-in-this-environment"));const r=fn(n);nu(n,e,Vi);const s=dl(r,t);return new gi(r,"signInViaPopup",e,s).executeNotNull()}async function OW(n,e,t){const r=le(n);if(Yt(r.auth.app))return Promise.reject(pr(r.auth,"operation-not-supported-in-this-environment"));nu(r.auth,e,Vi);const s=dl(r.auth,t);return new gi(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function MW(n,e,t){const r=le(n);nu(r.auth,e,Vi);const s=dl(r.auth,t);return new gi(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class gi extends bD{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,gi.currentPopupAction&&gi.currentPopupAction.cancel(),gi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ee(e,this.auth,"internal-error"),e}async onExecution(){Ci(this.filter.length===1,"Popup operations only handle one event");const e=Wg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(pr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(pr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,gi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(pr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,XB.get())};e()}}gi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ez="pendingRedirect",gm=new Map;class tz extends bD{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=gm.get(this.auth._key());if(!e){try{const r=await nz(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}gm.set(this.auth._key(),e)}return this.bypassAuthState||gm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nz(n,e){const t=AD(e),r=TD(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function lS(n,e){return TD(n)._set(AD(e),"true")}function rz(n,e){gm.set(n._key(),e)}function TD(n){return pi(n._redirectPersistence)}function AD(n){return mm(ez,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LW(n,e,t){return sz(n,e,t)}async function sz(n,e,t){if(Yt(n.app))return Promise.reject($n(n));const r=fn(n);nu(n,e,Vi),await r._initializationPromise;const s=dl(r,t);return await lS(s,r),s._openRedirect(r,e,"signInViaRedirect")}function jW(n,e,t){return iz(n,e,t)}async function iz(n,e,t){const r=le(n);if(nu(r.auth,e,Vi),Yt(r.auth.app))return Promise.reject($n(r.auth));await r.auth._initializationPromise;const s=dl(r.auth,t);await lS(s,r.auth);const i=await RD(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function VW(n,e,t){return oz(n,e,t)}async function oz(n,e,t){const r=le(n);nu(r.auth,e,Vi),await r.auth._initializationPromise;const s=dl(r.auth,t);await Bg(!1,r,e.providerId),await lS(s,r.auth);const i=await RD(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function FW(n,e){return await fn(n)._initializationPromise,CD(n,e,!1)}async function CD(n,e,t=!1){if(Yt(n.app))return Promise.reject($n(n));const r=fn(n),s=dl(r,e),o=await new tz(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function RD(n){const e=Wg(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const az=10*60*1e3;class lz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!cz(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!ND(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(pr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=az&&this.cachedEventUids.clear(),this.cachedEventUids.has(RT(e))}saveEventToCache(e){this.cachedEventUids.add(RT(e)),this.lastProcessedEventTime=Date.now()}}function RT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ND({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function cz(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ND(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uz(n,e={}){return Wt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hz=/^https?/;async function fz(n){if(n.config.emulator)return;const{authorizedDomains:e}=await uz(n);for(const t of e)try{if(mz(t))return}catch{}Nr(n,"unauthorized-domain")}function mz(n){const e=ih(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!hz.test(t))return!1;if(dz.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pz=new $h(3e4,6e4);function NT(){const n=En().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function gz(n){return new Promise((e,t)=>{var s,i,o;function r(){NT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{NT(),t(pr(n,"network-request-failed"))},timeout:pz.get()})}if((i=(s=En().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=En().gapi)!=null&&o.load)r();else{const a=rD("iframefcb");return En()[a]=()=>{gapi.load?r():t(pr(n,"network-request-failed"))},Jx(`${T$()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw ym=null,e})}let ym=null;function yz(n){return ym=ym||gz(n),ym}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _z=new $h(5e3,15e3),vz="__/auth/iframe",wz="emulator/auth/iframe",xz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Sz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Iz(n){const e=n.config;ee(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Kx(e,wz):`https://${n.config.authDomain}/${vz}`,r={apiKey:e.apiKey,appName:n.name,v:el},s=Sz.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Za(r).slice(1)}`}async function Ez(n){const e=await yz(n),t=En().gapi;return ee(t,n,"internal-error"),e.open({where:document.body,url:Iz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xz,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=pr(n,"network-request-failed"),a=En().setTimeout(()=>{i(o)},_z.get());function l(){En().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Tz=500,Az=600,Cz="_blank",Rz="http://localhost";class kT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Nz(n,e,t,r=Tz,s=Az){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...bz,width:r.toString(),height:s.toString(),top:i,left:o},u=Nn().toLowerCase();t&&(a=YP(u)?Cz:t),QP(u)&&(e=e||Rz,l.scrollbars="yes");const h=Object.entries(l).reduce((m,[y,_])=>`${m}${y}=${_},`,"");if(g$(u)&&a!=="_self")return kz(e||"",a),new kT(null);const f=window.open(e||"",a,h);ee(f,n,"popup-blocked");try{f.focus()}catch{}return new kT(f)}function kz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pz="__/auth/handler",Dz="emulator/auth/handler",Oz=encodeURIComponent("fac");async function PT(n,e,t,r,s,i){ee(n.config.authDomain,n,"auth-domain-config-required"),ee(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:el,eventId:s};if(e instanceof Vi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",qm(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof ru){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${Oz}=${encodeURIComponent(l)}`:"";return`${Mz(n)}?${Za(a).slice(1)}${u}`}function Mz({config:n}){return n.emulator?Kx(n,Dz):`https://${n.authDomain}/${Pz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n_="webStorageSupport";class Lz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pd,this._completeRedirectFn=CD,this._overrideRedirectResult=rz}async _openPopup(e,t,r,s){var o;Ci((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await PT(e,t,r,ih(),s);return Nz(e,i,Wg())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await PT(e,t,r,ih(),s);return kB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ci(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Ez(e),r=new lz(e);return t.register("authEvent",s=>(ee(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(n_,{type:n_},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[n_];i!==void 0&&t(!!i),Nr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=fz(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return tD()||KP()||Yx()}}const jz=Lz;class kD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Gs("unexpected MultiFactorSessionType")}}}class cS extends kD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new cS(e)}_finalizeEnroll(e,t,r){return SB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return $B(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Vz{constructor(){}static assertion(e){return cS._fromCredential(e)}}Vz.FACTOR_ID="phone";class Fz{static assertionForEnrollment(e,t){return ch._fromSecret(e,t)}static assertionForSignIn(e,t){return ch._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;ee(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await IB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return uS._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}Fz.FACTOR_ID="totp";class ch extends kD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new ch(t,void 0,e)}static _fromEnrollmentId(e,t){return new ch(t,e)}async _finalizeEnroll(e,t,r){return ee(typeof this.secret<"u",e,"argument-error"),EB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){ee(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return BB(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class uS{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new uS(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(Df(e)||Df(t))&&(r=!0),r&&(Df(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),Df(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Df(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var DT="@firebase/auth",OT="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $z(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Bz(n){Ts(new Rr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ee(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nD(n)},u=new S$(r,s,i,l);return L$(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ts(new Rr("auth-internal",e=>{const t=fn(e.getProvider("auth").getImmediate());return(r=>new Uz(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ar(DT,OT,$z(n)),Ar(DT,OT,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zz=5*60,qz=_C("authIdTokenMaxAge")||zz;let MT=null;const Wz=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>qz)return;const s=t==null?void 0:t.token;MT!==s&&(MT=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Gz(n=gh()){const e=si(n,"auth");if(e.isInitialized())return e.getImmediate();const t=M$(n,{popupRedirectResolver:jz,persistence:[UB,md,pd]}),r=_C("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Wz(i.toString());vB(t,o,()=>o(t.currentUser)),_B(t,a=>o(a))}}const s=pC("auth");return s&&j$(t,`http://${s}`),t}function Hz(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}I$({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=pr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Hz().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Bz("Browser");const PD="@firebase/installations",dS="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD=1e4,OD=`w:${dS}`,MD="FIS_v2",Qz="https://firebaseinstallations.googleapis.com/v1",Kz=60*60*1e3,Yz="installations",Jz="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xz={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Qa=new Xa(Yz,Jz,Xz);function LD(n){return n instanceof As&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jD({projectId:n}){return`${Qz}/projects/${n}/installations`}function VD(n){return{token:n.token,requestStatus:2,expiresIn:e9(n.expiresIn),creationTime:Date.now()}}async function FD(n,e){const r=(await e.json()).error;return Qa.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function UD({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Zz(n,{refreshToken:e}){const t=UD(n);return t.append("Authorization",t9(e)),t}async function $D(n){const e=await n();return e.status>=500&&e.status<600?n():e}function e9(n){return Number(n.replace("s","000"))}function t9(n){return`${MD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n9({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=jD(n),s=UD(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:MD,appId:n.appId,sdkVersion:OD},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await $D(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:VD(u.authToken)}}else throw await FD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r9(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s9=/^[cdef][\w-]{21}$/,Zv="";function i9(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=o9(n);return s9.test(t)?t:Zv}catch{return Zv}}function o9(n){return r9(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qg(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zD=new Map;function qD(n,e){const t=Qg(n);WD(t,e),a9(t,e)}function WD(n,e){const t=zD.get(n);if(t)for(const r of t)r(e)}function a9(n,e){const t=l9();t&&t.postMessage({key:n,fid:e}),c9()}let wa=null;function l9(){return!wa&&"BroadcastChannel"in self&&(wa=new BroadcastChannel("[Firebase] FID Change"),wa.onmessage=n=>{WD(n.data.key,n.data.fid)}),wa}function c9(){zD.size===0&&wa&&(wa.close(),wa=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u9="firebase-installations-database",d9=1,Ka="firebase-installations-store";let r_=null;function hS(){return r_||(r_=tw(u9,d9,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ka)}}})),r_}async function Tp(n,e){const t=Qg(n),s=(await hS()).transaction(Ka,"readwrite"),i=s.objectStore(Ka),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&qD(n,e.fid),e}async function GD(n){const e=Qg(n),r=(await hS()).transaction(Ka,"readwrite");await r.objectStore(Ka).delete(e),await r.done}async function Kg(n,e){const t=Qg(n),s=(await hS()).transaction(Ka,"readwrite"),i=s.objectStore(Ka),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&qD(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fS(n){let e;const t=await Kg(n.appConfig,r=>{const s=h9(r),i=f9(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Zv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function h9(n){const e=n||{fid:i9(),registrationStatus:0};return HD(e)}function f9(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Qa.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=m9(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:p9(n)}:{installationEntry:e}}async function m9(n,e){try{const t=await n9(n,e);return Tp(n.appConfig,t)}catch(t){throw LD(t)&&t.customData.serverCode===409?await GD(n.appConfig):await Tp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function p9(n){let e=await LT(n.appConfig);for(;e.registrationStatus===1;)await BD(100),e=await LT(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await fS(n);return r||t}return e}function LT(n){return Kg(n,e=>{if(!e)throw Qa.create("installation-not-found");return HD(e)})}function HD(n){return g9(n)?{fid:n.fid,registrationStatus:0}:n}function g9(n){return n.registrationStatus===1&&n.registrationTime+DD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y9({appConfig:n,heartbeatServiceProvider:e},t){const r=_9(n,t),s=Zz(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:OD,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await $D(()=>fetch(r,a));if(l.ok){const u=await l.json();return VD(u)}else throw await FD("Generate Auth Token",l)}function _9(n,{fid:e}){return`${jD(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mS(n,e=!1){let t;const r=await Kg(n.appConfig,i=>{if(!QD(i))throw Qa.create("not-registered");const o=i.authToken;if(!e&&x9(o))return i;if(o.requestStatus===1)return t=v9(n,e),i;{if(!navigator.onLine)throw Qa.create("app-offline");const a=I9(i);return t=w9(n,a),a}});return t?await t:r.authToken}async function v9(n,e){let t=await jT(n.appConfig);for(;t.authToken.requestStatus===1;)await BD(100),t=await jT(n.appConfig);const r=t.authToken;return r.requestStatus===0?mS(n,e):r}function jT(n){return Kg(n,e=>{if(!QD(e))throw Qa.create("not-registered");const t=e.authToken;return E9(t)?{...e,authToken:{requestStatus:0}}:e})}async function w9(n,e){try{const t=await y9(n,e),r={...e,authToken:t};return await Tp(n.appConfig,r),t}catch(t){if(LD(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await GD(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Tp(n.appConfig,r)}throw t}}function QD(n){return n!==void 0&&n.registrationStatus===2}function x9(n){return n.requestStatus===2&&!S9(n)}function S9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Kz}function I9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function E9(n){return n.requestStatus===1&&n.requestTime+DD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b9(n){const e=n,{installationEntry:t,registrationPromise:r}=await fS(e);return r?r.catch(console.error):mS(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T9(n,e=!1){const t=n;return await A9(t),(await mS(t,e)).token}async function A9(n){const{registrationPromise:e}=await fS(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C9(n){if(!n||!n.options)throw s_("App Configuration");if(!n.name)throw s_("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw s_(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function s_(n){return Qa.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KD="installations",R9="installations-internal",N9=n=>{const e=n.getProvider("app").getImmediate(),t=C9(e),r=si(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},k9=n=>{const e=n.getProvider("app").getImmediate(),t=si(e,KD).getImmediate();return{getId:()=>b9(t),getToken:s=>T9(t,s)}};function P9(){Ts(new Rr(KD,N9,"PUBLIC")),Ts(new Rr(R9,k9,"PRIVATE"))}P9();Ar(PD,dS);Ar(PD,dS,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap="analytics",D9="firebase_id",O9="origin",M9=60*1e3,L9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",pS="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr=new ph("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},qr=new Xa("analytics","Analytics",j9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V9(n){if(!n.startsWith(pS)){const e=qr.create("invalid-gtag-resource",{gtagURL:n});return Cr.warn(e.message),""}return n}function YD(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function F9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function U9(n,e){const t=F9("firebase-js-sdk-policy",{createScriptURL:V9}),r=document.createElement("script"),s=`${pS}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function $9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function B9(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await YD(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){Cr.error(a)}n("config",s,i)}async function z9(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await YD(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Cr.error(i)}}function q9(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await z9(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await B9(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Cr.error(a)}}return s}function W9(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=q9(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function G9(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(pS)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H9=30,Q9=1e3;class K9{constructor(e={},t=Q9){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const JD=new K9;function Y9(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function J9(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:Y9(t)},s=L9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw qr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function X9(n,e=JD,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw qr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw qr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new tq;return setTimeout(async()=>{a.abort()},t!==void 0?t:M9),XD({appId:r,apiKey:s,measurementId:i},o,a,e)}async function XD(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=JD){var a;const{appId:i,measurementId:o}=n;try{await Z9(r,e)}catch(l){if(o)return Cr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await J9(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!eq(u)){if(s.deleteThrottleMetadata(i),o)return Cr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?eE(t,s.intervalMillis,H9):eE(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),Cr.debug(`Calling attemptFetch again in ${h} millis`),XD(n,f,r,s)}}function Z9(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(qr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function eq(n){if(!(n instanceof As)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class tq{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function nq(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rq(){if(Gp())try{await Z0()}catch(n){return Cr.warn(qr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Cr.warn(qr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function sq(n,e,t,r,s,i,o){const a=X9(n);a.then(m=>{t[m.measurementId]=m.appId,n.options.measurementId&&m.measurementId!==n.options.measurementId&&Cr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>Cr.error(m)),e.push(a);const l=rq().then(m=>{if(m)return r.getId()}),[u,h]=await Promise.all([a,l]);G9(i)||U9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[O9]="firebase",f.update=!0,h!=null&&(f[D9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iq{constructor(e){this.app=e}_delete(){return delete yd[this.app.options.appId],Promise.resolve()}}let yd={},VT=[];const FT={};let i_="dataLayer",oq="gtag",UT,ZD,$T=!1;function aq(){const n=[];if(X0()&&n.push("This is a browser extension environment."),bC()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=qr.create("invalid-analytics-context",{errorInfo:e});Cr.warn(t.message)}}function lq(n,e,t){aq();const r=n.options.appId;if(!r)throw qr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Cr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw qr.create("no-api-key");if(yd[r]!=null)throw qr.create("already-exists",{id:r});if(!$T){$9(i_);const{wrappedGtag:i,gtagCore:o}=W9(yd,VT,FT,i_,oq);ZD=i,UT=o,$T=!0}return yd[r]=sq(n,VT,FT,e,UT,i_,t),new iq(n)}function cq(n=gh()){n=le(n);const e=si(n,Ap);return e.isInitialized()?e.getImmediate():uq(n)}function uq(n,e={}){const t=si(n,Ap);if(t.isInitialized()){const s=t.getImmediate();if(Gr(e,t.getOptions()))return s;throw qr.create("already-initialized")}return t.initialize({options:e})}async function dq(){if(X0()||!bC()||!Gp())return!1;try{return await Z0()}catch{return!1}}function hq(n,e,t,r){n=le(n),nq(ZD,yd[n.app.options.appId],e,t,r).catch(s=>Cr.error(s))}const BT="@firebase/analytics",zT="0.10.18";function fq(){Ts(new Rr(Ap,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return lq(r,s,t)},"PUBLIC")),Ts(new Rr("analytics-internal",n,"PRIVATE")),Ar(BT,zT),Ar(BT,zT,"esm2020");function n(e){try{const t=e.getProvider(Ap).getImmediate();return{logEvent:(r,s,i)=>hq(t,r,s,i)}}catch(t){throw qr.create("interop-component-reg-failed",{reason:t})}}}fq();const e2={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},Hh=Ej().length?gh():NC(e2),H=XF(Hh,e2.databaseURL),Us=IU(Hh),yi=Gz(Hh);console.log("✅ Firebase services initialized:",{db:!!H,firestore:!!Us,auth:!!yi});yD(yi,md).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let t2=null;(async()=>{try{await dq()&&(t2=cq(Hh))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();const UW=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return t2},app:Hh,auth:yi,db:H,firestore:Us},Symbol.toStringTag,{value:"Module"}));class Yg{constructor(e,t){this.db=e,this.userUID=t,this.userRef=ae(e,`users/${t}`),this.statsRef=ae(e,`users/${t}/stats`),this.profileRef=ae(e,`users/${t}/profile`),this.behaviorLogRef=ae(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(`🔄 StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await $e(this.statsRef);if(!s.exists())return console.error(`❌ StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(`🔄 StatManager: ${e} change: ${o} → ${a} (${t>0?"+":""}${t})`),console.log(`🔄 StatManager: About to write to Firebase - ${e}: ${a}`),console.log("🔄 StatManager: Writing to path:",this.statsRef.toString()),console.log("🔄 StatManager: Full stats object to write:",{...i,[e]:a});try{await Ye(this.statsRef,{...i,[e]:a}),console.log(`✅ StatManager: Successfully updated ${e} in Firebase`)}catch(l){throw console.error(`❌ StatManager: Firebase write failed for ${e}:`,l),l}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`❌ StatManager: CRITICAL ERROR updating ${e}:`,s),console.error("❌ StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await $e(ae(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await $e(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log("🔄 StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await $e(ae(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await $e(ae(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log("🔄 StatManager: Last relapse exists:",t.exists()),console.log("🔄 StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),l=r.exists()?r.val():1;console.log(`🔄 StatManager: Current escalation level from Firebase: ${l}`),console.log(`🔄 StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(`🔄 StatManager: After 7+ days clean → escalation level reset to: ${s}`)):(s=l+1,console.log(`🔄 StatManager: Within ${a} days → escalation level: ${l} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(`🔄 StatManager: Escalation level ${s} → addiction increase: +${i}`),console.log("🔄 StatManager: Updating all stats in single write operation...");try{const o=await $e(this.statsRef);if(!o.exists())return console.error("❌ StatManager: No stats found for user"),!1;const a=o.val();console.log("🔄 StatManager: Current stats before relapse:",a);const l=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(`🔄 StatManager: addictionLevel change: ${a.addictionLevel} → ${l} (+${i})`),console.log(`🔄 StatManager: mentalStrength change: ${a.mentalStrength} → ${u} (-3)`),console.log(`🔄 StatManager: triggerDefense change: ${a.triggerDefense} → ${h} (-3)`);const f={...a,addictionLevel:l,mentalStrength:u,triggerDefense:h};console.log("🔄 StatManager: Writing complete updated stats:",f),await Ye(this.statsRef,f),console.log("✅ StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error("❌ StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([Ye(ae(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),Ye(ae(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),Ye(ae(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await Ye(ae(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await $e(ae(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await $e(ae(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await $e(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,l=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:l,cleanWeeks:u,isCleanFor7Days:l>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await $e(ae(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await $e(ae(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await $e(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await $e(ae(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),Ye(ae(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Ye(ae(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=await $e(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<1)return;const o=await $e(ae(this.db,`users/${this.userUID}/profile/lastActivity`));if(o.exists()){const u=new Date(o.val()),h=Math.floor((r-u)/(1e3*60*60*24));if(h>=7&&i>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${h} days since last activity`);return}}let a=null,l=null;for(let u=0;u<10;u++){const h=new Date;h.setDate(h.getDate()-u);const f=h.toDateString(),m=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${f}/logged`));if(m.exists()&&m.val()){a=u,l=h;break}}if(a===null||a>=7)if(l){const u=Math.floor((r-l)/864e5);u>=7&&i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${u} days since last activity`))}else i>=7&&(await this.updateStat("motivation",1,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${i} days since registration with no activity`))}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await HR(ae(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await $e(ae(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await $e(ae(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await $e(ae(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Ye(ae(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Ye(ae(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await $e(ae(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,l=t.canAwardTriggerDefense?3:0;await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+l)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,l=t.canAwardTriggerDefense?.25:0;await Ye(ae(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+l)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await $e(ae(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const mq=Object.freeze(Object.defineProperty({__proto__:null,default:Yg},Symbol.toStringTag,{value:"Module"}));class sc{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=Zr(e,"matchingPool"),this.buddyPairsCollection=Zr(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:hm(),lastActive:hm(),status:"waiting"};return await MU(um(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await LU(um(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:hm(),status:"active",...r},i=await ai(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await dd(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=um(this.matchingPoolCollection,e),r=await OU(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async getUserBuddyPair(e){try{console.log("🔄 Firestore: Getting buddy pair for user:",e);const t=$l(this.buddyPairsCollection,Bl("user1Id","==",e)),r=$l(this.buddyPairsCollection,Bl("user2Id","==",e)),[s,i]=await Promise.all([dd(t),dd(r)]);let o=null;if(s.empty?i.empty||(o=i.docs[0]):o=s.docs[0],o){const a=o.data();return console.log("✅ Firestore: Found buddy pair:",o.id),{id:o.id,...a}}else return console.log("ℹ️ Firestore: No buddy pair found for user"),null}catch(t){return console.error("❌ Firestore: Error getting buddy pair:",t),null}}async testConnectivity(){try{return console.log("🧪 Firestore: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ Firestore: Service available and initialized"),!0):(console.warn("⚠️ Firestore: Service not properly initialized"),!1)}catch(e){return console.warn("⚠️ Firestore: Connectivity check failed (non-critical):",(e==null?void 0:e.message)||e),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}class n2{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log("🚀 FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:Xe.now(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await ai(Zr(this.firestore,this.collections.cravings),r);return console.log("✅ Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:Xe.now(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await ai(Zr(this.firestore,this.collections.relapses),r);return console.log("✅ Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:Xe.now(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await ai(Zr(this.firestore,this.collections.hydration),r);return console.log("✅ Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:Xe.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await ai(Zr(this.firestore,this.collections.breathing),r);return console.log("✅ Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:Xe.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await ai(Zr(this.firestore,this.collections.meditation),r);return console.log("✅ Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:Xe.now(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await ai(Zr(this.firestore,this.collections.physicalActivity),r);return console.log("✅ Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:Xe.now(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await ai(Zr(this.firestore,this.collections.moodTracking),r);return console.log("✅ Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=$l(Zr(this.firestore,this.collections[t]),Bl("userId","==",e),kU("timestamp","desc"));r&&(i=$l(i,Bl("timestamp",">=",Xe.fromDate(new Date(r))))),s&&(i=$l(i,Bl("timestamp","<=",Xe.fromDate(new Date(s)))));const o=await dd(i),a=[];return o.forEach(l=>{var u;a.push({id:l.id,...l.data(),timestamp:((u=l.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(`✅ Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(`❌ Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(`📊 Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,l,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(y=>(console.warn("⚠️ Cravings data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(y=>(console.warn("⚠️ Relapses data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(y=>(console.warn("⚠️ Hydration data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(y=>(console.warn("⚠️ Breathing data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(y=>(console.warn("⚠️ Meditation data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(y=>(console.warn("⚠️ Physical activity data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(y=>(console.warn("⚠️ Mood data not available yet (indexes building):",y.message),[]))]),m={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(y=>y.outcome==="resisted").length,relapsed:i.filter(y=>y.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((y,_)=>y+(_.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((y,_)=>y+(_.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(y=>y.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(y=>y.achievedTarget).length,breathingExercises:l.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:l.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((y,_)=>y+(_.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,l,u,h,f),generatedAt:new Date};return console.log("📊 Behavioral analytics generated:",m),m}catch(r){throw console.error("❌ Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const l=[],u=e.filter(y=>y.outcome==="resisted").length,h=e.length;if(h>0){const y=u/h*100;l.push(`Craving resistance rate: ${y.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&l.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const m=r.filter(y=>y.achievedTarget).length;return m>0&&l.push(`Achieved hydration target on ${m} days`),l}async migrateUserData(e,t){try{console.log(`🔄 Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await De(()=>import("./index.esm-980f89f8.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let l=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?Xe.fromDate(new Date(h.timestamp)):hm(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await ai(Zr(this.firestore,this.collections.cravings),f),l++}catch(f){console.error(`❌ Error migrating craving ${u}:`,f)}console.log(`✅ Migrated ${l} cravings to Firestore`)}return console.log(`✅ Data migration completed for user ${e}`),!0}catch(r){throw console.error("❌ Error during data migration:",r),r}}async testConnectivity(){try{return console.log("🧪 FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn("⚠️ FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn("⚠️ FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(`📊 Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=$l(Zr(this.db,s),Bl("userId","==",e)),o=await dd(i);r[s]=o.size}catch(i){console.warn(`⚠️ Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error("❌ Error generating basic analytics:",t),t}}}const $W=Object.freeze(Object.defineProperty({__proto__:null,default:n2},Symbol.toStringTag,{value:"Module"}));class qT{constructor(e,t,r=null){this.db=e,this.userId=t,this.authGuard=r,this.statsRef=ae(e,`users/${t}/stats`),this.profileRef=ae(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{let e,t,r;if(this.authGuard)[e,t,r]=await Promise.all([this.authGuard.databaseGet(`users/${this.userId}/profile`),this.authGuard.databaseGet(`users/${this.userId}/stats`),this.authGuard.databaseGet(`users/${this.userId}`)]);else{const[k,I,x]=await Promise.all([$e(this.profileRef),$e(this.statsRef),$e(ae(this.db,`users/${this.userId}`))]);e=k.exists()?k.val():{},t=I.exists()?I.val():{},r=x.exists()?x.val():{}}const s={...e,createdAt:e.createdAt||r.createdAt||null,quitDate:e.quitDate||r.quitDate||r.quitStartDate||null,lastQuitDate:e.lastQuitDate||r.lastQuitDate||null};if(!s.lastRelapseDate&&!s.quitDate&&s.createdAt)try{await Ye(ae(this.db,`users/${this.userId}/profile/quitDate`),s.createdAt),s.quitDate=s.createdAt,console.log(`📊 CentralizedStats: Seeded missing quitDate with createdAt for ${this.userId}: ${s.createdAt}`)}catch(k){console.warn(`⚠️ CentralizedStats: Could not seed quitDate for ${this.userId}:`,k.message)}const i=t||this.getDefaultStats(),o=this.calculateEffectiveQuitDate(s),a=this.calculateStreakFromRelapse(s),l=await this.calculateCravingsResisted(),u=await this.calculateAddictionLevel(s,o),h=this.calculateMentalStrength(i,l),f=h.strength,m=h.cravingsApplied,y=await this.checkMilestonesFromRelapse(s,i),_=await this.generateSpecialFeatures(s),E={...i,...y,streakDays:a.value,streakUnit:a.unit,streakDisplayText:a.displayText,cravingsResisted:l,addictionLevel:u,mentalStrength:f,mentalStrengthCravingsApplied:m,specialFeatures:_,lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,E):await Ye(this.statsRef,E),console.log(`✅ CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:a.displayText,cravingsResisted:l,addictionLevel:u,mentalStrength:f,specialFeatures:(_==null?void 0:_.length)||0,effectiveQuitDate:o}),E}catch(e){throw console.error(`❌ CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||null;if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(`📊 CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(`📊 CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const l=e.lastQuitDate||e.originalQuitDate||e.quitDate||e.createdAt||null;return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${l}`),l?this.calculateStreak(l):{value:0,unit:"hours",displayText:"0 hours",streakDays:0}}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([$e(ae(this.db,`users/${this.userId}/profile/cravingsResisted`)),$e(ae(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(`📊 CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length}return r}catch(e){return console.warn(`⚠️ CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}calculateMentalStrength(e,t){try{const r=e.mentalStrength||50,s=e.mentalStrengthCravingsApplied||0;return{strength:r,cravingsApplied:s}}catch(r){return console.warn(`⚠️ CentralizedStats: Could not calculate mental strength for ${this.userId}:`,r.message),{strength:e.mentalStrength||50,cravingsApplied:e.mentalStrengthCravingsApplied||0}}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([$e(this.statsRef),$e(ae(this.db,`users/${this.userId}/profile/lastRelapseDate`)),$e(ae(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(`📊 CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(`📊 CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(`📊 CentralizedStats: Days since last relapse: ${u}`),console.log(`📊 CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await Ye(ae(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const m=Math.floor(u/7),y=m*2;let _=Math.max(30,o-y);return console.log(`📊 CentralizedStats: Base addiction: ${o}, Weeks clean: ${m}, Decay: -${y}, Final: ${_}`),_}catch(r){return console.error("❌ CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},l=!1;for(const u of o)if(i>=u.days){const h=ae(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await $e(h)).exists()){const m=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=m,l=!0,await Ye(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let l={},u=!1;for(const h of a)if(o>=h.days){const f=ae(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await $e(f)).exists()){const y=Math.min(100,(t.mentalStrength||50)+h.bonus);l.mentalStrength=y,u=!0,await Ye(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return l}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await $e(ae(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(`📊 CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await $e(ae(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(`📊 CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(`⚠️ CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(`📊 CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(`📊 CentralizedStats: Generated ${o.length} personalized features:`,o);const l=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=l[Math.floor(Math.random()*l.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await Ye(ae(this.db,`users/${this.userId}/specialFeatures`),u),console.log(`📊 CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(`❌ CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=Vw(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(`🔄 CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:"🎉 First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

🧠 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! 💪`},30:{title:"🏆 One Month Champion!",message:`Amazing! You've reached 30 days clean!

🧠 Mental Strength: +${e.bonus} points

You're proving your strength every day! 🌟`},90:{title:"👑 Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

🧠 Mental Strength: +${e.bonus} points

You're a true inspiration! 🎯✨`}}[e.days]||{title:"🎉 Milestone Achieved!",message:`You've reached ${t} days clean!

🧠 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(`🎉 Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(`🔄 CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=ae(this.db,`users/${this.userId}/profile/milestones`);await Ye(e,null),console.log(`✅ CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(`❌ CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(`🔄 CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([$e(ae(this.db,`users/${this.userId}/profile/lastRelapseDate`)),$e(ae(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),$e(this.statsRef)]);let o=1;if(r.exists()){const m=new Date(r.val()),y=Math.floor((e-m)/(1e3*60*60*24)),_=s.exists()?s.val():1;console.log(`🔄 CentralizedStats: Current escalation level: ${_}`),console.log(`🔄 CentralizedStats: Days since last relapse: ${y}`),y>=7?(o=1,console.log(`🔄 CentralizedStats: After 7+ days clean → escalation level reset to: ${o}`)):(o=_+1,console.log(`🔄 CentralizedStats: Within ${y} days → escalation level: ${_} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(`🔄 CentralizedStats: Escalation level ${o} → addiction increase: +${a}`);const l=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(l.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(l.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(l.triggerDefense||30)-3));console.log(`🔄 CentralizedStats: addictionLevel change: ${l.addictionLevel} → ${u} (+${a})`),console.log(`🔄 CentralizedStats: mentalStrength change: ${l.mentalStrength} → ${h} (-3)`),console.log(`🔄 CentralizedStats: triggerDefense change: ${l.triggerDefense} → ${f} (-3)`),await Promise.all([Ye(ae(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),Ye(ae(this.db,`users/${this.userId}/profile/relapseDate`),t),Ye(ae(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),Ye(ae(this.db,`users/${this.userId}/lastQuitDate`),t),Ye(ae(this.db,`users/${this.userId}/profile/lastQuitDate`),t),this.resetMilestones(),Ye(this.statsRef,{...l,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(`✅ CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(`❌ CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async getCurrentStats(){try{const e=await $e(this.statsRef);return e.exists()?e.val():this.getDefaultStats()}catch(e){return console.error(`❌ CentralizedStats: Error getting current stats for ${this.userId}:`,e),this.getDefaultStats()}}async handleCravingResisted(){try{console.log(`🔄 CentralizedStats: Handling craving resisted for ${this.userId}`),await this.checkAndResetDailyCounter();const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsApplied||0;if(console.log(`🔄 CentralizedStats: Current mental strength cravings applied: ${t}`),t<3){const r=Math.min(100,(e.mentalStrength||50)+1),s=t+1,i={...e,mentalStrength:r,mentalStrengthCravingsApplied:s,mentalStrengthCravingsAppliedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,i):await Ye(this.statsRef,i),console.log(`✅ CentralizedStats: Applied +1 mental strength (${e.mentalStrength} → ${r}), cravings applied: ${s}/3`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!0,cravingsApplied:s,limitReached:s>=3}}else return console.log(`📊 CentralizedStats: Daily mental strength limit reached (${t}/3), no bonus applied`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!1,cravingsApplied:t,limitReached:!0}}catch(e){throw console.error(`❌ CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}async checkAndResetDailyCounter(){try{const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsAppliedDate,r=new Date,s=r.toDateString();if(!t){const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Ye(this.statsRef,o),console.log(`✅ CentralizedStats: Initialized daily counter for ${this.userId} (reset to 0)`);return}if(new Date(t).toDateString()!==s){console.log(`🔄 CentralizedStats: New day detected, resetting daily mental strength counter for ${this.userId}`);const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Ye(this.statsRef,o),console.log(`✅ CentralizedStats: Daily mental strength counter reset for ${this.userId}`)}}catch(e){console.warn(`⚠️ CentralizedStats: Could not check/reset daily counter for ${this.userId}:`,e.message)}}}const gS=(n,e={})=>{const{threshold:t=100,velocity:r=.5,enabled:s=!0}=e,[i,o]=D.useState(!1),[a,l]=D.useState(null),[u,h]=D.useState(0),f=D.useRef(null),m=D.useRef(0),y=D.useRef(0),_=D.useRef(0),E=D.useRef(0),k=D.useRef(0);return D.useEffect(()=>{if(!s||!f.current)return;const I=f.current;let x=!1;const R=N=>{if(!s)return;const w=N.touches[0];m.current=w.clientY,y.current=w.clientX,_.current=Date.now(),E.current=w.clientY,k.current=Date.now(),x=!0,o(!0),I.classList.add("swiping")},P=N=>{if(!x||!s)return;N.preventDefault();const w=N.touches[0],T=w.clientY-m.current,A=w.clientX-y.current;Math.abs(A)>Math.abs(T)||(h(T),T>0?(l("down"),I.style.transform=`translateY(${Math.min(T,t*1.5)}px)`,I.style.opacity=Math.max(.3,1-T/(t*2))):T<0&&(l("up"),I.style.transform=`translateY(${Math.max(T,-t*1.5)}px)`,I.style.opacity=Math.max(.3,1-Math.abs(T)/(t*2))),E.current=w.clientY,k.current=Date.now())},$=N=>{if(!x||!s)return;x=!1,o(!1);const T=N.changedTouches[0].clientY-m.current,A=Date.now()-_.current,b=Math.abs(T)/A;I.style.transform="",I.style.opacity="",I.classList.remove("swiping"),(Math.abs(T)>t||b>r)&&(T>0&&a==="down"?M("down"):T<0&&a==="up"&&M("up")),l(null),h(0)},M=N=>{I.classList.add(`swipe-${N}`),setTimeout(()=>{typeof n=="function"&&n()},200)};return I.addEventListener("touchstart",R,{passive:!1}),I.addEventListener("touchmove",P,{passive:!1}),I.addEventListener("touchend",$,{passive:!0}),()=>{I.removeEventListener("touchstart",R),I.removeEventListener("touchmove",P),I.removeEventListener("touchend",$)}},[s,t,r,a]),{modalRef:f,isSwipping:i,swipeDirection:a,swipeDistance:u,classes:`modal-swipe-dismiss ${i?"swiping":""} ${a?`swipe-${a}`:""}`}};var pq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const gq=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),yq=(n,e)=>{const t=D.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>D.createElement("svg",{ref:u,...pq,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${gq(n)}`,...l},[...e.map(([h,f])=>D.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var Ut=yq;const WT=Ut("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),GT=Ut("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),_q=Ut("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),e0=Ut("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),r2=Ut("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),HT=Ut("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),vq=Ut("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),QT=Ut("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),s2=Ut("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),i2=Ut("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),wq=Ut("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Of=Ut("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),zl=Ut("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),o2=Ut("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ao=Ut("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),xq=Ut("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Mf=Ut("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),a2=Ut("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Sq=Ut("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),Iq=Ut("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Eq=Ut("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),l2=Ut("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),c2=Ut("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),u2=Ut("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),o_=Ut("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),bq=Ut("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Tq=({isOpen:n,onClose:e})=>{var k,I,x,R,P,$,M,N,w,T,A,b,C,v,B,ge,ke,_t,Y,we;const[t,r]=D.useState(null),[s,i]=D.useState([]),[o,a]=D.useState(!1),[l,u]=D.useState("overview"),[h,f]=D.useState(!0);D.useEffect(()=>{if(!n)return;const re=()=>{if(window.performanceIntegrationService){const Ee=window.performanceIntegrationService.getMetricsSummary(),Oe=window.performanceIntegrationService.getRecentAlerts(20);r(Ee),i(Oe)}};if(re(),h){const Ee=setInterval(re,5e3);return()=>clearInterval(Ee)}},[n,h]);const m=async re=>{if(window.stressTestService){a(!0);try{let Ee;switch(re){case"database":Ee=await window.stressTestService.databaseLoadTest({concurrentUsers:5,operationsPerUser:3});break;case"auth":Ee=await window.stressTestService.authLoadTest({concurrentAttempts:10});break;case"offline":Ee=await window.stressTestService.offlineOnlineTest({transitionCount:3});break;case"memory":Ee=await window.stressTestService.memoryUsageTest({iterations:50});break;default:throw new Error("Unknown test type")}console.log("✅ Stress test completed:",Ee)}catch(Ee){console.error("❌ Stress test failed:",Ee)}finally{a(!1)}}},y=()=>{window.performanceIntegrationService&&(window.performanceIntegrationService.clearAllMetrics(),r(null),i([]))},_=re=>re.includes("slow")?c.jsx(vq,{className:"w-4 h-4 text-yellow-500"}):re.includes("failure")||re.includes("error")?c.jsx(GT,{className:"w-4 h-4 text-red-500"}):c.jsx(HT,{className:"w-4 h-4 text-green-500"}),E=re=>re.includes("slow")?"bg-yellow-50 border-yellow-200":re.includes("failure")||re.includes("error")?"bg-red-50 border-red-200":"bg-green-50 border-green-200";return n?c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:c.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(WT,{className:"w-6 h-6 text-blue-600"}),c.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Performance Dashboard"})]}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("button",{onClick:()=>f(!h),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${h?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[c.jsx(zl,{className:`w-4 h-4 ${h?"animate-spin":""}`}),c.jsx("span",{children:"Auto Refresh"})]}),c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx(bq,{className:"w-6 h-6"})})]})]}),c.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview",icon:e0},{id:"database",label:"Database",icon:QT},{id:"auth",label:"Authentication",icon:Ao},{id:"offline",label:"Offline Queue",icon:o_},{id:"alerts",label:"Alerts",icon:GT}].map(re=>{const Ee=re.icon;return c.jsxs("button",{onClick:()=>u(re.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${l===re.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[c.jsx(Ee,{className:"w-4 h-4"}),c.jsx("span",{children:re.label})]},re.id)})}),c.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[l==="overview"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Database Queries"}),c.jsx("p",{className:"text-2xl font-bold text-blue-900",children:((k=t==null?void 0:t.database)==null?void 0:k.totalQueries)||0})]}),c.jsx(QT,{className:"w-8 h-8 text-blue-500"})]}),c.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Avg: ",((I=t==null?void 0:t.database)==null?void 0:I.averageQueryTime)||0,"ms"]})]}),c.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-green-600",children:"Auth Success Rate"}),c.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[((x=t==null?void 0:t.authentication)==null?void 0:x.successRate)||0,"%"]})]}),c.jsx(Ao,{className:"w-8 h-8 text-green-500"})]}),c.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[((R=t==null?void 0:t.authentication)==null?void 0:R.totalAttempts)||0," attempts"]})]}),c.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Offline Operations"}),c.jsx("p",{className:"text-2xl font-bold text-purple-900",children:((P=t==null?void 0:t.offlineQueue)==null?void 0:P.totalOperations)||0})]}),c.jsx(o_,{className:"w-8 h-8 text-purple-500"})]}),c.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["Success: ",(($=t==null?void 0:t.offlineQueue)==null?void 0:$.successRate)||0,"%"]})]}),c.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Page Loads"}),c.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((M=t==null?void 0:t.general)==null?void 0:M.totalPageLoads)||0})]}),c.jsx(WT,{className:"w-8 h-8 text-orange-500"})]}),c.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Avg: ",((N=t==null?void 0:t.general)==null?void 0:N.averagePageLoadTime)||0,"ms"]})]})]}),c.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Stress Testing"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("button",{onClick:()=>m("database"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?c.jsx(Mf,{className:"w-4 h-4"}):c.jsx(Of,{className:"w-4 h-4"}),c.jsx("span",{children:"Database Load"})]}),c.jsxs("button",{onClick:()=>m("auth"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?c.jsx(Mf,{className:"w-4 h-4"}):c.jsx(Of,{className:"w-4 h-4"}),c.jsx("span",{children:"Auth Load"})]}),c.jsxs("button",{onClick:()=>m("offline"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?c.jsx(Mf,{className:"w-4 h-4"}):c.jsx(Of,{className:"w-4 h-4"}),c.jsx("span",{children:"Offline/Online"})]}),c.jsxs("button",{onClick:()=>m("memory"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?c.jsx(Mf,{className:"w-4 h-4"}):c.jsx(Of,{className:"w-4 h-4"}),c.jsx("span",{children:"Memory Usage"})]})]}),o&&c.jsx("div",{className:"mt-4 text-center",children:c.jsxs("div",{className:"inline-flex items-center space-x-2 text-blue-600",children:[c.jsx(zl,{className:"w-4 h-4 animate-spin"}),c.jsx("span",{children:"Running stress test..."})]})})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Clear All Metrics"}),c.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),l==="database"&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Database Performance"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Query Statistics"}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Total Queries:"}),c.jsx("span",{className:"font-medium",children:((w=t==null?void 0:t.database)==null?void 0:w.totalQueries)||0})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),c.jsxs("span",{className:"font-medium",children:[((T=t==null?void 0:t.database)==null?void 0:T.averageQueryTime)||0,"ms"]})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Slow Queries:"}),c.jsx("span",{className:"font-medium text-yellow-600",children:((A=t==null?void 0:t.database)==null?void 0:A.slowQueries)||0})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Slow Query Rate:"}),c.jsxs("span",{className:"font-medium",children:[((b=t==null?void 0:t.database)==null?void 0:b.slowQueryRate)||0,"%"]})]})]})]}),c.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Trends"}),c.jsxs("div",{className:"text-center text-gray-500 py-8",children:[c.jsx(e0,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),c.jsx("p",{children:"Performance trends will be displayed here"})]})]})]})]}),l==="auth"&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Authentication Performance"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Auth Statistics"}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Total Attempts:"}),c.jsx("span",{className:"font-medium",children:((C=t==null?void 0:t.authentication)==null?void 0:C.totalAttempts)||0})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),c.jsxs("span",{className:"font-medium text-green-600",children:[((v=t==null?void 0:t.authentication)==null?void 0:v.successRate)||0,"%"]})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Failed Attempts:"}),c.jsx("span",{className:"font-medium text-red-600",children:((B=t==null?void 0:t.authentication)==null?void 0:B.failedAttempts)||0})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),c.jsxs("span",{className:"font-medium",children:[((ge=t==null?void 0:t.authentication)==null?void 0:ge.averageLoginTime)||0,"ms"]})]})]})]}),c.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Attempts"}),c.jsxs("div",{className:"text-center text-gray-500 py-8",children:[c.jsx(Ao,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),c.jsx("p",{children:"Recent authentication attempts will be displayed here"})]})]})]})]}),l==="offline"&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Offline Queue Performance"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Statistics"}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Total Operations:"}),c.jsx("span",{className:"font-medium",children:((ke=t==null?void 0:t.offlineQueue)==null?void 0:ke.totalOperations)||0})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),c.jsxs("span",{className:"font-medium text-green-600",children:[((_t=t==null?void 0:t.offlineQueue)==null?void 0:_t.successRate)||0,"%"]})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Failed Operations:"}),c.jsx("span",{className:"font-medium text-red-600",children:((Y=t==null?void 0:t.offlineQueue)==null?void 0:Y.failedOperations)||0})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),c.jsxs("span",{className:"font-medium",children:[((we=t==null?void 0:t.offlineQueue)==null?void 0:we.averageProcessTime)||0,"ms"]})]})]})]}),c.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Status"}),c.jsxs("div",{className:"text-center text-gray-500 py-8",children:[c.jsx(o_,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),c.jsx("p",{children:"Offline queue status will be displayed here"})]})]})]})]}),l==="alerts"&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Alerts"}),c.jsx("div",{className:"space-y-3",children:s.length===0?c.jsxs("div",{className:"text-center text-gray-500 py-8",children:[c.jsx(HT,{className:"w-12 h-12 mx-auto mb-2 text-green-400"}),c.jsx("p",{children:"No alerts at this time"})]}):s.map((re,Ee)=>c.jsx("div",{className:`p-4 rounded-lg border ${E(re.type)}`,children:c.jsxs("div",{className:"flex items-start space-x-3",children:[_(re.type),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("h4",{className:"font-medium text-gray-900 capitalize",children:re.type.replace(/_/g," ")}),c.jsx("span",{className:"text-xs text-gray-500",children:new Date(re.timestamp).toLocaleTimeString()})]}),c.jsx("p",{className:"text-sm text-gray-600 mt-1",children:JSON.stringify(re.data,null,2)})]})]})},Ee))})]})]})]})}):null};class Aq{constructor(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[],this.thresholds={slowQuery:1e3,slowLogin:3e3,slowOperation:2e3,slowPageLoad:5e3},this.isEnabled=!0,this.maxMetricsHistory=1e3}startTimer(e){return{operationId:e,startTime:performance.now(),timestamp:new Date().toISOString()}}endTimer(e,t,r,s={}){if(!this.isEnabled)return;const o=performance.now()-e.startTime,a={operationId:e.operationId,operation:r,duration:o,timestamp:e.timestamp,endTime:new Date().toISOString(),metadata:s};if(this.metrics[t]){this.metrics[t].operations=this.metrics[t].operations||[],this.metrics[t].operations.push(a),this.metrics[t].totalOperations=(this.metrics[t].totalOperations||0)+1;const l=this.metrics[t].operations.reduce((h,f)=>h+f.duration,0);this.metrics[t].averageProcessTime=l/this.metrics[t].operations.length;const u=this.thresholds[`slow${t.charAt(0).toUpperCase()+t.slice(1)}`]||this.thresholds.slowOperation;o>u&&(this.metrics[t].slowOperations=(this.metrics[t].slowOperations||0)+1,this.createAlert("slow_operation",{category:t,operation:r,duration:o,threshold:u})),this.metrics[t].operations.length>this.maxMetricsHistory&&(this.metrics[t].operations=this.metrics[t].operations.slice(-this.maxMetricsHistory))}return a}recordDatabaseQuery(e,t,r={}){if(!this.isEnabled)return;const s={operation:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.database.queries.push(s),this.metrics.database.totalQueries++;const i=this.metrics.database.queries.reduce((o,a)=>o+a.duration,0);this.metrics.database.averageQueryTime=i/this.metrics.database.queries.length,t>this.thresholds.slowQuery&&(this.metrics.database.slowQueries++,this.createAlert("slow_query",{operation:e,duration:t,threshold:this.thresholds.slowQuery})),this.metrics.database.queries.length>this.maxMetricsHistory&&(this.metrics.database.queries=this.metrics.database.queries.slice(-this.maxMetricsHistory))}recordAuthAttempt(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.authentication.loginAttempts.push(i),this.metrics.authentication.totalAttempts++,r||(this.metrics.authentication.failedAttempts++,this.createAlert("auth_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.authentication.loginAttempts.reduce((a,l)=>a+l.duration,0);this.metrics.authentication.averageLoginTime=o/this.metrics.authentication.loginAttempts.length,t>this.thresholds.slowLogin&&this.createAlert("slow_login",{operation:e,duration:t,threshold:this.thresholds.slowLogin}),this.metrics.authentication.loginAttempts.length>this.maxMetricsHistory&&(this.metrics.authentication.loginAttempts=this.metrics.authentication.loginAttempts.slice(-this.maxMetricsHistory))}recordOfflineOperation(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.offlineQueue.operations.push(i),this.metrics.offlineQueue.totalOperations++,r||(this.metrics.offlineQueue.failedOperations++,this.createAlert("offline_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.offlineQueue.operations.reduce((a,l)=>a+l.duration,0);this.metrics.offlineQueue.averageProcessTime=o/this.metrics.offlineQueue.operations.length,t>this.thresholds.slowOperation&&this.createAlert("slow_offline_operation",{operation:e,duration:t,threshold:this.thresholds.slowOperation}),this.metrics.offlineQueue.operations.length>this.maxMetricsHistory&&(this.metrics.offlineQueue.operations=this.metrics.offlineQueue.operations.slice(-this.maxMetricsHistory))}recordPageLoad(e,t,r={}){if(!this.isEnabled)return;const s={page:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.general.pageLoads.push(s),this.metrics.general.totalPageLoads++;const i=this.metrics.general.pageLoads.reduce((o,a)=>o+a.duration,0);this.metrics.general.averagePageLoadTime=i/this.metrics.general.pageLoads.length,t>this.thresholds.slowPageLoad&&this.createAlert("slow_page_load",{page:e,duration:t,threshold:this.thresholds.slowPageLoad}),this.metrics.general.pageLoads.length>this.maxMetricsHistory&&(this.metrics.general.pageLoads=this.metrics.general.pageLoads.slice(-this.maxMetricsHistory))}createAlert(e,t){const r={id:Date.now()+Math.random(),type:e,data:t,timestamp:new Date().toISOString(),severity:this.getAlertSeverity(e)};return this.alerts.push(r),this.alerts.length>100&&(this.alerts=this.alerts.slice(-100)),r}getAlertSeverity(e){return{slow_query:"warning",slow_login:"warning",slow_operation:"warning",slow_offline_operation:"warning",slow_page_load:"warning",auth_failure:"error",offline_failure:"error"}[e]||"info"}getMetricsSummary(){return{database:{totalQueries:this.metrics.database.totalQueries,averageQueryTime:Math.round(this.metrics.database.averageQueryTime),slowQueries:this.metrics.database.slowQueries,slowQueryRate:this.metrics.database.totalQueries>0?(this.metrics.database.slowQueries/this.metrics.database.totalQueries*100).toFixed(2):0},authentication:{totalAttempts:this.metrics.authentication.totalAttempts,averageLoginTime:Math.round(this.metrics.authentication.averageLoginTime),failedAttempts:this.metrics.authentication.failedAttempts,successRate:this.metrics.authentication.totalAttempts>0?((this.metrics.authentication.totalAttempts-this.metrics.authentication.failedAttempts)/this.metrics.authentication.totalAttempts*100).toFixed(2):0},offlineQueue:{totalOperations:this.metrics.offlineQueue.totalOperations,averageProcessTime:Math.round(this.metrics.offlineQueue.averageProcessTime),failedOperations:this.metrics.offlineQueue.failedOperations,successRate:this.metrics.offlineQueue.totalOperations>0?((this.metrics.offlineQueue.totalOperations-this.metrics.offlineQueue.failedOperations)/this.metrics.offlineQueue.totalOperations*100).toFixed(2):0},general:{totalPageLoads:this.metrics.general.totalPageLoads,averagePageLoadTime:Math.round(this.metrics.general.averagePageLoadTime)},alerts:{total:this.alerts.length,recent:this.alerts.slice(-10),byType:this.getAlertsByType()}}}getAlertsByType(){const e={};return this.alerts.forEach(t=>{e[t.type]=(e[t.type]||0)+1}),e}clearMetrics(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[]}setEnabled(e){this.isEnabled=e}updateThresholds(e){this.thresholds={...this.thresholds,...e}}exportMetrics(){return{metrics:this.metrics,alerts:this.alerts,thresholds:this.thresholds,exportedAt:new Date().toISOString()}}}const xe=new Aq;class Cq{constructor(){this.originalMethods={ref:ae,get:$e,set:Ye,push:HR,update:OF,remove:DF,onValue:Vw,off:MF,query:WF}}ref(e,t){const r=xe.startTimer(`ref_${t}`),s=this.originalMethods.ref(e,t);return xe.endTimer(r,"database","ref",{path:t}),s}async get(e){const t=xe.startTimer(`get_${e.key||"unknown"}`);try{const r=await this.originalMethods.get(e);return xe.endTimer(t,"database","get",{path:e.key||"unknown",success:!0,hasData:r.exists()}),r}catch(r){throw xe.endTimer(t,"database","get",{path:e.key||"unknown",success:!1,error:r.message}),r}}async set(e,t){const r=xe.startTimer(`set_${e.key||"unknown"}`);try{const s=await this.originalMethods.set(e,t);return xe.endTimer(r,"database","set",{path:e.key||"unknown",success:!0,dataSize:JSON.stringify(t).length}),s}catch(s){throw xe.endTimer(r,"database","set",{path:e.key||"unknown",success:!1,error:s.message}),s}}push(e){const t=xe.startTimer(`push_${e.key||"unknown"}`),r=this.originalMethods.push(e);return xe.endTimer(t,"database","push",{path:e.key||"unknown",newKey:r.key}),r}async update(e,t){const r=xe.startTimer(`update_${e.key||"unknown"}`);try{const s=await this.originalMethods.update(e,t);return xe.endTimer(r,"database","update",{path:e.key||"unknown",success:!0,updateCount:Object.keys(t).length}),s}catch(s){throw xe.endTimer(r,"database","update",{path:e.key||"unknown",success:!1,error:s.message}),s}}async remove(e){const t=xe.startTimer(`remove_${e.key||"unknown"}`);try{const r=await this.originalMethods.remove(e);return xe.endTimer(t,"database","remove",{path:e.key||"unknown",success:!0}),r}catch(r){throw xe.endTimer(t,"database","remove",{path:e.key||"unknown",success:!1,error:r.message}),r}}onValue(e,t,r,s){const i=xe.startTimer(`onValue_${e.key||"unknown"}`),o=a=>{xe.endTimer(i,"database","onValue",{path:e.key||"unknown",success:!0,hasData:a.exists()}),t(a)};return this.originalMethods.onValue(e,o,r,s)}off(e,t){const r=xe.startTimer(`off_${e.key||"unknown"}`),s=this.originalMethods.off(e,t);return xe.endTimer(r,"database","off",{path:e.key||"unknown"}),s}query(e,...t){const r=xe.startTimer(`query_${e.key||"unknown"}`),s=this.originalMethods.query(e,...t);return xe.endTimer(r,"database","query",{path:e.key||"unknown",constraintCount:t.length}),s}async trackOperation(e,t,r={}){const s=xe.startTimer(e);try{const i=await t();return xe.endTimer(s,"database",e,{...r,success:!0}),i}catch(i){throw xe.endTimer(s,"database",e,{...r,success:!1,error:i.message}),i}}getDatabaseMetrics(){return xe.getMetricsSummary().database}getSlowQueries(e=10){return xe.metrics.database.queries.filter(t=>t.duration>xe.thresholds.slowQuery).sort((t,r)=>r.duration-t.duration).slice(0,e)}getRecentQueries(e=20){return xe.metrics.database.queries.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}}const Lf=new Cq;class Rq{constructor(){this.originalMethods={signInWithEmailAndPassword:mD,createUserWithEmailAndPassword:fD,signOut:xB,onAuthStateChanged:wB,setPersistence:yD,browserLocalPersistence:md,browserSessionPersistence:pd}}async signInWithEmailAndPassword(e,t,r){const s=xe.startTimer(`signIn_${t}`);try{const i=await this.originalMethods.signInWithEmailAndPassword(e,t,r);return xe.recordAuthAttempt("signIn",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw xe.recordAuthAttempt("signIn",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async createUserWithEmailAndPassword(e,t,r){const s=xe.startTimer(`createUser_${t}`);try{const i=await this.originalMethods.createUserWithEmailAndPassword(e,t,r);return xe.recordAuthAttempt("createUser",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw xe.recordAuthAttempt("createUser",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async signOut(e){const t=xe.startTimer("signOut");try{const r=await this.originalMethods.signOut(e);return xe.recordAuthAttempt("signOut",t.duration,!0,{method:"signOut"}),r}catch(r){throw xe.recordAuthAttempt("signOut",t.duration,!1,{error:r.code,method:"signOut"}),r}}onAuthStateChanged(e,t,r,s){const i=xe.startTimer("onAuthStateChanged"),o=u=>{const h=performance.now()-i.startTime;xe.recordAuthAttempt("authStateChange",h,!0,{hasUser:!!u,uid:u==null?void 0:u.uid,method:"onAuthStateChanged"}),typeof t=="function"?t(u):t&&t.next&&t.next(u)},a=u=>{const h=performance.now()-i.startTime;xe.recordAuthAttempt("authStateChange",h,!1,{error:(u==null?void 0:u.code)||"unknown",method:"onAuthStateChanged"}),u&&typeof u=="function"?u(u):u&&u.error&&u.error(u)},l=()=>{const u=performance.now()-i.startTime;xe.recordAuthAttempt("authStateChange",u,!0,{method:"onAuthStateChanged",completed:!0}),s&&typeof s=="function"?s():s&&s.complete&&s.complete()};return this.originalMethods.onAuthStateChanged(e,o,a,l)}async setPersistence(e,t){const r=xe.startTimer("setPersistence");try{const s=await this.originalMethods.setPersistence(e,t);return xe.recordAuthAttempt("setPersistence",r.duration,!0,{persistence:t===md?"local":t===pd?"session":"unknown"}),s}catch(s){throw xe.recordAuthAttempt("setPersistence",r.duration,!1,{error:s.code,persistence:t===md?"local":t===pd?"session":"unknown"}),s}}async trackAuthOperation(e,t,r={}){const s=xe.startTimer(e);try{const i=await t();return xe.recordAuthAttempt(e,s.duration,!0,r),i}catch(i){throw xe.recordAuthAttempt(e,s.duration,!1,{...r,error:i.code||i.message}),i}}getAuthMetrics(){return xe.getMetricsSummary().authentication}getFailedAttempts(e=10){return xe.metrics.authentication.loginAttempts.filter(t=>!t.success).sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getRecentAttempts(e=20){return xe.metrics.authentication.loginAttempts.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getSlowOperations(e=10){return xe.metrics.authentication.loginAttempts.filter(t=>t.duration>xe.thresholds.slowLogin).sort((t,r)=>r.duration-t.duration).slice(0,e)}getSuccessRateByOperation(){const e={};return xe.metrics.authentication.loginAttempts.forEach(t=>{e[t.operation]||(e[t.operation]={total:0,successful:0}),e[t.operation].total++,t.success&&e[t.operation].successful++}),Object.keys(e).forEach(t=>{const r=e[t];r.successRate=r.total>0?(r.successful/r.total*100).toFixed(2):0}),e}}const El=new Rq;class Nq{constructor(){this.isRunning=!1,this.activeTests=new Map,this.testResults=[]}async runStressTest(e,t={}){if(this.isRunning)throw new Error("Stress test already running");this.isRunning=!0;const r=Date.now().toString();try{console.log(`🧪 Starting stress test: ${e.name}`);const s=await this.executeScenario(e,t);return this.testResults.push({id:r,scenario:e.name,startTime:new Date().toISOString(),endTime:new Date().toISOString(),duration:s.duration,success:s.success,metrics:s.metrics,errors:s.errors}),console.log(`✅ Stress test completed: ${e.name}`),s}catch(s){throw console.error(`❌ Stress test failed: ${e.name}`,s),s}finally{this.isRunning=!1}}async executeScenario(e,t){const r=performance.now(),s=[],i={operations:0,successfulOperations:0,failedOperations:0,averageResponseTime:0,maxResponseTime:0,minResponseTime:1/0};try{await e.execute(t,{onOperation:(l,u,h)=>{i.operations++,h?i.successfulOperations++:i.failedOperations++,i.averageResponseTime=(i.averageResponseTime+u)/2,i.maxResponseTime=Math.max(i.maxResponseTime,u),i.minResponseTime=Math.min(i.minResponseTime,u)},onError:l=>{s.push({message:l.message,timestamp:new Date().toISOString(),stack:l.stack})}});const a=performance.now()-r;return{success:s.length===0,duration:a,metrics:i,errors:s}}catch(o){const l=performance.now()-r;return s.push({message:o.message,timestamp:new Date().toISOString(),stack:o.stack}),{success:!1,duration:l,metrics:i,errors:s}}}async databaseLoadTest(e={}){const{concurrentUsers:t=10,operationsPerUser:r=5,operationDelay:s=100}=e,i={name:"Database Load Test",execute:async(o,a)=>{const l=[];for(let u=0;u<t;u++){const h=this.simulateUserDatabaseOperations(`test_user_${u}`,r,s,a);l.push(h)}await Promise.all(l)}};return this.runStressTest(i,e)}async simulateUserDatabaseOperations(e,t,r,s){for(let i=0;i<t;i++)try{const o=performance.now(),a=[()=>this.simulateReadOperation(e,i),()=>this.simulateWriteOperation(e,i),()=>this.simulateUpdateOperation(e,i),()=>this.simulateQueryOperation(e,i)],l=a[i%a.length];await l();const u=performance.now()-o;s.onOperation(`db_operation_${i}`,u,!0),r>0&&await new Promise(h=>setTimeout(h,r))}catch(o){const a=performance.now()-startTime;s.onOperation(`db_operation_${i}`,a,!1),s.onError(o)}}async simulateReadOperation(e,t){const r=ae(H,`stress_test/${e}/read_${t}`);await $e(r)}async simulateWriteOperation(e,t){const r=ae(H,`stress_test/${e}/write_${t}`);await Ye(r,{data:`test_data_${t}`,timestamp:Date.now(),index:t})}async simulateUpdateOperation(e,t){const r=ae(H,`stress_test/${e}/update_${t}`);await Ye(r,{data:`updated_data_${t}`,timestamp:Date.now(),index:t,updated:!0})}async simulateQueryOperation(e,t){const r=ae(H,`stress_test/${e}`);await $e(r)}async authLoadTest(e={}){const{concurrentAttempts:t=20,delayBetweenAttempts:r=50}=e,s={name:"Authentication Load Test",execute:async(i,o)=>{const a=[];for(let l=0;l<t;l++){const u=this.simulateAuthAttempt(l,r,o);a.push(u)}await Promise.all(a)}};return this.runStressTest(s,e)}async simulateAuthAttempt(e,t,r){try{const s=performance.now();await new Promise(a=>setTimeout(a,Math.random()*1e3+100));const i=performance.now()-s,o=Math.random()>.1;r.onOperation(`auth_attempt_${e}`,i,o),o||r.onError(new Error(`Simulated auth failure ${e}`)),t>0&&await new Promise(a=>setTimeout(a,t))}catch(s){r.onError(s)}}async offlineOnlineTest(e={}){const{transitionCount:t=5,offlineDuration:r=2e3,onlineDuration:s=2e3}=e,i={name:"Offline/Online Transition Test",execute:async(o,a)=>{for(let l=0;l<t;l++)a.onOperation(`offline_transition_${l}`,0,!0),await new Promise(u=>setTimeout(u,r)),a.onOperation(`online_transition_${l}`,0,!0),await new Promise(u=>setTimeout(u,s))}};return this.runStressTest(i,e)}async memoryUsageTest(e={}){const{iterations:t=100,dataSize:r=1e3}=e,s={name:"Memory Usage Test",execute:async(i,o)=>{for(let a=0;a<t;a++){const l=performance.now();new Array(r).fill(0).map((h,f)=>({id:f,data:`test_data_${a}_${f}`,timestamp:Date.now()}));const u=performance.now()-l;o.onOperation(`memory_allocation_${a}`,u,!0)}}};return this.runStressTest(s,e)}getTestResults(e=10){return this.testResults.sort((t,r)=>new Date(r.startTime)-new Date(t.startTime)).slice(0,e)}clearTestResults(){this.testResults=[]}getPerformanceSummary(){return xe.getMetricsSummary()}stopAllTests(){this.isRunning=!1,this.activeTests.clear()}isTestRunning(){return this.isRunning}}const Ru=new Nq;class kq{constructor(){this.isInitialized=!1,this.originalFirebaseMethods=null,this.originalAuthMethods=null}initialize(){if(this.isInitialized){console.log("Performance monitoring already initialized");return}try{this.storeOriginalMethods(),xe.setEnabled(!0),typeof window<"u"&&(window.performanceMonitor=xe,window.databasePerformanceWrapper=Lf,window.authPerformanceWrapper=El,window.stressTestService=Ru,window.performanceIntegrationService=this),this.isInitialized=!0,console.log("✅ Performance monitoring system initialized")}catch(e){throw console.error("❌ Failed to initialize performance monitoring:",e),e}}storeOriginalMethods(){}getMetricsSummary(){return xe.getMetricsSummary()}getRecentAlerts(e=20){return xe.alerts.slice(-e)}clearAllMetrics(){xe.clearMetrics(),Ru.clearTestResults()}getDatabaseMetrics(){return Lf.getDatabaseMetrics()}getAuthMetrics(){return El.getAuthMetrics()}getStressTestResults(e=10){return Ru.getTestResults(e)}async runStressTest(e,t={}){return await Ru.runStressTest(e,t)}getAlertsByType(){return xe.getAlertsByType()}getSlowOperations(e="database",t=10){switch(e){case"database":return Lf.getSlowQueries(t);case"auth":return El.getSlowOperations(t);default:return[]}}getRecentOperations(e="database",t=20){switch(e){case"database":return Lf.getRecentQueries(t);case"auth":return El.getRecentAttempts(t);default:return[]}}getFailedOperations(e="auth",t=10){switch(e){case"auth":return El.getFailedAttempts(t);default:return[]}}getSuccessRatesByOperation(e="auth"){switch(e){case"auth":return El.getSuccessRateByOperation();default:return{}}}setMonitoringEnabled(e){xe.setEnabled(e)}updateThresholds(e){xe.updateThresholds(e)}exportPerformanceData(){return{metrics:xe.exportMetrics(),stressTests:Ru.getTestResults(),exportedAt:new Date().toISOString(),version:"1.0.0"}}getPerformanceHealthScore(){const e=this.getMetricsSummary();let t=100;e.database.slowQueryRate>10?t-=20:e.database.slowQueryRate>5&&(t-=10),e.authentication.successRate<90?t-=15:e.authentication.successRate<95&&(t-=5),e.offlineQueue.successRate<90&&(t-=10),e.general.averagePageLoadTime>3e3?t-=15:e.general.averagePageLoadTime>2e3&&(t-=5);const s=this.getRecentAlerts(10).filter(i=>i.severity==="error").length;return t-=s*5,Math.max(0,Math.min(100,t))}getPerformanceRecommendations(){const e=[],t=this.getMetricsSummary();return this.getPerformanceHealthScore()<70&&e.push({type:"critical",message:"Performance health is below 70%. Consider optimizing database queries and reducing load.",action:"Review slow queries and optimize database operations"}),t.database.slowQueryRate>10&&e.push({type:"warning",message:`High slow query rate: ${t.database.slowQueryRate}%. Consider adding database indexes.`,action:"Add database indexes for frequently queried fields"}),t.authentication.successRate<95&&e.push({type:"warning",message:`Low authentication success rate: ${t.authentication.successRate}%. Check for auth issues.`,action:"Review authentication flow and error handling"}),t.general.averagePageLoadTime>2e3&&e.push({type:"info",message:`Slow page load times: ${t.general.averagePageLoadTime}ms average. Consider optimizing assets.`,action:"Optimize images, reduce bundle size, and implement lazy loading"}),t.offlineQueue.failedOperations>0&&e.push({type:"info",message:`${t.offlineQueue.failedOperations} offline operations failed. Check sync reliability.`,action:"Review offline queue error handling and retry logic"}),e}startContinuousMonitoring(e=3e4){this.monitoringInterval&&clearInterval(this.monitoringInterval),this.monitoringInterval=setInterval(()=>{const t=this.getPerformanceHealthScore(),r=this.getPerformanceRecommendations();t<50?console.warn("🚨 Critical performance issues detected:",r):t<80&&console.warn("⚠️ Performance warnings:",r)},e)}stopContinuousMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}getSystemStatus(){return{isInitialized:this.isInitialized,isMonitoring:xe.isEnabled,healthScore:this.getPerformanceHealthScore(),lastUpdate:new Date().toISOString(),recommendations:this.getPerformanceRecommendations()}}}const Pq=new kq,Dq=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=D.useState("signin"),[s,i]=D.useState(""),[o,a]=D.useState(""),[l,u]=D.useState(""),[h,f]=D.useState(!1),[m,y]=D.useState(!1),[_,E]=D.useState(""),[k,I]=D.useState(""),[x,R]=D.useState(!1);D.useEffect(()=>()=>{m&&y(!1)},[m]);const P=new ui;P.addScope("email"),P.addScope("profile"),P.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const $=()=>{i(""),a(""),u(""),E(""),I("")},M=async()=>{f(!0),y(!0),E("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:P.scopes,customParameters:P.customParameters});const b=ZB(yi,P),C=new Promise((B,ge)=>{setTimeout(()=>ge(new Error("Popup timeout - please try again")),6e4)}),v=await Promise.race([b,C]);if(v&&v.user){const B=v.user;console.log("Google sign-in successful for:",B.email,"UID:",B.uid),console.log("User display name:",B.displayName),console.log("User photo URL:",B.photoURL),await new Promise(ge=>setTimeout(ge,800)),n(B)}else throw new Error("No user data received from Google authentication")}catch(b){console.error("Google sign-in error:",b),b.code==="auth/popup-closed-by-user"?E("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):b.code==="auth/popup-blocked"?E("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):b.code==="auth/cancelled-popup-request"?E("Google sign-in was cancelled. Please try again and complete the authentication process."):b.code==="auth/account-exists-with-different-credential"?E("An account already exists with this email using a different sign-in method. Please use email/password instead."):b.message==="Popup timeout - please try again"?E("Google sign-in popup timed out. Please try again and complete the account selection quickly."):b.code==="auth/network-request-failed"?E("Network error during Google sign-in. Please check your internet connection and try again."):b.code==="auth/operation-not-allowed"?E("Google sign-in is not enabled for this app. Please contact support."):E(A(b.code))}finally{f(!1),y(!1)}},N=async b=>{b.preventDefault(),f(!0),E("");try{const v=(await mD(yi,s,o)).user;console.log("Email sign-in successful for:",v.email),n(v)}catch(C){console.error("Email sign-in error:",C),E(A(C.code))}finally{f(!1)}},w=async b=>{if(b.preventDefault(),f(!0),E(""),o!==l){E("Passwords do not match"),f(!1);return}if(o.length<6){E("Password must be at least 6 characters long"),f(!1);return}try{const v=(await fD(yi,s,o)).user;console.log("Email sign-up successful for:",v.email),await dB(v),n(v)}catch(C){console.error("Email sign-up error:",C),E(A(C.code))}finally{f(!1)}},T=async b=>{if(b.preventDefault(),!s){E("Please enter your email address");return}f(!0),E("");try{await lB(yi,s),I("Password reset email sent! Check your inbox.")}catch(C){console.error("Password reset error:",C),E(A(C.code))}finally{f(!1)}},A=b=>{switch(b){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return x?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:c.jsxs("div",{className:"max-w-md w-full space-y-8",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),c.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),c.jsxs("form",{onSubmit:T,className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),c.jsx("input",{id:"email",type:"email",value:s,onChange:b=>i(b.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),_&&c.jsx("div",{className:"text-red-400 text-sm",children:_}),k&&c.jsx("div",{className:"text-green-400 text-sm",children:k}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>{R(!1),E(""),I("")},className:"flex-1 px-4 py-3 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 min-h-[44px]",children:"Back to Login"}),c.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-3 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Sending...":"Send Reset Link"})]})]})]})}):c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:c.jsxs("div",{className:"max-w-md w-full space-y-8",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),c.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),c.jsxs("div",{children:[m&&c.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:c.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[c.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),c.jsx("button",{onClick:M,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[c.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),c.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),c.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),c.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),c.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:m?c.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,_&&c.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[c.jsx("div",{className:"text-red-300 text-sm mb-2",children:_}),_.includes("Google sign-in")&&!m&&c.jsx("button",{onClick:M,disabled:h,className:"w-full px-3 py-3 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50 min-h-[44px]",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute inset-0 flex items-center",children:c.jsx("div",{className:"w-full border-t border-gray-600"})}),c.jsx("div",{className:"relative flex justify-center text-sm",children:c.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),c.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[c.jsx("button",{onClick:()=>{r("signin"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),c.jsx("button",{onClick:()=>{r("signup"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&c.jsxs("form",{onSubmit:N,className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),c.jsx("input",{id:"signin-email",type:"email",value:s,onChange:b=>i(b.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),c.jsx("input",{id:"signin-password",type:"password",value:o,onChange:b=>a(b.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),c.jsx("div",{className:"flex items-center justify-between",children:c.jsx("button",{type:"button",onClick:()=>R(!0),className:"text-sm text-blue-400 hover:text-blue-300 py-2 px-2 min-h-[44px] min-w-[44px]",children:"Forgot your password?"})}),_&&c.jsx("div",{className:"text-red-400 text-sm",children:_}),c.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&c.jsxs("form",{onSubmit:w,className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),c.jsx("input",{id:"signup-email",type:"email",value:s,onChange:b=>i(b.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),c.jsx("input",{id:"signup-password",type:"password",value:o,onChange:b=>a(b.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),c.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:b=>u(b.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),_&&c.jsx("div",{className:"text-red-400 text-sm",children:_}),k&&c.jsx("div",{className:"text-green-400 text-sm",children:k}),c.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Creating account...":"Create Account"})]})]})})},Oq=({offlineManager:n})=>{const[e,t]=D.useState(navigator.onLine),[r,s]=D.useState(!1),[i,o]=D.useState(0),[a,l]=D.useState(!1);return D.useEffect(()=>{const u=()=>{t(!0),s(!1),console.log("🌐 Connection restored"),n&&i>0&&(l(!0),setTimeout(()=>{l(!1),o(0)},2e3))},h=()=>{t(!1),s(!0),console.log("📡 Connection lost")};window.addEventListener("online",u),window.addEventListener("offline",h),t(navigator.onLine);const f=async()=>{if(n)try{const y=await n.getQueuedActionsCount();o(y)}catch(y){console.warn("Could not get queued actions count:",y)}};f();const m=setInterval(f,5e3);return()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),clearInterval(m)}},[n,i]),e&&a?c.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white p-3 text-center shadow-lg",children:c.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[c.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),c.jsxs("span",{className:"font-medium",children:["Syncing ",i," offline actions..."]})]})}):e&&!a&&i===0||e?null:c.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[c.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[c.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),c.jsxs("span",{className:"font-medium",children:["You're offline. Some features may be limited.",i>0&&` (${i} actions queued)`]}),c.jsx("button",{onClick:()=>s(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&c.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[c.jsx("p",{className:"mb-2",children:"While offline, you can:"}),c.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[c.jsx("li",{children:"• View your current stats and progress"}),c.jsx("li",{children:"• Track habits and cravings"}),c.jsx("li",{children:"• Log water intake and breathing exercises"}),c.jsx("li",{children:"• Record craving assessments and resistance"}),c.jsx("li",{children:"• Play distraction games"}),c.jsx("li",{children:"• View your profile information"})]}),c.jsxs("p",{className:"mt-2 text-yellow-200",children:["All changes will sync automatically when you're back online.",i>0&&c.jsxs("span",{className:"block mt-1 font-medium",children:["💾 ",i," action",i!==1?"s":""," queued for sync"]})]})]})]})},Mq=({offlineManager:n})=>{const[e,t]=D.useState({isOnline:navigator.onLine,queuedOperations:0,failedOperations:0,syncInProgress:!1,lastSyncTime:null}),[r,s]=D.useState(!1),[i,o]=D.useState(0),[a,l]=D.useState(null);D.useEffect(()=>{if(!n||!n.progressManager)return;const E=R=>{o(R.progress),l(R.currentOperation)},k=R=>{t(P=>({...P,syncInProgress:R.status==="syncing",lastSyncTime:R.endTime||P.lastSyncTime}))};n.progressManager.addProgressCallback(E),n.progressManager.addStatusCallback(k);const I=()=>{const R=n.getStatus();t(P=>({...P,isOnline:R.isOnline,queuedOperations:R.queue.queuedOperations,failedOperations:R.queue.failedOperations,syncInProgress:R.queue.syncInProgress}))};I();const x=setInterval(I,1e3);return()=>{n&&n.progressManager&&(n.progressManager.removeProgressCallback(E),n.progressManager.removeStatusCallback(k)),clearInterval(x)}},[n]);const u=async()=>{n&&await n.retryFailedOperations()},h=async()=>{n&&await n.attemptSync()},f=E=>{if(!E)return"Never";const I=Date.now()-E,x=Math.floor(I/6e4),R=Math.floor(x/60),P=Math.floor(R/24);return P>0?`${P}d ago`:R>0?`${R}h ago`:x>0?`${x}m ago`:"Just now"},m=()=>e.isOnline?e.failedOperations>0?"text-red-600":e.queuedOperations>0?"text-blue-600":"text-green-600":"text-yellow-600",y=()=>e.isOnline?e.syncInProgress?"🔄":e.failedOperations>0?"⚠️":e.queuedOperations>0?"⏳":"✅":"📡",_=()=>e.isOnline?e.syncInProgress?"Syncing...":e.failedOperations>0?`${e.failedOperations} failed`:e.queuedOperations>0?`${e.queuedOperations} queued`:"Synced":"Offline";return n?c.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[c.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${m()}`,onClick:()=>s(!r),children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-lg",children:y()}),c.jsx("div",{className:"text-sm font-medium",children:_()}),e.syncInProgress&&c.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"})]}),e.syncInProgress&&c.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:c.jsx("div",{className:"bg-current h-1 rounded-full transition-all duration-300",style:{width:`${i}%`}})})]}),r&&c.jsxs("div",{className:"absolute top-16 right-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[c.jsxs("div",{className:"flex justify-between items-center mb-3",children:[c.jsx("h3",{className:"font-semibold text-gray-800",children:"Sync Status"}),c.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),c.jsxs("div",{className:"mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("span",{className:`w-2 h-2 rounded-full ${e.isOnline?"bg-green-500":"bg-yellow-500"}`}),c.jsx("span",{className:"text-sm font-medium",children:e.isOnline?"Online":"Offline"})]}),c.jsxs("div",{className:"text-xs text-gray-500",children:["Last sync: ",f(e.lastSyncTime)]})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Queue Status"}),c.jsxs("div",{className:"space-y-1 text-xs",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Queued:"}),c.jsx("span",{className:"text-blue-600",children:e.queuedOperations})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Failed:"}),c.jsx("span",{className:"text-red-600",children:e.failedOperations})]})]})]}),a&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Current Operation"}),c.jsxs("div",{className:"text-xs text-gray-600",children:[a.type," - ",Math.round(i),"%"]})]}),c.jsxs("div",{className:"flex gap-2",children:[e.failedOperations>0&&c.jsx("button",{onClick:u,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Retry Failed"}),e.queuedOperations>0&&e.isOnline&&c.jsx("button",{onClick:h,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Sync Now"})]}),c.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:c.jsx("div",{className:"text-xs text-gray-500",children:c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Success Rate:"}),c.jsxs("span",{children:[n.getStatus().sync.successRate,"%"]})]})})})]})]}):null},Lq=({sessionManager:n,authGuard:e})=>{const[t,r]=D.useState({isActive:!1,duration:0,timeUntilTimeout:0,timeUntilWarning:0}),[s,i]=D.useState(!1),[o,a]=D.useState(!1);D.useEffect(()=>{if(!n)return;const E=()=>{const I=n.getSessionInfo();r(I),a(I.timeUntilWarning<=0&&I.timeUntilTimeout>0)};E();const k=setInterval(E,1e3);return()=>clearInterval(k)},[n]);const l=E=>{if(E<=0)return"0:00";const k=Math.floor(E/60),I=E%60;return`${k}:${I.toString().padStart(2,"0")}`},u=E=>E<60?`${E}s`:E<3600?`${Math.floor(E/60)}m`:`${Math.floor(E/3600)}h ${Math.floor(E%3600/60)}m`,h=()=>t.isActive?o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600":"text-gray-500",f=()=>t.isActive?o?"⚠️":t.timeUntilTimeout<=60?"🔴":"🟢":"⏸️",m=()=>t.isActive?o?"Warning":t.timeUntilTimeout<=60?"Expiring":"Active":"Inactive",y=()=>{n&&n.extendSession()},_=async()=>{if(e)try{await e.logout()}catch(E){console.error("Logout failed:",E)}};return t.isActive?c.jsxs("div",{className:"fixed top-4 left-4 z-50",children:[c.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${h()}`,onClick:()=>i(!s),children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-lg",children:f()}),c.jsx("div",{className:"text-sm font-medium",children:m()}),t.timeUntilTimeout>0&&c.jsx("div",{className:"text-xs opacity-75",children:l(t.timeUntilTimeout)})]}),t.timeUntilTimeout>0&&c.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:c.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${o?"bg-yellow-500":t.timeUntilTimeout<=60?"bg-red-500":"bg-green-500"}`,style:{width:`${Math.max(0,Math.min(100,t.timeUntilTimeout/1800*100))}%`}})})]}),s&&c.jsxs("div",{className:"absolute top-16 left-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[c.jsxs("div",{className:"flex justify-between items-center mb-3",children:[c.jsx("h3",{className:"font-semibold text-gray-800",children:"Session Status"}),c.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Session Duration"}),c.jsx("div",{className:"text-lg font-mono text-gray-900",children:u(t.duration)})]}),t.timeUntilTimeout>0&&c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Time Until Timeout"}),c.jsx("div",{className:`text-lg font-mono ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-gray-900"}`,children:l(t.timeUntilTimeout)})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Status"}),c.jsx("div",{className:`text-sm font-medium ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600"}`,children:m()})]}),c.jsxs("div",{className:"flex gap-2",children:[o&&c.jsx("button",{onClick:y,className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Extend Session"}),c.jsx("button",{onClick:_,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Logout"})]}),e&&c.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:c.jsxs("div",{className:"text-xs text-gray-500",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Operations:"}),c.jsx("span",{children:e.getOperationStats().total})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Success Rate:"}),c.jsxs("span",{children:[e.getOperationStats().successRate,"%"]})]})]})})]})]}):null},jq=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>c.jsxs("div",{className:"p-4 sm:p-6",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),c.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your breathing session"})]}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:[c.jsxs("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[c.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:c.jsx("span",{className:"text-lg",children:"🫁"})}),c.jsx("div",{className:"text-white font-semibold text-sm",children:"BREATHING RATE"})]}),c.jsx("div",{className:"text-white font-bold text-sm",children:n.name}),c.jsxs("div",{className:"text-slate-400 text-xs",children:[n.inhale,"s | ",n.exhale,"s"]})]}),c.jsxs("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[c.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:c.jsx("span",{className:"text-lg",children:"⏱️"})}),c.jsx("div",{className:"text-white font-semibold text-sm",children:"DURATION"})]}),c.jsxs("div",{className:"text-white font-bold text-sm",children:[e,"min."]}),c.jsx("div",{className:"text-slate-400 text-xs",children:"Total time"})]})]}),c.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-base sm:text-lg py-3 sm:py-4 px-4 sm:px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl min-h-[44px]",children:"START EXERCISE"}),c.jsx("div",{className:"mt-4 sm:mt-6 text-center",children:c.jsx("p",{className:"text-slate-400 text-xs sm:text-sm",children:"Find a comfortable position and prepare to relax"})})]}),Vq=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return c.jsxs("div",{className:"p-8",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),c.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),c.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>c.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"text-left",children:[c.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),c.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&c.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:c.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),c.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},Fq=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=D.useState(n),i=2,o=10;D.useEffect(()=>{s(n)},[n]);const a=f=>{const m=parseInt(f.target.value);s(m),navigator.vibrate&&navigator.vibrate(50),console.log(`🎯 Duration picker: Selected ${m} minutes`)},l=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return c.jsxs("div",{className:"p-8",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),c.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),c.jsxs("div",{className:"text-center mb-8",children:[c.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),c.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),c.jsx("div",{className:"mb-8",children:c.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4",autoComplete:"off"})}),c.jsx("button",{onClick:l,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),c.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},Uq=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=D.useState(e*60),[m,y]=D.useState("inhale"),[_,E]=D.useState(0),[k,I]=D.useState(!1),[x,R]=D.useState(.1),[P,$]=D.useState(!1),[M,N]=D.useState(!1),w=D.useRef(null),T=D.useRef(null);D.useEffect(()=>{h===0&&k&&!M&&(console.log("🎯 Exercise completed, calling onComplete"),N(!0),t())},[h,k,M,t]);const A=()=>{console.log(`⏰ Starting main timer for ${e} minutes`),T.current&&(console.log("⚠️ Timer already exists, clearing previous timer"),clearInterval(T.current)),T.current=setInterval(()=>{f(Oe=>{if(Oe<=1)return console.log(`⏰ Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(T.current),T.current=null,0;const O=Oe-1;return O%10===0&&console.log(`⏰ Main timer: ${O}s remaining`),O})},1e3),console.log("✅ Main timer started successfully")},b=()=>{console.log(`🚀 Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),w.current&&(console.log("⚠️ Animation already running, clearing previous animation"),cancelAnimationFrame(w.current));const Oe=n.inhale+n.exhale;let O=0,W=0,ce="inhale";console.log(`📊 Cycle duration: ${Oe}s, starting animation loop...`);const me=()=>{if(O+=16,O>=Oe*1e3&&(console.log(`🔄 Breathing cycle completed, resetting to 0ms. Current phase: ${ce}, phaseTime: ${_}`),O=0,W=0,ce="inhale",y("inhale"),E(0)),O<n.inhale*1e3){ce!=="inhale"&&(console.log(`🔄 Switching to INHALE phase at ${O}ms`),ce="inhale",y("inhale"),E(0),W=0);const Te=O/(n.inhale*1e3),ne=.1+C(Te)*3.9;R(ne);const ye=Math.floor(Te*n.inhale);ye!==W&&(E(ye),W=ye,console.log(`⏱️ INHALE: ${ye}/${n.inhale}s (phase: ${ce}, scale: ${ne.toFixed(3)})`))}else{ce!=="exhale"&&(console.log(`🔄 Switching to EXHALE phase at ${O}ms`),ce="exhale",y("exhale"),E(0),W=0);const Te=(O-n.inhale*1e3)/(n.exhale*1e3),ne=4-C(Te)*3.9;R(ne);const ye=Math.floor(Te*n.exhale);ye!==W&&(E(ye),W=ye,console.log(`⏱️ EXHALE: ${ye}/${n.exhale}s (phase: ${ce}, scale: ${ne.toFixed(3)})`))}w.current=requestAnimationFrame(me)};me(),console.log("✅ Breathing cycle animation started successfully")},C=Oe=>Oe<.5?2*Oe*Oe:-1+(4-2*Oe)*Oe;D.useEffect(()=>(k&&(A(),b()),()=>{k&&Ee()}),[k]);const v=Oe=>{const O=Math.floor(Oe/60),W=Oe%60;return`${O.toString().padStart(2,"0")}:${W.toString().padStart(2,"0")}`},B=()=>_,ge=()=>m==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",ke=()=>m==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",_t=()=>{console.log("🔄 User clicked close button, showing confirmation popup"),$(!0)},Y=()=>{console.log("🚪 User confirmed leaving exercise, cleaning up..."),Ee(),s?s():r()},we=()=>{$(!1)},re=()=>{if(k){console.log("⚠️ Exercise already active, ignoring start request");return}console.log(`🎬 Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(`📊 Initial state - isActive: ${k}, progress: ${x}, currentPhase: ${m}`),R(.1),y("inhale"),E(0),f(e*60),I(!0),console.log("✅ isActive set to true, starting timers..."),setTimeout(()=>{console.log("🚀 Starting main timer and breathing cycle..."),A(),b()},0)},Ee=()=>{console.log("🧹 Cleaning up breathing exercise resources"),w.current&&(cancelAnimationFrame(w.current),w.current=null),T.current&&(clearInterval(T.current),T.current=null),I(!1),f(0),R(.1),y("inhale"),E(0)};return D.useEffect(()=>{k||(console.log("🎬 Component mounted, starting breathing exercise automatically"),re())},[]),c.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between p-6",children:[c.jsx("button",{onClick:_t,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50 min-h-[44px] min-w-[44px]",title:"End breathing exercise",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),c.jsx("div",{className:"text-center",children:c.jsx("div",{className:"text-white text-2xl font-mono",children:v(h)})}),c.jsx("div",{className:"w-11"})," "]}),c.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[c.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),c.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${ge()} rounded-full shadow-2xl`,style:{transform:`scale(${x})`,transition:"none",boxShadow:`0 0 ${Math.max(x*40,10)}px ${Math.max(x*15,5)}px ${m==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),c.jsxs("div",{className:"p-6 text-center",children:[c.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:c.jsx("span",{className:"text-white text-lg leading-tight",children:ke()})}),c.jsxs("div",{className:"text-slate-400 text-sm",children:[B(),"/",m==="inhale"?n.inhale:n.exhale,"s"]})]}),c.jsx("div",{className:"px-6 pb-6",children:c.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:c.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),P&&c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600/50 max-w-sm",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),c.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:Y,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Leave"}),c.jsx("button",{onClick:we,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Stay"})]})]})})})]})},$q=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=D.useState("setup"),[o,a]=D.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[l,u]=D.useState(4),[h,f]=D.useState(!1);D.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const m=x=>{a(x),i("setup")},y=x=>{u(x),i("setup")},_=()=>{f(!0),i("exercise")},E=()=>{f(!1),i("setup"),r&&r(),e()},k=()=>{s==="exercise"&&h||e()},I=()=>{console.log("🚪 User leaving breathing exercise via close button"),e(),t&&t()};return n?c.jsxs("div",{className:"modal-backdrop",children:[c.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:k}),c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-slate-900 border-slate-700/50 max-w-md sm:max-w-2xl mx-auto w-full",children:[!(s==="exercise"&&h)&&c.jsx("button",{onClick:k,className:"absolute top-4 left-4 z-10 w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors min-h-[44px] min-w-[44px]",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&c.jsx(jq,{selectedRate:o,duration:l,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:_}),s==="rate"&&c.jsx(Vq,{selectedRate:o,onSelect:m,onBack:()=>i("setup")}),s==="duration"&&c.jsx(Fq,{selectedDuration:l,onSelect:y,onBack:()=>i("setup")}),s==="exercise"&&c.jsx(Uq,{rate:o,duration:l,onComplete:E,onClose:k,onLeave:I})]})})]}):null},Bq=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=D.useState(null),[i,o]=D.useState(!0),[a,l]=D.useState(30);D.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsx("div",{className:"modal-content bg-slate-800 max-w-4xl",children:c.jsxs("div",{className:"modal-scrollable",children:[c.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(e0,{className:"w-6 h-6 text-blue-400"}),c.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("select",{value:a,onChange:h=>l(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-3 rounded border border-slate-600 min-h-[44px]",children:[c.jsx("option",{value:7,children:"Last 7 days"}),c.jsx("option",{value:30,children:"Last 30 days"}),c.jsx("option",{value:90,children:"Last 90 days"})]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"✕"})]})]}),c.jsx("div",{className:"p-6",children:i?c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),c.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Iq,{className:"w-5 h-5 text-green-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),c.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),c.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Eq,{className:"w-5 h-5 text-blue-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),c.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),c.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(r2,{className:"w-5 h-5 text-purple-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),c.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),c.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-orange-400",children:"💧"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),c.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),c.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),c.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),c.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>c.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gray-300",children:"🫁 Breathing Exercises"}),c.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gray-300",children:"🧘‍♀️ Meditation Sessions"}),c.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gray-300",children:"🚶‍♂️ Physical Activities"}),c.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gray-300",children:"💧 Hydration Goals Met"}),c.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>c.jsxs("div",{className:"flex justify-between",children:[c.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),c.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),c.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>c.jsxs("p",{className:"text-gray-300 text-sm",children:["• ",h]},f)),r.insights.length===0&&c.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"📡 System Status"}),c.jsxs("div",{className:"space-y-2 mb-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),c.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),c.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),c.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),c.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),c.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),c.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),m=document.createElement("a");m.href=f,m.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,m.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Export Analytics Data"})]})]}):c.jsxs("div",{className:"text-center py-8",children:[c.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),c.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})})})}):c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-slate-800 p-6",children:[c.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),c.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),c.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Close"})]})})})};console.log("🧪 FirestoreBuddyService import check:",!!sc);console.log("🧪 FirestoreBuddyService type:",typeof sc);console.log("🧪 FirestoreBuddyService constructor:",sc==null?void 0:sc.name);const js=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},jf=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},Vf=n=>n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e",Ms=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},zq=({onComplete:n,authUser:e,pwaInstallAvailable:t,promptInstall:r})=>{const[s,i]=D.useState(1),[o,a]=D.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[l,u]=D.useState(!1),[h,f]=D.useState(!1),[m,y]=D.useState(null),[_,E]=D.useState(null),k=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:Ao},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:u2},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:i2},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:s2}],I=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],x=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],R=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],P=()=>{console.log("Calculating stats with userData:",o);let C=40;o.vapePodsPerWeek<=1?C+=5:o.vapePodsPerWeek<=3?C+=15:o.vapePodsPerWeek<=5?C+=25:o.vapePodsPerWeek<=7?C+=35:C+=40;const v=o.nicotineStrength||"",B=parseInt(v.replace("mg",""))||0;B<=5?C+=0:B<=11?C+=10:B<=20?C+=20:C+=25,o.dailyPatterns.includes("Throughout the day")?C+=20:o.dailyPatterns.length>2?C+=10:C+=0,C=Math.min(C,100);let ge=25;o.confidence>=9?ge+=35:o.confidence>=7?ge+=25:o.confidence>=4?ge+=15:ge+=0,o.quitAttempts==="first"?ge+=15:parseInt(o.quitAttempts)<=3?ge+=10:ge+=5,o.copingStrategies.length>=3?ge+=15:o.copingStrategies.length>=1?ge+=10:ge+=0,ge=Math.min(ge,80);let ke=35;ke+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[o.archetype]||0,o.confidence>=8?ke+=25:o.confidence>=5?ke+=15:ke+=0,o.quitAttempts==="first"?ke+=10:parseInt(o.quitAttempts)<=3?ke+=5:ke+=15,ke=Math.min(ke,90);let Y=15;o.triggers.length<=2?Y+=15:o.triggers.length<=4?Y+=10:Y+=5;const we=o.triggers.includes("Drinking alcohol"),re=o.triggers.includes("Social situations");return we&&re?Y+=0:o.triggers.length>3?Y+=5:Y+=10,o.copingStrategies.length>=3?Y+=25:o.copingStrategies.length>=1?Y+=15:Y+=0,o.dailyPatterns.includes("Throughout the day")?Y+=0:o.dailyPatterns.length>2?Y+=5:Y+=10,Y=Math.min(Y,60),{addictionLevel:C,mentalStrength:ge,motivation:ke,triggerDefense:Y}},$=C=>{const v=C.target.files[0];if(v){y(v);const B=new FileReader;B.onload=ge=>E(ge.target.result),B.readAsDataURL(v)}},M=async()=>{if(m){f(!0);try{const C=document.createElement("canvas"),v=C.getContext("2d"),B=new Image;B.onload=()=>{C.width=200,C.height=200,v.filter="contrast(1.2) saturate(1.3) brightness(1.1)",v.drawImage(B,0,0,200,200),v.globalCompositeOperation="overlay",v.fillStyle="rgba(255, 200, 200, 0.1)",v.fillRect(0,0,200,200);const ge=C.toDataURL("image/png"),ke={...o,avatar:ge};a(ke),b(ke,3),f(!1)},B.src=_}catch(C){console.error("Photo processing failed:",C);const v=jf(o.avatarSeed);a(B=>({...B,avatar:v})),f(!1)}}},N=()=>{u(!0);const C=Math.random().toString(36).substring(7);(async()=>{try{const B=js(C),ge={...o,avatarSeed:C,avatar:B};a(ge),b(ge,3)}catch{const ge=jf(C),ke={...o,avatarSeed:C,avatar:ge};a(ke),b(ke,3)}})(),setTimeout(()=>u(!1),500)},w=async()=>{if(s<10)await b(o,s),i(s+1);else try{console.log("Completing onboarding with userData:",o);const C=P();console.log("Calculated stats:",C);const v={...o,stats:{...C,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await b(v,10),console.log("Final user data:",v),n(v)}catch(C){console.error("Error completing onboarding:",C);const B={...o,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await b(B,10)}catch(ge){console.error("Failed to save fallback data to Firebase:",ge)}console.log("Using fallback stats:",B),n(B)}},T=()=>{s>1&&i(s-1)},A=()=>{switch(s){case 1:return o.heroName.trim().length>0;case 2:return o.archetype!=="";case 3:return o.avatar!==null;case 4:return o.triggers.length>0;case 5:return o.dailyPatterns.length>0;case 6:return o.copingStrategies.length>0;case 7:return o.vapePodsPerWeek>0;case 8:return o.nicotineStrength!=="";case 9:return o.quitAttempts!=="";case 10:return o.confidence>0;default:return!1}},b=async(C,v)=>{if(e)try{const{ref:B,set:ge}=await De(()=>import("./index.esm-980f89f8.js"),[]),ke=B(H,`users/${e.uid}/onboarding`);await ge(B(H,`users/${e.uid}/onboarding/step${v}`),{...C,stepNumber:v,timestamp:Date.now()}),await ge(B(H,`users/${e.uid}/onboarding/progress`),{currentStep:v,completedSteps:Array.from({length:v},(_t,Y)=>Y+1),lastUpdated:Date.now()}),console.log(`Step ${v} saved to Firebase successfully`)}catch(B){console.error(`Error saving step ${v} to Firebase:`,B)}};return D.useEffect(()=>{if(!o.avatar){const C=js(o.avatarSeed);a(v=>({...v,avatar:C}))}},[]),c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:c.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[t&&c.jsxs("div",{className:"mb-4 p-3 rounded-lg border border-blue-600 bg-blue-900/40 text-blue-100 flex items-center justify-between",children:[c.jsx("div",{className:"mr-3",children:"Install QuitArena for a faster, full-screen experience."}),c.jsx("button",{onClick:r,className:"px-4 py-3 rounded-md bg-blue-600 hover:bg-blue-500 text-white text-sm font-semibold min-h-[44px] min-w-[44px]",children:"Install"})]}),c.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(C=>c.jsxs("div",{className:"flex items-center flex-shrink-0",children:[c.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${C<=s?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:C<s?"✓":C}),C<10&&c.jsx("div",{className:`w-4 h-1 mx-1 ${C<s?"bg-blue-500":"bg-slate-600"}`})]},C))}),s===1&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx(xq,{className:"w-10 h-10 text-white"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),c.jsx("input",{type:"text",value:o.heroName,onChange:C=>{const v={...o,heroName:C.target.value};a(v),C.target.value.trim().length>0&&b(v,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",autoComplete:"name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s===2&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx(Ao,{className:"w-10 h-10 text-white"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),c.jsx("div",{className:"space-y-3 mb-6",children:k.map(C=>{const v=C.icon;return c.jsx("button",{onClick:()=>{const B={...o,archetype:C.id};a(B),b(B,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.archetype===C.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-10 h-10 ${C.color} rounded-lg flex items-center justify-center`,children:c.jsx(v,{className:"w-5 h-5 text-white"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-white font-semibold",children:C.name}),c.jsx("p",{className:"text-gray-400 text-sm",children:C.description})]})]})},C.id)})})]}),s===3&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx(c2,{className:"w-10 h-10 text-white"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),c.jsxs("div",{className:"mb-6",children:[c.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:o.avatar?c.jsx("img",{src:o.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{a(C=>({...C,avatar:jf(C.avatarSeed)}))}}):c.jsx("div",{className:"w-full h-full flex items-center justify-center",children:c.jsx(zl,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),c.jsx("input",{type:"file",accept:"image/*",onChange:$,className:"hidden",id:"photo-upload",autoComplete:"photo"}),c.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),_&&c.jsx("div",{className:"mb-4",children:c.jsx("button",{onClick:M,disabled:h,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:h?c.jsxs(c.Fragment,{children:[c.jsx(zl,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):c.jsx(c.Fragment,{children:"✨ Convert to Anime"})})}),c.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),c.jsx("button",{onClick:N,disabled:l,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?c.jsxs(c.Fragment,{children:[c.jsx(zl,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):c.jsxs(c.Fragment,{children:[c.jsx(zl,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),c.jsx("button",{onClick:()=>{const C=jf(o.avatarSeed),v={...o,avatar:C};a(v),b(v,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),s===4&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx("span",{className:"text-2xl",children:"🎯"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),c.jsx("div",{className:"space-y-3 mb-6",children:I.map(C=>c.jsx("button",{onClick:()=>{const v={...o,triggers:o.triggers.includes(C)?o.triggers.filter(B=>B!==C):[...o.triggers,C]};a(v),b(v,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.triggers.includes(C)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.triggers.includes(C)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.triggers.includes(C)&&c.jsx("span",{className:"text-white text-sm",children:"✓"})}),c.jsx("span",{className:"text-white font-semibold",children:C})]})},C))})]}),s===5&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx("span",{className:"text-2xl",children:"📅"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),c.jsx("div",{className:"space-y-3 mb-6",children:x.map(C=>c.jsx("button",{onClick:()=>{const v={...o,dailyPatterns:o.dailyPatterns.includes(C)?o.dailyPatterns.filter(B=>B!==C):[...o.dailyPatterns,C]};a(v),b(v,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.dailyPatterns.includes(C)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.dailyPatterns.includes(C)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.dailyPatterns.includes(C)&&c.jsx("span",{className:"text-white text-sm",children:"✓"})}),c.jsx("span",{className:"text-white font-semibold",children:C})]})},C))})]}),s===6&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx("span",{className:"text-2xl",children:"🛡️"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),c.jsx("div",{className:"space-y-3 mb-6",children:R.map(C=>c.jsx("button",{onClick:()=>{const v={...o,copingStrategies:o.copingStrategies.includes(C)?o.copingStrategies.filter(B=>B!==C):[...o.copingStrategies,C]};a(v),b(v,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.copingStrategies.includes(C)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.copingStrategies.includes(C)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.copingStrategies.includes(C)&&c.jsx("span",{className:"text-white text-sm",children:"✓"})}),c.jsx("span",{className:"text-white font-semibold",children:C})]})},C))})]}),s===7&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx("span",{className:"text-2xl",children:"🚬"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),c.jsx("div",{className:"mb-6",children:c.jsxs("select",{value:o.vapePodsPerWeek,onChange:C=>{const v={...o,vapePodsPerWeek:parseFloat(C.target.value)||0};a(v),v.vapePodsPerWeek>0&&b(v,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[c.jsx("option",{value:"",children:"Select pods per week"}),c.jsx("option",{value:"0.5",children:"0.5 pods"}),c.jsx("option",{value:"1",children:"1 pod"}),c.jsx("option",{value:"2",children:"2 pods"}),c.jsx("option",{value:"3",children:"3 pods"}),c.jsx("option",{value:"4",children:"4 pods"}),c.jsx("option",{value:"5",children:"5 pods"}),c.jsx("option",{value:"6",children:"6 pods"}),c.jsx("option",{value:"7",children:"7 pods"}),c.jsx("option",{value:"8",children:"8+ pods"})]})})]}),s===8&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx("span",{className:"text-2xl",children:"⚡"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),c.jsx("div",{className:"mb-6",children:c.jsxs("select",{value:o.nicotineStrength,onChange:C=>{const v={...o,nicotineStrength:C.target.value};a(v),v.nicotineStrength&&b(v,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[c.jsx("option",{value:"",children:"Select nicotine strength"}),c.jsx("option",{value:"3mg",children:"3mg"}),c.jsx("option",{value:"6mg",children:"6mg"}),c.jsx("option",{value:"12mg",children:"12mg"}),c.jsx("option",{value:"18mg",children:"18mg"}),c.jsx("option",{value:"20mg",children:"20mg"}),c.jsx("option",{value:"50mg",children:"50mg"})]})})]}),s===9&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx("span",{className:"text-2xl",children:"📚"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),c.jsx("div",{className:"mb-6",children:c.jsxs("select",{value:o.quitAttempts,onChange:C=>{const v={...o,quitAttempts:C.target.value};a(v),v.quitAttempts&&b(v,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[c.jsx("option",{value:"",children:"Select option"}),c.jsx("option",{value:"first",children:"This is my first attempt"}),c.jsx("option",{value:"1",children:"Once before"}),c.jsx("option",{value:"2",children:"Twice before"}),c.jsx("option",{value:"3",children:"3-5 times"}),c.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),s===10&&c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx("span",{className:"text-2xl",children:"🎯"})}),c.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),c.jsx("input",{type:"range",min:"1",max:"10",value:o.confidence,onChange:C=>{const v={...o,confidence:parseInt(C.target.value)};a(v),b(v,10)},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${Vf(o.confidence)} 0%, ${Vf(o.confidence)} ${o.confidence/10*100}%, #475569 ${o.confidence/10*100}%, #475569 100%)`},autoComplete:"off"}),c.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),c.jsxs("div",{className:"text-center mt-4",children:[c.jsx("span",{className:"font-bold text-4xl",style:{color:Vf(o.confidence)},children:o.confidence}),c.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),c.jsx("div",{className:"text-center mt-2",children:c.jsx("span",{className:"text-sm font-medium",style:{color:Vf(o.confidence)},children:o.confidence<=3?"You can do this! 💪":o.confidence<=6?"Good confidence! 🎯":o.confidence<=9?"Great confidence! 🚀":"Excellent confidence! 🌟"})})]})]}),c.jsxs("div",{className:"flex justify-between",children:[s>1&&c.jsx("button",{onClick:T,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),c.jsxs("button",{onClick:w,disabled:!A(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${A()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[s===10?"Start Journey":"Next",c.jsx(_q,{className:"w-4 h-4"})]})]})]})})},KT={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:Ao},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:u2},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:i2},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:s2}},qq={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},YT={WEEK_WARRIOR:{name:"Week Warrior",icon:r2,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:l2,description:"30 days clean"},LEGEND:{name:"Legend",icon:a2,description:"90 days clean"}},Wq=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",Gq=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Your body's dependence level - decreases with clean time, increases with relapses",impacts:["What decreases it:","• Clean time: -2 points per week","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?c.jsxs("div",{className:"modal-backdrop",children:[c.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[c.jsxs("div",{className:"text-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),c.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),c.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>c.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[c.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),c.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300 min-h-[44px]",children:"Got it"})]})})]}):null},Ff=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return c.jsxs("div",{className:"mb-0.5 sm:mb-1",children:[c.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&c.jsx("button",{onClick:()=>i(s),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{fontSize:"4px"},title:`Learn about ${n}`,children:"i"})]}),c.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),c.jsx("div",{className:"stat-bar-interactive w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:c.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},JT=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=D.useState(!1),[a,l]=D.useState(null),[u,h]=D.useState([]),[f,m]=D.useState({});if(D.useEffect(()=>{let M=!1;return(async()=>{try{if(n&&n.uid)if(n.specialFeatures)M||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),m({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),m(n.specialFeatures.categories||{})):(h([]),m({})));else{const w=await k(n);M||(Array.isArray(w)?(h(w),m({})):w&&w.features?(h(w.features),m(w.categories||{})):(h([]),m({})))}else M||(h([]),m({}))}catch(w){console.error("❌ TradingCard: Error loading Special Features:",w),M||(h([]),m({}))}})(),()=>{M=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return c.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:c.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),c.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),c.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return c.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:c.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const y=KT[n.archetype];if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(KT)),c.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:c.jsxs("div",{children:[c.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),c.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const _=qq[Wq(n.stats.streakDays)],E=y.icon;async function k(M){if(M!=null&&M.isRealBuddy){try{const{ref:v,get:B}=await De(()=>import("./index.esm-980f89f8.js"),[]),ge=v(H,`users/${M.uid}/stats`),ke=await B(ge);if(ke.exists()){const we=ke.val();if(we.specialFeatures&&Array.isArray(we.specialFeatures))return we.specialFeatures}const _t=v(H,`users/${M.uid}/specialFeatures`),Y=await B(_t);if(Y.exists())return Y.val()}catch(v){console.warn("⚠️ TradingCard: Could not load centralized Special Features for buddy:",v.message)}return["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let N=null;if(M.uid)try{const{ref:v,get:B}=await De(()=>import("./index.esm-980f89f8.js"),[]),ge=v(H,`users/${M.uid}/specialFeatures`),ke=await B(ge);ke.exists()&&(N=ke.val())}catch(v){console.error("Error fetching special features from Firebase:",v)}if(!N){const v=`specialFeatures_${M.heroName||M.id||"default"}`,B=localStorage.getItem(v);B&&(N=JSON.parse(B))}if(N){if(Array.isArray(N))return N;if(N&&N.features)return N}const w=[],T={};for(M.triggers&&M.triggers.length>0&&M.triggers.forEach(v=>{let B="";switch(v){case"Stress/anxiety":B="Stress Vaper";break;case"Social situations":B="Social Vaper";break;case"Boredom":B="Boredom Fighter";break;case"After meals":B="Habit Former";break;case"Drinking alcohol":B="Party Animal";break;case"Work breaks":B="Work Breaker";break;case"Driving":B="Driving Vaper";break;default:B="Trigger Aware"}B&&!w.includes(B)&&(w.push(B),T[B]="triggers")}),M.dailyPatterns&&M.dailyPatterns.length>0&&M.dailyPatterns.forEach(v=>{let B="";switch(v){case"Morning routine":B="Morning Struggler";break;case"Evening wind-down":B="Night Owl";break;case"Throughout the day":B="All-Day Warrior";break;default:B="Routine Builder"}B&&!w.includes(B)&&(w.push(B),T[B]="dailyPatterns")}),M.copingStrategies&&M.copingStrategies.length>0&&(M.copingStrategies.includes("Nothing - this is new to me")?(w.push("First Timer"),T["First Timer"]="copingStrategies"):M.copingStrategies.length>2?(w.push("Veteran Quitter"),T["Veteran Quitter"]="copingStrategies"):(w.push("Cold Turkey"),T["Cold Turkey"]="copingStrategies"));w.length<4;){const v=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],B=v[Math.floor(Math.random()*v.length)];w.includes(B.name)||(w.push(B.name),T[B.name]=B.category)}const A=w.slice(0,4),b={};A.forEach(v=>{b[v]=T[v]||"copingStrategies"});const C={features:A,categories:b};if(M.uid)try{const{ref:v,set:B}=await De(()=>import("./index.esm-980f89f8.js"),[]),ge=v(H,`users/${M.uid}/specialFeatures`);await B(ge,C),console.log("Special features with categories saved to Firebase successfully")}catch(v){console.error("Error saving special features to Firebase:",v);const B=`specialFeatures_${M.heroName||M.id||"default"}`;localStorage.setItem(B,JSON.stringify(C))}else{const v=`specialFeatures_${M.heroName||M.id||"default"}`;localStorage.setItem(v,JSON.stringify(A))}return A}const I=n.stats.addictionLevel||50,x=n.stats.mentalStrength||50,R=n.stats.motivation||50,P=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const $=M=>{l(M),o(!0)};return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:`touch-card relative w-72 sm:w-80 min-h-[480px] sm:min-h-[520px] rounded-xl ${_.color} border-4 ${_.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 mx-auto`,children:[c.jsxs("div",{className:"text-center mb-3",children:[c.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),c.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:y.name})]}),c.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?c.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):c.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:c.jsx(E,{className:"w-12 h-12 text-white"})})}),c.jsxs("div",{className:"mb-2 sm:mb-3",children:[c.jsx(Ff,{label:"Addiction",value:I,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:$}),c.jsx(Ff,{label:"Mental Strength",value:x,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:$}),c.jsx(Ff,{label:"Motivation",value:R,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:$}),c.jsx(Ff,{label:"Trigger Defense",value:P,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:$})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),c.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((M,N)=>{const w=f[M]||"copingStrategies",T=A=>{switch(A){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return c.jsx("div",{className:`px-2 py-1 ${T(w)} text-white text-xs rounded-full font-medium`,title:`${M} (${w})`,children:M},N)})})]}),c.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-2 sm:left-3 right-2 sm:right-3 bg-black/30 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 backdrop-blur-sm",children:[c.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[c.jsx("span",{className:"text-gray-300",children:"Streak:"}),c.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const M=n.stats.streakDays;return`${M} day${M===1?"":"s"}`})(),n.stats.streakDays>0&&c.jsx("span",{className:"text-xs",children:"🔥"})]})]}),c.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[c.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),c.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,c.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&c.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((M,N)=>{var T,A;const w=((T=YT[M])==null?void 0:T.icon)||a2;return c.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(A=YT[M])==null?void 0:A.description,children:c.jsx(w,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},N)}),n.achievements.length>4&&c.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),c.jsx(Gq,{isOpen:i,onClose:()=>o(!1),statType:a})]})},Hq=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:wq},{id:"craving-support",label:"Craving Support",icon:Ao},{id:"profile",label:"Profile",icon:c2},{id:"settings",label:"Explore",icon:o2}];return c.jsx(c.Fragment,{children:c.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:c.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return c.jsxs("button",{onClick:()=>e(o.id),className:`tab-interactive flex flex-col items-center min-h-[44px] min-w-[44px] justify-center ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[c.jsx(a,{className:"w-5 h-5"}),c.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},Qq=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:l,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),c.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),c.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[h,f]=D.useState(!1),[m,y]=D.useState(null),[_,E]=D.useState(null);D.useEffect(()=>{const O=()=>{const W=document.querySelector(".battle-cards-container");W&&(window.innerWidth<1024?(W.style.flexDirection="column",W.style.gap="1rem"):(W.style.flexDirection="row",W.style.gap="3rem"))};return O(),window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[]),D.useEffect(()=>{_&&n&&(async()=>{if(_&&n)try{console.log("🔄 App: Refreshing stats on page load for user:",n.uid),await _.refreshAllStats(),console.log("✅ App: Stats refreshed on page load")}catch(W){console.error("❌ App: Error refreshing stats on page load:",W)}})()},[_,n]);const k=async()=>{m&&await m.handleAchievementShare()},I=async O=>{if((O==null?void 0:O.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!O.quitDate||new Date(O.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),O.lastRelapseDate){const ce=new Date(O.lastRelapseDate),me=new Date("2025-09-18T13:56:46.584Z");O.quitDate=ce>me?O.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 3 quit date set to ${O.quitDate} (considering relapse: ${O.lastRelapseDate})`)}else O.quitDate="2025-09-18T13:56:46.584Z";if((O==null?void 0:O.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!O.quitDate||new Date(O.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),O.lastRelapseDate){const ce=new Date(O.lastRelapseDate),me=new Date("2025-09-18T13:56:46.584Z");O.quitDate=ce>me?O.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 2 quit date set to ${O.quitDate} (considering relapse: ${O.lastRelapseDate})`)}else O.quitDate="2025-09-18T13:56:46.584Z";let W={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(O!=null&&O.isRealBuddy){if(O.stats&&Object.assign(W,O.stats),O.quitDate){const ce=new Date(O.quitDate),me=Ms(ce);W.streakDays=me.value,W.streakUnit=me.unit,W.streakDisplayText=me.displayText}try{const{ref:ce,get:me}=await De(()=>import("./index.esm-980f89f8.js"),[]),Te=ce(H,`users/${O.uid}/cravings`),de=await me(Te);let ne=0;de.exists()&&(de.forEach(ye=>{ye.val().outcome==="resisted"&&ne++}),W.cravingsResisted=ne)}catch{console.log("⚠️ Arena: Could not read buddy cravings, using default"),W.cravingsResisted=0}return W}if(!(O!=null&&O.uid)){const ce=localStorage.getItem("quitCoachRelapseDate");if(ce){const de=new Date(ce),ye=new Date().getTime()-de.getTime(),fe=Math.floor(ye/(1e3*3600*24));W.streakDays=fe,W.streakUnit="days",W.streakDisplayText=`${fe} day${fe===1?"":"s"}`}else{const de=O.quitDate?new Date(O.quitDate):new Date,ne=Ms(de);W.streakDays=ne.value,W.streakUnit=ne.unit,W.streakDisplayText=ne.displayText}const me=parseInt(localStorage.getItem("cravingWins")||0);W.cravingsResisted=me,new Date().toDateString();let Te=0;for(let de=0;de<7;de++){const ne=new Date;ne.setDate(ne.getDate()-de);const ye=ne.toDateString(),fe=localStorage.getItem(`water_${O.uid}_${ye}`);if(fe&&parseInt(fe)>0)Te++;else break}return Te>=3&&(W.mentalStrength=Math.min(80,(W.mentalStrength||50)+1)),W}try{const{ref:ce,get:me}=await De(()=>import("./index.esm-980f89f8.js"),[]),Te=ce(H,`users/${O.uid}/cravings`);try{const pe=await me(Te);let _e=0,ze=0;if(pe.exists()){const J=pe.val();pe.forEach(Ve=>{const Pe=Ve.val();Pe.outcome==="resisted"?_e++:Pe.outcome==="relapsed"&&ze++})}W.cravingsResisted=_e;const q=ce(H,`users/${O.uid}/profile/cravingsResisted`),Z=await me(q);if(Z.exists()){const J=Z.val();console.log(`🔍 Arena: Profile cravingsResisted field value: ${J}`),W.cravingsResisted=Math.max(_e,J)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const _e=ce(H,`users/${O.uid}/profile/cravingsResisted`),ze=await me(_e);W.cravingsResisted=ze.exists()?ze.val():0}let de=0;const ne=ce(H,`users/${O.uid}/profile/relapseDate`),ye=await me(ne);if(ye.exists()){const pe=ye.val(),_e=new Date(pe),q=new Date().getTime()-_e.getTime();de=Math.floor(q/(1e3*3600*24))}else{const pe=O.quitDate?new Date(O.quitDate):new Date,_e=Ms(pe);de=_e.value,W.streakUnit=_e.unit,W.streakDisplayText=_e.displayText,console.log(`🔍 Arena: Calculated streak from quit date: ${_e.displayText} (quit: ${pe.toISOString()})`),console.log(`🔍 Arena: Setting streak fields - streakDays: ${de}, streakUnit: ${W.streakUnit}, streakDisplayText: ${W.streakDisplayText}`)}W.streakDays=de;let fe=0;for(let pe=0;pe<7;pe++){const _e=new Date;_e.setDate(_e.getDate()-pe);const ze=_e.toDateString(),q=ce(H,`users/${O.uid}/profile/daily/${ze}/water`),Z=await me(q);if(Z.exists()&&Z.val()>0)fe++;else break}fe>=3&&(W.mentalStrength=Math.min(80,(W.mentalStrength||50)+1))}catch(ce){console.error("Error fetching profile data from Firebase:",ce);const me=localStorage.getItem("quitCoachRelapseDate");if(me){const ne=new Date(me),fe=new Date().getTime()-ne.getTime(),pe=Math.floor(fe/(1e3*3600*24));W.streakDays=pe,W.streakUnit="days",W.streakDisplayText=`${pe} day${pe===1?"":"s"}`}else{const ne=O.quitDate?new Date(O.quitDate):new Date,ye=Ms(ne);W.streakDays=ye.value,W.streakUnit=ye.unit,W.streakDisplayText=ye.displayText}const Te=parseInt(localStorage.getItem("cravingWins")||0);W.cravingsResisted=Te,new Date().toDateString();let de=0;for(let ne=0;ne<7;ne++){const ye=new Date;ye.setDate(ye.getDate()-ne);const fe=ye.toDateString(),pe=localStorage.getItem(`water_${O.uid}_${fe}`);if(pe&&parseInt(pe)>0)de++;else break}de>=3&&(W.mentalStrength=Math.min(80,(W.mentalStrength||50)+1))}if(O!=null&&O.uid&&!(O!=null&&O.isRealBuddy))try{const{ref:ce,get:me}=await De(()=>import("./index.esm-980f89f8.js"),[]),Te=Date.now();await new Promise(ne=>setTimeout(ne,800));const de=await me(ce(H,`users/${O.uid}/stats`));if(de.exists()){const ne=de.val();Object.assign(W,ne)}else Object.assign(W,O.stats),console.log("🔄 Arena: Using user.stats as fallback:",W);if(m){await m.updateAddictionFromCleanTime();const ne=await me(ce(H,`users/${O.uid}/stats`));if(ne.exists()){const ye=ne.val();if(Object.assign(W,ye),O.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||O.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(`🔄 Arena: Using Firebase stats directly for ${O.uid} - no client-side calculation`),W}}}catch(ce){console.error("Error reading/updating stats from Firebase:",ce),Object.assign(W,O.stats)}return W},[x,R]=D.useState(()=>{const O={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{...O,...n.stats}:O}),[P,$]=D.useState(()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0}));D.useEffect(()=>{e&&Object.keys(e).length>0&&R(e)},[e]);const[M,N]=D.useState({streakDisplayText:null,streakDays:0,streakUnit:"hours"}),[w,T]=D.useState({}),A=async()=>{if(n&&window.centralizedStatService)try{const O=await window.centralizedStatService.getCurrentStats();return T(O),O}catch(O){return console.warn("🔄 Arena: Could not fetch latest stats from CentralizedStatService:",O),null}return null};D.useEffect(()=>{A();const O=setInterval(A,3e4);return()=>clearInterval(O)},[n]),D.useEffect(()=>{typeof window<"u"&&(window.refreshArenaStats=A,window.setLatestUserStats=T)},[n]),D.useEffect(()=>{if(!(n!=null&&n.uid))return;let O=!0;return(async()=>{await(async()=>{if(O)try{const Te=new Yg(H,n.uid);await Te.initialize(),O&&y(Te)}catch(Te){console.error("Error initializing StatManager:",Te)}})(),await(async()=>{if(O){if(n&&O){const Te=await I(n);O&&R(Te)}t&&t.uid&&O&&console.log(`🔄 Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{O=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),D.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(`🚫 Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let O=!0;const ce=(async()=>{try{const{ref:me,onValue:Te}=await De(()=>import("./index.esm-980f89f8.js"),[]),de=me(H,`users/${t.uid}/stats`),ne=Te(de,pe=>{if(O&&pe.exists()){const _e=pe.val();if(_e.streakDisplayText&&_e.streakUnit){const ze={streakDays:_e.streakDays||0,streakUnit:_e.streakUnit,streakDisplayText:_e.streakDisplayText};N(ze)}else{let ze=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(ze){const q=Ms(new Date(ze)),Z={streakDays:q.value,streakUnit:q.unit,streakDisplayText:q.displayText};N(Z),_e.streakDays=q.value,_e.streakUnit=q.unit,_e.streakDisplayText=q.displayText}else _e.streakUnit="hours",_e.streakDisplayText="0 hours"}$(ze=>({...ze,..._e}))}},pe=>{pe.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",pe)}),ye=me(H,`users/${t.uid}/profile`),fe=Te(ye,async pe=>{if(O&&pe.exists()){const _e=pe.val(),ze=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(!(ze==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||ze==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")){if(P&&P.addictionLevel!==50){let q={...P};if(_e.quitDate&&_e.quitDate!==t.quitDate){const Z=new Date(_e.quitDate),J=Ms(Z);q.streakDays=J.value,q.streakUnit=J.unit,q.streakDisplayText=J.displayText}else if(_e.lastRelapseDate||_e.relapseDate){const Z=new Date(_e.lastRelapseDate||_e.relapseDate),J=Ms(Z);q.streakDays=J.value,q.streakUnit=J.unit,q.streakDisplayText=J.displayText,N({streakDays:J.value,streakUnit:J.unit,streakDisplayText:J.displayText})}else if(t!=null&&t.finalQuitDate||a!=null&&a.finalQuitDate){const Z=new Date((t==null?void 0:t.finalQuitDate)||(a==null?void 0:a.finalQuitDate)),J=Ms(Z);q.streakDays=J.value,q.streakUnit=J.unit,q.streakDisplayText=J.displayText,N({streakDays:J.value,streakUnit:J.unit,streakDisplayText:J.displayText})}$(Z=>({...Z,...q,...M}))}}}},pe=>{pe.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",pe)});return()=>{ne(),fe()}}catch(me){console.error("Error setting up buddy stats listeners:",me)}})();return()=>{O=!1,ce.then(me=>{me&&typeof me=="function"&&me()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]),D.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;const O=setInterval(()=>{const W=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(!W)return;const ce=Ms(new Date(W));N({streakDays:ce.value,streakUnit:ce.unit,streakDisplayText:ce.displayText}),$(me=>({...me,streakDays:ce.value,streakUnit:ce.unit,streakDisplayText:ce.displayText}))},60*1e3);return()=>clearInterval(O)},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.lastRelapseDate,a==null?void 0:a.originalQuitDate,a==null?void 0:a.lastActivity]);const b=async()=>{if(n){const O=await I(n);R(O)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const O=await I(t);$(W=>(console.log("🔄 Arena: Preserving locally calculated streak during stats calculation:",M),{...W,...O,...M}))}};D.useEffect(()=>{if(!(n!=null&&n.uid))return;const O=setInterval(b,3e4);return()=>clearInterval(O)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),D.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||b())},[t==null?void 0:t.uid]),D.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||b())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),D.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log("🔄 Arena: Loading buddy data for user:",n.uid),l(I,$,N))},[n==null?void 0:n.uid,a,i,u,N]),D.useEffect(()=>{const O=()=>{console.log("🌐 Internet connection restored")},W=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",O),window.addEventListener("offline",W),()=>{window.removeEventListener("online",O),window.removeEventListener("offline",W)}},[]);const C=O=>{if(!O||!O.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const W=O.stats.mentalStrength||50,ce=O.stats.motivation||50,me=O.stats.triggerDefense||30,Te=O.stats.addictionLevel||50;return W*1.5+ce*1+me*1.2-Te*1},v=C({...n,stats:x}),B=C({...t,stats:P}),ge=typeof v=="number"&&!isNaN(v)?v:0,ke=typeof B=="number"&&!isNaN(B)?B:0,_t=ge>ke?"WINNING":ge===ke?"TIED":"LOSING",Y=()=>{if(_t==="WINNING")return null;if(!x||!P)return console.warn("Stats not available for recommendations calculation"),[];const O=ke-ge+1,W=[],ce=(x==null?void 0:x.mentalStrength)||50,me=(x==null?void 0:x.motivation)||50,Te=(x==null?void 0:x.triggerDefense)||30,de=(x==null?void 0:x.addictionLevel)||50,ne=(P==null?void 0:P.mentalStrength)||50,ye=(P==null?void 0:P.motivation)||50;P!=null&&P.triggerDefense;const fe=(P==null?void 0:P.addictionLevel)||50,pe=ne-ce,_e=ye-me,ze=de-fe,q=[{name:"Mental Strength",multiplier:1.5,gap:pe,current:ce,max:100},{name:"Trigger Defense",multiplier:1.2,gap:_e,current:Te,max:100},{name:"Motivation",multiplier:1,gap:_e,current:me,max:100},{name:"Addiction",multiplier:1,gap:ze,current:de,min:0,isReduction:!0}];if(q.sort((Z,J)=>Z.multiplier!==J.multiplier?J.multiplier-Z.multiplier:Math.abs(J.gap)-Math.abs(Z.gap)),q.forEach(Z=>{if(Z.isReduction){const J=Math.min(Z.current-Z.min,50),Ve=J*Z.multiplier;Ve>0&&W.push({stat:Z.name,change:J,action:we(J),priority:Ve,canWin:Ve>=O,isReduction:!0,efficiency:Z.multiplier,gap:Z.gap})}else{const J=Math.min(Z.max-Z.current,50),Ve=J*Z.multiplier;Ve>0&&W.push({stat:Z.name,change:J,action:re(Z.name,J),priority:Ve,canWin:Ve>=O,efficiency:Z.multiplier,gap:Z.gap})}}),W.sort((Z,J)=>J.priority-Z.priority),W.length>0&&!W.some(Z=>Z.canWin)){const Z=Ee(W,O);Z&&W.unshift(Z)}return W.slice(0,3)},we=O=>O>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":O>=20?"Reduce nicotine intake significantly, avoid high-risk situations":O>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",re=(O,W)=>{switch(O){case"Mental Strength":return W>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":W>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return W>=30?"Log progress daily, share achievements weekly":W>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return W>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":W>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},Ee=(O,W)=>{let ce=0;const me=[];for(const Te of O){if(ce>=W)break;const de=W-ce,ne=Math.min(Te.priority,de);ne>0&&(me.push({stat:Te.stat,change:Math.ceil(ne/Te.efficiency),contribution:ne}),ce+=ne)}return me.length>0?{stat:"Combination Strategy",change:Math.ceil(W),action:`Focus on: ${me.map(Te=>`${Te.stat} (+${Te.change})`).join(", ")}`,priority:ce,canWin:ce>=W,isCombination:!0,strategy:me}:null},Oe=Y()||[];return c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:[c.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[c.jsx("div",{className:"text-center mb-6",children:c.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4",children:[c.jsxs("div",{className:`inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 rounded-full font-bold text-sm sm:text-lg shadow-xl ${_t==="WINNING"?"bg-green-600":_t==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[_t==="WINNING"?c.jsx(l2,{className:"w-5 h-5 mr-2"}):_t==="TIED"?c.jsx(Ao,{className:"w-5 h-5 mr-2"}):c.jsx("span",{className:"mr-2",children:"📉"}),"You are ",_t]}),c.jsx("button",{onClick:()=>f(!0),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center shadow-lg",style:{fontSize:"4px"},title:"Battle Algorithm Info",children:c.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"i"})}),c.jsx("button",{onClick:b,className:"touch-interactive ripple-effect w-11 h-11 sm:w-12 sm:h-12 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center shadow-lg min-h-[44px] min-w-[44px]",title:"Refresh Stats",children:c.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"🔄"})}),c.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 p-2 rounded",children:[c.jsxs("div",{children:["User Stats: ",JSON.stringify(x)]}),c.jsxs("div",{children:["Base Stats: ",JSON.stringify(n==null?void 0:n.stats)]})]}),c.jsx("button",{onClick:b,className:"mt-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Refresh Stats"}),c.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy matching test triggered...");try{await autoMatchUsers(),console.log("✅ Manual buddy matching completed")}catch(O){console.error("❌ Manual buddy matching failed:",O)}},className:"mt-2 ml-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔗 Test Matching"}),c.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy reload test triggered...");try{setBuddyLoadAttempted(!1),setRealBuddy(null),await l(I,$,N),console.log("✅ Manual buddy reload completed")}catch(O){console.error("❌ Manual buddy reload failed:",O)}},className:"mt-2 ml-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors min-h-[44px]",children:"👥 Reload Buddy"}),c.jsx("button",{onClick:async()=>{console.log("🧪 Resetting matching system...");try{const O=firestoreBuddyServiceRef.current||firestoreBuddyService;if(O){const{getDocs:W,deleteDoc:ce,doc:me}=await De(()=>import("./index.esm-0076aa24.js"),[]),de=(await W(O.buddyPairsCollection)).docs.map(ze=>ce(me(Us,"buddyPairs",ze.id)));await Promise.all(de);const ye=(await W(O.matchingPoolCollection)).docs.map(ze=>ce(me(Us,"matchingPool",ze.id)));await Promise.all(ye);const{ref:fe,remove:pe}=await De(()=>import("./index.esm-980f89f8.js"),[]),_e=["5uSH8SA6y4eZ7jkoLEZCRJZmTGW2","KB67Yg17rkZmCa8UV1N5xIUWoK12","o4mW4BmLWOOVBybTrYcvGJ4nimA3"];for(const ze of _e)try{await pe(fe(H,`users/${ze}/buddyInfo`))}catch{console.log("Could not remove buddy info for:",ze)}console.log("✅ Matching system reset completed"),setRealBuddy(null),setBuddyLoadAttempted(!1)}}catch(O){console.error("❌ Reset failed:",O)}},className:"mt-2 ml-2 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Reset Matching"})]})}),c.jsxs("div",{className:"battle-cards-container flex flex-col lg:flex-row items-center justify-center gap-4 lg:gap-12 mb-8 w-full",children:[c.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!n||!x)return console.log("🎯 TradingCard: Missing data, not rendering user card"),c.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:c.jsx("div",{className:"animate-pulse",children:"Loading User..."})});const O=w&&Object.keys(w).length>0?{...n.stats,...w}:e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,...x};return c.jsx(JT,{user:{...n,stats:O},showComparison:!1,nemesisUser:t},`user-${n.uid}-${n.lastRelapseRefresh||Date.now()}`)})()}),c.jsxs("div",{className:"vs-section flex flex-row lg:flex-col items-center justify-center space-x-4 lg:space-x-0 space-y-0 lg:space-y-4 flex-shrink-0",children:[c.jsx("div",{className:"vs-icon w-16 h-16 lg:w-24 lg:h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:c.jsx(Sq,{className:"w-8 h-8 lg:w-12 lg:h-12 text-white"})}),c.jsx("div",{className:"bg-red-600 px-4 py-2 lg:px-8 lg:py-3 rounded-full",children:c.jsx("p",{className:"vs-text text-white font-bold text-lg lg:text-2xl",children:"VS"})})]}),c.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!t||!P)return console.log("🎯 TradingCard: Missing data, not rendering nemesis card"),c.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:c.jsx("div",{className:"animate-pulse",children:"Loading Nemesis..."})});const O={...t,stats:{...t.stats,...P}};return M.streakDisplayText&&(O.stats.streakDisplayText=M.streakDisplayText,O.stats.streakDays=M.streakDays,O.stats.streakUnit=M.streakUnit),c.jsx(JT,{user:O,isNemesis:!0,showComparison:!1,nemesisUser:n},`buddy-${t.uid}-${n.lastRelapseRefresh||Date.now()}`)})()})]}),_t==="LOSING"&&Oe&&Oe.length>0&&c.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-4 sm:p-6 border border-slate-700",children:[c.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),c.jsx("div",{className:"space-y-4",children:Oe.slice(0,3).map((O,W)=>c.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3 sm:p-4 border-l-4 border-blue-500",children:c.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("h4",{className:"text-white font-semibold mb-2",children:O.isReduction?c.jsxs(c.Fragment,{children:["🎯 Reduce your ",O.stat," by ",O.change," points!"]}):O.isCombination?c.jsxs(c.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",O.change," total points!"]}):O.isMajor?c.jsxs(c.Fragment,{children:["🎯 Major improvement needed: ",O.change," total points!"]}):c.jsxs(c.Fragment,{children:["🎯 Increase your ",O.stat," by ",O.change," points!"]})}),c.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",O.action]})]}),c.jsxs("div",{className:`font-bold text-xl sm:text-2xl sm:ml-4 ${O.isReduction?"text-green-400":O.isCombination?"text-purple-400":O.isMajor?"text-orange-400":"text-blue-400"}`,children:[O.isReduction?"-":"+",O.change]})]})},W))}),c.jsx("div",{className:"text-center mt-4",children:c.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),h&&c.jsxs("div",{className:"modal-backdrop",children:[c.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>f(!1)}),c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600 p-6",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg text-sm transition-colors min-h-[44px] min-w-[44px]",title:"Share achievement for Motivation bonus",children:"📤 Share"}),c.jsx("button",{onClick:()=>f(!1),className:"modal-close-enhanced text-gray-400 hover:text-white text-2xl w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"×"})]})]}),c.jsxs("div",{className:"space-y-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),c.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),c.jsxs("p",{className:"text-green-400 font-mono",children:["(",x.mentalStrength||50," × 1.5) + (",x.motivation||50," × 1.0) + (",x.triggerDefense||30," × 1.2) - (",x.addictionLevel||50," × 1.0) = ",v.toFixed(1)]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),c.jsxs("p",{className:"text-red-400 font-mono",children:["(",P.mentalStrength||50," × 1.5) + (",P.motivation||50," × 1.0) + (",P.triggerDefense||30," × 1.2) - (",P.addictionLevel||50," × 1.0) = ",B.toFixed(1)]})]}),c.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:c.jsxs("p",{className:"text-gray-300 text-xs",children:[c.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",c.jsx("br",{}),c.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",c.jsx("br",{}),c.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",c.jsx("br",{}),c.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})]})},Kq=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return c.jsxs("div",{className:"modal-backdrop",children:[c.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),c.jsx("div",{className:"modal-container",children:c.jsx("div",{className:"modal-content bg-slate-800 border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:c.jsx("span",{className:"text-3xl",children:i()})}),c.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),c.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),c.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})]})},Yq=({gameType:n,onClose:e})=>{const[t,r]=D.useState(0),{modalRef:s,classes:i}=gS(e,{threshold:100,velocity:.5,enabled:!0}),o=()=>{const l=D.useRef(null),[u,h]=D.useState([{x:12,y:12}]),[f,m]=D.useState({x:1,y:0}),[y,_]=D.useState({x:1,y:0}),[E,k]=D.useState({x:15,y:15}),[I,x]=D.useState(!1),[R,P]=D.useState(0),[$,M]=D.useState(1),N={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},w={1:5,2:5,3:10};return D.useEffect(()=>{const T=A=>{if(I){A.preventDefault(),h([{x:12,y:12}]),m({x:1,y:0}),_({x:1,y:0}),k({x:15,y:15}),x(!1),P(0),M(1);return}switch(A.key){case"ArrowUp":A.preventDefault(),f.y!==1&&_({x:0,y:-1});break;case"ArrowDown":A.preventDefault(),f.y!==-1&&_({x:0,y:1});break;case"ArrowLeft":A.preventDefault(),f.x!==1&&_({x:-1,y:0});break;case"ArrowRight":A.preventDefault(),f.x!==-1&&_({x:1,y:0});break}};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[f,I]),D.useEffect(()=>{if(I)return;const T=setInterval(()=>{h(A=>{const b={x:A[0].x+f.x,y:A[0].y+f.y};if(b.x<0&&(b.x=24),b.x>=25&&(b.x=0),b.y<0&&(b.y=24),b.y>=25&&(b.y=0),A.slice(0,-1).some(ge=>ge.x===b.x&&ge.y===b.y))return x(!0),A;const v=b.x===E.x&&b.y===E.y;let B;return v?(P(ge=>ge+w[$]),k({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),B=[b,...A]):B=[b,...A.slice(0,-1)],(y.x!==f.x||y.y!==f.y)&&setTimeout(()=>{m(y)},0),B})},N[$]);return()=>clearInterval(T)},[f,y,E,I]),D.useEffect(()=>{const T=l.current;if(!T)return;const A=T.getContext("2d"),b=15,C=25;A.fillStyle="#1f2937",A.fillRect(0,0,375,375),A.strokeStyle="#374151",A.lineWidth=1;for(let v=0;v<=C;v++)A.beginPath(),A.moveTo(v*b,0),A.lineTo(v*b,375),A.stroke(),A.beginPath(),A.moveTo(0,v*b),A.lineTo(375,v*b),A.stroke();u.forEach((v,B)=>{B===0?A.fillStyle="#fbbf24":A.fillStyle="#10b981",A.fillRect(v.x*b+1,v.y*b+1,b-2,b-2)}),A.fillStyle="#ef4444",A.fillRect(E.x*b+2,E.y*b+2,b-4,b-4)},[u,E]),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"mb-4",children:c.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[c.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(T=>c.jsxs("button",{onClick:()=>M(T),className:`
                  px-4 py-3 text-sm font-mono border-2 border-green-500 transition-all min-h-[44px]
                  ${$===T?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[c.jsxs("div",{children:["Level ",T]}),c.jsxs("div",{className:"text-xs mt-1",children:[T===1&&"Normal",T===2&&"Fast",T===3&&"Insane"]})]},T))]})}),c.jsx("canvas",{ref:l,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),c.jsxs("div",{className:"mt-4",children:[c.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",R," | Level: ",$]}),I&&c.jsxs("div",{className:"mt-2",children:[c.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),c.jsx("button",{onClick:()=>{h([{x:12,y:12}]),m({x:1,y:0}),_({x:1,y:0}),k({x:15,y:15}),x(!1),P(0),M(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Restart Game"})]})]})]})},a=()=>{try{return n==="snake"?c.jsx(o,{}):c.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(l){return console.error("Error rendering game:",l),c.jsxs("div",{className:"text-center text-red-600",children:[c.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),c.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),c.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Reload Game"})]})}};return c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{ref:s,className:`modal-content bg-white max-w-4xl ${i}`,role:"dialog","aria-modal":"true","aria-labelledby":"game-modal-title",children:[c.jsx("div",{className:"modal-swipe-indicator"}),c.jsxs("div",{className:"modal-scrollable",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4 p-4",children:[c.jsx("h3",{id:"game-modal-title",className:"text-xl font-bold text-gray-800",children:"🐍 Snake Game"}),c.jsx("button",{onClick:e,className:"modal-close-button","aria-label":"Close game modal",children:"×"})]}),c.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center relative mx-4",children:a()}),c.jsxs("div",{className:"p-4",children:[c.jsx("div",{className:"flex justify-center items-center gap-4 mb-4",children:c.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:["Score: ",t]})}),c.jsx("div",{className:"modal-actions",children:c.jsx("button",{onClick:e,className:"modal-button modal-button-primary",children:"Close Game"})})]})]})]})})})},Jq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,l]=D.useState(!1),[u,h]=D.useState(null),[f,m]=D.useState(!1),[y,_]=D.useState({title:"",message:"",type:"info"}),[E,k]=D.useState(null),[I,x]=D.useState(!1),[R,P]=D.useState(0),[$,M]=D.useState(!1),[N,w]=D.useState(!1),[T,A]=D.useState(1),[b,C]=D.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[v,B]=D.useState({resisted:0,relapses:0}),[ge,ke]=D.useState(0),[_t,Y]=D.useState(!1),[we,re]=D.useState(""),Ee=(q,Z,J="info")=>{console.log("🔄 showQuickActionPopup called:",{title:q,message:Z,type:J}),_({title:q,message:Z,type:J}),m(!0),console.log("✅ showQuickActionPopup: Popup data set and showCustomPopup set to true")};$2.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=Ee),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),D.useEffect(()=>n!=null&&n.uid?(P(0),(async()=>{try{const Pe=new Yg(H,n.uid);await Pe.initialize(),k(Pe)}catch(Pe){console.error("Error initializing StatManager:",Pe)}})(),(async()=>{try{const Pe=new Date().toDateString(),{ref:Ae,get:Rt}=await De(()=>import("./index.esm-980f89f8.js"),[]);try{const Gt=Ae(H,`users/${n.uid}/profile/dailyCravingLogs/${Pe}`),Nt=await Rt(Gt);if(Nt.exists()){const vt=Nt.val();ke(vt.count||0)}else ke(0)}catch{const Nt=`cravingLogs_${n.uid}_${Pe}`,vt=localStorage.getItem(Nt);if(vt){const kt=JSON.parse(vt);ke(kt.count||0)}else ke(0)}}catch(Pe){console.error("Error loading daily craving logs:",Pe),ke(0)}})(),(async()=>{try{const{ref:Pe,get:Ae,onValue:Rt,query:Gt,orderByChild:Nt,startAt:vt,endAt:kt,set:mt}=await De(()=>import("./index.esm-980f89f8.js"),[]),Re=new Date,Je=new Date(Re.getTime()-7*24*60*60*1e3),wn=Je.toDateString(),an=Re.toDateString();try{const ut=Pe(H,`users/${n.uid}/profile/cravingStats`),Sn=await Ae(ut);if(Sn.exists()){const Pr=Sn.val();if(Pr.lastUpdated&&new Date(Pr.lastUpdated)>Je){B(Pr);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:Pn,get:cr,query:ln,orderByChild:kr,startAt:It,endAt:cn}=await De(()=>import("./index.esm-980f89f8.js"),[]),mn=Pn(H,`users/${n.uid}/cravings`),xn=ln(mn,kr("date"),It(wn),cn(an));try{const ut=await cr(xn);let Sn=0,Pr=0;if(console.log(`🔍 Weekly Stats: Checking cravings for ${wn} to ${an}`),console.log(`🔍 Weekly Stats: Cravings snapshot exists: ${ut.exists()}`),ut.exists()){const dr=ut.val();console.log("🔍 Weekly Stats: Raw cravings data:",dr),ut.forEach(Xo=>{const ds=Xo.val();console.log("🔍 Weekly Stats: Individual craving:",ds),ds.outcome==="resisted"?Sn++:ds.outcome==="relapsed"&&Pr++})}console.log(`🔍 Weekly Stats: Calculated - resisted: ${Sn}, relapses: ${Pr}`);const ks={resisted:Sn,relapses:Pr,lastUpdated:Re.toISOString()};B(ks);try{const dr=Pe(H,`users/${n.uid}/profile/cravingStats`);await mt(dr,ks)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(ks))}catch{console.log("Could not query cravings, using localStorage fallback");const Sn=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');B(Sn)}const ur=Pe(H,`users/${n.uid}/profile/cravingStats`);return Rt(ur,ut=>{ut.exists()&&B(ut.val())})}catch(Pe){console.error("Error loading weekly stats:",Pe);const Ae=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');B(Ae)}})(),(async()=>{try{const{ref:Pe,get:Ae,onValue:Rt}=await De(()=>import("./index.esm-980f89f8.js"),[]),Gt=new Date().toDateString(),Nt=Pe(H,`users/${n.uid}/profile/daily/${Gt}/water`),vt=await Ae(Nt);if(vt.exists())P(vt.val()||0);else{const mt=parseInt(localStorage.getItem(`water_${n.uid}_${Gt}`)||0);P(mt)}return Rt(Nt,mt=>{mt.exists()&&P(mt.val()||0)})}catch(Pe){console.error("Error loading daily water from Firebase:",Pe);const Ae=new Date().toDateString(),Rt=parseInt(localStorage.getItem(`water_${n.uid}_${Ae}`)||0);P(Rt)}})(),()=>{P(0),x(!1),B({resisted:0,relapses:0}),w(!1),A(1),C({strength:5,mood:"",context:"",outcome:""}),ke(0),Y(!1),re("")}):void 0,[n==null?void 0:n.uid]);const Oe=()=>{h("snake"),l(!0)},O=()=>{h(null),l(!1)},W=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const q=Math.min(R+1,6);P(q);const Z=new Date().toDateString();if(E){if(await E.handleHydrationUpdate(q),o)try{const Ae=await E.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:q,targetGlasses:6,currentStreak:Ae}),console.log("✅ Hydration also logged to Firestore for analytics")}catch(Ae){console.warn("⚠️ Could not log hydration to Firestore:",Ae.message),await de("hydration",{glassesConsumed:q,targetGlasses:6,currentStreak:await E.checkHydrationStreak()})}else await de("hydration",{glassesConsumed:q,targetGlasses:6,currentStreak:await E.checkHydrationStreak()});q===6&&R===5&&await E.checkHydrationStreak()>=3&&(await E.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:J,set:Ve}=await De(()=>import("./index.esm-980f89f8.js"),[]),Pe=J(H,`users/${n.uid}/profile/daily/${Z}/water`);await Ve(Pe,q),localStorage.setItem(`water_${n.uid}_${Z}`,q.toString()),console.log("Water intake updated:",q)}catch(q){console.error("Error updating water intake:",q);const Z=Math.min(R+1,6);P(Z);const J=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${J}`,Z.toString())}},ce=()=>{C({strength:5,mood:"",context:"",outcome:""}),A(1),w(!0)},me=()=>{T<4&&A(T+1)},Te=()=>{T>1&&A(T-1)},de=async(q,Z)=>{if(!window.offlineManager||!(authUser!=null&&authUser.uid))return!1;const J={...Z,userId:authUser.uid,timestamp:Date.now()};return await window.offlineManager.handleOfflineBehavioralLog(q,J)},ne=async q=>{let Z,J,Ve;try{Ve=new Date().toISOString();const Pe=new Date().toDateString(),Ae=new Date;Z={...b,outcome:q,timestamp:Ve,date:Pe,timeOfDay:Ae.getHours()<12?"morning":Ae.getHours()<17?"afternoon":"evening",dayOfWeek:Ae.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((Ae.getDate()+new Date(Ae.getFullYear(),0,1).getDay())/7),month:Ae.toLocaleDateString("en-US",{month:"long"}),year:Ae.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:q==="resisted",relapsed:q==="relapsed",logged:q==="logged",usedPractices:q==="resistance_practices"}};const Rt=new Date().toDateString(),Gt=ge+1;ke(Gt),J={resisted:v.resisted,relapses:v.relapses,lastUpdated:Ve};let Nt=!1;if(Gt<=2&&E)try{const xn=await E.handleCravingLogged();xn&&xn.applied&&(Nt=!0,console.log("✅ Awareness bonus awarded for craving tracking"))}catch(xn){console.warn("⚠️ Could not award awareness bonus:",xn)}if(q==="resisted"){if(J.resisted=v.resisted+1,E){console.log("🔄 Detailed Craving: Calling StatManager.handleCravingResistance()...");const xn=await E.handleCravingResistance();console.log("🔄 Detailed Craving: StatManager.handleCravingResistance() result:",xn)}window.centralizedStatService&&(console.log("🔄 Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleCravingResisted(),console.log("✅ Detailed Craving: Stats updated via CentralizedStatService"))}else if(q==="relapsed"){if(J.relapses=v.relapses+1,E){console.log("🔄 Detailed Craving: Calling StatManager.handleRelapse()...");const xn=await E.handleRelapse();console.log("🔄 Detailed Craving: StatManager.handleRelapse() result:",xn)}window.centralizedStatService&&(console.log("🔄 Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Detailed Craving: Stats updated via CentralizedStatService"))}const{ref:vt,set:kt,push:mt,get:Re}=await De(()=>import("./index.esm-980f89f8.js"),[]),Je=vt(H,`users/${n.uid}/profile/cravingStats`);await kt(Je,J);const wn=vt(H,`users/${n.uid}/cravings`),an=mt(wn);if(await kt(an,Z),o)try{await o.logCraving(n.uid,{outcome:q,strength:b.strength,duration:b.duration,context:"detailed_assessment",triggers:b.triggers||[],mood:b.mood,stressLevel:b.stressLevel,copingStrategiesUsed:b.copingStrategies||[],location:b.location,socialSituation:b.socialSituation}),console.log("✅ Craving also logged to Firestore for analytics")}catch(xn){console.warn("⚠️ Could not log craving to Firestore:",xn.message),de&&await de("craving",{outcome:q,strength:b.strength,duration:b.duration,context:"detailed_assessment",triggers:b.triggers||[],mood:b.mood,stressLevel:b.stressLevel,copingStrategiesUsed:b.copingStrategies||[],location:b.location,socialSituation:b.socialSituation})}const Pn=vt(H,`users/${n.uid}/profile/cravingHistory/${Rt}`),cr=await Re(Pn);let ln=cr.exists()?cr.val():[];ln.push({...Z,id:an.key,timestamp:Ve}),ln.length>30&&(ln=ln.slice(-30)),await kt(Pn,ln),console.log(`📅 Daily history updated for ${Rt}:`,ln.length,"records");const kr=Ae.toISOString().substring(0,7),It=vt(H,`users/${n.uid}/profile/cravingTrends/${kr}`),cn=await Re(It);let mn=cn.exists()?cn.val():[];mn.push({...Z,id:an.key,timestamp:Ve}),mn.length>365&&(mn=mn.slice(-365)),await kt(It,mn),console.log(`📊 Monthly trends updated for ${kr}:`,mn.length,"records"),B(J),_(q==="resisted"?{title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}:q==="relapsed"?{title:"🌟 New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your awareness and tracking skills are improving with each experience. Keep going!`,type:"success"}:{title:"📝 Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"}),m(!0),w(!1),A(1)}catch(Pe){if(console.error("Error saving craving assessment:",Pe),Z){const Ae=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Ae.push(Z),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Ae))}if(J){const Ae=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');Ae.resisted=J.resisted,Ae.relapses=J.relapses,Ae.lastUpdated=Ve,localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Ae))}_(q==="resisted"?{title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:q==="relapsed"?{title:"🌟 New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:{title:"📝 Progress Recorded",message:"Your progress has been recorded locally and will sync when the connection is restored.",type:"info"}),m(!0),w(!1),A(1)}},ye=async()=>{try{const q=new Date().toISOString(),Z=new Date().toDateString();let J=null;const{ref:Ve,set:Pe,push:Ae,get:Rt}=await De(()=>import("./index.esm-980f89f8.js"),[]);if(n&&n.uid){const vt=Ve(H,`users/${n.uid}/cravings`),kt=Ae(vt);await Pe(kt,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:q,date:Z});const mt=Ve(H,`users/${n.uid}/profile/cravingStats`),Re={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:q};if(await Pe(mt,Re),B(Re),window.centralizedStatService){console.log("🔄 Quick Resistance: Using CentralizedStatService...");const Je=await window.centralizedStatService.getCurrentStats(),wn=(Je==null?void 0:Je.mentalStrengthCravingsApplied)||0;console.log("🔄 Quick Resistance: Current mental strength bonus before processing:",wn);const an=await window.centralizedStatService.handleCravingResisted();if(console.log("✅ Quick Resistance: Stats updated via CentralizedStatService"),an&&an.applied){const Pn=an.cravingsApplied||0,cr=Math.max(0,3-Pn);console.log("🔄 Quick Resistance: Bonus applied, remaining:",cr),cr>0?Ee("Craving Resisted! 💪",`Great job! You earned +1 mental strength point. You can still earn ${cr} more today.`,"success"):Ee("Craving Resisted! 💪","Excellent! You've reached the daily maximum of 3 mental strength points from craving resistance.","success")}else console.log("🔄 Quick Resistance: Daily limit reached, showing limit message"),Ee("Daily Mental Strength Limit Reached","You've already earned the maximum 3 mental strength points from craving resistance today. Keep up the great work! Your resistance still counts for your overall progress.","info");typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Resistance: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Resistance: Secondary Arena stats refresh..."),window.refreshArenaStats()},1e3));return}else E&&(J=await E.checkDailyCravingResistanceLimits(Z),await E.handleCravingResistance())}const Gt=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Gt.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:q,date:Z}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Gt));const Nt={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:q};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Nt)),B(Nt),J?!J.canAwardMentalStrength&&!J.canAwardTriggerDefense?_({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):J.canAwardMentalStrength?J.canAwardTriggerDefense?_({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):_({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):_({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):_({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),m(!0)}catch(q){console.error("Error recording quick resistance:",q),_({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),m(!0)}},fe=async()=>{try{const q=new Date().toISOString(),Z=new Date().toDateString();if(n&&n.uid){const{ref:Pe,set:Ae,push:Rt}=await De(()=>import("./index.esm-980f89f8.js"),[]),Gt=Pe(H,`users/${n.uid}/cravings`),Nt=Rt(Gt);if(await Ae(Nt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:q,date:Z}),window.centralizedStatService)console.log("🔄 Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Quick Relapse: Stats updated via CentralizedStatService"),Ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! 💪`,"warning");else if(E){console.log("🔄 Quick Relapse: Calling StatManager.handleRelapse()...");const mt=await E.handleRelapse();if(console.log("🔄 Quick Relapse: StatManager.handleRelapse() result:",mt),o)try{const Re=await E.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:Re,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:Re===1?4:Re===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Quick relapse also logged to Firestore for analytics")}catch(Re){console.warn("⚠️ Could not log quick relapse to Firestore:",Re.message),await de("relapse",{escalationLevel:await E.getCurrentEscalationLevel(),triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}try{await new Promise(an=>setTimeout(an,100));const{ref:Re,get:Je}=await De(()=>import("./index.esm-980f89f8.js"),[]),wn=await Je(Re(H,`users/${n.uid}/stats`));if(wn.exists()){const an=wn.val();console.log("🔍 Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",an)}else console.log("❌ Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(Re){console.error("❌ Quick Relapse: VERIFICATION failed:",Re)}try{const Re=await E.getCurrentEscalationLevel();let Je=0;switch(Re){case 1:Je=4;break;case 2:Je=6;break;default:Je=8;break}Ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

📊 Stat Changes:
• Addiction: +${Je} points
• Mental Strength: -3 points
• Trigger Defense: -3 points

Your journey continues! 💪`,"warning")}catch(Re){console.warn("Could not get escalation level for message:",Re),Ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! 💪`,"warning")}}else console.error("❌ Quick Relapse: StatManager not available!"),Ee("⚠️ Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const vt=Pe(H,`users/${n.uid}/profile/cravingStats`),kt={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:q};await Ae(vt,kt),B(kt),console.log("🔄 Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log("ℹ️ Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)"),typeof window.refreshArenaStats=="function"?(console.log("🔄 Quick Relapse: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3)):console.warn("⚠️ Quick Relapse: window.refreshArenaStats not available"),console.log("🔄 Quick Relapse: Triggering immediate PWA refresh..."),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Relapse: Immediate Arena stats refresh..."),window.refreshArenaStats()),typeof setUser=="function"&&setUser(mt=>({...mt,lastRelapseRefresh:Date.now()})),setStatsUpdateTrigger(mt=>mt+1),window.centralizedStatService&&window.centralizedStatService.getCurrentStats().then(mt=>{console.log("🔄 Quick Relapse: Fetched latest stats after relapse:",mt),typeof window.setLatestUserStats=="function"&&window.setLatestUserStats(mt)}).catch(mt=>{console.error("❌ Quick Relapse: Failed to fetch latest stats:",mt)}),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats(),window.dispatchEvent(new Event("resize"))},100),setTimeout(()=>{console.log("🔄 Quick Relapse: Tertiary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats()},500)}const J=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");J.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:q,date:Z}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(J));const Ve={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:q};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Ve)),B(Ve)}catch(q){console.error("Error recording quick relapse:",q),Ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! 💪`,"warning")}},pe=async(q,Z=30)=>{try{if(!q)return null;const{ref:J,get:Ve,query:Pe,orderByChild:Ae,startAt:Rt,endAt:Gt}=await De(()=>import("./index.esm-980f89f8.js"),[]),Nt=new Date,vt=new Date(Nt.getTime()-Z*24*60*60*1e3),kt=J(H,`users/${q}/cravings`),mt=await Ve(kt);if(!mt.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const Je=Object.values(mt.val()||{}).filter(dt=>{const ut=new Date(dt.timestamp);return ut>=vt&&ut<=Nt});if(Je.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const wn=Je.filter(dt=>dt.outcome==="resisted").length,an=Je.filter(dt=>dt.outcome==="relapsed").length,Pn=Je.length,cr=Je.reduce((dt,ut)=>dt+(ut.strength||0),0)/Pn,ln={},kr={},It={},cn={};Je.forEach(dt=>{dt.mood&&(ln[dt.mood]=(ln[dt.mood]||0)+1),dt.context&&(kr[dt.context]=(kr[dt.context]||0)+1),dt.timeOfDay&&(It[dt.timeOfDay]=(It[dt.timeOfDay]||0)+1);const ut=new Date(dt.timestamp),Sn=`${ut.getFullYear()}-W${Math.ceil((ut.getDate()+new Date(ut.getFullYear(),0,1).getDay())/7)}`;cn[Sn]=(cn[Sn]||0)+1});const mn=Object.entries(ln).sort(([,dt],[,ut])=>ut-dt).slice(0,3).map(([dt,ut])=>({mood:dt,count:ut})),xn=Object.entries(kr).sort(([,dt],[,ut])=>ut-dt).slice(0,3).map(([dt,ut])=>({context:dt,count:ut})),ur=[];return wn>an&&ur.push("You're successfully resisting more cravings than giving in - great job!"),cr>7&&ur.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),It.afternoon>It.morning&&It.afternoon>It.evening&&ur.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),mn.length>0&&mn[0].count>Pn*.4&&ur.push(`You often experience cravings when feeling ${mn[0].mood}. This might be a key trigger to address.`),{totalCravings:Pn,resistedCount:wn,relapseCount:an,averageStrength:Math.round(cr*10)/10,successRate:Pn>0?Math.round(wn/Pn*100):0,commonMoods:mn,commonContexts:xn,timeOfDayPatterns:It,weeklyTrends:cn,insights:ur,dateRange:{start:vt.toDateString(),end:Nt.toDateString(),days:Z}}}catch(J){return console.error("Error getting craving insights:",J),null}},_e=async(q,Z="json")=>{try{if(!q)return null;const{ref:J,get:Ve}=await De(()=>import("./index.esm-980f89f8.js"),[]),Pe=J(H,`users/${n.uid}/cravings`),Ae=await Ve(Pe);if(!Ae.exists())return console.log("No craving data to export"),null;const Rt=Object.values(Ae.val()||{});if(Z==="json"){const Gt=JSON.stringify(Rt,null,2),Nt=new Blob([Gt],{type:"application/json"}),vt=URL.createObjectURL(Nt),kt=document.createElement("a");return kt.href=vt,kt.download=`craving-data-${q}-${new Date().toISOString().split("T")[0]}.json`,kt.click(),URL.revokeObjectURL(vt),console.log(`Exported ${Rt.length} craving records for user ${q}`),Rt.length}return Rt.length}catch(J){return console.error("Error exporting craving data:",J),null}},ze=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log("🧪 Testing craving insights...");const q=await pe(n.uid,30);q?(console.log("📊 Craving Insights:",q),_({title:"📊 Your Craving Insights",message:`Last 30 days:

Total cravings: ${q.totalCravings}
Successfully resisted: ${q.resistedCount}
Relapses: ${q.relapseCount}
Success rate: ${q.successRate}%
Average intensity: ${q.averageStrength}/10

Top mood triggers: ${q.commonMoods.map(Z=>`${Z.mood} (${Z.count})`).join(", ")}
Top contexts: ${q.commonContexts.map(Z=>`${Z.context} (${Z.count})`).join(", ")}

Insights:
${q.insights.join(`
`)}`,type:"info"}),m(!0)):(console.log("No insights available"),_({title:"📊 No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),m(!0))};return c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:c.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[c.jsx("div",{className:"mb-8",children:c.jsxs("div",{className:"flex justify-start gap-3",children:[c.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),c.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[c.jsx("div",{className:"mb-8",children:c.jsx("button",{onClick:ce,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:c.jsxs("div",{className:"flex items-center justify-center gap-3",children:[c.jsx("span",{className:"text-xl",children:"⚠️"}),c.jsx("span",{children:"I feel like vaping"})]})})}),c.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[c.jsx("button",{onClick:ye,className:"btn-success touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:c.jsxs("div",{className:"flex items-center justify-center gap-2",children:[c.jsx("span",{className:"text-green-400",children:"✅"}),c.jsx("span",{children:"I resisted craving"})]})}),c.jsx("button",{onClick:fe,className:"btn-danger touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:c.jsxs("div",{className:"flex items-center justify-center gap-2",children:[c.jsx("span",{className:"text-red-400",children:"❌"}),c.jsx("span",{children:"I relapsed"})]})})]})]}),c.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[c.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"📊 This Week"}),c.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[c.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[c.jsx("div",{className:"text-2xl mb-3 text-green-400",children:"🎯"}),c.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.resisted}),c.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),c.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[c.jsx("div",{className:"text-2xl mb-3 text-red-400",children:"💔"}),c.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.relapses}),c.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),c.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"🎮 Distract Yourself"}),c.jsx("div",{className:"flex justify-center",children:c.jsx("button",{onClick:Oe,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🐍 Play Snake"})})]})}),c.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"📊 Data Analysis"}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsx("button",{onClick:ze,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg min-h-[44px]",children:"🔍 View Insights"}),c.jsx("button",{onClick:()=>_e(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg min-h-[44px]",children:"📥 Export Data"})]})]})}),c.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[c.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"⚡ Quick Actions"}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsx("button",{onClick:()=>x(!0),className:"btn-primary touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"💧 Hydration"}),c.jsx("button",{onClick:()=>M(!0),className:"breathing-button touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🫁 Breathe"}),c.jsx("button",{onClick:async()=>{if(Ee("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log("✅ Physical activity (walk) logged to Firestore for analytics")}catch(q){console.warn("⚠️ Could not log physical activity to Firestore:",q.message),await de("walk",{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"})}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🚶‍♂️ Walk"}),c.jsx("button",{onClick:async()=>{if(Ee("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log("✅ Meditation (quick) logged to Firestore for analytics")}catch(q){console.warn("⚠️ Could not log meditation to Firestore:",q.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🧘‍♀️ Meditate"})]})]}),a&&u&&c.jsx(Yq,{gameType:u,onClose:O}),c.jsx(Kq,{isOpen:f,onClose:()=>m(!1),title:y.title,message:y.message,type:y.type}),I&&c.jsx(Zq,{isOpen:I,onClose:()=>x(!1),onLogWater:W,currentWater:R,userId:n.uid}),$&&c.jsx($q,{isOpen:$,onClose:()=>M(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),N&&c.jsx(Xq,{isOpen:N,onClose:()=>w(!1),step:T,cravingData:b,setCravingData:C,onNext:me,onPrev:Te,onComplete:ne,dailyCravingLogs:ge})]})})},Xq=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:l})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"😰",label:"Stressed"},{id:"lonely",icon:"😔",label:"Lonely"},{id:"happy",icon:"😊",label:"Happy"},{id:"bored",icon:"😐",label:"Bored"},{id:"excited",icon:"🤩",label:"Excited"},{id:"down",icon:"😞",label:"Down"},{id:"angry",icon:"😠",label:"Angry"},{id:"anxious",icon:"😰",label:"Anxious"}],f=[{id:"break",icon:"☕",label:"I'm taking a break"},{id:"partying",icon:"🎉",label:"I'm partying"},{id:"drinking",icon:"🍺",label:"I'm drinking alcohol"},{id:"car",icon:"🚗",label:"I'm in a car"},{id:"coffee",icon:"☕",label:"I'm drinking coffee"},{id:"eating",icon:"🍽️",label:"I've just finished eating"},{id:"intimate",icon:"💕",label:"I've made love"},{id:"tv",icon:"📺",label:"I'm watching TV"},{id:"wake",icon:"🌅",label:"I've just woken up"}],m=()=>{switch(t){case 1:return c.jsx("div",{className:"text-center",children:c.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),c.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),c.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:_=>s({...r,strength:parseInt(_.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`,autoComplete:"off"}),c.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[c.jsx("span",{children:"Not at all"}),c.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return c.jsx("div",{className:"text-center",children:c.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>c.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[c.jsx("div",{className:"text-3xl mb-2",children:y.icon}),c.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return c.jsx("div",{className:"text-center",children:c.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>c.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[c.jsx("div",{className:"text-2xl mb-2",children:y.icon}),c.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return c.jsx("div",{className:"text-center",children:c.jsxs("div",{className:"space-y-4",children:[c.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💪 I successfully resisted"}),c.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🛡️ Use resistance practices"}),c.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"📝 Just log this craving"}),c.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💔 I had a relapse"})]})});default:return null}};return n?c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 border-slate-600/50 relative overflow-hidden max-w-lg",children:[c.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),c.jsxs("div",{className:"relative z-10",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>c.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),c.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),c.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",l,"/2"]})]}),c.jsx("div",{className:"mb-8",children:m()}),c.jsxs("div",{className:"flex justify-between",children:[t>1&&c.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:"← Back"}),t<4&&c.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next →"})]}),c.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:"×"})]})]})})}):null},Zq=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=D.useState(0),[a,l]=D.useState(0),[u,h]=D.useState(!1);D.useState(!1),D.useEffect(()=>{n&&s&&f()},[n,s,r]);const f=async()=>{try{const{ref:k,get:I}=await De(()=>import("./index.esm-980f89f8.js"),[]),x=await m();o(x);const R=await y();l(R)}catch(k){console.error("Error loading hydration data:",k)}},m=async()=>{try{const{ref:k,get:I}=await De(()=>import("./index.esm-980f89f8.js"),[]);let x=0;for(let R=0;R<7;R++){const P=new Date;P.setDate(P.getDate()-R);const $=P.toDateString(),M=await I(k(H,`users/${s}/profile/daily/${$}/water`));if(M.exists()&&M.val()>0)x++;else break}return x}catch(k){return console.error("Error checking hydration streak:",k),0}},y=async()=>{try{const{ref:k,get:I}=await De(()=>import("./index.esm-980f89f8.js"),[]);let x=0;for(let R=0;R<7;R++){const P=new Date;P.setDate(P.getDate()-R);const $=P.toDateString(),M=await I(k(H,`users/${s}/profile/daily/${$}/water`));M.exists()&&M.val()>=6&&x++}return Math.min(x,3)}catch(k){return console.error("Error checking mental strength progress:",k),0}},_=()=>c.jsx("div",{className:"glasses-visual",children:[...Array(6)].map((k,I)=>{const x=I<r;return c.jsx("div",{className:`glass ${x?"filled":""}`},I)})}),E=async()=>{!s||u||r>=6||(h(!0),t(),setTimeout(async()=>{h(!1),await f()},1e3))};return!n||!s?null:c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsx("div",{className:"modal-content",children:c.jsxs("div",{className:"hydration-module",children:[c.jsxs("div",{className:"module-header",children:[c.jsxs("div",{className:"module-title",children:[c.jsx("div",{className:"water-icon",children:"💧"}),"Hydration Tracker"]}),c.jsx("p",{className:"subtitle",children:"Stay hydrated, stay strong"})]}),c.jsxs("div",{className:"progress-container",children:[c.jsxs("div",{className:"progress-header",children:[c.jsx("span",{className:"progress-text",children:"Today's Progress"}),c.jsxs("span",{className:"progress-fraction",children:[r,"/6"]})]}),_(),c.jsx("div",{className:"progress-bar",children:c.jsx("div",{className:"progress-fill",style:{width:`${r/6*100}%`}})}),c.jsxs("div",{className:"progress-percentage",children:[Math.round(r/6*100),"% Complete"]})]}),c.jsxs("div",{className:"streak-section",children:[c.jsxs("div",{className:"streak-card",children:[c.jsx("span",{className:"streak-icon",children:"🔥"}),c.jsx("div",{className:"streak-label",children:"Hydration Streak"}),c.jsxs("div",{className:"streak-value",children:[i," days"]})]}),c.jsxs("div",{className:"streak-card",children:[c.jsx("span",{className:"streak-icon",children:"💪"}),c.jsx("div",{className:"streak-label",children:"Mental Strength"}),c.jsxs("div",{className:"streak-value",children:[a,"/3"]})]})]}),r===6&&c.jsx("div",{className:"completion-message",children:"🎉 Congratulations! You've completed your daily hydration goal!"}),c.jsx("button",{onClick:E,disabled:r>=6||u,className:"log-button",children:r>=6?"🎉 Goal Complete!":u?"💧 Logging...":"💧 Log Water"}),c.jsx("button",{onClick:e,className:"done-button",children:"Done"})]})})})})},e8=({user:n,onNavigate:e})=>{const[t,r]=D.useState(null),[s,i]=D.useState(!1),[o,a]=D.useState(!1),[l,u]=D.useState(!1),[h,f]=D.useState(!1),[m,y]=D.useState(null),[_,E]=D.useState(0),[k,I]=D.useState(null),[x,R]=D.useState(!1),[P,$]=D.useState([]),[M,N]=D.useState(null);D.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const fe=new Yg(H,n.uid);await fe.initialize(),N(fe)}catch(fe){console.error("Error initializing StatManager:",fe)}})();const ne=async()=>{try{const{ref:fe,get:pe,onValue:_e}=await De(()=>import("./index.esm-980f89f8.js"),[]),ze=fe(H,`users/${n.uid}/profile/relapseDate`),q=await pe(ze);q.exists()&&r(new Date(q.val()));const Z=fe(H,`users/${n.uid}/profile/scheduledTriggers`),J=await pe(Z);J.exists()&&$(J.val());const Ve=new Date().toDateString(),Pe=fe(H,`users/${n.uid}/profile/daily/${Ve}/water`),Ae=_e(Pe,Re=>{Re.exists()&&E(Re.val()||0)}),Rt=fe(H,`users/${n.uid}/profile/daily/${Ve}/mood`),Gt=_e(Rt,Re=>{Re.exists()&&I(Re.val())}),Nt=fe(H,`users/${n.uid}/profile/daily/${Ve}/breathing`),vt=_e(Nt,Re=>{Re.exists()&&R(Re.val()||!1)}),kt=fe(H,`users/${n.uid}/profile/scheduledTriggers`),mt=_e(kt,Re=>{Re.exists()&&$(Re.val()||[])});return()=>{Ae(),Gt(),vt(),mt()}}catch(fe){console.error("Error loading profile data from Firebase:",fe),ye()}},ye=()=>{const fe=localStorage.getItem("quitCoachRelapseDate");fe&&r(new Date(fe));const pe=new Date().toDateString(),_e=localStorage.getItem(`water_${n.uid}_${pe}`),ze=localStorage.getItem(`mood_${n.uid}_${pe}`),q=localStorage.getItem(`breathing_${n.uid}_${pe}`);_e&&E(parseInt(_e)),ze&&I(JSON.parse(ze)),q&&R(q==="true");const Z=localStorage.getItem("scheduledTriggers");Z&&$(JSON.parse(Z))};ne()},[n==null?void 0:n.uid]),D.useEffect(()=>{M&&M.trackLoggingActivity()},[M]),D.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:ne,get:ye,set:fe}=await De(()=>import("./index.esm-980f89f8.js"),[]),pe=ne(H,`users/${n.uid}/profile`),_e=await ye(pe);if(!_e.exists()||Object.keys(_e.val()).length===0){console.log("Migrating localStorage data to Firebase...");const ze=localStorage.getItem("quitCoachRelapseDate");ze&&(await fe(ne(H,`users/${n.uid}/profile/relapseDate`),ze),r(new Date(ze)));const q=parseInt(localStorage.getItem("cravingWins")||0);q>0&&await fe(ne(H,`users/${n.uid}/profile/cravingsResisted`),q);for(let J=0;J<7;J++){const Ve=new Date;Ve.setDate(Ve.getDate()-J);const Pe=Ve.toDateString(),Ae=localStorage.getItem(`water_${n.uid}_${Pe}`);Ae&&await fe(ne(H,`users/${n.uid}/profile/daily/${Pe}/water`),parseInt(Ae))}for(let J=0;J<7;J++){const Ve=new Date;Ve.setDate(Ve.getDate()-J);const Pe=Ve.toDateString(),Ae=localStorage.getItem(`mood_${n.uid}_${Pe}`);Ae&&await fe(ne(H,`users/${n.uid}/profile/daily/${Pe}/mood`),JSON.parse(Ae))}for(let J=0;J<7;J++){const Ve=new Date;Ve.setDate(Ve.getDate()-J);const Pe=Ve.toDateString(),Ae=localStorage.getItem(`breathing_${n.uid}_${Pe}`);Ae&&await fe(ne(H,`users/${n.uid}/profile/daily/${Pe}/breathing`),Ae==="true")}const Z=localStorage.getItem("scheduledTriggers");if(Z){const J=JSON.parse(Z);await fe(ne(H,`users/${n.uid}/profile/scheduledTriggers`),J),$(J)}console.log("localStorage data migration to Firebase completed")}}catch(ne){console.error("Error migrating localStorage data to Firebase:",ne)}})()},[n==null?void 0:n.uid]);const w=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,T=()=>{const de=new Date,ne=new Date(de);ne.setHours(24,0,0,0);const ye=ne-de,fe=Math.floor(ye/(1e3*60*60)),pe=Math.floor(ye%(1e3*60*60)/(1e3*60)),_e=Math.floor(ye%(1e3*60)/1e3);return{hours:fe,minutes:pe,seconds:_e}},[A,b]=D.useState(T()),[C,v]=D.useState(0),[B,ge]=D.useState(0),[ke,_t]=D.useState(0),[Y,we]=D.useState(0);D.useEffect(()=>{const de=setInterval(()=>{b(T());const ne=w(),fe=new Date-ne,pe=Math.floor(fe/(1e3*60*60*24)),_e=Math.floor(fe%(1e3*60*60*24)/(1e3*60*60)),ze=Math.floor(fe%(1e3*60*60)/(1e3*60)),q=Math.floor(fe%(1e3*60)/1e3);v(pe),ge(_e),_t(ze),we(q)},1e3);return()=>clearInterval(de)},[t,n==null?void 0:n.quitDate]);const re=async(de,ne)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:ye,set:fe}=await De(()=>import("./index.esm-980f89f8.js"),[]),pe=ye(H,`users/${n.uid}/profile/${de}`);return await fe(pe,ne),!0}catch(ye){return console.error("Error saving to Firebase:",ye),!1}},Ee=async()=>{const de=new Date;r(de),M&&await M.handleRelapse();const ne=de.toISOString(),ye=await re("relapseDate",ne),fe=await re("lastQuitDate",ne);ye||localStorage.setItem("quitCoachRelapseDate",ne),fe||localStorage.setItem("quitCoachLastQuitDate",ne),console.log("🔄 Relapse logged - quit date reset to relapse time:",ne)},O=(()=>{const de=new Date,ne=de.getDay(),ye=ne===0?6:ne-1,fe=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let pe=0;pe<=ye;pe++)fe[pe].color="bg-green-500";return t&&t.toDateString()===de.toDateString()&&(fe[ye].color="bg-red-500"),fe})(),W=async de=>{E(de);const ne=new Date().toDateString();M&&await M.handleHydrationUpdate(de),await re(`daily/${ne}/water`,de)||localStorage.setItem(`water_${ne}`,de.toString()),i(!1)},ce=async de=>{I(de);const ne=new Date().toDateString();await re(`daily/${ne}/mood`,de)||localStorage.setItem(`mood_${ne}`,JSON.stringify(de)),a(!1)},me=async(de,ne,ye)=>{const fe={day:de,triggerType:ne,time:ye,id:Date.now()},pe=[...P,fe];$(pe),M&&await M.handleTriggerPlanning(),await re("scheduledTriggers",pe)||localStorage.setItem("scheduledTriggers",JSON.stringify(pe)),u(!1)},Te=async()=>{M&&await M.handleTriggerListUpdate()};return c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[c.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?c.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):c.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-white text-lg",children:"Hello,"}),c.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),c.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:c.jsx("span",{className:"font-bold text-slate-900",children:C})})]}),c.jsxs("div",{className:"px-4 space-y-6",children:[c.jsx("div",{className:"mb-6",children:c.jsxs("button",{onClick:Ee,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[c.jsxs("div",{className:"flex items-center justify-center gap-3",children:[c.jsx("span",{className:"text-2xl",children:"⚠️"}),c.jsx("span",{className:"text-lg",children:"RELAPSE"}),c.jsx("span",{className:"text-2xl",children:"⚠️"})]}),c.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),c.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[c.jsx("span",{className:"text-white text-sm",children:"✓"}),c.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),c.jsx("div",{className:"flex justify-between items-center mb-4",children:O.map((de,ne)=>c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${de.color}`}),c.jsx("p",{className:"text-gray-400 text-xs",children:de.name})]},de.name))})]}),c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[c.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),c.jsxs("div",{className:"text-center",children:[c.jsxs("div",{className:"text-white text-3xl font-bold",children:[A.hours.toString().padStart(2,"0"),":",A.minutes.toString().padStart(2,"0"),":",A.seconds.toString().padStart(2,"0")]}),c.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),c.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),c.jsxs("div",{className:"flex items-baseline gap-4",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-white text-3xl font-bold",children:C.toString().padStart(2,"0")}),c.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-white text-3xl font-bold",children:B.toString().padStart(2,"0")}),c.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-white text-3xl font-bold",children:ke.toString().padStart(2,"0")}),c.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:Y.toString().padStart(2,"0")}),c.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&c.jsx("div",{className:"mt-3 text-center",children:c.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),c.jsx("p",{className:"text-gray-300 text-sm",children:_>0?`${_} glasses today`:"Tap to log water intake"})]}),c.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),c.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),c.jsx("p",{className:"text-gray-300 text-sm",children:k?`You feel ${k.name.toLowerCase()}`:"How do you feel today?"})]}),c.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),c.jsx("p",{className:"text-gray-300 text-sm",children:P.length>0?`${P.length} triggers planned`:"Plan your trigger defense strategy"})]}),c.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),c.jsx("button",{onClick:Te,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),c.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),c.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),c.jsx("div",{children:c.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),c.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),c.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),c.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),c.jsx(t8,{isOpen:s,onClose:()=>i(!1),onConfirm:W,currentWater:_}),c.jsx(n8,{isOpen:o,onClose:()=>a(!1),onSelect:ce,selectedMood:k}),c.jsx(r8,{isOpen:l,onClose:()=>u(!1),onSchedule:me,scheduledTriggers:P}),c.jsx(s8,{isOpen:h,onClose:()=>f(!1),selectedDate:m,onDateSelect:y,dailyData:{water:_,mood:k,breathing:x,relapseDate:t}})]})},t8=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=D.useState(r),{modalRef:o,classes:a}=gS(e,{threshold:80,velocity:.4,enabled:!0});return n?c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{ref:o,className:`modal-content bg-slate-800 border-slate-700 ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"water-modal-title",children:[c.jsx("div",{className:"modal-swipe-indicator"}),c.jsxs("div",{className:"modal-scrollable",children:[c.jsxs("div",{className:"text-center mb-6 p-4",children:[c.jsx("h3",{id:"water-modal-title",className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),c.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),c.jsx("div",{className:"mb-6 px-4",children:c.jsxs("div",{className:"form-group",children:[c.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:l=>i(parseInt(l.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0",autoComplete:"off","aria-label":"Number of glasses of water"}),c.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]})}),c.jsxs("div",{className:"modal-actions px-4 pb-4",children:[c.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"}),c.jsx("button",{onClick:()=>t(s),className:"modal-button modal-button-primary",children:"Confirm"})]})]})]})})}):null},n8=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}],{modalRef:i,classes:o}=gS(e,{threshold:80,velocity:.4,enabled:!0});return n?c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{ref:i,className:`modal-content bg-slate-800 border-slate-700 ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title",children:[c.jsx("div",{className:"modal-swipe-indicator"}),c.jsxs("div",{className:"modal-scrollable",children:[c.jsxs("div",{className:"text-center mb-6 p-4",children:[c.jsx("h3",{id:"mood-modal-title",className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),c.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),c.jsx("div",{className:"modal-grid modal-grid-2 gap-3 mb-6 px-4",children:s.map(a=>c.jsxs("button",{onClick:()=>t(a),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 min-h-[44px] ${(r==null?void 0:r.name)===a.name?"ring-2 ring-blue-400 bg-blue-600":"bg-slate-700 hover:bg-slate-600"}`,"aria-pressed":(r==null?void 0:r.name)===a.name,"aria-label":`Select ${a.name} mood`,children:[c.jsx("div",{className:`w-12 h-12 ${a.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:a.icon}),c.jsx("p",{className:"text-white font-semibold",children:a.name})]},a.name))}),c.jsx("div",{className:"modal-actions px-4 pb-4",children:c.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"})})]})]})})}):null},r8=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=D.useState(""),[o,a]=D.useState(""),[l,u]=D.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),c.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),c.jsxs("div",{className:"space-y-4 mb-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),c.jsxs("select",{value:s,onChange:m=>i(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[c.jsx("option",{value:"",children:"Select a day"}),f.map(m=>c.jsx("option",{value:m,children:m},m))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),c.jsxs("select",{value:o,onChange:m=>a(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[c.jsx("option",{value:"",children:"Select trigger type"}),h.map(m=>c.jsx("option",{value:m,children:m},m))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),c.jsx("input",{type:"time",value:l,onChange:m=>u(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",autoComplete:"off"})]})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),c.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})})}):null},s8=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?c.jsx("div",{className:"modal-backdrop",children:c.jsx("div",{className:"modal-container",children:c.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[c.jsxs("div",{className:"text-center mb-6",children:[c.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),c.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),c.jsxs("div",{className:"space-y-4 mb-6",children:[c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),c.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),c.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),c.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[c.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),c.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&c.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[c.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),c.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),c.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors min-h-[44px]",children:"Close"})]})})}):null,i8=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,firestoreBuddyService:r,firestoreBuddyServiceRef:s,initializeFirestoreBuddyService:i,behavioralService:o,user:a,onShowAnalytics:l,onShowPerformanceDashboard:u})=>c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:c.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx(o2,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),c.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),c.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[c.jsx("h3",{className:"text-white font-semibold mb-2",children:"📊 Behavioral Analytics"}),c.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),c.jsx("button",{onClick:l,disabled:!o,className:`w-full py-3 rounded-lg transition-colors mb-3 ${o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:o?"📈 View Analytics Dashboard":"📈 Analytics (Service Loading...)"}),o&&c.jsx("button",{onClick:async()=>{try{await o.logCraving(a.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await o.logBreathingExercise(a.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert("✅ Test data added to Firestore for analytics demo!")}catch(h){alert("❌ Error adding test data: "+h.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition-colors text-sm min-h-[44px]",children:"🧪 Add Test Data"})]}),c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[c.jsx("h3",{className:"text-white font-semibold mb-2",children:"⚡ Performance Monitoring"}),c.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Monitor app performance and run stress tests"}),c.jsx("button",{onClick:u,className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors mb-3 min-h-[44px]",children:"📊 Open Performance Dashboard"}),c.jsx("p",{className:"text-gray-500 text-xs",children:"View database performance, authentication metrics, offline queue status, and run stress tests"})]}),c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[c.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),c.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),c.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:"← Back to Login"})]}),c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[c.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),c.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),c.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,c.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[c.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),c.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),c.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),o8=()=>{const[n,e]=D.useState("arena"),[t,r]=D.useState("auth"),[s,i]=D.useState(null),[o,a]=D.useState(null),[l,u]=D.useState(!1),[h,f]=D.useState(!1),[m,y]=D.useState(!1),[_,E]=D.useState(null),[k,I]=D.useState(!0),[x,R]=D.useState(!1),[P,$]=D.useState(0),[M,N]=D.useState(!1),[w,T]=D.useState(0),[A,b]=D.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[C,v]=D.useState([]);D.useState(null);const[B,ge]=D.useState(null),[ke,_t]=D.useState(null),[Y,we]=D.useState(null),re=D.useRef(null),[Ee,Oe]=D.useState(null);D.useEffect(()=>{const L=z=>{window.deferredPrompt=z,R(!0),console.log("📲 PWA: beforeinstallprompt captured (App state set)")},Q=()=>{R(!1),console.log("✅ PWA installed (App state cleared)")};return window.addEventListener("beforeinstallprompt",L),window.addEventListener("appinstalled",Q),()=>{window.removeEventListener("beforeinstallprompt",L),window.removeEventListener("appinstalled",Q)}},[]),D.useEffect(()=>{let L=0,Q=0,z=!1;const ue=80,Ce=Me=>{L=Me.touches[0].clientY,z=!1},qe=Me=>{if(window.scrollY>0)return;Q=Me.touches[0].clientY;const Fe=Q-L;Fe>0&&(z=!0,Me.preventDefault(),T(Math.min(Fe,ue*1.5)))},Se=async()=>{if(!z)return;Q-L>ue?(N(!0),T(0),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Pull-to-refresh: Refreshing stats..."),await window.refreshArenaStats()),typeof refreshStats=="function"&&(console.log("🔄 Pull-to-refresh: Calling main refresh..."),refreshStats()),setTimeout(()=>{N(!1)},1e3)):T(0),z=!1};return document.addEventListener("touchstart",Ce,{passive:!1}),document.addEventListener("touchmove",qe,{passive:!1}),document.addEventListener("touchend",Se,{passive:!1}),()=>{document.removeEventListener("touchstart",Ce),document.removeEventListener("touchmove",qe),document.removeEventListener("touchend",Se)}},[]);const O=async()=>{try{if(window.promptPWAInstall){const z=await window.promptPWAInstall();z&&z.outcome==="accepted"&&R(!1);return}const L=window.deferredPrompt;if(!L)return;L.prompt();const Q=await L.userChoice;window.deferredPrompt=null,Q.outcome==="accepted"&&R(!1)}catch(L){console.warn("PWA install prompt failed:",L==null?void 0:L.message)}},W=async()=>{try{if(!Us){console.error("❌ Firestore instance is not available");return}const L=new sc(Us),Q=new n2(Us),z=await L.testConnectivity(),ue=await Q.testConnectivity();z?(ge(L),re.current=L,console.log("✅ FirestoreBuddyService initialized successfully")):console.warn("⚠️ Firestore connectivity test failed - service not initialized"),ue?(_t(Q),console.log("✅ FirestoreBehavioralService initialized successfully")):console.warn("⚠️ Firestore behavioral service connectivity test failed")}catch(L){console.error("❌ Error initializing FirestoreBuddyService:",L)}},ce=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),me=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),Te=L=>{L.relapseDate&&Rt(new Date(L.relapseDate)),L.dailyWater!==void 0&&Nt(L.dailyWater),L.dailyMood!==void 0&&kt(L.dailyMood),L.dailyBreathing!==void 0&&Re(L.dailyBreathing),L.scheduledTriggers&&wn(L.scheduledTriggers)},de=async()=>{const L=new Date().toDateString();try{const{ref:Q,set:z}=await De(()=>import("./index.esm-980f89f8.js"),[]),ue=Q(H,`users/${_==null?void 0:_.uid}/profile/daily/${L}/breathing`);await z(ue,!0)}catch(Q){console.error("Error saving breathing exercise to Firebase:",Q),localStorage.setItem(`breathing_${_==null?void 0:_.uid}_${L}`,"true")}if(Ee)try{await Ee.handleBreathingExercise();const Q=await Ee.checkBreathingStreak(),z=Math.max(0,3-Q%3),ue=Q>=3&&Q%3===0?`🎉 Excellent! You've completed a ${Q}-day breathing streak and earned +1 Mental Strength!`:`✅ Breathing exercise completed! Current streak: ${Q} days. Complete ${z} more days to earn +1 Mental Strength.`;if(showQuickActionPopup("🫁 Breathing Exercise Complete",`${ue}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),ke)try{await ke.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:Q,mentalStrengthEarned:Q>=3&&Q%3===0}),console.log("✅ Breathing exercise also logged to Firestore for analytics")}catch(Ce){console.warn("⚠️ Could not log breathing exercise to Firestore:",Ce.message),await handleOfflineBehavioralLog("breathing",{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:Q,mentalStrengthEarned:Q>=3&&Q%3===0})}}catch(Q){console.warn("⚠️ Error handling breathing exercise completion:",Q.message),showQuickActionPopup("🫁 Breathing Exercise Complete","✅ Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},ne=(L,Q)=>{const z=document.createElement("div");z.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",z.innerHTML=`
      <div class="font-bold">${L}</div>
      <div class="text-sm opacity-90">${Q}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(z),setTimeout(()=>{z.parentNode&&z.parentNode.removeChild(z)},1e4)},ye=async L=>{if(!L)return!1;b({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:Q,get:z,onValue:ue}=await De(()=>import("./index.esm-980f89f8.js"),[]);b(lt=>({...lt,currentStep:"Loading profile data...",progress:20}));const Ce=Q(H,`users/${L}`),qe=await z(Ce);if(!qe.exists())throw new Error("User profile not found");const Se=qe.val(),Me=fe(Se);b(lt=>({...lt,currentStep:"Loading battle stats...",progress:40}));const Fe=Q(H,`users/${L}/stats`),xt=await z(Fe),He=xt.exists()?pe(xt.val()):ce();b(lt=>({...lt,currentStep:"Loading habits and progress...",progress:60}));const Ge=Q(H,`users/${L}/profile`),tt=await z(Ge),Ue=tt.exists()?_e(tt.val()):me();b(lt=>({...lt,currentStep:"Loading achievements...",progress:80}));const Le=Q(H,`users/${L}/profile/cravingsResisted`),Ne=await z(Le),We=Ne.exists()?Math.max(0,parseInt(Ne.val())||0):0;b(lt=>({...lt,currentStep:"Setting up live sync...",progress:90}));const pn=ue(Fe,lt=>{if(lt.exists()){const Jn=pe(lt.val());if(console.log("🔄 Firebase Listener: Stats changed, new stats:",Jn),ln(Jn),t==="arena"&&o){console.log("🔄 Firebase Listener: Current user object:",o),console.log("🔄 Firebase Listener: user.quitDate:",o.quitDate),console.log("🔄 Firebase Listener: user.uid:",o.uid);const hs={...o,stats:Jn};console.log("🔄 Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",hs),console.log("🔄 Firebase Listener: updatedUser.quitDate:",hs.quitDate),console.log("🔄 Firebase Listener: updatedUser.uid:",hs.uid),calculateRealTimeStats(hs).then(Ps=>{console.log("🔄 Firebase Listener: calculateRealTimeStats returned:",Ps),console.log("🔄 Firebase Listener: calculatedStats.streakDays:",Ps.streakDays),setRealTimeUserStats(Ps)})}}}),st=ue(Ge,lt=>{if(lt.exists()){const Jn=_e(lt.val());t==="profile"&&Te(Jn)}}),wt=ue(Le,lt=>{if(lt.exists()){const Jn=Math.max(0,parseInt(lt.val())||0);t==="craving-support"&&Pn(Jn)}});return v([pn,st,wt]),b(lt=>({...lt,currentStep:"Finalizing...",progress:100})),a(lt=>({...lt,...Me,...Ue,stats:He})),Te(Ue),Pn(We),Me.onboardingCompleted&&y(!0),b({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:Me,stats:He,profileData:Ue,cravingsResisted:We}),!0}catch(Q){return console.error("❌ Error loading user data:",Q),b({isLoading:!1,progress:0,currentStep:"Failed to load data",error:Q.message,isComplete:!1}),ne("Failed to load user data",Q.message),!1}},fe=L=>L?{uid:L.uid||"",email:L.email||"",heroName:L.heroName||"Hero",archetype:L.archetype||"The Determined",avatar:L.avatar||js("default"),quitDate:L.quitDate,onboardingCompleted:!!L.onboardingCompleted,updatedAt:L.updatedAt||Date.now(),...L}:ze(),pe=L=>L?{mentalStrength:Math.max(0,Math.min(100,parseInt(L.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(L.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(L.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(L.addictionLevel)||50)),streakDays:Math.max(0,parseInt(L.streakDays)||0),streakUnit:L.streakUnit||"hours",streakDisplayText:L.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(L.cravingsResisted)||0),...L}:ce(),_e=L=>L?{dailyWater:Math.max(0,parseInt(L.dailyWater)||0),dailyMood:L.dailyMood||null,dailyBreathing:!!L.dailyBreathing,scheduledTriggers:Array.isArray(L.scheduledTriggers)?L.scheduledTriggers:[],relapseDate:L.relapseDate?new Date(L.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(L.cravingsResisted)||0),...L}:me(),ze=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:js("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});D.useEffect(()=>()=>{C.forEach(L=>{typeof L=="function"&&L()})},[C]);const[q,Z]=D.useState(null);D.useEffect(()=>{const L=async()=>{try{const z=(await De(()=>import("./offlineManager-efbbb526.js"),[])).default,ue=new z;Z(ue),window.offlineManager=ue,window.refreshUserData=Pe,console.log("✅ Offline manager initialized")}catch(z){console.error("Error initializing offline manager:",z)}},Q=async()=>{try{const z=(await De(()=>import("./authGuard-fb8f6807.js"),[])).default,ue=(await De(()=>import("./sessionManager-5b71a30e.js"),[])).default,Ce=new z,qe=new ue;window.authGuard=Ce,window.sessionManager=qe,console.log("✅ Auth services initialized")}catch(z){console.error("❌ Failed to initialize auth services:",z)}};L(),Q()},[]);const J=async L=>{if(!L)return!1;const Q=await ye(L);if(Q&&q&&(await q.cacheUserData(o),await q.cacheProfileData({dailyWater:Gt,dailyMood:vt,dailyBreathing:mt,scheduledTriggers:Je,relapseDate:Ae,cravingsResisted:an})),!Q&&q){console.log("📱 Loading offline data...");const z=await q.getCachedUserData(),ue=await q.getCachedProfileData();if(z)return console.log("📱 Using offline user data"),a(z),y(z.onboardingCompleted),ue&&Te(ue),!0}return Q},Ve=async()=>_!=null&&_.uid?(console.log("🔄 Refreshing user data with offline support..."),await J(_.uid)):!1,Pe=async()=>{if(!(_!=null&&_.uid)){ne("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await Ve()){const Q=document.createElement("div");Q.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",Q.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(Q),setTimeout(()=>{Q.parentNode&&Q.parentNode.removeChild(Q)},5e3)}else ne("Refresh Failed","Could not refresh data. Please try again.")},[Ae,Rt]=D.useState(null),[Gt,Nt]=D.useState(0),[vt,kt]=D.useState(null),[mt,Re]=D.useState(!1),[Je,wn]=D.useState([]),[an,Pn]=D.useState(0),[cr,ln]=D.useState(ce());D.useEffect(()=>{const L=z=>{if(z.message&&z.message.includes("content_script")){console.warn("Browser extension error (ignored):",z.message);return}if(z.message&&(z.message.includes("FrameDoesNotExistError")||z.message.includes("background.js"))){console.warn("Background frame error (ignored):",z.message);return}if(z.message&&z.message.includes("deref")){console.warn("Browser extension deref error (ignored):",z.message);return}if(z.message&&z.message.includes("chrome-extension://")){console.warn("Chrome extension URL error (ignored):",z.message);return}console.error("Global error caught:",z)},Q=z=>{if(z.reason&&z.reason.message&&z.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&(z.reason.message.includes("FrameDoesNotExistError")||z.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&z.reason.message.includes("deref")){console.warn("Browser extension deref promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&z.reason.message.includes("chrome-extension://")){console.warn("Chrome extension URL promise rejection (ignored):",z.reason.message);return}console.error("Unhandled promise rejection:",z.reason)};return window.addEventListener("error",L),window.addEventListener("unhandledrejection",Q),()=>{window.removeEventListener("error",L),window.removeEventListener("unhandledrejection",Q)}},[]),D.useEffect(()=>{(()=>{try{H&&typeof H.app<"u"&&console.log("🔥 Firebase RTDB initialized successfully")}catch(Q){console.warn("⚠️ Firebase initialization check failed (non-critical):",(Q==null?void 0:Q.message)||Q)}})()},[]),D.useEffect(()=>{let L=!0,Q=null;return(async()=>{try{console.log("Initializing authentication state..."),I(!0);const ue=async Se=>{const Me=`quitDateFixed_${Se}_v2`;if(!localStorage.getItem(Me)&&!(Se!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&Se!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:Fe,get:xt,set:He}=await De(()=>import("./index.esm-980f89f8.js"),[]),Ge="2025-09-18T13:56:46.584Z";console.log(`🔧 One-time fix: Setting proper quit date for ${Se}...`);const tt=Fe(H,`users/${Se}/profile`),Ue=await xt(tt);let Le=Ge;if(Ue.exists()){const Ne=Ue.val();if(Ne.lastRelapseDate){const We=new Date(Ne.lastRelapseDate),pn=new Date(Ge);Le=We>pn?Ne.lastRelapseDate:Ge,console.log(`📅 ${Se}: Using quit date ${Le} (considering relapse: ${Ne.lastRelapseDate})`)}}await He(Fe(H,`users/${Se}/quitDate`),Le),await He(Fe(H,`users/${Se}/profile/quitDate`),Le),localStorage.setItem(Me,"true"),console.log(`✅ One-time fix: Quit date fixed for ${Se} in Firebase database`)}catch(Fe){console.warn(`⚠️ One-time fix failed for ${Se}:`,Fe.message)}},{onAuthStateChanged:Ce}=await De(()=>import("./index.esm-c52cd956.js"),[]);Q=Ce(yi,async Se=>{if(L)if(console.log("Auth state changed:",Se?`User: ${Se.uid}`:"No user"),Se){E(Se),console.log("User authenticated, checking database for user data..."),(Se.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||Se.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(`🧹 Clearing cache for ${Se.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(Me=>{(Me.includes("quitCoach")||Me.includes("quitDate")||Me.includes("user")||Me.includes("arena"))&&localStorage.removeItem(Me)})),ue(Se.uid);try{const{ref:Me,get:Fe}=await De(()=>import("./index.esm-980f89f8.js"),[]),xt=Me(H,`users/${Se.uid}`),He=await Fe(xt);if(He.exists()){const Ge=He.val();console.log("Existing user data found - auto-login successful"),(()=>{const Ue=[];for(let Le=0;Le<localStorage.length;Le++){const Ne=localStorage.key(Le);Ne&&(Ne.startsWith("water_")||Ne.startsWith("mood_")||Ne.startsWith("breathing_"))&&Ue.push(Ne)}Ue.forEach(Le=>localStorage.removeItem(Le)),console.log("Cleared previous user data from localStorage")})(),a(Ge),y(!0),r("arena");try{const Ue=await De(()=>Promise.resolve().then(()=>mq),void 0),Le=new Ue.default(H,Se.uid);await Le.initialize(),Oe(Le),console.log("✅ StatManager initialized successfully")}catch(Ue){console.error("Error initializing StatManager:",Ue)}try{const Ue=new qT(H,Se.uid,window.authGuard);we(Ue),window.centralizedStatService=Ue,await Ue.refreshAllStats(),console.log("✅ CentralizedStatService initialized and stats refreshed for user:",Se.uid),Ue.setupRealTimeListener(Le=>{console.log("🔄 Real-time stats update received:",Le),ln(Le)})}catch(Ue){console.error("Error initializing CentralizedStatService:",Ue)}try{Pq.initialize(),console.log("✅ Performance monitoring system initialized")}catch(Ue){console.error("Error initializing performance monitoring:",Ue)}try{console.log("🔍 Checking if existing user needs buddy matching...");const Ue=re.current||B;if(Ue)if(await Ue.getUserBuddyPair(Se.uid))console.log("✅ Existing user already has a buddy pair");else{console.log("🔄 Existing user has no buddy - adding to matching pool...");const Ne={userId:Se.uid,heroName:Ge.heroName,archetype:Ge.archetype,joinedAt:new Date().toISOString(),stats:Ge.stats};await Ue.addToMatchingPool(Ne),console.log("✅ Added existing user to matching pool"),setTimeout(async()=>{try{console.log("⏳ Triggering auto-matching for existing user..."),await Xo()}catch(We){console.error("Auto-matching failed for existing user:",We)}},2e3)}else console.log("⚠️ FirestoreBuddyService not available for existing user buddy check")}catch(Ue){console.error("Error checking existing user buddy status:",Ue)}console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Me){console.error("Error fetching user data during auto-login:",Me),r("onboarding")}}else console.log("No authenticated user - showing login screen"),E(null),a(null),y(!1),r("auth"),(()=>{const Fe=[];for(let xt=0;xt<localStorage.length;xt++){const He=localStorage.key(xt);He&&(He.startsWith("water_")||He.startsWith("mood_")||He.startsWith("breathing_"))&&Fe.push(He)}Fe.forEach(xt=>localStorage.removeItem(xt)),console.log("Cleared user-specific data from localStorage")})()});const qe=setTimeout(()=>{L&&(console.warn("Auth initialization timeout - forcing to auth screen"),I(!1),r("auth"))},1e4);Q&&clearTimeout(qe)}catch(ue){console.error("Error initializing authentication:",ue),L&&(I(!1),r("auth"))}finally{L&&I(!1)}})(),W(),()=>{L=!1,Q&&Q()}},[]);const kr=async L=>{console.log("Authentication successful, checking for existing user data...",{uid:L==null?void 0:L.uid,email:L==null?void 0:L.email});try{const{ref:Q,get:z}=await De(()=>import("./index.esm-980f89f8.js"),[]);console.log("Checking database for existing user data...");const ue=Q(H,`users/${L.uid}`),Ce=await z(ue);if(Ce.exists()){const qe=Ce.val();if(console.log("Existing user data found - loading all user data..."),await J(L.uid)){console.log("✅ All user data loaded successfully, going to Arena");try{const Me=new qT(H,L.uid,window.authGuard);we(Me),window.centralizedStatService=Me,await Me.refreshAllStats(),console.log("✅ CentralizedStatService initialized for existing user:",L.uid),Me.setupRealTimeListener(Fe=>{console.log("🔄 Real-time stats update received:",Fe),ln(Fe)})}catch(Me){console.error("Error initializing CentralizedStatService for existing user:",Me)}r("arena")}else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(qe);const Me=!!qe.onboardingCompleted;y(Me),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(Q){console.error("Database check failed:",Q),r("onboarding")}},[It,cn]=D.useState(null),[mn,xn]=D.useState(!1),[ur,dt]=D.useState(null),[ut,Sn]=D.useState(!1),Pr=async(L,Q,z)=>{var ue,Ce,qe;if(!(!(o!=null&&o.uid)||mn)){xn(!0),dt(null),Sn(!0);try{console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!B),console.log("🔄 FirestoreBuddyService type:",typeof B);const Se=re.current||B;if(!Se){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await ks();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:Me,query:Fe,where:xt,getDocs:He}=await De(()=>import("./index.esm-0076aa24.js"),[]),Ge=Me(Us,"buddyPairs"),tt=Fe(Ge,xt("user1Id","==",o.uid)),Ue=await He(tt);let Le=null,Ne=null;if(Ue.empty){const We=Fe(Ge,xt("user2Id","==",o.uid)),pn=await He(We);if(!pn.empty){const st=pn.docs[0];Le={id:st.id,...st.data()},Ne=Le.user1Id}}else{const We=Ue.docs[0];Le={id:We.id,...We.data()},Ne=Le.user2Id}if(Le&&Ne){console.log("✅ Firestore: Found buddy pair:",Le.id),console.log("🔍 Buddy pair data:",{user1Id:Le.user1Id,user2Id:Le.user2Id,user1Name:Le.user1Name,user2Name:Le.user2Name,currentUserId:o.uid,buddyUserId:Ne});let We="Your Buddy";if(Le.user1Id===o.uid?We=Le.user2Name||"Your Buddy":We=Le.user1Name||"Your Buddy",We==="Your Buddy")try{const pt=(await Se.getAllMatchingPoolUsers()).find(gn=>gn.userId===Ne);pt&&pt.heroName&&(We=pt.heroName,console.log("🔍 Found buddy name from matching pool:",We))}catch(Ke){console.log("⚠️ Could not get buddy name from matching pool:",Ke.message)}if(We==="Your Buddy"&&(We=`Buddy ${Ne.slice(-4)}`),console.log("🔍 Selected buddy name:",We),We!=="Your Buddy"&&We.startsWith("Buddy ")===!1)try{console.log("🔄 Updating buddy pair with correct names...");const{doc:Ke,updateDoc:pt}=await De(()=>import("./index.esm-0076aa24.js"),[]),gn=Ke(Us,"buddyPairs",Le.id),en={};Le.user1Id===o.uid?(en.user1Name=o.heroName,en.user2Name=We):(en.user1Name=We,en.user2Name=o.heroName),await pt(gn,en),console.log("✅ Updated buddy pair with names:",en)}catch(Ke){console.log("⚠️ Could not update buddy pair names:",Ke.message)}let pn={streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0};try{console.log("🔄 Attempting to get real buddy stats from Firebase...");const{ref:Ke,get:pt}=await De(()=>import("./index.esm-980f89f8.js"),[]),gn=Ke(H,`users/${Ne}/stats`),en=await pt(gn);if(en.exists()){const Dr=en.val();pn={...pn,...Dr},console.log("✅ Got real buddy stats from Firebase:",Dr)}else console.log("⚠️ Buddy stats not found in Firebase, using defaults")}catch(Ke){console.log("⚠️ Could not read buddy stats (permission), using defaults:",Ke.message)}let st=null,wt=null,lt=null,Jn=js("buddy","adventurer"),hs="DETERMINED";try{console.log("🔄 Loading Firebase imports for buddy profile...");const{ref:Ke,get:pt}=await De(()=>import("./index.esm-980f89f8.js"),[]);console.log("✅ Firebase imports loaded successfully"),console.log("🔍 Reading buddy profile fields from path:",`users/${Ne}`),console.log("🔄 Firestore: Attempting to read buddy quit date from multiple locations...");const[gn,en,Dr,$i,Bi,_r,Ht]=await Promise.all([pt(Ke(H,`users/${Ne}/avatar`)),pt(Ke(H,`users/${Ne}/avatarSeed`)),pt(Ke(H,`users/${Ne}/archetype`)),pt(Ke(H,`users/${Ne}/heroName`)),pt(Ke(H,`users/${Ne}/quitDate`)),pt(Ke(H,`users/${Ne}/profile/quitDate`)),pt(Ke(H,`users/${Ne}/profile`))]);if(console.log("🔍 Firestore: Quit date snapshots - root exists:",Bi.exists(),"profile exists:",_r.exists()),gn.exists())Jn=gn.val(),console.log("✅ Got buddy avatar from Firebase");else if(en.exists()){const At=en.val(),Xr=Dr.exists()?Dr.val():"adventurer";Jn=js(At,Xr),console.log("✅ Generated buddy avatar from seed:",At)}if(Dr.exists()&&(hs=Dr.val(),console.log("✅ Got buddy archetype:",hs)),$i.exists()){const At=$i.val();console.log("✅ Got buddy hero name:",At),We=At}if(Bi.exists())st=Bi.val(),console.log("✅ Got buddy quit date from Firebase (root):",st);else if(_r.exists())st=_r.val(),console.log("✅ Got buddy quit date from Firebase (profile):",st);else{if(console.log("⚠️ No buddy quit date found in Firebase (neither root nor profile)"),console.log("🔍 quitDateSnapshot exists:",Bi.exists()),console.log("🔍 profileQuitDateSnapshot exists:",_r.exists()),Ht.exists()){const At=Ht.val();console.log("🔍 Full profile data available:",At),At&&At.quitDate?(st=At.quitDate,console.log("✅ Found buddy quit date in profile data:",st)):console.log("⚠️ Profile exists but has no quit date field"),At&&At.lastActivity&&(lt=At.lastActivity,console.log("🔍 Captured buddy lastActivity for fallback:",lt))}else console.log("⚠️ No profile data available at all");if(Ht.exists()){const At=Ht.val();wt=At.lastRelapseDate||At.relapseDate,console.log("🔍 Found buddy relapse date:",wt)}if(!st){if(console.log("⚠️ No quit date found, checking for createdAt timestamp..."),console.log("🔍 Buddy user ID:",Ne),Ht.exists()){const At=Ht.val();At.createdAt?(st=At.createdAt,console.log("✅ Using buddy createdAt as quit date:",st)):(console.log("⚠️ No createdAt timestamp found either - not assigning fallback quit date"),st=void 0)}else console.log("⚠️ No profile data available - not assigning fallback quit date"),st=void 0;Ne==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"?console.log("🔄 Arena: User 2 uses centralized stats - no hardcoded quit date needed"):Ne==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&console.log("🔄 Arena: User 3 uses centralized stats - no hardcoded quit date needed")}}}catch(Ke){console.log("⚠️ Could not read buddy profile (permission):",Ke.message),console.log("🔍 Full profile error details:",Ke),console.log("🔍 Trying to access path:",`users/${Ne}`),console.log("🔍 Current user can read own profile, but not buddy profile")}const Ps=st||lt||null;let ea=Ps;(Ne==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||Ne==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")&&(console.log(`🔄 Arena: Not setting quit date for centralized buddy ${Ne} - using null to prevent calculations`),ea=null);const Dn={heroName:We,uid:Ne,stats:pn,quitDate:ea,originalQuitDate:ea,finalQuitDate:Ps,lastActivity:lt||null,lastRelapseDate:wt,achievements:[],archetype:hs,avatar:Jn,userId:Ne,isRealBuddy:!0,pairId:Le.id,triggers:[],dailyPatterns:[],copingStrategies:[],specialFeatures:null};console.log("🔍 Firestore: Final buddy object with quit date:",{heroName:We,originalQuitDate:st,finalQuitDate:Ps,lastRelapseDate:wt,hasOriginalQuitDate:!!st,usingDefaultQuitDate:!st,hasRelapseDate:!!wt}),cn(Dn),console.log("✅ Firestore: Buddy data loaded successfully"),console.log("🔍 Firestore: Buddy Special Features data:",{hasSpecialFeatures:!!Dn.specialFeatures,hasTriggers:!!((ue=Dn.triggers)!=null&&ue.length),hasDailyPatterns:!!((Ce=Dn.dailyPatterns)!=null&&Ce.length),hasCopingStrategies:!!((qe=Dn.copingStrategies)!=null&&qe.length),uid:Dn.uid});try{let Ke=Dn.lastRelapseDate||null;if(!Ke){const pt=Dn.finalQuitDate;if(pt){const gn=new Date(pt).getTime(),en=Date.now();Math.abs(en-gn)<2*60*1e3||(Ke=pt)}}if(!Ke&&Dn.lastActivity&&(Ke=Dn.lastActivity),Ke){const pt=Ms(new Date(Ke)),gn={streakDays:pt.value,streakUnit:pt.unit,streakDisplayText:pt.displayText};typeof setBuddyStreakData=="function"&&setBuddyStreakData(gn),typeof setRealTimeNemesisStats=="function"&&setRealTimeNemesisStats(en=>({...en,streakDays:gn.streakDays,streakUnit:gn.streakUnit,streakDisplayText:gn.streakDisplayText})),console.log("🔄 Arena: Primed buddy streak from loaded data:",gn.streakDisplayText)}}catch(Ke){console.log("⚠️ Arena: Could not prime buddy streak:",Ke==null?void 0:Ke.message)}console.log(`🔄 Firestore: Reading centralized buddy stats for ${Ne} (read-only)`);try{try{const{ref:Ke,get:pt}=await De(()=>import("./index.esm-980f89f8.js"),[]),gn=await pt(Ke(H,`users/${Ne}/stats`));if(gn.exists()){const en=gn.val(),Dr=new Date,$i=Dn.lastRelapseDate;if($i){const Bi=new Date($i),_r=Dr-Bi,Ht=Math.floor(_r/(1e3*60*60)),At=Math.floor(Ht/24);let Xr,ta;Ht<24?(Xr=`${Ht} hour${Ht===1?"":"s"}`,ta=0):(Xr=`${At} day${At===1?"":"s"}`,ta=At),console.log(`🔄 Firestore: Calculated buddy streak locally: ${Xr} (${Ht} hours since relapse)`);const Pt={streakDays:ta,streakUnit:Ht<24?"hours":"days",streakDisplayText:Xr};z(Pt);const Ds={...en,streakDays:ta,streakUnit:Ht<24?"hours":"days",streakDisplayText:Xr};console.log("🔄 Firestore: Using buddy stats with locally calculated streak:",Ds),console.log("🔄 Firestore: Buddy streak fields:",{streakDays:Ds.streakDays,streakUnit:Ds.streakUnit,streakDisplayText:Ds.streakDisplayText}),Q(Ds)}else console.log("🔄 Firestore: No relapse date found for buddy, using existing stats"),Q(en)}else{console.log("⚠️ Firestore: No centralized stats found for buddy, using fallback calculation");const en=await L(Dn);Q(en)}}catch(Ke){console.error("❌ Error reading buddy stats:",Ke);const pt=await L(Dn);Q(pt)}}catch(Ke){console.error("❌ Error reading centralized buddy stats:",Ke);const pt=await L(Dn);Q(pt)}await dr(o.uid,Ne)}else console.log("ℹ️ Firestore: No buddy pair found for user"),cn(null)}catch(Se){console.error("❌ Firestore: Error loading buddy:",Se),console.log("🔄 Falling back to Realtime Database buddy loading..."),await ks()}finally{xn(!1)}}},ks=async()=>{var L,Q,z,ue,Ce,qe,Se,Me,Fe,xt;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:He,get:Ge}=await De(()=>import("./index.esm-980f89f8.js"),[]),tt=He(H,"buddyPairs"),Ue=await Ge(tt);if(!Ue.exists()){cn(null);return}const Le=Ue.val();let Ne=null,We=null;for(const[pn,st]of Object.entries(Le))if(st.users&&Array.isArray(st.users)&&st.users.includes(o.uid)){Ne={...st,pairId:pn},We=st.users.find(wt=>wt!==o.uid);break}if(Ne&&We){const pn=He(H,`users/${We}`),st=await Ge(pn);if(!st.exists()){const{remove:Jn}=await De(()=>import("./index.esm-980f89f8.js"),[]);await Jn(He(H,`buddyPairs/${Ne.pairId}`)),cn(null);return}const wt=st.val(),lt={heroName:wt.heroName||"Buddy",stats:{streakDays:((L=wt.stats)==null?void 0:L.streakDays)||0,addictionLevel:((Q=wt.stats)==null?void 0:Q.addictionLevel)||50,willpower:((z=wt.stats)==null?void 0:z.mentalStrength)||50,motivation:((ue=wt.stats)==null?void 0:ue.mentalStrength)||50,cravingResistance:((Ce=wt.stats)==null?void 0:Ce.mentalStrength)||50,triggerDefense:((qe=wt.stats)==null?void 0:qe.triggerDefense)||30,experiencePoints:((Se=wt.stats)==null?void 0:Se.experiencePoints)||0},achievements:wt.achievements||[],archetype:wt.archetype||"The Determined",avatar:wt.avatar||js(wt.heroName||"buddy","adventurer"),uid:We,userId:We,lastRelapseDate:wt.lastRelapseDate,isRealBuddy:!0,pairId:Ne.pairId,triggers:wt.triggers||[],dailyPatterns:wt.dailyPatterns||[],copingStrategies:wt.copingStrategies||[],specialFeatures:wt.specialFeatures||null};cn(lt),console.log("🔍 RealtimeDB: Buddy Special Features data:",{hasSpecialFeatures:!!lt.specialFeatures,hasTriggers:!!((Me=lt.triggers)!=null&&Me.length),hasDailyPatterns:!!((Fe=lt.dailyPatterns)!=null&&Fe.length),hasCopingStrategies:!!((xt=lt.copingStrategies)!=null&&xt.length),uid:lt.uid}),await dr(o.uid,We)}else cn(null)}catch(He){console.error("Error loading buddy from Realtime Database:",He),dt("Failed to load buddy data"),cn(null)}},dr=async(L,Q)=>{try{const z=re.current||B;if(z&&(It!=null&&It.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await z.removeFromMatchingPool(L),await z.removeFromMatchingPool(Q);const{doc:ue,updateDoc:Ce}=await De(()=>import("./index.esm-0076aa24.js"),[]),qe=ue(Us,"buddyPairs",It.pairId);await Ce(qe,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:ue,remove:Ce,set:qe}=await De(()=>import("./index.esm-980f89f8.js"),[]);await Ce(ue(H,`matchingPool/${L}`)),await Ce(ue(H,`matchingPool/${Q}`)),It!=null&&It.pairId&&(await qe(ue(H,`buddyPairs/${It.pairId}/user1RemovedFromPool`),!0),await qe(ue(H,`buddyPairs/${It.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(z){console.error("❌ Error removing users from matching pool:",z)}};D.useEffect(()=>{Sn(!1),cn(null)},[o==null?void 0:o.uid]),D.useEffect(()=>{o!=null&&o.uid&&!It&&!mn&&!ut&&console.log("🔄 Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,It,mn,ut]),D.useEffect(()=>{B&&console.log("✅ FirestoreBuddyService is now available")},[B]);const Xo=async()=>{try{const L=re.current||B;if(!L){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await ds();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting NEW CHAIN PAIRING algorithm...");const Q=await L.getAllMatchingPoolUsers();if(console.log("🔍 Firestore: Current matching pool state:",{totalUsers:Q.length,userIds:Q.map(ue=>({id:ue.userId,name:ue.heroName,joinedAt:ue.joinedAt}))}),Q.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing (need 2, have",Q.length,")");return}console.log(`🔄 Firestore: Found ${Q.length} users in matching pool`);const z=Q;if(console.log("ℹ️ Firestore: Skipping user validation to avoid permission errors"),z.sort((ue,Ce)=>{const qe=ue.joinedAt?new Date(ue.joinedAt).getTime():0,Se=Ce.joinedAt?new Date(Ce.joinedAt).getTime():0;return qe-Se}),console.log("🔄 Firestore: Sorted users by join time (oldest first):",z.map(ue=>({userId:ue.userId,joinedAt:ue.joinedAt}))),z.length>=2){const ue=z[z.length-1],Ce=z[z.length-2];if(ue.userId!==Ce.userId)try{console.log(`🔄 Firestore: SEQUENTIAL PAIRING: ${ue.userId} (${ue.heroName}) pairs with ${Ce.userId} (${Ce.heroName})`);const qe={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1,user1Name:ue.heroName||"User 1",user2Name:Ce.heroName||"User 2"};console.log("🔄 Firestore: About to call createBuddyPair with data:",{arrivingUserId:ue.userId,targetUserId:Ce.userId,pairData:qe});const Se=await L.createBuddyPair(ue.userId,Ce.userId,qe);if(console.log("🔄 Firestore: createBuddyPair returned:",Se),Se){const{ref:Me,set:Fe}=await De(()=>import("./index.esm-980f89f8.js"),[]);if(await Fe(Me(H,`users/${Ce.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ue.userId,pairId:Se,matchedAt:qe.matchedAt}),await Fe(Me(H,`users/${ue.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ce.userId,pairId:Se,matchedAt:qe.matchedAt}),await L.removeFromMatchingPool(Ce.userId),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Created buddy pair ${Se}`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Removed ${Ce.userId} (${Ce.heroName}) from matching pool`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Kept ${ue.userId} (${ue.heroName}) in matching pool for next pairing`),o!=null&&o.uid&&[ue.userId,Ce.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(He){console.error("Error reloading buddy data:",He)}}else console.error(`❌ Firestore: Failed to create buddy pair between ${ue.userId} and ${Ce.userId}`)}catch(qe){console.error(`❌ Firestore: Failed to create buddy pair between ${ue.userId} and ${Ce.userId}:`,qe)}else console.log("ℹ️ Firestore: Same user in pool, cannot pair")}else console.log("ℹ️ Firestore: Not enough users in pool for pairing (need 2, have",z.length,")")}catch(L){console.error("❌ Firestore: Auto-matching failed:",L),console.log("🔄 Falling back to Realtime Database auto-matching..."),await ds()}},ds=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:L,get:Q,set:z,push:ue,remove:Ce}=await De(()=>import("./index.esm-980f89f8.js"),[]),qe=L(H,"matchingPool"),Se=await Q(qe);if(!Se.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const Me=Se.val(),Fe=[];if(Object.entries(Me).forEach(([Ge,tt])=>{typeof tt=="string"?Fe.push(tt):tt&&typeof tt=="object"?tt.uid?Fe.push(tt.uid):tt.userId?Fe.push(tt.userId):Fe.push(Ge):Fe.push(Ge)}),console.log(`🔄 Realtime Database: Found ${Fe.length} users in matching pool`),Fe.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",Fe.length,")");return}const xt=Fe;console.log("ℹ️ Realtime Database: Skipping user validation to avoid permission errors"),console.log(`🔄 Realtime Database: Valid users for pairing: ${xt.join(", ")}`);const He=xt.map((Ge,tt)=>({userId:Ge,joinedAt:new Date(Date.now()-(xt.length-tt)*1e3).toISOString()}));if(He.sort((Ge,tt)=>{const Ue=Ge.joinedAt?new Date(Ge.joinedAt).getTime():0,Le=tt.joinedAt?new Date(tt.joinedAt).getTime():0;return Ue-Le}),console.log("🔄 Realtime Database: Sorted users by join time (oldest first):",He.map(Ge=>({userId:Ge.userId,joinedAt:Ge.joinedAt}))),He.length>=2){const Ge=He[0],tt=He[He.length-1];if(Ge&&tt&&Ge.userId!==tt.userId){console.log(`🔄 Realtime Database: CHAIN PAIRING: ${tt.userId} (arriving) pairs with ${Ge.userId} (waiting)`);try{const Ue=ue(L(H,"buddyPairs")).key,Le={pairId:Ue,users:[tt.userId,Ge.userId],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await z(L(H,`buddyPairs/${Ue}`),Le),await z(L(H,`users/${Ge.userId}/buddyInfo`),{hasBuddy:!0,buddyId:tt.userId,pairId:Ue,matchedAt:Le.matchedAt}),await z(L(H,`users/${tt.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ge.userId,pairId:Ue,matchedAt:Le.matchedAt}),Object.keys(Me).forEach(async Ne=>{const We=Me[Ne];((We==null?void 0:We.uid)||(We==null?void 0:We.userId)||Ne)===Ge.userId&&(await Ce(L(H,`matchingPool/${Ne}`)),console.log(`✅ Realtime Database: Removed ${Ge.userId} (waiting) from matching pool`))}),await z(L(H,`buddyPairs/${Ue}/user1RemovedFromPool`),!0),await z(L(H,`buddyPairs/${Ue}/user2RemovedFromPool`),!1),console.log(`✅ Realtime Database: CHAIN PAIRING: Created buddy pair ${Ue}`),console.log(`✅ Realtime Database: CHAIN PAIRING: Kept ${tt.userId} (arriving) in matching pool for next pairing`)}catch(Ue){console.error("Error creating buddy pair:",Ue)}}else console.log("ℹ️ Realtime Database: Same user in pool, cannot pair")}else console.log("ℹ️ Realtime Database: Not enough users in pool for pairing (need 2, have",He.length,")");if(o!=null&&o.uid&&He.length>=2){const Ge=He[0],tt=He[He.length-1];if([tt==null?void 0:tt.userId,Ge==null?void 0:Ge.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Le){console.error("Error reloading buddy data:",Le)}}}catch(L){console.error("Error in Realtime Database auto-matching:",L)}},Qh={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},Fi=()=>mn?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:js("loading","adventurer"),isLoading:!0}:ur?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:js("error","adventurer"),isError:!0,errorMessage:ur}:It||Qh,Kh=async L=>{console.log("Onboarding completed with user data:",L);try{if(!L||!L.heroName||!L.stats)throw new Error("Invalid user data received from onboarding");if(!_)throw new Error("No authenticated user found");const Q=new Date,z={...L,uid:_.uid,email:_.email,displayName:_.displayName||L.heroName,photoURL:_.photoURL,onboardingCompleted:!0,createdAt:Q.toISOString(),updatedAt:Q.getTime(),originalQuitDate:Q.toISOString(),lastQuitDate:Q.toISOString(),lastRelapseDate:Q.toISOString(),lastActivity:Q.toISOString(),daily:{[Q.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",z);const{ref:ue,set:Ce}=await De(()=>import("./index.esm-980f89f8.js"),[]),qe=ue(H,`users/${_.uid}`);await Ce(qe,z),console.log("Firebase save successful, updating app state..."),a(z),y(!0);try{const Me=re.current||B;if(Me){console.log("✅ Using Firestore for matching pool");const Fe={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:_.uid,heroName:z.heroName,archetype:z.archetype,joinedAt:new Date().toISOString()};if(await Me.addToMatchingPool(_.uid,Fe))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Fe,set:xt}=await De(()=>import("./index.esm-980f89f8.js"),[]),He={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:_.uid,heroName:z.heroName,archetype:z.archetype,joinedAt:new Date().toISOString()};await xt(Fe(H,`matchingPool/${_.uid}`),He),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{console.log("⏳ Waiting 1 second before attempting auto-matching..."),await new Promise(Fe=>setTimeout(Fe,1e3)),await Xo()}catch(Fe){console.error("Automatic matching failed:",Fe)}}catch(Me){console.error("⚠️ Failed to add user to buddy matching pool:",Me)}const Se=await J(_.uid);r("arena")}catch(Q){console.error("Error in handleOnboardingComplete:",Q);const z=new Date,ue={heroName:(L==null?void 0:L.heroName)||"Hero",archetype:(L==null?void 0:L.archetype)||"The Determined",avatar:(L==null?void 0:L.avatar)||js("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:z,createdAt:z.toISOString(),lastActivity:z.toISOString(),lastRelapseDate:z.toISOString(),uid:_==null?void 0:_.uid,email:_==null?void 0:_.email,onboardingCompleted:!0};if(_)try{const{ref:Ce,set:qe}=await De(()=>import("./index.esm-980f89f8.js"),[]),Se=Ce(H,`users/${_.uid}`);await qe(Se,ue)}catch(Ce){console.error("Failed to save fallback data to Firebase:",Ce)}a(ue),y(!0),r("arena")}},qn=()=>{a(null),y(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},hl=async()=>{try{console.log("Logging out user...");const{signOut:L}=await De(()=>import("./index.esm-c52cd956.js"),[]);await L(yi),a(null),E(null),y(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(L){console.error("Error during logout:",L),a(null),E(null),y(!1),r("auth")}},ii=async()=>{if(!_){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:L,set:Q,remove:z}=await De(()=>import("./index.esm-980f89f8.js"),[]),ue=L(H,`users/${_.uid}`);await Q(ue,null);const Ce=L(H,"users");await Q(Ce,null);const qe=L(H,"buddyPairs");await Q(qe,null);const Se=L(H,"matchingPool");await Q(Se,null),console.log("All user data and buddy matching data cleared from database"),a(null),y(!1),r("onboarding"),cn(null),xn(!1),dt(null),console.log("Account reset successful - ready for fresh onboarding")}catch(L){console.error("Error resetting account for testing:",L)}},Zo=L=>{console.log("Tab changed to:",L),e(L),r(L),L==="arena"&&(o!=null&&o.uid)&&(console.log("🔄 Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log("🔄 Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},Jg=L=>{r(L==="mood-selector"?"mood-selector":"profile")},Xg=L=>{i(L),r("profile")},Ui=()=>{r("profile")};return k?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),c.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),c.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),c.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:c.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),c.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?c.jsx(Dq,{onAuthSuccess:kr}):A.isLoading?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),c.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),c.jsx("p",{className:"text-xl text-gray-300 mb-4",children:A.currentStep}),c.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[c.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:c.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${A.progress}%`}})}),c.jsxs("div",{className:"text-sm text-gray-400",children:[A.progress,"% Complete"]})]}),c.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:c.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),A.error&&c.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[c.jsxs("p",{className:"text-red-300 text-sm",children:[c.jsx("span",{className:"font-semibold",children:"Error:"})," ",A.error]}),c.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),c.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative",children:[w>0&&c.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white text-center py-2 transition-transform duration-200",style:{transform:`translateY(${Math.max(0,w-60)}px)`},children:w>80?"Release to refresh":"Pull to refresh"}),M&&c.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-green-600 text-white text-center py-2",children:c.jsxs("div",{className:"flex items-center justify-center gap-2",children:[c.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),c.jsx("span",{children:"Refreshing..."})]})}),c.jsx(Oq,{offlineManager:q}),c.jsx(Mq,{offlineManager:q}),c.jsx(Lq,{sessionManager:window.sessionManager,authGuard:window.authGuard}),t==="onboarding"&&c.jsx("div",{children:c.jsx(zq,{onComplete:Kh,authUser:_,pwaInstallAvailable:x,promptInstall:O})}),m&&o?c.jsxs(c.Fragment,{children:[t==="arena"&&c.jsx("div",{children:(()=>{try{const L=Fi();return c.jsx(Qq,{user:o,userStats:cr,nemesis:L,onBackToLogin:hl,onResetForTesting:ii,buddyLoading:mn,buddyError:ur,realBuddy:It,loadRealBuddy:Pr,buddyLoadAttempted:ut},`arena-${o.uid}-${P}`)}catch(L){return console.error("Error rendering ArenaView:",L),c.jsxs("div",{className:"text-white text-center p-8",children:[c.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),c.jsx("p",{className:"text-gray-300 mb-4",children:L.message}),c.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-3 rounded hover:bg-blue-700 min-h-[44px]",children:"Reload App"})]})}})()}),t==="craving-support"&&c.jsx("div",{children:c.jsx(Jq,{user:o,nemesis:Fi(),onBackToLogin:hl,onResetForTesting:ii,behavioralService:ke,onBreathingComplete:async L=>{await de()},setActiveTab:e})}),t==="profile"&&c.jsx("div",{children:c.jsx(e8,{user:o,onNavigate:Jg})}),t==="mood-selector"&&c.jsx(MoodSelector,{onMoodSelect:Xg,onBack:Ui}),t==="settings"&&c.jsx(i8,{onResetApp:qn,onBackToLogin:hl,onResetForTesting:ii,firestoreBuddyService:B,firestoreBuddyServiceRef:re,initializeFirestoreBuddyService:W,behavioralService:ke,user:o,onShowAnalytics:()=>u(!0),onShowPerformanceDashboard:()=>f(!0)}),l&&c.jsx(Bq,{user:o,behavioralService:ke,onClose:()=>u(!1)}),h&&c.jsx(Tq,{isOpen:h,onClose:()=>f(!1)}),c.jsx(Hq,{activeTab:n,onTabChange:Zo,dataLoadingState:A,onRefreshData:Pe,offlineManager:q})]}):c.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),c.jsx("p",{className:"text-gray-300",children:m?"User data missing":"Onboarding not completed"}),c.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),c.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),c.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:m,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 min-h-[44px]",children:"Debug State"})]})})]})};a_.createRoot(document.getElementById("root")).render(c.jsx(o8,{}));export{OF as $,m8 as A,p8 as B,g8 as C,ja as D,u8 as E,Vw as F,T8 as G,A8 as H,C8 as I,R8 as J,HR as K,WF as L,ae as M,c8 as N,PF as O,DF as P,Ns as Q,Rs as R,F8 as S,n3 as T,j8 as U,Ye as V,d8 as W,h8 as X,I8 as Y,S8 as Z,B8 as _,JF as a,o7 as a$,LP as a0,nh as a1,bU as a2,Fr as a3,J8 as a4,Zs as a5,Ct as a6,Br as a7,ol as a8,al as a9,Xt as aA,K7 as aB,ot as aC,W8 as aD,Q7 as aE,H7 as aF,Q8 as aG,cs as aH,f3 as aI,ai as aJ,y7 as aK,_7 as aL,l7 as aM,V7 as aN,j7 as aO,g7 as aP,t7 as aQ,Zr as aR,K8 as aS,xU as aT,PU as aU,G7 as aV,LU as aW,L7 as aX,s7 as aY,W7 as aZ,um as a_,Mt as aa,G as ab,ei as ac,SU as ad,KU as ae,zn as af,tu as ag,Vh as ah,dm as ai,Vg as aj,Fh as ak,Lg as al,Bx as am,zr as an,jg as ao,uo as ap,Xe as aq,QU as ar,Es as as,GU as at,Uw as au,hn as av,Va as aw,se as ax,G8 as ay,r3 as az,Jr as b,ro as b$,v7 as b0,Z8 as b1,e7 as b2,r7 as b3,q7 as b4,m7 as b5,f7 as b6,on as b7,Uh as b8,jU as b9,$l as bA,SP as bB,w7 as bC,Y8 as bD,M7 as bE,hm as bF,MU as bG,B7 as bH,q8 as bI,x7 as bJ,h7 as bK,d7 as bL,p7 as bM,i7 as bN,T7 as bO,U7 as bP,n7 as bQ,Bl as bR,$7 as bS,eW as bT,qh as bU,zh as bV,nW as bW,ah as bX,ul as bY,no as bZ,Y7 as b_,R7 as ba,OU as bb,S7 as bc,I7 as bd,dd as be,E7 as bf,b7 as bg,IU as bh,z7 as bi,F7 as bj,X8 as bk,c7 as bl,u7 as bm,lT as bn,N7 as bo,P7 as bp,k7 as bq,EU as br,dT as bs,A7 as bt,C7 as bu,a7 as bv,kU as bw,D7 as bx,O7 as by,qU as bz,fw as c,ZB as c$,ui as c0,Ni as c1,pm as c2,Z7 as c3,Aa as c4,rc as c5,Vz as c6,J7 as c7,RW as c8,Jv as c9,wW as cA,hW as cB,iB as cC,kW as cD,MW as cE,VW as cF,AW as cG,wB as cH,_B as cI,sW as cJ,JU as cK,oB as cL,PW as cM,OW as cN,jW as cO,h$ as cP,EW as cQ,dB as cR,lB as cS,dW as cT,yD as cU,iW as cV,Zx as cW,aW as cX,mD as cY,fW as cZ,NW as c_,X7 as ca,Fz as cb,uS as cc,so as cd,cW as ce,vB as cf,CW as cg,md as ch,jz as ci,pd as cj,cB as ck,lW as cl,j$ as cm,fD as cn,tW as co,bW as cp,mW as cq,vW as cr,Gz as cs,rW as ct,c$ as cu,TW as cv,FW as cw,vT as cx,UB as cy,M$ as cz,zs as d,LW as d0,xB as d1,oW as d2,IW as d3,yW as d4,_W as d5,DW as d6,gW as d7,SW as d8,xW as d9,pW as da,uW as db,yi as dc,H as dd,Us as de,De as df,a8 as dg,UW as dh,$W as di,yc as e,$8 as f,ZF as g,U8 as h,L8 as i,v8 as j,w8 as k,N8 as l,D8 as m,P8 as n,$e as o,XF as p,O8 as q,JR as r,OC as s,M8 as t,V8 as u,Pw as v,E8 as w,b8 as x,MF as y,f8 as z};
