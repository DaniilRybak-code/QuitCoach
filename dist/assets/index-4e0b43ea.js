(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function t2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Eb={exports:{}},Mp={},Tb={exports:{}},Ne={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gd=Symbol.for("react.element"),n2=Symbol.for("react.portal"),r2=Symbol.for("react.fragment"),s2=Symbol.for("react.strict_mode"),i2=Symbol.for("react.profiler"),o2=Symbol.for("react.provider"),a2=Symbol.for("react.context"),l2=Symbol.for("react.forward_ref"),c2=Symbol.for("react.suspense"),u2=Symbol.for("react.memo"),d2=Symbol.for("react.lazy"),mE=Symbol.iterator;function h2(n){return n===null||typeof n!="object"?null:(n=mE&&n[mE]||n["@@iterator"],typeof n=="function"?n:null)}var xb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Sb=Object.assign,bb={};function Bl(n,e,t){this.props=n,this.context=e,this.refs=bb,this.updater=t||xb}Bl.prototype.isReactComponent={};Bl.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Bl.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Ab(){}Ab.prototype=Bl.prototype;function pv(n,e,t){this.props=n,this.context=e,this.refs=bb,this.updater=t||xb}var mv=pv.prototype=new Ab;mv.constructor=pv;Sb(mv,Bl.prototype);mv.isPureReactComponent=!0;var gE=Array.isArray,Cb=Object.prototype.hasOwnProperty,gv={current:null},Rb={key:!0,ref:!0,__self:!0,__source:!0};function Nb(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Cb.call(e,r)&&!Rb.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:gd,type:n,key:i,ref:o,props:s,_owner:gv.current}}function f2(n,e){return{$$typeof:gd,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function yv(n){return typeof n=="object"&&n!==null&&n.$$typeof===gd}function p2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var yE=/\/+/g;function gg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?p2(""+n.key):e.toString(36)}function Kh(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case gd:case n2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+gg(o,0):r,gE(s)?(t="",n!=null&&(t=n.replace(yE,"$&/")+"/"),Kh(s,e,t,"",function(u){return u})):s!=null&&(yv(s)&&(s=f2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(yE,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",gE(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+gg(i,a);o+=Kh(i,e,t,l,s)}else if(l=h2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+gg(i,a++),o+=Kh(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function mh(n,e,t){if(n==null)return n;var r=[],s=0;return Kh(n,r,"","",function(i){return e.call(t,i,s++)}),r}function m2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Mn={current:null},Qh={transition:null},g2={ReactCurrentDispatcher:Mn,ReactCurrentBatchConfig:Qh,ReactCurrentOwner:gv};function Pb(){throw Error("act(...) is not supported in production builds of React.")}Ne.Children={map:mh,forEach:function(n,e,t){mh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return mh(n,function(){e++}),e},toArray:function(n){return mh(n,function(e){return e})||[]},only:function(n){if(!yv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ne.Component=Bl;Ne.Fragment=r2;Ne.Profiler=i2;Ne.PureComponent=pv;Ne.StrictMode=s2;Ne.Suspense=c2;Ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=g2;Ne.act=Pb;Ne.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Sb({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=gv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Cb.call(e,l)&&!Rb.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:gd,type:n.type,key:s,ref:i,props:r,_owner:o}};Ne.createContext=function(n){return n={$$typeof:a2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:o2,_context:n},n.Consumer=n};Ne.createElement=Nb;Ne.createFactory=function(n){var e=Nb.bind(null,n);return e.type=n,e};Ne.createRef=function(){return{current:null}};Ne.forwardRef=function(n){return{$$typeof:l2,render:n}};Ne.isValidElement=yv;Ne.lazy=function(n){return{$$typeof:d2,_payload:{_status:-1,_result:n},_init:m2}};Ne.memo=function(n,e){return{$$typeof:u2,type:n,compare:e===void 0?null:e}};Ne.startTransition=function(n){var e=Qh.transition;Qh.transition={};try{n()}finally{Qh.transition=e}};Ne.unstable_act=Pb;Ne.useCallback=function(n,e){return Mn.current.useCallback(n,e)};Ne.useContext=function(n){return Mn.current.useContext(n)};Ne.useDebugValue=function(){};Ne.useDeferredValue=function(n){return Mn.current.useDeferredValue(n)};Ne.useEffect=function(n,e){return Mn.current.useEffect(n,e)};Ne.useId=function(){return Mn.current.useId()};Ne.useImperativeHandle=function(n,e,t){return Mn.current.useImperativeHandle(n,e,t)};Ne.useInsertionEffect=function(n,e){return Mn.current.useInsertionEffect(n,e)};Ne.useLayoutEffect=function(n,e){return Mn.current.useLayoutEffect(n,e)};Ne.useMemo=function(n,e){return Mn.current.useMemo(n,e)};Ne.useReducer=function(n,e,t){return Mn.current.useReducer(n,e,t)};Ne.useRef=function(n){return Mn.current.useRef(n)};Ne.useState=function(n){return Mn.current.useState(n)};Ne.useSyncExternalStore=function(n,e,t){return Mn.current.useSyncExternalStore(n,e,t)};Ne.useTransition=function(){return Mn.current.useTransition()};Ne.version="18.3.1";Tb.exports=Ne;var j=Tb.exports;const y2=t2(j);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2=j,v2=Symbol.for("react.element"),w2=Symbol.for("react.fragment"),I2=Object.prototype.hasOwnProperty,E2=_2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,T2={key:!0,ref:!0,__self:!0,__source:!0};function kb(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)I2.call(e,r)&&!T2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:v2,type:n,key:i,ref:o,props:s,_owner:E2.current}}Mp.Fragment=w2;Mp.jsx=kb;Mp.jsxs=kb;Eb.exports=Mp;var d=Eb.exports,wy={},Db={exports:{}},fr={},Ob={exports:{}},Mb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(W,le){var ce=W.length;W.push(le);e:for(;0<ce;){var ke=ce-1>>>1,ue=W[ke];if(0<s(ue,le))W[ke]=le,W[ce]=ue,ce=ke;else break e}}function t(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var le=W[0],ce=W.pop();if(ce!==le){W[0]=ce;e:for(var ke=0,ue=W.length,ie=ue>>>1;ke<ie;){var Ve=2*(ke+1)-1,vt=W[Ve],bn=Ve+1,fn=W[bn];if(0>s(vt,ce))bn<ue&&0>s(fn,vt)?(W[ke]=fn,W[bn]=ce,ke=bn):(W[ke]=vt,W[Ve]=ce,ke=Ve);else if(bn<ue&&0>s(fn,ce))W[ke]=fn,W[bn]=ce,ke=bn;else break e}}return le}function s(W,le){var ce=W.sortIndex-le.sortIndex;return ce!==0?ce:W.id-le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,p=3,_=!1,T=!1,b=!1,k=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(W){for(var le=t(u);le!==null;){if(le.callback===null)r(u);else if(le.startTime<=W)r(u),le.sortIndex=le.expirationTime,e(l,le);else break;le=t(u)}}function P(W){if(b=!1,R(W),!T)if(t(l)!==null)T=!0,he(U);else{var le=t(u);le!==null&&Fe(P,le.startTime-W)}}function U(W,le){T=!1,b&&(b=!1,C(w),w=-1),_=!0;var ce=p;try{for(R(le),f=t(l);f!==null&&(!(f.expirationTime>le)||W&&!v());){var ke=f.callback;if(typeof ke=="function"){f.callback=null,p=f.priorityLevel;var ue=ke(f.expirationTime<=le);le=n.unstable_now(),typeof ue=="function"?f.callback=ue:f===t(l)&&r(l),R(le)}else r(l);f=t(l)}if(f!==null)var ie=!0;else{var Ve=t(u);Ve!==null&&Fe(P,Ve.startTime-le),ie=!1}return ie}finally{f=null,p=ce,_=!1}}var F=!1,A=null,w=-1,E=5,y=-1;function v(){return!(n.unstable_now()-y<E)}function N(){if(A!==null){var W=n.unstable_now();y=W;var le=!0;try{le=A(!0,W)}finally{le?S():(F=!1,A=null)}}else F=!1}var S;if(typeof x=="function")S=function(){x(N)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ge=X.port2;X.port1.onmessage=N,S=function(){ge.postMessage(null)}}else S=function(){k(N,0)};function he(W){A=W,F||(F=!0,S())}function Fe(W,le){w=k(function(){W(n.unstable_now())},le)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_continueExecution=function(){T||_||(T=!0,he(U))},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(W){switch(p){case 1:case 2:case 3:var le=3;break;default:le=p}var ce=p;p=le;try{return W()}finally{p=ce}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(W,le){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var ce=p;p=W;try{return le()}finally{p=ce}},n.unstable_scheduleCallback=function(W,le,ce){var ke=n.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?ke+ce:ke):ce=ke,W){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=ce+ue,W={id:h++,callback:le,priorityLevel:W,startTime:ce,expirationTime:ue,sortIndex:-1},ce>ke?(W.sortIndex=ce,e(u,W),t(l)===null&&W===t(u)&&(b?(C(w),w=-1):b=!0,Fe(P,ce-ke))):(W.sortIndex=ue,e(l,W),T||_||(T=!0,he(U))),W},n.unstable_shouldYield=v,n.unstable_wrapCallback=function(W){var le=p;return function(){var ce=p;p=le;try{return W.apply(this,arguments)}finally{p=ce}}}})(Mb);Ob.exports=Mb;var x2=Ob.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S2=j,cr=x2;function q(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Vb=new Set,Tu={};function na(n,e){ll(n,e),ll(n+"Capture",e)}function ll(n,e){for(Tu[n]=e,n=0;n<e.length;n++)Vb.add(e[n])}var Rs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Iy=Object.prototype.hasOwnProperty,b2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_E={},vE={};function A2(n){return Iy.call(vE,n)?!0:Iy.call(_E,n)?!1:b2.test(n)?vE[n]=!0:(_E[n]=!0,!1)}function C2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function R2(n,e,t,r){if(e===null||typeof e>"u"||C2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Vn(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var hn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){hn[n]=new Vn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];hn[e]=new Vn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){hn[n]=new Vn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){hn[n]=new Vn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){hn[n]=new Vn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){hn[n]=new Vn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){hn[n]=new Vn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){hn[n]=new Vn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){hn[n]=new Vn(n,5,!1,n.toLowerCase(),null,!1,!1)});var _v=/[\-:]([a-z])/g;function vv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(_v,vv);hn[e]=new Vn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(_v,vv);hn[e]=new Vn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(_v,vv);hn[e]=new Vn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){hn[n]=new Vn(n,1,!1,n.toLowerCase(),null,!1,!1)});hn.xlinkHref=new Vn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){hn[n]=new Vn(n,1,!1,n.toLowerCase(),null,!0,!0)});function wv(n,e,t,r){var s=hn.hasOwnProperty(e)?hn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(R2(e,t,s,r)&&(t=null),r||s===null?A2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Us=S2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gh=Symbol.for("react.element"),Va=Symbol.for("react.portal"),La=Symbol.for("react.fragment"),Iv=Symbol.for("react.strict_mode"),Ey=Symbol.for("react.profiler"),Lb=Symbol.for("react.provider"),Fb=Symbol.for("react.context"),Ev=Symbol.for("react.forward_ref"),Ty=Symbol.for("react.suspense"),xy=Symbol.for("react.suspense_list"),Tv=Symbol.for("react.memo"),ni=Symbol.for("react.lazy"),jb=Symbol.for("react.offscreen"),wE=Symbol.iterator;function _c(n){return n===null||typeof n!="object"?null:(n=wE&&n[wE]||n["@@iterator"],typeof n=="function"?n:null)}var bt=Object.assign,yg;function Vc(n){if(yg===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);yg=e&&e[1]||""}return`
`+yg+n}var _g=!1;function vg(n,e){if(!n||_g)return"";_g=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{_g=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Vc(n):""}function N2(n){switch(n.tag){case 5:return Vc(n.type);case 16:return Vc("Lazy");case 13:return Vc("Suspense");case 19:return Vc("SuspenseList");case 0:case 2:case 15:return n=vg(n.type,!1),n;case 11:return n=vg(n.type.render,!1),n;case 1:return n=vg(n.type,!0),n;default:return""}}function Sy(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case La:return"Fragment";case Va:return"Portal";case Ey:return"Profiler";case Iv:return"StrictMode";case Ty:return"Suspense";case xy:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Fb:return(n.displayName||"Context")+".Consumer";case Lb:return(n._context.displayName||"Context")+".Provider";case Ev:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Tv:return e=n.displayName||null,e!==null?e:Sy(n.type)||"Memo";case ni:e=n._payload,n=n._init;try{return Sy(n(e))}catch{}}return null}function P2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Sy(e);case 8:return e===Iv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Oi(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ub(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function k2(n){var e=Ub(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function yh(n){n._valueTracker||(n._valueTracker=k2(n))}function Bb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Ub(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Sf(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function by(n,e){var t=e.checked;return bt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function IE(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Oi(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function $b(n,e){e=e.checked,e!=null&&wv(n,"checked",e,!1)}function Ay(n,e){$b(n,e);var t=Oi(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Cy(n,e.type,t):e.hasOwnProperty("defaultValue")&&Cy(n,e.type,Oi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function EE(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Cy(n,e,t){(e!=="number"||Sf(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Lc=Array.isArray;function Ka(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Oi(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Ry(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(q(91));return bt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function TE(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(q(92));if(Lc(t)){if(1<t.length)throw Error(q(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Oi(t)}}function zb(n,e){var t=Oi(e.value),r=Oi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function xE(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function qb(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ny(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?qb(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var _h,Wb=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(_h=_h||document.createElement("div"),_h.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=_h.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function xu(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Qc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},D2=["Webkit","ms","Moz","O"];Object.keys(Qc).forEach(function(n){D2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Qc[e]=Qc[n]})});function Gb(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Qc.hasOwnProperty(n)&&Qc[n]?(""+e).trim():e+"px"}function Hb(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Gb(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var O2=bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Py(n,e){if(e){if(O2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(q(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(q(62))}}function ky(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dy=null;function xv(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Oy=null,Qa=null,Ya=null;function SE(n){if(n=vd(n)){if(typeof Oy!="function")throw Error(q(280));var e=n.stateNode;e&&(e=Up(e),Oy(n.stateNode,n.type,e))}}function Kb(n){Qa?Ya?Ya.push(n):Ya=[n]:Qa=n}function Qb(){if(Qa){var n=Qa,e=Ya;if(Ya=Qa=null,SE(n),e)for(n=0;n<e.length;n++)SE(e[n])}}function Yb(n,e){return n(e)}function Jb(){}var wg=!1;function Xb(n,e,t){if(wg)return n(e,t);wg=!0;try{return Yb(n,e,t)}finally{wg=!1,(Qa!==null||Ya!==null)&&(Jb(),Qb())}}function Su(n,e){var t=n.stateNode;if(t===null)return null;var r=Up(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(q(231,e,typeof t));return t}var My=!1;if(Rs)try{var vc={};Object.defineProperty(vc,"passive",{get:function(){My=!0}}),window.addEventListener("test",vc,vc),window.removeEventListener("test",vc,vc)}catch{My=!1}function M2(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var Yc=!1,bf=null,Af=!1,Vy=null,V2={onError:function(n){Yc=!0,bf=n}};function L2(n,e,t,r,s,i,o,a,l){Yc=!1,bf=null,M2.apply(V2,arguments)}function F2(n,e,t,r,s,i,o,a,l){if(L2.apply(this,arguments),Yc){if(Yc){var u=bf;Yc=!1,bf=null}else throw Error(q(198));Af||(Af=!0,Vy=u)}}function ra(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Zb(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function bE(n){if(ra(n)!==n)throw Error(q(188))}function j2(n){var e=n.alternate;if(!e){if(e=ra(n),e===null)throw Error(q(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return bE(s),n;if(i===r)return bE(s),e;i=i.sibling}throw Error(q(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(q(189))}}if(t.alternate!==r)throw Error(q(190))}if(t.tag!==3)throw Error(q(188));return t.stateNode.current===t?n:e}function e1(n){return n=j2(n),n!==null?t1(n):null}function t1(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=t1(n);if(e!==null)return e;n=n.sibling}return null}var n1=cr.unstable_scheduleCallback,AE=cr.unstable_cancelCallback,U2=cr.unstable_shouldYield,B2=cr.unstable_requestPaint,Vt=cr.unstable_now,$2=cr.unstable_getCurrentPriorityLevel,Sv=cr.unstable_ImmediatePriority,r1=cr.unstable_UserBlockingPriority,Cf=cr.unstable_NormalPriority,z2=cr.unstable_LowPriority,s1=cr.unstable_IdlePriority,Vp=null,ns=null;function q2(n){if(ns&&typeof ns.onCommitFiberRoot=="function")try{ns.onCommitFiberRoot(Vp,n,void 0,(n.current.flags&128)===128)}catch{}}var Vr=Math.clz32?Math.clz32:H2,W2=Math.log,G2=Math.LN2;function H2(n){return n>>>=0,n===0?32:31-(W2(n)/G2|0)|0}var vh=64,wh=4194304;function Fc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Rf(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Fc(a):(i&=o,i!==0&&(r=Fc(i)))}else o=t&~s,o!==0?r=Fc(o):i!==0&&(r=Fc(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Vr(e),s=1<<t,r|=n[t],e&=~s;return r}function K2(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Q2(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-Vr(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=K2(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function Ly(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function i1(){var n=vh;return vh<<=1,!(vh&4194240)&&(vh=64),n}function Ig(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function yd(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Vr(e),n[e]=t}function Y2(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Vr(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function bv(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Vr(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var He=0;function o1(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var a1,Av,l1,c1,u1,Fy=!1,Ih=[],vi=null,wi=null,Ii=null,bu=new Map,Au=new Map,si=[],J2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function CE(n,e){switch(n){case"focusin":case"focusout":vi=null;break;case"dragenter":case"dragleave":wi=null;break;case"mouseover":case"mouseout":Ii=null;break;case"pointerover":case"pointerout":bu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Au.delete(e.pointerId)}}function wc(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=vd(e),e!==null&&Av(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function X2(n,e,t,r,s){switch(e){case"focusin":return vi=wc(vi,n,e,t,r,s),!0;case"dragenter":return wi=wc(wi,n,e,t,r,s),!0;case"mouseover":return Ii=wc(Ii,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return bu.set(i,wc(bu.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Au.set(i,wc(Au.get(i)||null,n,e,t,r,s)),!0}return!1}function d1(n){var e=wo(n.target);if(e!==null){var t=ra(e);if(t!==null){if(e=t.tag,e===13){if(e=Zb(t),e!==null){n.blockedOn=e,u1(n.priority,function(){l1(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Yh(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=jy(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Dy=r,t.target.dispatchEvent(r),Dy=null}else return e=vd(t),e!==null&&Av(e),n.blockedOn=t,!1;e.shift()}return!0}function RE(n,e,t){Yh(n)&&t.delete(e)}function Z2(){Fy=!1,vi!==null&&Yh(vi)&&(vi=null),wi!==null&&Yh(wi)&&(wi=null),Ii!==null&&Yh(Ii)&&(Ii=null),bu.forEach(RE),Au.forEach(RE)}function Ic(n,e){n.blockedOn===e&&(n.blockedOn=null,Fy||(Fy=!0,cr.unstable_scheduleCallback(cr.unstable_NormalPriority,Z2)))}function Cu(n){function e(s){return Ic(s,n)}if(0<Ih.length){Ic(Ih[0],n);for(var t=1;t<Ih.length;t++){var r=Ih[t];r.blockedOn===n&&(r.blockedOn=null)}}for(vi!==null&&Ic(vi,n),wi!==null&&Ic(wi,n),Ii!==null&&Ic(Ii,n),bu.forEach(e),Au.forEach(e),t=0;t<si.length;t++)r=si[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<si.length&&(t=si[0],t.blockedOn===null);)d1(t),t.blockedOn===null&&si.shift()}var Ja=Us.ReactCurrentBatchConfig,Nf=!0;function eO(n,e,t,r){var s=He,i=Ja.transition;Ja.transition=null;try{He=1,Cv(n,e,t,r)}finally{He=s,Ja.transition=i}}function tO(n,e,t,r){var s=He,i=Ja.transition;Ja.transition=null;try{He=4,Cv(n,e,t,r)}finally{He=s,Ja.transition=i}}function Cv(n,e,t,r){if(Nf){var s=jy(n,e,t,r);if(s===null)Pg(n,e,r,Pf,t),CE(n,r);else if(X2(s,n,e,t,r))r.stopPropagation();else if(CE(n,r),e&4&&-1<J2.indexOf(n)){for(;s!==null;){var i=vd(s);if(i!==null&&a1(i),i=jy(n,e,t,r),i===null&&Pg(n,e,r,Pf,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else Pg(n,e,r,null,t)}}var Pf=null;function jy(n,e,t,r){if(Pf=null,n=xv(r),n=wo(n),n!==null)if(e=ra(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Zb(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Pf=n,null}function h1(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($2()){case Sv:return 1;case r1:return 4;case Cf:case z2:return 16;case s1:return 536870912;default:return 16}default:return 16}}var di=null,Rv=null,Jh=null;function f1(){if(Jh)return Jh;var n,e=Rv,t=e.length,r,s="value"in di?di.value:di.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Jh=s.slice(n,1<r?1-r:void 0)}function Xh(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Eh(){return!0}function NE(){return!1}function pr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Eh:NE,this.isPropagationStopped=NE,this}return bt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Eh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Eh)},persist:function(){},isPersistent:Eh}),e}var $l={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nv=pr($l),_d=bt({},$l,{view:0,detail:0}),nO=pr(_d),Eg,Tg,Ec,Lp=bt({},_d,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pv,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ec&&(Ec&&n.type==="mousemove"?(Eg=n.screenX-Ec.screenX,Tg=n.screenY-Ec.screenY):Tg=Eg=0,Ec=n),Eg)},movementY:function(n){return"movementY"in n?n.movementY:Tg}}),PE=pr(Lp),rO=bt({},Lp,{dataTransfer:0}),sO=pr(rO),iO=bt({},_d,{relatedTarget:0}),xg=pr(iO),oO=bt({},$l,{animationName:0,elapsedTime:0,pseudoElement:0}),aO=pr(oO),lO=bt({},$l,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),cO=pr(lO),uO=bt({},$l,{data:0}),kE=pr(uO),dO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=fO[n])?!!e[n]:!1}function Pv(){return pO}var mO=bt({},_d,{key:function(n){if(n.key){var e=dO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Xh(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?hO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pv,charCode:function(n){return n.type==="keypress"?Xh(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Xh(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),gO=pr(mO),yO=bt({},Lp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),DE=pr(yO),_O=bt({},_d,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pv}),vO=pr(_O),wO=bt({},$l,{propertyName:0,elapsedTime:0,pseudoElement:0}),IO=pr(wO),EO=bt({},Lp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),TO=pr(EO),xO=[9,13,27,32],kv=Rs&&"CompositionEvent"in window,Jc=null;Rs&&"documentMode"in document&&(Jc=document.documentMode);var SO=Rs&&"TextEvent"in window&&!Jc,p1=Rs&&(!kv||Jc&&8<Jc&&11>=Jc),OE=String.fromCharCode(32),ME=!1;function m1(n,e){switch(n){case"keyup":return xO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function g1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Fa=!1;function bO(n,e){switch(n){case"compositionend":return g1(e);case"keypress":return e.which!==32?null:(ME=!0,OE);case"textInput":return n=e.data,n===OE&&ME?null:n;default:return null}}function AO(n,e){if(Fa)return n==="compositionend"||!kv&&m1(n,e)?(n=f1(),Jh=Rv=di=null,Fa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return p1&&e.locale!=="ko"?null:e.data;default:return null}}var CO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function VE(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!CO[n.type]:e==="textarea"}function y1(n,e,t,r){Kb(r),e=kf(e,"onChange"),0<e.length&&(t=new Nv("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Xc=null,Ru=null;function RO(n){C1(n,0)}function Fp(n){var e=Ba(n);if(Bb(e))return n}function NO(n,e){if(n==="change")return e}var _1=!1;if(Rs){var Sg;if(Rs){var bg="oninput"in document;if(!bg){var LE=document.createElement("div");LE.setAttribute("oninput","return;"),bg=typeof LE.oninput=="function"}Sg=bg}else Sg=!1;_1=Sg&&(!document.documentMode||9<document.documentMode)}function FE(){Xc&&(Xc.detachEvent("onpropertychange",v1),Ru=Xc=null)}function v1(n){if(n.propertyName==="value"&&Fp(Ru)){var e=[];y1(e,Ru,n,xv(n)),Xb(RO,e)}}function PO(n,e,t){n==="focusin"?(FE(),Xc=e,Ru=t,Xc.attachEvent("onpropertychange",v1)):n==="focusout"&&FE()}function kO(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Fp(Ru)}function DO(n,e){if(n==="click")return Fp(e)}function OO(n,e){if(n==="input"||n==="change")return Fp(e)}function MO(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ur=typeof Object.is=="function"?Object.is:MO;function Nu(n,e){if(Ur(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Iy.call(e,s)||!Ur(n[s],e[s]))return!1}return!0}function jE(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function UE(n,e){var t=jE(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=jE(t)}}function w1(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?w1(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function I1(){for(var n=window,e=Sf();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Sf(n.document)}return e}function Dv(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function VO(n){var e=I1(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&w1(t.ownerDocument.documentElement,t)){if(r!==null&&Dv(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=UE(t,i);var o=UE(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var LO=Rs&&"documentMode"in document&&11>=document.documentMode,ja=null,Uy=null,Zc=null,By=!1;function BE(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;By||ja==null||ja!==Sf(r)||(r=ja,"selectionStart"in r&&Dv(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Zc&&Nu(Zc,r)||(Zc=r,r=kf(Uy,"onSelect"),0<r.length&&(e=new Nv("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=ja)))}function Th(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ua={animationend:Th("Animation","AnimationEnd"),animationiteration:Th("Animation","AnimationIteration"),animationstart:Th("Animation","AnimationStart"),transitionend:Th("Transition","TransitionEnd")},Ag={},E1={};Rs&&(E1=document.createElement("div").style,"AnimationEvent"in window||(delete Ua.animationend.animation,delete Ua.animationiteration.animation,delete Ua.animationstart.animation),"TransitionEvent"in window||delete Ua.transitionend.transition);function jp(n){if(Ag[n])return Ag[n];if(!Ua[n])return n;var e=Ua[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in E1)return Ag[n]=e[t];return n}var T1=jp("animationend"),x1=jp("animationiteration"),S1=jp("animationstart"),b1=jp("transitionend"),A1=new Map,$E="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ki(n,e){A1.set(n,e),na(e,[n])}for(var Cg=0;Cg<$E.length;Cg++){var Rg=$E[Cg],FO=Rg.toLowerCase(),jO=Rg[0].toUpperCase()+Rg.slice(1);Ki(FO,"on"+jO)}Ki(T1,"onAnimationEnd");Ki(x1,"onAnimationIteration");Ki(S1,"onAnimationStart");Ki("dblclick","onDoubleClick");Ki("focusin","onFocus");Ki("focusout","onBlur");Ki(b1,"onTransitionEnd");ll("onMouseEnter",["mouseout","mouseover"]);ll("onMouseLeave",["mouseout","mouseover"]);ll("onPointerEnter",["pointerout","pointerover"]);ll("onPointerLeave",["pointerout","pointerover"]);na("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));na("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));na("onBeforeInput",["compositionend","keypress","textInput","paste"]);na("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));na("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));na("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UO=new Set("cancel close invalid load scroll toggle".split(" ").concat(jc));function zE(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,F2(r,e,void 0,n),n.currentTarget=null}function C1(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;zE(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;zE(s,a,u),i=l}}}if(Af)throw n=Vy,Af=!1,Vy=null,n}function lt(n,e){var t=e[Gy];t===void 0&&(t=e[Gy]=new Set);var r=n+"__bubble";t.has(r)||(R1(e,n,2,!1),t.add(r))}function Ng(n,e,t){var r=0;e&&(r|=4),R1(t,n,r,e)}var xh="_reactListening"+Math.random().toString(36).slice(2);function Pu(n){if(!n[xh]){n[xh]=!0,Vb.forEach(function(t){t!=="selectionchange"&&(UO.has(t)||Ng(t,!1,n),Ng(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[xh]||(e[xh]=!0,Ng("selectionchange",!1,e))}}function R1(n,e,t,r){switch(h1(e)){case 1:var s=eO;break;case 4:s=tO;break;default:s=Cv}t=s.bind(null,e,t,n),s=void 0,!My||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function Pg(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=wo(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}Xb(function(){var u=i,h=xv(t),f=[];e:{var p=A1.get(n);if(p!==void 0){var _=Nv,T=n;switch(n){case"keypress":if(Xh(t)===0)break e;case"keydown":case"keyup":_=gO;break;case"focusin":T="focus",_=xg;break;case"focusout":T="blur",_=xg;break;case"beforeblur":case"afterblur":_=xg;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=PE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=sO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=vO;break;case T1:case x1:case S1:_=aO;break;case b1:_=IO;break;case"scroll":_=nO;break;case"wheel":_=TO;break;case"copy":case"cut":case"paste":_=cO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=DE}var b=(e&4)!==0,k=!b&&n==="scroll",C=b?p!==null?p+"Capture":null:p;b=[];for(var x=u,R;x!==null;){R=x;var P=R.stateNode;if(R.tag===5&&P!==null&&(R=P,C!==null&&(P=Su(x,C),P!=null&&b.push(ku(x,P,R)))),k)break;x=x.return}0<b.length&&(p=new _(p,T,null,t,h),f.push({event:p,listeners:b}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",_=n==="mouseout"||n==="pointerout",p&&t!==Dy&&(T=t.relatedTarget||t.fromElement)&&(wo(T)||T[Ns]))break e;if((_||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,_?(T=t.relatedTarget||t.toElement,_=u,T=T?wo(T):null,T!==null&&(k=ra(T),T!==k||T.tag!==5&&T.tag!==6)&&(T=null)):(_=null,T=u),_!==T)){if(b=PE,P="onMouseLeave",C="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(b=DE,P="onPointerLeave",C="onPointerEnter",x="pointer"),k=_==null?p:Ba(_),R=T==null?p:Ba(T),p=new b(P,x+"leave",_,t,h),p.target=k,p.relatedTarget=R,P=null,wo(h)===u&&(b=new b(C,x+"enter",T,t,h),b.target=R,b.relatedTarget=k,P=b),k=P,_&&T)t:{for(b=_,C=T,x=0,R=b;R;R=xa(R))x++;for(R=0,P=C;P;P=xa(P))R++;for(;0<x-R;)b=xa(b),x--;for(;0<R-x;)C=xa(C),R--;for(;x--;){if(b===C||C!==null&&b===C.alternate)break t;b=xa(b),C=xa(C)}b=null}else b=null;_!==null&&qE(f,p,_,b,!1),T!==null&&k!==null&&qE(f,k,T,b,!0)}}e:{if(p=u?Ba(u):window,_=p.nodeName&&p.nodeName.toLowerCase(),_==="select"||_==="input"&&p.type==="file")var U=NO;else if(VE(p))if(_1)U=OO;else{U=kO;var F=PO}else(_=p.nodeName)&&_.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(U=DO);if(U&&(U=U(n,u))){y1(f,U,t,h);break e}F&&F(n,p,u),n==="focusout"&&(F=p._wrapperState)&&F.controlled&&p.type==="number"&&Cy(p,"number",p.value)}switch(F=u?Ba(u):window,n){case"focusin":(VE(F)||F.contentEditable==="true")&&(ja=F,Uy=u,Zc=null);break;case"focusout":Zc=Uy=ja=null;break;case"mousedown":By=!0;break;case"contextmenu":case"mouseup":case"dragend":By=!1,BE(f,t,h);break;case"selectionchange":if(LO)break;case"keydown":case"keyup":BE(f,t,h)}var A;if(kv)e:{switch(n){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Fa?m1(n,t)&&(w="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(w="onCompositionStart");w&&(p1&&t.locale!=="ko"&&(Fa||w!=="onCompositionStart"?w==="onCompositionEnd"&&Fa&&(A=f1()):(di=h,Rv="value"in di?di.value:di.textContent,Fa=!0)),F=kf(u,w),0<F.length&&(w=new kE(w,n,null,t,h),f.push({event:w,listeners:F}),A?w.data=A:(A=g1(t),A!==null&&(w.data=A)))),(A=SO?bO(n,t):AO(n,t))&&(u=kf(u,"onBeforeInput"),0<u.length&&(h=new kE("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=A))}C1(f,e)})}function ku(n,e,t){return{instance:n,listener:e,currentTarget:t}}function kf(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Su(n,t),i!=null&&r.unshift(ku(n,i,s)),i=Su(n,e),i!=null&&r.push(ku(n,i,s))),n=n.return}return r}function xa(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function qE(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Su(t,i),l!=null&&o.unshift(ku(t,l,a))):s||(l=Su(t,i),l!=null&&o.push(ku(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var BO=/\r\n?/g,$O=/\u0000|\uFFFD/g;function WE(n){return(typeof n=="string"?n:""+n).replace(BO,`
`).replace($O,"")}function Sh(n,e,t){if(e=WE(e),WE(n)!==e&&t)throw Error(q(425))}function Df(){}var $y=null,zy=null;function qy(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Wy=typeof setTimeout=="function"?setTimeout:void 0,zO=typeof clearTimeout=="function"?clearTimeout:void 0,GE=typeof Promise=="function"?Promise:void 0,qO=typeof queueMicrotask=="function"?queueMicrotask:typeof GE<"u"?function(n){return GE.resolve(null).then(n).catch(WO)}:Wy;function WO(n){setTimeout(function(){throw n})}function kg(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Cu(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Cu(e)}function Ei(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function HE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var zl=Math.random().toString(36).slice(2),Yr="__reactFiber$"+zl,Du="__reactProps$"+zl,Ns="__reactContainer$"+zl,Gy="__reactEvents$"+zl,GO="__reactListeners$"+zl,HO="__reactHandles$"+zl;function wo(n){var e=n[Yr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ns]||t[Yr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=HE(n);n!==null;){if(t=n[Yr])return t;n=HE(n)}return e}n=t,t=n.parentNode}return null}function vd(n){return n=n[Yr]||n[Ns],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ba(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(q(33))}function Up(n){return n[Du]||null}var Hy=[],$a=-1;function Qi(n){return{current:n}}function ut(n){0>$a||(n.current=Hy[$a],Hy[$a]=null,$a--)}function st(n,e){$a++,Hy[$a]=n.current,n.current=e}var Mi={},Sn=Qi(Mi),qn=Qi(!1),Oo=Mi;function cl(n,e){var t=n.type.contextTypes;if(!t)return Mi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Wn(n){return n=n.childContextTypes,n!=null}function Of(){ut(qn),ut(Sn)}function KE(n,e,t){if(Sn.current!==Mi)throw Error(q(168));st(Sn,e),st(qn,t)}function N1(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(q(108,P2(n)||"Unknown",s));return bt({},t,r)}function Mf(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Mi,Oo=Sn.current,st(Sn,n),st(qn,qn.current),!0}function QE(n,e,t){var r=n.stateNode;if(!r)throw Error(q(169));t?(n=N1(n,e,Oo),r.__reactInternalMemoizedMergedChildContext=n,ut(qn),ut(Sn),st(Sn,n)):ut(qn),st(qn,t)}var vs=null,Bp=!1,Dg=!1;function P1(n){vs===null?vs=[n]:vs.push(n)}function KO(n){Bp=!0,P1(n)}function Yi(){if(!Dg&&vs!==null){Dg=!0;var n=0,e=He;try{var t=vs;for(He=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}vs=null,Bp=!1}catch(s){throw vs!==null&&(vs=vs.slice(n+1)),n1(Sv,Yi),s}finally{He=e,Dg=!1}}return null}var za=[],qa=0,Vf=null,Lf=0,yr=[],_r=0,Mo=null,Is=1,Es="";function co(n,e){za[qa++]=Lf,za[qa++]=Vf,Vf=n,Lf=e}function k1(n,e,t){yr[_r++]=Is,yr[_r++]=Es,yr[_r++]=Mo,Mo=n;var r=Is;n=Es;var s=32-Vr(r)-1;r&=~(1<<s),t+=1;var i=32-Vr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Is=1<<32-Vr(e)+s|t<<s|r,Es=i+n}else Is=1<<i|t<<s|r,Es=n}function Ov(n){n.return!==null&&(co(n,1),k1(n,1,0))}function Mv(n){for(;n===Vf;)Vf=za[--qa],za[qa]=null,Lf=za[--qa],za[qa]=null;for(;n===Mo;)Mo=yr[--_r],yr[_r]=null,Es=yr[--_r],yr[_r]=null,Is=yr[--_r],yr[_r]=null}var ir=null,sr=null,pt=!1,Dr=null;function D1(n,e){var t=wr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function YE(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,ir=n,sr=Ei(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,ir=n,sr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Mo!==null?{id:Is,overflow:Es}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=wr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,ir=n,sr=null,!0):!1;default:return!1}}function Ky(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Qy(n){if(pt){var e=sr;if(e){var t=e;if(!YE(n,e)){if(Ky(n))throw Error(q(418));e=Ei(t.nextSibling);var r=ir;e&&YE(n,e)?D1(r,t):(n.flags=n.flags&-4097|2,pt=!1,ir=n)}}else{if(Ky(n))throw Error(q(418));n.flags=n.flags&-4097|2,pt=!1,ir=n}}}function JE(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ir=n}function bh(n){if(n!==ir)return!1;if(!pt)return JE(n),pt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!qy(n.type,n.memoizedProps)),e&&(e=sr)){if(Ky(n))throw O1(),Error(q(418));for(;e;)D1(n,e),e=Ei(e.nextSibling)}if(JE(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(q(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){sr=Ei(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}sr=null}}else sr=ir?Ei(n.stateNode.nextSibling):null;return!0}function O1(){for(var n=sr;n;)n=Ei(n.nextSibling)}function ul(){sr=ir=null,pt=!1}function Vv(n){Dr===null?Dr=[n]:Dr.push(n)}var QO=Us.ReactCurrentBatchConfig;function Tc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(q(309));var r=t.stateNode}if(!r)throw Error(q(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(q(284));if(!t._owner)throw Error(q(290,n))}return n}function Ah(n,e){throw n=Object.prototype.toString.call(e),Error(q(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function XE(n){var e=n._init;return e(n._payload)}function M1(n){function e(C,x){if(n){var R=C.deletions;R===null?(C.deletions=[x],C.flags|=16):R.push(x)}}function t(C,x){if(!n)return null;for(;x!==null;)e(C,x),x=x.sibling;return null}function r(C,x){for(C=new Map;x!==null;)x.key!==null?C.set(x.key,x):C.set(x.index,x),x=x.sibling;return C}function s(C,x){return C=bi(C,x),C.index=0,C.sibling=null,C}function i(C,x,R){return C.index=R,n?(R=C.alternate,R!==null?(R=R.index,R<x?(C.flags|=2,x):R):(C.flags|=2,x)):(C.flags|=1048576,x)}function o(C){return n&&C.alternate===null&&(C.flags|=2),C}function a(C,x,R,P){return x===null||x.tag!==6?(x=Ug(R,C.mode,P),x.return=C,x):(x=s(x,R),x.return=C,x)}function l(C,x,R,P){var U=R.type;return U===La?h(C,x,R.props.children,P,R.key):x!==null&&(x.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===ni&&XE(U)===x.type)?(P=s(x,R.props),P.ref=Tc(C,x,R),P.return=C,P):(P=of(R.type,R.key,R.props,null,C.mode,P),P.ref=Tc(C,x,R),P.return=C,P)}function u(C,x,R,P){return x===null||x.tag!==4||x.stateNode.containerInfo!==R.containerInfo||x.stateNode.implementation!==R.implementation?(x=Bg(R,C.mode,P),x.return=C,x):(x=s(x,R.children||[]),x.return=C,x)}function h(C,x,R,P,U){return x===null||x.tag!==7?(x=Co(R,C.mode,P,U),x.return=C,x):(x=s(x,R),x.return=C,x)}function f(C,x,R){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Ug(""+x,C.mode,R),x.return=C,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case gh:return R=of(x.type,x.key,x.props,null,C.mode,R),R.ref=Tc(C,null,x),R.return=C,R;case Va:return x=Bg(x,C.mode,R),x.return=C,x;case ni:var P=x._init;return f(C,P(x._payload),R)}if(Lc(x)||_c(x))return x=Co(x,C.mode,R,null),x.return=C,x;Ah(C,x)}return null}function p(C,x,R,P){var U=x!==null?x.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return U!==null?null:a(C,x,""+R,P);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case gh:return R.key===U?l(C,x,R,P):null;case Va:return R.key===U?u(C,x,R,P):null;case ni:return U=R._init,p(C,x,U(R._payload),P)}if(Lc(R)||_c(R))return U!==null?null:h(C,x,R,P,null);Ah(C,R)}return null}function _(C,x,R,P,U){if(typeof P=="string"&&P!==""||typeof P=="number")return C=C.get(R)||null,a(x,C,""+P,U);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case gh:return C=C.get(P.key===null?R:P.key)||null,l(x,C,P,U);case Va:return C=C.get(P.key===null?R:P.key)||null,u(x,C,P,U);case ni:var F=P._init;return _(C,x,R,F(P._payload),U)}if(Lc(P)||_c(P))return C=C.get(R)||null,h(x,C,P,U,null);Ah(x,P)}return null}function T(C,x,R,P){for(var U=null,F=null,A=x,w=x=0,E=null;A!==null&&w<R.length;w++){A.index>w?(E=A,A=null):E=A.sibling;var y=p(C,A,R[w],P);if(y===null){A===null&&(A=E);break}n&&A&&y.alternate===null&&e(C,A),x=i(y,x,w),F===null?U=y:F.sibling=y,F=y,A=E}if(w===R.length)return t(C,A),pt&&co(C,w),U;if(A===null){for(;w<R.length;w++)A=f(C,R[w],P),A!==null&&(x=i(A,x,w),F===null?U=A:F.sibling=A,F=A);return pt&&co(C,w),U}for(A=r(C,A);w<R.length;w++)E=_(A,C,w,R[w],P),E!==null&&(n&&E.alternate!==null&&A.delete(E.key===null?w:E.key),x=i(E,x,w),F===null?U=E:F.sibling=E,F=E);return n&&A.forEach(function(v){return e(C,v)}),pt&&co(C,w),U}function b(C,x,R,P){var U=_c(R);if(typeof U!="function")throw Error(q(150));if(R=U.call(R),R==null)throw Error(q(151));for(var F=U=null,A=x,w=x=0,E=null,y=R.next();A!==null&&!y.done;w++,y=R.next()){A.index>w?(E=A,A=null):E=A.sibling;var v=p(C,A,y.value,P);if(v===null){A===null&&(A=E);break}n&&A&&v.alternate===null&&e(C,A),x=i(v,x,w),F===null?U=v:F.sibling=v,F=v,A=E}if(y.done)return t(C,A),pt&&co(C,w),U;if(A===null){for(;!y.done;w++,y=R.next())y=f(C,y.value,P),y!==null&&(x=i(y,x,w),F===null?U=y:F.sibling=y,F=y);return pt&&co(C,w),U}for(A=r(C,A);!y.done;w++,y=R.next())y=_(A,C,w,y.value,P),y!==null&&(n&&y.alternate!==null&&A.delete(y.key===null?w:y.key),x=i(y,x,w),F===null?U=y:F.sibling=y,F=y);return n&&A.forEach(function(N){return e(C,N)}),pt&&co(C,w),U}function k(C,x,R,P){if(typeof R=="object"&&R!==null&&R.type===La&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case gh:e:{for(var U=R.key,F=x;F!==null;){if(F.key===U){if(U=R.type,U===La){if(F.tag===7){t(C,F.sibling),x=s(F,R.props.children),x.return=C,C=x;break e}}else if(F.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===ni&&XE(U)===F.type){t(C,F.sibling),x=s(F,R.props),x.ref=Tc(C,F,R),x.return=C,C=x;break e}t(C,F);break}else e(C,F);F=F.sibling}R.type===La?(x=Co(R.props.children,C.mode,P,R.key),x.return=C,C=x):(P=of(R.type,R.key,R.props,null,C.mode,P),P.ref=Tc(C,x,R),P.return=C,C=P)}return o(C);case Va:e:{for(F=R.key;x!==null;){if(x.key===F)if(x.tag===4&&x.stateNode.containerInfo===R.containerInfo&&x.stateNode.implementation===R.implementation){t(C,x.sibling),x=s(x,R.children||[]),x.return=C,C=x;break e}else{t(C,x);break}else e(C,x);x=x.sibling}x=Bg(R,C.mode,P),x.return=C,C=x}return o(C);case ni:return F=R._init,k(C,x,F(R._payload),P)}if(Lc(R))return T(C,x,R,P);if(_c(R))return b(C,x,R,P);Ah(C,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,x!==null&&x.tag===6?(t(C,x.sibling),x=s(x,R),x.return=C,C=x):(t(C,x),x=Ug(R,C.mode,P),x.return=C,C=x),o(C)):t(C,x)}return k}var dl=M1(!0),V1=M1(!1),Ff=Qi(null),jf=null,Wa=null,Lv=null;function Fv(){Lv=Wa=jf=null}function jv(n){var e=Ff.current;ut(Ff),n._currentValue=e}function Yy(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Xa(n,e){jf=n,Lv=Wa=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Un=!0),n.firstContext=null)}function xr(n){var e=n._currentValue;if(Lv!==n)if(n={context:n,memoizedValue:e,next:null},Wa===null){if(jf===null)throw Error(q(308));Wa=n,jf.dependencies={lanes:0,firstContext:n}}else Wa=Wa.next=n;return e}var Io=null;function Uv(n){Io===null?Io=[n]:Io.push(n)}function L1(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Uv(e)):(t.next=s.next,s.next=t),e.interleaved=t,Ps(n,r)}function Ps(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ri=!1;function Bv(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function F1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function As(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Ti(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Le&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ps(n,t)}return s=r.interleaved,s===null?(e.next=e,Uv(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ps(n,t)}function Zh(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,bv(n,t)}}function ZE(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Uf(n,e,t,r){var s=n.updateQueue;ri=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var p=a.lane,_=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:_,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var T=n,b=a;switch(p=e,_=t,b.tag){case 1:if(T=b.payload,typeof T=="function"){f=T.call(_,f,p);break e}f=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=b.payload,p=typeof T=="function"?T.call(_,f,p):T,p==null)break e;f=bt({},f,p);break e;case 2:ri=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[a]:p.push(a))}else _={eventTime:_,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=_,l=f):h=h.next=_,o|=p;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;p=a,a=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Lo|=o,n.lanes=o,n.memoizedState=f}}function eT(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(q(191,s));s.call(r)}}}var wd={},rs=Qi(wd),Ou=Qi(wd),Mu=Qi(wd);function Eo(n){if(n===wd)throw Error(q(174));return n}function $v(n,e){switch(st(Mu,e),st(Ou,n),st(rs,wd),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ny(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Ny(e,n)}ut(rs),st(rs,e)}function hl(){ut(rs),ut(Ou),ut(Mu)}function j1(n){Eo(Mu.current);var e=Eo(rs.current),t=Ny(e,n.type);e!==t&&(st(Ou,n),st(rs,t))}function zv(n){Ou.current===n&&(ut(rs),ut(Ou))}var Tt=Qi(0);function Bf(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Og=[];function qv(){for(var n=0;n<Og.length;n++)Og[n]._workInProgressVersionPrimary=null;Og.length=0}var ef=Us.ReactCurrentDispatcher,Mg=Us.ReactCurrentBatchConfig,Vo=0,St=null,qt=null,Xt=null,$f=!1,eu=!1,Vu=0,YO=0;function yn(){throw Error(q(321))}function Wv(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ur(n[t],e[t]))return!1;return!0}function Gv(n,e,t,r,s,i){if(Vo=i,St=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ef.current=n===null||n.memoizedState===null?eM:tM,n=t(r,s),eu){i=0;do{if(eu=!1,Vu=0,25<=i)throw Error(q(301));i+=1,Xt=qt=null,e.updateQueue=null,ef.current=nM,n=t(r,s)}while(eu)}if(ef.current=zf,e=qt!==null&&qt.next!==null,Vo=0,Xt=qt=St=null,$f=!1,e)throw Error(q(300));return n}function Hv(){var n=Vu!==0;return Vu=0,n}function Hr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?St.memoizedState=Xt=n:Xt=Xt.next=n,Xt}function Sr(){if(qt===null){var n=St.alternate;n=n!==null?n.memoizedState:null}else n=qt.next;var e=Xt===null?St.memoizedState:Xt.next;if(e!==null)Xt=e,qt=n;else{if(n===null)throw Error(q(310));qt=n,n={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},Xt===null?St.memoizedState=Xt=n:Xt=Xt.next=n}return Xt}function Lu(n,e){return typeof e=="function"?e(n):e}function Vg(n){var e=Sr(),t=e.queue;if(t===null)throw Error(q(311));t.lastRenderedReducer=n;var r=qt,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((Vo&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,St.lanes|=h,Lo|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Ur(r,e.memoizedState)||(Un=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,St.lanes|=i,Lo|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Lg(n){var e=Sr(),t=e.queue;if(t===null)throw Error(q(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Ur(i,e.memoizedState)||(Un=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function U1(){}function B1(n,e){var t=St,r=Sr(),s=e(),i=!Ur(r.memoizedState,s);if(i&&(r.memoizedState=s,Un=!0),r=r.queue,Kv(q1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Xt!==null&&Xt.memoizedState.tag&1){if(t.flags|=2048,Fu(9,z1.bind(null,t,r,s,e),void 0,null),tn===null)throw Error(q(349));Vo&30||$1(t,e,s)}return s}function $1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function z1(n,e,t,r){e.value=t,e.getSnapshot=r,W1(e)&&G1(n)}function q1(n,e,t){return t(function(){W1(e)&&G1(n)})}function W1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ur(n,t)}catch{return!0}}function G1(n){var e=Ps(n,1);e!==null&&Lr(e,n,1,-1)}function tT(n){var e=Hr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Lu,lastRenderedState:n},e.queue=n,n=n.dispatch=ZO.bind(null,St,n),[e.memoizedState,n]}function Fu(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function H1(){return Sr().memoizedState}function tf(n,e,t,r){var s=Hr();St.flags|=n,s.memoizedState=Fu(1|e,t,void 0,r===void 0?null:r)}function $p(n,e,t,r){var s=Sr();r=r===void 0?null:r;var i=void 0;if(qt!==null){var o=qt.memoizedState;if(i=o.destroy,r!==null&&Wv(r,o.deps)){s.memoizedState=Fu(e,t,i,r);return}}St.flags|=n,s.memoizedState=Fu(1|e,t,i,r)}function nT(n,e){return tf(8390656,8,n,e)}function Kv(n,e){return $p(2048,8,n,e)}function K1(n,e){return $p(4,2,n,e)}function Q1(n,e){return $p(4,4,n,e)}function Y1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function J1(n,e,t){return t=t!=null?t.concat([n]):null,$p(4,4,Y1.bind(null,e,n),t)}function Qv(){}function X1(n,e){var t=Sr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Wv(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Z1(n,e){var t=Sr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Wv(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function eA(n,e,t){return Vo&21?(Ur(t,e)||(t=i1(),St.lanes|=t,Lo|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Un=!0),n.memoizedState=t)}function JO(n,e){var t=He;He=t!==0&&4>t?t:4,n(!0);var r=Mg.transition;Mg.transition={};try{n(!1),e()}finally{He=t,Mg.transition=r}}function tA(){return Sr().memoizedState}function XO(n,e,t){var r=Si(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},nA(n))rA(e,t);else if(t=L1(n,e,t,r),t!==null){var s=Dn();Lr(t,n,r,s),sA(t,e,r)}}function ZO(n,e,t){var r=Si(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(nA(n))rA(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Ur(a,o)){var l=e.interleaved;l===null?(s.next=s,Uv(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=L1(n,e,s,r),t!==null&&(s=Dn(),Lr(t,n,r,s),sA(t,e,r))}}function nA(n){var e=n.alternate;return n===St||e!==null&&e===St}function rA(n,e){eu=$f=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function sA(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,bv(n,t)}}var zf={readContext:xr,useCallback:yn,useContext:yn,useEffect:yn,useImperativeHandle:yn,useInsertionEffect:yn,useLayoutEffect:yn,useMemo:yn,useReducer:yn,useRef:yn,useState:yn,useDebugValue:yn,useDeferredValue:yn,useTransition:yn,useMutableSource:yn,useSyncExternalStore:yn,useId:yn,unstable_isNewReconciler:!1},eM={readContext:xr,useCallback:function(n,e){return Hr().memoizedState=[n,e===void 0?null:e],n},useContext:xr,useEffect:nT,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,tf(4194308,4,Y1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return tf(4194308,4,n,e)},useInsertionEffect:function(n,e){return tf(4,2,n,e)},useMemo:function(n,e){var t=Hr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Hr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=XO.bind(null,St,n),[r.memoizedState,n]},useRef:function(n){var e=Hr();return n={current:n},e.memoizedState=n},useState:tT,useDebugValue:Qv,useDeferredValue:function(n){return Hr().memoizedState=n},useTransition:function(){var n=tT(!1),e=n[0];return n=JO.bind(null,n[1]),Hr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=St,s=Hr();if(pt){if(t===void 0)throw Error(q(407));t=t()}else{if(t=e(),tn===null)throw Error(q(349));Vo&30||$1(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,nT(q1.bind(null,r,i,n),[n]),r.flags|=2048,Fu(9,z1.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Hr(),e=tn.identifierPrefix;if(pt){var t=Es,r=Is;t=(r&~(1<<32-Vr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Vu++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=YO++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},tM={readContext:xr,useCallback:X1,useContext:xr,useEffect:Kv,useImperativeHandle:J1,useInsertionEffect:K1,useLayoutEffect:Q1,useMemo:Z1,useReducer:Vg,useRef:H1,useState:function(){return Vg(Lu)},useDebugValue:Qv,useDeferredValue:function(n){var e=Sr();return eA(e,qt.memoizedState,n)},useTransition:function(){var n=Vg(Lu)[0],e=Sr().memoizedState;return[n,e]},useMutableSource:U1,useSyncExternalStore:B1,useId:tA,unstable_isNewReconciler:!1},nM={readContext:xr,useCallback:X1,useContext:xr,useEffect:Kv,useImperativeHandle:J1,useInsertionEffect:K1,useLayoutEffect:Q1,useMemo:Z1,useReducer:Lg,useRef:H1,useState:function(){return Lg(Lu)},useDebugValue:Qv,useDeferredValue:function(n){var e=Sr();return qt===null?e.memoizedState=n:eA(e,qt.memoizedState,n)},useTransition:function(){var n=Lg(Lu)[0],e=Sr().memoizedState;return[n,e]},useMutableSource:U1,useSyncExternalStore:B1,useId:tA,unstable_isNewReconciler:!1};function Nr(n,e){if(n&&n.defaultProps){e=bt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Jy(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:bt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var zp={isMounted:function(n){return(n=n._reactInternals)?ra(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Dn(),s=Si(n),i=As(r,s);i.payload=e,t!=null&&(i.callback=t),e=Ti(n,i,s),e!==null&&(Lr(e,n,s,r),Zh(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Dn(),s=Si(n),i=As(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Ti(n,i,s),e!==null&&(Lr(e,n,s,r),Zh(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Dn(),r=Si(n),s=As(t,r);s.tag=2,e!=null&&(s.callback=e),e=Ti(n,s,r),e!==null&&(Lr(e,n,r,t),Zh(e,n,r))}};function rT(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Nu(t,r)||!Nu(s,i):!0}function iA(n,e,t){var r=!1,s=Mi,i=e.contextType;return typeof i=="object"&&i!==null?i=xr(i):(s=Wn(e)?Oo:Sn.current,r=e.contextTypes,i=(r=r!=null)?cl(n,s):Mi),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=zp,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function sT(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&zp.enqueueReplaceState(e,e.state,null)}function Xy(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Bv(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=xr(i):(i=Wn(e)?Oo:Sn.current,s.context=cl(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Jy(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&zp.enqueueReplaceState(s,s.state,null),Uf(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function fl(n,e){try{var t="",r=e;do t+=N2(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function Fg(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Zy(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var rM=typeof WeakMap=="function"?WeakMap:Map;function oA(n,e,t){t=As(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Wf||(Wf=!0,c_=r),Zy(n,e)},t}function aA(n,e,t){t=As(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){Zy(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Zy(n,e),typeof r!="function"&&(xi===null?xi=new Set([this]):xi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function iT(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new rM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=yM.bind(null,n,e,t),e.then(n,n))}function oT(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function aT(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=As(-1,1),e.tag=2,Ti(t,e,1))),t.lanes|=1),n)}var sM=Us.ReactCurrentOwner,Un=!1;function Pn(n,e,t,r){e.child=n===null?V1(e,null,t,r):dl(e,n.child,t,r)}function lT(n,e,t,r,s){t=t.render;var i=e.ref;return Xa(e,s),r=Gv(n,e,t,r,i,s),t=Hv(),n!==null&&!Un?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ks(n,e,s)):(pt&&t&&Ov(e),e.flags|=1,Pn(n,e,r,s),e.child)}function cT(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!r0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,lA(n,e,i,r,s)):(n=of(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Nu,t(o,r)&&n.ref===e.ref)return ks(n,e,s)}return e.flags|=1,n=bi(i,r),n.ref=e.ref,n.return=e,e.child=n}function lA(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Nu(i,r)&&n.ref===e.ref)if(Un=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Un=!0);else return e.lanes=n.lanes,ks(n,e,s)}return e_(n,e,t,r,s)}function cA(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(Ha,Zn),Zn|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,st(Ha,Zn),Zn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,st(Ha,Zn),Zn|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,st(Ha,Zn),Zn|=r;return Pn(n,e,s,t),e.child}function uA(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function e_(n,e,t,r,s){var i=Wn(t)?Oo:Sn.current;return i=cl(e,i),Xa(e,s),t=Gv(n,e,t,r,i,s),r=Hv(),n!==null&&!Un?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ks(n,e,s)):(pt&&r&&Ov(e),e.flags|=1,Pn(n,e,t,s),e.child)}function uT(n,e,t,r,s){if(Wn(t)){var i=!0;Mf(e)}else i=!1;if(Xa(e,s),e.stateNode===null)nf(n,e),iA(e,t,r),Xy(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=xr(u):(u=Wn(t)?Oo:Sn.current,u=cl(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&sT(e,o,r,u),ri=!1;var p=e.memoizedState;o.state=p,Uf(e,r,o,s),l=e.memoizedState,a!==r||p!==l||qn.current||ri?(typeof h=="function"&&(Jy(e,t,h,r),l=e.memoizedState),(a=ri||rT(e,t,a,r,p,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,F1(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:Nr(e.type,a),o.props=u,f=e.pendingProps,p=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=xr(l):(l=Wn(t)?Oo:Sn.current,l=cl(e,l));var _=t.getDerivedStateFromProps;(h=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||p!==l)&&sT(e,o,r,l),ri=!1,p=e.memoizedState,o.state=p,Uf(e,r,o,s);var T=e.memoizedState;a!==f||p!==T||qn.current||ri?(typeof _=="function"&&(Jy(e,t,_,r),T=e.memoizedState),(u=ri||rT(e,t,u,r,p,T,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,T,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,T,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=T),o.props=r,o.state=T,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return t_(n,e,t,r,i,s)}function t_(n,e,t,r,s,i){uA(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&QE(e,t,!1),ks(n,e,i);r=e.stateNode,sM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=dl(e,n.child,null,i),e.child=dl(e,null,a,i)):Pn(n,e,a,i),e.memoizedState=r.state,s&&QE(e,t,!0),e.child}function dA(n){var e=n.stateNode;e.pendingContext?KE(n,e.pendingContext,e.pendingContext!==e.context):e.context&&KE(n,e.context,!1),$v(n,e.containerInfo)}function dT(n,e,t,r,s){return ul(),Vv(s),e.flags|=256,Pn(n,e,t,r),e.child}var n_={dehydrated:null,treeContext:null,retryLane:0};function r_(n){return{baseLanes:n,cachePool:null,transitions:null}}function hA(n,e,t){var r=e.pendingProps,s=Tt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),st(Tt,s&1),n===null)return Qy(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Gp(o,r,0,null),n=Co(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=r_(t),e.memoizedState=n_,n):Yv(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return iM(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=bi(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=bi(a,i):(i=Co(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?r_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=n_,r}return i=n.child,n=i.sibling,r=bi(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Yv(n,e){return e=Gp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Ch(n,e,t,r){return r!==null&&Vv(r),dl(e,n.child,null,t),n=Yv(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function iM(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=Fg(Error(q(422))),Ch(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Gp({mode:"visible",children:r.children},s,0,null),i=Co(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&dl(e,n.child,null,o),e.child.memoizedState=r_(o),e.memoizedState=n_,i);if(!(e.mode&1))return Ch(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(q(419)),r=Fg(i,r,void 0),Ch(n,e,o,r)}if(a=(o&n.childLanes)!==0,Un||a){if(r=tn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ps(n,s),Lr(r,n,s,-1))}return n0(),r=Fg(Error(q(421))),Ch(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=_M.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,sr=Ei(s.nextSibling),ir=e,pt=!0,Dr=null,n!==null&&(yr[_r++]=Is,yr[_r++]=Es,yr[_r++]=Mo,Is=n.id,Es=n.overflow,Mo=e),e=Yv(e,r.children),e.flags|=4096,e)}function hT(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Yy(n.return,e,t)}function jg(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function fA(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Pn(n,e,r.children,t),r=Tt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&hT(n,t,e);else if(n.tag===19)hT(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(st(Tt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Bf(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),jg(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Bf(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}jg(e,!0,t,null,i);break;case"together":jg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function nf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ks(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Lo|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(q(153));if(e.child!==null){for(n=e.child,t=bi(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=bi(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function oM(n,e,t){switch(e.tag){case 3:dA(e),ul();break;case 5:j1(e);break;case 1:Wn(e.type)&&Mf(e);break;case 4:$v(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;st(Ff,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(st(Tt,Tt.current&1),e.flags|=128,null):t&e.child.childLanes?hA(n,e,t):(st(Tt,Tt.current&1),n=ks(n,e,t),n!==null?n.sibling:null);st(Tt,Tt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return fA(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),st(Tt,Tt.current),r)break;return null;case 22:case 23:return e.lanes=0,cA(n,e,t)}return ks(n,e,t)}var pA,s_,mA,gA;pA=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};s_=function(){};mA=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Eo(rs.current);var i=null;switch(t){case"input":s=by(n,s),r=by(n,r),i=[];break;case"select":s=bt({},s,{value:void 0}),r=bt({},r,{value:void 0}),i=[];break;case"textarea":s=Ry(n,s),r=Ry(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Df)}Py(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Tu.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Tu.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&lt("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};gA=function(n,e,t,r){t!==r&&(e.flags|=4)};function xc(n,e){if(!pt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function _n(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function aM(n,e,t){var r=e.pendingProps;switch(Mv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _n(e),null;case 1:return Wn(e.type)&&Of(),_n(e),null;case 3:return r=e.stateNode,hl(),ut(qn),ut(Sn),qv(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(bh(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Dr!==null&&(h_(Dr),Dr=null))),s_(n,e),_n(e),null;case 5:zv(e);var s=Eo(Mu.current);if(t=e.type,n!==null&&e.stateNode!=null)mA(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(q(166));return _n(e),null}if(n=Eo(rs.current),bh(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Yr]=e,r[Du]=i,n=(e.mode&1)!==0,t){case"dialog":lt("cancel",r),lt("close",r);break;case"iframe":case"object":case"embed":lt("load",r);break;case"video":case"audio":for(s=0;s<jc.length;s++)lt(jc[s],r);break;case"source":lt("error",r);break;case"img":case"image":case"link":lt("error",r),lt("load",r);break;case"details":lt("toggle",r);break;case"input":IE(r,i),lt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},lt("invalid",r);break;case"textarea":TE(r,i),lt("invalid",r)}Py(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Sh(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Sh(r.textContent,a,n),s=["children",""+a]):Tu.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&lt("scroll",r)}switch(t){case"input":yh(r),EE(r,i,!0);break;case"textarea":yh(r),xE(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Df)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=qb(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Yr]=e,n[Du]=r,pA(n,e,!1,!1),e.stateNode=n;e:{switch(o=ky(t,r),t){case"dialog":lt("cancel",n),lt("close",n),s=r;break;case"iframe":case"object":case"embed":lt("load",n),s=r;break;case"video":case"audio":for(s=0;s<jc.length;s++)lt(jc[s],n);s=r;break;case"source":lt("error",n),s=r;break;case"img":case"image":case"link":lt("error",n),lt("load",n),s=r;break;case"details":lt("toggle",n),s=r;break;case"input":IE(n,r),s=by(n,r),lt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=bt({},r,{value:void 0}),lt("invalid",n);break;case"textarea":TE(n,r),s=Ry(n,r),lt("invalid",n);break;default:s=r}Py(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?Hb(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Wb(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&xu(n,l):typeof l=="number"&&xu(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Tu.hasOwnProperty(i)?l!=null&&i==="onScroll"&&lt("scroll",n):l!=null&&wv(n,i,l,o))}switch(t){case"input":yh(n),EE(n,r,!1);break;case"textarea":yh(n),xE(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Oi(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Ka(n,!!r.multiple,i,!1):r.defaultValue!=null&&Ka(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Df)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return _n(e),null;case 6:if(n&&e.stateNode!=null)gA(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(q(166));if(t=Eo(Mu.current),Eo(rs.current),bh(e)){if(r=e.stateNode,t=e.memoizedProps,r[Yr]=e,(i=r.nodeValue!==t)&&(n=ir,n!==null))switch(n.tag){case 3:Sh(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Sh(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Yr]=e,e.stateNode=r}return _n(e),null;case 13:if(ut(Tt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(pt&&sr!==null&&e.mode&1&&!(e.flags&128))O1(),ul(),e.flags|=98560,i=!1;else if(i=bh(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(q(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(q(317));i[Yr]=e}else ul(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;_n(e),i=!1}else Dr!==null&&(h_(Dr),Dr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Tt.current&1?Gt===0&&(Gt=3):n0())),e.updateQueue!==null&&(e.flags|=4),_n(e),null);case 4:return hl(),s_(n,e),n===null&&Pu(e.stateNode.containerInfo),_n(e),null;case 10:return jv(e.type._context),_n(e),null;case 17:return Wn(e.type)&&Of(),_n(e),null;case 19:if(ut(Tt),i=e.memoizedState,i===null)return _n(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)xc(i,!1);else{if(Gt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Bf(n),o!==null){for(e.flags|=128,xc(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return st(Tt,Tt.current&1|2),e.child}n=n.sibling}i.tail!==null&&Vt()>pl&&(e.flags|=128,r=!0,xc(i,!1),e.lanes=4194304)}else{if(!r)if(n=Bf(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),xc(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!pt)return _n(e),null}else 2*Vt()-i.renderingStartTime>pl&&t!==1073741824&&(e.flags|=128,r=!0,xc(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Vt(),e.sibling=null,t=Tt.current,st(Tt,r?t&1|2:t&1),e):(_n(e),null);case 22:case 23:return t0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Zn&1073741824&&(_n(e),e.subtreeFlags&6&&(e.flags|=8192)):_n(e),null;case 24:return null;case 25:return null}throw Error(q(156,e.tag))}function lM(n,e){switch(Mv(e),e.tag){case 1:return Wn(e.type)&&Of(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return hl(),ut(qn),ut(Sn),qv(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return zv(e),null;case 13:if(ut(Tt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(q(340));ul()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ut(Tt),null;case 4:return hl(),null;case 10:return jv(e.type._context),null;case 22:case 23:return t0(),null;case 24:return null;default:return null}}var Rh=!1,In=!1,cM=typeof WeakSet=="function"?WeakSet:Set,ne=null;function Ga(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Pt(n,e,r)}else t.current=null}function i_(n,e,t){try{t()}catch(r){Pt(n,e,r)}}var fT=!1;function uM(n,e){if($y=Nf,n=I1(),Dv(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,p=null;t:for(;;){for(var _;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(_=f.firstChild)!==null;)p=f,f=_;for(;;){if(f===n)break t;if(p===t&&++u===s&&(a=o),p===i&&++h===r&&(l=o),(_=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=_}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(zy={focusedElem:n,selectionRange:t},Nf=!1,ne=e;ne!==null;)if(e=ne,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ne=n;else for(;ne!==null;){e=ne;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var b=T.memoizedProps,k=T.memoizedState,C=e.stateNode,x=C.getSnapshotBeforeUpdate(e.elementType===e.type?b:Nr(e.type,b),k);C.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(P){Pt(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,ne=n;break}ne=e.return}return T=fT,fT=!1,T}function tu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&i_(e,t,i)}s=s.next}while(s!==r)}}function qp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function o_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function yA(n){var e=n.alternate;e!==null&&(n.alternate=null,yA(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Yr],delete e[Du],delete e[Gy],delete e[GO],delete e[HO])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function _A(n){return n.tag===5||n.tag===3||n.tag===4}function pT(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||_A(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function a_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Df));else if(r!==4&&(n=n.child,n!==null))for(a_(n,e,t),n=n.sibling;n!==null;)a_(n,e,t),n=n.sibling}function l_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(l_(n,e,t),n=n.sibling;n!==null;)l_(n,e,t),n=n.sibling}var ln=null,Pr=!1;function Js(n,e,t){for(t=t.child;t!==null;)vA(n,e,t),t=t.sibling}function vA(n,e,t){if(ns&&typeof ns.onCommitFiberUnmount=="function")try{ns.onCommitFiberUnmount(Vp,t)}catch{}switch(t.tag){case 5:In||Ga(t,e);case 6:var r=ln,s=Pr;ln=null,Js(n,e,t),ln=r,Pr=s,ln!==null&&(Pr?(n=ln,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):ln.removeChild(t.stateNode));break;case 18:ln!==null&&(Pr?(n=ln,t=t.stateNode,n.nodeType===8?kg(n.parentNode,t):n.nodeType===1&&kg(n,t),Cu(n)):kg(ln,t.stateNode));break;case 4:r=ln,s=Pr,ln=t.stateNode.containerInfo,Pr=!0,Js(n,e,t),ln=r,Pr=s;break;case 0:case 11:case 14:case 15:if(!In&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&i_(t,e,o),s=s.next}while(s!==r)}Js(n,e,t);break;case 1:if(!In&&(Ga(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Pt(t,e,a)}Js(n,e,t);break;case 21:Js(n,e,t);break;case 22:t.mode&1?(In=(r=In)||t.memoizedState!==null,Js(n,e,t),In=r):Js(n,e,t);break;default:Js(n,e,t)}}function mT(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new cM),e.forEach(function(r){var s=vM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function Rr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ln=a.stateNode,Pr=!1;break e;case 3:ln=a.stateNode.containerInfo,Pr=!0;break e;case 4:ln=a.stateNode.containerInfo,Pr=!0;break e}a=a.return}if(ln===null)throw Error(q(160));vA(i,o,s),ln=null,Pr=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Pt(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)wA(e,n),e=e.sibling}function wA(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Rr(e,n),Gr(n),r&4){try{tu(3,n,n.return),qp(3,n)}catch(b){Pt(n,n.return,b)}try{tu(5,n,n.return)}catch(b){Pt(n,n.return,b)}}break;case 1:Rr(e,n),Gr(n),r&512&&t!==null&&Ga(t,t.return);break;case 5:if(Rr(e,n),Gr(n),r&512&&t!==null&&Ga(t,t.return),n.flags&32){var s=n.stateNode;try{xu(s,"")}catch(b){Pt(n,n.return,b)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&$b(s,i),ky(a,o);var u=ky(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?Hb(s,f):h==="dangerouslySetInnerHTML"?Wb(s,f):h==="children"?xu(s,f):wv(s,h,f,u)}switch(a){case"input":Ay(s,i);break;case"textarea":zb(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var _=i.value;_!=null?Ka(s,!!i.multiple,_,!1):p!==!!i.multiple&&(i.defaultValue!=null?Ka(s,!!i.multiple,i.defaultValue,!0):Ka(s,!!i.multiple,i.multiple?[]:"",!1))}s[Du]=i}catch(b){Pt(n,n.return,b)}}break;case 6:if(Rr(e,n),Gr(n),r&4){if(n.stateNode===null)throw Error(q(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(b){Pt(n,n.return,b)}}break;case 3:if(Rr(e,n),Gr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Cu(e.containerInfo)}catch(b){Pt(n,n.return,b)}break;case 4:Rr(e,n),Gr(n);break;case 13:Rr(e,n),Gr(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Zv=Vt())),r&4&&mT(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(In=(u=In)||h,Rr(e,n),In=u):Rr(e,n),Gr(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(ne=n,h=n.child;h!==null;){for(f=ne=h;ne!==null;){switch(p=ne,_=p.child,p.tag){case 0:case 11:case 14:case 15:tu(4,p,p.return);break;case 1:Ga(p,p.return);var T=p.stateNode;if(typeof T.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(b){Pt(r,t,b)}}break;case 5:Ga(p,p.return);break;case 22:if(p.memoizedState!==null){yT(f);continue}}_!==null?(_.return=p,ne=_):yT(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Gb("display",o))}catch(b){Pt(n,n.return,b)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(b){Pt(n,n.return,b)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Rr(e,n),Gr(n),r&4&&mT(n);break;case 21:break;default:Rr(e,n),Gr(n)}}function Gr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(_A(t)){var r=t;break e}t=t.return}throw Error(q(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(xu(s,""),r.flags&=-33);var i=pT(n);l_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=pT(n);a_(n,a,o);break;default:throw Error(q(161))}}catch(l){Pt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function dM(n,e,t){ne=n,IA(n)}function IA(n,e,t){for(var r=(n.mode&1)!==0;ne!==null;){var s=ne,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Rh;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||In;a=Rh;var u=In;if(Rh=o,(In=l)&&!u)for(ne=s;ne!==null;)o=ne,l=o.child,o.tag===22&&o.memoizedState!==null?_T(s):l!==null?(l.return=o,ne=l):_T(s);for(;i!==null;)ne=i,IA(i),i=i.sibling;ne=s,Rh=a,In=u}gT(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ne=i):gT(n)}}function gT(n){for(;ne!==null;){var e=ne;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:In||qp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!In)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Nr(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&eT(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}eT(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Cu(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}In||e.flags&512&&o_(e)}catch(p){Pt(e,e.return,p)}}if(e===n){ne=null;break}if(t=e.sibling,t!==null){t.return=e.return,ne=t;break}ne=e.return}}function yT(n){for(;ne!==null;){var e=ne;if(e===n){ne=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ne=t;break}ne=e.return}}function _T(n){for(;ne!==null;){var e=ne;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{qp(4,e)}catch(l){Pt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Pt(e,s,l)}}var i=e.return;try{o_(e)}catch(l){Pt(e,i,l)}break;case 5:var o=e.return;try{o_(e)}catch(l){Pt(e,o,l)}}}catch(l){Pt(e,e.return,l)}if(e===n){ne=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ne=a;break}ne=e.return}}var hM=Math.ceil,qf=Us.ReactCurrentDispatcher,Jv=Us.ReactCurrentOwner,Er=Us.ReactCurrentBatchConfig,Le=0,tn=null,$t=null,dn=0,Zn=0,Ha=Qi(0),Gt=0,ju=null,Lo=0,Wp=0,Xv=0,nu=null,jn=null,Zv=0,pl=1/0,ys=null,Wf=!1,c_=null,xi=null,Nh=!1,hi=null,Gf=0,ru=0,u_=null,rf=-1,sf=0;function Dn(){return Le&6?Vt():rf!==-1?rf:rf=Vt()}function Si(n){return n.mode&1?Le&2&&dn!==0?dn&-dn:QO.transition!==null?(sf===0&&(sf=i1()),sf):(n=He,n!==0||(n=window.event,n=n===void 0?16:h1(n.type)),n):1}function Lr(n,e,t,r){if(50<ru)throw ru=0,u_=null,Error(q(185));yd(n,t,r),(!(Le&2)||n!==tn)&&(n===tn&&(!(Le&2)&&(Wp|=t),Gt===4&&ii(n,dn)),Gn(n,r),t===1&&Le===0&&!(e.mode&1)&&(pl=Vt()+500,Bp&&Yi()))}function Gn(n,e){var t=n.callbackNode;Q2(n,e);var r=Rf(n,n===tn?dn:0);if(r===0)t!==null&&AE(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&AE(t),e===1)n.tag===0?KO(vT.bind(null,n)):P1(vT.bind(null,n)),qO(function(){!(Le&6)&&Yi()}),t=null;else{switch(o1(r)){case 1:t=Sv;break;case 4:t=r1;break;case 16:t=Cf;break;case 536870912:t=s1;break;default:t=Cf}t=RA(t,EA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function EA(n,e){if(rf=-1,sf=0,Le&6)throw Error(q(327));var t=n.callbackNode;if(Za()&&n.callbackNode!==t)return null;var r=Rf(n,n===tn?dn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Hf(n,r);else{e=r;var s=Le;Le|=2;var i=xA();(tn!==n||dn!==e)&&(ys=null,pl=Vt()+500,Ao(n,e));do try{mM();break}catch(a){TA(n,a)}while(1);Fv(),qf.current=i,Le=s,$t!==null?e=0:(tn=null,dn=0,e=Gt)}if(e!==0){if(e===2&&(s=Ly(n),s!==0&&(r=s,e=d_(n,s))),e===1)throw t=ju,Ao(n,0),ii(n,r),Gn(n,Vt()),t;if(e===6)ii(n,r);else{if(s=n.current.alternate,!(r&30)&&!fM(s)&&(e=Hf(n,r),e===2&&(i=Ly(n),i!==0&&(r=i,e=d_(n,i))),e===1))throw t=ju,Ao(n,0),ii(n,r),Gn(n,Vt()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(q(345));case 2:uo(n,jn,ys);break;case 3:if(ii(n,r),(r&130023424)===r&&(e=Zv+500-Vt(),10<e)){if(Rf(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){Dn(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Wy(uo.bind(null,n,jn,ys),e);break}uo(n,jn,ys);break;case 4:if(ii(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-Vr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Vt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*hM(r/1960))-r,10<r){n.timeoutHandle=Wy(uo.bind(null,n,jn,ys),r);break}uo(n,jn,ys);break;case 5:uo(n,jn,ys);break;default:throw Error(q(329))}}}return Gn(n,Vt()),n.callbackNode===t?EA.bind(null,n):null}function d_(n,e){var t=nu;return n.current.memoizedState.isDehydrated&&(Ao(n,e).flags|=256),n=Hf(n,e),n!==2&&(e=jn,jn=t,e!==null&&h_(e)),n}function h_(n){jn===null?jn=n:jn.push.apply(jn,n)}function fM(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Ur(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ii(n,e){for(e&=~Xv,e&=~Wp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Vr(e),r=1<<t;n[t]=-1,e&=~r}}function vT(n){if(Le&6)throw Error(q(327));Za();var e=Rf(n,0);if(!(e&1))return Gn(n,Vt()),null;var t=Hf(n,e);if(n.tag!==0&&t===2){var r=Ly(n);r!==0&&(e=r,t=d_(n,r))}if(t===1)throw t=ju,Ao(n,0),ii(n,e),Gn(n,Vt()),t;if(t===6)throw Error(q(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,uo(n,jn,ys),Gn(n,Vt()),null}function e0(n,e){var t=Le;Le|=1;try{return n(e)}finally{Le=t,Le===0&&(pl=Vt()+500,Bp&&Yi())}}function Fo(n){hi!==null&&hi.tag===0&&!(Le&6)&&Za();var e=Le;Le|=1;var t=Er.transition,r=He;try{if(Er.transition=null,He=1,n)return n()}finally{He=r,Er.transition=t,Le=e,!(Le&6)&&Yi()}}function t0(){Zn=Ha.current,ut(Ha)}function Ao(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,zO(t)),$t!==null)for(t=$t.return;t!==null;){var r=t;switch(Mv(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Of();break;case 3:hl(),ut(qn),ut(Sn),qv();break;case 5:zv(r);break;case 4:hl();break;case 13:ut(Tt);break;case 19:ut(Tt);break;case 10:jv(r.type._context);break;case 22:case 23:t0()}t=t.return}if(tn=n,$t=n=bi(n.current,null),dn=Zn=e,Gt=0,ju=null,Xv=Wp=Lo=0,jn=nu=null,Io!==null){for(e=0;e<Io.length;e++)if(t=Io[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Io=null}return n}function TA(n,e){do{var t=$t;try{if(Fv(),ef.current=zf,$f){for(var r=St.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}$f=!1}if(Vo=0,Xt=qt=St=null,eu=!1,Vu=0,Jv.current=null,t===null||t.return===null){Gt=1,ju=e,$t=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=dn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=oT(o);if(_!==null){_.flags&=-257,aT(_,o,a,i,e),_.mode&1&&iT(i,u,e),e=_,l=u;var T=e.updateQueue;if(T===null){var b=new Set;b.add(l),e.updateQueue=b}else T.add(l);break e}else{if(!(e&1)){iT(i,u,e),n0();break e}l=Error(q(426))}}else if(pt&&a.mode&1){var k=oT(o);if(k!==null){!(k.flags&65536)&&(k.flags|=256),aT(k,o,a,i,e),Vv(fl(l,a));break e}}i=l=fl(l,a),Gt!==4&&(Gt=2),nu===null?nu=[i]:nu.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var C=oA(i,l,e);ZE(i,C);break e;case 1:a=l;var x=i.type,R=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(xi===null||!xi.has(R)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=aA(i,a,e);ZE(i,P);break e}}i=i.return}while(i!==null)}bA(t)}catch(U){e=U,$t===t&&t!==null&&($t=t=t.return);continue}break}while(1)}function xA(){var n=qf.current;return qf.current=zf,n===null?zf:n}function n0(){(Gt===0||Gt===3||Gt===2)&&(Gt=4),tn===null||!(Lo&268435455)&&!(Wp&268435455)||ii(tn,dn)}function Hf(n,e){var t=Le;Le|=2;var r=xA();(tn!==n||dn!==e)&&(ys=null,Ao(n,e));do try{pM();break}catch(s){TA(n,s)}while(1);if(Fv(),Le=t,qf.current=r,$t!==null)throw Error(q(261));return tn=null,dn=0,Gt}function pM(){for(;$t!==null;)SA($t)}function mM(){for(;$t!==null&&!U2();)SA($t)}function SA(n){var e=CA(n.alternate,n,Zn);n.memoizedProps=n.pendingProps,e===null?bA(n):$t=e,Jv.current=null}function bA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=lM(t,e),t!==null){t.flags&=32767,$t=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Gt=6,$t=null;return}}else if(t=aM(t,e,Zn),t!==null){$t=t;return}if(e=e.sibling,e!==null){$t=e;return}$t=e=n}while(e!==null);Gt===0&&(Gt=5)}function uo(n,e,t){var r=He,s=Er.transition;try{Er.transition=null,He=1,gM(n,e,t,r)}finally{Er.transition=s,He=r}return null}function gM(n,e,t,r){do Za();while(hi!==null);if(Le&6)throw Error(q(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(q(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(Y2(n,i),n===tn&&($t=tn=null,dn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Nh||(Nh=!0,RA(Cf,function(){return Za(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Er.transition,Er.transition=null;var o=He;He=1;var a=Le;Le|=4,Jv.current=null,uM(n,t),wA(t,n),VO(zy),Nf=!!$y,zy=$y=null,n.current=t,dM(t),B2(),Le=a,He=o,Er.transition=i}else n.current=t;if(Nh&&(Nh=!1,hi=n,Gf=s),i=n.pendingLanes,i===0&&(xi=null),q2(t.stateNode),Gn(n,Vt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Wf)throw Wf=!1,n=c_,c_=null,n;return Gf&1&&n.tag!==0&&Za(),i=n.pendingLanes,i&1?n===u_?ru++:(ru=0,u_=n):ru=0,Yi(),null}function Za(){if(hi!==null){var n=o1(Gf),e=Er.transition,t=He;try{if(Er.transition=null,He=16>n?16:n,hi===null)var r=!1;else{if(n=hi,hi=null,Gf=0,Le&6)throw Error(q(331));var s=Le;for(Le|=4,ne=n.current;ne!==null;){var i=ne,o=i.child;if(ne.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(ne=u;ne!==null;){var h=ne;switch(h.tag){case 0:case 11:case 15:tu(8,h,i)}var f=h.child;if(f!==null)f.return=h,ne=f;else for(;ne!==null;){h=ne;var p=h.sibling,_=h.return;if(yA(h),h===u){ne=null;break}if(p!==null){p.return=_,ne=p;break}ne=_}}}var T=i.alternate;if(T!==null){var b=T.child;if(b!==null){T.child=null;do{var k=b.sibling;b.sibling=null,b=k}while(b!==null)}}ne=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ne=o;else e:for(;ne!==null;){if(i=ne,i.flags&2048)switch(i.tag){case 0:case 11:case 15:tu(9,i,i.return)}var C=i.sibling;if(C!==null){C.return=i.return,ne=C;break e}ne=i.return}}var x=n.current;for(ne=x;ne!==null;){o=ne;var R=o.child;if(o.subtreeFlags&2064&&R!==null)R.return=o,ne=R;else e:for(o=x;ne!==null;){if(a=ne,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:qp(9,a)}}catch(U){Pt(a,a.return,U)}if(a===o){ne=null;break e}var P=a.sibling;if(P!==null){P.return=a.return,ne=P;break e}ne=a.return}}if(Le=s,Yi(),ns&&typeof ns.onPostCommitFiberRoot=="function")try{ns.onPostCommitFiberRoot(Vp,n)}catch{}r=!0}return r}finally{He=t,Er.transition=e}}return!1}function wT(n,e,t){e=fl(t,e),e=oA(n,e,1),n=Ti(n,e,1),e=Dn(),n!==null&&(yd(n,1,e),Gn(n,e))}function Pt(n,e,t){if(n.tag===3)wT(n,n,t);else for(;e!==null;){if(e.tag===3){wT(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xi===null||!xi.has(r))){n=fl(t,n),n=aA(e,n,1),e=Ti(e,n,1),n=Dn(),e!==null&&(yd(e,1,n),Gn(e,n));break}}e=e.return}}function yM(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Dn(),n.pingedLanes|=n.suspendedLanes&t,tn===n&&(dn&t)===t&&(Gt===4||Gt===3&&(dn&130023424)===dn&&500>Vt()-Zv?Ao(n,0):Xv|=t),Gn(n,e)}function AA(n,e){e===0&&(n.mode&1?(e=wh,wh<<=1,!(wh&130023424)&&(wh=4194304)):e=1);var t=Dn();n=Ps(n,e),n!==null&&(yd(n,e,t),Gn(n,t))}function _M(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),AA(n,t)}function vM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(q(314))}r!==null&&r.delete(e),AA(n,t)}var CA;CA=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||qn.current)Un=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Un=!1,oM(n,e,t);Un=!!(n.flags&131072)}else Un=!1,pt&&e.flags&1048576&&k1(e,Lf,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;nf(n,e),n=e.pendingProps;var s=cl(e,Sn.current);Xa(e,t),s=Gv(null,e,r,n,s,t);var i=Hv();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Wn(r)?(i=!0,Mf(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Bv(e),s.updater=zp,e.stateNode=s,s._reactInternals=e,Xy(e,r,n,t),e=t_(null,e,r,!0,i,t)):(e.tag=0,pt&&i&&Ov(e),Pn(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(nf(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=IM(r),n=Nr(r,n),s){case 0:e=e_(null,e,r,n,t);break e;case 1:e=uT(null,e,r,n,t);break e;case 11:e=lT(null,e,r,n,t);break e;case 14:e=cT(null,e,r,Nr(r.type,n),t);break e}throw Error(q(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Nr(r,s),e_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Nr(r,s),uT(n,e,r,s,t);case 3:e:{if(dA(e),n===null)throw Error(q(387));r=e.pendingProps,i=e.memoizedState,s=i.element,F1(n,e),Uf(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=fl(Error(q(423)),e),e=dT(n,e,r,t,s);break e}else if(r!==s){s=fl(Error(q(424)),e),e=dT(n,e,r,t,s);break e}else for(sr=Ei(e.stateNode.containerInfo.firstChild),ir=e,pt=!0,Dr=null,t=V1(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ul(),r===s){e=ks(n,e,t);break e}Pn(n,e,r,t)}e=e.child}return e;case 5:return j1(e),n===null&&Qy(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,qy(r,s)?o=null:i!==null&&qy(r,i)&&(e.flags|=32),uA(n,e),Pn(n,e,o,t),e.child;case 6:return n===null&&Qy(e),null;case 13:return hA(n,e,t);case 4:return $v(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=dl(e,null,r,t):Pn(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Nr(r,s),lT(n,e,r,s,t);case 7:return Pn(n,e,e.pendingProps,t),e.child;case 8:return Pn(n,e,e.pendingProps.children,t),e.child;case 12:return Pn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,st(Ff,r._currentValue),r._currentValue=o,i!==null)if(Ur(i.value,o)){if(i.children===s.children&&!qn.current){e=ks(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=As(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),Yy(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(q(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Yy(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Pn(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Xa(e,t),s=xr(s),r=r(s),e.flags|=1,Pn(n,e,r,t),e.child;case 14:return r=e.type,s=Nr(r,e.pendingProps),s=Nr(r.type,s),cT(n,e,r,s,t);case 15:return lA(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Nr(r,s),nf(n,e),e.tag=1,Wn(r)?(n=!0,Mf(e)):n=!1,Xa(e,t),iA(e,r,s),Xy(e,r,s,t),t_(null,e,r,!0,n,t);case 19:return fA(n,e,t);case 22:return cA(n,e,t)}throw Error(q(156,e.tag))};function RA(n,e){return n1(n,e)}function wM(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wr(n,e,t,r){return new wM(n,e,t,r)}function r0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function IM(n){if(typeof n=="function")return r0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Ev)return 11;if(n===Tv)return 14}return 2}function bi(n,e){var t=n.alternate;return t===null?(t=wr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function of(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")r0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case La:return Co(t.children,s,i,e);case Iv:o=8,s|=8;break;case Ey:return n=wr(12,t,e,s|2),n.elementType=Ey,n.lanes=i,n;case Ty:return n=wr(13,t,e,s),n.elementType=Ty,n.lanes=i,n;case xy:return n=wr(19,t,e,s),n.elementType=xy,n.lanes=i,n;case jb:return Gp(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Lb:o=10;break e;case Fb:o=9;break e;case Ev:o=11;break e;case Tv:o=14;break e;case ni:o=16,r=null;break e}throw Error(q(130,n==null?n:typeof n,""))}return e=wr(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Co(n,e,t,r){return n=wr(7,n,r,e),n.lanes=t,n}function Gp(n,e,t,r){return n=wr(22,n,r,e),n.elementType=jb,n.lanes=t,n.stateNode={isHidden:!1},n}function Ug(n,e,t){return n=wr(6,n,null,e),n.lanes=t,n}function Bg(n,e,t){return e=wr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function EM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ig(0),this.expirationTimes=Ig(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ig(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function s0(n,e,t,r,s,i,o,a,l){return n=new EM(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=wr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bv(i),n}function TM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Va,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function NA(n){if(!n)return Mi;n=n._reactInternals;e:{if(ra(n)!==n||n.tag!==1)throw Error(q(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Wn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(q(171))}if(n.tag===1){var t=n.type;if(Wn(t))return N1(n,t,e)}return e}function PA(n,e,t,r,s,i,o,a,l){return n=s0(t,r,!0,n,s,i,o,a,l),n.context=NA(null),t=n.current,r=Dn(),s=Si(t),i=As(r,s),i.callback=e??null,Ti(t,i,s),n.current.lanes=s,yd(n,s,r),Gn(n,r),n}function Hp(n,e,t,r){var s=e.current,i=Dn(),o=Si(s);return t=NA(t),e.context===null?e.context=t:e.pendingContext=t,e=As(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Ti(s,e,o),n!==null&&(Lr(n,s,o,i),Zh(n,s,o)),o}function Kf(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function IT(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function i0(n,e){IT(n,e),(n=n.alternate)&&IT(n,e)}function xM(){return null}var kA=typeof reportError=="function"?reportError:function(n){console.error(n)};function o0(n){this._internalRoot=n}Kp.prototype.render=o0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(q(409));Hp(n,e,null,null)};Kp.prototype.unmount=o0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Fo(function(){Hp(null,n,null,null)}),e[Ns]=null}};function Kp(n){this._internalRoot=n}Kp.prototype.unstable_scheduleHydration=function(n){if(n){var e=c1();n={blockedOn:null,target:n,priority:e};for(var t=0;t<si.length&&e!==0&&e<si[t].priority;t++);si.splice(t,0,n),t===0&&d1(n)}};function a0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Qp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function ET(){}function SM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Kf(o);i.call(u)}}var o=PA(e,r,n,0,null,!1,!1,"",ET);return n._reactRootContainer=o,n[Ns]=o.current,Pu(n.nodeType===8?n.parentNode:n),Fo(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Kf(l);a.call(u)}}var l=s0(n,0,!1,null,null,!1,!1,"",ET);return n._reactRootContainer=l,n[Ns]=l.current,Pu(n.nodeType===8?n.parentNode:n),Fo(function(){Hp(e,l,t,r)}),l}function Yp(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Kf(o);a.call(l)}}Hp(e,o,n,s)}else o=SM(t,e,n,s,r);return Kf(o)}a1=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Fc(e.pendingLanes);t!==0&&(bv(e,t|1),Gn(e,Vt()),!(Le&6)&&(pl=Vt()+500,Yi()))}break;case 13:Fo(function(){var r=Ps(n,1);if(r!==null){var s=Dn();Lr(r,n,1,s)}}),i0(n,1)}};Av=function(n){if(n.tag===13){var e=Ps(n,134217728);if(e!==null){var t=Dn();Lr(e,n,134217728,t)}i0(n,134217728)}};l1=function(n){if(n.tag===13){var e=Si(n),t=Ps(n,e);if(t!==null){var r=Dn();Lr(t,n,e,r)}i0(n,e)}};c1=function(){return He};u1=function(n,e){var t=He;try{return He=n,e()}finally{He=t}};Oy=function(n,e,t){switch(e){case"input":if(Ay(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Up(r);if(!s)throw Error(q(90));Bb(r),Ay(r,s)}}}break;case"textarea":zb(n,t);break;case"select":e=t.value,e!=null&&Ka(n,!!t.multiple,e,!1)}};Yb=e0;Jb=Fo;var bM={usingClientEntryPoint:!1,Events:[vd,Ba,Up,Kb,Qb,e0]},Sc={findFiberByHostInstance:wo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},AM={bundleType:Sc.bundleType,version:Sc.version,rendererPackageName:Sc.rendererPackageName,rendererConfig:Sc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Us.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=e1(n),n===null?null:n.stateNode},findFiberByHostInstance:Sc.findFiberByHostInstance||xM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ph.isDisabled&&Ph.supportsFiber)try{Vp=Ph.inject(AM),ns=Ph}catch{}}fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bM;fr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!a0(e))throw Error(q(200));return TM(n,e,null,t)};fr.createRoot=function(n,e){if(!a0(n))throw Error(q(299));var t=!1,r="",s=kA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=s0(n,1,!1,null,null,t,!1,r,s),n[Ns]=e.current,Pu(n.nodeType===8?n.parentNode:n),new o0(e)};fr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(q(188)):(n=Object.keys(n).join(","),Error(q(268,n)));return n=e1(e),n=n===null?null:n.stateNode,n};fr.flushSync=function(n){return Fo(n)};fr.hydrate=function(n,e,t){if(!Qp(e))throw Error(q(200));return Yp(null,n,e,!0,t)};fr.hydrateRoot=function(n,e,t){if(!a0(n))throw Error(q(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=kA;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=PA(e,null,n,1,t??null,s,!1,i,o),n[Ns]=e.current,Pu(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Kp(e)};fr.render=function(n,e,t){if(!Qp(e))throw Error(q(200));return Yp(null,n,e,!1,t)};fr.unmountComponentAtNode=function(n){if(!Qp(n))throw Error(q(40));return n._reactRootContainer?(Fo(function(){Yp(null,null,n,!1,function(){n._reactRootContainer=null,n[Ns]=null})}),!0):!1};fr.unstable_batchedUpdates=e0;fr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Qp(t))throw Error(q(200));if(n==null||n._reactInternals===void 0)throw Error(q(38));return Yp(n,e,t,!1,r)};fr.version="18.3.1-next-f1338f8080-20240426";function DA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(DA)}catch(n){console.error(n)}}DA(),Db.exports=fr;var CM=Db.exports,TT=CM;wy.createRoot=TT.createRoot,wy.hydrateRoot=TT.hydrateRoot;const RM="modulepreload",NM=function(n){return"/"+n},xT={},$e=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=NM(i),i in xT)return;xT[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":RM,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},PM=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OA={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H=function(n,e){if(!n)throw ql(e)},ql=function(n){return new Error("Firebase Database ("+OA.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MA=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},kM=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},l0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(p=64)),r.push(t[h],t[f],t[p],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(MA(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):kM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new DM;const p=i<<2|a>>4;if(r.push(p),u!==64){const _=a<<4&240|u>>2;if(r.push(_),f!==64){const T=u<<6&192|f;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class DM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const VA=function(n){const e=MA(n);return l0.encodeByteArray(e,!0)},Qf=function(n){return VA(n).replace(/\./g,"")},Yf=function(n){try{return l0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OM(n){return LA(void 0,n)}function LA(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!MM(t)||(n[t]=LA(n[t],e[t]));return n}function MM(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VM=()=>FA().__FIREBASE_DEFAULTS__,LM=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},FM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Yf(n[1]);return e&&JSON.parse(e)},Jp=()=>{try{return PM()||VM()||LM()||FM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},jA=n=>{var e,t;return(t=(e=Jp())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},UA=n=>{const e=jA(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},BA=()=>{var n;return(n=Jp())==null?void 0:n.config},$A=n=>{var e;return(e=Jp())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bs(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Xp(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Qf(JSON.stringify(t)),Qf(JSON.stringify(o)),a].join(".")}const su={};function jM(){const n={prod:[],emulator:[]};for(const e of Object.keys(su))su[e]?n.emulator.push(e):n.prod.push(e);return n}function UM(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ST=!1;function c0(n,e){if(typeof window>"u"||typeof document>"u"||!Bs(window.location.host)||su[n]===e||su[n]||ST)return;su[n]=e;function t(p){return`__firebase__banner__${p}`}const r="__firebase__banner",i=jM().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,_){p.setAttribute("width","24"),p.setAttribute("id",_),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{ST=!0,o()},p}function h(p,_){p.setAttribute("id",_),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=UM(r),_=t("text"),T=document.getElementById(_)||document.createElement("span"),b=t("learnmore"),k=document.getElementById(b)||document.createElement("a"),C=t("preprendIcon"),x=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const R=p.element;a(R),h(k,b);const P=u();l(x,C),R.append(x,T,k,P),document.body.appendChild(R)}i?(T.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,T.innerText="Preview backend running in this workspace."),T.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function u0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ht())}function qA(){var e;const n=(e=Jp())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function BM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function d0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function WA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function $M(){const n=Ht();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function GA(){return OA.NODE_ADMIN===!0}function HA(){return!qA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function KA(){return!qA()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Zp(){try{return typeof indexedDB=="object"}catch{return!1}}function h0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function QA(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zM="FirebaseError";class $r extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=zM,Object.setPrototypeOf(this,$r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,sa.prototype.create)}}class sa{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?qM(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new $r(s,a,r)}}function qM(n,e){return n.replace(WM,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const WM=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uu(n){return JSON.parse(n)}function Wt(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YA=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Uu(Yf(i[0])||""),t=Uu(Yf(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},GM=function(n){const e=YA(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},HM=function(n){const e=YA(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function jo(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Jf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Xf(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function ur(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(bT(i)&&bT(o)){if(!ur(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function bT(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Uc(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Bc(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KM{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const p=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(p<<1|p>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const p=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=p}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function QM(n,e){const t=new YM(n,e);return t.subscribe.bind(t)}class YM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");JM(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=$g),s.error===void 0&&(s.error=$g),s.complete===void 0&&(s.complete=$g);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function JM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function $g(){}function Uo(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XM=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,H(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},em=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM=1e3,eV=2,tV=4*60*60*1e3,nV=.5;function AT(n,e=ZM,t=eV){const r=e*Math.pow(t,n),s=Math.round(nV*r*(Math.random()-.5)*2);return Math.min(tV,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z(n){return n&&n._delegate?n._delegate:n}class Qn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ho="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new nr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(sV(e))try{this.getOrInitializeService({instanceIdentifier:ho})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ho){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ho){return this.instances.has(e)}getOptions(e=ho){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:rV(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ho){return this.component?this.component.multipleInstances?e:ho:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function rV(n){return n===ho?void 0:n}function sV(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new f_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ce;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ce||(Ce={}));const iV={debug:Ce.DEBUG,verbose:Ce.VERBOSE,info:Ce.INFO,warn:Ce.WARN,error:Ce.ERROR,silent:Ce.SILENT},oV=Ce.INFO,aV={[Ce.DEBUG]:"log",[Ce.VERBOSE]:"log",[Ce.INFO]:"info",[Ce.WARN]:"warn",[Ce.ERROR]:"error"},lV=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=aV[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Id{constructor(e){this.name=e,this._logLevel=oV,this._logHandler=lV,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ce))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?iV[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ce.DEBUG,...e),this._logHandler(this,Ce.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ce.VERBOSE,...e),this._logHandler(this,Ce.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ce.INFO,...e),this._logHandler(this,Ce.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ce.WARN,...e),this._logHandler(this,Ce.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ce.ERROR,...e),this._logHandler(this,Ce.ERROR,...e)}}const cV=(n,e)=>e.some(t=>n instanceof t);let CT,RT;function uV(){return CT||(CT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dV(){return RT||(RT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const XA=new WeakMap,p_=new WeakMap,ZA=new WeakMap,zg=new WeakMap,f0=new WeakMap;function hV(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ai(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&XA.set(t,n)}).catch(()=>{}),f0.set(e,n),e}function fV(n){if(p_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});p_.set(n,e)}let m_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return p_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ZA.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ai(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function pV(n){m_=n(m_)}function mV(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(qg(this),e,...t);return ZA.set(r,e.sort?e.sort():[e]),Ai(r)}:dV().includes(n)?function(...e){return n.apply(qg(this),e),Ai(XA.get(this))}:function(...e){return Ai(n.apply(qg(this),e))}}function gV(n){return typeof n=="function"?mV(n):(n instanceof IDBTransaction&&fV(n),cV(n,uV())?new Proxy(n,m_):n)}function Ai(n){if(n instanceof IDBRequest)return hV(n);if(zg.has(n))return zg.get(n);const e=gV(n);return e!==n&&(zg.set(n,e),f0.set(e,n)),e}const qg=n=>f0.get(n);function eC(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Ai(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ai(o.result),l.oldVersion,l.newVersion,Ai(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const yV=["get","getKey","getAll","getAllKeys","count"],_V=["put","add","delete","clear"],Wg=new Map;function NT(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Wg.get(e))return Wg.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=_V.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||yV.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return Wg.set(e,i),i}pV(n=>({...n,get:(e,t,r)=>NT(e,t)||n.get(e,t,r),has:(e,t)=>!!NT(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vV{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(wV(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function wV(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const g_="@firebase/app",PT="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds=new Id("@firebase/app"),IV="@firebase/app-compat",EV="@firebase/analytics-compat",TV="@firebase/analytics",xV="@firebase/app-check-compat",SV="@firebase/app-check",bV="@firebase/auth",AV="@firebase/auth-compat",CV="@firebase/database",RV="@firebase/data-connect",NV="@firebase/database-compat",PV="@firebase/functions",kV="@firebase/functions-compat",DV="@firebase/installations",OV="@firebase/installations-compat",MV="@firebase/messaging",VV="@firebase/messaging-compat",LV="@firebase/performance",FV="@firebase/performance-compat",jV="@firebase/remote-config",UV="@firebase/remote-config-compat",BV="@firebase/storage",$V="@firebase/storage-compat",zV="@firebase/firestore",qV="@firebase/ai",WV="@firebase/firestore-compat",GV="firebase",HV="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zf="[DEFAULT]",KV={[g_]:"fire-core",[IV]:"fire-core-compat",[TV]:"fire-analytics",[EV]:"fire-analytics-compat",[SV]:"fire-app-check",[xV]:"fire-app-check-compat",[bV]:"fire-auth",[AV]:"fire-auth-compat",[CV]:"fire-rtdb",[RV]:"fire-data-connect",[NV]:"fire-rtdb-compat",[PV]:"fire-fn",[kV]:"fire-fn-compat",[DV]:"fire-iid",[OV]:"fire-iid-compat",[MV]:"fire-fcm",[VV]:"fire-fcm-compat",[LV]:"fire-perf",[FV]:"fire-perf-compat",[jV]:"fire-rc",[UV]:"fire-rc-compat",[BV]:"fire-gcs",[$V]:"fire-gcs-compat",[zV]:"fire-fst",[WV]:"fire-fst-compat",[qV]:"fire-vertex","fire-js":"fire-js",[GV]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bu=new Map,QV=new Map,y_=new Map;function kT(n,e){try{n.container.addComponent(e)}catch(t){Ds.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Br(n){const e=n.name;if(y_.has(e))return Ds.debug(`There were multiple attempts to register component ${e}.`),!1;y_.set(e,n);for(const t of Bu.values())kT(t,n);for(const t of QV.values())kT(t,n);return!0}function hs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function YV(n,e,t=Zf){hs(n,e).clearInstance(t)}function mt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JV={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ci=new sa("app","Firebase",JV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Qn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ci.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oa=HV;function tC(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Zf,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Ci.create("bad-app-name",{appName:String(s)});if(t||(t=BA()),!t)throw Ci.create("no-options");const i=Bu.get(s);if(i){if(ur(t,i.options)&&ur(r,i.config))return i;throw Ci.create("duplicate-app",{appName:s})}const o=new JA(s);for(const l of y_.values())o.addComponent(l);const a=new XV(t,r,o);return Bu.set(s,a),a}function Ed(n=Zf){const e=Bu.get(n);if(!e&&n===Zf&&BA())return tC();if(!e)throw Ci.create("no-app",{appName:n});return e}function ZV(){return Array.from(Bu.values())}function Hn(n,e,t){let r=KV[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ds.warn(o.join(" "));return}Br(new Qn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL="firebase-heartbeat-database",tL=1,$u="firebase-heartbeat-store";let Gg=null;function nC(){return Gg||(Gg=eC(eL,tL,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore($u)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ci.create("idb-open",{originalErrorMessage:n.message})})),Gg}async function nL(n){try{const t=(await nC()).transaction($u),r=await t.objectStore($u).get(rC(n));return await t.done,r}catch(e){if(e instanceof $r)Ds.warn(e.message);else{const t=Ci.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ds.warn(t.message)}}}async function DT(n,e){try{const r=(await nC()).transaction($u,"readwrite");await r.objectStore($u).put(e,rC(n)),await r.done}catch(t){if(t instanceof $r)Ds.warn(t.message);else{const r=Ci.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ds.warn(r.message)}}}function rC(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rL=1024,sL=30;class iL{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new aL(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=OT();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>sL){const o=lL(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ds.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=OT(),{heartbeatsToSend:r,unsentEntries:s}=oL(this._heartbeatsCache.heartbeats),i=Qf(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Ds.warn(t),""}}}function OT(){return new Date().toISOString().substring(0,10)}function oL(n,e=rL){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),MT(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),MT(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class aL{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Zp()?h0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await nL(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return DT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return DT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function MT(n){return Qf(JSON.stringify({version:2,heartbeats:n})).length}function lL(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cL(n){Br(new Qn("platform-logger",e=>new vV(e),"PRIVATE")),Br(new Qn("heartbeat",e=>new iL(e),"PRIVATE")),Hn(g_,PT,n),Hn(g_,PT,"esm2020"),Hn("fire-js","")}cL("");var uL="firebase",dL="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hn(uL,dL,"app");const VT="@firebase/database",LT="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sC="";function iC(n){sC=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hL{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Wt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Uu(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fL{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return zr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new hL(e)}}catch{}return new fL},To=oC("localStorage"),__=oC("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el=new Id("@firebase/database"),aC=function(){let n=1;return function(){return n++}}(),lC=function(n){const e=XM(n),t=new KM;t.update(e);const r=t.digest();return l0.encodeByteArray(r)},Td=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Td.apply(null,r):typeof r=="object"?e+=Wt(r):e+=r,e+=" "}return e};let Ro=null,FT=!0;const cC=function(n,e){H(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(el.logLevel=Ce.VERBOSE,Ro=el.log.bind(el),e&&__.set("logging_enabled",!0)):typeof n=="function"?Ro=n:(Ro=null,__.remove("logging_enabled"))},en=function(...n){if(FT===!0&&(FT=!1,Ro===null&&__.get("logging_enabled")===!0&&cC(!0)),Ro){const e=Td.apply(null,n);Ro(e)}},xd=function(n){return function(...e){en(n,...e)}},v_=function(...n){const e="FIREBASE INTERNAL ERROR: "+Td(...n);el.error(e)},cs=function(...n){const e=`FIREBASE FATAL ERROR: ${Td(...n)}`;throw el.error(e),new Error(e)},En=function(...n){const e="FIREBASE WARNING: "+Td(...n);el.warn(e)},pL=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&En("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},tm=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},mL=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Vi="[MIN_NAME]",Os="[MAX_NAME]",aa=function(n,e){if(n===e)return 0;if(n===Vi||e===Os)return-1;if(e===Vi||n===Os)return 1;{const t=jT(n),r=jT(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},gL=function(n,e){return n===e?0:n<e?-1:1},bc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Wt(e))},p0=function(n){if(typeof n!="object"||n===null)return Wt(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Wt(e[r]),t+=":",t+=p0(n[e[r]]);return t+="}",t},uC=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function sn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const dC=function(n){H(!tm(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let p=parseInt(h.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),f=f+p}return f.toLowerCase()},yL=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},_L=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function vL(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const wL=new RegExp("^-?(0*)\\d{1,10}$"),IL=-2147483648,EL=2147483647,jT=function(n){if(wL.test(n)){const e=Number(n);if(e>=IL&&e<=EL)return e}return null},Wl=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw En("Exception was thrown by user callback.",t),e},Math.floor(0))}},TL=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},iu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xL{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,mt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){En(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SL{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(en("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',En(e)}}class tl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}tl.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m0="5",hC="v",fC="s",pC="r",mC="f",gC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,yC="ls",_C="p",w_="ac",vC="websocket",wC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IC{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=To.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&To.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function bL(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function EC(n,e,t){H(typeof e=="string","typeof type must == string"),H(typeof t=="object","typeof params must == object");let r;if(e===vC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===wC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);bL(n)&&(t.ns=n.namespace);const s=[];return sn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(){this.counters_={}}incrementCounter(e,t=1){zr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return OM(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hg={},Kg={};function g0(n){const e=n.toString();return Hg[e]||(Hg[e]=new AL),Hg[e]}function CL(n,e){const t=n.toString();return Kg[t]||(Kg[t]=e()),Kg[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Wl(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UT="start",NL="close",PL="pLPCommand",kL="pRTLPCB",TC="id",xC="pw",SC="ser",DL="cb",OL="seg",ML="ts",VL="d",LL="dframe",bC=1870,AC=30,FL=bC-AC,jL=25e3,UL=3e4;class fi{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=xd(e),this.stats_=g0(t),this.urlFn=l=>(this.appCheckToken&&(l[w_]=this.appCheckToken),EC(t,wC,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new RL(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(UL)),mL(()=>{if(this.isClosed_)return;this.scriptTagHolder=new y0((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===UT)this.id=a,this.password=l;else if(o===NL)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[UT]="t",r[SC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[DL]=this.scriptTagHolder.uniqueCallbackIdentifier),r[hC]=m0,this.transportSessionId&&(r[fC]=this.transportSessionId),this.lastSessionId&&(r[yC]=this.lastSessionId),this.applicationId&&(r[_C]=this.applicationId),this.appCheckToken&&(r[w_]=this.appCheckToken),typeof location<"u"&&location.hostname&&gC.test(location.hostname)&&(r[pC]=mC);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){fi.forceAllow_=!0}static forceDisallow(){fi.forceDisallow_=!0}static isAvailable(){return fi.forceAllow_?!0:!fi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!yL()&&!_L()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Wt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=VA(t),s=uC(r,FL);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[LL]="t",r[TC]=e,r[xC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Wt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class y0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=aC(),window[PL+this.uniqueCallbackIdentifier]=e,window[kL+this.uniqueCallbackIdentifier]=t,this.myIFrame=y0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){en("frame writing exception"),a.stack&&en(a.stack),en(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||en("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[TC]=this.myID,e[xC]=this.myPW,e[SC]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+AC+r.length<=bC;){const o=this.pendingSegs.shift();r=r+"&"+OL+s+"="+o.seg+"&"+ML+s+"="+o.ts+"&"+VL+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(jL)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{en("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BL=16384,$L=45e3;let ep=null;typeof MozWebSocket<"u"?ep=MozWebSocket:typeof WebSocket<"u"&&(ep=WebSocket);class vr{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=xd(this.connId),this.stats_=g0(t),this.connURL=vr.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[hC]=m0,typeof location<"u"&&location.hostname&&gC.test(location.hostname)&&(o[pC]=mC),t&&(o[fC]=t),r&&(o[yC]=r),s&&(o[w_]=s),i&&(o[_C]=i),EC(e,vC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,To.set("previous_websocket_failure",!0);try{let r;GA(),this.mySock=new ep(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){vr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&ep!==null&&!vr.forceDisallow_}static previouslyFailed(){return To.isInMemoryStorage||To.get("previous_websocket_failure")===!0}markConnectionHealthy(){To.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Uu(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(H(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=Wt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=uC(t,BL);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor($L))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}vr.responsesRequiredToBeHealthy=2;vr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{static get ALL_TRANSPORTS(){return[fi,vr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=vr&&vr.isAvailable();let r=t&&!vr.previouslyFailed();if(e.webSocketOnly&&(t||En("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[vr];else{const s=this.transports_=[];for(const i of ml.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);ml.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ml.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zL=6e4,qL=5e3,WL=10*1024,GL=100*1024,Qg="t",BT="d",HL="s",$T="r",KL="e",zT="o",qT="a",WT="n",GT="p",QL="h";class YL{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=xd("c:"+this.id+":"),this.transportManager_=new ml(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=iu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>GL?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>WL?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Qg in e){const t=e[Qg];t===qT?this.upgradeIfSecondaryHealthy_():t===$T?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===zT&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=bc("t",e),r=bc("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:GT,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:qT,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:WT,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=bc("t",e),r=bc("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=bc(Qg,e);if(BT in e){const r=e[BT];if(t===QL){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===WT){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===HL?this.onConnectionShutdown_(r):t===$T?this.onReset_(r):t===KL?v_("Server Error: "+r):t===zT?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):v_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),m0!==r&&En("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),iu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(zL))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):iu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(qL))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:GT,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(To.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(e){this.allowedEvents_=e,this.listeners_={},H(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){H(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp extends RC{static getInstance(){return new tp}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!u0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return H(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HT=32,KT=768;class ze{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ue(){return new ze("")}function Te(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Li(n){return n.pieces_.length-n.pieceNum_}function Ze(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ze(n.pieces_,e)}function _0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function JL(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function zu(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function NC(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ze(e,0)}function gt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ze)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new ze(t,0)}function xe(n){return n.pieceNum_>=n.pieces_.length}function kn(n,e){const t=Te(n),r=Te(e);if(t===null)return e;if(t===r)return kn(Ze(n),Ze(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function XL(n,e){const t=zu(n,0),r=zu(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=aa(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function v0(n,e){if(Li(n)!==Li(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Ir(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Li(n)>Li(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class ZL{constructor(e,t){this.errorPrefix_=t,this.parts_=zu(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=em(this.parts_[r]);PC(this)}}function eF(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=em(e),PC(n)}function tF(n){const e=n.parts_.pop();n.byteLength_-=em(e),n.parts_.length>0&&(n.byteLength_-=1)}function PC(n){if(n.byteLength_>KT)throw new Error(n.errorPrefix_+"has a key path longer than "+KT+" bytes ("+n.byteLength_+").");if(n.parts_.length>HT)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+HT+") or object contains a cycle "+fo(n))}function fo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0 extends RC{static getInstance(){return new w0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return H(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ac=1e3,nF=60*5*1e3,QT=30*1e3,rF=1.3,sF=3e4,iF="server_kill",YT=3;class Tr extends CC{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Tr.nextPersistentConnectionId_++,this.log_=xd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ac,this.maxReconnectDelay_=nF,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!GA())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");w0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&tp.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(Wt(i)),H(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new nr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),H(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;Tr.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&zr(e,"w")){const r=jo(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();En(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||HM(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=QT)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=GM(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Wt(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):v_("Unrecognized action received from server: "+Wt(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){H(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ac,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ac,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>sF&&(this.reconnectDelay_=Ac),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*rF)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Tr.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){H(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,p]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?en("getToken() completed but was canceled"):(en("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=p&&p.token,a=new YL(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,_=>{En(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(iF)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&En(f),l())}}}interrupt(e){en("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){en("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Jf(this.interruptReasons_)&&(this.reconnectDelay_=Ac,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>p0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new ze(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){en("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=YT&&(this.reconnectDelay_=QT,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){en("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=YT&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+sC.replace(/\./g,"-")]=1,u0()?e["framework.cordova"]=1:WA()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=tp.getInstance().currentlyOnline();return Jf(this.interruptReasons_)&&e}}Tr.nextPersistentConnectionId_=0;Tr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new be(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new be(Vi,e),s=new be(Vi,t);return this.compare(r,s)!==0}minPost(){return be.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kh;class kC extends nm{static get __EMPTY_NODE(){return kh}static set __EMPTY_NODE(e){kh=e}compare(e,t){return aa(e.name,t.name)}isDefinedOn(e){throw ql("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return be.MIN}maxPost(){return new be(Os,kh)}makePost(e,t){return H(typeof e=="string","KeyIndex indexValue must always be a string."),new be(e,kh)}toString(){return".key"}}const ss=new kC;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dh=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},er=class $c{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??$c.RED,this.left=s??Jr.EMPTY_NODE,this.right=i??Jr.EMPTY_NODE}copy(e,t,r,s,i){return new $c(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Jr.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Jr.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,$c.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,$c.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};er.RED=!0;er.BLACK=!1;class oF{copy(e,t,r,s,i){return this}insert(e,t,r){return new er(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Jr=class af{constructor(e,t=af.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new af(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,er.BLACK,null,null))}remove(e){return new af(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,er.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Dh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Dh(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Dh(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Dh(this.root_,null,this.comparator_,!0,e)}};Jr.EMPTY_NODE=new oF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aF(n,e){return aa(n.name,e.name)}function I0(n,e){return aa(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let I_;function lF(n){I_=n}const DC=function(n){return typeof n=="number"?"number:"+dC(n):"string:"+n},OC=function(n){if(n.isLeafNode()){const e=n.val();H(typeof e=="string"||typeof e=="number"||typeof e=="object"&&zr(e,".sv"),"Priority must be a string or number.")}else H(n===I_||n.isEmpty(),"priority of unexpected type.");H(n===I_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let JT;class Qt{static set __childrenNodeConstructor(e){JT=e}static get __childrenNodeConstructor(){return JT}constructor(e,t=Qt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,H(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),OC(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Qt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Qt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return xe(e)?this:Te(e)===".priority"?this.priorityNode_:Qt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Qt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=Te(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(H(r!==".priority"||Li(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Qt.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ze(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+DC(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=dC(this.value_):e+=this.value_,this.lazyHash_=lC(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Qt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Qt.__childrenNodeConstructor?-1:(H(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=Qt.VALUE_TYPE_ORDER.indexOf(t),i=Qt.VALUE_TYPE_ORDER.indexOf(r);return H(s>=0,"Unknown leaf type: "+t),H(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Qt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MC,VC;function cF(n){MC=n}function uF(n){VC=n}class dF extends nm{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?aa(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return be.MIN}maxPost(){return new be(Os,new Qt("[PRIORITY-POST]",VC))}makePost(e,t){const r=MC(e);return new be(t,new Qt("[PRIORITY-POST]",r))}toString(){return".priority"}}const it=new dF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hF=Math.log(2);class fF{constructor(e){const t=i=>parseInt(Math.log(i)/hF,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const np=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,p;if(h===0)return null;if(h===1)return f=n[l],p=t?t(f):f,new er(p,f.node,er.BLACK,null,null);{const _=parseInt(h/2,10)+l,T=s(l,_),b=s(_+1,u);return f=n[_],p=t?t(f):f,new er(p,f.node,er.BLACK,T,b)}},i=function(l){let u=null,h=null,f=n.length;const p=function(T,b){const k=f-T,C=f;f-=T;const x=s(k+1,C),R=n[k],P=t?t(R):R;_(new er(P,R.node,b,null,x))},_=function(T){u?(u.left=T,u=T):(h=T,u=T)};for(let T=0;T<l.count;++T){const b=l.nextBitIsOne(),k=Math.pow(2,l.count-(T+1));b?p(k,er.BLACK):(p(k,er.BLACK),p(k,er.RED))}return h},o=new fF(n.length),a=i(o);return new Jr(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yg;const Sa={};class Ts{static get Default(){return H(Sa&&it,"ChildrenNode.ts has not been loaded"),Yg=Yg||new Ts({".priority":Sa},{".priority":it}),Yg}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=jo(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Jr?t:null}hasIndex(e){return zr(this.indexSet_,e.toString())}addIndex(e,t){H(e!==ss,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(be.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=np(r,e.getCompare()):a=Sa;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new Ts(h,u)}addToIndexes(e,t){const r=Xf(this.indexes_,(s,i)=>{const o=jo(this.indexSet_,i);if(H(o,"Missing index implementation for "+i),s===Sa)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(be.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),np(a,o.getCompare())}else return Sa;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new be(e.name,a))),l.insert(e,e.node)}});return new Ts(r,this.indexSet_)}removeFromIndexes(e,t){const r=Xf(this.indexes_,s=>{if(s===Sa)return s;{const i=t.get(e.name);return i?s.remove(new be(e.name,i)):s}});return new Ts(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cc;class pe{static get EMPTY_NODE(){return Cc||(Cc=new pe(new Jr(I0),null,Ts.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&OC(this.priorityNode_),this.children_.isEmpty()&&H(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Cc}updatePriority(e){return this.children_.isEmpty()?this:new pe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Cc:t}}getChild(e){const t=Te(e);return t===null?this:this.getImmediateChild(t).getChild(Ze(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(H(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new be(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Cc:this.priorityNode_;return new pe(s,o,i)}}updateChild(e,t){const r=Te(e);if(r===null)return t;{H(Te(e)!==".priority"||Li(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Ze(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(it,(o,a)=>{t[o]=a.val(e),r++,i&&pe.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+DC(this.getPriority().val())+":"),this.forEachChild(it,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":lC(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new be(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new be(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new be(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Sd?-1:0}withIndex(e){if(e===ss||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new pe(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ss||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(it),s=t.getIterator(it);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ss?null:this.indexMap_.get(e.toString())}}pe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class pF extends pe{constructor(){super(new Jr(I0),pe.EMPTY_NODE,Ts.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return pe.EMPTY_NODE}isEmpty(){return!1}}const Sd=new pF;Object.defineProperties(be,{MIN:{value:new be(Vi,pe.EMPTY_NODE)},MAX:{value:new be(Os,Sd)}});kC.__EMPTY_NODE=pe.EMPTY_NODE;Qt.__childrenNodeConstructor=pe;lF(Sd);uF(Sd);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mF=!0;function xt(n,e=null){if(n===null)return pe.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),H(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Qt(t,xt(e))}if(!(n instanceof Array)&&mF){const t=[];let r=!1;if(sn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=xt(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new be(o,l)))}}),t.length===0)return pe.EMPTY_NODE;const i=np(t,aF,o=>o.name,I0);if(r){const o=np(t,it.getCompare());return new pe(i,xt(e),new Ts({".priority":o},{".priority":it}))}else return new pe(i,xt(e),Ts.Default)}else{let t=pe.EMPTY_NODE;return sn(n,(r,s)=>{if(zr(n,r)&&r.substring(0,1)!=="."){const i=xt(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(xt(e))}}cF(xt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0 extends nm{constructor(e){super(),this.indexPath_=e,H(!xe(e)&&Te(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?aa(e.name,t.name):i}makePost(e,t){const r=xt(e),s=pe.EMPTY_NODE.updateChild(this.indexPath_,r);return new be(t,s)}maxPost(){const e=pe.EMPTY_NODE.updateChild(this.indexPath_,Sd);return new be(Os,e)}toString(){return zu(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF extends nm{compare(e,t){const r=e.node.compareTo(t.node);return r===0?aa(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return be.MIN}maxPost(){return be.MAX}makePost(e,t){const r=xt(e);return new be(t,r)}toString(){return".value"}}const T0=new gF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LC(n){return{type:"value",snapshotNode:n}}function gl(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function qu(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Wu(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function yF(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){H(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(qu(t,a)):H(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(gl(t,r)):o.trackChildChange(Wu(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(it,(s,i)=>{t.hasChild(s)||r.trackChildChange(qu(s,i))}),t.isLeafNode()||t.forEachChild(it,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Wu(s,i,o))}else r.trackChildChange(gl(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?pe.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e){this.indexedFilter_=new x0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Gu.getStartPost_(e),this.endPost_=Gu.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new be(t,r))||(r=pe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=pe.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(pe.EMPTY_NODE);const i=this;return t.forEachChild(it,(o,a)=>{i.matches(new be(o,a))||(s=s.updateImmediateChild(o,pe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _F{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Gu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new be(t,r))||(r=pe.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=pe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=pe.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(pe.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,pe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(p,_)=>f(_,p)}else o=this.index_.getCompare();const a=e;H(a.numChildren()===this.limit_,"");const l=new be(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let p=s.getChildAfterChild(this.index_,u,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=s.getChildAfterChild(this.index_,p,this.reverse_);const _=p==null?1:o(p,l);if(h&&!r.isEmpty()&&_>=0)return i!=null&&i.trackChildChange(Wu(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(qu(t,f));const b=a.updateImmediateChild(t,pe.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(i!=null&&i.trackChildChange(gl(p.name,p.node)),b.updateImmediateChild(p.name,p.node)):b}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(qu(u.name,u.node)),i.trackChildChange(gl(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,pe.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=it}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return H(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return H(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Vi}hasEnd(){return this.endSet_}getIndexEndValue(){return H(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return H(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Os}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return H(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===it}copy(){const e=new S0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function vF(n){return n.loadsAllData()?new x0(n.getIndex()):n.hasLimit()?new _F(n):new Gu(n)}function wF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function IF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function E_(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function EF(n,e,t){let r;return n.index_===ss||t?r=E_(n,e,t):r=E_(n,e,Os),r.startAfterSet_=!0,r}function T_(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function TF(n,e,t){let r;return n.index_===ss||t?r=T_(n,e,t):r=T_(n,e,Vi),r.endBeforeSet_=!0,r}function rm(n,e){const t=n.copy();return t.index_=e,t}function XT(n){const e={};if(n.isDefault())return e;let t;if(n.index_===it?t="$priority":n.index_===T0?t="$value":n.index_===ss?t="$key":(H(n.index_ instanceof E0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Wt(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=Wt(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Wt(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Wt(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Wt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function ZT(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==it&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp extends CC{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(H(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=xd("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=rp.getListenId_(e,r),a={};this.listens_[o]=a;const l=XT(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),jo(this.listens_,o)===a){let p;u?u===401?p="permission_denied":p="rest_error:"+u:p="ok",s(p,null)}})}unlisten(e,t){const r=rp.getListenId_(e,t);delete this.listens_[r]}get(e){const t=XT(e._queryParams),r=e._path.toString(),s=new nr;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ia(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Uu(a.responseText)}catch{En("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&En("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF{constructor(){this.rootNode_=pe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sp(){return{value:null,children:new Map}}function Gl(n,e,t){if(xe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=Te(e);n.children.has(r)||n.children.set(r,sp());const s=n.children.get(r);e=Ze(e),Gl(s,e,t)}}function x_(n,e){if(xe(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(it,(r,s)=>{Gl(n,new ze(r),s)}),x_(n,e)}}else if(n.children.size>0){const t=Te(e);return e=Ze(e),n.children.has(t)&&x_(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function S_(n,e,t){n.value!==null?t(e,n.value):SF(n,(r,s)=>{const i=new ze(e.toString()+"/"+r);S_(s,i,t)})}function SF(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bF{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&sn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ex=10*1e3,AF=30*1e3,CF=5*60*1e3;class RF{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new bF(e);const r=ex+(AF-ex)*Math.random();iu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;sn(e,(s,i)=>{i>0&&zr(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),iu(this.reportStats_.bind(this),Math.floor(Math.random()*2*CF))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Or;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Or||(Or={}));function b0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function A0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function C0(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Or.ACK_USER_WRITE,this.source=b0()}operationForChild(e){if(xe(this.path)){if(this.affectedTree.value!=null)return H(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ze(e));return new ip(Ue(),t,this.revert)}}else return H(Te(this.path)===e,"operationForChild called for unrelated child."),new ip(Ze(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e,t){this.source=e,this.path=t,this.type=Or.LISTEN_COMPLETE}operationForChild(e){return xe(this.path)?new Hu(this.source,Ue()):new Hu(this.source,Ze(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Or.OVERWRITE}operationForChild(e){return xe(this.path)?new Bo(this.source,Ue(),this.snap.getImmediateChild(e)):new Bo(this.source,Ze(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Or.MERGE}operationForChild(e){if(xe(this.path)){const t=this.children.subtree(new ze(e));return t.isEmpty()?null:t.value?new Bo(this.source,Ue(),t.value):new yl(this.source,Ue(),t)}else return H(Te(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new yl(this.source,Ze(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(xe(e))return this.isFullyInitialized()&&!this.filtered_;const t=Te(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function PF(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(yF(o.childName,o.snapshotNode))}),Rc(n,s,"child_removed",e,r,t),Rc(n,s,"child_added",e,r,t),Rc(n,s,"child_moved",i,r,t),Rc(n,s,"child_changed",e,r,t),Rc(n,s,"value",e,r,t),s}function Rc(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>DF(n,a,l)),o.forEach(a=>{const l=kF(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function kF(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function DF(n,e,t){if(e.childName==null||t.childName==null)throw ql("Should only compare child_ events.");const r=new be(e.childName,e.snapshotNode),s=new be(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sm(n,e){return{eventCache:n,serverCache:e}}function ou(n,e,t,r){return sm(new Fi(e,t,r),n.serverCache)}function FC(n,e,t,r){return sm(n.eventCache,new Fi(e,t,r))}function op(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function $o(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jg;const OF=()=>(Jg||(Jg=new Jr(gL)),Jg);class rt{static fromObject(e){let t=new rt(null);return sn(e,(r,s)=>{t=t.set(new ze(r),s)}),t}constructor(e,t=OF()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ue(),value:this.value};if(xe(e))return null;{const r=Te(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Ze(e),t);return i!=null?{path:gt(new ze(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(xe(e))return this;{const t=Te(e),r=this.children.get(t);return r!==null?r.subtree(Ze(e)):new rt(null)}}set(e,t){if(xe(e))return new rt(t,this.children);{const r=Te(e),i=(this.children.get(r)||new rt(null)).set(Ze(e),t),o=this.children.insert(r,i);return new rt(this.value,o)}}remove(e){if(xe(e))return this.children.isEmpty()?new rt(null):new rt(null,this.children);{const t=Te(e),r=this.children.get(t);if(r){const s=r.remove(Ze(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new rt(null):new rt(this.value,i)}else return this}}get(e){if(xe(e))return this.value;{const t=Te(e),r=this.children.get(t);return r?r.get(Ze(e)):null}}setTree(e,t){if(xe(e))return t;{const r=Te(e),i=(this.children.get(r)||new rt(null)).setTree(Ze(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new rt(this.value,o)}}fold(e){return this.fold_(Ue(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(gt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ue(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(xe(e))return null;{const i=Te(e),o=this.children.get(i);return o?o.findOnPath_(Ze(e),gt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ue(),t)}foreachOnPath_(e,t,r){if(xe(e))return this;{this.value&&r(t,this.value);const s=Te(e),i=this.children.get(s);return i?i.foreachOnPath_(Ze(e),gt(t,s),r):new rt(null)}}foreach(e){this.foreach_(Ue(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(gt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(e){this.writeTree_=e}static empty(){return new Fr(new rt(null))}}function au(n,e,t){if(xe(e))return new Fr(new rt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=kn(s,e);return i=i.updateChild(o,t),new Fr(n.writeTree_.set(s,i))}else{const s=new rt(t),i=n.writeTree_.setTree(e,s);return new Fr(i)}}}function b_(n,e,t){let r=n;return sn(t,(s,i)=>{r=au(r,gt(e,s),i)}),r}function tx(n,e){if(xe(e))return Fr.empty();{const t=n.writeTree_.setTree(e,new rt(null));return new Fr(t)}}function A_(n,e){return la(n,e)!=null}function la(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(kn(t.path,e)):null}function nx(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(it,(r,s)=>{e.push(new be(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new be(r,s.value))}),e}function Ri(n,e){if(xe(e))return n;{const t=la(n,e);return t!=null?new Fr(new rt(t)):new Fr(n.writeTree_.subtree(e))}}function C_(n){return n.writeTree_.isEmpty()}function _l(n,e){return jC(Ue(),n.writeTree_,e)}function jC(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(H(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=jC(gt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(gt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function im(n,e){return zC(e,n)}function MF(n,e,t,r,s){H(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=au(n.visibleWrites,e,t)),n.lastWriteId=r}function VF(n,e,t,r){H(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=b_(n.visibleWrites,e,t),n.lastWriteId=r}function LF(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function FF(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);H(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&jF(a,r.path)?s=!1:Ir(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return UF(n),!0;if(r.snap)n.visibleWrites=tx(n.visibleWrites,r.path);else{const a=r.children;sn(a,l=>{n.visibleWrites=tx(n.visibleWrites,gt(r.path,l))})}return!0}else return!1}function jF(n,e){if(n.snap)return Ir(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ir(gt(n.path,t),e))return!0;return!1}function UF(n){n.visibleWrites=UC(n.allWrites,BF,Ue()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function BF(n){return n.visible}function UC(n,e,t){let r=Fr.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)Ir(t,o)?(a=kn(t,o),r=au(r,a,i.snap)):Ir(o,t)&&(a=kn(o,t),r=au(r,Ue(),i.snap.getChild(a)));else if(i.children){if(Ir(t,o))a=kn(t,o),r=b_(r,a,i.children);else if(Ir(o,t))if(a=kn(o,t),xe(a))r=b_(r,Ue(),i.children);else{const l=jo(i.children,Te(a));if(l){const u=l.getChild(Ze(a));r=au(r,Ue(),u)}}}else throw ql("WriteRecord should have .snap or .children")}}return r}function BC(n,e,t,r,s){if(!r&&!s){const i=la(n.visibleWrites,e);if(i!=null)return i;{const o=Ri(n.visibleWrites,e);if(C_(o))return t;if(t==null&&!A_(o,Ue()))return null;{const a=t||pe.EMPTY_NODE;return _l(o,a)}}}else{const i=Ri(n.visibleWrites,e);if(!s&&C_(i))return t;if(!s&&t==null&&!A_(i,Ue()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Ir(u.path,e)||Ir(e,u.path))},a=UC(n.allWrites,o,e),l=t||pe.EMPTY_NODE;return _l(a,l)}}}function $F(n,e,t){let r=pe.EMPTY_NODE;const s=la(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(it,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=Ri(n.visibleWrites,e);return t.forEachChild(it,(o,a)=>{const l=_l(Ri(i,new ze(o)),a);r=r.updateImmediateChild(o,l)}),nx(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=Ri(n.visibleWrites,e);return nx(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function zF(n,e,t,r,s){H(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=gt(e,t);if(A_(n.visibleWrites,i))return null;{const o=Ri(n.visibleWrites,i);return C_(o)?s.getChild(t):_l(o,s.getChild(t))}}function qF(n,e,t,r){const s=gt(e,t),i=la(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=Ri(n.visibleWrites,s);return _l(o,r.getNode().getImmediateChild(t))}else return null}function WF(n,e){return la(n.visibleWrites,e)}function GF(n,e,t,r,s,i,o){let a;const l=Ri(n.visibleWrites,e),u=la(l,Ue());if(u!=null)a=u;else if(t!=null)a=_l(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),p=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let _=p.getNext();for(;_&&h.length<s;)f(_,r)!==0&&h.push(_),_=p.getNext();return h}else return[]}function HF(){return{visibleWrites:Fr.empty(),allWrites:[],lastWriteId:-1}}function ap(n,e,t,r){return BC(n.writeTree,n.treePath,e,t,r)}function R0(n,e){return $F(n.writeTree,n.treePath,e)}function rx(n,e,t,r){return zF(n.writeTree,n.treePath,e,t,r)}function lp(n,e){return WF(n.writeTree,gt(n.treePath,e))}function KF(n,e,t,r,s,i){return GF(n.writeTree,n.treePath,e,t,r,s,i)}function N0(n,e,t){return qF(n.writeTree,n.treePath,e,t)}function $C(n,e){return zC(gt(n.treePath,e),n.writeTree)}function zC(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;H(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),H(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Wu(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,qu(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,gl(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Wu(r,e.snapshotNode,s.oldSnap));else throw ql("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const qC=new YF;class P0{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Fi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return N0(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:$o(this.viewCache_),i=KF(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JF(n){return{filter:n}}function XF(n,e){H(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),H(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function ZF(n,e,t,r,s){const i=new QF;let o,a;if(t.type===Or.OVERWRITE){const u=t;u.source.fromUser?o=R_(n,e,u.path,u.snap,r,s,i):(H(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!xe(u.path),o=cp(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===Or.MERGE){const u=t;u.source.fromUser?o=tj(n,e,u.path,u.children,r,s,i):(H(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=N_(n,e,u.path,u.children,r,s,a,i))}else if(t.type===Or.ACK_USER_WRITE){const u=t;u.revert?o=sj(n,e,u.path,r,s,i):o=nj(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===Or.LISTEN_COMPLETE)o=rj(n,e,t.path,r,i);else throw ql("Unknown operation type: "+t.type);const l=i.getChanges();return ej(e,o,l),{viewCache:o,changes:l}}function ej(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=op(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(LC(op(e)))}}function WC(n,e,t,r,s,i){const o=e.eventCache;if(lp(r,t)!=null)return e;{let a,l;if(xe(t))if(H(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=$o(e),h=u instanceof pe?u:pe.EMPTY_NODE,f=R0(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=ap(r,$o(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Te(t);if(u===".priority"){H(Li(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=rx(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=Ze(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const p=rx(r,t,o.getNode(),l);p!=null?f=o.getNode().getImmediateChild(u).updateChild(h,p):f=o.getNode().getImmediateChild(u)}else f=N0(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return ou(e,a,o.isFullyInitialized()||xe(t),n.filter.filtersNodes())}}function cp(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(xe(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const _=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),_,null)}else{const _=Te(t);if(!l.isCompleteForPath(t)&&Li(t)>1)return e;const T=Ze(t),k=l.getNode().getImmediateChild(_).updateChild(T,r);_===".priority"?u=h.updatePriority(l.getNode(),k):u=h.updateChild(l.getNode(),_,k,T,qC,null)}const f=FC(e,u,l.isFullyInitialized()||xe(t),h.filtersNodes()),p=new P0(s,f,i);return WC(n,f,t,s,p,a)}function R_(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new P0(s,e,i);if(xe(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=ou(e,u,!0,n.filter.filtersNodes());else{const f=Te(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=ou(e,u,a.isFullyInitialized(),a.isFiltered());else{const p=Ze(t),_=a.getNode().getImmediateChild(f);let T;if(xe(p))T=r;else{const b=h.getCompleteChild(f);b!=null?_0(p)===".priority"&&b.getChild(NC(p)).isEmpty()?T=b:T=b.updateChild(p,r):T=pe.EMPTY_NODE}if(_.equals(T))l=e;else{const b=n.filter.updateChild(a.getNode(),f,T,p,h,o);l=ou(e,b,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function sx(n,e){return n.eventCache.isCompleteForChild(e)}function tj(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=gt(t,l);sx(e,Te(h))&&(a=R_(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=gt(t,l);sx(e,Te(h))||(a=R_(n,a,h,u,s,i,o))}),a}function ix(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function N_(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;xe(t)?u=r:u=new rt(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,p)=>{if(h.hasChild(f)){const _=e.serverCache.getNode().getImmediateChild(f),T=ix(n,_,p);l=cp(n,l,new ze(f),T,s,i,o,a)}}),u.children.inorderTraversal((f,p)=>{const _=!e.serverCache.isCompleteForChild(f)&&p.value===null;if(!h.hasChild(f)&&!_){const T=e.serverCache.getNode().getImmediateChild(f),b=ix(n,T,p);l=cp(n,l,new ze(f),b,s,i,o,a)}}),l}function nj(n,e,t,r,s,i,o){if(lp(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(xe(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return cp(n,e,t,l.getNode().getChild(t),s,i,a,o);if(xe(t)){let u=new rt(null);return l.getNode().forEachChild(ss,(h,f)=>{u=u.set(new ze(h),f)}),N_(n,e,t,u,s,i,a,o)}else return e}else{let u=new rt(null);return r.foreach((h,f)=>{const p=gt(t,h);l.isCompleteForPath(p)&&(u=u.set(h,l.getNode().getChild(p)))}),N_(n,e,t,u,s,i,a,o)}}function rj(n,e,t,r,s){const i=e.serverCache,o=FC(e,i.getNode(),i.isFullyInitialized()||xe(t),i.isFiltered());return WC(n,o,t,r,qC,s)}function sj(n,e,t,r,s,i){let o;if(lp(r,t)!=null)return e;{const a=new P0(r,e,s),l=e.eventCache.getNode();let u;if(xe(t)||Te(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=ap(r,$o(e));else{const f=e.serverCache.getNode();H(f instanceof pe,"serverChildren would be complete if leaf node"),h=R0(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Te(t);let f=N0(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,Ze(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,pe.EMPTY_NODE,Ze(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ap(r,$o(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||lp(r,Ue())!=null,ou(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ij{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new x0(r.getIndex()),i=vF(r);this.processor_=JF(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(pe.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(pe.EMPTY_NODE,a.getNode(),null),h=new Fi(l,o.isFullyInitialized(),s.filtersNodes()),f=new Fi(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=sm(f,h),this.eventGenerator_=new NF(this.query_)}get query(){return this.query_}}function oj(n){return n.viewCache_.serverCache.getNode()}function aj(n){return op(n.viewCache_)}function lj(n,e){const t=$o(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!xe(e)&&!t.getImmediateChild(Te(e)).isEmpty())?t.getChild(e):null}function ox(n){return n.eventRegistrations_.length===0}function cj(n,e){n.eventRegistrations_.push(e)}function ax(n,e,t){const r=[];if(t){H(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function lx(n,e,t,r){e.type===Or.MERGE&&e.source.queryId!==null&&(H($o(n.viewCache_),"We should always have a full cache before handling merges"),H(op(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=ZF(n.processor_,s,e,t,r);return XF(n.processor_,i.viewCache),H(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,GC(n,i.changes,i.viewCache.eventCache.getNode(),null)}function uj(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(it,(i,o)=>{r.push(gl(i,o))}),t.isFullyInitialized()&&r.push(LC(t.getNode())),GC(n,r,t.getNode(),e)}function GC(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return PF(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let up;class HC{constructor(){this.views=new Map}}function dj(n){H(!up,"__referenceConstructor has already been defined"),up=n}function hj(){return H(up,"Reference.ts has not been loaded"),up}function fj(n){return n.views.size===0}function k0(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return H(i!=null,"SyncTree gave us an op for an invalid query."),lx(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(lx(o,e,t,r));return i}}function KC(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=ap(t,s?r:null),l=!1;a?l=!0:r instanceof pe?(a=R0(t,r),l=!1):(a=pe.EMPTY_NODE,l=!1);const u=sm(new Fi(a,l,!1),new Fi(r,s,!1));return new ij(e,u)}return o}function pj(n,e,t,r,s,i){const o=KC(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),cj(o,t),uj(o,t)}function mj(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=ji(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(ax(u,t,r)),ox(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(ax(l,t,r)),ox(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!ji(n)&&i.push(new(hj())(e._repo,e._path)),{removed:i,events:o}}function QC(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ni(n,e){let t=null;for(const r of n.views.values())t=t||lj(r,e);return t}function YC(n,e){if(e._queryParams.loadsAllData())return om(n);{const r=e._queryIdentifier;return n.views.get(r)}}function JC(n,e){return YC(n,e)!=null}function ji(n){return om(n)!=null}function om(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dp;function gj(n){H(!dp,"__referenceConstructor has already been defined"),dp=n}function yj(){return H(dp,"Reference.ts has not been loaded"),dp}let _j=1;class cx{constructor(e){this.listenProvider_=e,this.syncPointTree_=new rt(null),this.pendingWriteTree_=HF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function D0(n,e,t,r,s){return MF(n.pendingWriteTree_,e,t,r,s),s?Hl(n,new Bo(b0(),e,t)):[]}function vj(n,e,t,r){VF(n.pendingWriteTree_,e,t,r);const s=rt.fromObject(t);return Hl(n,new yl(b0(),e,s))}function pi(n,e,t=!1){const r=LF(n.pendingWriteTree_,e);if(FF(n.pendingWriteTree_,e)){let i=new rt(null);return r.snap!=null?i=i.set(Ue(),!0):sn(r.children,o=>{i=i.set(new ze(o),!0)}),Hl(n,new ip(r.path,i,t))}else return[]}function bd(n,e,t){return Hl(n,new Bo(A0(),e,t))}function wj(n,e,t){const r=rt.fromObject(t);return Hl(n,new yl(A0(),e,r))}function Ij(n,e){return Hl(n,new Hu(A0(),e))}function Ej(n,e,t){const r=O0(n,t);if(r){const s=M0(r),i=s.path,o=s.queryId,a=kn(i,e),l=new Hu(C0(o),a);return V0(n,i,l)}else return[]}function hp(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||JC(o,e))){const l=mj(o,e,t,r);fj(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(p=>p._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(p,_)=>ji(_));if(h&&!f){const p=n.syncPointTree_.subtree(i);if(!p.isEmpty()){const _=Sj(p);for(let T=0;T<_.length;++T){const b=_[T],k=b.query,C=tR(n,b);n.listenProvider_.startListening(lu(k),Ku(n,k),C.hashFn,C.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(lu(e),null):u.forEach(p=>{const _=n.queryToTagMap.get(lm(p));n.listenProvider_.stopListening(lu(p),_)}))}bj(n,u)}return a}function XC(n,e,t,r){const s=O0(n,r);if(s!=null){const i=M0(s),o=i.path,a=i.queryId,l=kn(o,e),u=new Bo(C0(a),l,t);return V0(n,o,u)}else return[]}function Tj(n,e,t,r){const s=O0(n,r);if(s){const i=M0(s),o=i.path,a=i.queryId,l=kn(o,e),u=rt.fromObject(t),h=new yl(C0(a),l,u);return V0(n,o,h)}else return[]}function P_(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(p,_)=>{const T=kn(p,s);i=i||Ni(_,T),o=o||ji(_)});let a=n.syncPointTree_.get(s);a?(o=o||ji(a),i=i||Ni(a,Ue())):(a=new HC,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=pe.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((_,T)=>{const b=Ni(T,Ue());b&&(i=i.updateImmediateChild(_,b))}));const u=JC(a,e);if(!u&&!e._queryParams.loadsAllData()){const p=lm(e);H(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const _=Aj();n.queryToTagMap.set(p,_),n.tagToQueryMap.set(_,p)}const h=im(n.pendingWriteTree_,s);let f=pj(a,e,t,h,i,l);if(!u&&!o&&!r){const p=YC(a,e);f=f.concat(Cj(n,e,p))}return f}function am(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=kn(o,e),u=Ni(a,l);if(u)return u});return BC(s,e,i,t,!0)}function xj(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=kn(u,t);r=r||Ni(h,f)});let s=n.syncPointTree_.get(t);s?r=r||Ni(s,Ue()):(s=new HC,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Fi(r,!0,!1):null,a=im(n.pendingWriteTree_,e._path),l=KC(s,e,a,i?o.getNode():pe.EMPTY_NODE,i);return aj(l)}function Hl(n,e){return ZC(e,n.syncPointTree_,null,im(n.pendingWriteTree_,Ue()))}function ZC(n,e,t,r){if(xe(n.path))return eR(n,e,t,r);{const s=e.get(Ue());t==null&&s!=null&&(t=Ni(s,Ue()));let i=[];const o=Te(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=$C(r,o);i=i.concat(ZC(a,l,u,h))}return s&&(i=i.concat(k0(s,n,r,t))),i}}function eR(n,e,t,r){const s=e.get(Ue());t==null&&s!=null&&(t=Ni(s,Ue()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=$C(r,o),h=n.operationForChild(o);h&&(i=i.concat(eR(h,a,l,u)))}),s&&(i=i.concat(k0(s,n,r,t))),i}function tR(n,e){const t=e.query,r=Ku(n,t);return{hashFn:()=>(oj(e)||pe.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?Ej(n,t._path,r):Ij(n,t._path);{const i=vL(s,t);return hp(n,t,null,i)}}}}function Ku(n,e){const t=lm(e);return n.queryToTagMap.get(t)}function lm(n){return n._path.toString()+"$"+n._queryIdentifier}function O0(n,e){return n.tagToQueryMap.get(e)}function M0(n){const e=n.indexOf("$");return H(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ze(n.substr(0,e))}}function V0(n,e,t){const r=n.syncPointTree_.get(e);H(r,"Missing sync point for query tag that we're tracking");const s=im(n.pendingWriteTree_,e);return k0(r,t,s,null)}function Sj(n){return n.fold((e,t,r)=>{if(t&&ji(t))return[om(t)];{let s=[];return t&&(s=QC(t)),sn(r,(i,o)=>{s=s.concat(o)}),s}})}function lu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(yj())(n._repo,n._path):n}function bj(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=lm(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function Aj(){return _j++}function Cj(n,e,t){const r=e._path,s=Ku(n,e),i=tR(n,t),o=n.listenProvider_.startListening(lu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)H(!ji(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!xe(u)&&h&&ji(h))return[om(h).query];{let p=[];return h&&(p=p.concat(QC(h).map(_=>_.query))),sn(f,(_,T)=>{p=p.concat(T)}),p}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(lu(h),Ku(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new L0(t)}node(){return this.node_}}class F0{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=gt(this.path_,e);return new F0(this.syncTree_,t)}node(){return am(this.syncTree_,this.path_)}}const Rj=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},ux=function(n,e,t){if(!n||typeof n!="object")return n;if(H(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Nj(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Pj(n[".sv"],e);H(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Nj=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:H(!1,"Unexpected server value: "+n)}},Pj=function(n,e,t){n.hasOwnProperty("increment")||H(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&H(!1,"Unexpected increment value: "+r);const s=e.node();if(H(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},nR=function(n,e,t,r){return U0(e,new F0(t,n),r)},j0=function(n,e,t){return U0(n,new L0(e),t)};function U0(n,e,t){const r=n.getPriority().val(),s=ux(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=ux(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Qt(a,xt(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Qt(s))),o.forEachChild(it,(a,l)=>{const u=U0(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function cm(n,e){let t=e instanceof ze?e:new ze(e),r=n,s=Te(t);for(;s!==null;){const i=jo(r.node.children,s)||{children:{},childCount:0};r=new B0(s,r,i),t=Ze(t),s=Te(t)}return r}function ca(n){return n.node.value}function $0(n,e){n.node.value=e,k_(n)}function rR(n){return n.node.childCount>0}function kj(n){return ca(n)===void 0&&!rR(n)}function um(n,e){sn(n.node.children,(t,r)=>{e(new B0(t,n,r))})}function sR(n,e,t,r){t&&!r&&e(n),um(n,s=>{sR(s,e,!0,r)}),t&&r&&e(n)}function Dj(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Ad(n){return new ze(n.parent===null?n.name:Ad(n.parent)+"/"+n.name)}function k_(n){n.parent!==null&&Oj(n.parent,n.name,n)}function Oj(n,e,t){const r=kj(t),s=zr(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,k_(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,k_(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mj=/[\[\].#$\/\u0000-\u001F\u007F]/,Vj=/[\[\].#$\u0000-\u001F\u007F]/,Xg=10*1024*1024,dm=function(n){return typeof n=="string"&&n.length!==0&&!Mj.test(n)},iR=function(n){return typeof n=="string"&&n.length!==0&&!Vj.test(n)},Lj=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),iR(n)},Qu=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!tm(n)||n&&typeof n=="object"&&zr(n,".sv")},us=function(n,e,t,r){r&&e===void 0||Cd(Uo(n,"value"),e,t)},Cd=function(n,e,t){const r=t instanceof ze?new ZL(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+fo(r));if(typeof e=="function")throw new Error(n+"contains a function "+fo(r)+" with contents = "+e.toString());if(tm(e))throw new Error(n+"contains "+e.toString()+" "+fo(r));if(typeof e=="string"&&e.length>Xg/3&&em(e)>Xg)throw new Error(n+"contains a string greater than "+Xg+" utf8 bytes "+fo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(sn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!dm(o)))throw new Error(n+" contains an invalid key ("+o+") "+fo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);eF(r,o),Cd(n,a,r),tF(r)}),s&&i)throw new Error(n+' contains ".value" child '+fo(r)+" in addition to actual children.")}},Fj=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=zu(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!dm(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(XL);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&Ir(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},oR=function(n,e,t,r){if(r&&e===void 0)return;const s=Uo(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];sn(e,(o,a)=>{const l=new ze(o);if(Cd(s,a,gt(t,l)),_0(l)===".priority"&&!Qu(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),Fj(s,i)},z0=function(n,e,t){if(!(t&&e===void 0)){if(tm(e))throw new Error(Uo(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Qu(e))throw new Error(Uo(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Rd=function(n,e,t,r){if(!(r&&t===void 0)&&!dm(t))throw new Error(Uo(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},q0=function(n,e,t,r){if(!(r&&t===void 0)&&!iR(t))throw new Error(Uo(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},jj=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),q0(n,e,t,r)},Xr=function(n,e){if(Te(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},aR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!dm(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Lj(t))throw new Error(Uo(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function hm(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!v0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function lR(n,e,t){hm(n,t),cR(n,r=>v0(r,e))}function dr(n,e,t){hm(n,t),cR(n,r=>Ir(r,e)||Ir(e,r))}function cR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(Bj(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Bj(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Ro&&en("event: "+t.toString()),Wl(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uR="repo_interrupt",$j=25;class zj{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Uj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=sp(),this.transactionQueueTree_=new B0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function qj(n,e,t){if(n.stats_=g0(n.repoInfo_),n.forceRestClient_||TL())n.server_=new rp(n.repoInfo_,(r,s,i,o)=>{dx(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>hx(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Wt(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Tr(n.repoInfo_,e,(r,s,i,o)=>{dx(n,r,s,i,o)},r=>{hx(n,r)},r=>{Wj(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=CL(n.repoInfo_,()=>new RF(n.stats_,n.server_)),n.infoData_=new xF,n.infoSyncTree_=new cx({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=bd(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),W0(n,"connected",!1),n.serverSyncTree_=new cx({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);dr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function dR(n){const t=n.infoData_.getNode(new ze(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Nd(n){return Rj({timestamp:dR(n)})}function dx(n,e,t,r,s){n.dataUpdateCount++;const i=new ze(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=Xf(t,u=>xt(u));o=Tj(n.serverSyncTree_,i,l,s)}else{const l=xt(t);o=XC(n.serverSyncTree_,i,l,s)}else if(r){const l=Xf(t,u=>xt(u));o=wj(n.serverSyncTree_,i,l)}else{const l=xt(t);o=bd(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=vl(n,i)),dr(n.eventQueue_,a,o)}function hx(n,e){W0(n,"connected",e),e===!1&&Kj(n)}function Wj(n,e){sn(e,(t,r)=>{W0(n,t,r)})}function W0(n,e,t){const r=new ze("/.info/"+e),s=xt(t);n.infoData_.updateSnapshot(r,s);const i=bd(n.infoSyncTree_,r,s);dr(n.eventQueue_,r,i)}function fm(n){return n.nextWriteId_++}function Gj(n,e,t){const r=xj(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=xt(s).withIndex(e._queryParams.getIndex());P_(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=bd(n.serverSyncTree_,e._path,i);else{const a=Ku(n.serverSyncTree_,e);o=XC(n.serverSyncTree_,e._path,i,a)}return dr(n.eventQueue_,e._path,o),hp(n.serverSyncTree_,e,t,null,!0),i},s=>(Kl(n,"get for query "+Wt(e)+" failed: "+s),Promise.reject(new Error(s))))}function G0(n,e,t,r,s){Kl(n,"set",{path:e.toString(),value:t,priority:r});const i=Nd(n),o=xt(t,r),a=am(n.serverSyncTree_,e),l=j0(o,a,i),u=fm(n),h=D0(n.serverSyncTree_,e,l,u,!0);hm(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(p,_)=>{const T=p==="ok";T||En("set at "+e+" failed: "+p);const b=pi(n.serverSyncTree_,u,!T);dr(n.eventQueue_,e,b),Ui(n,s,p,_)});const f=K0(n,e);vl(n,f),dr(n.eventQueue_,f,[])}function Hj(n,e,t,r){Kl(n,"update",{path:e.toString(),value:t});let s=!0;const i=Nd(n),o={};if(sn(t,(a,l)=>{s=!1,o[a]=nR(gt(e,a),xt(l),n.serverSyncTree_,i)}),s)en("update() called with empty data.  Don't do anything."),Ui(n,r,"ok",void 0);else{const a=fm(n),l=vj(n.serverSyncTree_,e,o,a);hm(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||En("update at "+e+" failed: "+u);const p=pi(n.serverSyncTree_,a,!f),_=p.length>0?vl(n,e):e;dr(n.eventQueue_,_,p),Ui(n,r,u,h)}),sn(t,u=>{const h=K0(n,gt(e,u));vl(n,h)}),dr(n.eventQueue_,e,[])}}function Kj(n){Kl(n,"onDisconnectEvents");const e=Nd(n),t=sp();S_(n.onDisconnect_,Ue(),(s,i)=>{const o=nR(s,i,n.serverSyncTree_,e);Gl(t,s,o)});let r=[];S_(t,Ue(),(s,i)=>{r=r.concat(bd(n.serverSyncTree_,s,i));const o=K0(n,s);vl(n,o)}),n.onDisconnect_=sp(),dr(n.eventQueue_,Ue(),r)}function Qj(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&x_(n.onDisconnect_,e),Ui(n,t,r,s)})}function fx(n,e,t,r){const s=xt(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Gl(n.onDisconnect_,e,s),Ui(n,r,i,o)})}function Yj(n,e,t,r,s){const i=xt(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Gl(n.onDisconnect_,e,i),Ui(n,s,o,a)})}function Jj(n,e,t,r){if(Jf(t)){en("onDisconnect().update() called with empty data.  Don't do anything."),Ui(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&sn(t,(o,a)=>{const l=xt(a);Gl(n.onDisconnect_,gt(e,o),l)}),Ui(n,r,s,i)})}function Xj(n,e,t){let r;Te(e._path)===".info"?r=P_(n.infoSyncTree_,e,t):r=P_(n.serverSyncTree_,e,t),lR(n.eventQueue_,e._path,r)}function D_(n,e,t){let r;Te(e._path)===".info"?r=hp(n.infoSyncTree_,e,t):r=hp(n.serverSyncTree_,e,t),lR(n.eventQueue_,e._path,r)}function hR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(uR)}function Zj(n){n.persistentConnection_&&n.persistentConnection_.resume(uR)}function Kl(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),en(t,...e)}function Ui(n,e,t,r){e&&Wl(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function e4(n,e,t,r,s,i){Kl(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:aC(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=H0(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Cd("transaction failed: Data returned ",l,o.path),o.status=0;const u=cm(n.transactionQueueTree_,e),h=ca(u)||[];h.push(o),$0(u,h);let f;typeof l=="object"&&l!==null&&zr(l,".priority")?(f=jo(l,".priority"),H(Qu(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(am(n.serverSyncTree_,e)||pe.EMPTY_NODE).getPriority().val();const p=Nd(n),_=xt(l,f),T=j0(_,a,p);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=T,o.currentWriteId=fm(n);const b=D0(n.serverSyncTree_,e,T,o.currentWriteId,o.applyLocally);dr(n.eventQueue_,e,b),pm(n,n.transactionQueueTree_)}}function H0(n,e,t){return am(n.serverSyncTree_,e,t)||pe.EMPTY_NODE}function pm(n,e=n.transactionQueueTree_){if(e||mm(n,e),ca(e)){const t=pR(n,e);H(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&t4(n,Ad(e),t)}else rR(e)&&um(e,t=>{pm(n,t)})}function t4(n,e,t){const r=t.map(u=>u.currentWriteId),s=H0(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];H(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=kn(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Kl(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(pi(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&f.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();mm(n,cm(n.transactionQueueTree_,e)),pm(n,n.transactionQueueTree_),dr(n.eventQueue_,e,h);for(let p=0;p<f.length;p++)Wl(f[p])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{En("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}vl(n,e)}},o)}function vl(n,e){const t=fR(n,e),r=Ad(t),s=pR(n,t);return n4(n,s,r),r}function n4(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=kn(t,l.path);let h=!1,f;if(H(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(pi(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=$j)h=!0,f="maxretry",s=s.concat(pi(n.serverSyncTree_,l.currentWriteId,!0));else{const p=H0(n,l.path,o);l.currentInputSnapshot=p;const _=e[a].update(p.val());if(_!==void 0){Cd("transaction failed: Data returned ",_,l.path);let T=xt(_);typeof _=="object"&&_!=null&&zr(_,".priority")||(T=T.updatePriority(p.getPriority()));const k=l.currentWriteId,C=Nd(n),x=j0(T,p,C);l.currentOutputSnapshotRaw=T,l.currentOutputSnapshotResolved=x,l.currentWriteId=fm(n),o.splice(o.indexOf(k),1),s=s.concat(D0(n.serverSyncTree_,l.path,x,l.currentWriteId,l.applyLocally)),s=s.concat(pi(n.serverSyncTree_,k,!0))}else h=!0,f="nodata",s=s.concat(pi(n.serverSyncTree_,l.currentWriteId,!0))}dr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}mm(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Wl(r[a]);pm(n,n.transactionQueueTree_)}function fR(n,e){let t,r=n.transactionQueueTree_;for(t=Te(e);t!==null&&ca(r)===void 0;)r=cm(r,t),e=Ze(e),t=Te(e);return r}function pR(n,e){const t=[];return mR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function mR(n,e,t){const r=ca(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);um(e,s=>{mR(n,s,t)})}function mm(n,e){const t=ca(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,$0(e,t.length>0?t:void 0)}um(e,r=>{mm(n,r)})}function K0(n,e){const t=Ad(fR(n,e)),r=cm(n.transactionQueueTree_,e);return Dj(r,s=>{Zg(n,s)}),Zg(n,r),sR(r,s=>{Zg(n,s)}),t}function Zg(n,e){const t=ca(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(H(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(H(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(pi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?$0(e,void 0):t.length=i+1,dr(n.eventQueue_,Ad(e),s);for(let o=0;o<r.length;o++)Wl(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r4(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function s4(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):En(`Invalid query segment '${t}' in query '${n}'`)}return e}const O_=function(n,e){const t=i4(n),r=t.namespace;t.domain==="firebase.com"&&cs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&cs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||pL();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new IC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new ze(t.pathString)}},i4=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=r4(n.substring(h,f)));const p=s4(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{const T=e.indexOf(".");r=e.substring(0,T).toLowerCase(),t=e.substring(T+1),i=r}"ns"in p&&(i=p.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const px="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",o4=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=px.charAt(t%64),t=Math.floor(t/64);H(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=px.charAt(e[s]);return H(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Wt(this.snapshot.exportVal())}}class yR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q0{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return H(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new nr;return Qj(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Xr("OnDisconnect.remove",this._path);const e=new nr;return fx(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Xr("OnDisconnect.set",this._path),us("OnDisconnect.set",e,this._path,!1);const t=new nr;return fx(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Xr("OnDisconnect.setWithPriority",this._path),us("OnDisconnect.setWithPriority",e,this._path,!1),z0("OnDisconnect.setWithPriority",t,!1);const r=new nr;return Yj(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Xr("OnDisconnect.update",this._path),oR("OnDisconnect.update",e,this._path,!1);const t=new nr;return Jj(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return xe(this._path)?null:_0(this._path)}get ref(){return new qr(this._repo,this._path)}get _queryIdentifier(){const e=ZT(this._queryParams),t=p0(e);return t==="{}"?"default":t}get _queryObject(){return ZT(this._queryParams)}isEqual(e){if(e=Z(e),!(e instanceof mr))return!1;const t=this._repo===e._repo,r=v0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+JL(this._path)}}function gm(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ji(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ss){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Vi)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Os)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===it){if(e!=null&&!Qu(e)||t!=null&&!Qu(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(H(n.getIndex()instanceof E0||n.getIndex()===T0,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ym(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class qr extends mr{constructor(e,t){super(e,t,new S0,!1)}get parent(){const e=NC(this._path);return e===null?null:new qr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class zo{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ze(e),r=wl(this.ref,e);return new zo(this._node.getChild(t),r,it)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new zo(s,wl(this.ref,r),it)))}hasChild(e){const t=new ze(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function we(n,e){return n=Z(n),n._checkNotDeleted("ref"),e!==void 0?wl(n._root,e):n._root}function _q(n,e){n=Z(n),n._checkNotDeleted("refFromURL");const t=O_(e,n._repo.repoInfo_.nodeAdmin);aR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&cs("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),we(n,t.path.toString())}function wl(n,e){return n=Z(n),Te(n._path)===null?jj("child","path",e,!1):q0("child","path",e,!1),new qr(n._repo,gt(n._path,e))}function vq(n){return n=Z(n),new a4(n._repo,n._path)}function _R(n,e){n=Z(n),Xr("push",n._path),us("push",e,n._path,!0);const t=dR(n._repo),r=o4(t),s=wl(n,r),i=wl(n,r);let o;return e!=null?o=Yt(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function l4(n){return Xr("remove",n._path),Yt(n,null)}function Yt(n,e){n=Z(n),Xr("set",n._path),us("set",e,n._path,!1);const t=new nr;return G0(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function wq(n,e){n=Z(n),Xr("setPriority",n._path),z0("setPriority",e,!1);const t=new nr;return G0(n._repo,gt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Iq(n,e,t){if(Xr("setWithPriority",n._path),us("setWithPriority",e,n._path,!1),z0("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new nr;return G0(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function Eq(n,e){oR("update",e,n._path,!1);const t=new nr;return Hj(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Nt(n){n=Z(n);const e=new Q0(()=>{}),t=new Pd(e);return Gj(n._repo,n,t).then(r=>new zo(r,new qr(n._repo,n._path),n._queryParams.getIndex()))}class Pd{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new gR("value",this,new zo(e.snapshotNode,new qr(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new yR(this,e,t):null}matches(e){return e instanceof Pd?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class _m{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new yR(this,e,t):null}createEvent(e,t){H(e.childName!=null,"Child events should have a childName.");const r=wl(new qr(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new gR(e.type,this,new zo(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof _m?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function kd(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{D_(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new Q0(t,i||void 0),a=e==="value"?new Pd(o):new _m(e,o);return Xj(n._repo,n,a),()=>D_(n._repo,n,a)}function M_(n,e,t,r){return kd(n,"value",e,t,r)}function Tq(n,e,t,r){return kd(n,"child_added",e,t,r)}function xq(n,e,t,r){return kd(n,"child_changed",e,t,r)}function Sq(n,e,t,r){return kd(n,"child_moved",e,t,r)}function bq(n,e,t,r){return kd(n,"child_removed",e,t,r)}function Aq(n,e,t){let r=null;const s=t?new Q0(t):null;e==="value"?r=new Pd(s):e&&(r=new _m(e,s)),D_(n._repo,n,r)}let Wr=class{},vR=class extends Wr{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){us("endAt",this._value,e._path,!0);const t=T_(e._queryParams,this._value,this._key);if(ym(t),Ji(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new mr(e._repo,e._path,t,e._orderByCalled)}};function Nq(n,e){return Rd("endAt","key",e,!0),new vR(n,e)}class c4 extends Wr{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){us("endBefore",this._value,e._path,!1);const t=TF(e._queryParams,this._value,this._key);if(ym(t),Ji(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new mr(e._repo,e._path,t,e._orderByCalled)}}function Pq(n,e){return Rd("endBefore","key",e,!0),new c4(n,e)}let wR=class extends Wr{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){us("startAt",this._value,e._path,!0);const t=E_(e._queryParams,this._value,this._key);if(ym(t),Ji(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new mr(e._repo,e._path,t,e._orderByCalled)}};function Dq(n=null,e){return Rd("startAt","key",e,!0),new wR(n,e)}class u4 extends Wr{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){us("startAfter",this._value,e._path,!1);const t=EF(e._queryParams,this._value,this._key);if(ym(t),Ji(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new mr(e._repo,e._path,t,e._orderByCalled)}}function Oq(n,e){return Rd("startAfter","key",e,!0),new u4(n,e)}class d4 extends Wr{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new mr(e._repo,e._path,wF(e._queryParams,this._limit),e._orderByCalled)}}function Mq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new d4(n)}class h4 extends Wr{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new mr(e._repo,e._path,IF(e._queryParams,this._limit),e._orderByCalled)}}function Vq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new h4(n)}class f4 extends Wr{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){gm(e,"orderByChild");const t=new ze(this._path);if(xe(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new E0(t),s=rm(e._queryParams,r);return Ji(s),new mr(e._repo,e._path,s,!0)}}function Lq(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return q0("orderByChild","path",n,!1),new f4(n)}class p4 extends Wr{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){gm(e,"orderByKey");const t=rm(e._queryParams,ss);return Ji(t),new mr(e._repo,e._path,t,!0)}}function Fq(){return new p4}class m4 extends Wr{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){gm(e,"orderByPriority");const t=rm(e._queryParams,it);return Ji(t),new mr(e._repo,e._path,t,!0)}}function jq(){return new m4}class g4 extends Wr{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){gm(e,"orderByValue");const t=rm(e._queryParams,T0);return Ji(t),new mr(e._repo,e._path,t,!0)}}function Uq(){return new g4}class y4 extends Wr{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(us("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new vR(this._value,this._key)._apply(new wR(this._value,this._key)._apply(e))}}function Bq(n,e){return Rd("equalTo","key",e,!0),new y4(n,e)}function $q(n,...e){let t=Z(n);for(const r of e)t=r._apply(t);return t}dj(qr);gj(qr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4="FIREBASE_DATABASE_EMULATOR_HOST",V_={};let IR=!1;function v4(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Bs(i);n.repoInfo_=new IC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function ER(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||cs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),en("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=O_(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[_4]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=O_(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new tl(tl.OWNER):new SL(n.name,n.options,e);aR("Invalid Firebase Database URL",o),xe(o.path)||cs("Database URL must point to the root of a Firebase Database (not including a child path).");const f=I4(a,n,h,new xL(n,t));return new T4(f,n)}function w4(n,e){const t=V_[e];(!t||t[n.key]!==n)&&cs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),hR(n),delete t[n.key]}function I4(n,e,t,r){let s=V_[e.name];s||(s={},V_[e.name]=s);let i=s[n.toURLString()];return i&&cs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new zj(n,IR,t,r),s[n.toURLString()]=i,i}function E4(n){IR=n}class T4{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(qj(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new qr(this._repo,Ue())),this._rootInternal}_delete(){return this._rootInternal!==null&&(w4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&cs("Cannot call "+e+" on a deleted database.")}}function TR(){ml.IS_TRANSPORT_INITIALIZED&&En("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function zq(){TR(),fi.forceDisallow()}function qq(){TR(),vr.forceDisallow(),fi.forceAllow()}function x4(n=Ed(),e){const t=hs(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=UA("database");r&&S4(t,...r)}return t}function S4(n,e,t,r={}){n=Z(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&ur(r,i.repoInfo_.emulatorOptions))return;cs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&cs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new tl(tl.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:zA(r.mockUserToken,n.app.options.projectId);o=new tl(a)}Bs(e)&&(Xp(e),c0("Database",!0)),v4(i,s,r,o)}function Wq(n){n=Z(n),n._checkNotDeleted("goOffline"),hR(n._repo)}function Gq(n){n=Z(n),n._checkNotDeleted("goOnline"),Zj(n._repo)}function Hq(n,e){cC(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b4(n){iC(oa),Br(new Qn("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return ER(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Hn(VT,LT,n),Hn(VT,LT,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4={".sv":"timestamp"};function Kq(){return A4}function Qq(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Yq(n,e,t){if(n=Z(n),Xr("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new nr,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new zo(u,new qr(n._repo,n._path),it),s.resolve(new C4(l,h)))},o=M_(n,()=>{});return e4(n._repo,n._path,e,i,o,r),s.promise}Tr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Tr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const Jq=function(n){const e=Tr.prototype.put;return Tr.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){Tr.prototype.put=e}},Xq=function(n){E4(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zq({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){iC(t);const o=new JA("database-standalone"),a=new f_("auth-internal",o);let l;return s&&(l=new f_("app-check-internal",o),l.setComponent(new Qn("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Qn("auth-internal",()=>r,"PRIVATE")),ER(n,a,l,e,i)}b4();var mx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pi,xR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,w){function E(){}E.prototype=w.prototype,A.D=w.prototype,A.prototype=new E,A.prototype.constructor=A,A.C=function(y,v,N){for(var S=Array(arguments.length-2),X=2;X<arguments.length;X++)S[X-2]=arguments[X];return w.prototype[v].apply(y,S)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,w,E){E||(E=0);var y=Array(16);if(typeof w=="string")for(var v=0;16>v;++v)y[v]=w.charCodeAt(E++)|w.charCodeAt(E++)<<8|w.charCodeAt(E++)<<16|w.charCodeAt(E++)<<24;else for(v=0;16>v;++v)y[v]=w[E++]|w[E++]<<8|w[E++]<<16|w[E++]<<24;w=A.g[0],E=A.g[1],v=A.g[2];var N=A.g[3],S=w+(N^E&(v^N))+y[0]+3614090360&4294967295;w=E+(S<<7&4294967295|S>>>25),S=N+(v^w&(E^v))+y[1]+3905402710&4294967295,N=w+(S<<12&4294967295|S>>>20),S=v+(E^N&(w^E))+y[2]+606105819&4294967295,v=N+(S<<17&4294967295|S>>>15),S=E+(w^v&(N^w))+y[3]+3250441966&4294967295,E=v+(S<<22&4294967295|S>>>10),S=w+(N^E&(v^N))+y[4]+4118548399&4294967295,w=E+(S<<7&4294967295|S>>>25),S=N+(v^w&(E^v))+y[5]+1200080426&4294967295,N=w+(S<<12&4294967295|S>>>20),S=v+(E^N&(w^E))+y[6]+2821735955&4294967295,v=N+(S<<17&4294967295|S>>>15),S=E+(w^v&(N^w))+y[7]+4249261313&4294967295,E=v+(S<<22&4294967295|S>>>10),S=w+(N^E&(v^N))+y[8]+1770035416&4294967295,w=E+(S<<7&4294967295|S>>>25),S=N+(v^w&(E^v))+y[9]+2336552879&4294967295,N=w+(S<<12&4294967295|S>>>20),S=v+(E^N&(w^E))+y[10]+4294925233&4294967295,v=N+(S<<17&4294967295|S>>>15),S=E+(w^v&(N^w))+y[11]+2304563134&4294967295,E=v+(S<<22&4294967295|S>>>10),S=w+(N^E&(v^N))+y[12]+1804603682&4294967295,w=E+(S<<7&4294967295|S>>>25),S=N+(v^w&(E^v))+y[13]+4254626195&4294967295,N=w+(S<<12&4294967295|S>>>20),S=v+(E^N&(w^E))+y[14]+2792965006&4294967295,v=N+(S<<17&4294967295|S>>>15),S=E+(w^v&(N^w))+y[15]+1236535329&4294967295,E=v+(S<<22&4294967295|S>>>10),S=w+(v^N&(E^v))+y[1]+4129170786&4294967295,w=E+(S<<5&4294967295|S>>>27),S=N+(E^v&(w^E))+y[6]+3225465664&4294967295,N=w+(S<<9&4294967295|S>>>23),S=v+(w^E&(N^w))+y[11]+643717713&4294967295,v=N+(S<<14&4294967295|S>>>18),S=E+(N^w&(v^N))+y[0]+3921069994&4294967295,E=v+(S<<20&4294967295|S>>>12),S=w+(v^N&(E^v))+y[5]+3593408605&4294967295,w=E+(S<<5&4294967295|S>>>27),S=N+(E^v&(w^E))+y[10]+38016083&4294967295,N=w+(S<<9&4294967295|S>>>23),S=v+(w^E&(N^w))+y[15]+3634488961&4294967295,v=N+(S<<14&4294967295|S>>>18),S=E+(N^w&(v^N))+y[4]+3889429448&4294967295,E=v+(S<<20&4294967295|S>>>12),S=w+(v^N&(E^v))+y[9]+568446438&4294967295,w=E+(S<<5&4294967295|S>>>27),S=N+(E^v&(w^E))+y[14]+3275163606&4294967295,N=w+(S<<9&4294967295|S>>>23),S=v+(w^E&(N^w))+y[3]+4107603335&4294967295,v=N+(S<<14&4294967295|S>>>18),S=E+(N^w&(v^N))+y[8]+1163531501&4294967295,E=v+(S<<20&4294967295|S>>>12),S=w+(v^N&(E^v))+y[13]+2850285829&4294967295,w=E+(S<<5&4294967295|S>>>27),S=N+(E^v&(w^E))+y[2]+4243563512&4294967295,N=w+(S<<9&4294967295|S>>>23),S=v+(w^E&(N^w))+y[7]+1735328473&4294967295,v=N+(S<<14&4294967295|S>>>18),S=E+(N^w&(v^N))+y[12]+2368359562&4294967295,E=v+(S<<20&4294967295|S>>>12),S=w+(E^v^N)+y[5]+4294588738&4294967295,w=E+(S<<4&4294967295|S>>>28),S=N+(w^E^v)+y[8]+2272392833&4294967295,N=w+(S<<11&4294967295|S>>>21),S=v+(N^w^E)+y[11]+1839030562&4294967295,v=N+(S<<16&4294967295|S>>>16),S=E+(v^N^w)+y[14]+4259657740&4294967295,E=v+(S<<23&4294967295|S>>>9),S=w+(E^v^N)+y[1]+2763975236&4294967295,w=E+(S<<4&4294967295|S>>>28),S=N+(w^E^v)+y[4]+1272893353&4294967295,N=w+(S<<11&4294967295|S>>>21),S=v+(N^w^E)+y[7]+4139469664&4294967295,v=N+(S<<16&4294967295|S>>>16),S=E+(v^N^w)+y[10]+3200236656&4294967295,E=v+(S<<23&4294967295|S>>>9),S=w+(E^v^N)+y[13]+681279174&4294967295,w=E+(S<<4&4294967295|S>>>28),S=N+(w^E^v)+y[0]+3936430074&4294967295,N=w+(S<<11&4294967295|S>>>21),S=v+(N^w^E)+y[3]+3572445317&4294967295,v=N+(S<<16&4294967295|S>>>16),S=E+(v^N^w)+y[6]+76029189&4294967295,E=v+(S<<23&4294967295|S>>>9),S=w+(E^v^N)+y[9]+3654602809&4294967295,w=E+(S<<4&4294967295|S>>>28),S=N+(w^E^v)+y[12]+3873151461&4294967295,N=w+(S<<11&4294967295|S>>>21),S=v+(N^w^E)+y[15]+530742520&4294967295,v=N+(S<<16&4294967295|S>>>16),S=E+(v^N^w)+y[2]+3299628645&4294967295,E=v+(S<<23&4294967295|S>>>9),S=w+(v^(E|~N))+y[0]+4096336452&4294967295,w=E+(S<<6&4294967295|S>>>26),S=N+(E^(w|~v))+y[7]+1126891415&4294967295,N=w+(S<<10&4294967295|S>>>22),S=v+(w^(N|~E))+y[14]+2878612391&4294967295,v=N+(S<<15&4294967295|S>>>17),S=E+(N^(v|~w))+y[5]+4237533241&4294967295,E=v+(S<<21&4294967295|S>>>11),S=w+(v^(E|~N))+y[12]+1700485571&4294967295,w=E+(S<<6&4294967295|S>>>26),S=N+(E^(w|~v))+y[3]+2399980690&4294967295,N=w+(S<<10&4294967295|S>>>22),S=v+(w^(N|~E))+y[10]+4293915773&4294967295,v=N+(S<<15&4294967295|S>>>17),S=E+(N^(v|~w))+y[1]+2240044497&4294967295,E=v+(S<<21&4294967295|S>>>11),S=w+(v^(E|~N))+y[8]+1873313359&4294967295,w=E+(S<<6&4294967295|S>>>26),S=N+(E^(w|~v))+y[15]+4264355552&4294967295,N=w+(S<<10&4294967295|S>>>22),S=v+(w^(N|~E))+y[6]+2734768916&4294967295,v=N+(S<<15&4294967295|S>>>17),S=E+(N^(v|~w))+y[13]+1309151649&4294967295,E=v+(S<<21&4294967295|S>>>11),S=w+(v^(E|~N))+y[4]+4149444226&4294967295,w=E+(S<<6&4294967295|S>>>26),S=N+(E^(w|~v))+y[11]+3174756917&4294967295,N=w+(S<<10&4294967295|S>>>22),S=v+(w^(N|~E))+y[2]+718787259&4294967295,v=N+(S<<15&4294967295|S>>>17),S=E+(N^(v|~w))+y[9]+3951481745&4294967295,A.g[0]=A.g[0]+w&4294967295,A.g[1]=A.g[1]+(v+(S<<21&4294967295|S>>>11))&4294967295,A.g[2]=A.g[2]+v&4294967295,A.g[3]=A.g[3]+N&4294967295}r.prototype.u=function(A,w){w===void 0&&(w=A.length);for(var E=w-this.blockSize,y=this.B,v=this.h,N=0;N<w;){if(v==0)for(;N<=E;)s(this,A,N),N+=this.blockSize;if(typeof A=="string"){for(;N<w;)if(y[v++]=A.charCodeAt(N++),v==this.blockSize){s(this,y),v=0;break}}else for(;N<w;)if(y[v++]=A[N++],v==this.blockSize){s(this,y),v=0;break}}this.h=v,this.o+=w},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var w=1;w<A.length-8;++w)A[w]=0;var E=8*this.o;for(w=A.length-8;w<A.length;++w)A[w]=E&255,E/=256;for(this.u(A),A=Array(16),w=E=0;4>w;++w)for(var y=0;32>y;y+=8)A[E++]=this.g[w]>>>y&255;return A};function i(A,w){var E=a;return Object.prototype.hasOwnProperty.call(E,A)?E[A]:E[A]=w(A)}function o(A,w){this.h=w;for(var E=[],y=!0,v=A.length-1;0<=v;v--){var N=A[v]|0;y&&N==w||(E[v]=N,y=!1)}this.g=E}var a={};function l(A){return-128<=A&&128>A?i(A,function(w){return new o([w|0],0>w?-1:0)}):new o([A|0],0>A?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return k(u(-A));for(var w=[],E=1,y=0;A>=E;y++)w[y]=A/E|0,E*=4294967296;return new o(w,0)}function h(A,w){if(A.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(A.charAt(0)=="-")return k(h(A.substring(1),w));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=u(Math.pow(w,8)),y=f,v=0;v<A.length;v+=8){var N=Math.min(8,A.length-v),S=parseInt(A.substring(v,v+N),w);8>N?(N=u(Math.pow(w,N)),y=y.j(N).add(u(S))):(y=y.j(E),y=y.add(u(S)))}return y}var f=l(0),p=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(b(this))return-k(this).m();for(var A=0,w=1,E=0;E<this.g.length;E++){var y=this.i(E);A+=(0<=y?y:4294967296+y)*w,w*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(T(this))return"0";if(b(this))return"-"+k(this).toString(A);for(var w=u(Math.pow(A,6)),E=this,y="";;){var v=P(E,w).g;E=C(E,v.j(w));var N=((0<E.g.length?E.g[0]:E.h)>>>0).toString(A);if(E=v,T(E))return N+y;for(;6>N.length;)N="0"+N;y=N+y}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function T(A){if(A.h!=0)return!1;for(var w=0;w<A.g.length;w++)if(A.g[w]!=0)return!1;return!0}function b(A){return A.h==-1}n.l=function(A){return A=C(this,A),b(A)?-1:T(A)?0:1};function k(A){for(var w=A.g.length,E=[],y=0;y<w;y++)E[y]=~A.g[y];return new o(E,~A.h).add(p)}n.abs=function(){return b(this)?k(this):this},n.add=function(A){for(var w=Math.max(this.g.length,A.g.length),E=[],y=0,v=0;v<=w;v++){var N=y+(this.i(v)&65535)+(A.i(v)&65535),S=(N>>>16)+(this.i(v)>>>16)+(A.i(v)>>>16);y=S>>>16,N&=65535,S&=65535,E[v]=S<<16|N}return new o(E,E[E.length-1]&-2147483648?-1:0)};function C(A,w){return A.add(k(w))}n.j=function(A){if(T(this)||T(A))return f;if(b(this))return b(A)?k(this).j(k(A)):k(k(this).j(A));if(b(A))return k(this.j(k(A)));if(0>this.l(_)&&0>A.l(_))return u(this.m()*A.m());for(var w=this.g.length+A.g.length,E=[],y=0;y<2*w;y++)E[y]=0;for(y=0;y<this.g.length;y++)for(var v=0;v<A.g.length;v++){var N=this.i(y)>>>16,S=this.i(y)&65535,X=A.i(v)>>>16,ge=A.i(v)&65535;E[2*y+2*v]+=S*ge,x(E,2*y+2*v),E[2*y+2*v+1]+=N*ge,x(E,2*y+2*v+1),E[2*y+2*v+1]+=S*X,x(E,2*y+2*v+1),E[2*y+2*v+2]+=N*X,x(E,2*y+2*v+2)}for(y=0;y<w;y++)E[y]=E[2*y+1]<<16|E[2*y];for(y=w;y<2*w;y++)E[y]=0;return new o(E,0)};function x(A,w){for(;(A[w]&65535)!=A[w];)A[w+1]+=A[w]>>>16,A[w]&=65535,w++}function R(A,w){this.g=A,this.h=w}function P(A,w){if(T(w))throw Error("division by zero");if(T(A))return new R(f,f);if(b(A))return w=P(k(A),w),new R(k(w.g),k(w.h));if(b(w))return w=P(A,k(w)),new R(k(w.g),w.h);if(30<A.g.length){if(b(A)||b(w))throw Error("slowDivide_ only works with positive integers.");for(var E=p,y=w;0>=y.l(A);)E=U(E),y=U(y);var v=F(E,1),N=F(y,1);for(y=F(y,2),E=F(E,2);!T(y);){var S=N.add(y);0>=S.l(A)&&(v=v.add(E),N=S),y=F(y,1),E=F(E,1)}return w=C(A,v.j(w)),new R(v,w)}for(v=f;0<=A.l(w);){for(E=Math.max(1,Math.floor(A.m()/w.m())),y=Math.ceil(Math.log(E)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),N=u(E),S=N.j(w);b(S)||0<S.l(A);)E-=y,N=u(E),S=N.j(w);T(N)&&(N=p),v=v.add(N),A=C(A,S)}return new R(v,A)}n.A=function(A){return P(this,A).h},n.and=function(A){for(var w=Math.max(this.g.length,A.g.length),E=[],y=0;y<w;y++)E[y]=this.i(y)&A.i(y);return new o(E,this.h&A.h)},n.or=function(A){for(var w=Math.max(this.g.length,A.g.length),E=[],y=0;y<w;y++)E[y]=this.i(y)|A.i(y);return new o(E,this.h|A.h)},n.xor=function(A){for(var w=Math.max(this.g.length,A.g.length),E=[],y=0;y<w;y++)E[y]=this.i(y)^A.i(y);return new o(E,this.h^A.h)};function U(A){for(var w=A.g.length+1,E=[],y=0;y<w;y++)E[y]=A.i(y)<<1|A.i(y-1)>>>31;return new o(E,A.h)}function F(A,w){var E=w>>5;w%=32;for(var y=A.g.length-E,v=[],N=0;N<y;N++)v[N]=0<w?A.i(N+E)>>>w|A.i(N+E+1)<<32-w:A.i(N+E);return new o(v,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,xR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Pi=o}).apply(typeof mx<"u"?mx:typeof self<"u"?self:typeof window<"u"?window:{});var Oh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var SR,zc,bR,lf,L_,AR,CR,RR;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,m,g){return c==Array.prototype||c==Object.prototype||(c[m]=g.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Oh=="object"&&Oh];for(var m=0;m<c.length;++m){var g=c[m];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(c,m){if(m)e:{var g=r;c=c.split(".");for(var I=0;I<c.length-1;I++){var O=c[I];if(!(O in g))break e;g=g[O]}c=c[c.length-1],I=g[c],m=m(I),m!=I&&m!=null&&e(g,c,{configurable:!0,writable:!0,value:m})}}function i(c,m){c instanceof String&&(c+="");var g=0,I=!1,O={next:function(){if(!I&&g<c.length){var L=g++;return{value:m(L,c[L]),done:!1}}return I=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(c){return c||function(){return i(this,function(m,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var m=typeof c;return m=m!="object"?m:c?Array.isArray(c)?"array":m:"null",m=="array"||m=="object"&&typeof c.length=="number"}function u(c){var m=typeof c;return m=="object"&&c!=null||m=="function"}function h(c,m,g){return c.call.apply(c.bind,arguments)}function f(c,m,g){if(!c)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,I),c.apply(m,O)}}return function(){return c.apply(m,arguments)}}function p(c,m,g){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function _(c,m){var g=Array.prototype.slice.call(arguments,1);return function(){var I=g.slice();return I.push.apply(I,arguments),c.apply(this,I)}}function T(c,m){function g(){}g.prototype=m.prototype,c.aa=m.prototype,c.prototype=new g,c.prototype.constructor=c,c.Qb=function(I,O,L){for(var J=Array(arguments.length-2),Xe=2;Xe<arguments.length;Xe++)J[Xe-2]=arguments[Xe];return m.prototype[O].apply(I,J)}}function b(c){const m=c.length;if(0<m){const g=Array(m);for(let I=0;I<m;I++)g[I]=c[I];return g}return[]}function k(c,m){for(let g=1;g<arguments.length;g++){const I=arguments[g];if(l(I)){const O=c.length||0,L=I.length||0;c.length=O+L;for(let J=0;J<L;J++)c[O+J]=I[J]}else c.push(I)}}class C{constructor(m,g){this.i=m,this.j=g,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function x(c){return/^[\s\xa0]*$/.test(c)}function R(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function P(c){return P[" "](c),c}P[" "]=function(){};var U=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function F(c,m,g){for(const I in c)m.call(g,c[I],I,c)}function A(c,m){for(const g in c)m.call(void 0,c[g],g,c)}function w(c){const m={};for(const g in c)m[g]=c[g];return m}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y(c,m){let g,I;for(let O=1;O<arguments.length;O++){I=arguments[O];for(g in I)c[g]=I[g];for(let L=0;L<E.length;L++)g=E[L],Object.prototype.hasOwnProperty.call(I,g)&&(c[g]=I[g])}}function v(c){var m=1;c=c.split(":");const g=[];for(;0<m&&c.length;)g.push(c.shift()),m--;return c.length&&g.push(c.join(":")),g}function N(c){a.setTimeout(()=>{throw c},0)}function S(){var c=le;let m=null;return c.g&&(m=c.g,c.g=c.g.next,c.g||(c.h=null),m.next=null),m}class X{constructor(){this.h=this.g=null}add(m,g){const I=ge.get();I.set(m,g),this.h?this.h.next=I:this.g=I,this.h=I}}var ge=new C(()=>new he,c=>c.reset());class he{constructor(){this.next=this.g=this.h=null}set(m,g){this.h=m,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Fe,W=!1,le=new X,ce=()=>{const c=a.Promise.resolve(void 0);Fe=()=>{c.then(ke)}};var ke=()=>{for(var c;c=S();){try{c.h.call(c.g)}catch(g){N(g)}var m=ge;m.j(c),100>m.h&&(m.h++,c.next=m.g,m.g=c)}W=!1};function ue(){this.s=this.s,this.C=this.C}ue.prototype.s=!1,ue.prototype.ma=function(){this.s||(this.s=!0,this.N())},ue.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ie(c,m){this.type=c,this.g=this.target=m,this.defaultPrevented=!1}ie.prototype.h=function(){this.defaultPrevented=!0};var Ve=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,m=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const g=()=>{};a.addEventListener("test",g,m),a.removeEventListener("test",g,m)}catch{}return c}();function vt(c,m){if(ie.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var g=this.type=c.type,I=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=m,m=c.relatedTarget){if(U){e:{try{P(m.nodeName);var O=!0;break e}catch{}O=!1}O||(m=null)}}else g=="mouseover"?m=c.fromElement:g=="mouseout"&&(m=c.toElement);this.relatedTarget=m,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:bn[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&vt.aa.h.call(this)}}T(vt,ie);var bn={2:"touch",3:"pen",4:"mouse"};vt.prototype.h=function(){vt.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var fn="closure_listenable_"+(1e6*Math.random()|0),so=0;function _a(c,m,g,I,O){this.listener=c,this.proxy=null,this.src=m,this.type=g,this.capture=!!I,this.ha=O,this.key=++so,this.da=this.fa=!1}function fs(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function ps(c){this.src=c,this.g={},this.h=0}ps.prototype.add=function(c,m,g,I,O){var L=c.toString();c=this.g[L],c||(c=this.g[L]=[],this.h++);var J=Se(c,m,I,O);return-1<J?(m=c[J],g||(m.fa=!1)):(m=new _a(m,this.src,L,!!I,O),m.fa=g,c.push(m)),m};function Ie(c,m){var g=m.type;if(g in c.g){var I=c.g[g],O=Array.prototype.indexOf.call(I,m,void 0),L;(L=0<=O)&&Array.prototype.splice.call(I,O,1),L&&(fs(m),c.g[g].length==0&&(delete c.g[g],c.h--))}}function Se(c,m,g,I){for(var O=0;O<c.length;++O){var L=c[O];if(!L.da&&L.listener==m&&L.capture==!!g&&L.ha==I)return O}return-1}var Ye="closure_lm_"+(1e6*Math.random()|0),ye={};function Je(c,m,g,I,O){if(I&&I.once)return Cn(c,m,g,I,O);if(Array.isArray(m)){for(var L=0;L<m.length;L++)Je(c,m[L],g,I,O);return null}return g=de(g),c&&c[fn]?c.K(m,g,u(I)?!!I.capture:!!I,O):Ot(c,m,g,!1,I,O)}function Ot(c,m,g,I,O,L){if(!m)throw Error("Invalid event type");var J=u(O)?!!O.capture:!!O,Xe=z(c);if(Xe||(c[Ye]=Xe=new ps(c)),g=Xe.add(m,g,I,J,L),g.proxy)return g;if(I=An(),g.proxy=I,I.src=c,I.listener=g,c.addEventListener)Ve||(O=J),O===void 0&&(O=!1),c.addEventListener(m.toString(),I,O);else if(c.attachEvent)c.attachEvent(jt(m.toString()),I);else if(c.addListener&&c.removeListener)c.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return g}function An(){function c(g){return m.call(c.src,c.listener,g)}const m=D;return c}function Cn(c,m,g,I,O){if(Array.isArray(m)){for(var L=0;L<m.length;L++)Cn(c,m[L],g,I,O);return null}return g=de(g),c&&c[fn]?c.L(m,g,u(I)?!!I.capture:!!I,O):Ot(c,m,g,!0,I,O)}function gr(c,m,g,I,O){if(Array.isArray(m))for(var L=0;L<m.length;L++)gr(c,m[L],g,I,O);else I=u(I)?!!I.capture:!!I,g=de(g),c&&c[fn]?(c=c.i,m=String(m).toString(),m in c.g&&(L=c.g[m],g=Se(L,g,I,O),-1<g&&(fs(L[g]),Array.prototype.splice.call(L,g,1),L.length==0&&(delete c.g[m],c.h--)))):c&&(c=z(c))&&(m=c.g[m.toString()],c=-1,m&&(c=Se(m,g,I,O)),(g=-1<c?m[c]:null)&&wt(g))}function wt(c){if(typeof c!="number"&&c&&!c.da){var m=c.src;if(m&&m[fn])Ie(m.i,c);else{var g=c.type,I=c.proxy;m.removeEventListener?m.removeEventListener(g,I,c.capture):m.detachEvent?m.detachEvent(jt(g),I):m.addListener&&m.removeListener&&m.removeListener(I),(g=z(m))?(Ie(g,c),g.h==0&&(g.src=null,m[Ye]=null)):fs(c)}}}function jt(c){return c in ye?ye[c]:ye[c]="on"+c}function D(c,m){if(c.da)c=!0;else{m=new vt(m,this);var g=c.listener,I=c.ha||c.src;c.fa&&wt(c),c=g.call(I,m)}return c}function z(c){return c=c[Ye],c instanceof ps?c:null}var K="__closure_events_fn_"+(1e9*Math.random()>>>0);function de(c){return typeof c=="function"?c:(c[K]||(c[K]=function(m){return c.handleEvent(m)}),c[K])}function oe(){ue.call(this),this.i=new ps(this),this.M=this,this.F=null}T(oe,ue),oe.prototype[fn]=!0,oe.prototype.removeEventListener=function(c,m,g,I){gr(this,c,m,g,I)};function te(c,m){var g,I=c.F;if(I)for(g=[];I;I=I.F)g.push(I);if(c=c.M,I=m.type||m,typeof m=="string")m=new ie(m,c);else if(m instanceof ie)m.target=m.target||c;else{var O=m;m=new ie(I,c),y(m,O)}if(O=!0,g)for(var L=g.length-1;0<=L;L--){var J=m.g=g[L];O=_e(J,I,!0,m)&&O}if(J=m.g=c,O=_e(J,I,!0,m)&&O,O=_e(J,I,!1,m)&&O,g)for(L=0;L<g.length;L++)J=m.g=g[L],O=_e(J,I,!1,m)&&O}oe.prototype.N=function(){if(oe.aa.N.call(this),this.i){var c=this.i,m;for(m in c.g){for(var g=c.g[m],I=0;I<g.length;I++)fs(g[I]);delete c.g[m],c.h--}}this.F=null},oe.prototype.K=function(c,m,g,I){return this.i.add(String(c),m,!1,g,I)},oe.prototype.L=function(c,m,g,I){return this.i.add(String(c),m,!0,g,I)};function _e(c,m,g,I){if(m=c.i.g[String(m)],!m)return!0;m=m.concat();for(var O=!0,L=0;L<m.length;++L){var J=m[L];if(J&&!J.da&&J.capture==g){var Xe=J.listener,an=J.ha||J.src;J.fa&&Ie(c.i,J),O=Xe.call(an,I)!==!1&&O}}return O&&!I.defaultPrevented}function Ee(c,m,g){if(typeof c=="function")g&&(c=p(c,g));else if(c&&typeof c.handleEvent=="function")c=p(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(m)?-1:a.setTimeout(c,m||0)}function fe(c){c.g=Ee(()=>{c.g=null,c.i&&(c.i=!1,fe(c))},c.l);const m=c.h;c.h=null,c.m.apply(null,m)}class tt extends ue{constructor(m,g){super(),this.m=m,this.l=g,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:fe(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function It(c){ue.call(this),this.h=c,this.g={}}T(It,ue);var nt=[];function De(c){F(c.g,function(m,g){this.g.hasOwnProperty(g)&&wt(m)},c),c.g={}}It.prototype.N=function(){It.aa.N.call(this),De(this)},It.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ct=a.JSON.stringify,Mt=a.JSON.parse,Rn=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function qe(){}qe.prototype.h=null;function Oe(c){return c.h||(c.h=c.i())}function pn(){}var Fn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Be(){ie.call(this,"d")}T(Be,ie);function Jn(){ie.call(this,"c")}T(Jn,ie);var Et={},Zd=null;function va(){return Zd=Zd||new oe}Et.La="serverreachability";function eh(c){ie.call(this,Et.La,c)}T(eh,ie);function ac(c){const m=va();te(m,new eh(m))}Et.STAT_EVENT="statevent";function CI(c,m){ie.call(this,Et.STAT_EVENT,c),this.stat=m}T(CI,ie);function Nn(c){const m=va();te(m,new CI(m,c))}Et.Ma="timingevent";function RI(c,m){ie.call(this,Et.Ma,c),this.size=m}T(RI,ie);function lc(c,m){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},m)}function cc(){this.g=!0}cc.prototype.xa=function(){this.g=!1};function kD(c,m,g,I,O,L){c.info(function(){if(c.g)if(L)for(var J="",Xe=L.split("&"),an=0;an<Xe.length;an++){var je=Xe[an].split("=");if(1<je.length){var mn=je[0];je=je[1];var gn=mn.split("_");J=2<=gn.length&&gn[1]=="type"?J+(mn+"="+je+"&"):J+(mn+"=redacted&")}}else J=null;else J=L;return"XMLHTTP REQ ("+I+") [attempt "+O+"]: "+m+`
`+g+`
`+J})}function DD(c,m,g,I,O,L,J){c.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+O+"]: "+m+`
`+g+`
`+L+" "+J})}function wa(c,m,g,I){c.info(function(){return"XMLHTTP TEXT ("+m+"): "+MD(c,g)+(I?" "+I:"")})}function OD(c,m){c.info(function(){return"TIMEOUT: "+m})}cc.prototype.info=function(){};function MD(c,m){if(!c.g)return m;if(!m)return null;try{var g=JSON.parse(m);if(g){for(c=0;c<g.length;c++)if(Array.isArray(g[c])){var I=g[c];if(!(2>I.length)){var O=I[1];if(Array.isArray(O)&&!(1>O.length)){var L=O[0];if(L!="noop"&&L!="stop"&&L!="close")for(var J=1;J<O.length;J++)O[J]=""}}}}return Ct(g)}catch{return m}}var th={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},NI={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},sg;function nh(){}T(nh,qe),nh.prototype.g=function(){return new XMLHttpRequest},nh.prototype.i=function(){return{}},sg=new nh;function Ks(c,m,g,I){this.j=c,this.i=m,this.l=g,this.R=I||1,this.U=new It(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new PI}function PI(){this.i=null,this.g="",this.h=!1}var kI={},ig={};function og(c,m,g){c.L=1,c.v=oh(ms(m)),c.m=g,c.P=!0,DI(c,null)}function DI(c,m){c.F=Date.now(),rh(c),c.A=ms(c.v);var g=c.A,I=c.R;Array.isArray(I)||(I=[String(I)]),HI(g.i,"t",I),c.C=0,g=c.j.J,c.h=new PI,c.g=dE(c.j,g?m:null,!c.m),0<c.O&&(c.M=new tt(p(c.Y,c,c.g),c.O)),m=c.U,g=c.g,I=c.ca;var O="readystatechange";Array.isArray(O)||(O&&(nt[0]=O.toString()),O=nt);for(var L=0;L<O.length;L++){var J=Je(g,O[L],I||m.handleEvent,!1,m.h||m);if(!J)break;m.g[J.key]=J}m=c.H?w(c.H):{},c.m?(c.u||(c.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,m)):(c.u="GET",c.g.ea(c.A,c.u,null,m)),ac(),kD(c.i,c.u,c.A,c.l,c.R,c.m)}Ks.prototype.ca=function(c){c=c.target;const m=this.M;m&&gs(c)==3?m.j():this.Y(c)},Ks.prototype.Y=function(c){try{if(c==this.g)e:{const gn=gs(this.g);var m=this.g.Ba();const Ta=this.g.Z();if(!(3>gn)&&(gn!=3||this.g&&(this.h.h||this.g.oa()||eE(this.g)))){this.J||gn!=4||m==7||(m==8||0>=Ta?ac(3):ac(2)),ag(this);var g=this.g.Z();this.X=g;t:if(OI(this)){var I=eE(this.g);c="";var O=I.length,L=gs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){io(this),uc(this);var J="";break t}this.h.i=new a.TextDecoder}for(m=0;m<O;m++)this.h.h=!0,c+=this.h.i.decode(I[m],{stream:!(L&&m==O-1)});I.length=0,this.h.g+=c,this.C=0,J=this.h.g}else J=this.g.oa();if(this.o=g==200,DD(this.i,this.u,this.A,this.l,this.R,gn,g),this.o){if(this.T&&!this.K){t:{if(this.g){var Xe,an=this.g;if((Xe=an.g?an.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Xe)){var je=Xe;break t}}je=null}if(g=je)wa(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,lg(this,g);else{this.o=!1,this.s=3,Nn(12),io(this),uc(this);break e}}if(this.P){g=!0;let Cr;for(;!this.J&&this.C<J.length;)if(Cr=VD(this,J),Cr==ig){gn==4&&(this.s=4,Nn(14),g=!1),wa(this.i,this.l,null,"[Incomplete Response]");break}else if(Cr==kI){this.s=4,Nn(15),wa(this.i,this.l,J,"[Invalid Chunk]"),g=!1;break}else wa(this.i,this.l,Cr,null),lg(this,Cr);if(OI(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),gn!=4||J.length!=0||this.h.h||(this.s=1,Nn(16),g=!1),this.o=this.o&&g,!g)wa(this.i,this.l,J,"[Invalid Chunked Response]"),io(this),uc(this);else if(0<J.length&&!this.W){this.W=!0;var mn=this.j;mn.g==this&&mn.ba&&!mn.M&&(mn.j.info("Great, no buffering proxy detected. Bytes received: "+J.length),pg(mn),mn.M=!0,Nn(11))}}else wa(this.i,this.l,J,null),lg(this,J);gn==4&&io(this),this.o&&!this.J&&(gn==4?aE(this.j,this):(this.o=!1,rh(this)))}else ZD(this.g),g==400&&0<J.indexOf("Unknown SID")?(this.s=3,Nn(12)):(this.s=0,Nn(13)),io(this),uc(this)}}}catch{}finally{}};function OI(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function VD(c,m){var g=c.C,I=m.indexOf(`
`,g);return I==-1?ig:(g=Number(m.substring(g,I)),isNaN(g)?kI:(I+=1,I+g>m.length?ig:(m=m.slice(I,I+g),c.C=I+g,m)))}Ks.prototype.cancel=function(){this.J=!0,io(this)};function rh(c){c.S=Date.now()+c.I,MI(c,c.I)}function MI(c,m){if(c.B!=null)throw Error("WatchDog timer not null");c.B=lc(p(c.ba,c),m)}function ag(c){c.B&&(a.clearTimeout(c.B),c.B=null)}Ks.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(OD(this.i,this.A),this.L!=2&&(ac(),Nn(17)),io(this),this.s=2,uc(this)):MI(this,this.S-c)};function uc(c){c.j.G==0||c.J||aE(c.j,c)}function io(c){ag(c);var m=c.M;m&&typeof m.ma=="function"&&m.ma(),c.M=null,De(c.U),c.g&&(m=c.g,c.g=null,m.abort(),m.ma())}function lg(c,m){try{var g=c.j;if(g.G!=0&&(g.g==c||cg(g.h,c))){if(!c.K&&cg(g.h,c)&&g.G==3){try{var I=g.Da.g.parse(m)}catch{I=null}if(Array.isArray(I)&&I.length==3){var O=I;if(O[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<c.F)hh(g),uh(g);else break e;fg(g),Nn(18)}}else g.za=O[1],0<g.za-g.T&&37500>O[2]&&g.F&&g.v==0&&!g.C&&(g.C=lc(p(g.Za,g),6e3));if(1>=FI(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else ao(g,11)}else if((c.K||g.g==c)&&hh(g),!x(m))for(O=g.Da.g.parse(m),m=0;m<O.length;m++){let je=O[m];if(g.T=je[0],je=je[1],g.G==2)if(je[0]=="c"){g.K=je[1],g.ia=je[2];const mn=je[3];mn!=null&&(g.la=mn,g.j.info("VER="+g.la));const gn=je[4];gn!=null&&(g.Aa=gn,g.j.info("SVER="+g.Aa));const Ta=je[5];Ta!=null&&typeof Ta=="number"&&0<Ta&&(I=1.5*Ta,g.L=I,g.j.info("backChannelRequestTimeoutMs_="+I)),I=g;const Cr=c.g;if(Cr){const ph=Cr.g?Cr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ph){var L=I.h;L.g||ph.indexOf("spdy")==-1&&ph.indexOf("quic")==-1&&ph.indexOf("h2")==-1||(L.j=L.l,L.g=new Set,L.h&&(ug(L,L.h),L.h=null))}if(I.D){const mg=Cr.g?Cr.g.getResponseHeader("X-HTTP-Session-Id"):null;mg&&(I.ya=mg,at(I.I,I.D,mg))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-c.F,g.j.info("Handshake RTT: "+g.R+"ms")),I=g;var J=c;if(I.qa=uE(I,I.J?I.ia:null,I.W),J.K){jI(I.h,J);var Xe=J,an=I.L;an&&(Xe.I=an),Xe.B&&(ag(Xe),rh(Xe)),I.g=J}else iE(I);0<g.i.length&&dh(g)}else je[0]!="stop"&&je[0]!="close"||ao(g,7);else g.G==3&&(je[0]=="stop"||je[0]=="close"?je[0]=="stop"?ao(g,7):hg(g):je[0]!="noop"&&g.l&&g.l.ta(je),g.v=0)}}ac(4)}catch{}}var LD=class{constructor(c,m){this.g=c,this.map=m}};function VI(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function LI(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function FI(c){return c.h?1:c.g?c.g.size:0}function cg(c,m){return c.h?c.h==m:c.g?c.g.has(m):!1}function ug(c,m){c.g?c.g.add(m):c.h=m}function jI(c,m){c.h&&c.h==m?c.h=null:c.g&&c.g.has(m)&&c.g.delete(m)}VI.prototype.cancel=function(){if(this.i=UI(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function UI(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let m=c.i;for(const g of c.g.values())m=m.concat(g.D);return m}return b(c.i)}function FD(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var m=[],g=c.length,I=0;I<g;I++)m.push(c[I]);return m}m=[],g=0;for(I in c)m[g++]=c[I];return m}function jD(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var m=[];c=c.length;for(var g=0;g<c;g++)m.push(g);return m}m=[],g=0;for(const I in c)m[g++]=I;return m}}}function BI(c,m){if(c.forEach&&typeof c.forEach=="function")c.forEach(m,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,m,void 0);else for(var g=jD(c),I=FD(c),O=I.length,L=0;L<O;L++)m.call(void 0,I[L],g&&g[L],c)}var $I=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function UD(c,m){if(c){c=c.split("&");for(var g=0;g<c.length;g++){var I=c[g].indexOf("="),O=null;if(0<=I){var L=c[g].substring(0,I);O=c[g].substring(I+1)}else L=c[g];m(L,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function oo(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof oo){this.h=c.h,sh(this,c.j),this.o=c.o,this.g=c.g,ih(this,c.s),this.l=c.l;var m=c.i,g=new fc;g.i=m.i,m.g&&(g.g=new Map(m.g),g.h=m.h),zI(this,g),this.m=c.m}else c&&(m=String(c).match($I))?(this.h=!1,sh(this,m[1]||"",!0),this.o=dc(m[2]||""),this.g=dc(m[3]||"",!0),ih(this,m[4]),this.l=dc(m[5]||"",!0),zI(this,m[6]||"",!0),this.m=dc(m[7]||"")):(this.h=!1,this.i=new fc(null,this.h))}oo.prototype.toString=function(){var c=[],m=this.j;m&&c.push(hc(m,qI,!0),":");var g=this.g;return(g||m=="file")&&(c.push("//"),(m=this.o)&&c.push(hc(m,qI,!0),"@"),c.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&c.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&c.push("/"),c.push(hc(g,g.charAt(0)=="/"?zD:$D,!0))),(g=this.i.toString())&&c.push("?",g),(g=this.m)&&c.push("#",hc(g,WD)),c.join("")};function ms(c){return new oo(c)}function sh(c,m,g){c.j=g?dc(m,!0):m,c.j&&(c.j=c.j.replace(/:$/,""))}function ih(c,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);c.s=m}else c.s=null}function zI(c,m,g){m instanceof fc?(c.i=m,GD(c.i,c.h)):(g||(m=hc(m,qD)),c.i=new fc(m,c.h))}function at(c,m,g){c.i.set(m,g)}function oh(c){return at(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function dc(c,m){return c?m?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function hc(c,m,g){return typeof c=="string"?(c=encodeURI(c).replace(m,BD),g&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function BD(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var qI=/[#\/\?@]/g,$D=/[#\?:]/g,zD=/[#\?]/g,qD=/[#\?@]/g,WD=/#/g;function fc(c,m){this.h=this.g=null,this.i=c||null,this.j=!!m}function Qs(c){c.g||(c.g=new Map,c.h=0,c.i&&UD(c.i,function(m,g){c.add(decodeURIComponent(m.replace(/\+/g," ")),g)}))}n=fc.prototype,n.add=function(c,m){Qs(this),this.i=null,c=Ia(this,c);var g=this.g.get(c);return g||this.g.set(c,g=[]),g.push(m),this.h+=1,this};function WI(c,m){Qs(c),m=Ia(c,m),c.g.has(m)&&(c.i=null,c.h-=c.g.get(m).length,c.g.delete(m))}function GI(c,m){return Qs(c),m=Ia(c,m),c.g.has(m)}n.forEach=function(c,m){Qs(this),this.g.forEach(function(g,I){g.forEach(function(O){c.call(m,O,I,this)},this)},this)},n.na=function(){Qs(this);const c=Array.from(this.g.values()),m=Array.from(this.g.keys()),g=[];for(let I=0;I<m.length;I++){const O=c[I];for(let L=0;L<O.length;L++)g.push(m[I])}return g},n.V=function(c){Qs(this);let m=[];if(typeof c=="string")GI(this,c)&&(m=m.concat(this.g.get(Ia(this,c))));else{c=Array.from(this.g.values());for(let g=0;g<c.length;g++)m=m.concat(c[g])}return m},n.set=function(c,m){return Qs(this),this.i=null,c=Ia(this,c),GI(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[m]),this.h+=1,this},n.get=function(c,m){return c?(c=this.V(c),0<c.length?String(c[0]):m):m};function HI(c,m,g){WI(c,m),0<g.length&&(c.i=null,c.g.set(Ia(c,m),b(g)),c.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],m=Array.from(this.g.keys());for(var g=0;g<m.length;g++){var I=m[g];const L=encodeURIComponent(String(I)),J=this.V(I);for(I=0;I<J.length;I++){var O=L;J[I]!==""&&(O+="="+encodeURIComponent(String(J[I]))),c.push(O)}}return this.i=c.join("&")};function Ia(c,m){return m=String(m),c.j&&(m=m.toLowerCase()),m}function GD(c,m){m&&!c.j&&(Qs(c),c.i=null,c.g.forEach(function(g,I){var O=I.toLowerCase();I!=O&&(WI(this,I),HI(this,O,g))},c)),c.j=m}function HD(c,m){const g=new cc;if(a.Image){const I=new Image;I.onload=_(Ys,g,"TestLoadImage: loaded",!0,m,I),I.onerror=_(Ys,g,"TestLoadImage: error",!1,m,I),I.onabort=_(Ys,g,"TestLoadImage: abort",!1,m,I),I.ontimeout=_(Ys,g,"TestLoadImage: timeout",!1,m,I),a.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=c}else m(!1)}function KD(c,m){const g=new cc,I=new AbortController,O=setTimeout(()=>{I.abort(),Ys(g,"TestPingServer: timeout",!1,m)},1e4);fetch(c,{signal:I.signal}).then(L=>{clearTimeout(O),L.ok?Ys(g,"TestPingServer: ok",!0,m):Ys(g,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(O),Ys(g,"TestPingServer: error",!1,m)})}function Ys(c,m,g,I,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),I(g)}catch{}}function QD(){this.g=new Rn}function YD(c,m,g){const I=g||"";try{BI(c,function(O,L){let J=O;u(O)&&(J=Ct(O)),m.push(I+L+"="+encodeURIComponent(J))})}catch(O){throw m.push(I+"type="+encodeURIComponent("_badmap")),O}}function ah(c){this.l=c.Ub||null,this.j=c.eb||!1}T(ah,qe),ah.prototype.g=function(){return new lh(this.l,this.j)},ah.prototype.i=function(c){return function(){return c}}({});function lh(c,m){oe.call(this),this.D=c,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}T(lh,oe),n=lh.prototype,n.open=function(c,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=m,this.readyState=1,mc(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(m.body=c),(this.D||a).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pc(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,mc(this)),this.g&&(this.readyState=3,mc(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;KI(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function KI(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var m=c.value?c.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!c.done}))&&(this.response=this.responseText+=m)}c.done?pc(this):mc(this),this.readyState==3&&KI(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,pc(this))},n.Qa=function(c){this.g&&(this.response=c,pc(this))},n.ga=function(){this.g&&pc(this)};function pc(c){c.readyState=4,c.l=null,c.j=null,c.v=null,mc(c)}n.setRequestHeader=function(c,m){this.u.append(c,m)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],m=this.h.entries();for(var g=m.next();!g.done;)g=g.value,c.push(g[0]+": "+g[1]),g=m.next();return c.join(`\r
`)};function mc(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(lh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function QI(c){let m="";return F(c,function(g,I){m+=I,m+=":",m+=g,m+=`\r
`}),m}function dg(c,m,g){e:{for(I in g){var I=!1;break e}I=!0}I||(g=QI(g),typeof c=="string"?g!=null&&encodeURIComponent(String(g)):at(c,m,g))}function Rt(c){oe.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}T(Rt,oe);var JD=/^https?$/i,XD=["POST","PUT"];n=Rt.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,m,g,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);m=m?m.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():sg.g(),this.v=this.o?Oe(this.o):Oe(sg),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(m,String(c),!0),this.B=!1}catch(L){YI(this,L);return}if(c=g||"",g=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var O in I)g.set(O,I[O]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(const L of I.keys())g.set(L,I.get(L));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(g.keys()).find(L=>L.toLowerCase()=="content-type"),O=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(XD,m,void 0))||I||O||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[L,J]of g)this.g.setRequestHeader(L,J);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ZI(this),this.u=!0,this.g.send(c),this.u=!1}catch(L){YI(this,L)}};function YI(c,m){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=m,c.m=5,JI(c),ch(c)}function JI(c){c.A||(c.A=!0,te(c,"complete"),te(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,te(this,"complete"),te(this,"abort"),ch(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ch(this,!0)),Rt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?XI(this):this.bb())},n.bb=function(){XI(this)};function XI(c){if(c.h&&typeof o<"u"&&(!c.v[1]||gs(c)!=4||c.Z()!=2)){if(c.u&&gs(c)==4)Ee(c.Ea,0,c);else if(te(c,"readystatechange"),gs(c)==4){c.h=!1;try{const J=c.Z();e:switch(J){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var g;if(!(g=m)){var I;if(I=J===0){var O=String(c.D).match($I)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),I=!JD.test(O?O.toLowerCase():"")}g=I}if(g)te(c,"complete"),te(c,"success");else{c.m=6;try{var L=2<gs(c)?c.g.statusText:""}catch{L=""}c.l=L+" ["+c.Z()+"]",JI(c)}}finally{ch(c)}}}}function ch(c,m){if(c.g){ZI(c);const g=c.g,I=c.v[0]?()=>{}:null;c.g=null,c.v=null,m||te(c,"ready");try{g.onreadystatechange=I}catch{}}}function ZI(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function gs(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<gs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var m=this.g.responseText;return c&&m.indexOf(c)==0&&(m=m.substring(c.length)),Mt(m)}};function eE(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function ZD(c){const m={};c=(c.g&&2<=gs(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<c.length;I++){if(x(c[I]))continue;var g=v(c[I]);const O=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const L=m[O]||[];m[O]=L,L.push(g)}A(m,function(I){return I.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function gc(c,m,g){return g&&g.internalChannelParams&&g.internalChannelParams[c]||m}function tE(c){this.Aa=0,this.i=[],this.j=new cc,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=gc("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=gc("baseRetryDelayMs",5e3,c),this.cb=gc("retryDelaySeedMs",1e4,c),this.Wa=gc("forwardChannelMaxRetries",2,c),this.wa=gc("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new VI(c&&c.concurrentRequestLimit),this.Da=new QD,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=tE.prototype,n.la=8,n.G=1,n.connect=function(c,m,g,I){Nn(0),this.W=c,this.H=m||{},g&&I!==void 0&&(this.H.OSID=g,this.H.OAID=I),this.F=this.X,this.I=uE(this,null,this.W),dh(this)};function hg(c){if(nE(c),c.G==3){var m=c.U++,g=ms(c.I);if(at(g,"SID",c.K),at(g,"RID",m),at(g,"TYPE","terminate"),yc(c,g),m=new Ks(c,c.j,m),m.L=2,m.v=oh(ms(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(m.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=m.v,g=!0),g||(m.g=dE(m.j,null),m.g.ea(m.v)),m.F=Date.now(),rh(m)}cE(c)}function uh(c){c.g&&(pg(c),c.g.cancel(),c.g=null)}function nE(c){uh(c),c.u&&(a.clearTimeout(c.u),c.u=null),hh(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function dh(c){if(!LI(c.h)&&!c.s){c.s=!0;var m=c.Ga;Fe||ce(),W||(Fe(),W=!0),le.add(m,c),c.B=0}}function e2(c,m){return FI(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=m.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=lc(p(c.Ga,c,m),lE(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const O=new Ks(this,this.j,c);let L=this.o;if(this.S&&(L?(L=w(L),y(L,this.S)):L=this.S),this.m!==null||this.O||(O.H=L,L=null),this.P)e:{for(var m=0,g=0;g<this.i.length;g++){t:{var I=this.i[g];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(m+=I,4096<m){m=g;break e}if(m===4096||g===this.i.length-1){m=g+1;break e}}m=1e3}else m=1e3;m=sE(this,O,m),g=ms(this.I),at(g,"RID",c),at(g,"CVER",22),this.D&&at(g,"X-HTTP-Session-Id",this.D),yc(this,g),L&&(this.O?m="headers="+encodeURIComponent(String(QI(L)))+"&"+m:this.m&&dg(g,this.m,L)),ug(this.h,O),this.Ua&&at(g,"TYPE","init"),this.P?(at(g,"$req",m),at(g,"SID","null"),O.T=!0,og(O,g,null)):og(O,g,m),this.G=2}}else this.G==3&&(c?rE(this,c):this.i.length==0||LI(this.h)||rE(this))};function rE(c,m){var g;m?g=m.l:g=c.U++;const I=ms(c.I);at(I,"SID",c.K),at(I,"RID",g),at(I,"AID",c.T),yc(c,I),c.m&&c.o&&dg(I,c.m,c.o),g=new Ks(c,c.j,g,c.B+1),c.m===null&&(g.H=c.o),m&&(c.i=m.D.concat(c.i)),m=sE(c,g,1e3),g.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),ug(c.h,g),og(g,I,m)}function yc(c,m){c.H&&F(c.H,function(g,I){at(m,I,g)}),c.l&&BI({},function(g,I){at(m,I,g)})}function sE(c,m,g){g=Math.min(c.i.length,g);var I=c.l?p(c.l.Na,c.l,c):null;e:{var O=c.i;let L=-1;for(;;){const J=["count="+g];L==-1?0<g?(L=O[0].g,J.push("ofs="+L)):L=0:J.push("ofs="+L);let Xe=!0;for(let an=0;an<g;an++){let je=O[an].g;const mn=O[an].map;if(je-=L,0>je)L=Math.max(0,O[an].g-100),Xe=!1;else try{YD(mn,J,"req"+je+"_")}catch{I&&I(mn)}}if(Xe){I=J.join("&");break e}}}return c=c.i.splice(0,g),m.D=c,I}function iE(c){if(!c.g&&!c.u){c.Y=1;var m=c.Fa;Fe||ce(),W||(Fe(),W=!0),le.add(m,c),c.v=0}}function fg(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=lc(p(c.Fa,c),lE(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,oE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=lc(p(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Nn(10),uh(this),oE(this))};function pg(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function oE(c){c.g=new Ks(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var m=ms(c.qa);at(m,"RID","rpc"),at(m,"SID",c.K),at(m,"AID",c.T),at(m,"CI",c.F?"0":"1"),!c.F&&c.ja&&at(m,"TO",c.ja),at(m,"TYPE","xmlhttp"),yc(c,m),c.m&&c.o&&dg(m,c.m,c.o),c.L&&(c.g.I=c.L);var g=c.g;c=c.ia,g.L=1,g.v=oh(ms(m)),g.m=null,g.P=!0,DI(g,c)}n.Za=function(){this.C!=null&&(this.C=null,uh(this),fg(this),Nn(19))};function hh(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function aE(c,m){var g=null;if(c.g==m){hh(c),pg(c),c.g=null;var I=2}else if(cg(c.h,m))g=m.D,jI(c.h,m),I=1;else return;if(c.G!=0){if(m.o)if(I==1){g=m.m?m.m.length:0,m=Date.now()-m.F;var O=c.B;I=va(),te(I,new RI(I,g)),dh(c)}else iE(c);else if(O=m.s,O==3||O==0&&0<m.X||!(I==1&&e2(c,m)||I==2&&fg(c)))switch(g&&0<g.length&&(m=c.h,m.i=m.i.concat(g)),O){case 1:ao(c,5);break;case 4:ao(c,10);break;case 3:ao(c,6);break;default:ao(c,2)}}}function lE(c,m){let g=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(g*=2),g*m}function ao(c,m){if(c.j.info("Error code "+m),m==2){var g=p(c.fb,c),I=c.Xa;const O=!I;I=new oo(I||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||sh(I,"https"),oh(I),O?HD(I.toString(),g):KD(I.toString(),g)}else Nn(2);c.G=0,c.l&&c.l.sa(m),cE(c),nE(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),Nn(2)):(this.j.info("Failed to ping google.com"),Nn(1))};function cE(c){if(c.G=0,c.ka=[],c.l){const m=UI(c.h);(m.length!=0||c.i.length!=0)&&(k(c.ka,m),k(c.ka,c.i),c.h.i.length=0,b(c.i),c.i.length=0),c.l.ra()}}function uE(c,m,g){var I=g instanceof oo?ms(g):new oo(g);if(I.g!="")m&&(I.g=m+"."+I.g),ih(I,I.s);else{var O=a.location;I=O.protocol,m=m?m+"."+O.hostname:O.hostname,O=+O.port;var L=new oo(null);I&&sh(L,I),m&&(L.g=m),O&&ih(L,O),g&&(L.l=g),I=L}return g=c.D,m=c.ya,g&&m&&at(I,g,m),at(I,"VER",c.la),yc(c,I),I}function dE(c,m,g){if(m&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return m=c.Ca&&!c.pa?new Rt(new ah({eb:g})):new Rt(c.pa),m.Ha(c.J),m}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function hE(){}n=hE.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function fh(){}fh.prototype.g=function(c,m){return new Xn(c,m)};function Xn(c,m){oe.call(this),this.g=new tE(m),this.l=c,this.h=m&&m.messageUrlParams||null,c=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(c?c["X-WebChannel-Content-Type"]=m.messageContentType:c={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(c?c["X-WebChannel-Client-Profile"]=m.va:c={"X-WebChannel-Client-Profile":m.va}),this.g.S=c,(c=m&&m.Sb)&&!x(c)&&(this.g.m=c),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!x(m)&&(this.g.D=m,c=this.h,c!==null&&m in c&&(c=this.h,m in c&&delete c[m])),this.j=new Ea(this)}T(Xn,oe),Xn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Xn.prototype.close=function(){hg(this.g)},Xn.prototype.o=function(c){var m=this.g;if(typeof c=="string"){var g={};g.__data__=c,c=g}else this.u&&(g={},g.__data__=Ct(c),c=g);m.i.push(new LD(m.Ya++,c)),m.G==3&&dh(m)},Xn.prototype.N=function(){this.g.l=null,delete this.j,hg(this.g),delete this.g,Xn.aa.N.call(this)};function fE(c){Be.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var m=c.__sm__;if(m){e:{for(const g in m){c=g;break e}c=void 0}(this.i=c)&&(c=this.i,m=m!==null&&c in m?m[c]:void 0),this.data=m}else this.data=c}T(fE,Be);function pE(){Jn.call(this),this.status=1}T(pE,Jn);function Ea(c){this.g=c}T(Ea,hE),Ea.prototype.ua=function(){te(this.g,"a")},Ea.prototype.ta=function(c){te(this.g,new fE(c))},Ea.prototype.sa=function(c){te(this.g,new pE)},Ea.prototype.ra=function(){te(this.g,"b")},fh.prototype.createWebChannel=fh.prototype.g,Xn.prototype.send=Xn.prototype.o,Xn.prototype.open=Xn.prototype.m,Xn.prototype.close=Xn.prototype.close,RR=function(){return new fh},CR=function(){return va()},AR=Et,L_={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},th.NO_ERROR=0,th.TIMEOUT=8,th.HTTP_ERROR=6,lf=th,NI.COMPLETE="complete",bR=NI,pn.EventType=Fn,Fn.OPEN="a",Fn.CLOSE="b",Fn.ERROR="c",Fn.MESSAGE="d",oe.prototype.listen=oe.prototype.K,zc=pn,Rt.prototype.listenOnce=Rt.prototype.L,Rt.prototype.getLastError=Rt.prototype.Ka,Rt.prototype.getLastErrorCode=Rt.prototype.Ba,Rt.prototype.getStatus=Rt.prototype.Z,Rt.prototype.getResponseJson=Rt.prototype.Oa,Rt.prototype.getResponseText=Rt.prototype.oa,Rt.prototype.send=Rt.prototype.ea,Rt.prototype.setWithCredentials=Rt.prototype.Ha,SR=Rt}).apply(typeof Oh<"u"?Oh:typeof self<"u"?self:typeof window<"u"?window:{});const gx="@firebase/firestore",yx="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Zt.UNAUTHENTICATED=new Zt(null),Zt.GOOGLE_CREDENTIALS=new Zt("google-credentials-uid"),Zt.FIRST_PARTY=new Zt("first-party-uid"),Zt.MOCK_USER=new Zt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ql="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bi=new Id("@firebase/firestore");function ka(){return Bi.logLevel}function t8(n){Bi.setLogLevel(n)}function $(n,...e){if(Bi.logLevel<=Ce.DEBUG){const t=e.map(Y0);Bi.debug(`Firestore (${Ql}): ${n}`,...t)}}function Lt(n,...e){if(Bi.logLevel<=Ce.ERROR){const t=e.map(Y0);Bi.error(`Firestore (${Ql}): ${n}`,...t)}}function br(n,...e){if(Bi.logLevel<=Ce.WARN){const t=e.map(Y0);Bi.warn(`Firestore (${Ql}): ${n}`,...t)}}function Y0(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,NR(n,r,t)}function NR(n,e,t){let r=`FIRESTORE (${Ql}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Lt(r),new Error(r)}function se(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||NR(e,s,r)}function n8(n,e){n||ee(57014,e)}function Y(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends $r{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class R4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Zt.UNAUTHENTICATED))}shutdown(){}}class N4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class P4{constructor(e){this.t=e,this.currentUser=Zt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){se(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new nn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new nn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{$("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):($("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new nn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?($("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(se(typeof r.accessToken=="string",31837,{l:r}),new PR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return se(e===null||typeof e=="string",2055,{h:e}),new Zt(e)}}class k4{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Zt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class D4{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new k4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Zt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class F_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class O4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,mt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){se(this.o===void 0,3512);const r=i=>{i.error!=null&&$("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,$("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{$("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):$("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new F_(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(se(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new F_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class r8{getToken(){return Promise.resolve(new F_(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=M4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function me(n,e){return n<e?-1:n>e?1:0}function j_(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return ey(s)===ey(i)?me(s,i):ey(s)?1:-1}return me(n.length,e.length)}const V4=55296,L4=57343;function ey(n){const e=n.charCodeAt(0);return e>=V4&&e<=L4}function Il(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function kR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U_="__name__";class Kr{constructor(e,t,r){t===void 0?t=0:t>e.length&&ee(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ee(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Kr.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Kr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Kr.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return me(e.length,t.length)}static compareSegments(e,t){const r=Kr.isNumericId(e),s=Kr.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Kr.extractNumericId(e).compare(Kr.extractNumericId(t)):j_(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pi.fromString(e.substring(4,e.length-2))}}class Ae extends Kr{construct(e,t,r){return new Ae(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new B(V.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ae(t)}static emptyPath(){return new Ae([])}}const F4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class yt extends Kr{construct(e,t,r){return new yt(e,t,r)}static isValidIdentifier(e){return F4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),yt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===U_}static keyField(){return new yt([U_])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new B(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new B(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new B(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new B(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new yt(t)}static emptyPath(){return new yt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(e){this.path=e}static fromPath(e){return new Q(Ae.fromString(e))}static fromName(e){return new Q(Ae.fromString(e).popFirst(5))}static empty(){return new Q(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Q(new Ae(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X0(n,e,t){if(!t)throw new B(V.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function j4(n,e,t,r){if(e===!0&&r===!0)throw new B(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function _x(n){if(!Q.isDocumentKey(n))throw new B(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function vx(n){if(Q.isDocumentKey(n))throw new B(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function DR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function vm(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ee(12329,{type:typeof n})}function Re(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=vm(n);throw new B(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function OR(n,e){if(e<=0)throw new B(V.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zt(n,e){const t={typeString:n};return e&&(t.value=e),t}function ua(n,e){if(!DR(n))throw new B(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new B(V.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wx=-62135596800,Ix=1e6;class We{static now(){return We.fromMillis(Date.now())}static fromDate(e){return We.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Ix);return new We(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<wx)throw new B(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ix}_compareTo(e){return this.seconds===e.seconds?me(this.nanoseconds,e.nanoseconds):me(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:We._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ua(e,We._jsonSchema))return new We(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-wx;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}We._jsonSchemaVersion="firestore/timestamp/1.0",We._jsonSchema={type:zt("string",We._jsonSchemaVersion),seconds:zt("number"),nanoseconds:zt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{static fromTimestamp(e){return new ae(e)}static min(){return new ae(new We(0,0))}static max(){return new ae(new We(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El=-1;class Tl{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function B_(n){return n.fields.find(e=>e.kind===2)}function po(n){return n.fields.filter(e=>e.kind!==2)}function U4(n,e){let t=me(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=B4(n.fields[r],e.fields[r]),t!==0)return t;return me(n.fields.length,e.fields.length)}Tl.UNKNOWN_ID=-1;class No{constructor(e,t){this.fieldPath=e,this.kind=t}}function B4(n,e){const t=yt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:me(n.kind,e.kind)}class xl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new xl(0,hr.min())}}function MR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ae.fromTimestamp(r===1e9?new We(t+1,0):new We(t,r));return new hr(s,Q.empty(),e)}function VR(n){return new hr(n.readTime,n.key,El)}class hr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new hr(ae.min(),Q.empty(),El)}static max(){return new hr(ae.max(),Q.empty(),El)}}function Z0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Q.comparator(n.documentKey,e.documentKey),t!==0?t:me(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class FR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xi(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==LR)throw n;$("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ee(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,r)=>{t(e)})}static reject(e){return new M((t,r)=>{r(e)})}static waitFor(e){return new M((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=M.resolve(!1);for(const r of e)t=t.next(s=>s?M.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new M((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new M((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr="SimpleDb";class wm{static open(e,t,r,s){try{return new wm(t,e.transaction(s,r))}catch(i){throw new cu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new nn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new cu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=ew(r.target.error);this.S.reject(new cu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||($(tr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new z4(t)}}class is{static delete(e){return $(tr,"Removing database:",e),go(FA().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Zp())return!1;if(is.F())return!0;const e=Ht(),t=is.M(e),r=0<t&&t<10,s=jR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,is.M(Ht())===12.2&&Lt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||($(tr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new cu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new B(V.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new B(V.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new cu(e,o))},s.onupgradeneeded=i=>{$(tr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{$(tr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=wm.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),M.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if($(tr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function jR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class $4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return go(this.U.delete())}}class cu extends B{constructor(e,t){super(V.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Zi(n){return n.name==="IndexedDbTransactionError"}class z4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?($(tr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):($(tr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),go(r)}add(e){return $(tr,"ADD",this.store.name,e,e),go(this.store.add(e))}get(e){return go(this.store.get(e)).next(t=>(t===void 0&&(t=null),$(tr,"GET",this.store.name,e,t),t))}delete(e){return $(tr,"DELETE",this.store.name,e),go(this.store.delete(e))}count(){return $(tr,"COUNT",this.store.name),go(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new M((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new M((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){$(tr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new M((r,s)=>{t.onerror=i=>{const o=ew(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new M((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new $4(a),u=t(a.primaryKey,a.value,l);if(u instanceof M){const h=u.catch(f=>(l.done(),M.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>M.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function go(n){return new M((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=ew(r.target.error);t(s)}})}let Ex=!1;function ew(n){const e=is.M(Ht());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ex||(Ex=!0,setTimeout(()=>{throw r},0)),r}}return n}const uu="IndexBackfiller";class q4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){$(uu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();$(uu,`Documents written: ${t}`)}catch(t){Zi(t)?$(uu,"Ignoring IndexedDB error during index backfill: ",t):await Xi(t)}await this.re(6e4)})}}class W4{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return M.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return $(uu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>($(uu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=VR(i);Z0(o,r)>0&&(r=o)}),new hr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Bn.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki=-1;function Dd(n){return n==null}function Yu(n){return n===0&&1/n==-1/0}function UR(n){return typeof n=="number"&&Number.isInteger(n)&&!Yu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fp="";function Tn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Tx(e)),e=G4(n.get(t),e);return Tx(e)}function G4(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case fp:t+="";break;default:t+=i}}return t}function Tx(n){return n+fp+""}function Zr(n){const e=n.length;if(se(e>=2,64408,{path:n}),e===2)return se(n.charAt(0)===fp&&n.charAt(1)==="",56145,{path:n}),Ae.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(fp,i);switch((o<0||o>t)&&ee(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ee(61167,{path:n})}i=o+2}return new Ae(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mo="remoteDocuments",Od="owner",ba="owner",Ju="mutationQueues",H4="userId",kr="mutations",xx="batchId",xo="userMutationsIndex",Sx=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cf(n,e){return[n,Tn(e)]}function BR(n,e,t){return[n,Tn(e),t]}const K4={},Sl="documentMutations",pp="remoteDocumentsV14",Q4=["prefixPath","collectionGroup","readTime","documentId"],uf="documentKeyIndex",Y4=["prefixPath","collectionGroup","documentId"],$R="collectionGroupIndex",J4=["collectionGroup","readTime","prefixPath","documentId"],Xu="remoteDocumentGlobal",$_="remoteDocumentGlobalKey",bl="targets",zR="queryTargetsIndex",X4=["canonicalId","targetId"],Al="targetDocuments",Z4=["targetId","path"],tw="documentTargetsIndex",e3=["path","targetId"],mp="targetGlobalKey",Po="targetGlobal",Zu="collectionParents",t3=["collectionId","parent"],Cl="clientMetadata",n3="clientId",Im="bundles",r3="bundleId",Em="namedQueries",s3="name",nw="indexConfiguration",i3="indexId",z_="collectionGroupIndex",o3="collectionGroup",du="indexState",a3=["indexId","uid"],qR="sequenceNumberIndex",l3=["uid","sequenceNumber"],hu="indexEntries",c3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],WR="documentKeyIndex",u3=["indexId","uid","orderedDocumentKey"],Tm="documentOverlays",d3=["userId","collectionPath","documentId"],q_="collectionPathOverlayIndex",h3=["userId","collectionPath","largestBatchId"],GR="collectionGroupOverlayIndex",f3=["userId","collectionGroup","largestBatchId"],rw="globals",p3="name",HR=[Ju,kr,Sl,mo,bl,Od,Po,Al,Cl,Xu,Zu,Im,Em],m3=[...HR,Tm],KR=[Ju,kr,Sl,pp,bl,Od,Po,Al,Cl,Xu,Zu,Im,Em,Tm],QR=KR,sw=[...QR,nw,du,hu],g3=sw,YR=[...sw,rw],y3=YR;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_ extends FR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Kt(n,e){const t=Y(n);return is.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bx(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function eo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function JR(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function XR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e,t){this.comparator=e,this.root=t||cn.EMPTY}insert(e,t){return new ot(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,cn.BLACK,null,null))}remove(e){return new ot(this.comparator,this.root.remove(e,this.comparator).copy(null,null,cn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Mh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Mh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Mh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Mh(this.root,e,this.comparator,!0)}}class Mh{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class cn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??cn.RED,this.left=s??cn.EMPTY,this.right=i??cn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new cn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return cn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return cn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,cn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,cn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ee(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ee(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ee(27949);return e+(this.isRed()?0:1)}}cn.EMPTY=null,cn.RED=!0,cn.BLACK=!1;cn.EMPTY=new class{constructor(){this.size=0}get key(){throw ee(57766)}get value(){throw ee(16141)}get color(){throw ee(16727)}get left(){throw ee(29726)}get right(){throw ee(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new cn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e){this.comparator=e,this.data=new ot(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ax(this.data.getIterator())}getIteratorFrom(e){return new Ax(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ke)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ke(this.comparator);return t.data=e,t}}class Ax{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Aa(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e){this.fields=e,e.sort(yt.comparator)}static empty(){return new $n([])}unionWith(e){let t=new Ke(yt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new $n(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Il(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i8(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ZR("Invalid base64 string: "+i):i}}(e);return new kt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new kt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return me(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}kt.EMPTY_BYTE_STRING=new kt("");const _3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ms(n){if(se(!!n,39018),typeof n=="string"){let e=0;const t=_3.exec(n);if(se(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ft(n.seconds),nanos:ft(n.nanos)}}function ft(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Vs(n){return typeof n=="string"?kt.fromBase64String(n):kt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eN="server_timestamp",tN="__type__",nN="__previous_value__",rN="__local_write_time__";function xm(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[tN])==null?void 0:r.stringValue)===eN}function Sm(n){const e=n.mapValue.fields[nN];return xm(e)?Sm(e):e}function ed(n){const e=Ms(n.mapValue.fields[rN].timestampValue);return new We(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const td="(default)";class qo{constructor(e,t){this.projectId=e,this.database=t||td}static empty(){return new qo("","")}get isDefaultDatabase(){return this.database===td}isEqual(e){return e instanceof qo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iw="__type__",sN="__max__",mi={mapValue:{fields:{__type__:{stringValue:sN}}}},ow="__vector__",Rl="value",df={nullValue:"NULL_VALUE"};function $i(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xm(n)?4:iN(n)?9007199254740991:bm(n)?10:11:ee(28295,{value:n})}function ds(n,e){if(n===e)return!0;const t=$i(n);if(t!==$i(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ed(n).isEqual(ed(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ms(s.timestampValue),a=Ms(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Vs(s.bytesValue).isEqual(Vs(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return ft(s.geoPointValue.latitude)===ft(i.geoPointValue.latitude)&&ft(s.geoPointValue.longitude)===ft(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return ft(s.integerValue)===ft(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=ft(s.doubleValue),a=ft(i.doubleValue);return o===a?Yu(o)===Yu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Il(n.arrayValue.values||[],e.arrayValue.values||[],ds);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(bx(o)!==bx(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ds(o[l],a[l])))return!1;return!0}(n,e);default:return ee(52216,{left:n})}}function nd(n,e){return(n.values||[]).find(t=>ds(t,e))!==void 0}function zi(n,e){if(n===e)return 0;const t=$i(n),r=$i(e);if(t!==r)return me(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return me(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=ft(i.integerValue||i.doubleValue),l=ft(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Cx(n.timestampValue,e.timestampValue);case 4:return Cx(ed(n),ed(e));case 5:return j_(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Vs(i),l=Vs(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=me(a[u],l[u]);if(h!==0)return h}return me(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=me(ft(i.latitude),ft(o.latitude));return a!==0?a:me(ft(i.longitude),ft(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Rx(n.arrayValue,e.arrayValue);case 10:return function(i,o){var p,_,T,b;const a=i.fields||{},l=o.fields||{},u=(p=a[Rl])==null?void 0:p.arrayValue,h=(_=l[Rl])==null?void 0:_.arrayValue,f=me(((T=u==null?void 0:u.values)==null?void 0:T.length)||0,((b=h==null?void 0:h.values)==null?void 0:b.length)||0);return f!==0?f:Rx(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===mi.mapValue&&o===mi.mapValue)return 0;if(i===mi.mapValue)return 1;if(o===mi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const p=j_(l[f],h[f]);if(p!==0)return p;const _=zi(a[l[f]],u[h[f]]);if(_!==0)return _}return me(l.length,h.length)}(n.mapValue,e.mapValue);default:throw ee(23264,{he:t})}}function Cx(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return me(n,e);const t=Ms(n),r=Ms(e),s=me(t.seconds,r.seconds);return s!==0?s:me(t.nanos,r.nanos)}function Rx(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=zi(t[s],r[s]);if(i)return i}return me(t.length,r.length)}function Nl(n){return G_(n)}function G_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ms(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Vs(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=G_(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${G_(t.fields[o])}`;return s+"}"}(n.mapValue):ee(61005,{value:n})}function hf(n){switch($i(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Sm(n);return e?16+hf(e):16;case 5:return 2*n.stringValue.length;case 6:return Vs(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+hf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return eo(r.fields,(i,o)=>{s+=i.length+hf(o)}),s}(n.mapValue);default:throw ee(13486,{value:n})}}function Wo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function H_(n){return!!n&&"integerValue"in n}function rd(n){return!!n&&"arrayValue"in n}function Nx(n){return!!n&&"nullValue"in n}function Px(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ff(n){return!!n&&"mapValue"in n}function bm(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[iw])==null?void 0:r.stringValue)===ow}function fu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return eo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=fu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=fu(n.arrayValue.values[t]);return e}return{...n}}function iN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===sN}const oN={mapValue:{fields:{[iw]:{stringValue:ow},[Rl]:{arrayValue:{}}}}};function w3(n){return"nullValue"in n?df:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Wo(qo.empty(),Q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?bm(n)?oN:{mapValue:{}}:ee(35942,{value:n})}function I3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Wo(qo.empty(),Q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?oN:"mapValue"in n?bm(n)?{mapValue:{}}:mi:ee(61959,{value:n})}function kx(n,e){const t=zi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Dx(n,e){const t=zi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e){this.value=e}static empty(){return new un({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ff(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=fu(t)}setAll(e){let t=yt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=fu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ff(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ds(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ff(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){eo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new un(fu(this.value))}}function aN(n){const e=[];return eo(n.fields,(t,r)=>{const s=new yt([t]);if(ff(r)){const i=aN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new $n(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ct(e,0,ae.min(),ae.min(),ae.min(),un.empty(),0)}static newFoundDocument(e,t,r,s){return new ct(e,1,t,ae.min(),r,s,0)}static newNoDocument(e,t){return new ct(e,2,t,ae.min(),ae.min(),un.empty(),0)}static newUnknownDocument(e,t){return new ct(e,3,t,ae.min(),ae.min(),un.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=un.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=un.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ct&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ct(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,t){this.position=e,this.inclusive=t}}function Ox(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Q.comparator(Q.fromName(o.referenceValue),t.key):r=zi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Mx(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ds(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,t="asc"){this.field=e,this.dir=t}}function E3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{}class Pe extends lN{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new T3(e,t,r):t==="array-contains"?new b3(e,r):t==="in"?new pN(e,r):t==="not-in"?new A3(e,r):t==="array-contains-any"?new C3(e,r):new Pe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new x3(e,r):new S3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(zi(t,this.value)):t!==null&&$i(this.value)===$i(t)&&this.matchesComparison(zi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ee(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ge extends lN{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ge(e,t)}matches(e){return Pl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Pl(n){return n.op==="and"}function K_(n){return n.op==="or"}function aw(n){return cN(n)&&Pl(n)}function cN(n){for(const e of n.filters)if(e instanceof Ge)return!1;return!0}function Q_(n){if(n instanceof Pe)return n.field.canonicalString()+n.op.toString()+Nl(n.value);if(aw(n))return n.filters.map(e=>Q_(e)).join(",");{const e=n.filters.map(t=>Q_(t)).join(",");return`${n.op}(${e})`}}function uN(n,e){return n instanceof Pe?function(r,s){return s instanceof Pe&&r.op===s.op&&r.field.isEqual(s.field)&&ds(r.value,s.value)}(n,e):n instanceof Ge?function(r,s){return s instanceof Ge&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&uN(o,s.filters[a]),!0):!1}(n,e):void ee(19439)}function dN(n,e){const t=n.filters.concat(e);return Ge.create(t,n.op)}function hN(n){return n instanceof Pe?function(t){return`${t.field.canonicalString()} ${t.op} ${Nl(t.value)}`}(n):n instanceof Ge?function(t){return t.op.toString()+" {"+t.getFilters().map(hN).join(" ,")+"}"}(n):"Filter"}class T3 extends Pe{constructor(e,t,r){super(e,t,r),this.key=Q.fromName(r.referenceValue)}matches(e){const t=Q.comparator(e.key,this.key);return this.matchesComparison(t)}}class x3 extends Pe{constructor(e,t){super(e,"in",t),this.keys=fN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class S3 extends Pe{constructor(e,t){super(e,"not-in",t),this.keys=fN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function fN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>Q.fromName(r.referenceValue))}class b3 extends Pe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return rd(t)&&nd(t.arrayValue,this.value)}}class pN extends Pe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&nd(this.value.arrayValue,t)}}class A3 extends Pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(nd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!nd(this.value.arrayValue,t)}}class C3 extends Pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!rd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>nd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Y_(n,e=null,t=[],r=[],s=null,i=null,o=null){return new R3(n,e,t,r,s,i,o)}function Go(n){const e=Y(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Q_(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Dd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Nl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Nl(r)).join(",")),e.Te=t}return e.Te}function Md(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!E3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!uN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Mx(n.startAt,e.startAt)&&Mx(n.endAt,e.endAt)}function gp(n){return Q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function yp(n,e){return n.filters.filter(t=>t instanceof Pe&&t.field.isEqual(e))}function Vx(n,e,t){let r=df,s=!0;for(const i of yp(n,e)){let o=df,a=!0;switch(i.op){case"<":case"<=":o=w3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=df}kx({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];kx({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Lx(n,e,t){let r=mi,s=!0;for(const i of yp(n,e)){let o=mi,a=!0;switch(i.op){case">=":case">":o=I3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=mi}Dx({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Dx({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function mN(n,e,t,r,s,i,o,a){return new $s(n,e,t,r,s,i,o,a)}function Yl(n){return new $s(n)}function Fx(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function lw(n){return n.collectionGroup!==null}function nl(n){const e=Y(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ke(yt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new sd(i,r))}),t.has(yt.keyField().canonicalString())||e.Ie.push(new sd(yt.keyField(),r))}return e.Ie}function xn(n){const e=Y(n);return e.Ee||(e.Ee=yN(e,nl(n))),e.Ee}function gN(n){const e=Y(n);return e.de||(e.de=yN(e,n.explicitOrderBy)),e.de}function yN(n,e){if(n.limitType==="F")return Y_(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new sd(s.field,i)});const t=n.endAt?new qi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new qi(n.startAt.position,n.startAt.inclusive):null;return Y_(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function J_(n,e){const t=n.filters.concat([e]);return new $s(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function _p(n,e,t){return new $s(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Vd(n,e){return Md(xn(n),xn(e))&&n.limitType===e.limitType}function _N(n){return`${Go(xn(n))}|lt:${n.limitType}`}function Da(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>hN(s)).join(", ")}]`),Dd(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Nl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Nl(s)).join(",")),`Target(${r})`}(xn(n))}; limitType=${n.limitType})`}function Ld(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Q.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of nl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=Ox(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,nl(r),s)||r.endAt&&!function(o,a,l){const u=Ox(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,nl(r),s))}(n,e)}function vN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function wN(n){return(e,t)=>{let r=!1;for(const s of nl(n)){const i=N3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function N3(n,e,t){const r=n.field.isKeyField()?Q.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?zi(l,u):ee(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ee(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){eo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return XR(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P3=new ot(Q.comparator);function zn(){return P3}const IN=new ot(Q.comparator);function qc(...n){let e=IN;for(const t of n)e=e.insert(t.key,t);return e}function EN(n){let e=IN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function es(){return pu()}function TN(){return pu()}function pu(){return new zs(n=>n.toString(),(n,e)=>n.isEqual(e))}const k3=new ot(Q.comparator),D3=new Ke(Q.comparator);function ve(...n){let e=D3;for(const t of n)e=e.add(t);return e}const O3=new Ke(me);function cw(){return O3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yu(e)?"-0":e}}function xN(n){return{integerValue:""+n}}function SN(n,e){return UR(e)?xN(e):uw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(){this._=void 0}}function M3(n,e,t){return n instanceof kl?function(s,i){const o={fields:{[tN]:{stringValue:eN},[rN]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&xm(i)&&(i=Sm(i)),i&&(o.fields[nN]=i),{mapValue:o}}(t,e):n instanceof Ho?AN(n,e):n instanceof Ko?CN(n,e):function(s,i){const o=bN(s,i),a=jx(o)+jx(s.Ae);return H_(o)&&H_(s.Ae)?xN(a):uw(s.serializer,a)}(n,e)}function V3(n,e,t){return n instanceof Ho?AN(n,e):n instanceof Ko?CN(n,e):t}function bN(n,e){return n instanceof Dl?function(r){return H_(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class kl extends Am{}class Ho extends Am{constructor(e){super(),this.elements=e}}function AN(n,e){const t=RN(e);for(const r of n.elements)t.some(s=>ds(s,r))||t.push(r);return{arrayValue:{values:t}}}class Ko extends Am{constructor(e){super(),this.elements=e}}function CN(n,e){let t=RN(e);for(const r of n.elements)t=t.filter(s=>!ds(s,r));return{arrayValue:{values:t}}}class Dl extends Am{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function jx(n){return ft(n.integerValue||n.doubleValue)}function RN(n){return rd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd{constructor(e,t){this.field=e,this.transform=t}}function L3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Ho&&s instanceof Ho||r instanceof Ko&&s instanceof Ko?Il(r.elements,s.elements,ds):r instanceof Dl&&s instanceof Dl?ds(r.Ae,s.Ae):r instanceof kl&&s instanceof kl}(n.transform,e.transform)}class F3{constructor(e,t){this.version=e,this.transformResults=t}}class _t{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _t}static exists(e){return new _t(void 0,e)}static updateTime(e){return new _t(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function pf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Cm{}function NN(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Xl(n.key,_t.none()):new Jl(n.key,n.data,_t.none());{const t=n.data,r=un.empty();let s=new Ke(yt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new qs(n.key,r,new $n(s.toArray()),_t.none())}}function j3(n,e,t){n instanceof Jl?function(s,i,o){const a=s.value.clone(),l=Bx(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof qs?function(s,i,o){if(!pf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Bx(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(PN(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function mu(n,e,t,r){return n instanceof Jl?function(i,o,a,l){if(!pf(i.precondition,o))return a;const u=i.value.clone(),h=$x(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof qs?function(i,o,a,l){if(!pf(i.precondition,o))return a;const u=$x(i.fieldTransforms,l,o),h=o.data;return h.setAll(PN(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return pf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function U3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=bN(r.transform,s||null);i!=null&&(t===null&&(t=un.empty()),t.set(r.field,i))}return t||null}function Ux(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Il(r,s,(i,o)=>L3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Jl extends Cm{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class qs extends Cm{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function PN(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Bx(n,e,t){const r=new Map;se(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,V3(o,a,t[s]))}return r}function $x(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,M3(i,o,e))}return r}class Xl extends Cm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dw extends Cm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&j3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=mu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=mu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=TN();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=NN(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(ae.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ve())}isEqual(e){return this.batchId===e.batchId&&Il(this.mutations,e.mutations,(t,r)=>Ux(t,r))&&Il(this.baseMutations,e.baseMutations,(t,r)=>Ux(t,r))}}class fw{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){se(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return k3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new fw(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ut,Me;function DN(n){switch(n){case V.OK:return ee(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return ee(15467,{code:n})}}function ON(n){if(n===void 0)return Lt("GRPC error has no .code"),V.UNKNOWN;switch(n){case Ut.OK:return V.OK;case Ut.CANCELLED:return V.CANCELLED;case Ut.UNKNOWN:return V.UNKNOWN;case Ut.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Ut.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Ut.INTERNAL:return V.INTERNAL;case Ut.UNAVAILABLE:return V.UNAVAILABLE;case Ut.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Ut.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Ut.NOT_FOUND:return V.NOT_FOUND;case Ut.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Ut.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Ut.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Ut.ABORTED:return V.ABORTED;case Ut.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Ut.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Ut.DATA_LOSS:return V.DATA_LOSS;default:return ee(39323,{code:n})}}(Me=Ut||(Ut={}))[Me.OK=0]="OK",Me[Me.CANCELLED=1]="CANCELLED",Me[Me.UNKNOWN=2]="UNKNOWN",Me[Me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Me[Me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Me[Me.NOT_FOUND=5]="NOT_FOUND",Me[Me.ALREADY_EXISTS=6]="ALREADY_EXISTS",Me[Me.PERMISSION_DENIED=7]="PERMISSION_DENIED",Me[Me.UNAUTHENTICATED=16]="UNAUTHENTICATED",Me[Me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Me[Me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Me[Me.ABORTED=10]="ABORTED",Me[Me.OUT_OF_RANGE=11]="OUT_OF_RANGE",Me[Me.UNIMPLEMENTED=12]="UNIMPLEMENTED",Me[Me.INTERNAL=13]="INTERNAL",Me[Me.UNAVAILABLE=14]="UNAVAILABLE",Me[Me.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $3=new Pi([4294967295,4294967295],0);function zx(n){const e=MN().encode(n),t=new xR;return t.update(e),new Uint8Array(t.digest())}function qx(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Pi([t,r],0),new Pi([s,i],0)]}class mw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Wc(`Invalid padding: ${t}`);if(r<0)throw new Wc(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Wc(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Wc(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Pi.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Pi.fromNumber(r)));return s.compare($3)===1&&(s=new Pi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=zx(e),[r,s]=qx(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new mw(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=zx(e),[r,s]=qx(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Wc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Ud.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new jd(ae.min(),s,new ot(me),zn(),ve())}}class Ud{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ud(r,t,ve(),ve(),ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class VN{constructor(e,t){this.targetId=e,this.Ce=t}}class LN{constructor(e,t,r=kt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Wx{constructor(){this.ve=0,this.Fe=Gx(),this.Me=kt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ve(),t=ve(),r=ve();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ee(38017,{changeType:i})}}),new Ud(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Gx()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,se(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class z3{constructor(e){this.Ge=e,this.ze=new Map,this.je=zn(),this.Je=Vh(),this.He=Vh(),this.Ye=new ot(me)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ee(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(gp(i))if(r===0){const o=new Q(i.path);this.et(t,o,ct.newNoDocument(o,ae.min()))}else se(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}gu==null||gu.lt(function(h,f,p,_,T){var C,x,R;const b={localCacheCount:h,existenceFilterCount:f.count,databaseId:p.database,projectId:p.projectId},k=f.unchangedNames;return k&&(b.bloomFilter={applied:T===0,hashCount:(k==null?void 0:k.hashCount)??0,bitmapLength:((x=(C=k==null?void 0:k.bits)==null?void 0:C.bitmap)==null?void 0:x.length)??0,padding:((R=k==null?void 0:k.bits)==null?void 0:R.padding)??0,mightContain:P=>(_==null?void 0:_.mightContain(P))??!1}),b}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Vs(r).toUint8Array()}catch(l){if(l instanceof ZR)return br("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new mw(o,s,i)}catch(l){return br(l instanceof Wc?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&gp(a.target)){const l=new Q(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,ct.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=ve();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new jd(e,t,this.Ye,this.je,r);return this.je=zn(),this.Je=Vh(),this.He=Vh(),this.Ye=new ot(me),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Wx,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ke(me),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ke(me),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||$("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Wx),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Vh(){return new ot(Q.comparator)}function Gx(){return new ot(Q.comparator)}const q3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),W3=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),G3=(()=>({and:"AND",or:"OR"}))();class H3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function X_(n,e){return n.useProto3Json||Dd(e)?e:{value:e}}function Ol(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function FN(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function K3(n,e){return Ol(n,e.toTimestamp())}function Ft(n){return se(!!n,49232),ae.fromTimestamp(function(t){const r=Ms(t);return new We(r.seconds,r.nanos)}(n))}function gw(n,e){return Z_(n,e).canonicalString()}function Z_(n,e){const t=function(s){return new Ae(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function jN(n){const e=Ae.fromString(n);return se(KN(e),10190,{key:e.toString()}),e}function id(n,e){return gw(n.databaseId,e.path)}function os(n,e){const t=jN(e);if(t.get(1)!==n.databaseId.projectId)throw new B(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Q($N(t))}function UN(n,e){return gw(n.databaseId,e)}function BN(n){const e=jN(n);return e.length===4?Ae.emptyPath():$N(e)}function ev(n){return new Ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $N(n){return se(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Hx(n,e,t){return{name:id(n,e),fields:t.value.mapValue.fields}}function Rm(n,e,t){const r=os(n,e.name),s=Ft(e.updateTime),i=e.createTime?Ft(e.createTime):ae.min(),o=new un({mapValue:{fields:e.fields}}),a=ct.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Q3(n,e){return"found"in e?function(r,s){se(!!s.found,43571),s.found.name,s.found.updateTime;const i=os(r,s.found.name),o=Ft(s.found.updateTime),a=s.found.createTime?Ft(s.found.createTime):ae.min(),l=new un({mapValue:{fields:s.found.fields}});return ct.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){se(!!s.missing,3894),se(!!s.readTime,22933);const i=os(r,s.missing),o=Ft(s.readTime);return ct.newNoDocument(i,o)}(n,e):ee(7234,{result:e})}function Y3(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ee(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(se(h===void 0||typeof h=="string",58123),kt.fromBase64String(h||"")):(se(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),kt.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?V.UNKNOWN:ON(u.code);return new B(h,u.message||"")}(o);t=new LN(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=os(n,r.document.name),i=Ft(r.document.updateTime),o=r.document.createTime?Ft(r.document.createTime):ae.min(),a=new un({mapValue:{fields:r.document.fields}}),l=ct.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new mf(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=os(n,r.document),i=r.readTime?Ft(r.readTime):ae.min(),o=ct.newNoDocument(s,i),a=r.removedTargetIds||[];t=new mf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=os(n,r.document),i=r.removedTargetIds||[];t=new mf([],i,s,null)}else{if(!("filter"in e))return ee(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new B3(s,i),a=r.targetId;t=new VN(a,o)}}return t}function od(n,e){let t;if(e instanceof Jl)t={update:Hx(n,e.key,e.value)};else if(e instanceof Xl)t={delete:id(n,e.key)};else if(e instanceof qs)t={update:Hx(n,e.key,e.data),updateMask:nU(e.fieldMask)};else{if(!(e instanceof dw))return ee(16599,{Vt:e.type});t={verify:id(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof kl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ho)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ko)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Dl)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ee(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:K3(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ee(27497)}(n,e.precondition)),t}function tv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?_t.updateTime(Ft(i.updateTime)):i.exists!==void 0?_t.exists(i.exists):_t.none()}(e.currentDocument):_t.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)se(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new kl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Ho(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Ko(h)}else"increment"in a?l=new Dl(o,a.increment):ee(16584,{proto:a});const u=yt.fromServerFormat(a.fieldPath);return new Fd(u,l)}(n,s)):[];if(e.update){e.update.name;const s=os(n,e.update.name),i=new un({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new $n(u.map(h=>yt.fromServerFormat(h)))}(e.updateMask);return new qs(s,i,o,t,r)}return new Jl(s,i,t,r)}if(e.delete){const s=os(n,e.delete);return new Xl(s,t)}if(e.verify){const s=os(n,e.verify);return new dw(s,t)}return ee(1463,{proto:e})}function J3(n,e){return n&&n.length>0?(se(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?Ft(s.updateTime):Ft(i);return o.isEqual(ae.min())&&(o=Ft(i)),new F3(o,s.transformResults||[])}(t,e))):[]}function zN(n,e){return{documents:[UN(n,e.path)]}}function Nm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=UN(n,s);const i=function(u){if(u.length!==0)return HN(Ge.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:oi(p.field),direction:Z3(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=X_(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function qN(n,e,t,r){const{ft:s,parent:i}=Nm(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:oi(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:oi(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function WN(n){let e=BN(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){se(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const p=GN(f);return p instanceof Ge&&aw(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(T){return new sd(Oa(T.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,Dd(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(f){const p=!!f.before,_=f.values||[];return new qi(_,p)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const p=!f.before,_=f.values||[];return new qi(_,p)}(t.endAt)),mN(e,s,o,i,a,"F",l,u)}function X3(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ee(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function GN(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Oa(t.unaryFilter.field);return Pe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Oa(t.unaryFilter.field);return Pe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Oa(t.unaryFilter.field);return Pe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Oa(t.unaryFilter.field);return Pe.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ee(61313);default:return ee(60726)}}(n):n.fieldFilter!==void 0?function(t){return Pe.create(Oa(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ee(58110);default:return ee(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ge.create(t.compositeFilter.filters.map(r=>GN(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ee(1026)}}(t.compositeFilter.op))}(n):ee(30097,{filter:n})}function Z3(n){return q3[n]}function eU(n){return W3[n]}function tU(n){return G3[n]}function oi(n){return{fieldPath:n.canonicalString()}}function Oa(n){return yt.fromServerFormat(n.fieldPath)}function HN(n){return n instanceof Pe?function(t){if(t.op==="=="){if(Px(t.value))return{unaryFilter:{field:oi(t.field),op:"IS_NAN"}};if(Nx(t.value))return{unaryFilter:{field:oi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Px(t.value))return{unaryFilter:{field:oi(t.field),op:"IS_NOT_NAN"}};if(Nx(t.value))return{unaryFilter:{field:oi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oi(t.field),op:eU(t.op),value:t.value}}}(n):n instanceof Ge?function(t){const r=t.getFilters().map(s=>HN(s));return r.length===1?r[0]:{compositeFilter:{op:tU(t.op),filters:r}}}(n):ee(54877,{filter:n})}function nU(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function KN(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e,t,r,s,i=ae.min(),o=ae.min(),a=kt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new xs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new xs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new xs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new xs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{constructor(e){this.yt=e}}function rU(n,e){let t;if(e.document)t=Rm(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Q.fromSegments(e.noDocument.path),s=Yo(e.noDocument.readTime);t=ct.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ee(56709);{const r=Q.fromSegments(e.unknownDocument.path),s=Yo(e.unknownDocument.version);t=ct.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new We(s[0],s[1]);return ae.fromTimestamp(i)}(e.readTime)),t}function Kx(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:vp(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:id(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ol(i,o.version.toTimestamp()),createTime:Ol(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Qo(e.version)};else{if(!e.isUnknownDocument())return ee(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Qo(e.version)}}return r}function vp(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Qo(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Yo(n){const e=new We(n.seconds,n.nanoseconds);return ae.fromTimestamp(e)}function yo(n,e){const t=(e.baseMutations||[]).map(i=>tv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>tv(n.yt,i)),s=We.fromMillis(e.localWriteTimeMs);return new hw(e.batchId,s,t,r)}function Gc(n){const e=Yo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Yo(n.lastLimboFreeSnapshotVersion):ae.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return se(o===1,1966,{count:o}),xn(Yl(BN(i.documents[0])))}(n.query):function(i){return xn(WN(i))}(n.query),new xs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,kt.fromBase64String(n.resumeToken))}function YN(n,e){const t=Qo(e.snapshotVersion),r=Qo(e.lastLimboFreeSnapshotVersion);let s;s=gp(e.target)?zN(n.yt,e.target):Nm(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Go(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Pm(n){const e=WN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_p(e,e.limit,"L"):e}function ty(n,e){return new pw(e.largestBatchId,tv(n.yt,e.overlayMutation))}function Qx(n,e){const t=e.path.lastSegment();return[n,Tn(e.path.popLast()),t]}function Yx(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Qo(r.readTime),documentKey:Tn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU{getBundleMetadata(e,t){return Jx(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Yo(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Jx(e).put(function(s){return{bundleId:s.id,createTime:Qo(Ft(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Xx(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Pm(i.bundledQuery),readTime:Yo(i.readTime)}}(r)})}saveNamedQuery(e,t){return Xx(e).put(function(s){return{name:s.name,readTime:Qo(Ft(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Jx(n){return Kt(n,Im)}function Xx(n){return Kt(n,Em)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new km(e,r)}getOverlay(e,t){return Nc(e).get(Qx(this.userId,t)).next(r=>r?ty(this.serializer,r):null)}getOverlays(e,t){const r=es();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new pw(t,o);s.push(this.St(e,a))}),M.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Tn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Nc(e).Z(q_,a))}),M.waitFor(i)}getOverlaysForCollection(e,t,r){const s=es(),i=Tn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Nc(e).J(q_,o).next(a=>{for(const l of a){const u=ty(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=es();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Nc(e).ee({index:GR,range:a},(l,u,h)=>{const f=ty(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return Nc(e).put(function(s,i,o){const[a,l,u]=Qx(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:od(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function Nc(n){return Kt(n,Tm)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{bt(e){return Kt(e,rw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?kt.fromUint8Array(r):kt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ft(e.integerValue));else if("doubleValue"in e){const r=ft(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Yu(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ms(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Vs(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?iN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):bm(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ee(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=Rl,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(ft(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),Q.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}_o.Kt=new _o;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ca=255;function oU(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Zx(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=oU(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class aU{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=Zx(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=Zx(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(Ca),this.sn(255)}_n(){this.an(Ca),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Ca?(this.sn(Ca),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Ca?(this.an(Ca),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class lU{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class cU{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Pc{constructor(){this.cn=new aU,this.ln=new lU(this.cn),this.hn=new cU(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new vo(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:gf(this.En),directionalValue:gf(this.dn),orderedDocumentKey:gf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Xs(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=eS(n.En,e.En),t!==0?t:(t=eS(n.dn,e.dn),t!==0?t:Q.comparator(n.In,e.In)))}function eS(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function gf(n){return KA()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function tS(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class nS{constructor(e){this.mn=new Ke((t,r)=>yt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(se(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=B_(e);if(t!==void 0&&!this.wn(t))return!1;const r=po(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Ke(yt.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new No(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new No(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new No(r.field,r.dir==="asc"?0:1)));return new Tl(Tl.UNKNOWN_ID,this.collectionId,t,xl.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JN(n){var t,r;if(se(n instanceof Pe||n instanceof Ge,20012),n instanceof Pe){if(n instanceof pN){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>Pe.create(n.field,"==",i)))||[];return Ge.create(s,"or")}return n}const e=n.filters.map(s=>JN(s));return Ge.create(e,n.op)}function uU(n){if(n.getFilters().length===0)return[];const e=sv(JN(n));return se(XN(e),7391),nv(e)||rv(e)?[e]:e.getFilters()}function nv(n){return n instanceof Pe}function rv(n){return n instanceof Ge&&aw(n)}function XN(n){return nv(n)||rv(n)||function(t){if(t instanceof Ge&&K_(t)){for(const r of t.getFilters())if(!nv(r)&&!rv(r))return!1;return!0}return!1}(n)}function sv(n){if(se(n instanceof Pe||n instanceof Ge,34018),n instanceof Pe)return n;if(n.filters.length===1)return sv(n.filters[0]);const e=n.filters.map(r=>sv(r));let t=Ge.create(e,n.op);return t=wp(t),XN(t)?t:(se(t instanceof Ge,64498),se(Pl(t),40251),se(t.filters.length>1,57927),t.filters.reduce((r,s)=>yw(r,s)))}function yw(n,e){let t;return se(n instanceof Pe||n instanceof Ge,38388),se(e instanceof Pe||e instanceof Ge,25473),t=n instanceof Pe?e instanceof Pe?function(s,i){return Ge.create([s,i],"and")}(n,e):rS(n,e):e instanceof Pe?rS(e,n):function(s,i){if(se(s.filters.length>0&&i.filters.length>0,48005),Pl(s)&&Pl(i))return dN(s,i.getFilters());const o=K_(s)?s:i,a=K_(s)?i:s,l=o.filters.map(u=>yw(u,a));return Ge.create(l,"or")}(n,e),wp(t)}function rS(n,e){if(Pl(e))return dN(e,n.getFilters());{const t=e.filters.map(r=>yw(n,r));return Ge.create(t,"or")}}function wp(n){if(se(n instanceof Pe||n instanceof Ge,11850),n instanceof Pe)return n;const e=n.getFilters();if(e.length===1)return wp(e[0]);if(cN(n))return n;const t=e.map(s=>wp(s)),r=[];return t.forEach(s=>{s instanceof Pe?r.push(s):s instanceof Ge&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ge.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dU{constructor(){this.Cn=new _w}addToCollectionParentIndex(e,t){return this.Cn.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(hr.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(hr.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class _w{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Ke(Ae.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Ke(Ae.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sS="IndexedDbIndexManager",Lh=new Uint8Array(0);class hU{constructor(e,t){this.databaseId=t,this.vn=new _w,this.Fn=new zs(r=>Go(r),(r,s)=>Md(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:Tn(s)};return iS(e).put(i)}return M.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[kR(t),""],!1,!0);return iS(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Zr(o.parent))}return r})}addFieldIndex(e,t){const r=kc(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Na(e);return i.next(a=>{o.put(Yx(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=kc(e),s=Na(e),i=Ra(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=kc(e),r=Ra(e),s=Na(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return M.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new nS(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ra(e);let s=!0;const i=new Map;return M.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=ve();const a=[];return M.forEach(i,(l,u)=>{$(sS,`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(l)} to execute ${Go(t)}`);const h=function(R,P){const U=B_(P);if(U===void 0)return null;for(const F of yp(R,U.fieldPath))switch(F.op){case"array-contains-any":return F.value.arrayValue.values||[];case"array-contains":return[F.value]}return null}(u,l),f=function(R,P){const U=new Map;for(const F of po(P))for(const A of yp(R,F.fieldPath))switch(A.op){case"==":case"in":U.set(F.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return U.set(F.fieldPath.canonicalString(),A.value),Array.from(U.values())}return null}(u,l),p=function(R,P){const U=[];let F=!0;for(const A of po(P)){const w=A.kind===0?Vx(R,A.fieldPath,R.startAt):Lx(R,A.fieldPath,R.startAt);U.push(w.value),F&&(F=w.inclusive)}return new qi(U,F)}(u,l),_=function(R,P){const U=[];let F=!0;for(const A of po(P)){const w=A.kind===0?Lx(R,A.fieldPath,R.endAt):Vx(R,A.fieldPath,R.endAt);U.push(w.value),F&&(F=w.inclusive)}return new qi(U,F)}(u,l),T=this.On(l,u,p),b=this.On(l,u,_),k=this.Nn(l,u,f),C=this.Bn(l.indexId,h,T,p.inclusive,b,_.inclusive,k);return M.forEach(C,x=>r.Y(x,t.limit).next(R=>{R.forEach(P=>{const U=Q.fromSegments(P.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}return M.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=uU(Ge.create(e.filters,"and")).map(r=>Y_(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const p=t?this.Ln(t[f/u]):Lh,_=this.kn(e,p,r[f%u],s),T=this.qn(e,p,i[f%u],o),b=a.map(k=>this.kn(e,p,k,!0));h.push(...this.createRange(_,T,b))}return h}kn(e,t,r,s){const i=new vo(e,Q.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new vo(e,Q.empty(),t,r);return s?i.An():i}xn(e,t){const r=new nS(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return M.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new Ke(yt.comparator),h=!1;for(const f of l.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:u=u.add(p.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new Pc;for(const s of po(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);_o.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new Pc;return _o.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new Pc;return _o.Kt.Dt(Wo(this.databaseId,t),r.Pn(function(i){const o=po(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new Pc);let i=0;for(const o of po(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&rd(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);_o.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Pc;l.seed(a.un()),_o.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof Pe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=kc(e),s=Na(e);return(t?r.J(z_,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return M.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const p=f?new xl(f.sequenceNumber,new hr(Yo(f.readTime),new Q(Zr(f.documentKey)),f.largestBatchId)):xl.empty(),_=h.fields.map(([T,b])=>new No(yt.fromServerFormat(T),b));return new Tl(h.indexId,h.collectionGroup,_,p)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:me(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=kc(e),i=Na(e);return this.Gn(e).next(o=>s.J(z_,IDBKeyRange.bound(t,t)).next(a=>M.forEach(a,l=>i.put(Yx(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return M.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?M.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),M.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?M.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return Ra(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return Ra(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=Ra(e);let i=new Ke(Xs);return s.ee({index:WR,range:IDBKeyRange.only([r.indexId,this.uid,gf(this.$n(r,t))])},(o,a)=>{i=i.add(new vo(r.indexId,t,tS(a.arrayValue),tS(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new Ke(Xs);const s=this.Qn(t,e);if(s==null)return r;const i=B_(t);if(i!=null){const o=e.data.field(i.fieldPath);if(rd(o))for(const a of o.arrayValue.values||[])r=r.add(new vo(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new vo(t.indexId,e.key,Lh,s));return r}Jn(e,t,r,s,i){$(sS,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,p){const _=l.getIterator(),T=u.getIterator();let b=Aa(_),k=Aa(T);for(;b||k;){let C=!1,x=!1;if(b&&k){const R=h(b,k);R<0?x=!0:R>0&&(C=!0)}else b!=null?x=!0:C=!0;C?(f(k),k=Aa(T)):x?(p(b),b=Aa(_)):(b=Aa(_),k=Aa(T))}}(s,i,Xs,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),M.waitFor(o)}Gn(e){let t=1;return Na(e).ee({index:qR,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Xs(o,a)).filter((o,a,l)=>!a||Xs(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Xs(o,e),l=Xs(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,Lh,Q.empty()),l=s[o+1].Vn(this.uid,Lh,Q.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return Xs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(oS)}getMinOffset(e,t){return M.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||ee(44426))).next(oS)}}function iS(n){return Kt(n,Zu)}function Ra(n){return Kt(n,hu)}function kc(n){return Kt(n,nw)}function Na(n){return Kt(n,du)}function oS(n){se(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Z0(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new hr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ZN=41943040;class wn{static withCacheSize(e){return new wn(e,wn.DEFAULT_COLLECTION_PERCENTILE,wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eP(n,e,t){const r=n.store(kr),s=n.store(Sl),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,p)=>(a++,p.delete()));i.push(l.next(()=>{se(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=BR(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return M.waitFor(i).next(()=>u)}function Ip(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ee(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */wn.DEFAULT_COLLECTION_PERCENTILE=10,wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wn.DEFAULT=new wn(ZN,wn.DEFAULT_COLLECTION_PERCENTILE,wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wn.DISABLED=new wn(-1,0,0);class Dm{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){se(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Dm(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Zs(e).ee({index:xo,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ma(e),o=Zs(e);return o.add({}).next(a=>{se(typeof a=="number",49019);const l=new hw(a,t,r,s),u=function(_,T,b){const k=b.baseMutations.map(x=>od(_.yt,x)),C=b.mutations.map(x=>od(_.yt,x));return{userId:T,batchId:b.batchId,localWriteTimeMs:b.localWriteTime.toMillis(),baseMutations:k,mutations:C}}(this.serializer,this.userId,l),h=[];let f=new Ke((p,_)=>me(p.canonicalString(),_.canonicalString()));for(const p of s){const _=BR(this.userId,p.key.path,a);f=f.add(p.key.path.popLast()),h.push(o.put(u)),h.push(i.put(_,K4))}return f.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),M.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return Zs(e).get(t).next(r=>r?(se(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),yo(this.serializer,r)):null)}er(e,t){return this.Xn[t]?M.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Zs(e).ee({index:xo,range:s},(o,a,l)=>{a.userId===this.userId&&(se(a.batchId>=r,47524,{tr:r}),i=yo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=ki;return Zs(e).ee({index:xo,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,ki],[this.userId,Number.POSITIVE_INFINITY]);return Zs(e).J(xo,t).next(r=>r.map(s=>yo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=cf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ma(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,p=Zr(h);if(u===this.userId&&t.path.isEqual(p))return Zs(e).get(f).next(_=>{if(!_)throw ee(61480,{nr:o,batchId:f});se(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:f}),i.push(yo(this.serializer,_))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ke(me);const s=[];return t.forEach(i=>{const o=cf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ma(e).ee({range:a},(u,h,f)=>{const[p,_,T]=u,b=Zr(_);p===this.userId&&i.path.isEqual(b)?r=r.add(T):f.done()});s.push(l)}),M.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=cf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Ke(me);return Ma(e).ee({range:o},(l,u,h)=>{const[f,p,_]=l,T=Zr(p);f===this.userId&&r.isPrefixOf(T)?T.length===s&&(a=a.add(_)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Zs(e).get(i).next(o=>{if(o===null)throw ee(35274,{batchId:i});se(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(yo(this.serializer,o))}))}),M.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return eP(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),M.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return M.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ma(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Zr(i[1]);s.push(l)}else a.done()}).next(()=>{se(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return tP(e,this.userId,t)}_r(e){return nP(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ki,lastStreamToken:""})}}function tP(n,e,t){const r=cf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ma(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,p]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function Zs(n){return Kt(n,kr)}function Ma(n){return Kt(n,Sl)}function nP(n){return Kt(n,Ju)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Jo(0)}static cr(){return new Jo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fU{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Jo(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>ae.fromTimestamp(new We(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Pa(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(se(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Pa(e).ee((o,a)=>{const l=Gc(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>M.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Pa(e).ee((r,s)=>{const i=Gc(s);t(i)})}lr(e){return lS(e).get(mp).next(t=>(se(t!==null,2888),t))}hr(e,t){return lS(e).put(mp,t)}Pr(e,t){return Pa(e).put(YN(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Go(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Pa(e).ee({range:s,index:zR},(o,a,l)=>{const u=Gc(a);Md(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ai(e);return t.forEach(o=>{const a=Tn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),M.waitFor(s)}removeMatchingKeys(e,t,r){const s=ai(e);return M.forEach(t,i=>{const o=Tn(i.path);return M.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ai(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ai(e);let i=ve();return s.ee({range:r,X:!0},(o,a,l)=>{const u=Zr(o[1]),h=new Q(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Tn(t.path),s=IDBKeyRange.bound([r],[kR(r)],!1,!0);let i=0;return ai(e).ee({index:tw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return Pa(e).get(t).next(r=>r?Gc(r):null)}}function Pa(n){return Kt(n,bl)}function lS(n){return Kt(n,Po)}function ai(n){return Kt(n,Al)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cS="LruGarbageCollector",rP=1048576;function uS([n,e],[t,r]){const s=me(n,t);return s===0?me(e,r):s}class pU{constructor(e){this.Ir=e,this.buffer=new Ke(uS),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();uS(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sP{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){$(cS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Zi(t)?$(cS,"Ignoring IndexedDB error during garbage collection: ",t):await Xi(t)}await this.Vr(3e5)})}}class mU{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return M.resolve(Bn.ce);const r=new pU(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?($("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(aS)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?($("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aS):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?($("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),ka()<=Ce.DEBUG&&$("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function iP(n,e){return new mU(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(e,t){this.db=e,this.garbageCollector=iP(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Fh(e,r)}removeReference(e,t,r){return Fh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Fh(e,t)}br(e,t){return function(s,i){let o=!1;return nP(s).te(a=>tP(s,a,i).next(l=>(l&&(o=!0),M.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ae.min()),ai(e).delete(function(f){return[0,Tn(f.path)]}(o))))});s.push(l)}}).next(()=>M.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Fh(e,t)}Sr(e,t){const r=ai(e);let s,i=Bn.ce;return r.ee({index:tw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Bn.ce&&t(new Q(Zr(s)),i),i=u,s=l):i=Bn.ce}).next(()=>{i!==Bn.ce&&t(new Q(Zr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Fh(n,e){return ai(n).put(function(r,s){return{targetId:0,path:Tn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(){this.changes=new zs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ct.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yU{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return lo(e).put(r)}removeEntry(e,t,r){return lo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],vp(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=ct.newInvalidDocument(t);return lo(e).ee({index:uf,range:IDBKeyRange.only(Dc(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:ct.newInvalidDocument(t)};return lo(e).ee({index:uf,range:IDBKeyRange.only(Dc(t))},(s,i)=>{r={document:this.Cr(t,i),size:Ip(i)}}).next(()=>r)}getEntries(e,t){let r=zn();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=zn(),s=new ot(Q.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,Ip(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return M.resolve();let s=new Ke(fS);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Dc(s.first()),Dc(s.last())),o=s.getIterator();let a=o.getNext();return lo(e).ee({index:uf,range:i},(l,u,h)=>{const f=Q.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&fS(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(Dc(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),vp(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return lo(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=zn();for(const f of u){const p=this.Cr(Q.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(Ld(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=zn();const o=hS(t,r),a=hS(t,hr.max());return lo(e).ee({index:$R,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(Q.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new _U(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return dS(e).get($_).next(t=>(se(!!t,20021),t))}Dr(e,t){return dS(e).put($_,t)}Cr(e,t){if(t){const r=rU(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ae.min())))return r}return ct.newInvalidDocument(e)}}function aP(n){return new yU(n)}class _U extends oP{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new zs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Ke((i,o)=>me(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Kx(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=Ip(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Kx(this.Nr.serializer,o.convertToNoDocument(ae.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),M.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function dS(n){return Kt(n,Xu)}function lo(n){return Kt(n,pp)}function Dc(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function hS(n,e){const t=e.documentKey.path.toArray();return[n,vp(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function fS(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=me(t[i],r[i]),s)return s;return s=me(t.length,r.length),s||(s=me(t[t.length-2],r[r.length-2]),s||me(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&mu(r.mutation,s,$n.empty(),We.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ve()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ve()){const s=es();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=qc();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=es();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ve()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=zn();const o=pu(),a=function(){return pu()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof qs)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),mu(h.mutation,u,h.mutation.getFieldMask(),We.now())):o.set(u.key,$n.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new vU(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=pu();let s=new ot((o,a)=>o-a),i=ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||$n.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||ve()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=TN();h.forEach(p=>{if(!i.has(p)){const _=NN(t.get(p),r.get(p));_!==null&&f.set(p,_),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return M.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Q.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):lw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):M.resolve(es());let a=El,l=i;return o.next(u=>M.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?M.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,ve())).next(h=>({batchId:a,changes:EN(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Q(t)).next(r=>{let s=qc();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=qc();return this.indexManager.getCollectionParents(e,i).next(a=>M.forEach(a,l=>{const u=function(f,p){return new $s(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,ct.newInvalidDocument(h)))});let a=qc();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&mu(h.mutation,u,$n.empty(),We.now()),Ld(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wU{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return M.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ft(s.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:Pm(s.bundledQuery),readTime:Ft(s.readTime)}}(t)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IU{constructor(){this.overlays=new ot(Q.comparator),this.qr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const r=es();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),M.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){const s=es(),i=t.length+1,o=new Q(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return M.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ot((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=es(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=es(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return M.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new pw(t,r));let i=this.qr.get(t);i===void 0&&(i=ve(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EU{constructor(){this.sessionToken=kt.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(){this.Qr=new Ke(Jt.$r),this.Ur=new Ke(Jt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Jt(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Jt(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new Q(new Ae([])),r=new Jt(t,e),s=new Jt(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Q(new Ae([])),r=new Jt(t,e),s=new Jt(t,e+1);let i=ve();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Jt(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Jt{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Q.comparator(e.key,t.key)||me(e.Yr,t.Yr)}static Kr(e,t){return me(e.Yr,t.Yr)||Q.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ke(Jt.$r)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new hw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Jt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return M.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?ki:this.tr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Jt(t,0),s=new Jt(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),M.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ke(me);return t.forEach(s=>{const i=new Jt(s,0),o=new Jt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),M.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Q.isDocumentKey(i)||(i=i.child(""));const o=new Jt(new Q(i),0);let a=new Ke(me);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),M.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){se(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return M.forEach(t.mutations,s=>{const i=new Jt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new Jt(t,0),s=this.Zr.firstAfterOrEqual(r);return M.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xU{constructor(e){this.ri=e,this.docs=function(){return new ot(Q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():ct.newInvalidDocument(t))}getEntries(e,t){let r=zn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ct.newInvalidDocument(s))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=zn();const o=t.path,a=new Q(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Z0(VR(h),r)<=0||(s.has(h.key)||Ld(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return M.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ee(9500)}ii(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new SU(this)}getSize(e){return M.resolve(this.size)}}class SU extends oP{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(e){this.persistence=e,this.si=new zs(t=>Go(t),Md),this.lastRemoteSnapshotVersion=ae.min(),this.highestTargetId=0,this.oi=0,this._i=new vw,this.targetCount=0,this.ai=Jo.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),M.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Jo(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Pr(t),M.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),M.waitFor(i).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),M.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{constructor(e,t){this.ui={},this.overlays={},this.ci=new Bn(0),this.li=!1,this.li=!0,this.hi=new EU,this.referenceDelegate=e(this),this.Pi=new bU(this),this.indexManager=new dU,this.remoteDocumentCache=function(s){return new xU(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new QN(t),this.Ii=new wU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new IU,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new TU(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){$("MemoryPersistence","Starting transaction:",e);const s=new AU(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return M.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class AU extends FR{constructor(e){super(),this.currentSequenceNumber=e}}class Om{constructor(e){this.persistence=e,this.Ri=new vw,this.Vi=null}static mi(e){return new Om(e)}get fi(){if(this.Vi)return this.Vi;throw ee(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),M.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.fi,r=>{const s=Q.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,ae.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return M.or([()=>M.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ep{constructor(e,t){this.persistence=e,this.pi=new zs(r=>Tn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=iP(this,t)}static mi(e,t){return new Ep(e,t)}Ei(){}di(e){return M.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return M.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?M.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,ae.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),M.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),M.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=hf(e.data.value)),t}br(e,t,r){return M.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return M.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CU{constructor(e){this.serializer=e}k(e,t,r,s){const i=new wm("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(Od)}(e),function(l){l.createObjectStore(Ju,{keyPath:H4}),l.createObjectStore(kr,{keyPath:xx,autoIncrement:!0}).createIndex(xo,Sx,{unique:!0}),l.createObjectStore(Sl)}(e),pS(e),function(l){l.createObjectStore(mo)}(e));let o=M.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(Al),l.deleteObjectStore(bl),l.deleteObjectStore(Po)}(e),pS(e)),o=o.next(()=>function(l){const u=l.store(Po),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ae.min().toTimestamp(),targetCount:0};return u.put(mp,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(kr).J().next(f=>{l.deleteObjectStore(kr),l.createObjectStore(kr,{keyPath:xx,autoIncrement:!0}).createIndex(xo,Sx,{unique:!0});const p=u.store(kr),_=f.map(T=>p.put(T));return M.waitFor(_)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(Cl,{keyPath:n3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(Xu)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(Im,{keyPath:r3})})(e),function(l){l.createObjectStore(Em,{keyPath:s3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(Tm,{keyPath:d3});u.createIndex(q_,h3,{unique:!1}),u.createIndex(GR,f3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(pp,{keyPath:Q4});u.createIndex(uf,Y4),u.createIndex($R,J4)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(mo))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(nw,{keyPath:i3,autoIncrement:!0}).createIndex(z_,o3,{unique:!1}),l.createObjectStore(du,{keyPath:a3}).createIndex(qR,l3,{unique:!1}),l.createObjectStore(hu,{keyPath:c3}).createIndex(WR,u3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(du).clear()}).next(()=>{t.objectStore(hu).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(rw,{keyPath:p3})})(e)})),r<18&&s>=18&&KA()&&(o=o.next(()=>{t.objectStore(du).clear()}).next(()=>{t.objectStore(hu).clear()})),o}wi(e){let t=0;return e.store(mo).ee((r,s)=>{t+=Ip(s)}).next(()=>{const r={byteSize:t};return e.store(Xu).put($_,r)})}yi(e){const t=e.store(Ju),r=e.store(kr);return t.J().next(s=>M.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,ki],[i.userId,i.lastAcknowledgedBatchId]);return r.J(xo,o).next(a=>M.forEach(a,l=>{se(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=yo(this.serializer,l);return eP(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(Al),r=e.store(mo);return e.store(Po).get(mp).next(s=>{const i=[];return r.ee((o,a)=>{const l=new Ae(o),u=function(f){return[0,Tn(f)]}(l);i.push(t.get(u).next(h=>h?M.resolve():(f=>t.put({targetId:0,path:Tn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>M.waitFor(i))})}bi(e,t){e.createObjectStore(Zu,{keyPath:t3});const r=t.store(Zu),s=new _w,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Tn(l)})}};return t.store(mo).ee({X:!0},(o,a)=>{const l=new Ae(o);return i(l.popLast())}).next(()=>t.store(Sl).ee({X:!0},([o,a,l],u)=>{const h=Zr(a);return i(h.popLast())}))}Di(e){const t=e.store(bl);return t.ee((r,s)=>{const i=Gc(s),o=YN(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(mo),s=[];return r.ee((i,o)=>{const a=t.store(pp),l=function(f){return f.document?new Q(Ae.fromString(f.document.name).popFirst(5)):f.noDocument?Q.fromSegments(f.noDocument.path):f.unknownDocument?Q.fromSegments(f.unknownDocument.path):ee(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>M.waitFor(s))}Fi(e,t){const r=t.store(kr),s=aP(this.serializer),i=new ww(Om.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??ve();yo(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),M.forEach(a,(l,u)=>{const h=new Zt(u),f=km.wt(this.serializer,h),p=i.getIndexManager(h),_=Dm.wt(h,this.serializer,p,i.referenceDelegate);return new lP(s,_,f,p).recalculateAndSaveOverlaysForDocumentKeys(new W_(t,Bn.ce),l).next()})})}}function pS(n){n.createObjectStore(Al,{keyPath:Z4}).createIndex(tw,e3,{unique:!0}),n.createObjectStore(bl,{keyPath:"targetId"}).createIndex(zR,X4,{unique:!0}),n.createObjectStore(Po)}const ei="IndexedDbPersistence",ny=18e5,ry=5e3,sy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cP="main";class Iw{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!Iw.v())throw new B(V.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new gU(this,s),this.$i=t+cP,this.serializer=new QN(l),this.Ui=new is(this.$i,this.Ni,new CU(this.serializer)),this.hi=new iU,this.Pi=new fU(this.referenceDelegate,this.serializer),this.remoteDocumentCache=aP(this.serializer),this.Ii=new sU,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&Lt(ei,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(V.FAILED_PRECONDITION,sy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Bn(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>jh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(Zi(e))return $(ei,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return $(ei,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Oc(e).get(ba).next(t=>M.resolve(this.es(t)))}ts(e){return jh(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,ny)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Kt(t,Cl);return r.J().next(s=>{const i=this.ss(s,ny),o=s.filter(a=>i.indexOf(a)===-1);return M.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?M.resolve(!0):Oc(e).get(ba).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,ry)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new B(V.FAILED_PRECONDITION,sy);return!1}}return!(!this.networkEnabled||!this.inForeground)||jh(e).J().next(r=>this.ss(r,ry).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&$(ei,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Od,Cl],e=>{const t=new W_(e,Bn.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>jh(e).J().next(t=>this.ss(t,ny).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Dm.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hU(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return km.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){$(ei,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?y3:l===17?YR:l===16?g3:l===15?sw:l===14?QR:l===13?KR:l===12?m3:l===11?HR:void ee(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new W_(a,this.ci?this.ci.next():Bn.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw Lt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new B(V.FAILED_PRECONDITION,LR);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Oc(e).get(ba).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,ry)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new B(V.FAILED_PRECONDITION,sy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Oc(e).put(ba,t)}static v(){return is.v()}Zi(e){const t=Oc(e);return t.get(ba).next(r=>this.es(r)?($(ei,"Releasing primary lease."),t.delete(ba)):M.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Lt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;HA()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return $(ei,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Lt(ei,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Lt("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Oc(n){return Kt(n,Od)}function jh(n){return Kt(n,Cl)}function Ew(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=ve(),s=ve();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Tw(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return HA()?8:jR(Ht())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new RU;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(ka()<=Ce.DEBUG&&$("QueryEngine","SDK will not create cache indexes for query:",Da(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),M.resolve()):(ka()<=Ce.DEBUG&&$("QueryEngine","Query:",Da(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(ka()<=Ce.DEBUG&&$("QueryEngine","The SDK decides to create cache indexes for query:",Da(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xn(t))):M.resolve())}ys(e,t){if(Fx(t))return M.resolve(null);let r=xn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=_p(t,null,"F"),r=xn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ve(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,_p(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return Fx(t)||s.isEqual(ae.min())?M.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?M.resolve(null):(ka()<=Ce.DEBUG&&$("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Da(t)),this.vs(e,o,t,MR(s,El)).next(a=>a))})}Ds(e,t){let r=new Ke(wN(e));return t.forEach((s,i)=>{Ld(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return ka()<=Ce.DEBUG&&$("QueryEngine","Using full collection scan to execute query:",Da(t)),this.ps.getDocumentsMatchingQuery(e,t,hr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xw="LocalStore",NU=3e8;class PU{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new ot(me),this.xs=new zs(i=>Go(i),Md),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lP(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function dP(n,e,t,r){return new PU(n,e,t,r)}async function hP(n,e){const t=Y(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ve();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function kU(n,e){const t=Y(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,p=f.keys();let _=M.resolve();return p.forEach(T=>{_=_.next(()=>h.getEntry(l,T)).next(b=>{const k=u.docVersions.get(T);se(k!==null,48541),b.version.compareTo(k)<0&&(f.applyToRemoteDocument(b,u),b.isValidDocument()&&(b.setReadTime(u.commitVersion),h.addEntry(b)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ve();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function fP(n){const e=Y(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function DU(n,e){const t=Y(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const p=s.get(f);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let _=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(kt.EMPTY_BYTE_STRING,ae.min()).withLastLimboFreeSnapshotVersion(ae.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),s=s.insert(f,_),function(b,k,C){return b.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=NU?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(p,_,h)&&a.push(t.Pi.updateTargetData(i,_))});let l=zn(),u=ve();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(pP(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(ae.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return M.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function pP(n,e,t){let r=ve(),s=ve();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=zn();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(ae.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):$(xw,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function OU(n,e){const t=Y(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ki),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ml(n,e){const t=Y(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,M.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new xs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function Vl(n,e,t){const r=Y(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Zi(o))throw o;$(xw,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Tp(n,e,t){const r=Y(n);let s=ae.min(),i=ve();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=Y(l),p=f.xs.get(h);return p!==void 0?M.resolve(f.Ms.get(p)):f.Pi.getTargetData(u,h)}(r,o,xn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:ae.min(),t?i:ve())).next(a=>(yP(r,vN(e),a),{documents:a,Qs:i})))}function mP(n,e){const t=Y(n),r=Y(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function gP(n,e){const t=Y(n),r=t.Os.get(e)||ae.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,MR(r,El),Number.MAX_SAFE_INTEGER)).then(s=>(yP(t,e,s),s))}function yP(n,e,t){let r=n.Os.get(e)||ae.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function MU(n,e,t,r){const s=Y(n);let i=ve(),o=zn();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Ml(s,function(h){return xn(Yl(Ae.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>pP(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function VU(n,e,t=ve()){const r=await Ml(n,xn(Pm(e.bundledQuery))),s=Y(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Ft(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(kt.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P="firestore_clients";function mS(n,e){return`${_P}_${n}_${e}`}const vP="firestore_mutations";function gS(n,e,t){let r=`${vP}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const wP="firestore_targets";function iy(n,e){return`${wP}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qr="SharedClientState";class xp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new B(s.error.code,s.error.message))),o?new xp(e,t,s.state,i):(Lt(Qr,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class yu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new B(r.error.code,r.error.message))),i?new yu(e,r.state,s):(Lt(Qr,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Sp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=cw();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=UR(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Sp(e,i):(Lt(Qr,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Sw{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Sw(t.clientId,t.onlineState):(Lt(Qr,`Failed to parse online state: ${e}`),null)}}class iv{constructor(){this.activeTargetIds=cw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class oy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new ot(me),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=mS(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new iv),this.ro=new RegExp(`^${_P}_${o}_([^_]*)$`),this.io=new RegExp(`^${vP}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${wP}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(mS(this.persistenceKey,r));if(s){const i=Sp.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(iy(this.persistenceKey,e));if(s){const i=yu.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(iy(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return $(Qr,"READ",e,t),t}setItem(e,t){$(Qr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){$(Qr,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if($(Qr,"EVENT",t.key,t.newValue),t.key===this.eo)return void Lt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=Bn.ce;if(i!=null)try{const a=JSON.parse(i);se(typeof a=="number",30636,{So:i}),o=a}catch(a){Lt(Qr,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Bn.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new xp(this.currentUser,e,t,r),i=gS(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=gS(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=iy(this.persistenceKey,e),i=new yu(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return Sp.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return xp.Ws(new Zt(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return yu.Ws(s,t)}uo(e){return Sw.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);$(Qr,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=cw();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class IP{constructor(){this.Mo=new iv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new iv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LU{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yS="ConnectivityMonitor";class _S{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){$(yS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){$(yS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uh=null;function ov(){return Uh===null?Uh=function(){return 268435456+Math.round(2147483648*Math.random())}():Uh++,"0x"+Uh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ay="RestConnection",FU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jU{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===td?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=ov(),a=this.zo(e,t.toUriEncodedString());$(ay,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=Bs(u);return this.Jo(e,a,l,r,h).then(f=>($(ay,`Received RPC '${e}' ${o}: `,f),f),f=>{throw br(ay,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ql}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=FU[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UU{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vn="WebChannelConnection";class BU extends jU{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=ov();return new Promise((a,l)=>{const u=new SR;u.setWithCredentials(!0),u.listenOnce(bR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case lf.NO_ERROR:const f=u.getResponseJson();$(vn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case lf.TIMEOUT:$(vn,`RPC '${e}' ${o} timed out`),l(new B(V.DEADLINE_EXCEEDED,"Request time out"));break;case lf.HTTP_ERROR:const p=u.getStatus();if($(vn,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);const T=_==null?void 0:_.error;if(T&&T.status&&T.message){const b=function(C){const x=C.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(x)>=0?x:V.UNKNOWN}(T.status);l(new B(b,T.message))}else l(new B(V.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new B(V.UNAVAILABLE,"Connection failed."));break;default:ee(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{$(vn,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);$(vn,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=ov(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=RR(),a=CR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");$(vn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,_=!1;const T=new UU({Yo:k=>{_?$(vn,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(p||($(vn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),$(vn,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},Zo:()=>f.close()}),b=(k,C,x)=>{k.listen(C,R=>{try{x(R)}catch(P){setTimeout(()=>{throw P},0)}})};return b(f,zc.EventType.OPEN,()=>{_||($(vn,`RPC '${e}' stream ${s} transport opened.`),T.o_())}),b(f,zc.EventType.CLOSE,()=>{_||(_=!0,$(vn,`RPC '${e}' stream ${s} transport closed`),T.a_(),this.E_(f))}),b(f,zc.EventType.ERROR,k=>{_||(_=!0,br(vn,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),T.a_(new B(V.UNAVAILABLE,"The operation could not be completed")))}),b(f,zc.EventType.MESSAGE,k=>{var C;if(!_){const x=k.data[0];se(!!x,16349);const R=x,P=(R==null?void 0:R.error)||((C=R[0])==null?void 0:C.error);if(P){$(vn,`RPC '${e}' stream ${s} received error:`,P);const U=P.status;let F=function(E){const y=Ut[E];if(y!==void 0)return ON(y)}(U),A=P.message;F===void 0&&(F=V.INTERNAL,A="Unknown error status: "+U+" with message "+P.message),_=!0,T.a_(new B(F,A)),f.close()}else $(vn,`RPC '${e}' stream ${s} received:`,x),T.u_(x)}}),b(a,AR.STAT_EVENT,k=>{k.stat===L_.PROXY?$(vn,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===L_.NOPROXY&&$(vn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{T.__()},0),T}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EP(){return typeof window<"u"?window:null}function yf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(n){return new H3(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&$("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vS="PersistentStream";class TP{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new bw(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(Lt(t.toString()),Lt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new B(V.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return $(vS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():($(vS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $U extends TP{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Y3(this.serializer,e),r=function(i){if(!("targetChange"in i))return ae.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ae.min():o.readTime?Ft(o.readTime):ae.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=ev(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=gp(l)?{documents:zN(i,l)}:{query:Nm(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=FN(i,o.resumeToken);const u=X_(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ae.min())>0){a.readTime=Ol(i,o.snapshotVersion.toTimestamp());const u=X_(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=X3(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=ev(this.serializer),t.removeTarget=e,this.q_(t)}}class zU extends TP{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return se(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,se(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){se(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=J3(e.writeResults,e.commitTime),r=Ft(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=ev(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>od(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qU{}class WU extends qU{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new B(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Z_(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new B(V.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Z_(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new B(V.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class GU{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Lt(t),this.aa=!1):$("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="RemoteStore";class HU{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{to(this)&&($(Xo,"Restarting streams for network reachability change."),await async function(l){const u=Y(l);u.Ea.add(4),await Zl(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Bd(u)}(this))})}),this.Ra=new GU(r,s)}}async function Bd(n){if(to(n))for(const e of n.da)await e(!0)}async function Zl(n){for(const e of n.da)await e(!1)}function Mm(n,e){const t=Y(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Rw(t)?Cw(t):tc(t).O_()&&Aw(t,e))}function Ll(n,e){const t=Y(n),r=tc(t);t.Ia.delete(e),r.O_()&&xP(t,e),t.Ia.size===0&&(r.O_()?r.L_():to(t)&&t.Ra.set("Unknown"))}function Aw(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ae.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}tc(n).Y_(e)}function xP(n,e){n.Va.Ue(e),tc(n).Z_(e)}function Cw(n){n.Va=new z3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),tc(n).start(),n.Ra.ua()}function Rw(n){return to(n)&&!tc(n).x_()&&n.Ia.size>0}function to(n){return Y(n).Ea.size===0}function SP(n){n.Va=void 0}async function KU(n){n.Ra.set("Online")}async function QU(n){n.Ia.forEach((e,t)=>{Aw(n,e)})}async function YU(n,e){SP(n),Rw(n)?(n.Ra.ha(e),Cw(n)):n.Ra.set("Unknown")}async function JU(n,e,t){if(n.Ra.set("Online"),e instanceof LN&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){$(Xo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await bp(n,r)}else if(e instanceof mf?n.Va.Ze(e):e instanceof VN?n.Va.st(e):n.Va.tt(e),!t.isEqual(ae.min()))try{const r=await fP(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(kt.EMPTY_BYTE_STRING,h.snapshotVersion)),xP(i,l);const f=new xs(h.target,l,u,h.sequenceNumber);Aw(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){$(Xo,"Failed to raise snapshot:",r),await bp(n,r)}}async function bp(n,e,t){if(!Zi(e))throw e;n.Ea.add(1),await Zl(n),n.Ra.set("Offline"),t||(t=()=>fP(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{$(Xo,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Bd(n)})}function bP(n,e){return e().catch(t=>bp(n,t,e))}async function ec(n){const e=Y(n),t=Wi(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ki;for(;XU(e);)try{const s=await OU(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,ZU(e,s)}catch(s){await bp(e,s)}AP(e)&&CP(e)}function XU(n){return to(n)&&n.Ta.length<10}function ZU(n,e){n.Ta.push(e);const t=Wi(n);t.O_()&&t.X_&&t.ea(e.mutations)}function AP(n){return to(n)&&!Wi(n).x_()&&n.Ta.length>0}function CP(n){Wi(n).start()}async function e6(n){Wi(n).ra()}async function t6(n){const e=Wi(n);for(const t of n.Ta)e.ea(t.mutations)}async function n6(n,e,t){const r=n.Ta.shift(),s=fw.from(r,e,t);await bP(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await ec(n)}async function r6(n,e){e&&Wi(n).X_&&await async function(r,s){if(function(o){return DN(o)&&o!==V.ABORTED}(s.code)){const i=r.Ta.shift();Wi(r).B_(),await bP(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await ec(r)}}(n,e),AP(n)&&CP(n)}async function wS(n,e){const t=Y(n);t.asyncQueue.verifyOperationInProgress(),$(Xo,"RemoteStore received new credentials");const r=to(t);t.Ea.add(3),await Zl(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Bd(t)}async function av(n,e){const t=Y(n);e?(t.Ea.delete(2),await Bd(t)):e||(t.Ea.add(2),await Zl(t),t.Ra.set("Unknown"))}function tc(n){return n.ma||(n.ma=function(t,r,s){const i=Y(t);return i.sa(),new $U(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:KU.bind(null,n),t_:QU.bind(null,n),r_:YU.bind(null,n),H_:JU.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Rw(n)?Cw(n):n.Ra.set("Unknown")):(await n.ma.stop(),SP(n))})),n.ma}function Wi(n){return n.fa||(n.fa=function(t,r,s){const i=Y(t);return i.sa(),new zU(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:e6.bind(null,n),r_:r6.bind(null,n),ta:t6.bind(null,n),na:n6.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await ec(n)):(await n.fa.stop(),n.Ta.length>0&&($(Xo,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new nn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Nw(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function nc(n,e){if(Lt("AsyncQueue",`${e}: ${n}`),Zi(n))return new B(V.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{static emptySet(e){return new ko(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Q.comparator(t.key,r.key):(t,r)=>Q.comparator(t.key,r.key),this.keyedMap=qc(),this.sortedSet=new ot(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ko)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ko;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(){this.ga=new ot(Q.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ee(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Zo{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Zo(e,t,ko.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class i6{constructor(){this.queries=ES(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Y(t),i=s.queries;s.queries=ES(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new B(V.ABORTED,"Firestore shutting down"))}}function ES(){return new zs(n=>_N(n),Vd)}async function Pw(n,e){const t=Y(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new s6,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=nc(o,`Initialization of query '${Da(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Dw(t)}async function kw(n,e){const t=Y(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function o6(n,e){const t=Y(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&Dw(t)}function a6(n,e,t){const r=Y(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Dw(n){n.Ca.forEach(e=>{e.next()})}var lv,TS;(TS=lv||(lv={})).Ma="default",TS.Cache="cache";class Ow{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Zo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Zo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==lv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(e){this.serializer=e}$s(e){return os(this.serializer,e)}Us(e){return e.metadata.exists?Rm(this.serializer,e.document,!1):ct.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Ft(e)}}class Mw{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=NP(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=Ae.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new xS(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||ve()).add(i);t.set(o,a)}}return t}async ja(e){const t=await MU(e,new xS(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await VU(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function NP(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e){this.key=e}}class kP{constructor(e){this.key=e}}class DP{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ve(),this.mutatedKeys=ve(),this.eu=wN(e),this.tu=new ko(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new IS,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const p=s.get(h),_=Ld(this.query,f)?f:null,T=!!p&&this.mutatedKeys.has(p.key),b=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let k=!1;p&&_?p.data.isEqual(_.data)?T!==b&&(r.track({type:3,doc:_}),k=!0):this.su(p,_)||(r.track({type:2,doc:_}),k=!0,(l&&this.eu(_,l)>0||u&&this.eu(_,u)<0)&&(a=!0)):!p&&_?(r.track({type:0,doc:_}),k=!0):p&&!_&&(r.track({type:1,doc:p}),k=!0,(l||u)&&(a=!0)),k&&(_?(o=o.add(_),i=b?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(_,T){const b=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ee(20277,{Rt:k})}};return b(_)-b(T)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Zo(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new IS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ve(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new kP(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new PP(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=ve();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Zo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const no="SyncEngine";class l6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class c6{constructor(e){this.key=e,this.hu=!1}}class u6{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new zs(a=>_N(a),Vd),this.Iu=new Map,this.Eu=new Set,this.du=new ot(Q.comparator),this.Au=new Map,this.Ru=new vw,this.Vu={},this.mu=new Map,this.fu=Jo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function d6(n,e,t=!0){const r=Vm(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await OP(r,e,t,!0),s}async function h6(n,e){const t=Vm(n);await OP(t,e,!0,!1)}async function OP(n,e,t,r){const s=await Ml(n.localStore,xn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Vw(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Mm(n.remoteStore,s),a}async function Vw(n,e,t,r,s){n.pu=(f,p,_)=>async function(b,k,C,x){let R=k.view.ru(C);R.Cs&&(R=await Tp(b.localStore,k.query,!1).then(({documents:A})=>k.view.ru(A,R)));const P=x&&x.targetChanges.get(k.targetId),U=x&&x.targetMismatches.get(k.targetId)!=null,F=k.view.applyChanges(R,b.isPrimaryClient,P,U);return cv(b,k.targetId,F.au),F.snapshot}(n,f,p,_);const i=await Tp(n.localStore,e,!0),o=new DP(e,i.Qs),a=o.ru(i.documents),l=Ud.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);cv(n,t,u.au);const h=new l6(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function f6(n,e,t){const r=Y(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Vd(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Vl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Ll(r.remoteStore,s.targetId),Fl(r,s.targetId)}).catch(Xi)):(Fl(r,s.targetId),await Vl(r.localStore,s.targetId,!0))}async function p6(n,e){const t=Y(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ll(t.remoteStore,r.targetId))}async function m6(n,e,t){const r=Uw(n);try{const s=await function(o,a){const l=Y(o),u=We.now(),h=a.reduce((_,T)=>_.add(T.key),ve());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",_=>{let T=zn(),b=ve();return l.Ns.getEntries(_,h).next(k=>{T=k,T.forEach((C,x)=>{x.isValidDocument()||(b=b.add(C))})}).next(()=>l.localDocuments.getOverlayedDocuments(_,T)).next(k=>{f=k;const C=[];for(const x of a){const R=U3(x,f.get(x.key).overlayedDocument);R!=null&&C.push(new qs(x.key,R,aN(R.value.mapValue),_t.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,C,a)}).next(k=>{p=k;const C=k.applyToLocalDocumentSet(f,b);return l.documentOverlayCache.saveOverlays(_,k.batchId,C)})}).then(()=>({batchId:p.batchId,changes:EN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new ot(me)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Ws(r,s.changes),await ec(r.remoteStore)}catch(s){const i=nc(s,"Failed to persist write");t.reject(i)}}async function MP(n,e){const t=Y(n);try{const r=await DU(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(se(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?se(o.hu,14607):s.removedDocuments.size>0&&(se(o.hu,42227),o.hu=!1))}),await Ws(t,r,e)}catch(r){await Xi(r)}}function SS(n,e,t){const r=Y(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Y(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const p of f.Sa)p.va(a)&&(u=!0)}),u&&Dw(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function g6(n,e,t){const r=Y(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new ot(Q.comparator);o=o.insert(i,ct.newNoDocument(i,ae.min()));const a=ve().add(i),l=new jd(ae.min(),new Map,new ot(me),o,a);await MP(r,l),r.du=r.du.remove(i),r.Au.delete(e),jw(r)}else await Vl(r.localStore,e,!1).then(()=>Fl(r,e,t)).catch(Xi)}async function y6(n,e){const t=Y(n),r=e.batch.batchId;try{const s=await kU(t.localStore,e);Fw(t,r,null),Lw(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ws(t,s)}catch(s){await Xi(s)}}async function _6(n,e,t){const r=Y(n);try{const s=await function(o,a){const l=Y(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(se(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);Fw(r,e,t),Lw(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ws(r,s)}catch(s){await Xi(s)}}async function v6(n,e){const t=Y(n);to(t.remoteStore)||$(no,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Y(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===ki)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=nc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Lw(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Fw(n,e,t){const r=Y(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Fl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||VP(n,r)})}function VP(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Ll(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),jw(n))}function cv(n,e,t){for(const r of t)r instanceof PP?(n.Ru.addReference(r.key,e),w6(n,r)):r instanceof kP?($(no,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||VP(n,r.key)):ee(19791,{wu:r})}function w6(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||($(no,"New document in limbo: "+t),n.Eu.add(r),jw(n))}function jw(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Q(Ae.fromString(e)),r=n.fu.next();n.Au.set(r,new c6(t)),n.du=n.du.insert(t,r),Mm(n.remoteStore,new xs(xn(Yl(t.path)),r,"TargetPurposeLimboResolution",Bn.ce))}}async function Ws(n,e,t){const r=Y(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=Tw.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=Y(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>M.forEach(u,p=>M.forEach(p.Es,_=>h.persistence.referenceDelegate.addReference(f,p.targetId,_)).next(()=>M.forEach(p.ds,_=>h.persistence.referenceDelegate.removeReference(f,p.targetId,_)))))}catch(f){if(!Zi(f))throw f;$(xw,"Failed to update sequence numbers: "+f)}for(const f of u){const p=f.targetId;if(!f.fromCache){const _=h.Ms.get(p),T=_.snapshotVersion,b=_.withLastLimboFreeSnapshotVersion(T);h.Ms=h.Ms.insert(p,b)}}}(r.localStore,i))}async function I6(n,e){const t=Y(n);if(!t.currentUser.isEqual(e)){$(no,"User change. New user:",e.toKey());const r=await hP(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new B(V.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ws(t,r.Ls)}}function E6(n,e){const t=Y(n),r=t.Au.get(e);if(r&&r.hu)return ve().add(r.key);{let s=ve();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function T6(n,e){const t=Y(n),r=await Tp(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&cv(t,e.targetId,s.au),s}async function x6(n,e){const t=Y(n);return gP(t.localStore,e).then(r=>Ws(t,r))}async function S6(n,e,t,r){const s=Y(n),i=await function(a,l){const u=Y(a),h=Y(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(p=>p?u.localDocuments.getDocuments(f,p):M.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await ec(s.remoteStore):t==="acknowledged"||t==="rejected"?(Fw(s,e,r||null),Lw(s,e),function(a,l){Y(Y(a).mutationQueue).ir(l)}(s.localStore,e)):ee(6720,"Unknown batchState",{Su:t}),await Ws(s,i)):$(no,"Cannot apply mutation batch with id: "+e)}async function b6(n,e){const t=Y(n);if(Vm(t),Uw(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await bS(t,r.toArray());t.gu=!0,await av(t.remoteStore,!0);for(const i of s)Mm(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Fl(t,o),Vl(t.localStore,o,!0))),Ll(t.remoteStore,o)}),await s,await bS(t,r),function(o){const a=Y(o);a.Au.forEach((l,u)=>{Ll(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new ot(Q.comparator)}(t),t.gu=!1,await av(t.remoteStore,!1)}}async function bS(n,e,t){const r=Y(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Ml(r.localStore,xn(l[0]));for(const u of l){const h=r.Tu.get(u),f=await T6(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await mP(r.localStore,o);a=await Ml(r.localStore,u),await Vw(r,LP(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function LP(n){return mN(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function A6(n){return function(t){return Y(Y(t).persistence).Ts()}(Y(n).localStore)}async function C6(n,e,t,r){const s=Y(n);if(s.gu)return void $(no,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await gP(s.localStore,vN(i[0])),a=jd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",kt.EMPTY_BYTE_STRING);await Ws(s,o,a);break}case"rejected":await Vl(s.localStore,e,!0),Fl(s,e,r);break;default:ee(64155,t)}}async function R6(n,e,t){const r=Vm(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){$(no,"Adding an already active target "+s);continue}const i=await mP(r.localStore,s),o=await Ml(r.localStore,i);await Vw(r,LP(i),o.targetId,!1,o.resumeToken),Mm(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await Vl(r.localStore,s,!1).then(()=>{Ll(r.remoteStore,s),Fl(r,s)}).catch(Xi)}}function Vm(n){const e=Y(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=MP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=E6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=g6.bind(null,e),e.Pu.H_=o6.bind(null,e.eventManager),e.Pu.yu=a6.bind(null,e.eventManager),e}function Uw(n){const e=Y(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=y6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_6.bind(null,e),e}function N6(n,e,t){const r=Y(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(_,T){const b=Y(_),k=Ft(T.createTime);return b.persistence.runTransaction("hasNewerBundle","readonly",C=>b.Ii.getBundleMetadata(C,T.id)).then(C=>!!C&&C.createTime.compareTo(k)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(NP(l));const u=new Mw(l,o.serializer);let h=await o.bu();for(;h;){const p=await u.Ga(h);p&&a._updateProgress(p),h=await o.bu()}const f=await u.ja(i.localStore);return await Ws(i,f.Ha,void 0),await function(_,T){const b=Y(_);return b.persistence.runTransaction("Save bundle","readwrite",k=>b.Ii.saveBundleMetadata(k,T))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return br(no,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class jl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=da(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return dP(this.persistence,new uP,e.initialUser,this.serializer)}Cu(e){return new ww(Om.mi,this.serializer)}Du(e){return new IP}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}jl.provider={build:()=>new jl};class Bw extends jl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){se(this.persistence.referenceDelegate instanceof Ep,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new sP(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?wn.withCacheSize(this.cacheSizeBytes):wn.DEFAULT;return new ww(r=>Ep.mi(r,t),this.serializer)}}class $w extends jl{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Uw(this.xu.syncEngine),await ec(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return dP(this.persistence,new uP,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new sP(r,e.asyncQueue,t)}Mu(e,t){const r=new W4(t,this.persistence);return new q4(e.asyncQueue,r)}Cu(e){const t=Ew(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?wn.withCacheSize(this.cacheSizeBytes):wn.DEFAULT;return new Iw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,EP(),yf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new IP}}class FP extends $w{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof oy&&(this.sharedClientState.syncEngine={Co:S6.bind(null,t),vo:C6.bind(null,t),Fo:R6.bind(null,t),Ts:A6.bind(null,t),Do:x6.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await b6(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=EP();if(!oy.v(t))throw new B(V.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Ew(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new oy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Gi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>SS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=I6.bind(null,this.syncEngine),await av(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new i6}()}createDatastore(e){const t=da(e.databaseInfo.databaseId),r=function(i){return new BU(i)}(e.databaseInfo);return function(i,o,a,l){return new WU(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new HU(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>SS(this.syncEngine,t,0),function(){return _S.v()?new _S:new LU}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new u6(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Y(s);$(Xo,"RemoteStore shutting down."),i.Ea.add(5),await Zl(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Gi.provider={build:()=>new Gi};function AS(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Lt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P6{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new nn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new RP(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k6{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new RP(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new B(V.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new B(V.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Y(s),a={documents:i.map(f=>id(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Ae.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const p=Q3(o.serializer,f);u.set(p.key.toString(),p)});const h=[];return i.forEach(f=>{const p=u.get(f.toString());se(!!p,55234,{key:f}),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Xl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Q.fromPath(r);this.mutations.push(new dw(s,this.precondition(s)))}),await async function(r,s){const i=Y(r),o={writes:s.map(a=>od(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,Ae.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ee(50498,{Gu:e.constructor.name});t=ae.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new B(V.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ae.min())?_t.exists(!1):_t.updateTime(t):_t.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ae.min()))throw new B(V.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return _t.updateTime(t)}return _t.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O6{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new bw(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new D6(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!Dd(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!DN(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi="FirestoreClient";class M6{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Zt.UNAUTHENTICATED,this.clientId=J0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{$(Hi,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>($(Hi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new nn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=nc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function ly(n,e){n.asyncQueue.verifyOperationInProgress(),$(Hi,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await hP(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function CS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await zw(n);$(Hi,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>wS(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>wS(e.remoteStore,s)),n._onlineComponents=e}async function zw(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){$(Hi,"Using user provided OfflineComponentProvider");try{await ly(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;br("Error using user provided cache. Falling back to memory cache: "+t),await ly(n,new jl)}}else $(Hi,"Using default OfflineComponentProvider"),await ly(n,new Bw(void 0));return n._offlineComponents}async function Fm(n){return n._onlineComponents||(n._uninitializedComponentsProvider?($(Hi,"Using user provided OnlineComponentProvider"),await CS(n,n._uninitializedComponentsProvider._online)):($(Hi,"Using default OnlineComponentProvider"),await CS(n,new Gi))),n._onlineComponents}function jP(n){return zw(n).then(e=>e.persistence)}function rc(n){return zw(n).then(e=>e.localStore)}function UP(n){return Fm(n).then(e=>e.remoteStore)}function qw(n){return Fm(n).then(e=>e.syncEngine)}function BP(n){return Fm(n).then(e=>e.datastore)}async function Ul(n){const e=await Fm(n),t=e.eventManager;return t.onListen=d6.bind(null,e.syncEngine),t.onUnlisten=f6.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=h6.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=p6.bind(null,e.syncEngine),t}function V6(n){return n.asyncQueue.enqueue(async()=>{const e=await jP(n),t=await UP(n);return e.setNetworkEnabled(!0),function(s){const i=Y(s);return i.Ea.delete(0),Bd(i)}(t)})}function L6(n){return n.asyncQueue.enqueue(async()=>{const e=await jP(n),t=await UP(n);return e.setNetworkEnabled(!1),async function(s){const i=Y(s);i.Ea.add(0),await Zl(i),i.Ra.set("Offline")}(t)})}function F6(n,e){const t=new nn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=Y(u);return f.persistence.runTransaction("read document","readonly",p=>f.localDocuments.getDocument(p,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new B(V.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=nc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await rc(n),e,t)),t.promise}function $P(n,e,t={}){const r=new nn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Lm({next:p=>{h.Nu(),o.enqueueAndForget(()=>kw(i,f));const _=p.docs.has(a);!_&&p.fromCache?u.reject(new B(V.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&p.fromCache&&l&&l.source==="server"?u.reject(new B(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new Ow(Yl(a.path),h,{includeMetadataChanges:!0,qa:!0});return Pw(i,f)}(await Ul(n),n.asyncQueue,e,t,r)),r.promise}function j6(n,e){const t=new nn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Tp(s,i,!0),l=new DP(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=nc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await rc(n),e,t)),t.promise}function zP(n,e,t={}){const r=new nn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Lm({next:p=>{h.Nu(),o.enqueueAndForget(()=>kw(i,f)),p.fromCache&&l.source==="server"?u.reject(new B(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new Ow(a,h,{includeMetadataChanges:!0,qa:!0});return Pw(i,f)}(await Ul(n),n.asyncQueue,e,t,r)),r.promise}function U6(n,e,t){const r=new nn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await BP(n);r.resolve(async function(o,a,l){var b;const u=Y(o),{request:h,gt:f,parent:p}=qN(u.serializer,gN(a),l);u.connection.$o||delete h.parent;const _=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,p,h,1)).filter(k=>!!k.result);se(_.length===1,64727);const T=(b=_[0].result)==null?void 0:b.aggregateFields;return Object.keys(T).reduce((k,C)=>(k[f[C]]=T[C],k),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function B6(n,e){const t=new Lm(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Y(s).Ca.add(i),i.next()}(await Ul(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Y(s).Ca.delete(i)}(await Ul(n),t))}}function $6(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?MN().encode(o):o,function(h,f){return new P6(h,f)}(function(h,f){if(h instanceof Uint8Array)return AS(h,f);if(h instanceof ArrayBuffer)return AS(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,da(e));n.asyncQueue.enqueueAndForget(async()=>{N6(await qw(n),s,r)})}function z6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Y(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await rc(n),e))}function qP(n,e){return function(r,s){return new k6(r,s)}(n,e)}function q6(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Y(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,p,_,T,b){f=[...f],p=[...p],f.sort(_),p.sort(_);const k=f.length,C=p.length;let x=0,R=0;for(;x<C&&R<k;){const P=_(f[R],p[x]);P<0?b(f[R++]):P>0?T(p[x++]):(x++,R++)}for(;x<C;)T(p[x++]);for(;R<k;)b(f[R++])}(u,s,U4,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>M.waitFor(a)))}(await rc(n),e))}function W6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Y(r).Fs.Vs=s}(await rc(n),e))}function G6(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Y(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await rc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RS=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GP="firestore.googleapis.com",NS=!0;class PS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=GP,this.ssl=NS}else this.host=e.host,this.ssl=e.ssl??NS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ZN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<rP)throw new B(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}j4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=WP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new B(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new B(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new B(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $d{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new PS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new PS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new R4;switch(r.type){case"firstParty":return new D4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new B(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=RS.get(t);r&&($("ComponentProvider","Removing Datastore"),RS.delete(t),r.terminate())}(this),Promise.resolve()}}function H6(n,e,t,r={}){var u;n=Re(n,$d);const s=Bs(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Xp(`https://${a}`),c0("Firestore",!0)),i.host!==GP&&i.host!==a&&br("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!ur(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Zt.MOCK_USER;else{h=zA(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new B(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Zt(p)}n._authCredentials=new N4(new PR(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new on(this.firestore,e,this._query)}}class Qe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new as(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Qe(this.firestore,e,this._key)}toJSON(){return{type:Qe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ua(t,Qe._jsonSchema))return new Qe(e,r||null,new Q(Ae.fromString(t.referencePath)))}}Qe._jsonSchemaVersion="firestore/documentReference/1.0",Qe._jsonSchema={type:zt("string",Qe._jsonSchemaVersion),referencePath:zt("string")};class as extends on{constructor(e,t,r){super(e,t,Yl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Qe(this.firestore,null,new Q(e))}withConverter(e){return new as(this.firestore,e,this._path)}}function cy(n,e,...t){if(n=Z(n),X0("collection","path",e),n instanceof $d){const r=Ae.fromString(e,...t);return vx(r),new as(n,null,r)}{if(!(n instanceof Qe||n instanceof as))throw new B(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return vx(r),new as(n.firestore,null,r)}}function o8(n,e){if(n=Re(n,$d),X0("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new B(V.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new on(n,null,function(r){return new $s(Ae.emptyPath(),r)}(e))}function Hc(n,e,...t){if(n=Z(n),arguments.length===1&&(e=J0.newId()),X0("doc","path",e),n instanceof $d){const r=Ae.fromString(e,...t);return _x(r),new Qe(n,null,new Q(r))}{if(!(n instanceof Qe||n instanceof as))throw new B(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return _x(r),new Qe(n.firestore,n instanceof as?n.converter:null,new Q(r))}}function a8(n,e){return n=Z(n),e=Z(e),(n instanceof Qe||n instanceof as)&&(e instanceof Qe||e instanceof as)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function HP(n,e){return n=Z(n),e=Z(e),n instanceof on&&e instanceof on&&n.firestore===e.firestore&&Vd(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kS="AsyncQueue";class DS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new bw(this,"async_queue_retry"),this._c=()=>{const r=yf();r&&$(kS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=yf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=yf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new nn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Zi(e))throw e;$(kS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Lt("INTERNAL UNHANDLED ERROR: ",OS(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Nw.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ee(47125,{Pc:OS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function OS(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class K6{constructor(){this._progressObserver={},this._taskCompletionResolver=new nn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l8=-1;class et extends $d{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new DS,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new DS(e),this._firestoreClient=void 0,await e}}}function c8(n,e,t){t||(t=td);const r=hs(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ur(i,e))return s;throw new B(V.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new B(V.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<rP)throw new B(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Bs(e.host)&&Xp(e.host),r.initialize({options:e,instanceIdentifier:t})}function Q6(n,e){const t=typeof n=="object"?n:Ed(),r=typeof n=="string"?n:e||td,s=hs(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=UA("firestore");i&&H6(s,...i)}return s}function At(n){if(n._terminated)throw new B(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||KP(n),n._firestoreClient}function KP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new v3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,WP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new M6(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function u8(n,e){br("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return QP(n,Gi.provider,{build:r=>new $w(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function d8(n){br("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();QP(n,Gi.provider,{build:t=>new FP(t,e.cacheSizeBytes)})}function QP(n,e,t){if((n=Re(n,et))._firestoreClient||n._terminated)throw new B(V.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new B(V.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},KP(n)}function h8(n){if(n._initialized&&!n._terminated)throw new B(V.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new nn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!is.v())return Promise.resolve();const s=r+cP;await is.delete(s)}(Ew(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function f8(n){return function(t){const r=new nn;return t.asyncQueue.enqueueAndForget(async()=>v6(await qw(t),r)),r.promise}(At(n=Re(n,et)))}function p8(n){return V6(At(n=Re(n,et)))}function m8(n){return L6(At(n=Re(n,et)))}function g8(n){return YV(n.app,"firestore",n._databaseId.database),n._delete()}function MS(n,e){const t=At(n=Re(n,et)),r=new K6;return $6(t,n._databaseId,e,r),r}function Y6(n,e){return z6(At(n=Re(n,et)),e).then(t=>t?new on(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ad{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class J6{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new rr(kt.fromBase64String(e))}catch(t){throw new B(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new rr(kt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:rr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ua(e,rr._jsonSchema))return rr.fromBase64String(e.bytes)}}rr._jsonSchemaVersion="firestore/bytes/1.0",rr._jsonSchema={type:zt("string",rr._jsonSchemaVersion),bytes:zt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function y8(){return new ha(U_)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return me(this._lat,e._lat)||me(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ls._jsonSchemaVersion}}static fromJSON(e){if(ua(e,ls._jsonSchema))return new ls(e.latitude,e.longitude)}}ls._jsonSchemaVersion="firestore/geoPoint/1.0",ls._jsonSchema={type:zt("string",ls._jsonSchemaVersion),latitude:zt("number"),longitude:zt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:jr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ua(e,jr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new jr(e.vectorValues);throw new B(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}jr._jsonSchemaVersion="firestore/vectorValue/1.0",jr._jsonSchema={type:zt("string",jr._jsonSchemaVersion),vectorValues:zt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X6=/^__.*__$/;class Z6{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new qs(e,this.data,this.fieldMask,t,this.fieldTransforms):new Jl(e,this.data,t,this.fieldTransforms)}}class YP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new qs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function JP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ee(40011,{Ac:n})}}class jm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new jm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ap(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(JP(this.Ac)&&X6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class e5{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||da(e)}Cc(e,t,r,s=!1){return new jm({Ac:e,methodName:t,Dc:r,path:yt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pa(n){const e=n._freezeSettings(),t=da(n._databaseId);return new e5(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Um(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Jw("Data must be an object, but it was:",o,r);const a=ek(r,o);let l,u;if(i.merge)l=new $n(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const p=ld(e,f,t);if(!o.contains(p))throw new B(V.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);nk(h,p)||h.push(p)}l=new $n(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new Z6(new un(a),l,u)}class zd extends fa{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof zd}}function XP(n,e,t){return new jm({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ww extends fa{_toFieldTransform(e){return new Fd(e.path,new kl)}isEqual(e){return e instanceof Ww}}class Gw extends fa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=XP(this,e,!0),r=this.vc.map(i=>ma(i,t)),s=new Ho(r);return new Fd(e.path,s)}isEqual(e){return e instanceof Gw&&ur(this.vc,e.vc)}}class Hw extends fa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=XP(this,e,!0),r=this.vc.map(i=>ma(i,t)),s=new Ko(r);return new Fd(e.path,s)}isEqual(e){return e instanceof Hw&&ur(this.vc,e.vc)}}class Kw extends fa{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Dl(e.serializer,SN(e.serializer,this.Fc));return new Fd(e.path,t)}isEqual(e){return e instanceof Kw&&this.Fc===e.Fc}}function Qw(n,e,t,r){const s=n.Cc(1,e,t);Jw("Data must be an object, but it was:",s,r);const i=[],o=un.empty();eo(r,(l,u)=>{const h=Bm(e,l,t);u=Z(u);const f=s.yc(h);if(u instanceof zd)i.push(h);else{const p=ma(u,f);p!=null&&(i.push(h),o.set(h,p))}});const a=new $n(i);return new YP(o,a,s.fieldTransforms)}function Yw(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[ld(e,r,t)],l=[s];if(i.length%2!=0)throw new B(V.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(ld(e,i[p])),l.push(i[p+1]);const u=[],h=un.empty();for(let p=a.length-1;p>=0;--p)if(!nk(u,a[p])){const _=a[p];let T=l[p];T=Z(T);const b=o.yc(_);if(T instanceof zd)u.push(_);else{const k=ma(T,b);k!=null&&(u.push(_),h.set(_,k))}}const f=new $n(u);return new YP(h,f,o.fieldTransforms)}function ZP(n,e,t,r=!1){return ma(t,n.Cc(r?4:3,e))}function ma(n,e){if(tk(n=Z(n)))return Jw("Unsupported field value:",e,n),ek(n,e);if(n instanceof fa)return function(r,s){if(!JP(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ma(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Z(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return SN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=We.fromDate(r);return{timestampValue:Ol(s.serializer,i)}}if(r instanceof We){const i=new We(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ol(s.serializer,i)}}if(r instanceof ls)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof rr)return{bytesValue:FN(s.serializer,r._byteString)};if(r instanceof Qe){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:gw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof jr)return function(o,a){return{mapValue:{fields:{[iw]:{stringValue:ow},[Rl]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return uw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${vm(r)}`)}(n,e)}function ek(n,e){const t={};return XR(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):eo(n,(r,s)=>{const i=ma(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function tk(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof We||n instanceof ls||n instanceof rr||n instanceof Qe||n instanceof fa||n instanceof jr)}function Jw(n,e,t){if(!tk(t)||!DR(t)){const r=vm(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function ld(n,e,t){if((e=Z(e))instanceof ha)return e._internalPath;if(typeof e=="string")return Bm(n,e);throw Ap("Field path arguments must be of type string or ",n,!1,void 0,t)}const t5=new RegExp("[~\\*/\\[\\]]");function Bm(n,e,t){if(e.search(t5)>=0)throw Ap(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ha(...e.split("."))._internalPath}catch{throw Ap(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ap(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new B(V.INVALID_ARGUMENT,a+n+l)}function nk(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Qe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new n5(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($m("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class n5 extends cd{data(){return super.data()}}function $m(n,e){return typeof e=="string"?Bm(n,e):e instanceof ha?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rk(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xw{}class qd extends Xw{}function _8(n,e,...t){let r=[];e instanceof Xw&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof sc).length,a=i.filter(l=>l instanceof Wd).length;if(o>1||o>0&&a>0)throw new B(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Wd extends qd{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Wd(e,t,r)}_apply(e){const t=this._parse(e);return ik(e._query,t),new on(e.firestore,e.converter,J_(e._query,t))}_parse(e){const t=pa(e.firestore);return function(i,o,a,l,u,h,f){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new B(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){LS(f,h);const T=[];for(const b of f)T.push(VS(l,i,b));p={arrayValue:{values:T}}}else p=VS(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||LS(f,h),p=ZP(a,o,f,h==="in"||h==="not-in");return Pe.create(u,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function v8(n,e,t){const r=e,s=$m("where",n);return Wd._create(s,r,t)}class sc extends Xw{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new sc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ge.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)ik(o,l),o=J_(o,l)}(e._query,t),new on(e.firestore,e.converter,J_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function w8(...n){return n.forEach(e=>ok("or",e)),sc._create("or",n)}function I8(...n){return n.forEach(e=>ok("and",e)),sc._create("and",n)}class Zw extends qd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Zw(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new B(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new B(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sd(i,o)}(e._query,this._field,this._direction);return new on(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new $s(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function E8(n,e="asc"){const t=e,r=$m("orderBy",n);return Zw._create(r,t)}class zm extends qd{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new zm(e,t,r)}_apply(e){return new on(e.firestore,e.converter,_p(e._query,this._limit,this._limitType))}}function T8(n){return OR("limit",n),zm._create("limit",n,"F")}function x8(n){return OR("limitToLast",n),zm._create("limitToLast",n,"L")}class qm extends qd{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new qm(e,t,r)}_apply(e){const t=sk(e,this.type,this._docOrFields,this._inclusive);return new on(e.firestore,e.converter,function(s,i){return new $s(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function S8(...n){return qm._create("startAt",n,!0)}function b8(...n){return qm._create("startAfter",n,!1)}class Wm extends qd{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Wm(e,t,r)}_apply(e){const t=sk(e,this.type,this._docOrFields,this._inclusive);return new on(e.firestore,e.converter,function(s,i){return new $s(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function A8(...n){return Wm._create("endBefore",n,!1)}function C8(...n){return Wm._create("endAt",n,!0)}function sk(n,e,t,r){if(t[0]=Z(t[0]),t[0]instanceof cd)return function(i,o,a,l,u){if(!l)throw new B(V.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of nl(i))if(f.field.isKeyField())h.push(Wo(o,l.key));else{const p=l.data.field(f.field);if(xm(p))throw new B(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const _=f.field.canonicalString();throw new B(V.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(p)}return new qi(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=pa(n.firestore);return function(o,a,l,u,h,f){const p=o.explicitOrderBy;if(h.length>p.length)throw new B(V.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let T=0;T<h.length;T++){const b=h[T];if(p[T].field.isKeyField()){if(typeof b!="string")throw new B(V.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof b}`);if(!lw(o)&&b.indexOf("/")!==-1)throw new B(V.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${b}' contains a slash.`);const k=o.path.child(Ae.fromString(b));if(!Q.isDocumentKey(k))throw new B(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const C=new Q(k);_.push(Wo(a,C))}else{const k=ZP(l,u,b);_.push(k)}}return new qi(_,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function VS(n,e,t){if(typeof(t=Z(t))=="string"){if(t==="")throw new B(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!lw(e)&&t.indexOf("/")!==-1)throw new B(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ae.fromString(t));if(!Q.isDocumentKey(r))throw new B(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Wo(n,new Q(r))}if(t instanceof Qe)return Wo(n,t._key);throw new B(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vm(t)}.`)}function LS(n,e){if(!Array.isArray(n)||n.length===0)throw new B(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ik(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new B(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function ok(n,e){if(!(e instanceof Wd||e instanceof sc))throw new B(V.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class ak{convertValue(e,t="none"){switch($i(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ft(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ee(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return eo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[Rl].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>ft(o.doubleValue));return new jr(t)}convertGeoPoint(e){return new ls(ft(e.latitude),ft(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Sm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ed(e));default:return null}}convertTimestamp(e){const t=Ms(e);return new We(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ae.fromString(e);se(KN(r),9688,{name:e});const s=new qo(r.get(1),r.get(3)),i=new Q(r.popFirst(5));return s.isEqual(t)||Lt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gm(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class eI extends ak{constructor(e){super(),this.firestore=e}convertBytes(e){return new rr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qe(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R8(n){return new ad("sum",ld("sum",n))}function N8(n){return new ad("avg",ld("average",n))}function r5(){return new ad("count")}function P8(n,e){var t,r;return n instanceof ad&&e instanceof ad&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function k8(n,e){return HP(n.query,e.query)&&ur(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk="NOT SUPPORTED";class gi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class or extends cd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _f(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field($m("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=or._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function D8(n,e,t){if(ua(e,or._jsonSchema)){if(e.bundle===lk)throw new B(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=da(n._databaseId),s=qP(e.bundle,r),i=s.Wu(),o=new Mw(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new B(V.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Rm(r,a[0].document),u=new Q(Ae.fromString(e.bundleName));return new or(n,new eI(n),u,l,new gi(!1,!1),t||null)}}or._jsonSchemaVersion="firestore/documentSnapshot/1.0",or._jsonSchema={type:zt("string",or._jsonSchemaVersion),bundleSource:zt("string","DocumentSnapshot"),bundleName:zt("string"),bundle:zt("string")};class _f extends or{data(e={}){return super.data(e)}}class ar{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new gi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new _f(this._firestore,this._userDataWriter,r.key,r,new gi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new _f(s._firestore,s._userDataWriter,a.doc.key,a.doc,new gi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new _f(s._firestore,s._userDataWriter,a.doc.key,a.doc,new gi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:s5(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ar._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=J0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function O8(n,e,t){if(ua(e,ar._jsonSchema)){if(e.bundle===lk)throw new B(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=da(n._databaseId),s=qP(e.bundle,r),i=s.Wu(),o=new Mw(s.getMetadata(),r);for(const p of i)o.Ga(p);if(o.queries.length!==1)throw new B(V.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=Pm(o.queries[0].bundledQuery),l=o.documents;let u=new ko;l.map(p=>{const _=Rm(r,p.document);u=u.add(_)});const h=Zo.fromInitialDocuments(a,u,ve(),!1,!1),f=new on(n,t||null,a);return new ar(n,new eI(n),f,h)}}function s5(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ee(61501,{type:n})}}function M8(n,e){return n instanceof or&&e instanceof or?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ar&&e instanceof ar&&n._firestore===e._firestore&&HP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i5(n){n=Re(n,Qe);const e=Re(n.firestore,et);return $P(At(e),n._key).then(t=>tI(e,n,t))}ar._jsonSchemaVersion="firestore/querySnapshot/1.0",ar._jsonSchema={type:zt("string",ar._jsonSchemaVersion),bundleSource:zt("string","QuerySnapshot"),bundleName:zt("string"),bundle:zt("string")};class ro extends ak{constructor(e){super(),this.firestore=e}convertBytes(e){return new rr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qe(this.firestore,null,t)}}function V8(n){n=Re(n,Qe);const e=Re(n.firestore,et),t=At(e),r=new ro(e);return F6(t,n._key).then(s=>new or(e,r,n._key,s,new gi(s!==null&&s.hasLocalMutations,!0),n.converter))}function L8(n){n=Re(n,Qe);const e=Re(n.firestore,et);return $P(At(e),n._key,{source:"server"}).then(t=>tI(e,n,t))}function o5(n){n=Re(n,on);const e=Re(n.firestore,et),t=At(e),r=new ro(e);return rk(n._query),zP(t,n._query).then(s=>new ar(e,r,n,s))}function F8(n){n=Re(n,on);const e=Re(n.firestore,et),t=At(e),r=new ro(e);return j6(t,n._query).then(s=>new ar(e,r,n,s))}function j8(n){n=Re(n,on);const e=Re(n.firestore,et),t=At(e),r=new ro(e);return zP(t,n._query,{source:"server"}).then(s=>new ar(e,r,n,s))}function FS(n,e,t){n=Re(n,Qe);const r=Re(n.firestore,et),s=Gm(n.converter,e,t);return Gd(r,[Um(pa(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,_t.none())])}function U8(n,e,t,...r){n=Re(n,Qe);const s=Re(n.firestore,et),i=pa(s);let o;return o=typeof(e=Z(e))=="string"||e instanceof ha?Yw(i,"updateDoc",n._key,e,t,r):Qw(i,"updateDoc",n._key,e),Gd(s,[o.toMutation(n._key,_t.exists(!0))])}function jS(n){return Gd(Re(n.firestore,et),[new Xl(n._key,_t.none())])}function a5(n,e){const t=Re(n.firestore,et),r=Hc(n),s=Gm(n.converter,e);return Gd(t,[Um(pa(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,_t.exists(!1))]).then(()=>r)}function US(n,...e){var l,u,h;n=Z(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||rl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(rl(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof Qe)o=Re(n.firestore,et),a=Yl(n._key.path),i={next:f=>{e[r]&&e[r](tI(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=Re(n,on);o=Re(f.firestore,et),a=f._query;const p=new ro(o);i={next:_=>{e[r]&&e[r](new ar(o,p,f,_))},error:e[r+1],complete:e[r+2]},rk(n._query)}return function(p,_,T,b){const k=new Lm(b),C=new Ow(_,k,T);return p.asyncQueue.enqueueAndForget(async()=>Pw(await Ul(p),C)),()=>{k.Nu(),p.asyncQueue.enqueueAndForget(async()=>kw(await Ul(p),C))}}(At(o),a,s,i)}function B8(n,e,...t){const r=Z(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const p=l[f];if(typeof p!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(p.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=p:f==="bundleName"?u.bundleName=p:f==="bundleSource"&&(u.bundleSource=p)}return u}(e);if(s.error)throw new B(V.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||rl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&rl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,_){let T,b=!1;return MS(u,h.bundle).then(()=>Y6(u,h.bundleName)).then(C=>{C&&!b&&(_&&C.withConverter(_),T=US(C,f||{},p))}).catch(C=>(p.error&&p.error(C),()=>{})),()=>{b||(b=!0,T&&T())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&rl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,_){let T,b=!1;return MS(u,h.bundle).then(()=>{if(!b){const C=new Qe(u,_||null,Q.fromPath(h.bundleName));T=US(C,f||{},p)}}).catch(C=>(p.error&&p.error(C),()=>{})),()=>{b||(b=!0,T&&T())}}(r,s,i,a,t[o])}throw new B(V.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function $8(n,e){return B6(At(n=Re(n,et)),rl(e)?e:{next:e})}function Gd(n,e){return function(r,s){const i=new nn;return r.asyncQueue.enqueueAndForget(async()=>m6(await qw(r),s,i)),i.promise}(At(n),e)}function tI(n,e,t){const r=t.docs.get(e._key),s=new ro(n);return new or(n,s,e._key,r,new gi(t.hasPendingWrites,t.fromCache),e.converter)}function z8(n){return l5(n,{count:r5()})}function l5(n,e){const t=Re(n.firestore,et),r=At(t),s=JR(e,(i,o)=>new kN(o,i.aggregateType,i._internalFieldPath));return U6(r,n._query,s).then(i=>function(a,l,u){const h=new ro(a);return new J6(l,h,u)}(t,n,i))}class c5{constructor(e){this.kind="memory",this._onlineComponentProvider=Gi.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Bw(void 0)}}toJSON(){return{kind:this.kind}}}class u5{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=m5(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class d5{constructor(){this.kind="memoryEager",this._offlineComponentProvider=jl.provider}toJSON(){return{kind:this.kind}}}class h5{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Bw(e)}}toJSON(){return{kind:this.kind}}}function q8(){return new d5}function W8(n){return new h5(n==null?void 0:n.cacheSizeBytes)}function G8(n){return new c5(n)}function H8(n){return new u5(n)}class f5{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Gi.provider,this._offlineComponentProvider={build:t=>new $w(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class p5{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Gi.provider,this._offlineComponentProvider={build:t=>new FP(t,e==null?void 0:e.cacheSizeBytes)}}}function m5(n){return new f5(n==null?void 0:n.forceOwnership)}function K8(){return new p5}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=pa(e)}set(e,t,r){this._verifyNotCommitted();const s=yi(e,this._firestore),i=Gm(s.converter,t,r),o=Um(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,_t.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=yi(e,this._firestore);let o;return o=typeof(t=Z(t))=="string"||t instanceof ha?Yw(this._dataReader,"WriteBatch.update",i._key,t,r,s):Qw(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,_t.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=yi(e,this._firestore);return this._mutations=this._mutations.concat(new Xl(t._key,_t.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(V.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function yi(n,e){if((n=Z(n)).firestore!==e)throw new B(V.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=pa(e)}get(e){const t=yi(e,this._firestore),r=new eI(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return ee(24041);const i=s[0];if(i.isFoundDocument())return new cd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new cd(this._firestore,r,t._key,null,t.converter);throw ee(18433,{doc:i})})}set(e,t,r){const s=yi(e,this._firestore),i=Gm(s.converter,t,r),o=Um(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=yi(e,this._firestore);let o;return o=typeof(t=Z(t))=="string"||t instanceof ha?Yw(this._dataReader,"Transaction.update",i._key,t,r,s):Qw(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=yi(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5 extends _5{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=yi(e,this._firestore),r=new ro(this._firestore);return super.get(e).then(s=>new or(this._firestore,r,t._key,s._document,new gi(!1,!1),t.converter))}}function Q8(n,e,t){n=Re(n,et);const r={...g5,...t};return function(i){if(i.maxAttempts<1)throw new B(V.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new nn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await BP(i);new O6(i.asyncQueue,u,a,o,l).ju()}),l.promise}(At(n),s=>e(new v5(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y8(){return new zd("deleteField")}function Bh(){return new Ww("serverTimestamp")}function J8(...n){return new Gw("arrayUnion",n)}function X8(...n){return new Hw("arrayRemove",n)}function Z8(n){return new Kw("increment",n)}function e7(n){return new jr(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t7(n){return At(n=Re(n,et)),new y5(n,e=>Gd(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n7(n,e){const t=At(n=Re(n,et));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return br("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new B(V.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=BS(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const p=Bm("setIndexConfiguration",BS(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new No(p,2)):f.order==="ASCENDING"?h.push(new No(p,0)):f.order==="DESCENDING"&&h.push(new No(p,1))}a.push(new Tl(Tl.UNKNOWN_ID,u,h,xl.empty()))}return a}(e);return q6(t,r)}function BS(n,e){if(typeof n[e]!="string")throw new B(V.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function r7(n){var s;n=Re(n,et);const e=$S.get(n);if(e)return e;if(((s=At(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new w5(n);return $S.set(n,r),r}function s7(n){ck(n,!0)}function i7(n){ck(n,!1)}function o7(n){G6(At(n._firestore)).then(e=>$("deleting all persistent cache indexes succeeded")).catch(e=>br("deleting all persistent cache indexes failed",e))}function ck(n,e){W6(At(n._firestore),e).then(t=>$(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>br(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const $S=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a7(n){var r;const e=At(Re(n.firestore,et)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:Nm(t,xn(n._query)).ft}function l7(n,e){var i;const t=JR(e,(o,a)=>new kN(a,o.aggregateType,o._internalFieldPath)),r=At(Re(n.firestore,et)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:qN(s,gN(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c7{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return nI.instance.onExistenceFilterMismatch(e)}}class nI{constructor(){this.Mc=new Map}static get instance(){return $h||($h=new nI,function(t){if(gu)throw new Error("a TestingHooksSpi instance is already set");gu=t}($h)),$h}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let $h=null;(function(e,t=!0){(function(s){Ql=s})(oa),Br(new Qn("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new et(new P4(r.getProvider("auth-internal")),new O4(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new B(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qo(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Hn(gx,yx,e),Hn(gx,yx,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u7={PHONE:"phone",TOTP:"totp"},d7={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},h7={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},f7={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},p7={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I5(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function uk(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const m7=I5,E5=uk,dk=new sa("auth","Firebase",uk()),g7={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cp=new Id("@firebase/auth");function T5(n,...e){Cp.logLevel<=Ce.WARN&&Cp.warn(`Auth (${oa}): ${n}`,...e)}function vf(n,...e){Cp.logLevel<=Ce.ERROR&&Cp.error(`Auth (${oa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(n,...e){throw sI(n,...e)}function On(n,...e){return sI(n,...e)}function rI(n,e,t){const r={...E5(),[e]:t};return new sa("auth","Firebase",r).create(e,{appName:n.name})}function rn(n){return rI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ic(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Yn(n,"argument-error"),rI(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function sI(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return dk.create(n,...e)}function G(n,e,...t){if(!n)throw sI(e,...t)}function ts(n){const e="INTERNAL ASSERTION FAILED: "+n;throw vf(e),new Error(e)}function Ls(n,e){n||ts(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ud(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function iI(){return zS()==="http:"||zS()==="https:"}function zS(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x5(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(iI()||d0()||"connection"in navigator)?navigator.onLine:!0}function S5(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ls(t>e,"Short delay should be less than long delay!"),this.isMobile=u0()||WA()}get(){return x5()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oI(n,e){Ls(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ts("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ts("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ts("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b5={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A5=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],C5=new Hd(3e4,6e4);function dt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ht(n,e,t,r,s={}){return fk(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=ia({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return BM()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Bs(n.emulatorConfig.host)&&(u.credentials="include"),hk.fetch()(await pk(n,n.config.apiHost,t,a),u)})}async function fk(n,e,t){n._canInitEmulator=!1;const r={...b5,...e};try{const s=new N5(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Kc(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Kc(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Kc(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Kc(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw rI(n,h,u);Yn(n,h)}}catch(s){if(s instanceof $r)throw s;Yn(n,"network-request-failed",{message:String(s)})}}async function Gs(n,e,t,r,s={}){const i=await ht(n,e,t,r,s);return"mfaPendingCredential"in i&&Yn(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function pk(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?oI(n.config,s):`${n.config.apiScheme}://${s}`;return A5.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function R5(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class N5{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(On(this.auth,"network-request-failed")),C5.get())})}}function Kc(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=On(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qS(n){return n!==void 0&&n.getResponse!==void 0}function WS(n){return n!==void 0&&n.enterprise!==void 0}class mk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return R5(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P5(n){return(await ht(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function gk(n,e){return ht(n,"GET","/v2/recaptchaConfig",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k5(n,e){return ht(n,"POST","/v1/accounts:delete",e)}async function D5(n,e){return ht(n,"POST","/v1/accounts:update",e)}async function Rp(n,e){return ht(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _u(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y7(n,e=!1){return Z(n).getIdToken(e)}async function O5(n,e=!1){const t=Z(n),r=await t.getIdToken(e),s=Hm(r);G(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:_u(uy(s.auth_time)),issuedAtTime:_u(uy(s.iat)),expirationTime:_u(uy(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function uy(n){return Number(n)*1e3}function Hm(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return vf("JWT malformed, contained fewer than 3 sections"),null;try{const s=Yf(t);return s?JSON.parse(s):(vf("Failed to decode base64 JWT payload"),null)}catch(s){return vf("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function GS(n){const e=Hm(n);return G(e,"internal-error"),G(typeof e.exp<"u","internal-error"),G(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof $r&&M5(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function M5({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V5{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=_u(this.lastLoginAt),this.creationTime=_u(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dd(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Fs(n,Rp(e,{idToken:t}));G(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?yk(s.providerUserInfo):[],o=F5(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new uv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function L5(n){const e=Z(n);await dd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function F5(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function yk(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j5(n,e){const t=await fk(n,{},async()=>{const r=ia({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await pk(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&Bs(n.emulatorConfig.host)&&(l.credentials="include"),hk.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function U5(n,e){return ht(n,"POST","/v2/accounts:revokeToken",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){G(e.idToken,"internal-error"),G(typeof e.idToken<"u","internal-error"),G(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):GS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){G(e.length!==0,"internal-error");const t=GS(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(G(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await j5(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new sl;return r&&(G(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(G(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(G(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new sl,this.toJSON())}_performRefresh(){return ts("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(n,e){G(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Mr{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new V5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new uv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Fs(this,this.stsTokenManager.getToken(this.auth,e));return G(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return O5(this,e)}reload(){return L5(this)}_assign(e){this!==e&&(G(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Mr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){G(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await dd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(mt(this.auth.app))return Promise.reject(rn(this.auth));const e=await this.getIdToken();return await Fs(this,k5(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:_,providerData:T,stsTokenManager:b}=t;G(f&&b,e,"internal-error");const k=sl.fromJSON(this.name,b);G(typeof f=="string",e,"internal-error"),ti(r,e.name),ti(s,e.name),G(typeof p=="boolean",e,"internal-error"),G(typeof _=="boolean",e,"internal-error"),ti(i,e.name),ti(o,e.name),ti(a,e.name),ti(l,e.name),ti(u,e.name),ti(h,e.name);const C=new Mr({uid:f,auth:e,email:s,emailVerified:p,displayName:r,isAnonymous:_,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:k,createdAt:u,lastLoginAt:h});return T&&Array.isArray(T)&&(C.providerData=T.map(x=>({...x}))),l&&(C._redirectEventId=l),C}static async _fromIdTokenResponse(e,t,r=!1){const s=new sl;s.updateFromServerResponse(t);const i=new Mr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await dd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];G(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?yk(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new sl;a.updateFromIdToken(r);const l=new Mr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new uv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HS=new Map;function Ss(n){Ls(n instanceof Function,"Expected a class definition");let e=HS.get(n);return e?(Ls(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,HS.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}_k.type="NONE";const KS=_k;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wf(n,e,t){return`firebase:${n}:${e}:${t}`}class il{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=wf(this.userKey,s.apiKey,i),this.fullPersistenceKey=wf("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Rp(this.auth,{idToken:e}).catch(()=>{});return t?Mr._fromGetAccountInfoResponse(this.auth,t,e):null}return Mr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new il(Ss(KS),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Ss(KS);const o=wf(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const p=await Rp(e,{idToken:h}).catch(()=>{});if(!p)break;f=await Mr._fromGetAccountInfoResponse(e,p,h)}else f=Mr._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new il(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new il(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QS(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ek(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(vk(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(xk(e))return"Blackberry";if(Sk(e))return"Webos";if(wk(e))return"Safari";if((e.includes("chrome/")||Ik(e))&&!e.includes("edge/"))return"Chrome";if(Tk(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function vk(n=Ht()){return/firefox\//i.test(n)}function wk(n=Ht()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ik(n=Ht()){return/crios\//i.test(n)}function Ek(n=Ht()){return/iemobile/i.test(n)}function Tk(n=Ht()){return/android/i.test(n)}function xk(n=Ht()){return/blackberry/i.test(n)}function Sk(n=Ht()){return/webos/i.test(n)}function aI(n=Ht()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function B5(n=Ht()){var e;return aI(n)&&!!((e=window.navigator)!=null&&e.standalone)}function $5(){return $M()&&document.documentMode===10}function bk(n=Ht()){return aI(n)||Tk(n)||Sk(n)||xk(n)||/windows phone/i.test(n)||Ek(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ak(n,e=[]){let t;switch(n){case"Browser":t=QS(Ht());break;case"Worker":t=`${QS(Ht())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${oa}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z5{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q5(n,e={}){return ht(n,"GET","/v2/passwordPolicy",dt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W5=6;class G5{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??W5,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H5{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new YS(this),this.idTokenSubscription=new YS(this),this.beforeStateQueue=new z5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dk,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ss(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await il.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Rp(this,{idToken:e}),r=await Mr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(mt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return G(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await dd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=S5()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(mt(this.app))return Promise.reject(rn(this));const t=e?Z(e):null;return t&&G(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&G(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return mt(this.app)?Promise.reject(rn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return mt(this.app)?Promise.reject(rn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ss(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await q5(this),t=new G5(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new sa("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await U5(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ss(e)||this._popupRedirectResolver;G(t,this,"argument-error"),this.redirectPersistenceManager=await il.create(this,[Ss(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(G(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return G(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ak(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(mt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&T5(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Dt(n){return Z(n)}class YS{constructor(e){this.auth=e,this.observer=null,this.addObserver=QM(t=>this.observer=t)}get next(){return G(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function K5(n){Kd=n}function lI(n){return Kd.loadJS(n)}function Q5(){return Kd.recaptchaV2Script}function Y5(){return Kd.recaptchaEnterpriseScript}function J5(){return Kd.gapiScript}function Ck(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5=500,Z5=6e4,zh=1e12;class eB{constructor(e){this.auth=e,this.counter=zh,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new rB(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||zh;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||zh;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||zh;return(r=this._widgets.get(t))==null||r.execute(),""}}class tB{constructor(){this.enterprise=new nB}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nB{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class rB{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;G(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=sB(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Z5)},X5))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function sB(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const iB="recaptcha-enterprise",vu="NO_RECAPTCHA";class Rk{constructor(e){this.type=iB,this.auth=Dt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{gk(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new mk(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;WS(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(vu)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new tB().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&WS(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Y5();l.length!==0&&(l+=a),lI(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Mc(n,e,t,r=!1,s=!1){const i=new Rk(n);let o;if(s)o=vu;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Di(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Mc(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Mc(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Mc(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Mc(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await Mc(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function Nk(n){const e=Dt(n),t=await gk(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new mk(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new Rk(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oB(n,e){const t=hs(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ur(i,e??{}))return s;Yn(s,"already-initialized")}return t.initialize({options:e})}function aB(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ss);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function lB(n,e,t){const r=Dt(n);G(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=Pk(e),{host:o,port:a}=cB(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){G(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),G(ur(u,r.config.emulator)&&ur(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Bs(o)?(Xp(`${i}//${o}${l}`),c0("Auth",!0)):s||uB()}function Pk(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function cB(n){const e=Pk(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:JS(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:JS(o)}}}function JS(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function uB(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ts("not implemented")}_getIdTokenResponse(e){return ts("not implemented")}_linkToIdToken(e,t){return ts("not implemented")}_getReauthenticationResolver(e){return ts("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kk(n,e){return ht(n,"POST","/v1/accounts:resetPassword",dt(n,e))}async function dB(n,e){return ht(n,"POST","/v1/accounts:update",e)}async function hB(n,e){return ht(n,"POST","/v1/accounts:signUp",e)}async function fB(n,e){return ht(n,"POST","/v1/accounts:update",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pB(n,e){return Gs(n,"POST","/v1/accounts:signInWithPassword",dt(n,e))}async function Km(n,e){return ht(n,"POST","/v1/accounts:sendOobCode",dt(n,e))}async function mB(n,e){return Km(n,e)}async function gB(n,e){return Km(n,e)}async function yB(n,e){return Km(n,e)}async function _B(n,e){return Km(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vB(n,e){return Gs(n,"POST","/v1/accounts:signInWithEmailLink",dt(n,e))}async function wB(n,e){return Gs(n,"POST","/v1/accounts:signInWithEmailLink",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd extends Qd{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new hd(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new hd(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Di(e,t,"signInWithPassword",pB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return vB(e,{email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Di(e,r,"signUpPassword",hB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return wB(e,{idToken:t,email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cs(n,e){return Gs(n,"POST","/v1/accounts:signInWithIdp",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IB="http://localhost";class js extends Qd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new js(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Yn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new js(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Cs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Cs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Cs(e,t)}buildRequest(){const e={requestUri:IB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ia(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XS(n,e){return ht(n,"POST","/v1/accounts:sendVerificationCode",dt(n,e))}async function EB(n,e){return Gs(n,"POST","/v1/accounts:signInWithPhoneNumber",dt(n,e))}async function TB(n,e){const t=await Gs(n,"POST","/v1/accounts:signInWithPhoneNumber",dt(n,e));if(t.temporaryProof)throw Kc(n,"account-exists-with-different-credential",t);return t}const xB={USER_NOT_FOUND:"user-not-found"};async function SB(n,e){const t={...e,operation:"REAUTH"};return Gs(n,"POST","/v1/accounts:signInWithPhoneNumber",dt(n,t),xB)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do extends Qd{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Do({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Do({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return EB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return TB(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return SB(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Do({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bB(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function AB(n){const e=Uc(Bc(n)).link,t=e?Uc(Bc(e)).deep_link_id:null,r=Uc(Bc(n)).deep_link_id;return(r?Uc(Bc(r)).link:null)||r||t||e||n}class Yd{constructor(e){const t=Uc(Bc(e)),r=t.apiKey??null,s=t.oobCode??null,i=bB(t.mode??null);G(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=AB(e);try{return new Yd(t)}catch{return null}}}function _7(n){return Yd.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(){this.providerId=ga.PROVIDER_ID}static credential(e,t){return hd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Yd.parseLink(t);return G(r,"argument-error"),hd._fromEmailAndCode(e,r.code,r.tenantId)}}ga.PROVIDER_ID="password";ga.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ga.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc extends Hs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class If extends oc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return G("providerId"in t&&"signInMethod"in t,"argument-error"),js._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return G(e.idToken||e.accessToken,"argument-error"),js._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return If.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return If.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new If(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li extends oc{constructor(){super("facebook.com")}static credential(e){return js._fromParams({providerId:li.PROVIDER_ID,signInMethod:li.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return li.credentialFromTaggedObject(e)}static credentialFromError(e){return li.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return li.credential(e.oauthAccessToken)}catch{return null}}}li.FACEBOOK_SIGN_IN_METHOD="facebook.com";li.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends oc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return js._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ws.credential(t,r)}catch{return null}}}ws.GOOGLE_SIGN_IN_METHOD="google.com";ws.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci extends oc{constructor(){super("github.com")}static credential(e){return js._fromParams({providerId:ci.PROVIDER_ID,signInMethod:ci.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ci.credentialFromTaggedObject(e)}static credentialFromError(e){return ci.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ci.credential(e.oauthAccessToken)}catch{return null}}}ci.GITHUB_SIGN_IN_METHOD="github.com";ci.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB="http://localhost";class fd extends Qd{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Cs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Cs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Cs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new fd(r,i)}static _create(e,t){return new fd(e,t)}buildRequest(){return{requestUri:CB,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RB="saml.";class dv extends Hs{constructor(e){G(e.startsWith(RB),"argument-error"),super(e)}static credentialFromResult(e){return dv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return dv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=fd.fromJSON(e);return G(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return fd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui extends oc{constructor(){super("twitter.com")}static credential(e,t){return js._fromParams({providerId:ui.PROVIDER_ID,signInMethod:ui.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ui.credentialFromTaggedObject(e)}static credentialFromError(e){return ui.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return ui.credential(t,r)}catch{return null}}}ui.TWITTER_SIGN_IN_METHOD="twitter.com";ui.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dk(n,e){return Gs(n,"POST","/v1/accounts:signUp",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Mr._fromIdTokenResponse(e,r,s),o=ZS(r);return new Ar({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=ZS(r);return new Ar({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function ZS(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v7(n){var s;if(mt(n.app))return Promise.reject(rn(n));const e=Dt(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Ar({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await Dk(e,{returnSecureToken:!0}),r=await Ar._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np extends $r{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Np.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Np(e,t,r,s)}}function Ok(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Np._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w7(n,e){const t=Z(n);await Qm(!0,t,e);const{providerUserInfo:r}=await D5(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=Mk(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function cI(n,e,t=!1){const r=await Fs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ar._forOperation(n,"link",r)}async function Qm(n,e,t){await dd(e);const r=Mk(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";G(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n,e,t=!1){const{auth:r}=n;if(mt(r.app))return Promise.reject(rn(r));const s="reauthenticate";try{const i=await Fs(n,Ok(r,s,e,n),t);G(i.idToken,r,"internal-error");const o=Hm(i.idToken);G(o,r,"internal-error");const{sub:a}=o;return G(n.uid===a,r,"user-mismatch"),Ar._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Yn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lk(n,e,t=!1){if(mt(n.app))return Promise.reject(rn(n));const r="signIn",s=await Ok(n,r,e),i=await Ar._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function uI(n,e){return Lk(Dt(n),e)}async function NB(n,e){const t=Z(n);return await Qm(!1,t,e.providerId),cI(t,e)}async function PB(n,e){return Vk(Z(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kB(n,e){return Gs(n,"POST","/v1/accounts:signInWithCustomToken",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I7(n,e){if(mt(n.app))return Promise.reject(rn(n));const t=Dt(n),r=await kB(t,{token:e,returnSecureToken:!0}),s=await Ar._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?dI._fromServerResponse(e,t):"totpInfo"in t?hI._fromServerResponse(e,t):Yn(e,"internal-error")}}class dI extends Jd{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new dI(t)}}class hI extends Jd{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new hI(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ym(n,e,t){var r;G(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),G(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),G(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(G(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(G(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fI(n){const e=Dt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function DB(n,e,t){const r=Dt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Ym(r,s,t),await Di(r,s,"getOobCode",gB,"EMAIL_PASSWORD_PROVIDER")}async function E7(n,e,t){await kk(Z(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&fI(n),r})}async function T7(n,e){await fB(Z(n),{oobCode:e})}async function OB(n,e){const t=Z(n),r=await kk(t,{oobCode:e}),s=r.requestType;switch(G(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":G(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":G(r.mfaInfo,t,"internal-error");default:G(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Jd._fromServerResponse(Dt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function x7(n,e){const{data:t}=await OB(Z(n),e);return t.email}async function MB(n,e,t){if(mt(n.app))return Promise.reject(rn(n));const r=Dt(n),o=await Di(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Dk,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&fI(n),l}),a=await Ar._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function VB(n,e,t){return mt(n.app)?Promise.reject(rn(n)):uI(Z(n),ga.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&fI(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S7(n,e,t){const r=Dt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){G(a.handleCodeInApp,r,"argument-error"),a&&Ym(r,o,a)}i(s,t),await Di(r,s,"getOobCode",yB,"EMAIL_PASSWORD_PROVIDER")}function b7(n,e){const t=Yd.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function A7(n,e,t){if(mt(n.app))return Promise.reject(rn(n));const r=Z(n),s=ga.credentialWithLink(e,t||ud());return G(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),uI(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LB(n,e){return ht(n,"POST","/v1/accounts:createAuthUri",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C7(n,e){const t=iI()?ud():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await LB(Z(n),r);return s||[]}async function FB(n,e){const t=Z(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Ym(t.auth,s,e);const{email:i}=await mB(t.auth,s);i!==n.email&&await n.reload()}async function R7(n,e,t){const r=Z(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Ym(r.auth,i,t);const{email:o}=await _B(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jB(n,e){return ht(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N7(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Z(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Fs(r,jB(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function P7(n,e){const t=Z(n);return mt(t.auth.app)?Promise.reject(rn(t.auth)):Fk(t,e,null)}function k7(n,e){return Fk(Z(n),null,e)}async function Fk(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Fs(n,dB(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UB(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Hm(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ol(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new BB(r,t);case"github.com":return new $B(r,t);case"google.com":return new zB(r,t);case"twitter.com":return new qB(r,t,n.screenName||null);case"custom":case"anonymous":return new ol(r,null);default:return new ol(r,e,t)}}class ol{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class jk extends ol{constructor(e,t,r,s){super(e,t,r),this.username=s}}class BB extends ol{constructor(e,t){super(e,"facebook.com",t)}}class $B extends jk{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class zB extends ol{constructor(e,t){super(e,"google.com",t)}}class qB extends jk{constructor(e,t,r){super(e,"twitter.com",t,r)}}function D7(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:UB(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WB(n,e){return Z(n).setPersistence(e)}function O7(n){return Nk(n)}async function M7(n,e){return Dt(n).validatePassword(e)}function GB(n,e,t,r){return Z(n).onIdTokenChanged(e,t,r)}function HB(n,e,t){return Z(n).beforeAuthStateChanged(e,t)}function V7(n,e,t,r){return Z(n).onAuthStateChanged(e,t,r)}function L7(n){Z(n).useDeviceLanguage()}function F7(n,e){return Z(n).updateCurrentUser(e)}function j7(n){return Z(n).signOut()}function U7(n,e){return Dt(n).revokeAccessToken(e)}async function B7(n){return Z(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new So("enroll",e,t)}static _fromMfaPendingCredential(e){return new So("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return So._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return So._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Dt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Jd._fromServerResponse(r,a));G(s.mfaPendingCredential,r,"internal-error");const o=So._fromMfaPendingCredential(s.mfaPendingCredential);return new pI(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await Ar._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return G(t.user,r,"internal-error"),Ar._forOperation(t.user,t.operationType,u);default:Yn(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function $7(n,e){var s;const t=Z(n),r=e;return G(e.customData.operationType,t,"argument-error"),G((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),pI._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eb(n,e){return ht(n,"POST","/v2/accounts/mfaEnrollment:start",dt(n,e))}function KB(n,e){return ht(n,"POST","/v2/accounts/mfaEnrollment:finalize",dt(n,e))}function QB(n,e){return ht(n,"POST","/v2/accounts/mfaEnrollment:start",dt(n,e))}function YB(n,e){return ht(n,"POST","/v2/accounts/mfaEnrollment:finalize",dt(n,e))}function JB(n,e){return ht(n,"POST","/v2/accounts/mfaEnrollment:withdraw",dt(n,e))}class mI{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Jd._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new mI(e)}async getSession(){return So._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Fs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Fs(this.user,JB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const dy=new WeakMap;function z7(n){const e=Z(n);return dy.has(e)||dy.set(e,mI._fromUser(e)),dy.get(e)}const Pp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Pp,"1"),this.storage.removeItem(Pp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XB=1e3,ZB=10;class Bk extends Uk{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);$5()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,ZB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},XB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Bk.type="LOCAL";const $k=Bk;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e$=1e3;function hy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function fy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class zk{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=fy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return hy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=fy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=fy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(p=>p.name===r);h&&t(h.value),u.deleted.find(p=>p.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=hy(r);const i=setInterval(()=>{const a=hy(r);a!==s&&(t(a),s=a)},e$),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}zk.type="COOKIE";const q7=zk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk extends Uk{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}qk.type="SESSION";const Wk=qk;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t$(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Jm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await t$(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Jm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xm(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n${constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Xm("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(){return window}function r$(n){Bt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(){return typeof Bt().WorkerGlobalScope<"u"&&typeof Bt().importScripts=="function"}async function s$(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function i$(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function o$(){return gI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk="firebaseLocalStorageDb",a$=1,kp="firebaseLocalStorage",Hk="fbase_key";class Xd{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Zm(n,e){return n.transaction([kp],e?"readwrite":"readonly").objectStore(kp)}function l$(){const n=indexedDB.deleteDatabase(Gk);return new Xd(n).toPromise()}function hv(){const n=indexedDB.open(Gk,a$);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(kp,{keyPath:Hk})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(kp)?e(r):(r.close(),await l$(),e(await hv()))})})}async function tb(n,e,t){const r=Zm(n,!0).put({[Hk]:e,value:t});return new Xd(r).toPromise()}async function c$(n,e){const t=Zm(n,!1).get(e),r=await new Xd(t).toPromise();return r===void 0?null:r.value}function nb(n,e){const t=Zm(n,!0).delete(e);return new Xd(t).toPromise()}const u$=800,d$=3;class Kk{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await hv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>d$)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return gI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Jm._getInstance(o$()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await s$(),!this.activeServiceWorker)return;this.sender=new n$(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||i$()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await hv();return await tb(e,Pp,"1"),await nb(e,Pp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>tb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>c$(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Zm(s,!1).getAll();return new Xd(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),u$)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Kk.type="LOCAL";const h$=Kk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rb(n,e){return ht(n,"POST","/v2/accounts/mfaSignIn:start",dt(n,e))}function f$(n,e){return ht(n,"POST","/v2/accounts/mfaSignIn:finalize",dt(n,e))}function p$(n,e){return ht(n,"POST","/v2/accounts/mfaSignIn:finalize",dt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const py=Ck("rcb"),m$=new Hd(3e4,6e4);class g${constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=Bt().grecaptcha)!=null&&e.render)}load(e,t=""){return G(y$(t),e,"argument-error"),this.shouldResolveImmediately(t)&&qS(Bt().grecaptcha)?Promise.resolve(Bt().grecaptcha):new Promise((r,s)=>{const i=Bt().setTimeout(()=>{s(On(e,"network-request-failed"))},m$.get());Bt()[py]=()=>{Bt().clearTimeout(i),delete Bt()[py];const a=Bt().grecaptcha;if(!a||!qS(a)){s(On(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${Q5()}?${ia({onload:py,render:"explicit",hl:t})}`;lI(o).catch(()=>{clearTimeout(i),s(On(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=Bt().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function y$(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class _${async load(e){return new eB(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu="recaptcha",v$={theme:"light",type:"image"};class W7{constructor(e,t,r={...v$}){this.parameters=r,this.type=wu,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Dt(e),this.isInvisible=this.parameters.size==="invisible",G(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;G(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new _$:new g$,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){G(!this.parameters.sitekey,this.auth,"argument-error"),G(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),G(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Bt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){G(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){G(iI()&&!gI(),this.auth,"internal-error"),await w$(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await P5(this.auth);G(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return G(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function w$(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yI{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Do._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function G7(n,e,t){if(mt(n.app))return Promise.reject(rn(n));const r=Dt(n),s=await eg(r,e,Z(t));return new yI(s,i=>uI(r,i))}async function H7(n,e,t){const r=Z(n);await Qm(!1,r,"phone");const s=await eg(r.auth,e,Z(t));return new yI(s,i=>NB(r,i))}async function K7(n,e,t){const r=Z(n);if(mt(r.auth.app))return Promise.reject(rn(r.auth));const s=await eg(r.auth,e,Z(t));return new yI(s,i=>PB(r,i))}async function eg(n,e,t){var r;if(!n._getRecaptchaConfig())try{await Nk(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){G(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Di(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===vu){G((t==null?void 0:t.type)===wu,h,"argument-error");const p=await my(h,f,t);return eb(h,p)}return eb(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{G(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;G(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Di(n,a,"mfaSmsSignIn",async(f,p)=>{if(p.phoneSignInInfo.captchaResponse===vu){G((t==null?void 0:t.type)===wu,f,"argument-error");const _=await my(f,p,t);return rb(f,_)}return rb(f,p)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Di(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===vu){G((t==null?void 0:t.type)===wu,u,"argument-error");const f=await my(u,h,t);return XS(u,f)}return XS(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function Q7(n,e){const t=Z(n);if(mt(t.auth.app))return Promise.reject(rn(t.auth));await cI(t,e)}async function my(n,e,t){G(t.type===wu,n,"argument-error");const r=await t.verify();G(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e){this.providerId=al.PROVIDER_ID,this.auth=Dt(e)}verifyPhoneNumber(e,t){return eg(this.auth,e,Z(t))}static credential(e,t){return Do._fromVerification(e,t)}static credentialFromResult(e){const t=e;return al.credentialFromTaggedObject(t)}static credentialFromError(e){return al.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Do._fromTokenResponse(t,r):null}}al.PROVIDER_ID="phone";al.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ya(n,e){return e?Ss(e):(G(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _I extends Qd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Cs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Cs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Cs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function I$(n){return Lk(n.auth,new _I(n),n.bypassAuthState)}function E$(n){const{auth:e,user:t}=n;return G(t,e,"internal-error"),Vk(t,new _I(n),n.bypassAuthState)}async function T$(n){const{auth:e,user:t}=n;return G(t,e,"internal-error"),cI(t,new _I(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return I$;case"linkViaPopup":case"linkViaRedirect":return T$;case"reauthViaPopup":case"reauthViaRedirect":return E$;default:Yn(this.auth,"internal-error")}}resolve(e){Ls(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ls(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x$=new Hd(2e3,1e4);async function S$(n,e,t){if(mt(n.app))return Promise.reject(On(n,"operation-not-supported-in-this-environment"));const r=Dt(n);ic(n,e,Hs);const s=ya(r,t);return new bs(r,"signInViaPopup",e,s).executeNotNull()}async function Y7(n,e,t){const r=Z(n);if(mt(r.auth.app))return Promise.reject(On(r.auth,"operation-not-supported-in-this-environment"));ic(r.auth,e,Hs);const s=ya(r.auth,t);return new bs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function J7(n,e,t){const r=Z(n);ic(r.auth,e,Hs);const s=ya(r.auth,t);return new bs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class bs extends Qk{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,bs.currentPopupAction&&bs.currentPopupAction.cancel(),bs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return G(e,this.auth,"internal-error"),e}async onExecution(){Ls(this.filter.length===1,"Popup operations only handle one event");const e=Xm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(On(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(On(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,bs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(On(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,x$.get())};e()}}bs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b$="pendingRedirect",Ef=new Map;class A$ extends Qk{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ef.get(this.auth._key());if(!e){try{const r=await C$(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ef.set(this.auth._key(),e)}return this.bypassAuthState||Ef.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function C$(n,e){const t=Jk(e),r=Yk(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function vI(n,e){return Yk(n)._set(Jk(e),"true")}function R$(n,e){Ef.set(n._key(),e)}function Yk(n){return Ss(n._redirectPersistence)}function Jk(n){return wf(b$,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X7(n,e,t){return N$(n,e,t)}async function N$(n,e,t){if(mt(n.app))return Promise.reject(rn(n));const r=Dt(n);ic(n,e,Hs),await r._initializationPromise;const s=ya(r,t);return await vI(s,r),s._openRedirect(r,e,"signInViaRedirect")}function Z7(n,e,t){return P$(n,e,t)}async function P$(n,e,t){const r=Z(n);if(ic(r.auth,e,Hs),mt(r.auth.app))return Promise.reject(rn(r.auth));await r.auth._initializationPromise;const s=ya(r.auth,t);await vI(s,r.auth);const i=await Zk(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function eW(n,e,t){return k$(n,e,t)}async function k$(n,e,t){const r=Z(n);ic(r.auth,e,Hs),await r.auth._initializationPromise;const s=ya(r.auth,t);await Qm(!1,r,e.providerId),await vI(s,r.auth);const i=await Zk(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function tW(n,e){return await Dt(n)._initializationPromise,Xk(n,e,!1)}async function Xk(n,e,t=!1){if(mt(n.app))return Promise.reject(rn(n));const r=Dt(n),s=ya(r,e),o=await new A$(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function Zk(n){const e=Xm(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D$=10*60*1e3;class O${constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!M$(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!eD(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(On(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=D$&&this.cachedEventUids.clear(),this.cachedEventUids.has(sb(e))}saveEventToCache(e){this.cachedEventUids.add(sb(e)),this.lastProcessedEventTime=Date.now()}}function sb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function eD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function M$(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return eD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V$(n,e={}){return ht(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L$=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,F$=/^https?/;async function j$(n){if(n.config.emulator)return;const{authorizedDomains:e}=await V$(n);for(const t of e)try{if(U$(t))return}catch{}Yn(n,"unauthorized-domain")}function U$(n){const e=ud(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!F$.test(t))return!1;if(L$.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B$=new Hd(3e4,6e4);function ib(){const n=Bt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function $$(n){return new Promise((e,t)=>{var s,i,o;function r(){ib(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ib(),t(On(n,"network-request-failed"))},timeout:B$.get()})}if((i=(s=Bt().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Bt().gapi)!=null&&o.load)r();else{const a=Ck("iframefcb");return Bt()[a]=()=>{gapi.load?r():t(On(n,"network-request-failed"))},lI(`${J5()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Tf=null,e})}let Tf=null;function z$(n){return Tf=Tf||$$(n),Tf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q$=new Hd(5e3,15e3),W$="__/auth/iframe",G$="emulator/auth/iframe",H$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},K$=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Q$(n){const e=n.config;G(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?oI(e,G$):`https://${n.config.authDomain}/${W$}`,r={apiKey:e.apiKey,appName:n.name,v:oa},s=K$.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${ia(r).slice(1)}`}async function Y$(n){const e=await z$(n),t=Bt().gapi;return G(t,n,"internal-error"),e.open({where:document.body,url:Q$(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:H$,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=On(n,"network-request-failed"),a=Bt().setTimeout(()=>{i(o)},q$.get());function l(){Bt().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J$={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},X$=500,Z$=600,e9="_blank",t9="http://localhost";class ob{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function n9(n,e,t,r=X$,s=Z$){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...J$,width:r.toString(),height:s.toString(),top:i,left:o},u=Ht().toLowerCase();t&&(a=Ik(u)?e9:t),vk(u)&&(e=e||t9,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[_,T])=>`${p}${_}=${T},`,"");if(B5(u)&&a!=="_self")return r9(e||"",a),new ob(null);const f=window.open(e||"",a,h);G(f,n,"popup-blocked");try{f.focus()}catch{}return new ob(f)}function r9(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s9="__/auth/handler",i9="emulator/auth/handler",o9=encodeURIComponent("fac");async function ab(n,e,t,r,s,i){G(n.config.authDomain,n,"auth-domain-config-required"),G(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:oa,eventId:s};if(e instanceof Hs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Jf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof oc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${o9}=${encodeURIComponent(l)}`:"";return`${a9(n)}?${ia(a).slice(1)}${u}`}function a9({config:n}){return n.emulator?oI(n,i9):`https://${n.authDomain}/${s9}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gy="webStorageSupport";class l9{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wk,this._completeRedirectFn=Xk,this._overrideRedirectResult=R$}async _openPopup(e,t,r,s){var o;Ls((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await ab(e,t,r,ud(),s);return n9(e,i,Xm())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await ab(e,t,r,ud(),s);return r$(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ls(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Y$(e),r=new O$(e);return t.register("authEvent",s=>(G(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(gy,{type:gy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[gy];i!==void 0&&t(!!i),Yn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=j$(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return bk()||wk()||aI()}}const c9=l9;class tD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return ts("unexpected MultiFactorSessionType")}}}class wI extends tD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new wI(e)}_finalizeEnroll(e,t,r){return KB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return f$(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class u9{constructor(){}static assertion(e){return wI._fromCredential(e)}}u9.FACTOR_ID="phone";class d9{static assertionForEnrollment(e,t){return pd._fromSecret(e,t)}static assertionForSignIn(e,t){return pd._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;G(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await QB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return II._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}d9.FACTOR_ID="totp";class pd extends tD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new pd(t,void 0,e)}static _fromEnrollmentId(e,t){return new pd(t,e)}async _finalizeEnroll(e,t,r){return G(typeof this.secret<"u",e,"argument-error"),YB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){G(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return p$(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class II{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new II(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(qh(e)||qh(t))&&(r=!0),r&&(qh(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),qh(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function qh(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var lb="@firebase/auth",cb="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h9{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){G(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f9(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function p9(n){Br(new Qn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;G(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ak(n)},u=new H5(r,s,i,l);return aB(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Br(new Qn("auth-internal",e=>{const t=Dt(e.getProvider("auth").getImmediate());return(r=>new h9(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Hn(lb,cb,f9(n)),Hn(lb,cb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m9=5*60,g9=$A("authIdTokenMaxAge")||m9;let ub=null;const y9=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>g9)return;const s=t==null?void 0:t.token;ub!==s&&(ub=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function _9(n=Ed()){const e=hs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=oB(n,{popupRedirectResolver:c9,persistence:[h$,$k,Wk]}),r=$A("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=y9(i.toString());HB(t,o,()=>o(t.currentUser)),GB(t,a=>o(a))}}const s=jA("auth");return s&&lB(t,`http://${s}`),t}function v9(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}K5({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=On("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",v9().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});p9("Browser");const nD="@firebase/installations",EI="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD=1e4,sD=`w:${EI}`,iD="FIS_v2",w9="https://firebaseinstallations.googleapis.com/v1",I9=60*60*1e3,E9="installations",T9="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x9={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},ea=new sa(E9,T9,x9);function oD(n){return n instanceof $r&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD({projectId:n}){return`${w9}/projects/${n}/installations`}function lD(n){return{token:n.token,requestStatus:2,expiresIn:b9(n.expiresIn),creationTime:Date.now()}}async function cD(n,e){const r=(await e.json()).error;return ea.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function uD({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function S9(n,{refreshToken:e}){const t=uD(n);return t.append("Authorization",A9(e)),t}async function dD(n){const e=await n();return e.status>=500&&e.status<600?n():e}function b9(n){return Number(n.replace("s","000"))}function A9(n){return`${iD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C9({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=aD(n),s=uD(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:iD,appId:n.appId,sdkVersion:sD},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await dD(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:lD(u.authToken)}}else throw await cD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R9(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N9=/^[cdef][\w-]{21}$/,fv="";function P9(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=k9(n);return N9.test(t)?t:fv}catch{return fv}}function k9(n){return R9(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tg(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD=new Map;function pD(n,e){const t=tg(n);mD(t,e),D9(t,e)}function mD(n,e){const t=fD.get(n);if(t)for(const r of t)r(e)}function D9(n,e){const t=O9();t&&t.postMessage({key:n,fid:e}),M9()}let bo=null;function O9(){return!bo&&"BroadcastChannel"in self&&(bo=new BroadcastChannel("[Firebase] FID Change"),bo.onmessage=n=>{mD(n.data.key,n.data.fid)}),bo}function M9(){fD.size===0&&bo&&(bo.close(),bo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V9="firebase-installations-database",L9=1,ta="firebase-installations-store";let yy=null;function TI(){return yy||(yy=eC(V9,L9,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ta)}}})),yy}async function Dp(n,e){const t=tg(n),s=(await TI()).transaction(ta,"readwrite"),i=s.objectStore(ta),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&pD(n,e.fid),e}async function gD(n){const e=tg(n),r=(await TI()).transaction(ta,"readwrite");await r.objectStore(ta).delete(e),await r.done}async function ng(n,e){const t=tg(n),s=(await TI()).transaction(ta,"readwrite"),i=s.objectStore(ta),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&pD(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xI(n){let e;const t=await ng(n.appConfig,r=>{const s=F9(r),i=j9(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===fv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function F9(n){const e=n||{fid:P9(),registrationStatus:0};return yD(e)}function j9(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(ea.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=U9(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:B9(n)}:{installationEntry:e}}async function U9(n,e){try{const t=await C9(n,e);return Dp(n.appConfig,t)}catch(t){throw oD(t)&&t.customData.serverCode===409?await gD(n.appConfig):await Dp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function B9(n){let e=await db(n.appConfig);for(;e.registrationStatus===1;)await hD(100),e=await db(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await xI(n);return r||t}return e}function db(n){return ng(n,e=>{if(!e)throw ea.create("installation-not-found");return yD(e)})}function yD(n){return $9(n)?{fid:n.fid,registrationStatus:0}:n}function $9(n){return n.registrationStatus===1&&n.registrationTime+rD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z9({appConfig:n,heartbeatServiceProvider:e},t){const r=q9(n,t),s=S9(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:sD,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await dD(()=>fetch(r,a));if(l.ok){const u=await l.json();return lD(u)}else throw await cD("Generate Auth Token",l)}function q9(n,{fid:e}){return`${aD(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SI(n,e=!1){let t;const r=await ng(n.appConfig,i=>{if(!_D(i))throw ea.create("not-registered");const o=i.authToken;if(!e&&H9(o))return i;if(o.requestStatus===1)return t=W9(n,e),i;{if(!navigator.onLine)throw ea.create("app-offline");const a=Q9(i);return t=G9(n,a),a}});return t?await t:r.authToken}async function W9(n,e){let t=await hb(n.appConfig);for(;t.authToken.requestStatus===1;)await hD(100),t=await hb(n.appConfig);const r=t.authToken;return r.requestStatus===0?SI(n,e):r}function hb(n){return ng(n,e=>{if(!_D(e))throw ea.create("not-registered");const t=e.authToken;return Y9(t)?{...e,authToken:{requestStatus:0}}:e})}async function G9(n,e){try{const t=await z9(n,e),r={...e,authToken:t};return await Dp(n.appConfig,r),t}catch(t){if(oD(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await gD(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Dp(n.appConfig,r)}throw t}}function _D(n){return n!==void 0&&n.registrationStatus===2}function H9(n){return n.requestStatus===2&&!K9(n)}function K9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+I9}function Q9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function Y9(n){return n.requestStatus===1&&n.requestTime+rD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J9(n){const e=n,{installationEntry:t,registrationPromise:r}=await xI(e);return r?r.catch(console.error):SI(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X9(n,e=!1){const t=n;return await Z9(t),(await SI(t,e)).token}async function Z9(n){const{registrationPromise:e}=await xI(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ez(n){if(!n||!n.options)throw _y("App Configuration");if(!n.name)throw _y("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw _y(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function _y(n){return ea.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vD="installations",tz="installations-internal",nz=n=>{const e=n.getProvider("app").getImmediate(),t=ez(e),r=hs(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},rz=n=>{const e=n.getProvider("app").getImmediate(),t=hs(e,vD).getImmediate();return{getId:()=>J9(t),getToken:s=>X9(t,s)}};function sz(){Br(new Qn(vD,nz,"PUBLIC")),Br(new Qn(tz,rz,"PRIVATE"))}sz();Hn(nD,EI);Hn(nD,EI,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op="analytics",iz="firebase_id",oz="origin",az=60*1e3,lz="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",bI="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kn=new Id("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cz={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},lr=new sa("analytics","Analytics",cz);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uz(n){if(!n.startsWith(bI)){const e=lr.create("invalid-gtag-resource",{gtagURL:n});return Kn.warn(e.message),""}return n}function wD(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function dz(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function hz(n,e){const t=dz("firebase-js-sdk-policy",{createScriptURL:uz}),r=document.createElement("script"),s=`${bI}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function fz(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function pz(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await wD(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){Kn.error(a)}n("config",s,i)}async function mz(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await wD(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Kn.error(i)}}function gz(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await mz(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await pz(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Kn.error(a)}}return s}function yz(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=gz(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function _z(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(bI)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vz=30,wz=1e3;class Iz{constructor(e={},t=wz){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const ID=new Iz;function Ez(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function Tz(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:Ez(t)},s=lz.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw lr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function xz(n,e=ID,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw lr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw lr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Az;return setTimeout(async()=>{a.abort()},t!==void 0?t:az),ED({appId:r,apiKey:s,measurementId:i},o,a,e)}async function ED(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=ID){var a;const{appId:i,measurementId:o}=n;try{await Sz(r,e)}catch(l){if(o)return Kn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await Tz(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!bz(u)){if(s.deleteThrottleMetadata(i),o)return Kn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?AT(t,s.intervalMillis,vz):AT(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),Kn.debug(`Calling attemptFetch again in ${h} millis`),ED(n,f,r,s)}}function Sz(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(lr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function bz(n){if(!(n instanceof $r)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class Az{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Cz(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rz(){if(Zp())try{await h0()}catch(n){return Kn.warn(lr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Kn.warn(lr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Nz(n,e,t,r,s,i,o){const a=xz(n);a.then(p=>{t[p.measurementId]=p.appId,n.options.measurementId&&p.measurementId!==n.options.measurementId&&Kn.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>Kn.error(p)),e.push(a);const l=Rz().then(p=>{if(p)return r.getId()}),[u,h]=await Promise.all([a,l]);_z(i)||hz(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[oz]="firebase",f.update=!0,h!=null&&(f[iz]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pz{constructor(e){this.app=e}_delete(){return delete Iu[this.app.options.appId],Promise.resolve()}}let Iu={},fb=[];const pb={};let vy="dataLayer",kz="gtag",mb,TD,gb=!1;function Dz(){const n=[];if(d0()&&n.push("This is a browser extension environment."),QA()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=lr.create("invalid-analytics-context",{errorInfo:e});Kn.warn(t.message)}}function Oz(n,e,t){Dz();const r=n.options.appId;if(!r)throw lr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Kn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw lr.create("no-api-key");if(Iu[r]!=null)throw lr.create("already-exists",{id:r});if(!gb){fz(vy);const{wrappedGtag:i,gtagCore:o}=yz(Iu,fb,pb,vy,kz);TD=i,mb=o,gb=!0}return Iu[r]=Nz(n,fb,pb,e,mb,vy,t),new Pz(n)}function Mz(n=Ed()){n=Z(n);const e=hs(n,Op);return e.isInitialized()?e.getImmediate():Vz(n)}function Vz(n,e={}){const t=hs(n,Op);if(t.isInitialized()){const s=t.getImmediate();if(ur(e,t.getOptions()))return s;throw lr.create("already-initialized")}return t.initialize({options:e})}async function Lz(){if(d0()||!QA()||!Zp())return!1;try{return await h0()}catch{return!1}}function Fz(n,e,t,r){n=Z(n),Cz(TD,Iu[n.app.options.appId],e,t,r).catch(s=>Kn.error(s))}const yb="@firebase/analytics",_b="0.10.18";function jz(){Br(new Qn(Op,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return Oz(r,s,t)},"PUBLIC")),Br(new Qn("analytics-internal",n,"PRIVATE")),Hn(yb,_b),Hn(yb,_b,"esm2020");function n(e){try{const t=e.getProvider(Op).getImmediate();return{logEvent:(r,s,i)=>Fz(t,r,s,i)}}catch(t){throw lr.create("interop-component-reg-failed",{reason:t})}}}jz();const xD={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},rg=ZV().length?Ed():tC(xD),re=x4(rg,xD.databaseURL),xf=Q6(rg),_i=_9(rg);console.log("✅ Firebase services initialized:",{db:!!re,firestore:!!xf,auth:!!_i});WB(_i,$k).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let Uz=null;(async()=>{try{await Lz()&&(Uz=Mz(rg))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();class AI{constructor(e,t){this.db=e,this.userUID=t,this.userRef=we(e,`users/${t}`),this.statsRef=we(e,`users/${t}/stats`),this.profileRef=we(e,`users/${t}/profile`),this.behaviorLogRef=we(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{const s=await Nt(this.statsRef);if(!s.exists())return!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));return await Yt(this.statsRef,{...i,[e]:a}),await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`Error updating ${e}:`,s),!1}}async updateAddictionFromCleanTime(){try{const e=await Nt(we(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Nt(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapsePenaltyLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{const e=new Date,t=await Nt(we(this.db,`users/${this.userUID}/profile/relapseDate`));let r=1;if(t.exists()){const i=new Date(t.val()),o=Math.floor((e-i)/(1e3*60*60*24));o<=3?r=3:o<=7?r=2:r=1}let s=0;switch(r){case 1:s=4;break;case 2:s=6;break;case 3:s=8;break}return await Promise.all([this.updateStat("addictionLevel",s,`Relapse penalty level ${r}`),this.updateStat("mentalStrength",-3,"Relapse setback"),this.updateStat("triggerDefense",-3,"Relapse to known trigger")]),await Yt(we(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),await this.logBehavior("relapse",r,`Penalty level ${r} - ${s} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapsePenaltyLevel(){try{await Yt(we(this.db,`users/${this.userUID}/profile/relapsePenaltyLevel`),1),console.log("Relapse penalty level reset")}catch(e){console.error("Error resetting relapse penalty level:",e)}}async handleCravingResistance(){try{return await Promise.all([this.updateStat("mentalStrength",1,"Successful craving resistance"),this.updateStat("triggerDefense",3,"Surviving trigger situation")]),await this.trackAppUsageDuringCravings(),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Yt(we(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Yt(we(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await Nt(we(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Nt(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await Nt(we(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),Yt(we(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString();return await Yt(we(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),await this.checkInactivityPenalty(),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async checkMoneyMilestones(){var e;try{const t=await Nt(we(this.db,`users/${this.userUID}/profile/relapseDate`)),r=await Nt(this.userRef);if(!r.exists())return;const s=r.val(),i=t.exists()?new Date(t.val()):new Date(s.quitDate||Date.now()),u=Math.floor((new Date-i)/(1e3*60*60*24))*10,h=[50,100,200,500,1e3];for(const f of h)if(u>=f){const p=`moneyMilestone_${f}`;(await Nt(we(this.db,`users/${this.userUID}/profile/${p}`))).exists()||await Promise.all([this.updateStat("motivation",2,`$${f} saved milestone`),Yt(we(this.db,`users/${this.userUID}/profile/${p}`),!0)])}await this.updateStat("moneySaved",u-(((e=r.val().stats)==null?void 0:e.moneySaved)||0),"Money saved calculation")}catch(t){console.error("Error checking money milestones:",t)}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Nt(we(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Nt(we(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Nt(we(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{let e=null;for(let t=0;t<10;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Nt(we(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));if(i.exists()&&i.val()){e=t;break}}(e===null||e>=7)&&await this.updateStat("motivation",-3,"Long period inactive (7+ days)")}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await Nt(we(this.db,`users/${this.userUID}/profile/${t}`));let s=r.exists()?r.val():0;s++,await Yt(we(this.db,`users/${this.userUID}/profile/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await _R(we(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkMoneyMilestones(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates(),console.log("StatManager initialized successfully")}catch(e){console.error("Error initializing StatManager:",e)}}}class Bz{constructor(e){this.db=e,this.matchingPoolRef=we(e,"matchingPool"),this.buddyPairsRef=we(e,"buddyPairs"),this.usersRef=we(e,"users")}async addToMatchingPool(e,t){var r;try{const s={userId:e,quitStartDate:t.quitDate||new Date().toISOString(),addictionLevel:((r=t.stats)==null?void 0:r.addictionLevel)||50,triggers:t.triggers||[],timezone:t.timezone||"UTC",quitExperience:t.quitExperience||"first-timer",availableForMatching:!0,lastActive:new Date().toISOString(),createdAt:new Date().toISOString(),archetype:t.archetype||"DETERMINED",dailyPatterns:t.dailyPatterns||[],copingStrategies:t.copingStrategies||[],confidence:t.confidence||5,preferredContactMethod:"chat",availabilityHours:t.availabilityHours||"anytime",language:t.language||"en"};return await Yt(we(this.db,`matchingPool/${e}`),s),console.log(`✅ User ${e} added to matching pool`),!0}catch(s){return console.error("❌ Error adding user to matching pool:",s),!1}}async removeFromMatchingPool(e){try{return await l4(we(this.db,`matchingPool/${e}`)),console.log(`✅ User ${e} removed from matching pool`),!0}catch(t){return console.error("❌ Error removing user from matching pool:",t),!1}}async updateMatchingAvailability(e,t){try{return await Yt(we(this.db,`matchingPool/${e}/availableForMatching`),t),await Yt(we(this.db,`matchingPool/${e}/lastActive`),new Date().toISOString()),console.log(`✅ User ${e} matching availability updated to: ${t}`),!0}catch(r){return console.error("❌ Error updating matching availability:",r),!1}}async updateLastActive(e){try{return await Yt(we(this.db,`matchingPool/${e}/lastActive`),new Date().toISOString()),!0}catch(t){return console.error("❌ Error updating last active:",t),!1}}async findCompatibleMatches(e,t=5){try{const r=await Nt(we(this.db,`matchingPool/${e}`));if(!r.exists())return console.log("❌ User not found in matching pool"),[];const s=r.val(),i=await Nt(this.matchingPoolRef);if(!i.exists())return console.log("❌ No users in matching pool"),[];const o=i.val(),a=[];for(const[l,u]of Object.entries(o)){if(l===e||!u.availableForMatching)continue;const h=this.calculateCompatibilityScore(s,u);h>=.1&&a.push({userId:l,profile:u,compatibilityScore:h,matchReasons:this.getMatchReasons(s,u)})}return a.sort((l,u)=>u.compatibilityScore-l.compatibilityScore),a.slice(0,t)}catch(r){return console.error("❌ Error finding compatible matches:",r),[]}}calculateCompatibilityScore(e,t){let r=0,s=0;const i=new Date(e.quitStartDate),o=new Date(t.quitStartDate),a=Math.abs(i-o)/(1e3*60*60*24),l=Math.max(0,1-a/30);r+=l*.3,s+=.3;const u=Math.abs(e.addictionLevel-t.addictionLevel),h=Math.max(0,1-u/100);r+=h*.25,s+=.25;const f=e.timezone===t.timezone?1:.5;r+=f*.2,s+=.2;const p=e.quitExperience===t.quitExperience?1:.7;r+=p*.15,s+=.15;const _=e.triggers.filter(b=>t.triggers.includes(b)).length,T=Math.min(1,_/Math.max(e.triggers.length,1));return r+=T*.1,s+=.1,r/s}getMatchReasons(e,t){const r=[],s=new Date(e.quitStartDate),i=new Date(t.quitStartDate),o=Math.abs(s-i)/(1e3*60*60*24);o<=7?r.push("Started quitting around the same time"):o<=30&&r.push("Similar quit journey timeline"),Math.abs(e.addictionLevel-t.addictionLevel)<=10&&r.push("Similar addiction levels"),e.timezone===t.timezone&&r.push("Same timezone for easy communication"),e.quitExperience===t.quitExperience&&r.push(`Both ${e.quitExperience}s`);const l=e.triggers.filter(u=>t.triggers.includes(u));return l.length>0&&r.push(`Shared triggers: ${l.join(", ")}`),r}async createBuddyPair(e,t,r={}){try{const s=_R(this.buddyPairsRef).key,i={pairId:s,users:[e,t],matchedAt:new Date().toISOString(),compatibilityScore:r.compatibilityScore||0,matchReasons:r.matchReasons||[],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};return await Yt(we(this.db,`buddyPairs/${s}`),i),await Promise.all([this.removeFromMatchingPool(e),this.removeFromMatchingPool(t)]),await Promise.all([Yt(we(this.db,`users/${e}/buddyInfo`),{hasBuddy:!0,buddyId:t,pairId:s,matchedAt:i.matchedAt}),Yt(we(this.db,`users/${t}/buddyInfo`),{hasBuddy:!0,buddyId:e,pairId:s,matchedAt:i.matchedAt})]),console.log(`✅ Buddy pair created between ${e} and ${t}`),!0}catch(s){return console.error("❌ Error creating buddy pair:",s),!1}}async getUserBuddyInfo(e){try{const t=await Nt(we(this.db,`users/${e}/buddyInfo`));return t.exists()?t.val():null}catch(t){return console.error("❌ Error getting user buddy info:",t),null}}async getBuddyPairInfo(e){try{const t=await Nt(we(this.db,`buddyPairs/${e}`));return t.exists()?t.val():null}catch(t){return console.error("❌ Error getting buddy pair info:",t),null}}async forceMatchUsers(e,t){try{console.log(`🔧 Force matching users ${e} and ${t}`);const r={compatibilityScore:.95,matchReasons:["Force matched for testing","High compatibility detected"],matchedAt:Date.now()},s=await this.createBuddyPair(e,t,r);return s&&console.log(`✅ Force match successful between ${e} and ${t}`),s}catch(r){return console.error("❌ Error force matching users:",r),!1}}async cleanupInactiveUsers(e=30){try{const t=await Nt(this.matchingPoolRef);if(!t.exists())return 0;const r=t.val(),s=new Date;s.setDate(s.getDate()-e);let i=0;for(const[o,a]of Object.entries(r))new Date(a.lastActive)<s&&(await this.removeFromMatchingPool(o),i++);return console.log(`✅ Cleaned up ${i} inactive users from matching pool`),i}catch(t){return console.error("❌ Error cleaning up inactive users:",t),0}}async getMatchingPoolStats(){try{const e=await Nt(this.matchingPoolRef);if(!e.exists())return{totalUsers:0,availableUsers:0,averageAddictionLevel:0,topTriggers:[],timezoneDistribution:{}};const t=e.val(),r=Object.values(t);return{totalUsers:r.length,availableUsers:r.filter(i=>i.availableForMatching).length,averageAddictionLevel:r.reduce((i,o)=>i+(o.addictionLevel||0),0)/r.length,topTriggers:this.getTopTriggers(r),timezoneDistribution:this.getTimezoneDistribution(r),quitExperienceDistribution:this.getQuitExperienceDistribution(r)}}catch(e){return console.error("❌ Error getting matching pool stats:",e),null}}getTopTriggers(e){const t={};return e.forEach(r=>{var s;(s=r.triggers)==null||s.forEach(i=>{t[i]=(t[i]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimezoneDistribution(e){const t={};return e.forEach(r=>{const s=r.timezone||"Unknown";t[s]=(t[s]||0)+1}),t}getQuitExperienceDistribution(e){const t={};return e.forEach(r=>{const s=r.quitExperience||"unknown";t[s]=(t[s]||0)+1}),t}listenToMatchingPoolStatus(e,t){const r=we(this.db,`matchingPool/${e}`);return M_(r,i=>{i.exists()?t(i.val()):t(null)})}listenToBuddyPair(e,t){const r=we(this.db,`buddyPairs/${e}`);return M_(r,i=>{i.exists()?t(i.val()):t(null)})}async getAllMatchingPoolUsers(){try{const e=await Nt(this.matchingPoolRef);if(!e.exists())return console.log("❌ No users in matching pool"),[];const t=e.val(),r=Object.entries(t).map(([s,i])=>({id:s,...i}));return console.log("📊 Matching pool users:",r),r}catch(e){return console.error("❌ Error getting matching pool users:",e),[]}}async forceMatchUsers(e,t){try{console.log(`🔧 Force matching users ${e} and ${t}`);const r={compatibilityScore:.95,matchReasons:["Force matched for testing","High compatibility detected"],matchedAt:Date.now()},s=await this.createBuddyPair(e,t,r);return s&&console.log(`✅ Force match successful between ${e} and ${t}`),s}catch(r){return console.error("❌ Error force matching users:",r),!1}}}class Eu{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=cy(e,"matchingPool"),this.buddyPairsCollection=cy(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:Bh(),lastActive:Bh(),status:"waiting"};return await FS(Hc(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await jS(Hc(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:Bh(),status:"active",...r},i=await a5(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await o5(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=Hc(this.matchingPoolCollection,e),r=await i5(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async testConnectivity(){try{console.log("🧪 Firestore: Testing connectivity...");const e=cy(this.firestore,"connectionTest"),t=Hc(e,"test-"+Date.now()),r={test:!0,timestamp:Bh(),message:"Firestore connectivity test",service:"FirestoreBuddyService"};return await FS(t,r),console.log("✅ Firestore: Connectivity test successful"),await jS(t),console.log("🧹 Firestore: Test document cleaned up"),!0}catch(e){return console.error("❌ Firestore: Connectivity test failed:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}const $z=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=j.useState("signin"),[s,i]=j.useState(""),[o,a]=j.useState(""),[l,u]=j.useState(""),[h,f]=j.useState(!1),[p,_]=j.useState(!1),[T,b]=j.useState(""),[k,C]=j.useState(""),[x,R]=j.useState(!1);j.useEffect(()=>()=>{p&&_(!1)},[p]);const P=new ws;P.addScope("email"),P.addScope("profile"),P.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const U=()=>{i(""),a(""),u(""),b(""),C("")},F=async()=>{f(!0),_(!0),b("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:P.scopes,customParameters:P.customParameters});const v=S$(_i,P),N=new Promise((X,ge)=>{setTimeout(()=>ge(new Error("Popup timeout - please try again")),6e4)}),S=await Promise.race([v,N]);if(S&&S.user){const X=S.user;console.log("Google sign-in successful for:",X.email,"UID:",X.uid),console.log("User display name:",X.displayName),console.log("User photo URL:",X.photoURL),await new Promise(ge=>setTimeout(ge,800)),n(X)}else throw new Error("No user data received from Google authentication")}catch(v){console.error("Google sign-in error:",v),v.code==="auth/popup-closed-by-user"?b("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):v.code==="auth/popup-blocked"?b("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):v.code==="auth/cancelled-popup-request"?b("Google sign-in was cancelled. Please try again and complete the authentication process."):v.code==="auth/account-exists-with-different-credential"?b("An account already exists with this email using a different sign-in method. Please use email/password instead."):v.message==="Popup timeout - please try again"?b("Google sign-in popup timed out. Please try again and complete the account selection quickly."):v.code==="auth/network-request-failed"?b("Network error during Google sign-in. Please check your internet connection and try again."):v.code==="auth/operation-not-allowed"?b("Google sign-in is not enabled for this app. Please contact support."):b(y(v.code))}finally{f(!1),_(!1)}},A=async v=>{v.preventDefault(),f(!0),b("");try{const S=(await VB(_i,s,o)).user;console.log("Email sign-in successful for:",S.email),n(S)}catch(N){console.error("Email sign-in error:",N),b(y(N.code))}finally{f(!1)}},w=async v=>{if(v.preventDefault(),f(!0),b(""),o!==l){b("Passwords do not match"),f(!1);return}if(o.length<6){b("Password must be at least 6 characters long"),f(!1);return}try{const S=(await MB(_i,s,o)).user;console.log("Email sign-up successful for:",S.email),await FB(S),n(S)}catch(N){console.error("Email sign-up error:",N),b(y(N.code))}finally{f(!1)}},E=async v=>{if(v.preventDefault(),!s){b("Please enter your email address");return}f(!0),b("");try{await DB(_i,s),C("Password reset email sent! Check your inbox.")}catch(N){console.error("Password reset error:",N),b(y(N.code))}finally{f(!1)}},y=v=>{switch(v){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return x?d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),d.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),d.jsxs("form",{onSubmit:E,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:s,onChange:v=>i(v.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),T&&d.jsx("div",{className:"text-red-400 text-sm",children:T}),k&&d.jsx("div",{className:"text-green-400 text-sm",children:k}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"button",onClick:()=>{R(!1),b(""),C("")},className:"flex-1 px-4 py-2 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Back to Login"}),d.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Sending...":"Send Reset Link"})]})]})]})}):d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),d.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),d.jsxs("div",{children:[p&&d.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[d.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),d.jsx("button",{onClick:F,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),d.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:p?d.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,T&&d.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[d.jsx("div",{className:"text-red-300 text-sm mb-2",children:T}),T.includes("Google sign-in")&&!p&&d.jsx("button",{onClick:F,disabled:h,className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),d.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[d.jsx("button",{onClick:()=>{r("signin"),U()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),d.jsx("button",{onClick:()=>{r("signup"),U()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&d.jsxs("form",{onSubmit:A,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signin-email",type:"email",value:s,onChange:v=>i(v.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signin-password",type:"password",value:o,onChange:v=>a(v.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("button",{type:"button",onClick:()=>R(!0),className:"text-sm text-blue-400 hover:text-blue-300",children:"Forgot your password?"})}),T&&d.jsx("div",{className:"text-red-400 text-sm",children:T}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&d.jsxs("form",{onSubmit:w,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signup-email",type:"email",value:s,onChange:v=>i(v.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signup-password",type:"password",value:o,onChange:v=>a(v.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),d.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:v=>u(v.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),T&&d.jsx("div",{className:"text-red-400 text-sm",children:T}),k&&d.jsx("div",{className:"text-green-400 text-sm",children:k}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Creating account...":"Create Account"})]})]})})},zz=()=>{const[n,e]=j.useState(navigator.onLine),[t,r]=j.useState(!1);return j.useEffect(()=>{const s=()=>{e(!0),r(!1),console.log("🌐 Connection restored")},i=()=>{e(!1),r(!0),console.log("📡 Connection lost")};return window.addEventListener("online",s),window.addEventListener("offline",i),e(navigator.onLine),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",i)}},[]),n?null:d.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),d.jsx("span",{className:"font-medium",children:"You're offline. Some features may be limited."}),d.jsx("button",{onClick:()=>r(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors",children:d.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t&&d.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[d.jsx("p",{className:"mb-2",children:"While offline, you can:"}),d.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[d.jsx("li",{children:"• View your current stats and progress"}),d.jsx("li",{children:"• Track habits and cravings"}),d.jsx("li",{children:"• Play distraction games"}),d.jsx("li",{children:"• View your profile information"})]}),d.jsx("p",{className:"mt-2 text-yellow-200",children:"Changes will sync when you're back online."})]})]})};var qz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Wz=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Gz=(n,e)=>{const t=j.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>j.createElement("svg",{ref:u,...qz,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${Wz(n)}`,...l},[...e.map(([h,f])=>j.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var Ln=Gz;const Hz=Ln("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Kz=Ln("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),SD=Ln("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),bD=Ln("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Qz=Ln("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Yz=Ln("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Wh=Ln("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),AD=Ln("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),md=Ln("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Jz=Ln("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),CD=Ln("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Xz=Ln("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),RD=Ln("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),ND=Ln("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),PD=Ln("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);console.log("🧪 FirestoreBuddyService import check:",!!Eu);console.log("🧪 FirestoreBuddyService type:",typeof Eu);console.log("🧪 FirestoreBuddyService constructor:",Eu==null?void 0:Eu.name);const _s=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},Gh=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},Zz=({onComplete:n,authUser:e})=>{const[t,r]=j.useState(1),[s,i]=j.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[h,f]=j.useState(null),[p,_]=j.useState(null),T=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:md},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:PD},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:bD},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:SD}],b=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],k=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],C=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],x=()=>{console.log("Calculating stats with userData:",s);let y=40;s.vapePodsPerWeek<=1?y+=5:s.vapePodsPerWeek<=3?y+=15:s.vapePodsPerWeek<=5?y+=25:s.vapePodsPerWeek<=7?y+=35:y+=40;const v=s.nicotineStrength||"",N=parseInt(v.replace("mg",""))||0;N<=5?y+=0:N<=11?y+=10:N<=20?y+=20:y+=25,s.dailyPatterns.includes("Throughout the day")?y+=20:s.dailyPatterns.length>2?y+=10:y+=0,y=Math.min(y,100);let S=25;s.confidence>=9?S+=35:s.confidence>=7?S+=25:s.confidence>=4?S+=15:S+=0,s.quitAttempts==="first"?S+=15:parseInt(s.quitAttempts)<=3?S+=10:S+=5,s.copingStrategies.length>=3?S+=15:s.copingStrategies.length>=1?S+=10:S+=0,S=Math.min(S,80);let X=35;X+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[s.archetype]||0,s.confidence>=8?X+=25:s.confidence>=5?X+=15:X+=0,s.quitAttempts==="first"?X+=10:parseInt(s.quitAttempts)<=3?X+=5:X+=15,X=Math.min(X,90);let he=15;s.triggers.length<=2?he+=15:s.triggers.length<=4?he+=10:he+=5;const Fe=s.triggers.includes("Drinking alcohol"),W=s.triggers.includes("Social situations");return Fe&&W?he+=0:s.triggers.length>3?he+=5:he+=10,s.copingStrategies.length>=3?he+=25:s.copingStrategies.length>=1?he+=15:he+=0,s.dailyPatterns.includes("Throughout the day")?he+=0:s.dailyPatterns.length>2?he+=5:he+=10,he=Math.min(he,60),{addictionLevel:y,mentalStrength:S,motivation:X,triggerDefense:he}},R=y=>{const v=y.target.files[0];if(v){f(v);const N=new FileReader;N.onload=S=>_(S.target.result),N.readAsDataURL(v)}},P=async()=>{if(h){u(!0);try{const y=document.createElement("canvas"),v=y.getContext("2d"),N=new Image;N.onload=()=>{y.width=200,y.height=200,v.filter="contrast(1.2) saturate(1.3) brightness(1.1)",v.drawImage(N,0,0,200,200),v.globalCompositeOperation="overlay",v.fillStyle="rgba(255, 200, 200, 0.1)",v.fillRect(0,0,200,200);const S=y.toDataURL("image/png"),X={...s,avatar:S};i(X),E(X,3),u(!1)},N.src=p}catch(y){console.error("Photo processing failed:",y);const v=Gh(s.avatarSeed);i(N=>({...N,avatar:v})),u(!1)}}},U=()=>{a(!0);const y=Math.random().toString(36).substring(7);(async()=>{try{const N=_s(y),S={...s,avatarSeed:y,avatar:N};i(S),E(S,3)}catch{const S=Gh(y),X={...s,avatarSeed:y,avatar:S};i(X),E(X,3)}})(),setTimeout(()=>a(!1),500)},F=async()=>{if(t<10)await E(s,t),r(t+1);else try{console.log("Completing onboarding with userData:",s);const y=x();console.log("Calculated stats:",y);const v={...s,stats:{...y,streakDays:0,moneySaved:0,experiencePoints:0},achievements:[],quitDate:new Date};await E(v,10),console.log("Final user data:",v),n(v)}catch(y){console.error("Error completing onboarding:",y);const N={...s,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,moneySaved:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await E(N,10)}catch(S){console.error("Failed to save fallback data to Firebase:",S)}console.log("Using fallback stats:",N),n(N)}},A=()=>{t>1&&r(t-1)},w=()=>{switch(t){case 1:return s.heroName.trim().length>0;case 2:return s.archetype!=="";case 3:return s.avatar!==null;case 4:return s.triggers.length>0;case 5:return s.dailyPatterns.length>0;case 6:return s.copingStrategies.length>0;case 7:return s.vapePodsPerWeek>0;case 8:return s.nicotineStrength!=="";case 9:return s.quitAttempts!=="";case 10:return s.confidence>0;default:return!1}},E=async(y,v)=>{if(e)try{const{ref:N,set:S}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),X=N(re,`users/${e.uid}/onboarding`);await S(N(re,`users/${e.uid}/onboarding/step${v}`),{...y,stepNumber:v,timestamp:Date.now()}),await S(N(re,`users/${e.uid}/onboarding/progress`),{currentStep:v,completedSteps:Array.from({length:v},(ge,he)=>he+1),lastUpdated:Date.now()}),console.log(`Step ${v} saved to Firebase successfully`)}catch(N){console.error(`Error saving step ${v} to Firebase:`,N)}};return j.useEffect(()=>{if(!s.avatar){const y=_s(s.avatarSeed);i(v=>({...v,avatar:y}))}},[]),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(y=>d.jsxs("div",{className:"flex items-center flex-shrink-0",children:[d.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${y<=t?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:y<t?"✓":y}),y<10&&d.jsx("div",{className:`w-4 h-1 mx-1 ${y<t?"bg-blue-500":"bg-slate-600"}`})]},y))}),t===1&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(Jz,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),d.jsx("input",{type:"text",value:s.heroName,onChange:y=>{const v={...s,heroName:y.target.value};i(v),y.target.value.trim().length>0&&E(v,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t===2&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(md,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),d.jsx("div",{className:"space-y-3 mb-6",children:T.map(y=>{const v=y.icon;return d.jsx("button",{onClick:()=>{const N={...s,archetype:y.id};i(N),E(N,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.archetype===y.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 ${y.color} rounded-lg flex items-center justify-center`,children:d.jsx(v,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-white font-semibold",children:y.name}),d.jsx("p",{className:"text-gray-400 text-sm",children:y.description})]})]})},y.id)})})]}),t===3&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(ND,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:s.avatar?d.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{i(y=>({...y,avatar:Gh(y.avatarSeed)}))}}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(Wh,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),d.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"hidden",id:"photo-upload"}),d.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),p&&d.jsx("div",{className:"mb-4",children:d.jsx("button",{onClick:P,disabled:l,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?d.jsxs(d.Fragment,{children:[d.jsx(Wh,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):d.jsx(d.Fragment,{children:"✨ Convert to Anime"})})}),d.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),d.jsx("button",{onClick:U,disabled:o,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:o?d.jsxs(d.Fragment,{children:[d.jsx(Wh,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):d.jsxs(d.Fragment,{children:[d.jsx(Wh,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),d.jsx("button",{onClick:()=>{const y=Gh(s.avatarSeed),v={...s,avatar:y};i(v),E(v,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),t===4&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:b.map(y=>d.jsx("button",{onClick:()=>{const v={...s,triggers:s.triggers.includes(y)?s.triggers.filter(N=>N!==y):[...s.triggers,y]};i(v),E(v,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.triggers.includes(y)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.triggers.includes(y)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.triggers.includes(y)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:y})]})},y))})]}),t===5&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📅"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:k.map(y=>d.jsx("button",{onClick:()=>{const v={...s,dailyPatterns:s.dailyPatterns.includes(y)?s.dailyPatterns.filter(N=>N!==y):[...s.dailyPatterns,y]};i(v),E(v,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.dailyPatterns.includes(y)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.dailyPatterns.includes(y)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.dailyPatterns.includes(y)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:y})]})},y))})]}),t===6&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🛡️"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:C.map(y=>d.jsx("button",{onClick:()=>{const v={...s,copingStrategies:s.copingStrategies.includes(y)?s.copingStrategies.filter(N=>N!==y):[...s.copingStrategies,y]};i(v),E(v,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.copingStrategies.includes(y)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.copingStrategies.includes(y)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.copingStrategies.includes(y)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:y})]})},y))})]}),t===7&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🚬"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.vapePodsPerWeek,onChange:y=>{const v={...s,vapePodsPerWeek:parseFloat(y.target.value)||0};i(v),v.vapePodsPerWeek>0&&E(v,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select pods per week"}),d.jsx("option",{value:"0.5",children:"0.5 pods"}),d.jsx("option",{value:"1",children:"1 pod"}),d.jsx("option",{value:"2",children:"2 pods"}),d.jsx("option",{value:"3",children:"3 pods"}),d.jsx("option",{value:"4",children:"4 pods"}),d.jsx("option",{value:"5",children:"5 pods"}),d.jsx("option",{value:"6",children:"6 pods"}),d.jsx("option",{value:"7",children:"7 pods"}),d.jsx("option",{value:"8",children:"8+ pods"})]})})]}),t===8&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"⚡"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.nicotineStrength,onChange:y=>{const v={...s,nicotineStrength:y.target.value};i(v),v.nicotineStrength&&E(v,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select nicotine strength"}),d.jsx("option",{value:"3mg",children:"3mg"}),d.jsx("option",{value:"6mg",children:"6mg"}),d.jsx("option",{value:"12mg",children:"12mg"}),d.jsx("option",{value:"18mg",children:"18mg"}),d.jsx("option",{value:"20mg",children:"20mg"}),d.jsx("option",{value:"50mg",children:"50mg"})]})})]}),t===9&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📚"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.quitAttempts,onChange:y=>{const v={...s,quitAttempts:y.target.value};i(v),v.quitAttempts&&E(v,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select option"}),d.jsx("option",{value:"first",children:"This is my first attempt"}),d.jsx("option",{value:"1",children:"Once before"}),d.jsx("option",{value:"2",children:"Twice before"}),d.jsx("option",{value:"3",children:"3-5 times"}),d.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),t===10&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),d.jsx("input",{type:"range",min:"1",max:"10",value:s.confidence,onChange:y=>{const v={...s,confidence:parseInt(y.target.value)};i(v),E(v,10)},className:"flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider"}),d.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),d.jsxs("div",{className:"text-center mt-2",children:[d.jsx("span",{className:"text-white font-bold text-lg",children:s.confidence}),d.jsx("span",{className:"text-gray-400 text-sm ml-2",children:"/ 10"})]})]})]}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:A,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),d.jsxs("button",{onClick:F,disabled:!w(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${w()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[t===10?"Start Journey":"Next",d.jsx(Hz,{className:"w-4 h-4"})]})]})]})})},vb={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:md},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:PD},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:bD},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:SD}},eq={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},wb={WEEK_WARRIOR:{name:"Week Warrior",icon:Kz,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:RD,description:"30 days clean"},LEGEND:{name:"Legend",icon:CD,description:"90 days clean"}},tq=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",nq=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Time since last vape - decreases as your body heals",impacts:["What decreases it:","• Clean time: -2 points per week (standard recovery)","• Cold turkey approach: -3 points per week (faster healing)","• Tapering approach: -1.5 points per week (gentler decline)","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","• Reset: Penalty level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","• Reaching money saved milestones: +2 points","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),d.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),d.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>d.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[d.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300",children:"Got it"})]})}):null},Hh=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return d.jsxs("div",{className:"mb-2",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{children:n}),s&&i&&d.jsx("button",{onClick:()=>i(s),className:"w-4 h-4 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold transition-colors",title:`Learn about ${n}`,children:"i"})]}),d.jsxs("span",{children:[o,"/",t]})]}),d.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:`${r} h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},Ib=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=j.useState(!1),[a,l]=j.useState(null),[u,h]=j.useState([]);if(j.useEffect(()=>{let P=!1;return(async()=>{try{if(n&&n.uid){const F=await T(n);P||h(F)}else P||h([])}catch{P||h([])}})(),()=>{P=!0}},[n==null?void 0:n.uid]),n.isEmpty)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),d.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for Buddy"}),d.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We are searching for a suitable quit buddy for you. This may take a few minutes."}),d.jsx("div",{className:"mt-4 p-3 bg-slate-700/50 rounded-lg",children:d.jsx("p",{className:"text-slate-300 text-xs",children:"💡 Tip: Complete your profile to help us find better matches"})})]})});if(!n||!n.archetype||!n.stats)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const f=vb[n.archetype];if(!f)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(vb)),d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),d.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const p=eq[tq(n.stats.streakDays)],_=f.icon,T=async P=>{let U=null;if(P.uid)try{const{ref:w,get:E}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),y=w(re,`users/${P.uid}/specialFeatures`),v=await E(y);v.exists()&&(U=v.val())}catch(w){console.error("Error fetching special features from Firebase:",w)}if(!U){const w=`specialFeatures_${P.heroName||P.id||"default"}`,E=localStorage.getItem(w);E&&(U=JSON.parse(E))}if(U)return U;const F=[];for(P.triggers&&P.triggers.length>0&&P.triggers.forEach(w=>{switch(w){case"Stress/anxiety":F.push("Stress Vaper");break;case"Social situations":F.push("Social Vaper");break;case"Boredom":F.push("Boredom Vaper");break;case"After meals":F.push("Habit Vaper");break;case"Drinking alcohol":F.push("Party Vaper");break;case"Work breaks":F.push("Break Vaper");break;case"Driving":F.push("Driving Vaper");break}}),P.dailyPatterns&&P.dailyPatterns.length>0&&P.dailyPatterns.forEach(w=>{switch(w){case"Morning routine":F.push("Morning Struggler");break;case"Evening wind-down":F.push("Late Night Lurker");break;case"Throughout the day":F.push("All-Day Addict");break}}),P.copingStrategies&&P.copingStrategies.length>0&&(P.copingStrategies.includes("Nothing - this is new to me")?F.push("First Timer"):P.copingStrategies.length>2&&F.push("Veteran Quitter"));F.length<4;){const w=["Nicotine Fighter","Health Seeker","Freedom Chaser","Willpower Warrior"],E=w[Math.floor(Math.random()*w.length)];F.includes(E)||F.push(E)}const A=F.slice(0,4);if(P.uid)try{const{ref:w,set:E}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),y=w(re,`users/${P.uid}/specialFeatures`);await E(y,A),console.log("Special features saved to Firebase successfully")}catch(w){console.error("Error saving special features to Firebase:",w);const E=`specialFeatures_${P.heroName||P.id||"default"}`;localStorage.setItem(E,JSON.stringify(A))}else{const w=`specialFeatures_${P.heroName||P.id||"default"}`;localStorage.setItem(w,JSON.stringify(A))}return A},b=n.stats.addictionLevel||50,k=n.stats.mentalStrength||50,C=n.stats.motivation||50,x=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const R=P=>{l(P),o(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`relative w-80 h-[520px] rounded-xl ${p.color} border-4 ${p.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-4 transform transition-all duration-300 hover:scale-105 mx-auto overflow-hidden`,children:[d.jsxs("div",{className:"text-center mb-3",children:[d.jsx("h3",{className:"text-white font-bold text-lg leading-tight break-words px-1",children:n.heroName}),d.jsx("p",{className:"text-gray-300 text-base",children:f.name})]}),d.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):d.jsx("div",{className:`w-full h-full ${f.color} flex items-center justify-center`,children:d.jsx(_,{className:"w-12 h-12 text-white"})})}),d.jsxs("div",{className:"space-y-2 mb-4",children:[d.jsx(Hh,{label:"Addiction",value:b,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:R}),d.jsx(Hh,{label:"Mental Strength",value:k,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:R}),d.jsx(Hh,{label:"Motivation",value:C,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:R}),d.jsx(Hh,{label:"Trigger Defense",value:x,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:R})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),d.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((P,U)=>d.jsx("div",{className:"px-2 py-1 bg-blue-600/80 text-white text-xs rounded-full font-medium",title:P,children:P},U))})]}),d.jsxs("div",{className:"bg-black/30 rounded-lg p-3 space-y-2 mb-3 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex justify-between text-white text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Streak:"}),d.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[n.stats.streakDays," days",n.stats.streakDays>0&&d.jsx("span",{className:"text-xs",children:"🔥"})]})]}),d.jsxs("div",{className:"flex justify-between text-white text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),d.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,d.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&d.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((P,U)=>{var A,w;const F=((A=wb[P])==null?void 0:A.icon)||CD;return d.jsx("div",{className:"w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(w=wb[P])==null?void 0:w.description,children:d.jsx(F,{className:"w-3 h-3 text-white"})},U)}),n.achievements.length>4&&d.jsxs("div",{className:"w-6 h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),d.jsx(nq,{isOpen:i,onClose:()=>o(!1),statType:a})]})},rq=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:Qz},{id:"craving-support",label:"Craving Support",icon:md},{id:"profile",label:"Profile",icon:ND},{id:"buddy-chat",label:"Chat with Buddy",icon:Yz},{id:"settings",label:"Explore",icon:AD}];return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed bottom-20 left-0 right-0 bg-slate-700/90 backdrop-blur-sm border-t border-slate-600 px-4 py-2 z-30",children:d.jsxs("div",{className:"flex justify-center items-center gap-2 text-sm",children:[d.jsx("span",{className:"text-green-400",children:"🔐"}),d.jsx("span",{className:"text-white",children:"Session Active"}),d.jsx("span",{className:"text-gray-400",children:"•"}),d.jsx("span",{className:"text-gray-300",children:"30 days persistence"}),t&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"text-gray-400",children:"•"}),t.isComplete?d.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"✓"}),d.jsx("span",{children:"Synced"})]}):t.error?d.jsxs("span",{className:"text-red-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"⚠"}),d.jsx("span",{children:"Sync Error"})]}):d.jsxs("span",{className:"text-yellow-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"⟳"}),d.jsx("span",{children:"Syncing..."})]}),t.isComplete&&d.jsx("button",{onClick:r,className:"ml-2 px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors",title:"Refresh data from server",children:"🔄"})]}),s&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"text-gray-400",children:"•"}),s.isOnline?d.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"🌐"}),d.jsx("span",{children:"Online"})]}):d.jsxs("span",{className:"text-yellow-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"📡"}),d.jsx("span",{children:"Offline"})]}),s.syncQueue.length>0&&d.jsxs("span",{className:"text-blue-400 flex items-center gap-1",children:[d.jsx("span",{className:"text-xs",children:"📝"}),d.jsxs("span",{children:[s.syncQueue.length," pending"]})]})]})]})}),d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:d.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return d.jsxs("button",{onClick:()=>e(o.id),className:`flex flex-col items-center transition-colors ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[d.jsx(a,{className:"w-5 h-5"}),d.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})]})},sq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,buddyLoading:s,buddyError:i,realBuddy:o})=>{const[a,l]=j.useState(!1),[u,h]=j.useState(null);j.useEffect(()=>{o&&console.log("🔍 Arena: Real buddy loaded:",o.heroName)},[o]);const f=async()=>{u&&await u.handleAchievementShare()},p=async y=>{const v={...y.stats};if(!(y!=null&&y.uid)){const N=localStorage.getItem("quitCoachRelapseDate");if(N){const ge=new Date(N),Fe=new Date().getTime()-ge.getTime(),W=Math.floor(Fe/(1e3*3600*24));v.streakDays=W}else{const ge=y.quitDate?new Date(y.quitDate):new Date,Fe=new Date().getTime()-ge.getTime();v.streakDays=Math.floor(Fe/(1e3*3600*24))}const S=parseInt(localStorage.getItem("cravingWins")||0);v.cravingsResisted=S,new Date().toDateString();let X=0;for(let ge=0;ge<7;ge++){const he=new Date;he.setDate(he.getDate()-ge);const Fe=he.toDateString(),W=localStorage.getItem(`water_${Fe}`);if(W&&parseInt(W)>0)X++;else break}return X>=3&&(v.mentalStrength=Math.min(80,(v.mentalStrength||50)+1)),v}try{const{ref:N,get:S}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),X=N(re,`users/${y.uid}/profile/relapseDate`),ge=await S(X);if(ge.exists()){const ce=new Date(ge.val()),ue=new Date().getTime()-ce.getTime(),ie=Math.floor(ue/(1e3*3600*24));v.streakDays=ie}else{const ce=y.quitDate?new Date(y.quitDate):new Date,ue=new Date().getTime()-ce.getTime();v.streakDays=Math.floor(ue/(1e3*3600*24))}const he=N(re,`users/${y.uid}/profile/cravingsResisted`),Fe=await S(he);v.cravingsResisted=Fe.exists()?Fe.val():0;const W=new Date().toDateString();let le=0;for(let ce=0;ce<7;ce++){const ke=new Date;ke.setDate(ke.getDate()-ce);const ue=ke.toDateString(),ie=N(re,`users/${y.uid}/profile/daily/${ue}/water`),Ve=await S(ie);if(Ve.exists()&&Ve.val()>0)le++;else break}le>=3&&(v.mentalStrength=Math.min(80,(v.mentalStrength||50)+1))}catch(N){console.error("Error fetching profile data from Firebase:",N);const S=localStorage.getItem("quitCoachRelapseDate");if(S){const he=new Date(S),W=new Date().getTime()-he.getTime(),le=Math.floor(W/(1e3*3600*24));v.streakDays=le}else{const he=y.quitDate?new Date(y.quitDate):new Date,W=new Date().getTime()-he.getTime();v.streakDays=Math.floor(W/(1e3*3600*24))}const X=parseInt(localStorage.getItem("cravingWins")||0);v.cravingsResisted=X,new Date().toDateString();let ge=0;for(let he=0;he<7;he++){const Fe=new Date;Fe.setDate(Fe.getDate()-he);const W=Fe.toDateString(),le=localStorage.getItem(`water_${W}`);if(le&&parseInt(le)>0)ge++;else break}ge>=3&&(v.mentalStrength=Math.min(80,(v.mentalStrength||50)+1))}return v},[_,T]=j.useState({...n==null?void 0:n.stats}),[b,k]=j.useState({...e==null?void 0:e.stats});console.log("🚀 BEFORE useEffect - About to define Firestore initialization useEffect"),j.useEffect(()=>{console.log("🚀 FIRESTORE INITIALIZATION useEffect TRIGGERED"),console.log("🚀 Component mounted, initializing Firestore service..."),(async()=>{console.log("🔄 About to call initializeFirestoreBuddyService...");try{await initializeFirestoreBuddyService(),console.log("✅ initializeFirestoreBuddyService completed successfully")}catch(v){console.error("❌ Error calling initializeFirestoreBuddyService:",v),console.error("❌ Error details:",v.message),console.error("❌ Error stack:",v.stack)}})()},[]),j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{const v=async()=>{try{const X=new AI(re,n.uid);await X.initialize(),h(X)}catch(X){console.error("Error initializing StatManager:",X)}},N=async()=>{try{const X=new Bz(re);setBuddyMatchingService(X),console.log("✅ BuddyMatchingService initialized successfully")}catch(X){console.error("Error initializing BuddyMatchingService:",X)}};await v(),await N(),await(async()=>{if(n){const X=await p(n);T(X)}if(e){const X=await p(e);k(X)}})()})()},[n,e]),j.useEffect(()=>{const y=()=>{console.log("🌐 Internet connection restored"),authUser!=null&&authUser.uid&&dataLoadingState.isComplete&&(console.log("🔄 Auto-refreshing data after connection restore..."),loadAllUserData(authUser.uid))},v=()=>{console.log("📡 Internet connection lost"),setDataLoadingState(N=>({...N,currentStep:"Offline mode - data will sync when connection is restored",error:"No internet connection"}))};return window.addEventListener("online",y),window.addEventListener("offline",v),()=>{window.removeEventListener("online",y),window.removeEventListener("offline",v)}},[authUser==null?void 0:authUser.uid,dataLoadingState.isComplete]);const C=y=>{const v=y.stats.mentalStrength||50,N=y.stats.motivation||50,S=y.stats.triggerDefense||30,X=y.stats.addictionLevel||50;return v*1.5+N*1+S*1.2-X*1},x=C({...n,stats:_}),R=C({...e,stats:b}),P=x>R?"WINNING":x===R?"TIED":"LOSING",U=()=>{if(P==="WINNING")return null;const y=R-x+1,v=[],N=_.mentalStrength||50,S=_.motivation||50,X=_.triggerDefense||30,ge=_.addictionLevel||50,he=b.mentalStrength||50,Fe=b.motivation||50;b.triggerDefense;const W=b.addictionLevel||50,le=he-N,ce=Fe-S,ke=ge-W,ue=[{name:"Mental Strength",multiplier:1.5,gap:le,current:N,max:100},{name:"Trigger Defense",multiplier:1.2,gap:ce,current:X,max:100},{name:"Motivation",multiplier:1,gap:ce,current:S,max:100},{name:"Addiction",multiplier:1,gap:ke,current:ge,min:0,isReduction:!0}];if(ue.sort((ie,Ve)=>ie.multiplier!==Ve.multiplier?Ve.multiplier-ie.multiplier:Math.abs(Ve.gap)-Math.abs(ie.gap)),ue.forEach(ie=>{if(ie.isReduction){const Ve=Math.min(ie.current-ie.min,50),vt=Ve*ie.multiplier;vt>0&&v.push({stat:ie.name,change:Ve,action:F(Ve),priority:vt,canWin:vt>=y,isReduction:!0,efficiency:ie.multiplier,gap:ie.gap})}else{const Ve=Math.min(ie.max-ie.current,50),vt=Ve*ie.multiplier;vt>0&&v.push({stat:ie.name,change:Ve,action:A(ie.name,Ve),priority:vt,canWin:vt>=y,efficiency:ie.multiplier,gap:ie.gap})}}),v.sort((ie,Ve)=>Ve.priority-ie.priority),v.length>0&&!v.some(ie=>ie.canWin)){const ie=w(v,y);ie&&v.unshift(ie)}return v.slice(0,3)},F=y=>y>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":y>=20?"Reduce nicotine intake significantly, avoid high-risk situations":y>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",A=(y,v)=>{switch(y){case"Mental Strength":return v>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":v>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return v>=30?"Log progress daily, share achievements weekly, track money saved milestones":v>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return v>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":v>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},w=(y,v)=>{let N=0;const S=[];for(const X of y){if(N>=v)break;const ge=v-N,he=Math.min(X.priority,ge);he>0&&(S.push({stat:X.stat,change:Math.ceil(he/X.efficiency),contribution:he}),N+=he)}return S.length>0?{stat:"Combination Strategy",change:Math.ceil(v),action:`Focus on: ${S.map(X=>`${X.stat} (+${X.change})`).join(", ")}`,priority:N,canWin:N>=v,isCombination:!0,strategy:S}:null},E=U();return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:[d.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[d.jsxs("div",{className:"flex justify-start mb-6 gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1,!1]}),d.jsx("div",{className:"text-center mb-8",children:d.jsxs("div",{className:"inline-flex items-center gap-4",children:[d.jsxs("div",{className:`inline-flex items-center px-6 py-3 rounded-full font-bold text-lg shadow-xl ${P==="WINNING"?"bg-green-600":P==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[P==="WINNING"?d.jsx(RD,{className:"w-5 h-5 mr-2"}):P==="TIED"?d.jsx(md,{className:"w-5 h-5 mr-2"}):d.jsx("span",{className:"mr-2",children:"📉"}),"You are ",P]}),d.jsx("button",{onClick:()=>l(!0),className:"w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Battle Algorithm Info",children:d.jsx("span",{className:"text-lg font-bold",children:"i"})})]})}),d.jsxs("div",{className:"flex justify-center gap-12 mb-6",children:[d.jsx("div",{className:"w-80 text-center",children:d.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-full font-bold text-sm shadow-lg ${P==="WINNING"?"bg-green-600":P==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:P==="WINNING"?"WINNING":P==="TIED"?"TIED":"LOSING"})}),d.jsx("div",{className:"w-24"})," ",d.jsx("div",{className:"w-80 text-center",children:d.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-full font-bold text-sm shadow-lg ${P==="WINNING"?"bg-red-600":P==="TIED"?"bg-yellow-600":"bg-green-600"} text-white`,children:P==="WINNING"?"LOSING":P==="TIED"?"TIED":"WINNING"})})]}),d.jsxs("div",{className:"flex flex-row items-center justify-center gap-12 mb-8 w-full max-w-7xl mx-auto",children:[d.jsx("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:d.jsx(Ib,{user:{...n,stats:_},showComparison:!1,nemesisUser:e})}),d.jsxs("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:[d.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:d.jsx(Xz,{className:"w-12 h-12 text-white"})}),d.jsx("div",{className:"bg-red-600 px-8 py-3 rounded-full",children:d.jsx("p",{className:"text-white font-bold text-2xl",children:"VS"})})]}),d.jsxs("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:[e.isEmpty&&!o&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-slate-600/20 border border-slate-500/50 rounded-lg px-4 py-2",children:[d.jsx("p",{className:"text-slate-400 text-sm font-semibold",children:"🔍 Looking for Buddy"}),d.jsx("p",{className:"text-slate-300 text-xs",children:"We are searching for a suitable match"})]})}),s&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-yellow-600/20 border border-yellow-500/50 rounded-lg px-4 py-2",children:[d.jsx("p",{className:"text-yellow-400 text-sm font-semibold",children:"🔍 Loading Buddy..."}),d.jsx("p",{className:"text-yellow-300 text-xs",children:"Please wait while we find your match"})]})}),i&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-red-600/20 border border-red-500/50 rounded-lg px-4 py-2 mb-2",children:[d.jsx("p",{className:"text-red-400 text-sm font-semibold",children:"❌ Error Loading Buddy"}),d.jsx("p",{className:"text-red-300 text-xs",children:i})]})}),o&&d.jsx("div",{className:"mb-2 text-center",children:d.jsxs("div",{className:"bg-green-600/20 border border-green-500/50 rounded-lg px-4 py-2",children:[d.jsx("p",{className:"text-green-400 text-sm font-semibold",children:"✅ Connected with Buddy"}),d.jsxs("p",{className:"text-green-300 text-xs",children:["You're battling ",o.heroName,"!"]})]})}),d.jsx(Ib,{user:o||e,isNemesis:!0,showComparison:!1,nemesisUser:n})]})]}),P==="LOSING"&&E&&E.length>0&&d.jsxs("div",{className:"max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-6 border border-slate-700",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),d.jsx("div",{className:"space-y-4",children:E.slice(0,3).map((y,v)=>d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-4 border-l-4 border-blue-500",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:y.isReduction?d.jsxs(d.Fragment,{children:["🎯 Reduce your ",y.stat," by ",y.change," points!"]}):y.isCombination?d.jsxs(d.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",y.change," total points!"]}):y.isMajor?d.jsxs(d.Fragment,{children:["🎯 Major improvement needed: ",y.change," total points!"]}):d.jsxs(d.Fragment,{children:["🎯 Increase your ",y.stat," by ",y.change," points!"]})}),d.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",y.action]})]}),d.jsxs("div",{className:`font-bold text-2xl ml-4 ${y.isReduction?"text-green-400":y.isCombination?"text-purple-400":y.isMajor?"text-orange-400":"text-blue-400"}`,children:[y.isReduction?"-":"+",y.change]})]})},v))}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),a&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-md w-full border border-slate-600",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm transition-colors",title:"Share achievement for Motivation bonus",children:"📤 Share"}),d.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-white text-2xl",children:"×"})]})]}),d.jsxs("div",{className:"space-y-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),d.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),d.jsxs("p",{className:"text-green-400 font-mono",children:["(",_.mentalStrength||50," × 1.5) + (",_.motivation||50," × 1.0) + (",_.triggerDefense||30," × 1.2) - (",_.addictionLevel||50," × 1.0) = ",x.toFixed(1)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),d.jsxs("p",{className:"text-red-400 font-mono",children:["(",b.mentalStrength||50," × 1.5) + (",b.motivation||50," × 1.0) + (",b.triggerDefense||30," × 1.2) - (",b.addictionLevel||50," × 1.0) = ",R.toFixed(1)]})]}),d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:d.jsxs("p",{className:"text-gray-300 text-xs",children:[d.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",d.jsx("br",{}),d.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",d.jsx("br",{}),d.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",d.jsx("br",{}),d.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})},iq=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full border border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-3xl",children:i()})}),d.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),d.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),d.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})},oq=({gameType:n,onClose:e})=>{j.useState(0);const[t,r]=j.useState(!1),s=()=>r(!t),i=()=>{const l=j.useRef(null),[u,h]=j.useState([{x:7,y:7}]),[f,p]=j.useState({x:1,y:0}),[_,T]=j.useState({x:1,y:0}),[b,k]=j.useState({x:10,y:10}),[C,x]=j.useState(!1),[R,P]=j.useState(0),[U,F]=j.useState(1),A={1:160,2:Math.round(160/1.25),3:Math.round(160/1.25/1.25)},w={1:2,2:5,3:10};return j.useEffect(()=>{const E=y=>{if(C){y.preventDefault(),h([{x:7,y:7}]),p({x:1,y:0}),T({x:1,y:0}),k({x:10,y:10}),x(!1),P(0),F(1);return}switch(y.key){case"ArrowUp":y.preventDefault(),f.y!==1&&T({x:0,y:-1});break;case"ArrowDown":y.preventDefault(),f.y!==-1&&T({x:0,y:1});break;case"ArrowLeft":y.preventDefault(),f.x!==1&&T({x:-1,y:0});break;case"ArrowRight":y.preventDefault(),f.x!==-1&&T({x:1,y:0});break}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[f,C]),j.useEffect(()=>{if(t||C)return;const E=setInterval(()=>{h(y=>{const v={x:y[0].x+f.x,y:y[0].y+f.y};if(v.x<0&&(v.x=14),v.x>=15&&(v.x=0),v.y<0&&(v.y=14),v.y>=15&&(v.y=0),y.slice(0,-1).some(ge=>ge.x===v.x&&ge.y===v.y))return x(!0),y;const S=v.x===b.x&&v.y===b.y;let X;return S?(P(ge=>ge+w[U]),k({x:Math.floor(Math.random()*15),y:Math.floor(Math.random()*15)}),X=[v,...y]):X=[v,...y.slice(0,-1)],(_.x!==f.x||_.y!==f.y)&&setTimeout(()=>{p(_)},0),X})},A[U]);return()=>clearInterval(E)},[f,_,b,t,C]),j.useEffect(()=>{const E=l.current;if(!E)return;const y=E.getContext("2d"),v=20,N=15;y.fillStyle="#1f2937",y.fillRect(0,0,300,300),y.strokeStyle="#374151",y.lineWidth=1;for(let S=0;S<=N;S++)y.beginPath(),y.moveTo(S*v,0),y.lineTo(S*v,300),y.stroke(),y.beginPath(),y.moveTo(0,S*v),y.lineTo(300,S*v),y.stroke();u.forEach((S,X)=>{X===0?y.fillStyle="#fbbf24":y.fillStyle="#10b981",y.fillRect(S.x*v+1,S.y*v+1,v-2,v-2)}),y.fillStyle="#ef4444",y.fillRect(b.x*v+2,b.y*v+2,v-4,v-4)},[u,b]),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"mb-4",children:[d.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[d.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(E=>d.jsxs("button",{onClick:()=>F(E),className:`
                  px-4 py-2 text-sm font-mono border-2 border-green-500 transition-all
                  ${U===E?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[d.jsxs("div",{children:["Level ",E]}),d.jsxs("div",{className:"text-xs mt-1",children:[E===1&&"Normal",E===2&&"Fast",E===3&&"Insane"]})]},E))]}),d.jsxs("div",{className:"text-center text-yellow-400 text-xs mb-3",children:[d.jsxs("div",{children:["Speed: ",A[U],"ms | Points: ",w[U]," per food"]}),U===1&&"Good for beginners",U===2&&"For experienced players",U===3&&"Ultimate challenge"]})]}),d.jsx("canvas",{ref:l,width:"300",height:"300",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",R," | Level: ",U]}),d.jsxs("div",{className:"flex justify-center gap-4 mb-2 text-sm",children:[d.jsxs("div",{className:"text-gray-600",children:[d.jsx("span",{className:"font-semibold",children:"Current:"}),f.x===1&&"→",f.x===-1&&"←",f.y===1&&"↓",f.y===-1&&"↑"]}),_.x!==f.x||_.y!==f.y?d.jsxs("div",{className:"text-blue-600",children:[d.jsx("span",{className:"font-semibold",children:"Next:"}),_.x===1&&"→",_.x===-1&&"←",_.y===1&&"↓",_.y===-1&&"↑"]}):null]}),d.jsx("p",{className:"text-sm text-gray-600",children:"Use arrow keys to control the snake"}),C&&d.jsxs("div",{className:"mt-2",children:[d.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),d.jsx("button",{onClick:()=>{h([{x:7,y:7}]),p({x:1,y:0}),T({x:1,y:0}),k({x:10,y:10}),x(!1),P(0),F(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",children:"Restart Game"})]})]})]})},o=()=>{const[l,u]=j.useState(0),[h,f]=j.useState(0),[p]=j.useState(Date.now()),_=()=>{u(T=>T+1)};return j.useEffect(()=>{const T=(Date.now()-p)/1e3;T>0&&f((l/T).toFixed(1))},[l,p]),d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Click as Fast as You Can!"}),d.jsxs("div",{className:"text-lg text-gray-700 mb-2",children:["Total Clicks: ",l]}),d.jsxs("div",{className:"text-lg text-gray-700 mb-2",children:["Clicks/Second: ",h]}),d.jsx("button",{onClick:_,className:"w-48 h-48 text-2xl font-bold bg-orange-500 hover:bg-orange-600 border-none rounded-full text-white cursor-pointer transition-colors shadow-lg",children:"CLICK ME!"}),d.jsx("div",{className:"mt-4 text-sm text-gray-600",children:"Challenge: Try to reach 500 clicks!"})]})},a=()=>{try{switch(n){case"snake":return d.jsx(i,{});case"click-counter":return d.jsx(o,{});default:return d.jsx("div",{children:"Game not found"})}}catch(l){return console.error("Error rendering game:",l),d.jsxs("div",{className:"text-center text-red-600",children:[d.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),d.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm",children:"Reload Game"})]})}};return d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:[n==="snake"&&"🐍 Snake Game",n==="puzzle"&&"🧠 Memory Puzzle"]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{onClick:s,className:"bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm",children:t?"Resume":"Pause"}),d.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]})]}),d.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[500px] flex items-center justify-center relative",children:[a(),d.jsxs("div",{className:"absolute top-2 left-2 bg-black/70 text-white p-2 rounded text-xs max-w-48",children:[d.jsx("p",{className:"font-bold mb-1",children:"Controls:"}),n==="snake"&&d.jsx("p",{children:"Arrow keys to move"}),n==="click-counter"&&d.jsx("p",{children:"Click the button rapidly!"})]}),d.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white p-2 rounded text-xs",children:[d.jsx("p",{className:"font-bold mb-1",children:"Status:"}),d.jsx("p",{children:t?"⏸️ Paused":"▶️ Playing"})]})]}),d.jsx("div",{className:"mt-4 text-center",children:d.jsx("p",{className:"text-sm text-gray-500",children:"Games now run without time limits - play as long as you need!"})})]})})},aq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r})=>{const[s,i]=j.useState(!1),[o,a]=j.useState(!1),[l,u]=j.useState(null),[h,f]=j.useState(!1),[p,_]=j.useState({title:"",message:"",type:"info"}),[T,b]=j.useState(0),[k,C]=j.useState(null);j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const E=new AI(re,n.uid);await E.initialize(),C(E)}catch(E){console.error("Error initializing StatManager:",E)}})(),(async()=>{try{const{ref:E,get:y,onValue:v}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),N=E(re,`users/${n.uid}/profile/cravingsResisted`),S=await y(N);if(S.exists())b(S.val()||0);else{const ge=parseInt(localStorage.getItem("cravingWins")||0);b(ge)}return v(N,ge=>{ge.exists()&&b(ge.val()||0)})}catch(E){console.error("Error loading cravings resisted from Firebase:",E);const y=parseInt(localStorage.getItem("cravingWins")||0);b(y)}})()},[n==null?void 0:n.uid]);const x=()=>{console.log("SOS sent to nemesis:",e.heroName);const A={timestamp:new Date().toISOString(),nemesis:e.heroName,status:"sent"};localStorage.setItem("lastSOS",JSON.stringify(A)),a(!0),setTimeout(()=>a(!1),5e3),k&&k.trackAppUsageDuringCravings()},R=A=>{u(A),i(!0)},P=()=>{u(null),i(!1)},U=async()=>{try{const A=T;if(localStorage.setItem("cravingWins",A+1),n&&n.uid){const{ref:w,set:E}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),y=w(re,`users/${n.uid}/profile/cravingsResisted`);await E(y,A+1),b(A+1),console.log("Cravings resisted updated in profile:",A+1)}k&&await k.handleCravingResistance(),_({title:"Congratulations!",message:`🎉 Great job resisting that craving!

Every trigger survival increases:
• Mental Strength +1 point
• Trigger Defense +3 points

Keep up the amazing work!`,type:"success"}),f(!0)}catch(A){console.error("Error updating stats:",A),_({title:"Congratulations!",message:`🎉 Great job resisting that craving!

Your progress has been recorded locally.

Keep up the amazing work!`,type:"success"}),f(!0)}},F=(A,w)=>{_({title:A,message:w,type:"info"}),f(!0)};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsx("div",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-start gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),d.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8 border-2 border-red-200",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse",children:d.jsx("span",{className:"text-4xl",children:"🆘"})}),d.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Need Immediate Help?"}),d.jsx("p",{className:"text-gray-600 mb-6",children:"Press the SOS button to alert your nemesis and get instant support"}),d.jsx("button",{onClick:x,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-6 px-8 rounded-xl text-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🆘 SOS - Get Help Now"}),(()=>{const A=localStorage.getItem("lastSOS");if(A){const w=JSON.parse(A),E=Math.floor((Date.now()-new Date(w.timestamp))/(1e3*60));return d.jsx("div",{className:"mt-4 p-3 bg-red-50 rounded-lg border border-red-200",children:d.jsxs("p",{className:"text-sm text-red-600",children:["Last SOS sent ",E," minutes ago to ",w.nemesis]})})}return null})()]})}),d.jsx("div",{className:"bg-slate-800/50 rounded-xl p-6 mb-6 border border-slate-600",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"🎮 Distract Yourself"}),d.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[d.jsx("button",{onClick:()=>R("snake"),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 hover:from-orange-500/30 hover:to-orange-600/30 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-orange-500/30",children:"🐍 Play Snake"}),d.jsx("button",{onClick:()=>R("click-counter"),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 hover:from-blue-500/30 hover:to-blue-600/30 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-blue-500/30",children:"⚡ Click Counter"})]})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-600",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4 text-center",children:"⚡ Quick Actions"}),d.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.jsx("button",{onClick:()=>F("💧 Drink Water",`Hydration helps reduce cravings!

Drink a full glass of water slowly.

This will help you feel full and reduce the urge to vape.`),className:"bg-gradient-to-r from-blue-500/20 to-blue-600/20 hover:from-blue-500/30 hover:to-blue-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-blue-500/30 hover:scale-105",children:"💧 Drink Water"}),d.jsx("button",{onClick:()=>F("🫁 Breathe",`Take 3 deep breaths:

1. Inhale for 4 seconds
2. Hold for 4 seconds
3. Exhale for 4 seconds

Repeat 3 times`),className:"bg-gradient-to-r from-blue-500/20 to-blue-600/20 hover:from-blue-500/30 hover:to-blue-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-blue-500/30 hover:scale-105",children:"🫁 Breathe"}),d.jsx("button",{onClick:()=>F("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),className:"bg-gradient-to-r from-purple-500/20 to-purple-600/20 hover:from-purple-500/30 hover:to-purple-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-purple-500/30 hover:scale-105",children:"🚶‍♂️ Walk"}),d.jsx("button",{onClick:()=>F("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),className:"bg-gradient-to-r from-green-500/20 to-green-600/20 hover:from-green-500/30 hover:to-green-600/30 text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 border border-green-500/30 hover:scale-105",children:"🧘‍♀️ Meditate"})]})]}),o&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-2xl",children:"✅"})}),d.jsx("h3",{className:"text-xl font-bold text-green-600 mb-2",children:"Help is on the way!"}),d.jsxs("p",{className:"text-gray-600 mb-4",children:["Your nemesis ",d.jsx("strong",{children:e.heroName})," has been notified and will reach out soon."]}),d.jsx("button",{onClick:()=>a(!1),className:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Got it"})]})}),s&&l&&d.jsx(oq,{gameType:l,onClose:P}),d.jsx(iq,{isOpen:h,onClose:()=>f(!1),title:p.title,message:p.message,type:p.type}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-600 mt-6",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4 text-center",children:"📊 Cravings Resisted"}),d.jsxs("div",{className:"text-center p-6 bg-slate-700/50 rounded-lg border border-slate-500/30",children:[d.jsx("div",{className:"text-4xl mb-3",children:"🎯"}),d.jsx("p",{className:"text-lg font-bold text-white mb-2",children:"Total Wins"}),d.jsx("p",{className:"text-3xl font-bold text-green-400 mb-3",children:T}),d.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Times you successfully resisted cravings"}),d.jsx("button",{onClick:U,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🎯 I Resisted a Craving!"})]})]})]})})},lq=({user:n,onNavigate:e})=>{var ps;const[t,r]=j.useState(null),[s,i]=j.useState(!1),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[h,f]=j.useState(!1),[p,_]=j.useState(!1),[T,b]=j.useState(null),[k,C]=j.useState(0),[x,R]=j.useState(null),[P,U]=j.useState(!1),[F,A]=j.useState([]),[w,E]=j.useState(null);j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const ye=new AI(re,n.uid);await ye.initialize(),E(ye)}catch(ye){console.error("Error initializing StatManager:",ye)}})();const Se=async()=>{try{const{ref:ye,get:Je,onValue:Ot}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),An=ye(re,`users/${n.uid}/profile/relapseDate`),Cn=await Je(An);Cn.exists()&&r(new Date(Cn.val()));const gr=ye(re,`users/${n.uid}/profile/scheduledTriggers`),wt=await Je(gr);wt.exists()&&A(wt.val());const jt=new Date().toDateString(),D=ye(re,`users/${n.uid}/profile/daily/${jt}/water`),z=Ot(D,fe=>{fe.exists()&&C(fe.val()||0)}),K=ye(re,`users/${n.uid}/profile/daily/${jt}/mood`),de=Ot(K,fe=>{fe.exists()&&R(fe.val())}),oe=ye(re,`users/${n.uid}/profile/daily/${jt}/breathing`),te=Ot(oe,fe=>{fe.exists()&&U(fe.val()||!1)}),_e=ye(re,`users/${n.uid}/profile/scheduledTriggers`),Ee=Ot(_e,fe=>{fe.exists()&&A(fe.val()||[])});return()=>{z(),de(),te(),Ee()}}catch(ye){console.error("Error loading profile data from Firebase:",ye),Ye()}},Ye=()=>{const ye=localStorage.getItem("quitCoachRelapseDate");ye&&r(new Date(ye));const Je=new Date().toDateString(),Ot=localStorage.getItem(`water_${Je}`),An=localStorage.getItem(`mood_${Je}`),Cn=localStorage.getItem(`breathing_${Je}`);Ot&&C(parseInt(Ot)),An&&R(JSON.parse(An)),Cn&&U(Cn==="true");const gr=localStorage.getItem("scheduledTriggers");gr&&A(JSON.parse(gr))};Se()},[n==null?void 0:n.uid]),j.useEffect(()=>{w&&w.trackLoggingActivity()},[w]),j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:Se,get:Ye,set:ye}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),Je=Se(re,`users/${n.uid}/profile`),Ot=await Ye(Je);if(!Ot.exists()||Object.keys(Ot.val()).length===0){console.log("Migrating localStorage data to Firebase...");const An=localStorage.getItem("quitCoachRelapseDate");An&&(await ye(Se(re,`users/${n.uid}/profile/relapseDate`),An),r(new Date(An)));const Cn=parseInt(localStorage.getItem("cravingWins")||0);Cn>0&&await ye(Se(re,`users/${n.uid}/profile/cravingsResisted`),Cn);for(let wt=0;wt<7;wt++){const jt=new Date;jt.setDate(jt.getDate()-wt);const D=jt.toDateString(),z=localStorage.getItem(`water_${D}`);z&&await ye(Se(re,`users/${n.uid}/profile/daily/${D}/water`),parseInt(z))}for(let wt=0;wt<7;wt++){const jt=new Date;jt.setDate(jt.getDate()-wt);const D=jt.toDateString(),z=localStorage.getItem(`mood_${D}`);z&&await ye(Se(re,`users/${n.uid}/profile/daily/${D}/mood`),JSON.parse(z))}for(let wt=0;wt<7;wt++){const jt=new Date;jt.setDate(jt.getDate()-wt);const D=jt.toDateString(),z=localStorage.getItem(`breathing_${D}`);z&&await ye(Se(re,`users/${n.uid}/profile/daily/${D}/breathing`),z==="true")}const gr=localStorage.getItem("scheduledTriggers");if(gr){const wt=JSON.parse(gr);await ye(Se(re,`users/${n.uid}/profile/scheduledTriggers`),wt),A(wt)}console.log("localStorage data migration to Firebase completed")}}catch(Se){console.error("Error migrating localStorage data to Firebase:",Se)}})()},[n==null?void 0:n.uid]);const y=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,v=()=>{const Ie=new Date,Se=new Date(Ie);Se.setHours(24,0,0,0);const Ye=Se-Ie,ye=Math.floor(Ye/(1e3*60*60)),Je=Math.floor(Ye%(1e3*60*60)/(1e3*60)),Ot=Math.floor(Ye%(1e3*60)/1e3);return{hours:ye,minutes:Je,seconds:Ot}},[N,S]=j.useState(v()),[X,ge]=j.useState(0),[he,Fe]=j.useState(0),[W,le]=j.useState(0),[ce,ke]=j.useState(0);j.useEffect(()=>{const Ie=setInterval(()=>{S(v());const Se=y(),ye=new Date-Se,Je=Math.floor(ye/(1e3*60*60*24)),Ot=Math.floor(ye%(1e3*60*60*24)/(1e3*60*60)),An=Math.floor(ye%(1e3*60*60)/(1e3*60)),Cn=Math.floor(ye%(1e3*60)/1e3);ge(Je),Fe(Ot),le(An),ke(Cn)},1e3);return()=>clearInterval(Ie)},[t,n==null?void 0:n.quitDate]);const ue=async(Ie,Se)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:Ye,set:ye}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),Je=Ye(re,`users/${n.uid}/profile/${Ie}`);return await ye(Je,Se),!0}catch(Ye){return console.error("Error saving to Firebase:",Ye),!1}},ie=async()=>{const Ie=new Date;r(Ie),w&&await w.handleRelapse(),await ue("relapseDate",Ie.toISOString())||localStorage.setItem("quitCoachRelapseDate",Ie.toISOString())},vt=(()=>{const Ie=new Date,Se=Ie.getDay(),Ye=Se===0?6:Se-1,ye=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let Je=0;Je<=Ye;Je++)ye[Je].color="bg-green-500";return t&&t.toDateString()===Ie.toDateString()&&(ye[Ye].color="bg-red-500"),ye})(),bn=async Ie=>{C(Ie);const Se=new Date().toDateString();w&&await w.handleHydrationUpdate(Ie),await ue(`daily/${Se}/water`,Ie)||localStorage.setItem(`water_${Se}`,Ie.toString()),i(!1)},fn=async Ie=>{R(Ie);const Se=new Date().toDateString();await ue(`daily/${Se}/mood`,Ie)||localStorage.setItem(`mood_${Se}`,JSON.stringify(Ie)),u(!1)},so=async()=>{U(!0);const Ie=new Date().toDateString();w&&await w.handleBreathingExercise(),await ue(`daily/${Ie}/breathing`,!0)||localStorage.setItem(`breathing_${Ie}`,"true"),a(!1)},_a=async(Ie,Se,Ye)=>{const ye={day:Ie,triggerType:Se,time:Ye,id:Date.now()},Je=[...F,ye];A(Je),w&&await w.handleTriggerPlanning(),await ue("scheduledTriggers",Je)||localStorage.setItem("scheduledTriggers",JSON.stringify(Je)),f(!1)},fs=async()=>{w&&await w.handleTriggerListUpdate()};return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-white text-lg",children:"Hello,"}),d.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),d.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:d.jsx("span",{className:"font-bold text-slate-900",children:X})})]}),d.jsxs("div",{className:"px-4 space-y-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("button",{onClick:ie,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-2xl",children:"⚠️"}),d.jsx("span",{className:"text-lg",children:"RELAPSE"}),d.jsx("span",{className:"text-2xl",children:"⚠️"})]}),d.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),d.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[d.jsx("span",{className:"text-white text-sm",children:"✓"}),d.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),d.jsx("div",{className:"flex justify-between items-center mb-4",children:vt.map((Ie,Se)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${Ie.color}`}),d.jsx("p",{className:"text-gray-400 text-xs",children:Ie.name})]},Ie.name))})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-white text-3xl font-bold",children:[N.hours.toString().padStart(2,"0"),":",N.minutes.toString().padStart(2,"0"),":",N.seconds.toString().padStart(2,"0")]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),d.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),d.jsxs("div",{className:"flex items-baseline gap-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:X.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:he.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:W.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:ce.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&d.jsx("div",{className:"mt-3 text-center",children:d.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),d.jsx("p",{className:"text-gray-300 text-sm",children:k>0?`${k} glasses today`:"Tap to log water intake"})]}),d.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🫁"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Complete breathing exercise"}),d.jsx("p",{className:"text-gray-300 text-sm",children:P?"Completed! Stay calm!":"Tap to start 4-cycle breathing"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),d.jsx("p",{className:"text-gray-300 text-sm",children:x?`You feel ${x.name.toLowerCase()}`:"How do you feel today?"})]}),d.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:F.length>0?`${F.length} triggers planned`:"Plan your trigger defense strategy"})]}),d.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:fs,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400",children:"$"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Money saved"})]}),d.jsx("div",{className:"text-white text-2xl font-bold",children:((ps=n==null?void 0:n.stats)==null?void 0:ps.moneySaved)||0}),d.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Work in progress"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),d.jsx("button",{onClick:()=>_(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),d.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),d.jsx(cq,{isOpen:s,onClose:()=>i(!1),onConfirm:bn,currentWater:k}),d.jsx(uq,{isOpen:o,onClose:()=>a(!1),onComplete:so}),d.jsx(dq,{isOpen:l,onClose:()=>u(!1),onSelect:fn,selectedMood:x}),d.jsx(hq,{isOpen:h,onClose:()=>f(!1),onSchedule:_a,scheduledTriggers:F}),d.jsx(fq,{isOpen:p,onClose:()=>_(!1),selectedDate:T,onDateSelect:b,dailyData:{water:k,mood:x,breathing:P,relapseDate:t}})]})},cq=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=j.useState(r);return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:o=>i(parseInt(o.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0"}),d.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>t(s),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Confirm"})]})]})}):null},uq=({isOpen:n,onClose:e,onComplete:t})=>{const[r,s]=j.useState(1),[i,o]=j.useState("exhale"),[a,l]=j.useState(5),[u,h]=j.useState(!1);j.useEffect(()=>{if(!n||!u)return;const T=setInterval(()=>{l(b=>{if(b<=1){if(i==="exhale")o("inhale"),l(4);else if(i==="inhale")o("hold"),l(7);else if(i==="hold")if(r<4)s(k=>k+1),o("exhale"),l(5);else return h(!1),t(),0;return b}return b-1})},1e3);return()=>clearInterval(T)},[n,u,i,r,t]);const f=()=>{h(!0),s(1),o("exhale"),l(5)};if(!n)return null;const p=()=>{switch(i){case"exhale":return"Exhale, empty lungs";case"inhale":return"Inhale quietly through nose";case"hold":return"Hold your breath";default:return""}},_=()=>{switch(i){case"exhale":return"w-32 h-32";case"inhale":return"w-48 h-48";case"hold":return"w-40 h-40";default:return"w-40 h-40"}};return d.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"text-center text-white",children:u?d.jsxs(d.Fragment,{children:[d.jsxs("h3",{className:"text-2xl font-bold mb-4",children:["Cycle ",r,"/4"]}),d.jsx("p",{className:"text-xl text-gray-300 mb-8",children:p()}),d.jsx("div",{className:"flex justify-center mb-8",children:d.jsx("div",{className:`${_()} rounded-full border-4 border-blue-400 flex items-center justify-center transition-all duration-1000 ${i==="hold"?"animate-pulse":""}`,children:d.jsx("span",{className:"text-4xl font-bold",children:a})})}),d.jsx("button",{onClick:e,className:"bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Stop"})]}):d.jsxs("div",{className:"mb-8",children:[d.jsx("h3",{className:"text-3xl font-bold mb-4",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-xl text-gray-300 mb-6",children:"4-cycle breathing pattern"}),d.jsx("button",{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition-colors",children:"Start Exercise"})]})})})},dq=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),d.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:s.map(i=>d.jsxs("button",{onClick:()=>t(i),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 ${(r==null?void 0:r.name)===i.name?"ring-2 ring-blue-400":"bg-slate-700 hover:bg-slate-600"}`,children:[d.jsx("div",{className:`w-12 h-12 ${i.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:i.icon}),d.jsx("p",{className:"text-white font-semibold",children:i.name})]},i.name))}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"})]})}):null},hq=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=j.useState(""),[o,a]=j.useState(""),[l,u]=j.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),d.jsxs("select",{value:s,onChange:p=>i(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select a day"}),f.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),d.jsxs("select",{value:o,onChange:p=>a(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select trigger type"}),h.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),d.jsx("input",{type:"time",value:l,onChange:p=>u(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none"})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})}):null},fq=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),d.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),d.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&d.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[d.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),d.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Close"})]})}):null,pq=({onResetApp:n})=>d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:d.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx(AD,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),d.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),d.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),mq=({user:n,nemesis:e,buddyMatchingService:t})=>{const[r,s]=j.useState([{id:1,sender:"buddy",text:"Hey! How's your quit journey going?",timestamp:new Date(Date.now()-6e4).toLocaleTimeString()},{id:2,sender:"user",text:"Going strong! Day 3 now.",timestamp:new Date(Date.now()-3e4).toLocaleTimeString()}]),[i,o]=j.useState(""),[a,l]=j.useState(!1);j.useState(null),j.useState(!1);const[u,h]=j.useState(null);j.useState(!1),j.useState(null);const[f,p]=j.useState(null);j.useEffect(()=>{(async()=>{if(!(!t||!(n!=null&&n.uid)))try{console.log("🔍 Checking for existing buddy pair...");const k=await t.getUserBuddyInfo(n.uid);if(k){console.log("✅ Found existing buddy pair:",k),p(k);const C=await t.getBuddyPairInfo(k.id);C&&h(C)}}catch(k){console.error("Error loading existing buddy pair:",k)}})()},[t,n==null?void 0:n.uid]);const _=()=>{if(i.trim().length===0)return;const b=i.trim().slice(0,20),k={id:Date.now(),sender:"user",text:b,timestamp:new Date().toLocaleTimeString()};s(C=>[...C,k]),o(""),l(!0),setTimeout(()=>{const C=["Keep it up! 💪","You're doing great!","Stay strong today!","One day at a time!","I believe in you!","You've got this!","Every day counts!","Stay focused! 🎯"],x=C[Math.floor(Math.random()*C.length)],R={id:Date.now()+1,sender:"buddy",text:x,timestamp:new Date().toLocaleTimeString()};s(P=>[...P,R]),l(!1)},1500)},T=b=>{b.key==="Enter"&&_()};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"💬 Chat with Buddy"}),d.jsx("p",{className:"text-gray-300",children:"Stay connected with your quit buddy for support"})]}),d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"space-y-4 mb-6 max-h-96 overflow-y-auto",children:[r.map(b=>d.jsx("div",{className:`flex ${b.sender==="user"?"justify-end":"justify-start"}`,children:d.jsxs("div",{className:`max-w-xs px-4 py-2 rounded-2xl ${b.sender==="user"?"bg-blue-600 text-white":"bg-slate-700 text-gray-200"}`,children:[d.jsx("div",{className:"text-sm",children:b.text}),d.jsx("div",{className:"text-xs opacity-70 mt-1",children:b.timestamp})]})},b.id)),a&&d.jsx("div",{className:"flex justify-start",children:d.jsx("div",{className:"bg-slate-700 text-gray-200 px-4 py-2 rounded-2xl",children:d.jsxs("div",{className:"flex items-center space-x-1",children:[d.jsx("span",{className:"text-sm",children:"Buddy is typing"}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:i,onChange:b=>o(b.target.value),onKeyPress:T,placeholder:"Type your message (max 20 chars)...",maxLength:20,className:"flex-1 bg-slate-700 text-white px-4 py-3 rounded-xl border border-slate-600 focus:border-blue-500 focus:outline-none"}),d.jsx("button",{onClick:_,disabled:i.trim().length===0,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 text-white px-6 py-3 rounded-xl transition-colors disabled:cursor-not-allowed",children:"Send"})]}),d.jsx("div",{className:"text-right mt-2",children:d.jsxs("span",{className:`text-xs ${i.length>=18?"text-yellow-400":"text-gray-400"}`,children:[i.length,"/20"]})})]}),d.jsx("div",{className:"mt-6 bg-slate-800 rounded-2xl p-6 shadow-2xl border border-slate-700",children:d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold",children:e.heroName.charAt(0)}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:e.heroName}),d.jsx("p",{className:"text-gray-300",children:"Your Quit Buddy"}),d.jsx("p",{className:"text-sm text-gray-400",children:"Always here to support you"})]})]})})]})})},gq=()=>{console.log("🚀 APP COMPONENT MOUNTING - Component function called");try{console.log("🚀 STEP 1: About to declare state variables");const[D,z]=j.useState("arena"),[K,de]=j.useState("auth"),[oe,te]=j.useState(null),[_e,Ee]=j.useState(null),[fe,tt]=j.useState(!1),[It,nt]=j.useState(null),[De,Ct]=j.useState(!0);console.log("🚀 STEP 2: State variables declared successfully")}catch(D){throw console.error("❌ ERROR declaring state variables:",D),D}console.log("🚀 STEP 3: About to declare data loading system state");const[n,e]=j.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1});console.log("🚀 STEP 4: Data loading state declared");const[t,r]=j.useState([]);console.log("🚀 STEP 5: Unsubscribe functions state declared");const[s,i]=j.useState(null);console.log("🚀 STEP 6: Buddy matching service state declared");const[o,a]=j.useState(null),l=j.useRef(null);console.log("🚀 STEP 7: Firestore buddy service state declared");const u=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,moneySaved:0}),h=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),f=D=>{D.relapseDate&&w(new Date(D.relapseDate)),D.dailyWater!==void 0&&y(D.dailyWater),D.dailyMood!==void 0&&N(D.dailyMood),D.dailyBreathing!==void 0&&X(D.dailyBreathing),D.scheduledTriggers&&he(D.scheduledTriggers)},p=(D,z)=>{const K=document.createElement("div");K.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",K.innerHTML=`
      <div class="font-bold">${D}</div>
      <div class="text-sm opacity-90">${z}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(K),setTimeout(()=>{K.parentNode&&K.parentNode.removeChild(K)},1e4)},_=async D=>{if(!D)return!1;e({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:z,get:K,onValue:de}=await $e(()=>import("./index.esm-8052bcf6.js"),[]);e(Be=>({...Be,currentStep:"Loading profile data...",progress:20}));const oe=z(re,`users/${D}`),te=await K(oe);if(!te.exists())throw new Error("User profile not found");const _e=te.val(),Ee=T(_e);e(Be=>({...Be,currentStep:"Loading battle stats...",progress:40}));const fe=z(re,`users/${D}/stats`),tt=await K(fe),It=tt.exists()?b(tt.val()):u();e(Be=>({...Be,currentStep:"Loading habits and progress...",progress:60}));const nt=z(re,`users/${D}/profile`),De=await K(nt),Ct=De.exists()?k(De.val()):h();e(Be=>({...Be,currentStep:"Loading achievements...",progress:80}));const Mt=z(re,`users/${D}/profile/cravingsResisted`),Rn=await K(Mt),qe=Rn.exists()?Math.max(0,parseInt(Rn.val())||0):0;e(Be=>({...Be,currentStep:"Setting up live sync...",progress:90}));const Oe=de(fe,Be=>{if(Be.exists()){const Jn=b(Be.val());if(ce(Jn),currentView==="arena"&&user){const Et={...user,stats:Jn};calculateRealTimeStats(Et).then(setRealTimeUserStats)}}}),pn=de(nt,Be=>{if(Be.exists()){const Jn=k(Be.val());currentView==="profile"&&f(Jn)}}),Fn=de(Mt,Be=>{if(Be.exists()){const Jn=Math.max(0,parseInt(Be.val())||0);currentView==="craving-support"&&W(Jn)}});return r([Oe,pn,Fn]),e(Be=>({...Be,currentStep:"Finalizing...",progress:100})),setUser(Be=>({...Be,...Ee,stats:It})),f(Ct),W(qe),Ee.onboardingCompleted&&setHasCompletedOnboarding(!0),e({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:Ee,stats:It,profileData:Ct,cravingsResisted:qe}),!0}catch(z){return console.error("❌ Error loading user data:",z),e({isLoading:!1,progress:0,currentStep:"Failed to load data",error:z.message,isComplete:!1}),p("Failed to load user data",z.message),!1}},T=D=>D?{uid:D.uid||"",email:D.email||"",heroName:D.heroName||"Hero",archetype:D.archetype||"The Determined",avatar:D.avatar||_s("default"),quitDate:D.quitDate||new Date().toISOString(),onboardingCompleted:!!D.onboardingCompleted,updatedAt:D.updatedAt||Date.now(),...D}:C(),b=D=>D?{mentalStrength:Math.max(0,Math.min(100,parseInt(D.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(D.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(D.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(D.addictionLevel)||50)),moneySaved:Math.max(0,parseInt(D.moneySaved)||0),...D}:u(),k=D=>D?{dailyWater:Math.max(0,parseInt(D.dailyWater)||0),dailyMood:D.dailyMood||null,dailyBreathing:!!D.dailyBreathing,scheduledTriggers:Array.isArray(D.scheduledTriggers)?D.scheduledTriggers:[],relapseDate:D.relapseDate?new Date(D.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(D.cravingsResisted)||0),...D}:h(),C=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:_s("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});j.useEffect(()=>()=>{t.forEach(D=>{typeof D=="function"&&D()})},[t]);const[x,R]=j.useState(null);j.useEffect(()=>{(async()=>{try{const z=(await $e(()=>import("./offlineManager-3f4e7c38.js"),[])).default,K=new z;R(K),window.refreshUserData=F,console.log("✅ Offline manager initialized")}catch(z){console.error("Error initializing offline manager:",z)}})()},[]);const P=async D=>{if(!D)return!1;const z=await _(D);if(z&&x&&(await x.cacheUserData(user),await x.cacheProfileData({dailyWater:E,dailyMood:v,dailyBreathing:S,scheduledTriggers:ge,relapseDate:A,cravingsResisted:Fe})),!z&&x){console.log("📱 Loading offline data...");const K=await x.getCachedUserData(),de=await x.getCachedProfileData();if(K)return console.log("📱 Using offline user data"),setUser(K),setHasCompletedOnboarding(K.onboardingCompleted),de&&f(de),!0}return z},U=async()=>authUser!=null&&authUser.uid?(console.log("🔄 Refreshing user data with offline support..."),await P(authUser.uid)):!1,F=async()=>{if(!(authUser!=null&&authUser.uid)){p("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await U()){const z=document.createElement("div");z.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",z.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(z),setTimeout(()=>{z.parentNode&&z.parentNode.removeChild(z)},5e3)}else p("Refresh Failed","Could not refresh data. Please try again.")},[A,w]=j.useState(null),[E,y]=j.useState(0),[v,N]=j.useState(null),[S,X]=j.useState(!1),[ge,he]=j.useState([]),[Fe,W]=j.useState(0),[le,ce]=j.useState(u());j.useEffect(()=>{const D=K=>{if(K.message&&K.message.includes("content_script")){console.warn("Browser extension error (ignored):",K.message);return}if(K.message&&(K.message.includes("FrameDoesNotExistError")||K.message.includes("background.js"))){console.warn("Background frame error (ignored):",K.message);return}console.error("Global error caught:",K)},z=K=>{if(K.reason&&K.reason.message&&K.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",K.reason.message);return}if(K.reason&&K.reason.message&&(K.reason.message.includes("FrameDoesNotExistError")||K.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",K.reason.message);return}console.error("Unhandled promise rejection:",K.reason)};return window.addEventListener("error",D),window.addEventListener("unhandledrejection",z),()=>{window.removeEventListener("error",D),window.removeEventListener("unhandledrejection",z)}},[]),j.useEffect(()=>{const D=async(z=0)=>{try{const{ref:K,set:de,get:oe,child:te}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),_e=K(re),Ee=te(_e,"healthchecks/vite_dev");await de(Ee,{lastRun:Date.now()});const fe=await oe(Ee);console.log("🔥 Firebase RTDB connected. Healthcheck exists:",fe.exists())}catch(K){if(console.error("Firebase connectivity test failed:",(K==null?void 0:K.message)||K),z<3){const de=Math.pow(2,z)*1e3;console.log(`Retrying Firebase connection in ${de}ms... (attempt ${z+1}/3)`),setTimeout(()=>D(z+1),de)}else console.error("Firebase connection failed after 3 retries. Check your internet connection and Firebase configuration.")}};D()},[]),j.useEffect(()=>{let D=!0,z=null;return(async()=>{try{console.log("Initializing authentication state..."),setAuthLoading(!0);const{onAuthStateChanged:de}=await $e(()=>import("./index.esm-6c4f5730.js"),[]);z=de(_i,async te=>{if(D)if(console.log("Auth state changed:",te?`User: ${te.uid}`:"No user"),te){setAuthUser(te),console.log("User authenticated, checking database for user data...");try{const{ref:_e,get:Ee}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),fe=_e(re,`users/${te.uid}`),tt=await Ee(fe);if(tt.exists()){const It=tt.val();console.log("Existing user data found - auto-login successful"),setUser(It),setHasCompletedOnboarding(!0),setCurrentView("arena"),console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),setCurrentView("onboarding")}catch(_e){console.error("Error fetching user data during auto-login:",_e),setCurrentView("onboarding")}}else console.log("No authenticated user - showing login screen"),setAuthUser(null),setUser(null),setHasCompletedOnboarding(!1),setCurrentView("auth")});const oe=setTimeout(()=>{D&&(console.warn("Auth initialization timeout - forcing to auth screen"),setAuthLoading(!1),setCurrentView("auth"))},1e4);z&&clearTimeout(oe)}catch(de){console.error("Error initializing authentication:",de),D&&(setAuthLoading(!1),setCurrentView("auth"))}finally{D&&setAuthLoading(!1)}})(),()=>{D=!1,z&&z()}},[]);const ke=async D=>{console.log("Authentication successful, checking for existing user data...",{uid:D==null?void 0:D.uid,email:D==null?void 0:D.email});try{const{ref:z,get:K}=await $e(()=>import("./index.esm-8052bcf6.js"),[]);console.log("Checking database for existing user data...");const de=z(re,`users/${D.uid}`),oe=await K(de);if(oe.exists()){const te=oe.val();if(console.log("Existing user data found - loading all user data..."),await P(D.uid))console.log("✅ All user data loaded successfully, going to Arena"),setCurrentView("arena");else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),setUser(te);const Ee=!!te.onboardingCompleted;setHasCompletedOnboarding(Ee),setCurrentView("arena")}}else console.log("No user data found - starting onboarding"),setCurrentView("onboarding")}catch(z){console.error("Database check failed:",z),setCurrentView("onboarding")}},[ue,ie]=j.useState(null),[Ve,vt]=j.useState(!1),[bn,fn]=j.useState(null),so=async()=>{var D,z,K,de,oe,te,_e,Ee;if(!(!(user!=null&&user.uid)||Ve)){vt(!0),fn(null);try{if(console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!o),console.log("🔄 FirestoreBuddyService type:",typeof o),!(l.current||o)){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await _a();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:tt,query:It,where:nt,getDocs:De}=await $e(()=>import("./index.esm-3e05db01.js"),[]),Ct=tt(xf,"buddyPairs"),Mt=It(Ct,nt("user1Id","==",user.uid)),Rn=await De(Mt);let qe=null,Oe=null;if(Rn.empty){const pn=It(Ct,nt("user2Id","==",user.uid)),Fn=await De(pn);if(!Fn.empty){const Be=Fn.docs[0];qe={id:Be.id,...Be.data()},Oe=qe.user1Id}}else{const pn=Rn.docs[0];qe={id:pn.id,...pn.data()},Oe=qe.user2Id}if(qe&&Oe){console.log("✅ Firestore: Found buddy pair:",qe.id);const{ref:pn,get:Fn}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),Be=pn(re,`users/${Oe}`),Jn=await Fn(Be);if(!Jn.exists()){console.log("⚠️ Firestore: Cleaning up orphaned buddy pair:",qe.id);const{deleteDoc:va,doc:eh}=await $e(()=>import("./index.esm-3e05db01.js"),[]);await va(eh(xf,"buddyPairs",qe.id)),ie(null);return}const Et=Jn.val(),Zd={heroName:Et.heroName||"Buddy",stats:{streakDays:((D=Et.stats)==null?void 0:D.streakDays)||0,addictionLevel:((z=Et.stats)==null?void 0:z.addictionLevel)||50,willpower:((K=Et.stats)==null?void 0:K.mentalStrength)||50,motivation:((de=Et.stats)==null?void 0:de.mentalStrength)||50,cravingResistance:((oe=Et.stats)==null?void 0:oe.mentalStrength)||50,triggerDefense:((te=Et.stats)==null?void 0:te.triggerDefense)||30,moneySaved:((_e=Et.stats)==null?void 0:_e.moneySaved)||0,experiencePoints:((Ee=Et.stats)==null?void 0:Ee.experiencePoints)||0},achievements:Et.achievements||[],archetype:Et.archetype||"The Determined",avatar:Et.avatar||_s(Et.heroName||"buddy","adventurer"),userId:Oe,isRealBuddy:!0,pairId:qe.id};ie(Zd),console.log("✅ Firestore: Buddy data loaded successfully"),await fs(user.uid,Oe)}else console.log("ℹ️ Firestore: No buddy pair found for user"),ie(null)}catch(fe){console.error("❌ Firestore: Error loading buddy:",fe),console.log("🔄 Falling back to Realtime Database buddy loading..."),await _a()}finally{vt(!1)}}},_a=async()=>{var D,z,K,de,oe,te,_e,Ee;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:fe,get:tt}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),It=fe(re,"buddyPairs"),nt=await tt(It);if(!nt.exists()){ie(null);return}const De=nt.val();let Ct=null,Mt=null;for(const[Rn,qe]of Object.entries(De))if(qe.users&&Array.isArray(qe.users)&&qe.users.includes(user.uid)){Ct={...qe,pairId:Rn},Mt=qe.users.find(Oe=>Oe!==user.uid);break}if(Ct&&Mt){const Rn=fe(re,`users/${Mt}`),qe=await tt(Rn);if(!qe.exists()){const{remove:Fn}=await $e(()=>import("./index.esm-8052bcf6.js"),[]);await Fn(fe(re,`buddyPairs/${Ct.pairId}`)),ie(null);return}const Oe=qe.val(),pn={heroName:Oe.heroName||"Buddy",stats:{streakDays:((D=Oe.stats)==null?void 0:D.streakDays)||0,addictionLevel:((z=Oe.stats)==null?void 0:z.addictionLevel)||50,willpower:((K=Oe.stats)==null?void 0:K.mentalStrength)||50,motivation:((de=Oe.stats)==null?void 0:de.mentalStrength)||50,cravingResistance:((oe=Oe.stats)==null?void 0:oe.mentalStrength)||50,triggerDefense:((te=Oe.stats)==null?void 0:te.triggerDefense)||30,moneySaved:((_e=Oe.stats)==null?void 0:_e.moneySaved)||0,experiencePoints:((Ee=Oe.stats)==null?void 0:Ee.experiencePoints)||0},achievements:Oe.achievements||[],archetype:Oe.archetype||"The Determined",avatar:Oe.avatar||_s(Oe.heroName||"buddy","adventurer"),userId:Mt,isRealBuddy:!0,pairId:Ct.pairId};ie(pn),await fs(user.uid,Mt)}else ie(null)}catch(fe){console.error("Error loading buddy from Realtime Database:",fe),fn("Failed to load buddy data"),ie(null)}},fs=async(D,z)=>{try{const K=l.current||o;if(K&&(ue!=null&&ue.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await K.removeFromMatchingPool(D),await K.removeFromMatchingPool(z);const{doc:de,updateDoc:oe}=await $e(()=>import("./index.esm-3e05db01.js"),[]),te=de(xf,"buddyPairs",ue.pairId);await oe(te,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:de,remove:oe,set:te}=await $e(()=>import("./index.esm-8052bcf6.js"),[]);await oe(de(re,`matchingPool/${D}`)),await oe(de(re,`matchingPool/${z}`)),ue!=null&&ue.pairId&&(await te(de(re,`buddyPairs/${ue.pairId}/user1RemovedFromPool`),!0),await te(de(re,`buddyPairs/${ue.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(K){console.error("❌ Error removing users from matching pool:",K)}};j.useEffect(()=>{user!=null&&user.uid&&!ue&&!Ve&&so()},[user==null?void 0:user.uid,ue,Ve]),j.useEffect(()=>{o?(console.log("🎉 FirestoreBuddyService state updated - service is now available!"),console.log("📊 Service details:",o.getServiceStatus()),o.testConnectivity().then(D=>{console.log("🔗 Initial connectivity test result:",D)}).catch(D=>{console.error("❌ Initial connectivity test failed:",D)})):console.log("ℹ️ FirestoreBuddyService state is null/undefined")},[o]);const ps=async()=>{try{const D=l.current||o;if(!D){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Ie();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting automatic user matching...");const z=await D.getAllMatchingPoolUsers();if(z.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing");return}console.log(`🔄 Firestore: Found ${z.length} users in matching pool`);const K=[];for(const oe of z)try{const{ref:te,get:_e}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),Ee=te(re,`users/${oe.userId}`);(await _e(Ee)).exists()?K.push(oe):(console.log(`⚠️ Firestore: Removing invalid user from matching pool: ${oe.userId}`),await D.removeFromMatchingPool(oe.userId))}catch(te){console.error("❌ Firestore: Error validating user:",te)}if(K.length<2){console.log("ℹ️ Firestore: Not enough valid users for pairing after validation");return}let de=0;for(let oe=0;oe<K.length-1;oe+=2){const te=K[oe],_e=K[oe+1];try{console.log(`🔄 Firestore: Creating buddy pair between ${te.userId} and ${_e.userId}`);const Ee={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Sequential auto-match","First-come, first-served pairing"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1},fe=await D.createBuddyPair(te.userId,_e.userId,Ee);if(fe){const{ref:tt,set:It}=await $e(()=>import("./index.esm-8052bcf6.js"),[]);await It(tt(re,`users/${te.userId}/buddyInfo`),{hasBuddy:!0,buddyId:_e.userId,pairId:fe,matchedAt:Ee.matchedAt}),await It(tt(re,`users/${_e.userId}/buddyInfo`),{hasBuddy:!0,buddyId:te.userId,pairId:fe,matchedAt:Ee.matchedAt}),await D.removeFromMatchingPool(te.userId),await D.removeFromMatchingPool(_e.userId),de++,console.log(`✅ Firestore: Created buddy pair ${fe} between ${te.userId} and ${_e.userId}`)}else console.error(`❌ Firestore: Failed to create buddy pair between ${te.userId} and ${_e.userId}`)}catch(Ee){console.error(`❌ Firestore: Failed to create buddy pair between ${te.userId} and ${_e.userId}:`,Ee)}}if(user!=null&&user.uid&&K.some(te=>te.userId===user.uid))try{await so()}catch(te){console.error("Error reloading buddy data:",te)}de>0&&console.log(`🎉 Firestore: Auto-matching completed: ${de} pairs created`)}catch(D){console.error("❌ Firestore: Auto-matching failed:",D),console.log("🔄 Falling back to Realtime Database auto-matching..."),await Ie()}},Ie=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:D,get:z,set:K,push:de,remove:oe}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),te=D(re,"matchingPool"),_e=await z(te);if(!_e.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const Ee=_e.val(),fe=[];if(Object.entries(Ee).forEach(([nt,De])=>{typeof De=="string"?fe.push(De):De&&typeof De=="object"?De.uid?fe.push(De.uid):De.userId?fe.push(De.userId):fe.push(nt):fe.push(nt)}),console.log(`🔄 Realtime Database: Found ${fe.length} users in matching pool`),fe.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",fe.length,")");return}const tt=[];for(const nt of fe)try{const De=D(re,`users/${nt}`);(await z(De)).exists()?tt.push(nt):(console.log(`⚠️ Realtime Database: Removing invalid user from matching pool: ${nt}`),await oe(D(re,`matchingPool/${nt}`)))}catch(De){console.error("❌ Realtime Database: Error validating user:",De)}if(tt.length<2){console.log("ℹ️ Realtime Database: Not enough valid users for pairing after validation");return}console.log(`🔄 Realtime Database: Valid users for pairing: ${tt.join(", ")}`);let It=0;for(let nt=0;nt<tt.length-1;nt+=2){const De=tt[nt],Ct=tt[nt+1];console.log(`🔄 Realtime Database: Pairing users ${De} and ${Ct}`);try{const Mt=de(D(re,"buddyPairs")).key,Rn={pairId:Mt,users:[De,Ct],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Sequential auto-match","First-come, first-served pairing"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await K(D(re,`buddyPairs/${Mt}`),Rn),await K(D(re,`users/${De}/buddyInfo`),{hasBuddy:!0,buddyId:Ct,pairId:Mt,matchedAt:Rn.matchedAt}),await K(D(re,`users/${Ct}/buddyInfo`),{hasBuddy:!0,buddyId:De,pairId:Mt,matchedAt:Rn.matchedAt}),Object.keys(Ee).forEach(async qe=>{const Oe=Ee[qe],pn=(Oe==null?void 0:Oe.uid)||(Oe==null?void 0:Oe.userId)||qe;(pn===De||pn===Ct)&&await oe(D(re,`matchingPool/${qe}`))}),await K(D(re,`buddyPairs/${Mt}/user1RemovedFromPool`),!0),await K(D(re,`buddyPairs/${Mt}/user2RemovedFromPool`),!0),It++}catch(Mt){console.error("Error creating buddy pair:",Mt)}}if(user!=null&&user.uid&&tt.some(De=>De===user.uid))try{await so()}catch(De){console.error("Error reloading buddy data:",De)}It>0&&console.log(`🎉 Realtime Database: Auto-matching completed: ${It} pairs created`)}catch(D){console.error("Error in Realtime Database auto-matching:",D)}};j.useEffect(()=>{const D=z=>{const K=z.detail;console.log("Navigating to tab:",K),K==="buddy-chat"&&(setCurrentView("buddy-chat"),setActiveTab("buddy-chat"))};return window.addEventListener("navigateToTab",D),()=>{window.removeEventListener("navigateToTab",D)}},[]);const Se={heroName:"",stats:{streakDays:0,addictionLevel:0,willpower:0,motivation:0,cravingResistance:0,triggerDefense:0,moneySaved:0,experiencePoints:0},achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},Ye=()=>Ve?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,moneySaved:0,experiencePoints:0},achievements:[],archetype:"LOADING",avatar:_s("loading","adventurer"),isLoading:!0}:bn?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,moneySaved:0,experiencePoints:0},achievements:[],archetype:"ERROR",avatar:_s("error","adventurer"),isError:!0,errorMessage:bn}:ue||Se,ye=async D=>{console.log("Onboarding completed with user data:",D);try{if(!D||!D.heroName||!D.stats)throw new Error("Invalid user data received from onboarding");if(!authUser)throw new Error("No authenticated user found");const z={...D,uid:authUser.uid,email:authUser.email,displayName:authUser.displayName||D.heroName,photoURL:authUser.photoURL,onboardingCompleted:!0,updatedAt:Date.now()};console.log("Saving user data to Firebase:",z);const{ref:K,set:de}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),oe=K(re,`users/${authUser.uid}`);await de(oe,z),console.log("Firebase save successful, updating app state..."),setUser(z),setHasCompletedOnboarding(!0);try{const _e=l.current||o;if(_e){console.log("✅ Using Firestore for matching pool");const Ee={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:authUser.uid,heroName:z.heroName,archetype:z.archetype};if(await _e.addToMatchingPool(authUser.uid,Ee))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Ee,set:fe}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),tt={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:authUser.uid,heroName:z.heroName,archetype:z.archetype};await fe(Ee(re,`matchingPool/${authUser.uid}`),tt),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{await ps()}catch(Ee){console.error("Automatic matching failed:",Ee)}}catch(_e){console.error("⚠️ Failed to add user to buddy matching pool:",_e)}const te=await P(authUser.uid);setCurrentView("arena")}catch(z){console.error("Error in handleOnboardingComplete:",z);const K={heroName:(D==null?void 0:D.heroName)||"Hero",archetype:(D==null?void 0:D.archetype)||"The Determined",avatar:(D==null?void 0:D.avatar)||_s("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,moneySaved:0,experiencePoints:0},achievements:[],quitDate:new Date,uid:authUser==null?void 0:authUser.uid,email:authUser==null?void 0:authUser.email,onboardingCompleted:!0};if(authUser)try{const{ref:de,set:oe}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),te=de(re,`users/${authUser.uid}`);await oe(te,K)}catch(de){console.error("Failed to save fallback data to Firebase:",de)}setUser(K),setHasCompletedOnboarding(!0),setCurrentView("arena")}},Je=()=>{setUser(null),setHasCompletedOnboarding(!1),setCurrentView("onboarding"),setActiveTab("arena"),setSelectedMood(null),localStorage.removeItem("quitCoachUser")},Ot=async()=>{try{console.log("Logging out user...");const{signOut:D}=await $e(()=>import("./index.esm-6c4f5730.js"),[]);await D(_i),setUser(null),setAuthUser(null),setHasCompletedOnboarding(!1),setCurrentView("auth"),localStorage.removeItem("lastSOS"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(D){console.error("Error during logout:",D),setUser(null),setAuthUser(null),setHasCompletedOnboarding(!1),setCurrentView("auth")}},An=async()=>{if(!authUser){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:D,set:z,remove:K}=await $e(()=>import("./index.esm-8052bcf6.js"),[]),de=D(re,`users/${authUser.uid}`);await z(de,null);const oe=D(re,"users");await z(oe,null);const te=D(re,"buddyPairs");await z(te,null);const _e=D(re,"matchingPool");await z(_e,null),console.log("All user data and buddy matching data cleared from database"),setUser(null),setHasCompletedOnboarding(!1),setCurrentView("onboarding"),ie(null),vt(!1),fn(null),console.log("Account reset successful - ready for fresh onboarding")}catch(D){console.error("Error resetting account for testing:",D)}},Cn=D=>{console.log("Tab changed to:",D),setActiveTab(D),setCurrentView(D)},gr=D=>{D==="mood-selector"?setCurrentView("mood-selector"):setCurrentView("profile")},wt=D=>{setSelectedMood(D),setCurrentView("profile")},jt=()=>{setCurrentView("profile")};return authLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):currentView==="auth"?d.jsx($z,{onAuthSuccess:ke}):n.isLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:n.currentStep}),d.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[d.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${n.progress}%`}})}),d.jsxs("div",{className:"text-sm text-gray-400",children:[n.progress,"% Complete"]})]}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),n.error&&d.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[d.jsxs("p",{className:"text-red-300 text-sm",children:[d.jsx("span",{className:"font-semibold",children:"Error:"})," ",n.error]}),d.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:[d.jsx(zz,{}),!1,currentView==="onboarding"&&d.jsxs("div",{children:[console.log("Rendering OnboardingFlow"),d.jsx(Zz,{onComplete:ye,authUser})]}),hasCompletedOnboarding&&user?d.jsxs(d.Fragment,{children:[console.log("Main app rendering with user:",user,"view:",currentView),currentView==="arena"&&d.jsxs("div",{children:[console.log("Rendering ArenaView with user:",user),(()=>{try{const D=Ye();return d.jsx(sq,{user,nemesis:D,onBackToLogin:Ot,onResetForTesting:An,buddyLoading:Ve,buddyError:bn,realBuddy:ue})}catch(D){return console.error("Error rendering ArenaView:",D),d.jsxs("div",{className:"text-white text-center p-8",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),d.jsx("p",{className:"text-gray-300 mb-4",children:D.message}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-2 rounded hover:bg-blue-700",children:"Reload App"})]})}})()]}),currentView==="craving-support"&&d.jsxs("div",{children:[console.log("Rendering CravingSupportView with user:",user),d.jsx(aq,{user,nemesis:Ye(),onBackToLogin:Ot,onResetForTesting:An})]}),currentView==="profile"&&d.jsxs("div",{children:[console.log("Rendering ProfileView with user:",user),d.jsx(lq,{user,onNavigate:gr})]}),currentView==="mood-selector"&&d.jsx(MoodSelector,{onMoodSelect:wt,onBack:jt}),currentView==="buddy-chat"&&d.jsx(mq,{user,nemesis:Ye(),buddyMatchingService:s}),currentView==="settings"&&d.jsx(pq,{onResetApp:Je}),d.jsx(rq,{activeTab,onTabChange:Cn,dataLoadingState:n,onRefreshData:F,offlineManager:x})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),d.jsx("p",{className:"text-gray-300",children:hasCompletedOnboarding?"User data missing":"Onboarding not completed"}),d.jsxs("p",{className:"text-gray-300",children:["Current view: ",currentView]}),d.jsxs("p",{className:"text-gray-300",children:["User data: ",user?JSON.stringify(user,null,2):"None"]}),d.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding,user,currentView}),console.log("User data:",user)},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Debug State"})]})})]})};wy.createRoot(document.getElementById("root")).render(d.jsx(y2.StrictMode,{children:d.jsx(gq,{})}));export{Eq as $,xq as A,Sq as B,bq as C,zo as D,vq as E,M_ as F,Lq as G,Fq as H,jq as I,Uq as J,_R as K,$q as L,we as M,_q as N,a4 as O,l4 as P,Wr as Q,qr as R,Yq as S,C4 as T,Kq as U,Yt as V,wq as W,Iq as X,Oq as Y,Dq as Z,Zq as _,T4 as a,DB as a$,p7 as a0,Yd as a1,Qd as a2,g7 as a3,hd as a4,ga as a5,li as a6,u7 as a7,ci as a8,ws as a9,D7 as aA,_9 as aB,y7 as aC,O5 as aD,$7 as aE,tW as aF,KS as aG,h$ as aH,oB as aI,O7 as aJ,b7 as aK,NB as aL,H7 as aM,J7 as aN,eW as aO,z7 as aP,V7 as aQ,GB as aR,_7 as aS,E5 as aT,PB as aU,K7 as aV,Y7 as aW,Z7 as aX,L5 as aY,U7 as aZ,FB as a_,js as aa,If as ab,f7 as ac,Do as ad,al as ae,u9 as af,d7 as ag,W7 as ah,dv as ai,h7 as aj,d9 as ak,II as al,ui as am,T7 as an,HB as ao,q7 as ap,$k as aq,c9 as ar,Wk as as,OB as at,E7 as au,lB as av,MB as aw,m7 as ax,B7 as ay,C7 as az,mr as b,i8 as b$,S7 as b0,WB as b1,v7 as b2,uI as b3,I7 as b4,VB as b5,A7 as b6,G7 as b7,S$ as b8,X7 as b9,on as bA,sc as bB,qd as bC,_f as bD,Wm as bE,Wd as bF,zm as bG,Zw as bH,ar as bI,qm as bJ,gi as bK,We as bL,v5 as bM,jr as bN,y5 as bO,J0 as bP,kt as bQ,qo as bR,Q as bS,r8 as bT,R4 as bU,yt as bV,c7 as bW,Re as bX,n8 as bY,l7 as bZ,a7 as b_,j7 as ba,w7 as bb,F7 as bc,P7 as bd,k7 as be,Q7 as bf,N7 as bg,L7 as bh,M7 as bi,R7 as bj,x7 as bk,ak as bl,ad as bm,J6 as bn,rr as bo,l8 as bp,as as bq,Qe as br,or as bs,ha as bt,fa as bu,et as bv,B as bw,ls as bx,K6 as by,w5 as bz,S0 as c,FS as c$,br as c0,j4 as c1,a5 as c2,P8 as c3,k8 as c4,I8 as c5,X8 as c6,J8 as c7,N8 as c8,h8 as c9,F8 as cA,j8 as cB,Q6 as cC,r7 as cD,Z8 as cE,c8 as cF,T8 as cG,x8 as cH,MS as cI,q8 as cJ,G8 as cK,W8 as cL,Y6 as cM,US as cN,B8 as cO,$8 as cP,w8 as cQ,E8 as cR,H8 as cS,K8 as cT,m5 as cU,_8 as cV,HP as cW,O8 as cX,a8 as cY,Q8 as cZ,Bh as c_,cy as ca,o8 as cb,H6 as cc,r5 as cd,o7 as ce,jS as cf,Y8 as cg,m8 as ch,i7 as ci,Hc as cj,y8 as ck,D8 as cl,u8 as cm,d8 as cn,p8 as co,s7 as cp,C8 as cq,A8 as cr,At as cs,Gd as ct,l5 as cu,z8 as cv,i5 as cw,V8 as cx,L8 as cy,o5 as cz,Xr as d,n7 as d0,t8 as d1,M8 as d2,b8 as d3,S8 as d4,R8 as d5,g8 as d6,U8 as d7,e7 as d8,f8 as d9,v8 as da,t7 as db,$e as dc,wl as e,Xq as f,S4 as g,Jq as h,Hq as i,Nq as j,Pq as k,Bq as l,qq as m,zq as n,Nt as o,x4 as p,Wq as q,ER as r,iC as s,Gq as t,Qq as u,q0 as v,Mq as w,Vq as x,Aq as y,Tq as z};
