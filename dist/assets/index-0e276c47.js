(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function o2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Lb={exports:{}},pp={},Mb={exports:{}},it={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var th=Symbol.for("react.element"),a2=Symbol.for("react.portal"),l2=Symbol.for("react.fragment"),c2=Symbol.for("react.strict_mode"),u2=Symbol.for("react.profiler"),d2=Symbol.for("react.provider"),h2=Symbol.for("react.context"),f2=Symbol.for("react.forward_ref"),g2=Symbol.for("react.suspense"),p2=Symbol.for("react.memo"),m2=Symbol.for("react.lazy"),Cx=Symbol.iterator;function y2(n){return n===null||typeof n!="object"?null:(n=Cx&&n[Cx]||n["@@iterator"],typeof n=="function"?n:null)}var Ob={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Vb=Object.assign,Fb={};function Nc(n,e,t){this.props=n,this.context=e,this.refs=Fb,this.updater=t||Ob}Nc.prototype.isReactComponent={};Nc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Nc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function jb(){}jb.prototype=Nc.prototype;function $v(n,e,t){this.props=n,this.context=e,this.refs=Fb,this.updater=t||Ob}var Bv=$v.prototype=new jb;Bv.constructor=$v;Vb(Bv,Nc.prototype);Bv.isPureReactComponent=!0;var Rx=Array.isArray,Ub=Object.prototype.hasOwnProperty,zv={current:null},$b={key:!0,ref:!0,__self:!0,__source:!0};function Bb(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Ub.call(e,r)&&!$b.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:th,type:n,key:i,ref:o,props:s,_owner:zv.current}}function _2(n,e){return{$$typeof:th,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function qv(n){return typeof n=="object"&&n!==null&&n.$$typeof===th}function v2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var kx=/\/+/g;function Wm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?v2(""+n.key):e.toString(36)}function Rf(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case th:case a2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+Wm(o,0):r,Rx(s)?(t="",n!=null&&(t=n.replace(kx,"$&/")+"/"),Rf(s,e,t,"",function(u){return u})):s!=null&&(qv(s)&&(s=_2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(kx,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Rx(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+Wm(i,a);o+=Rf(i,e,t,l,s)}else if(l=y2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+Wm(i,a++),o+=Rf(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Kh(n,e,t){if(n==null)return n;var r=[],s=0;return Rf(n,r,"","",function(i){return e.call(t,i,s++)}),r}function w2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var hr={current:null},kf={transition:null},I2={ReactCurrentDispatcher:hr,ReactCurrentBatchConfig:kf,ReactCurrentOwner:zv};function zb(){throw Error("act(...) is not supported in production builds of React.")}it.Children={map:Kh,forEach:function(n,e,t){Kh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Kh(n,function(){e++}),e},toArray:function(n){return Kh(n,function(e){return e})||[]},only:function(n){if(!qv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};it.Component=Nc;it.Fragment=l2;it.Profiler=u2;it.PureComponent=$v;it.StrictMode=c2;it.Suspense=g2;it.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I2;it.act=zb;it.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Vb({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=zv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Ub.call(e,l)&&!$b.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:th,type:n.type,key:s,ref:i,props:r,_owner:o}};it.createContext=function(n){return n={$$typeof:h2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:d2,_context:n},n.Consumer=n};it.createElement=Bb;it.createFactory=function(n){var e=Bb.bind(null,n);return e.type=n,e};it.createRef=function(){return{current:null}};it.forwardRef=function(n){return{$$typeof:f2,render:n}};it.isValidElement=qv;it.lazy=function(n){return{$$typeof:m2,_payload:{_status:-1,_result:n},_init:w2}};it.memo=function(n,e){return{$$typeof:p2,type:n,compare:e===void 0?null:e}};it.startTransition=function(n){var e=kf.transition;kf.transition={};try{n()}finally{kf.transition=e}};it.unstable_act=zb;it.useCallback=function(n,e){return hr.current.useCallback(n,e)};it.useContext=function(n){return hr.current.useContext(n)};it.useDebugValue=function(){};it.useDeferredValue=function(n){return hr.current.useDeferredValue(n)};it.useEffect=function(n,e){return hr.current.useEffect(n,e)};it.useId=function(){return hr.current.useId()};it.useImperativeHandle=function(n,e,t){return hr.current.useImperativeHandle(n,e,t)};it.useInsertionEffect=function(n,e){return hr.current.useInsertionEffect(n,e)};it.useLayoutEffect=function(n,e){return hr.current.useLayoutEffect(n,e)};it.useMemo=function(n,e){return hr.current.useMemo(n,e)};it.useReducer=function(n,e,t){return hr.current.useReducer(n,e,t)};it.useRef=function(n){return hr.current.useRef(n)};it.useState=function(n){return hr.current.useState(n)};it.useSyncExternalStore=function(n,e,t){return hr.current.useSyncExternalStore(n,e,t)};it.useTransition=function(){return hr.current.useTransition()};it.version="18.3.1";Mb.exports=it;var V=Mb.exports;const x2=o2(V);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E2=V,S2=Symbol.for("react.element"),T2=Symbol.for("react.fragment"),b2=Object.prototype.hasOwnProperty,A2=E2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C2={key:!0,ref:!0,__self:!0,__source:!0};function qb(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)b2.call(e,r)&&!C2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:S2,type:n,key:i,ref:o,props:s,_owner:A2.current}}pp.Fragment=T2;pp.jsx=qb;pp.jsxs=qb;Lb.exports=pp;var d=Lb.exports,Qy={},Wb={exports:{}},$r={},Gb={exports:{}},Hb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(te,pe){var L=te.length;te.push(pe);e:for(;0<L;){var B=L-1>>>1,Y=te[B];if(0<s(Y,pe))te[B]=pe,te[L]=Y,L=B;else break e}}function t(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var pe=te[0],L=te.pop();if(L!==pe){te[0]=L;e:for(var B=0,Y=te.length,X=Y>>>1;B<X;){var he=2*(B+1)-1,Ae=te[he],ye=he+1,Le=te[ye];if(0>s(Ae,L))ye<Y&&0>s(Le,Ae)?(te[B]=Le,te[ye]=L,B=ye):(te[B]=Ae,te[he]=L,B=he);else if(ye<Y&&0>s(Le,L))te[B]=Le,te[ye]=L,B=ye;else break e}}return pe}function s(te,pe){var L=te.sortIndex-pe.sortIndex;return L!==0?L:te.id-pe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,g=3,y=!1,w=!1,C=!1,N=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(te){for(var pe=t(u);pe!==null;){if(pe.callback===null)r(u);else if(pe.startTime<=te)r(u),pe.sortIndex=pe.expirationTime,e(l,pe);else break;pe=t(u)}}function D(te){if(C=!1,R(te),!w)if(t(l)!==null)w=!0,Ve(U);else{var pe=t(u);pe!==null&&ln(D,pe.startTime-te)}}function U(te,pe){w=!1,C&&(C=!1,A(v),v=-1),y=!0;var L=g;try{for(R(pe),f=t(l);f!==null&&(!(f.expirationTime>pe)||te&&!I());){var B=f.callback;if(typeof B=="function"){f.callback=null,g=f.priorityLevel;var Y=B(f.expirationTime<=pe);pe=n.unstable_now(),typeof Y=="function"?f.callback=Y:f===t(l)&&r(l),R(pe)}else r(l);f=t(l)}if(f!==null)var X=!0;else{var he=t(u);he!==null&&ln(D,he.startTime-pe),X=!1}return X}finally{f=null,g=L,y=!1}}var P=!1,T=null,v=-1,b=5,_=-1;function I(){return!(n.unstable_now()-_<b)}function k(){if(T!==null){var te=n.unstable_now();_=te;var pe=!0;try{pe=T(!0,te)}finally{pe?S():(P=!1,T=null)}}else P=!1}var S;if(typeof x=="function")S=function(){x(k)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,vt=K.port2;K.port1.onmessage=k,S=function(){vt.postMessage(null)}}else S=function(){N(k,0)};function Ve(te){T=te,P||(P=!0,S())}function ln(te,pe){v=N(function(){te(n.unstable_now())},pe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(te){te.callback=null},n.unstable_continueExecution=function(){w||y||(w=!0,Ve(U))},n.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<te?Math.floor(1e3/te):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(te){switch(g){case 1:case 2:case 3:var pe=3;break;default:pe=g}var L=g;g=pe;try{return te()}finally{g=L}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(te,pe){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var L=g;g=te;try{return pe()}finally{g=L}},n.unstable_scheduleCallback=function(te,pe,L){var B=n.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?B+L:B):L=B,te){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=L+Y,te={id:h++,callback:pe,priorityLevel:te,startTime:L,expirationTime:Y,sortIndex:-1},L>B?(te.sortIndex=L,e(u,te),t(l)===null&&te===t(u)&&(C?(A(v),v=-1):C=!0,ln(D,L-B))):(te.sortIndex=Y,e(l,te),w||y||(w=!0,Ve(U))),te},n.unstable_shouldYield=I,n.unstable_wrapCallback=function(te){var pe=g;return function(){var L=g;g=pe;try{return te.apply(this,arguments)}finally{g=L}}}})(Hb);Gb.exports=Hb;var R2=Gb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k2=V,Vr=R2;function J(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Qb=new Set,ld={};function Wa(n,e){Xl(n,e),Xl(n+"Capture",e)}function Xl(n,e){for(ld[n]=e,n=0;n<e.length;n++)Qb.add(e[n])}var mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ky=Object.prototype.hasOwnProperty,N2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Nx={},Px={};function P2(n){return Ky.call(Px,n)?!0:Ky.call(Nx,n)?!1:N2.test(n)?Px[n]=!0:(Nx[n]=!0,!1)}function D2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function L2(n,e,t,r){if(e===null||typeof e>"u"||D2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function fr(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Hn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Hn[n]=new fr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Hn[e]=new fr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Hn[n]=new fr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Hn[n]=new fr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Hn[n]=new fr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Hn[n]=new fr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Hn[n]=new fr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Hn[n]=new fr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Hn[n]=new fr(n,5,!1,n.toLowerCase(),null,!1,!1)});var Wv=/[\-:]([a-z])/g;function Gv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Wv,Gv);Hn[e]=new fr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Wv,Gv);Hn[e]=new fr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Wv,Gv);Hn[e]=new fr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Hn[n]=new fr(n,1,!1,n.toLowerCase(),null,!1,!1)});Hn.xlinkHref=new fr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Hn[n]=new fr(n,1,!1,n.toLowerCase(),null,!0,!0)});function Hv(n,e,t,r){var s=Hn.hasOwnProperty(e)?Hn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(L2(e,t,s,r)&&(t=null),r||s===null?P2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Ai=k2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yh=Symbol.for("react.element"),El=Symbol.for("react.portal"),Sl=Symbol.for("react.fragment"),Qv=Symbol.for("react.strict_mode"),Yy=Symbol.for("react.profiler"),Kb=Symbol.for("react.provider"),Yb=Symbol.for("react.context"),Kv=Symbol.for("react.forward_ref"),Jy=Symbol.for("react.suspense"),Xy=Symbol.for("react.suspense_list"),Yv=Symbol.for("react.memo"),Wi=Symbol.for("react.lazy"),Jb=Symbol.for("react.offscreen"),Dx=Symbol.iterator;function su(n){return n===null||typeof n!="object"?null:(n=Dx&&n[Dx]||n["@@iterator"],typeof n=="function"?n:null)}var on=Object.assign,Gm;function xu(n){if(Gm===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Gm=e&&e[1]||""}return`
`+Gm+n}var Hm=!1;function Qm(n,e){if(!n||Hm)return"";Hm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Hm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?xu(n):""}function M2(n){switch(n.tag){case 5:return xu(n.type);case 16:return xu("Lazy");case 13:return xu("Suspense");case 19:return xu("SuspenseList");case 0:case 2:case 15:return n=Qm(n.type,!1),n;case 11:return n=Qm(n.type.render,!1),n;case 1:return n=Qm(n.type,!0),n;default:return""}}function Zy(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Sl:return"Fragment";case El:return"Portal";case Yy:return"Profiler";case Qv:return"StrictMode";case Jy:return"Suspense";case Xy:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Yb:return(n.displayName||"Context")+".Consumer";case Kb:return(n._context.displayName||"Context")+".Provider";case Kv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Yv:return e=n.displayName||null,e!==null?e:Zy(n.type)||"Memo";case Wi:e=n._payload,n=n._init;try{return Zy(n(e))}catch{}}return null}function O2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zy(e);case 8:return e===Qv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function So(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Xb(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function V2(n){var e=Xb(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Jh(n){n._valueTracker||(n._valueTracker=V2(n))}function Zb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Xb(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ig(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function e_(n,e){var t=e.checked;return on({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Lx(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=So(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function eA(n,e){e=e.checked,e!=null&&Hv(n,"checked",e,!1)}function t_(n,e){eA(n,e);var t=So(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?n_(n,e.type,t):e.hasOwnProperty("defaultValue")&&n_(n,e.type,So(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Mx(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function n_(n,e,t){(e!=="number"||ig(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Eu=Array.isArray;function Vl(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+So(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function r_(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(J(91));return on({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Ox(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(J(92));if(Eu(t)){if(1<t.length)throw Error(J(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:So(t)}}function tA(n,e){var t=So(e.value),r=So(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Vx(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function nA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function s_(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?nA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Xh,rA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Xh=Xh||document.createElement("div"),Xh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Xh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function cd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Lu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},F2=["Webkit","ms","Moz","O"];Object.keys(Lu).forEach(function(n){F2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Lu[e]=Lu[n]})});function sA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Lu.hasOwnProperty(n)&&Lu[n]?(""+e).trim():e+"px"}function iA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=sA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var j2=on({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function i_(n,e){if(e){if(j2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(J(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(J(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(J(61))}if(e.style!=null&&typeof e.style!="object")throw Error(J(62))}}function o_(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var a_=null;function Jv(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var l_=null,Fl=null,jl=null;function Fx(n){if(n=sh(n)){if(typeof l_!="function")throw Error(J(280));var e=n.stateNode;e&&(e=wp(e),l_(n.stateNode,n.type,e))}}function oA(n){Fl?jl?jl.push(n):jl=[n]:Fl=n}function aA(){if(Fl){var n=Fl,e=jl;if(jl=Fl=null,Fx(n),e)for(n=0;n<e.length;n++)Fx(e[n])}}function lA(n,e){return n(e)}function cA(){}var Km=!1;function uA(n,e,t){if(Km)return n(e,t);Km=!0;try{return lA(n,e,t)}finally{Km=!1,(Fl!==null||jl!==null)&&(cA(),aA())}}function ud(n,e){var t=n.stateNode;if(t===null)return null;var r=wp(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(J(231,e,typeof t));return t}var c_=!1;if(mi)try{var iu={};Object.defineProperty(iu,"passive",{get:function(){c_=!0}}),window.addEventListener("test",iu,iu),window.removeEventListener("test",iu,iu)}catch{c_=!1}function U2(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var Mu=!1,og=null,ag=!1,u_=null,$2={onError:function(n){Mu=!0,og=n}};function B2(n,e,t,r,s,i,o,a,l){Mu=!1,og=null,U2.apply($2,arguments)}function z2(n,e,t,r,s,i,o,a,l){if(B2.apply(this,arguments),Mu){if(Mu){var u=og;Mu=!1,og=null}else throw Error(J(198));ag||(ag=!0,u_=u)}}function Ga(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function dA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function jx(n){if(Ga(n)!==n)throw Error(J(188))}function q2(n){var e=n.alternate;if(!e){if(e=Ga(n),e===null)throw Error(J(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return jx(s),n;if(i===r)return jx(s),e;i=i.sibling}throw Error(J(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(J(189))}}if(t.alternate!==r)throw Error(J(190))}if(t.tag!==3)throw Error(J(188));return t.stateNode.current===t?n:e}function hA(n){return n=q2(n),n!==null?fA(n):null}function fA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=fA(n);if(e!==null)return e;n=n.sibling}return null}var gA=Vr.unstable_scheduleCallback,Ux=Vr.unstable_cancelCallback,W2=Vr.unstable_shouldYield,G2=Vr.unstable_requestPaint,fn=Vr.unstable_now,H2=Vr.unstable_getCurrentPriorityLevel,Xv=Vr.unstable_ImmediatePriority,pA=Vr.unstable_UserBlockingPriority,lg=Vr.unstable_NormalPriority,Q2=Vr.unstable_LowPriority,mA=Vr.unstable_IdlePriority,mp=null,$s=null;function K2(n){if($s&&typeof $s.onCommitFiberRoot=="function")try{$s.onCommitFiberRoot(mp,n,void 0,(n.current.flags&128)===128)}catch{}}var ys=Math.clz32?Math.clz32:X2,Y2=Math.log,J2=Math.LN2;function X2(n){return n>>>=0,n===0?32:31-(Y2(n)/J2|0)|0}var Zh=64,ef=4194304;function Su(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function cg(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Su(a):(i&=o,i!==0&&(r=Su(i)))}else o=t&~s,o!==0?r=Su(o):i!==0&&(r=Su(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-ys(e),s=1<<t,r|=n[t],e&=~s;return r}function Z2(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eL(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-ys(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=Z2(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function d_(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function yA(){var n=Zh;return Zh<<=1,!(Zh&4194240)&&(Zh=64),n}function Ym(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function nh(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ys(e),n[e]=t}function tL(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-ys(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Zv(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-ys(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var bt=0;function _A(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var vA,e0,wA,IA,xA,h_=!1,tf=[],lo=null,co=null,uo=null,dd=new Map,hd=new Map,Hi=[],nL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $x(n,e){switch(n){case"focusin":case"focusout":lo=null;break;case"dragenter":case"dragleave":co=null;break;case"mouseover":case"mouseout":uo=null;break;case"pointerover":case"pointerout":dd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":hd.delete(e.pointerId)}}function ou(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=sh(e),e!==null&&e0(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function rL(n,e,t,r,s){switch(e){case"focusin":return lo=ou(lo,n,e,t,r,s),!0;case"dragenter":return co=ou(co,n,e,t,r,s),!0;case"mouseover":return uo=ou(uo,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return dd.set(i,ou(dd.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,hd.set(i,ou(hd.get(i)||null,n,e,t,r,s)),!0}return!1}function EA(n){var e=ca(n.target);if(e!==null){var t=Ga(e);if(t!==null){if(e=t.tag,e===13){if(e=dA(t),e!==null){n.blockedOn=e,xA(n.priority,function(){wA(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Nf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=f_(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);a_=r,t.target.dispatchEvent(r),a_=null}else return e=sh(t),e!==null&&e0(e),n.blockedOn=t,!1;e.shift()}return!0}function Bx(n,e,t){Nf(n)&&t.delete(e)}function sL(){h_=!1,lo!==null&&Nf(lo)&&(lo=null),co!==null&&Nf(co)&&(co=null),uo!==null&&Nf(uo)&&(uo=null),dd.forEach(Bx),hd.forEach(Bx)}function au(n,e){n.blockedOn===e&&(n.blockedOn=null,h_||(h_=!0,Vr.unstable_scheduleCallback(Vr.unstable_NormalPriority,sL)))}function fd(n){function e(s){return au(s,n)}if(0<tf.length){au(tf[0],n);for(var t=1;t<tf.length;t++){var r=tf[t];r.blockedOn===n&&(r.blockedOn=null)}}for(lo!==null&&au(lo,n),co!==null&&au(co,n),uo!==null&&au(uo,n),dd.forEach(e),hd.forEach(e),t=0;t<Hi.length;t++)r=Hi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Hi.length&&(t=Hi[0],t.blockedOn===null);)EA(t),t.blockedOn===null&&Hi.shift()}var Ul=Ai.ReactCurrentBatchConfig,ug=!0;function iL(n,e,t,r){var s=bt,i=Ul.transition;Ul.transition=null;try{bt=1,t0(n,e,t,r)}finally{bt=s,Ul.transition=i}}function oL(n,e,t,r){var s=bt,i=Ul.transition;Ul.transition=null;try{bt=4,t0(n,e,t,r)}finally{bt=s,Ul.transition=i}}function t0(n,e,t,r){if(ug){var s=f_(n,e,t,r);if(s===null)oy(n,e,r,dg,t),$x(n,r);else if(rL(s,n,e,t,r))r.stopPropagation();else if($x(n,r),e&4&&-1<nL.indexOf(n)){for(;s!==null;){var i=sh(s);if(i!==null&&vA(i),i=f_(n,e,t,r),i===null&&oy(n,e,r,dg,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else oy(n,e,r,null,t)}}var dg=null;function f_(n,e,t,r){if(dg=null,n=Jv(r),n=ca(n),n!==null)if(e=Ga(n),e===null)n=null;else if(t=e.tag,t===13){if(n=dA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return dg=n,null}function SA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(H2()){case Xv:return 1;case pA:return 4;case lg:case Q2:return 16;case mA:return 536870912;default:return 16}default:return 16}}var eo=null,n0=null,Pf=null;function TA(){if(Pf)return Pf;var n,e=n0,t=e.length,r,s="value"in eo?eo.value:eo.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Pf=s.slice(n,1<r?1-r:void 0)}function Df(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function nf(){return!0}function zx(){return!1}function Br(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?nf:zx,this.isPropagationStopped=zx,this}return on(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=nf)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=nf)},persist:function(){},isPersistent:nf}),e}var Pc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},r0=Br(Pc),rh=on({},Pc,{view:0,detail:0}),aL=Br(rh),Jm,Xm,lu,yp=on({},rh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:s0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==lu&&(lu&&n.type==="mousemove"?(Jm=n.screenX-lu.screenX,Xm=n.screenY-lu.screenY):Xm=Jm=0,lu=n),Jm)},movementY:function(n){return"movementY"in n?n.movementY:Xm}}),qx=Br(yp),lL=on({},yp,{dataTransfer:0}),cL=Br(lL),uL=on({},rh,{relatedTarget:0}),Zm=Br(uL),dL=on({},Pc,{animationName:0,elapsedTime:0,pseudoElement:0}),hL=Br(dL),fL=on({},Pc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gL=Br(fL),pL=on({},Pc,{data:0}),Wx=Br(pL),mL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_L={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vL(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=_L[n])?!!e[n]:!1}function s0(){return vL}var wL=on({},rh,{key:function(n){if(n.key){var e=mL[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Df(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?yL[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:s0,charCode:function(n){return n.type==="keypress"?Df(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Df(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),IL=Br(wL),xL=on({},yp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gx=Br(xL),EL=on({},rh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:s0}),SL=Br(EL),TL=on({},Pc,{propertyName:0,elapsedTime:0,pseudoElement:0}),bL=Br(TL),AL=on({},yp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),CL=Br(AL),RL=[9,13,27,32],i0=mi&&"CompositionEvent"in window,Ou=null;mi&&"documentMode"in document&&(Ou=document.documentMode);var kL=mi&&"TextEvent"in window&&!Ou,bA=mi&&(!i0||Ou&&8<Ou&&11>=Ou),Hx=String.fromCharCode(32),Qx=!1;function AA(n,e){switch(n){case"keyup":return RL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function CA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Tl=!1;function NL(n,e){switch(n){case"compositionend":return CA(e);case"keypress":return e.which!==32?null:(Qx=!0,Hx);case"textInput":return n=e.data,n===Hx&&Qx?null:n;default:return null}}function PL(n,e){if(Tl)return n==="compositionend"||!i0&&AA(n,e)?(n=TA(),Pf=n0=eo=null,Tl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return bA&&e.locale!=="ko"?null:e.data;default:return null}}var DL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kx(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!DL[n.type]:e==="textarea"}function RA(n,e,t,r){oA(r),e=hg(e,"onChange"),0<e.length&&(t=new r0("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Vu=null,gd=null;function LL(n){UA(n,0)}function _p(n){var e=Cl(n);if(Zb(e))return n}function ML(n,e){if(n==="change")return e}var kA=!1;if(mi){var ey;if(mi){var ty="oninput"in document;if(!ty){var Yx=document.createElement("div");Yx.setAttribute("oninput","return;"),ty=typeof Yx.oninput=="function"}ey=ty}else ey=!1;kA=ey&&(!document.documentMode||9<document.documentMode)}function Jx(){Vu&&(Vu.detachEvent("onpropertychange",NA),gd=Vu=null)}function NA(n){if(n.propertyName==="value"&&_p(gd)){var e=[];RA(e,gd,n,Jv(n)),uA(LL,e)}}function OL(n,e,t){n==="focusin"?(Jx(),Vu=e,gd=t,Vu.attachEvent("onpropertychange",NA)):n==="focusout"&&Jx()}function VL(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return _p(gd)}function FL(n,e){if(n==="click")return _p(e)}function jL(n,e){if(n==="input"||n==="change")return _p(e)}function UL(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Is=typeof Object.is=="function"?Object.is:UL;function pd(n,e){if(Is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Ky.call(e,s)||!Is(n[s],e[s]))return!1}return!0}function Xx(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Zx(n,e){var t=Xx(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Xx(t)}}function PA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?PA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function DA(){for(var n=window,e=ig();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ig(n.document)}return e}function o0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function $L(n){var e=DA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&PA(t.ownerDocument.documentElement,t)){if(r!==null&&o0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=Zx(t,i);var o=Zx(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var BL=mi&&"documentMode"in document&&11>=document.documentMode,bl=null,g_=null,Fu=null,p_=!1;function eE(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;p_||bl==null||bl!==ig(r)||(r=bl,"selectionStart"in r&&o0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Fu&&pd(Fu,r)||(Fu=r,r=hg(g_,"onSelect"),0<r.length&&(e=new r0("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=bl)))}function rf(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Al={animationend:rf("Animation","AnimationEnd"),animationiteration:rf("Animation","AnimationIteration"),animationstart:rf("Animation","AnimationStart"),transitionend:rf("Transition","TransitionEnd")},ny={},LA={};mi&&(LA=document.createElement("div").style,"AnimationEvent"in window||(delete Al.animationend.animation,delete Al.animationiteration.animation,delete Al.animationstart.animation),"TransitionEvent"in window||delete Al.transitionend.transition);function vp(n){if(ny[n])return ny[n];if(!Al[n])return n;var e=Al[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in LA)return ny[n]=e[t];return n}var MA=vp("animationend"),OA=vp("animationiteration"),VA=vp("animationstart"),FA=vp("transitionend"),jA=new Map,tE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fo(n,e){jA.set(n,e),Wa(e,[n])}for(var ry=0;ry<tE.length;ry++){var sy=tE[ry],zL=sy.toLowerCase(),qL=sy[0].toUpperCase()+sy.slice(1);Fo(zL,"on"+qL)}Fo(MA,"onAnimationEnd");Fo(OA,"onAnimationIteration");Fo(VA,"onAnimationStart");Fo("dblclick","onDoubleClick");Fo("focusin","onFocus");Fo("focusout","onBlur");Fo(FA,"onTransitionEnd");Xl("onMouseEnter",["mouseout","mouseover"]);Xl("onMouseLeave",["mouseout","mouseover"]);Xl("onPointerEnter",["pointerout","pointerover"]);Xl("onPointerLeave",["pointerout","pointerover"]);Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Tu));function nE(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,z2(r,e,void 0,n),n.currentTarget=null}function UA(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;nE(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;nE(s,a,u),i=l}}}if(ag)throw n=u_,ag=!1,u_=null,n}function Wt(n,e){var t=e[w_];t===void 0&&(t=e[w_]=new Set);var r=n+"__bubble";t.has(r)||($A(e,n,2,!1),t.add(r))}function iy(n,e,t){var r=0;e&&(r|=4),$A(t,n,r,e)}var sf="_reactListening"+Math.random().toString(36).slice(2);function md(n){if(!n[sf]){n[sf]=!0,Qb.forEach(function(t){t!=="selectionchange"&&(WL.has(t)||iy(t,!1,n),iy(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[sf]||(e[sf]=!0,iy("selectionchange",!1,e))}}function $A(n,e,t,r){switch(SA(e)){case 1:var s=iL;break;case 4:s=oL;break;default:s=t0}t=s.bind(null,e,t,n),s=void 0,!c_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function oy(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=ca(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}uA(function(){var u=i,h=Jv(t),f=[];e:{var g=jA.get(n);if(g!==void 0){var y=r0,w=n;switch(n){case"keypress":if(Df(t)===0)break e;case"keydown":case"keyup":y=IL;break;case"focusin":w="focus",y=Zm;break;case"focusout":w="blur",y=Zm;break;case"beforeblur":case"afterblur":y=Zm;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=qx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=cL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=SL;break;case MA:case OA:case VA:y=hL;break;case FA:y=bL;break;case"scroll":y=aL;break;case"wheel":y=CL;break;case"copy":case"cut":case"paste":y=gL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Gx}var C=(e&4)!==0,N=!C&&n==="scroll",A=C?g!==null?g+"Capture":null:g;C=[];for(var x=u,R;x!==null;){R=x;var D=R.stateNode;if(R.tag===5&&D!==null&&(R=D,A!==null&&(D=ud(x,A),D!=null&&C.push(yd(x,D,R)))),N)break;x=x.return}0<C.length&&(g=new y(g,w,null,t,h),f.push({event:g,listeners:C}))}}if(!(e&7)){e:{if(g=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",g&&t!==a_&&(w=t.relatedTarget||t.fromElement)&&(ca(w)||w[yi]))break e;if((y||g)&&(g=h.window===h?h:(g=h.ownerDocument)?g.defaultView||g.parentWindow:window,y?(w=t.relatedTarget||t.toElement,y=u,w=w?ca(w):null,w!==null&&(N=Ga(w),w!==N||w.tag!==5&&w.tag!==6)&&(w=null)):(y=null,w=u),y!==w)){if(C=qx,D="onMouseLeave",A="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(C=Gx,D="onPointerLeave",A="onPointerEnter",x="pointer"),N=y==null?g:Cl(y),R=w==null?g:Cl(w),g=new C(D,x+"leave",y,t,h),g.target=N,g.relatedTarget=R,D=null,ca(h)===u&&(C=new C(A,x+"enter",w,t,h),C.target=R,C.relatedTarget=N,D=C),N=D,y&&w)t:{for(C=y,A=w,x=0,R=C;R;R=dl(R))x++;for(R=0,D=A;D;D=dl(D))R++;for(;0<x-R;)C=dl(C),x--;for(;0<R-x;)A=dl(A),R--;for(;x--;){if(C===A||A!==null&&C===A.alternate)break t;C=dl(C),A=dl(A)}C=null}else C=null;y!==null&&rE(f,g,y,C,!1),w!==null&&N!==null&&rE(f,N,w,C,!0)}}e:{if(g=u?Cl(u):window,y=g.nodeName&&g.nodeName.toLowerCase(),y==="select"||y==="input"&&g.type==="file")var U=ML;else if(Kx(g))if(kA)U=jL;else{U=VL;var P=OL}else(y=g.nodeName)&&y.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(U=FL);if(U&&(U=U(n,u))){RA(f,U,t,h);break e}P&&P(n,g,u),n==="focusout"&&(P=g._wrapperState)&&P.controlled&&g.type==="number"&&n_(g,"number",g.value)}switch(P=u?Cl(u):window,n){case"focusin":(Kx(P)||P.contentEditable==="true")&&(bl=P,g_=u,Fu=null);break;case"focusout":Fu=g_=bl=null;break;case"mousedown":p_=!0;break;case"contextmenu":case"mouseup":case"dragend":p_=!1,eE(f,t,h);break;case"selectionchange":if(BL)break;case"keydown":case"keyup":eE(f,t,h)}var T;if(i0)e:{switch(n){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Tl?AA(n,t)&&(v="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(v="onCompositionStart");v&&(bA&&t.locale!=="ko"&&(Tl||v!=="onCompositionStart"?v==="onCompositionEnd"&&Tl&&(T=TA()):(eo=h,n0="value"in eo?eo.value:eo.textContent,Tl=!0)),P=hg(u,v),0<P.length&&(v=new Wx(v,n,null,t,h),f.push({event:v,listeners:P}),T?v.data=T:(T=CA(t),T!==null&&(v.data=T)))),(T=kL?NL(n,t):PL(n,t))&&(u=hg(u,"onBeforeInput"),0<u.length&&(h=new Wx("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=T))}UA(f,e)})}function yd(n,e,t){return{instance:n,listener:e,currentTarget:t}}function hg(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ud(n,t),i!=null&&r.unshift(yd(n,i,s)),i=ud(n,e),i!=null&&r.push(yd(n,i,s))),n=n.return}return r}function dl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function rE(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=ud(t,i),l!=null&&o.unshift(yd(t,l,a))):s||(l=ud(t,i),l!=null&&o.push(yd(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var GL=/\r\n?/g,HL=/\u0000|\uFFFD/g;function sE(n){return(typeof n=="string"?n:""+n).replace(GL,`
`).replace(HL,"")}function of(n,e,t){if(e=sE(e),sE(n)!==e&&t)throw Error(J(425))}function fg(){}var m_=null,y_=null;function __(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var v_=typeof setTimeout=="function"?setTimeout:void 0,QL=typeof clearTimeout=="function"?clearTimeout:void 0,iE=typeof Promise=="function"?Promise:void 0,KL=typeof queueMicrotask=="function"?queueMicrotask:typeof iE<"u"?function(n){return iE.resolve(null).then(n).catch(YL)}:v_;function YL(n){setTimeout(function(){throw n})}function ay(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),fd(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);fd(e)}function ho(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function oE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Dc=Math.random().toString(36).slice(2),Ms="__reactFiber$"+Dc,_d="__reactProps$"+Dc,yi="__reactContainer$"+Dc,w_="__reactEvents$"+Dc,JL="__reactListeners$"+Dc,XL="__reactHandles$"+Dc;function ca(n){var e=n[Ms];if(e)return e;for(var t=n.parentNode;t;){if(e=t[yi]||t[Ms]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=oE(n);n!==null;){if(t=n[Ms])return t;n=oE(n)}return e}n=t,t=n.parentNode}return null}function sh(n){return n=n[Ms]||n[yi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Cl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(J(33))}function wp(n){return n[_d]||null}var I_=[],Rl=-1;function jo(n){return{current:n}}function Ht(n){0>Rl||(n.current=I_[Rl],I_[Rl]=null,Rl--)}function Ut(n,e){Rl++,I_[Rl]=n.current,n.current=e}var To={},ar=jo(To),vr=jo(!1),Ea=To;function Zl(n,e){var t=n.type.contextTypes;if(!t)return To;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function wr(n){return n=n.childContextTypes,n!=null}function gg(){Ht(vr),Ht(ar)}function aE(n,e,t){if(ar.current!==To)throw Error(J(168));Ut(ar,e),Ut(vr,t)}function BA(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(J(108,O2(n)||"Unknown",s));return on({},t,r)}function pg(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||To,Ea=ar.current,Ut(ar,n),Ut(vr,vr.current),!0}function lE(n,e,t){var r=n.stateNode;if(!r)throw Error(J(169));t?(n=BA(n,e,Ea),r.__reactInternalMemoizedMergedChildContext=n,Ht(vr),Ht(ar),Ut(ar,n)):Ht(vr),Ut(vr,t)}var ii=null,Ip=!1,ly=!1;function zA(n){ii===null?ii=[n]:ii.push(n)}function ZL(n){Ip=!0,zA(n)}function Uo(){if(!ly&&ii!==null){ly=!0;var n=0,e=bt;try{var t=ii;for(bt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ii=null,Ip=!1}catch(s){throw ii!==null&&(ii=ii.slice(n+1)),gA(Xv,Uo),s}finally{bt=e,ly=!1}}return null}var kl=[],Nl=0,mg=null,yg=0,Qr=[],Kr=0,Sa=null,li=1,ci="";function Zo(n,e){kl[Nl++]=yg,kl[Nl++]=mg,mg=n,yg=e}function qA(n,e,t){Qr[Kr++]=li,Qr[Kr++]=ci,Qr[Kr++]=Sa,Sa=n;var r=li;n=ci;var s=32-ys(r)-1;r&=~(1<<s),t+=1;var i=32-ys(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,li=1<<32-ys(e)+s|t<<s|r,ci=i+n}else li=1<<i|t<<s|r,ci=n}function a0(n){n.return!==null&&(Zo(n,1),qA(n,1,0))}function l0(n){for(;n===mg;)mg=kl[--Nl],kl[Nl]=null,yg=kl[--Nl],kl[Nl]=null;for(;n===Sa;)Sa=Qr[--Kr],Qr[Kr]=null,ci=Qr[--Kr],Qr[Kr]=null,li=Qr[--Kr],Qr[Kr]=null}var Dr=null,Pr=null,Jt=!1,gs=null;function WA(n,e){var t=Jr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function cE(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Dr=n,Pr=ho(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Dr=n,Pr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Sa!==null?{id:li,overflow:ci}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Jr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Dr=n,Pr=null,!0):!1;default:return!1}}function x_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function E_(n){if(Jt){var e=Pr;if(e){var t=e;if(!cE(n,e)){if(x_(n))throw Error(J(418));e=ho(t.nextSibling);var r=Dr;e&&cE(n,e)?WA(r,t):(n.flags=n.flags&-4097|2,Jt=!1,Dr=n)}}else{if(x_(n))throw Error(J(418));n.flags=n.flags&-4097|2,Jt=!1,Dr=n}}}function uE(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Dr=n}function af(n){if(n!==Dr)return!1;if(!Jt)return uE(n),Jt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!__(n.type,n.memoizedProps)),e&&(e=Pr)){if(x_(n))throw GA(),Error(J(418));for(;e;)WA(n,e),e=ho(e.nextSibling)}if(uE(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(J(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Pr=ho(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Pr=null}}else Pr=Dr?ho(n.stateNode.nextSibling):null;return!0}function GA(){for(var n=Pr;n;)n=ho(n.nextSibling)}function ec(){Pr=Dr=null,Jt=!1}function c0(n){gs===null?gs=[n]:gs.push(n)}var eM=Ai.ReactCurrentBatchConfig;function cu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(J(309));var r=t.stateNode}if(!r)throw Error(J(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(J(284));if(!t._owner)throw Error(J(290,n))}return n}function lf(n,e){throw n=Object.prototype.toString.call(e),Error(J(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function dE(n){var e=n._init;return e(n._payload)}function HA(n){function e(A,x){if(n){var R=A.deletions;R===null?(A.deletions=[x],A.flags|=16):R.push(x)}}function t(A,x){if(!n)return null;for(;x!==null;)e(A,x),x=x.sibling;return null}function r(A,x){for(A=new Map;x!==null;)x.key!==null?A.set(x.key,x):A.set(x.index,x),x=x.sibling;return A}function s(A,x){return A=mo(A,x),A.index=0,A.sibling=null,A}function i(A,x,R){return A.index=R,n?(R=A.alternate,R!==null?(R=R.index,R<x?(A.flags|=2,x):R):(A.flags|=2,x)):(A.flags|=1048576,x)}function o(A){return n&&A.alternate===null&&(A.flags|=2),A}function a(A,x,R,D){return x===null||x.tag!==6?(x=py(R,A.mode,D),x.return=A,x):(x=s(x,R),x.return=A,x)}function l(A,x,R,D){var U=R.type;return U===Sl?h(A,x,R.props.children,D,R.key):x!==null&&(x.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Wi&&dE(U)===x.type)?(D=s(x,R.props),D.ref=cu(A,x,R),D.return=A,D):(D=Uf(R.type,R.key,R.props,null,A.mode,D),D.ref=cu(A,x,R),D.return=A,D)}function u(A,x,R,D){return x===null||x.tag!==4||x.stateNode.containerInfo!==R.containerInfo||x.stateNode.implementation!==R.implementation?(x=my(R,A.mode,D),x.return=A,x):(x=s(x,R.children||[]),x.return=A,x)}function h(A,x,R,D,U){return x===null||x.tag!==7?(x=ya(R,A.mode,D,U),x.return=A,x):(x=s(x,R),x.return=A,x)}function f(A,x,R){if(typeof x=="string"&&x!==""||typeof x=="number")return x=py(""+x,A.mode,R),x.return=A,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Yh:return R=Uf(x.type,x.key,x.props,null,A.mode,R),R.ref=cu(A,null,x),R.return=A,R;case El:return x=my(x,A.mode,R),x.return=A,x;case Wi:var D=x._init;return f(A,D(x._payload),R)}if(Eu(x)||su(x))return x=ya(x,A.mode,R,null),x.return=A,x;lf(A,x)}return null}function g(A,x,R,D){var U=x!==null?x.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return U!==null?null:a(A,x,""+R,D);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Yh:return R.key===U?l(A,x,R,D):null;case El:return R.key===U?u(A,x,R,D):null;case Wi:return U=R._init,g(A,x,U(R._payload),D)}if(Eu(R)||su(R))return U!==null?null:h(A,x,R,D,null);lf(A,R)}return null}function y(A,x,R,D,U){if(typeof D=="string"&&D!==""||typeof D=="number")return A=A.get(R)||null,a(x,A,""+D,U);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case Yh:return A=A.get(D.key===null?R:D.key)||null,l(x,A,D,U);case El:return A=A.get(D.key===null?R:D.key)||null,u(x,A,D,U);case Wi:var P=D._init;return y(A,x,R,P(D._payload),U)}if(Eu(D)||su(D))return A=A.get(R)||null,h(x,A,D,U,null);lf(x,D)}return null}function w(A,x,R,D){for(var U=null,P=null,T=x,v=x=0,b=null;T!==null&&v<R.length;v++){T.index>v?(b=T,T=null):b=T.sibling;var _=g(A,T,R[v],D);if(_===null){T===null&&(T=b);break}n&&T&&_.alternate===null&&e(A,T),x=i(_,x,v),P===null?U=_:P.sibling=_,P=_,T=b}if(v===R.length)return t(A,T),Jt&&Zo(A,v),U;if(T===null){for(;v<R.length;v++)T=f(A,R[v],D),T!==null&&(x=i(T,x,v),P===null?U=T:P.sibling=T,P=T);return Jt&&Zo(A,v),U}for(T=r(A,T);v<R.length;v++)b=y(T,A,v,R[v],D),b!==null&&(n&&b.alternate!==null&&T.delete(b.key===null?v:b.key),x=i(b,x,v),P===null?U=b:P.sibling=b,P=b);return n&&T.forEach(function(I){return e(A,I)}),Jt&&Zo(A,v),U}function C(A,x,R,D){var U=su(R);if(typeof U!="function")throw Error(J(150));if(R=U.call(R),R==null)throw Error(J(151));for(var P=U=null,T=x,v=x=0,b=null,_=R.next();T!==null&&!_.done;v++,_=R.next()){T.index>v?(b=T,T=null):b=T.sibling;var I=g(A,T,_.value,D);if(I===null){T===null&&(T=b);break}n&&T&&I.alternate===null&&e(A,T),x=i(I,x,v),P===null?U=I:P.sibling=I,P=I,T=b}if(_.done)return t(A,T),Jt&&Zo(A,v),U;if(T===null){for(;!_.done;v++,_=R.next())_=f(A,_.value,D),_!==null&&(x=i(_,x,v),P===null?U=_:P.sibling=_,P=_);return Jt&&Zo(A,v),U}for(T=r(A,T);!_.done;v++,_=R.next())_=y(T,A,v,_.value,D),_!==null&&(n&&_.alternate!==null&&T.delete(_.key===null?v:_.key),x=i(_,x,v),P===null?U=_:P.sibling=_,P=_);return n&&T.forEach(function(k){return e(A,k)}),Jt&&Zo(A,v),U}function N(A,x,R,D){if(typeof R=="object"&&R!==null&&R.type===Sl&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case Yh:e:{for(var U=R.key,P=x;P!==null;){if(P.key===U){if(U=R.type,U===Sl){if(P.tag===7){t(A,P.sibling),x=s(P,R.props.children),x.return=A,A=x;break e}}else if(P.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Wi&&dE(U)===P.type){t(A,P.sibling),x=s(P,R.props),x.ref=cu(A,P,R),x.return=A,A=x;break e}t(A,P);break}else e(A,P);P=P.sibling}R.type===Sl?(x=ya(R.props.children,A.mode,D,R.key),x.return=A,A=x):(D=Uf(R.type,R.key,R.props,null,A.mode,D),D.ref=cu(A,x,R),D.return=A,A=D)}return o(A);case El:e:{for(P=R.key;x!==null;){if(x.key===P)if(x.tag===4&&x.stateNode.containerInfo===R.containerInfo&&x.stateNode.implementation===R.implementation){t(A,x.sibling),x=s(x,R.children||[]),x.return=A,A=x;break e}else{t(A,x);break}else e(A,x);x=x.sibling}x=my(R,A.mode,D),x.return=A,A=x}return o(A);case Wi:return P=R._init,N(A,x,P(R._payload),D)}if(Eu(R))return w(A,x,R,D);if(su(R))return C(A,x,R,D);lf(A,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,x!==null&&x.tag===6?(t(A,x.sibling),x=s(x,R),x.return=A,A=x):(t(A,x),x=py(R,A.mode,D),x.return=A,A=x),o(A)):t(A,x)}return N}var tc=HA(!0),QA=HA(!1),_g=jo(null),vg=null,Pl=null,u0=null;function d0(){u0=Pl=vg=null}function h0(n){var e=_g.current;Ht(_g),n._currentValue=e}function S_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function $l(n,e){vg=n,u0=Pl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(pr=!0),n.firstContext=null)}function ts(n){var e=n._currentValue;if(u0!==n)if(n={context:n,memoizedValue:e,next:null},Pl===null){if(vg===null)throw Error(J(308));Pl=n,vg.dependencies={lanes:0,firstContext:n}}else Pl=Pl.next=n;return e}var ua=null;function f0(n){ua===null?ua=[n]:ua.push(n)}function KA(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,f0(e)):(t.next=s.next,s.next=t),e.interleaved=t,_i(n,r)}function _i(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Gi=!1;function g0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function YA(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function gi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function fo(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ft&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,_i(n,t)}return s=r.interleaved,s===null?(e.next=e,f0(r)):(e.next=s.next,s.next=e),r.interleaved=e,_i(n,t)}function Lf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Zv(n,t)}}function hE(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function wg(n,e,t,r){var s=n.updateQueue;Gi=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var g=a.lane,y=a.eventTime;if((r&g)===g){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var w=n,C=a;switch(g=e,y=t,C.tag){case 1:if(w=C.payload,typeof w=="function"){f=w.call(y,f,g);break e}f=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=C.payload,g=typeof w=="function"?w.call(y,f,g):w,g==null)break e;f=on({},f,g);break e;case 2:Gi=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,g=s.effects,g===null?s.effects=[a]:g.push(a))}else y={eventTime:y,lane:g,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,o|=g;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;g=a,a=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ba|=o,n.lanes=o,n.memoizedState=f}}function fE(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(J(191,s));s.call(r)}}}var ih={},Bs=jo(ih),vd=jo(ih),wd=jo(ih);function da(n){if(n===ih)throw Error(J(174));return n}function p0(n,e){switch(Ut(wd,e),Ut(vd,n),Ut(Bs,ih),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:s_(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=s_(e,n)}Ht(Bs),Ut(Bs,e)}function nc(){Ht(Bs),Ht(vd),Ht(wd)}function JA(n){da(wd.current);var e=da(Bs.current),t=s_(e,n.type);e!==t&&(Ut(vd,n),Ut(Bs,t))}function m0(n){vd.current===n&&(Ht(Bs),Ht(vd))}var nn=jo(0);function Ig(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var cy=[];function y0(){for(var n=0;n<cy.length;n++)cy[n]._workInProgressVersionPrimary=null;cy.length=0}var Mf=Ai.ReactCurrentDispatcher,uy=Ai.ReactCurrentBatchConfig,Ta=0,sn=null,wn=null,Nn=null,xg=!1,ju=!1,Id=0,tM=0;function Zn(){throw Error(J(321))}function _0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Is(n[t],e[t]))return!1;return!0}function v0(n,e,t,r,s,i){if(Ta=i,sn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Mf.current=n===null||n.memoizedState===null?iM:oM,n=t(r,s),ju){i=0;do{if(ju=!1,Id=0,25<=i)throw Error(J(301));i+=1,Nn=wn=null,e.updateQueue=null,Mf.current=aM,n=t(r,s)}while(ju)}if(Mf.current=Eg,e=wn!==null&&wn.next!==null,Ta=0,Nn=wn=sn=null,xg=!1,e)throw Error(J(300));return n}function w0(){var n=Id!==0;return Id=0,n}function Ns(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nn===null?sn.memoizedState=Nn=n:Nn=Nn.next=n,Nn}function ns(){if(wn===null){var n=sn.alternate;n=n!==null?n.memoizedState:null}else n=wn.next;var e=Nn===null?sn.memoizedState:Nn.next;if(e!==null)Nn=e,wn=n;else{if(n===null)throw Error(J(310));wn=n,n={memoizedState:wn.memoizedState,baseState:wn.baseState,baseQueue:wn.baseQueue,queue:wn.queue,next:null},Nn===null?sn.memoizedState=Nn=n:Nn=Nn.next=n}return Nn}function xd(n,e){return typeof e=="function"?e(n):e}function dy(n){var e=ns(),t=e.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=n;var r=wn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((Ta&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,sn.lanes|=h,ba|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Is(r,e.memoizedState)||(pr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,sn.lanes|=i,ba|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function hy(n){var e=ns(),t=e.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Is(i,e.memoizedState)||(pr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function XA(){}function ZA(n,e){var t=sn,r=ns(),s=e(),i=!Is(r.memoizedState,s);if(i&&(r.memoizedState=s,pr=!0),r=r.queue,I0(nC.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Nn!==null&&Nn.memoizedState.tag&1){if(t.flags|=2048,Ed(9,tC.bind(null,t,r,s,e),void 0,null),Ln===null)throw Error(J(349));Ta&30||eC(t,e,s)}return s}function eC(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=sn.updateQueue,e===null?(e={lastEffect:null,stores:null},sn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function tC(n,e,t,r){e.value=t,e.getSnapshot=r,rC(e)&&sC(n)}function nC(n,e,t){return t(function(){rC(e)&&sC(n)})}function rC(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Is(n,t)}catch{return!0}}function sC(n){var e=_i(n,1);e!==null&&_s(e,n,1,-1)}function gE(n){var e=Ns();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xd,lastRenderedState:n},e.queue=n,n=n.dispatch=sM.bind(null,sn,n),[e.memoizedState,n]}function Ed(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=sn.updateQueue,e===null?(e={lastEffect:null,stores:null},sn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function iC(){return ns().memoizedState}function Of(n,e,t,r){var s=Ns();sn.flags|=n,s.memoizedState=Ed(1|e,t,void 0,r===void 0?null:r)}function xp(n,e,t,r){var s=ns();r=r===void 0?null:r;var i=void 0;if(wn!==null){var o=wn.memoizedState;if(i=o.destroy,r!==null&&_0(r,o.deps)){s.memoizedState=Ed(e,t,i,r);return}}sn.flags|=n,s.memoizedState=Ed(1|e,t,i,r)}function pE(n,e){return Of(8390656,8,n,e)}function I0(n,e){return xp(2048,8,n,e)}function oC(n,e){return xp(4,2,n,e)}function aC(n,e){return xp(4,4,n,e)}function lC(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function cC(n,e,t){return t=t!=null?t.concat([n]):null,xp(4,4,lC.bind(null,e,n),t)}function x0(){}function uC(n,e){var t=ns();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&_0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function dC(n,e){var t=ns();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&_0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function hC(n,e,t){return Ta&21?(Is(t,e)||(t=yA(),sn.lanes|=t,ba|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,pr=!0),n.memoizedState=t)}function nM(n,e){var t=bt;bt=t!==0&&4>t?t:4,n(!0);var r=uy.transition;uy.transition={};try{n(!1),e()}finally{bt=t,uy.transition=r}}function fC(){return ns().memoizedState}function rM(n,e,t){var r=po(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},gC(n))pC(e,t);else if(t=KA(n,e,t,r),t!==null){var s=ur();_s(t,n,r,s),mC(t,e,r)}}function sM(n,e,t){var r=po(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(gC(n))pC(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Is(a,o)){var l=e.interleaved;l===null?(s.next=s,f0(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=KA(n,e,s,r),t!==null&&(s=ur(),_s(t,n,r,s),mC(t,e,r))}}function gC(n){var e=n.alternate;return n===sn||e!==null&&e===sn}function pC(n,e){ju=xg=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function mC(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Zv(n,t)}}var Eg={readContext:ts,useCallback:Zn,useContext:Zn,useEffect:Zn,useImperativeHandle:Zn,useInsertionEffect:Zn,useLayoutEffect:Zn,useMemo:Zn,useReducer:Zn,useRef:Zn,useState:Zn,useDebugValue:Zn,useDeferredValue:Zn,useTransition:Zn,useMutableSource:Zn,useSyncExternalStore:Zn,useId:Zn,unstable_isNewReconciler:!1},iM={readContext:ts,useCallback:function(n,e){return Ns().memoizedState=[n,e===void 0?null:e],n},useContext:ts,useEffect:pE,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Of(4194308,4,lC.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Of(4194308,4,n,e)},useInsertionEffect:function(n,e){return Of(4,2,n,e)},useMemo:function(n,e){var t=Ns();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ns();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=rM.bind(null,sn,n),[r.memoizedState,n]},useRef:function(n){var e=Ns();return n={current:n},e.memoizedState=n},useState:gE,useDebugValue:x0,useDeferredValue:function(n){return Ns().memoizedState=n},useTransition:function(){var n=gE(!1),e=n[0];return n=nM.bind(null,n[1]),Ns().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=sn,s=Ns();if(Jt){if(t===void 0)throw Error(J(407));t=t()}else{if(t=e(),Ln===null)throw Error(J(349));Ta&30||eC(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,pE(nC.bind(null,r,i,n),[n]),r.flags|=2048,Ed(9,tC.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Ns(),e=Ln.identifierPrefix;if(Jt){var t=ci,r=li;t=(r&~(1<<32-ys(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Id++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=tM++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},oM={readContext:ts,useCallback:uC,useContext:ts,useEffect:I0,useImperativeHandle:cC,useInsertionEffect:oC,useLayoutEffect:aC,useMemo:dC,useReducer:dy,useRef:iC,useState:function(){return dy(xd)},useDebugValue:x0,useDeferredValue:function(n){var e=ns();return hC(e,wn.memoizedState,n)},useTransition:function(){var n=dy(xd)[0],e=ns().memoizedState;return[n,e]},useMutableSource:XA,useSyncExternalStore:ZA,useId:fC,unstable_isNewReconciler:!1},aM={readContext:ts,useCallback:uC,useContext:ts,useEffect:I0,useImperativeHandle:cC,useInsertionEffect:oC,useLayoutEffect:aC,useMemo:dC,useReducer:hy,useRef:iC,useState:function(){return hy(xd)},useDebugValue:x0,useDeferredValue:function(n){var e=ns();return wn===null?e.memoizedState=n:hC(e,wn.memoizedState,n)},useTransition:function(){var n=hy(xd)[0],e=ns().memoizedState;return[n,e]},useMutableSource:XA,useSyncExternalStore:ZA,useId:fC,unstable_isNewReconciler:!1};function us(n,e){if(n&&n.defaultProps){e=on({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function T_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:on({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ep={isMounted:function(n){return(n=n._reactInternals)?Ga(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=ur(),s=po(n),i=gi(r,s);i.payload=e,t!=null&&(i.callback=t),e=fo(n,i,s),e!==null&&(_s(e,n,s,r),Lf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=ur(),s=po(n),i=gi(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=fo(n,i,s),e!==null&&(_s(e,n,s,r),Lf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=ur(),r=po(n),s=gi(t,r);s.tag=2,e!=null&&(s.callback=e),e=fo(n,s,r),e!==null&&(_s(e,n,r,t),Lf(e,n,r))}};function mE(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!pd(t,r)||!pd(s,i):!0}function yC(n,e,t){var r=!1,s=To,i=e.contextType;return typeof i=="object"&&i!==null?i=ts(i):(s=wr(e)?Ea:ar.current,r=e.contextTypes,i=(r=r!=null)?Zl(n,s):To),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ep,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function yE(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ep.enqueueReplaceState(e,e.state,null)}function b_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},g0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=ts(i):(i=wr(e)?Ea:ar.current,s.context=Zl(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(T_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Ep.enqueueReplaceState(s,s.state,null),wg(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function rc(n,e){try{var t="",r=e;do t+=M2(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function fy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function A_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var lM=typeof WeakMap=="function"?WeakMap:Map;function _C(n,e,t){t=gi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Tg||(Tg=!0,V_=r),A_(n,e)},t}function vC(n,e,t){t=gi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){A_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){A_(n,e),typeof r!="function"&&(go===null?go=new Set([this]):go.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function _E(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new lM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=xM.bind(null,n,e,t),e.then(n,n))}function vE(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function wE(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=gi(-1,1),e.tag=2,fo(t,e,1))),t.lanes|=1),n)}var cM=Ai.ReactCurrentOwner,pr=!1;function lr(n,e,t,r){e.child=n===null?QA(e,null,t,r):tc(e,n.child,t,r)}function IE(n,e,t,r,s){t=t.render;var i=e.ref;return $l(e,s),r=v0(n,e,t,r,i,s),t=w0(),n!==null&&!pr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,vi(n,e,s)):(Jt&&t&&a0(e),e.flags|=1,lr(n,e,r,s),e.child)}function xE(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!k0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,wC(n,e,i,r,s)):(n=Uf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:pd,t(o,r)&&n.ref===e.ref)return vi(n,e,s)}return e.flags|=1,n=mo(i,r),n.ref=e.ref,n.return=e,e.child=n}function wC(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(pd(i,r)&&n.ref===e.ref)if(pr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(pr=!0);else return e.lanes=n.lanes,vi(n,e,s)}return C_(n,e,t,r,s)}function IC(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ut(Ll,Ar),Ar|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ut(Ll,Ar),Ar|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Ut(Ll,Ar),Ar|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Ut(Ll,Ar),Ar|=r;return lr(n,e,s,t),e.child}function xC(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function C_(n,e,t,r,s){var i=wr(t)?Ea:ar.current;return i=Zl(e,i),$l(e,s),t=v0(n,e,t,r,i,s),r=w0(),n!==null&&!pr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,vi(n,e,s)):(Jt&&r&&a0(e),e.flags|=1,lr(n,e,t,s),e.child)}function EE(n,e,t,r,s){if(wr(t)){var i=!0;pg(e)}else i=!1;if($l(e,s),e.stateNode===null)Vf(n,e),yC(e,t,r),b_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=ts(u):(u=wr(t)?Ea:ar.current,u=Zl(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&yE(e,o,r,u),Gi=!1;var g=e.memoizedState;o.state=g,wg(e,r,o,s),l=e.memoizedState,a!==r||g!==l||vr.current||Gi?(typeof h=="function"&&(T_(e,t,h,r),l=e.memoizedState),(a=Gi||mE(e,t,a,r,g,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,YA(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:us(e.type,a),o.props=u,f=e.pendingProps,g=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=ts(l):(l=wr(t)?Ea:ar.current,l=Zl(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||g!==l)&&yE(e,o,r,l),Gi=!1,g=e.memoizedState,o.state=g,wg(e,r,o,s);var w=e.memoizedState;a!==f||g!==w||vr.current||Gi?(typeof y=="function"&&(T_(e,t,y,r),w=e.memoizedState),(u=Gi||mE(e,t,u,r,g,w,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,w,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,w,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),o.props=r,o.state=w,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=1024),r=!1)}return R_(n,e,t,r,i,s)}function R_(n,e,t,r,s,i){xC(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&lE(e,t,!1),vi(n,e,i);r=e.stateNode,cM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=tc(e,n.child,null,i),e.child=tc(e,null,a,i)):lr(n,e,a,i),e.memoizedState=r.state,s&&lE(e,t,!0),e.child}function EC(n){var e=n.stateNode;e.pendingContext?aE(n,e.pendingContext,e.pendingContext!==e.context):e.context&&aE(n,e.context,!1),p0(n,e.containerInfo)}function SE(n,e,t,r,s){return ec(),c0(s),e.flags|=256,lr(n,e,t,r),e.child}var k_={dehydrated:null,treeContext:null,retryLane:0};function N_(n){return{baseLanes:n,cachePool:null,transitions:null}}function SC(n,e,t){var r=e.pendingProps,s=nn.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Ut(nn,s&1),n===null)return E_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=bp(o,r,0,null),n=ya(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=N_(t),e.memoizedState=k_,n):E0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return uM(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=mo(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=mo(a,i):(i=ya(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?N_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=k_,r}return i=n.child,n=i.sibling,r=mo(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function E0(n,e){return e=bp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function cf(n,e,t,r){return r!==null&&c0(r),tc(e,n.child,null,t),n=E0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function uM(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=fy(Error(J(422))),cf(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=bp({mode:"visible",children:r.children},s,0,null),i=ya(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&tc(e,n.child,null,o),e.child.memoizedState=N_(o),e.memoizedState=k_,i);if(!(e.mode&1))return cf(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(J(419)),r=fy(i,r,void 0),cf(n,e,o,r)}if(a=(o&n.childLanes)!==0,pr||a){if(r=Ln,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,_i(n,s),_s(r,n,s,-1))}return R0(),r=fy(Error(J(421))),cf(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=EM.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Pr=ho(s.nextSibling),Dr=e,Jt=!0,gs=null,n!==null&&(Qr[Kr++]=li,Qr[Kr++]=ci,Qr[Kr++]=Sa,li=n.id,ci=n.overflow,Sa=e),e=E0(e,r.children),e.flags|=4096,e)}function TE(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),S_(n.return,e,t)}function gy(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function TC(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(lr(n,e,r.children,t),r=nn.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&TE(n,t,e);else if(n.tag===19)TE(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Ut(nn,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Ig(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),gy(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Ig(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}gy(e,!0,t,null,i);break;case"together":gy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Vf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function vi(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ba|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(J(153));if(e.child!==null){for(n=e.child,t=mo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=mo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function dM(n,e,t){switch(e.tag){case 3:EC(e),ec();break;case 5:JA(e);break;case 1:wr(e.type)&&pg(e);break;case 4:p0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ut(_g,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ut(nn,nn.current&1),e.flags|=128,null):t&e.child.childLanes?SC(n,e,t):(Ut(nn,nn.current&1),n=vi(n,e,t),n!==null?n.sibling:null);Ut(nn,nn.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return TC(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ut(nn,nn.current),r)break;return null;case 22:case 23:return e.lanes=0,IC(n,e,t)}return vi(n,e,t)}var bC,P_,AC,CC;bC=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};P_=function(){};AC=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,da(Bs.current);var i=null;switch(t){case"input":s=e_(n,s),r=e_(n,r),i=[];break;case"select":s=on({},s,{value:void 0}),r=on({},r,{value:void 0}),i=[];break;case"textarea":s=r_(n,s),r=r_(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=fg)}i_(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ld.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ld.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Wt("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};CC=function(n,e,t,r){t!==r&&(e.flags|=4)};function uu(n,e){if(!Jt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function er(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function hM(n,e,t){var r=e.pendingProps;switch(l0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return er(e),null;case 1:return wr(e.type)&&gg(),er(e),null;case 3:return r=e.stateNode,nc(),Ht(vr),Ht(ar),y0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(af(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,gs!==null&&(U_(gs),gs=null))),P_(n,e),er(e),null;case 5:m0(e);var s=da(wd.current);if(t=e.type,n!==null&&e.stateNode!=null)AC(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(J(166));return er(e),null}if(n=da(Bs.current),af(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Ms]=e,r[_d]=i,n=(e.mode&1)!==0,t){case"dialog":Wt("cancel",r),Wt("close",r);break;case"iframe":case"object":case"embed":Wt("load",r);break;case"video":case"audio":for(s=0;s<Tu.length;s++)Wt(Tu[s],r);break;case"source":Wt("error",r);break;case"img":case"image":case"link":Wt("error",r),Wt("load",r);break;case"details":Wt("toggle",r);break;case"input":Lx(r,i),Wt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Wt("invalid",r);break;case"textarea":Ox(r,i),Wt("invalid",r)}i_(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&of(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&of(r.textContent,a,n),s=["children",""+a]):ld.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Wt("scroll",r)}switch(t){case"input":Jh(r),Mx(r,i,!0);break;case"textarea":Jh(r),Vx(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=fg)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=nA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Ms]=e,n[_d]=r,bC(n,e,!1,!1),e.stateNode=n;e:{switch(o=o_(t,r),t){case"dialog":Wt("cancel",n),Wt("close",n),s=r;break;case"iframe":case"object":case"embed":Wt("load",n),s=r;break;case"video":case"audio":for(s=0;s<Tu.length;s++)Wt(Tu[s],n);s=r;break;case"source":Wt("error",n),s=r;break;case"img":case"image":case"link":Wt("error",n),Wt("load",n),s=r;break;case"details":Wt("toggle",n),s=r;break;case"input":Lx(n,r),s=e_(n,r),Wt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=on({},r,{value:void 0}),Wt("invalid",n);break;case"textarea":Ox(n,r),s=r_(n,r),Wt("invalid",n);break;default:s=r}i_(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?iA(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&rA(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&cd(n,l):typeof l=="number"&&cd(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ld.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Wt("scroll",n):l!=null&&Hv(n,i,l,o))}switch(t){case"input":Jh(n),Mx(n,r,!1);break;case"textarea":Jh(n),Vx(n);break;case"option":r.value!=null&&n.setAttribute("value",""+So(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Vl(n,!!r.multiple,i,!1):r.defaultValue!=null&&Vl(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=fg)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return er(e),null;case 6:if(n&&e.stateNode!=null)CC(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(J(166));if(t=da(wd.current),da(Bs.current),af(e)){if(r=e.stateNode,t=e.memoizedProps,r[Ms]=e,(i=r.nodeValue!==t)&&(n=Dr,n!==null))switch(n.tag){case 3:of(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&of(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Ms]=e,e.stateNode=r}return er(e),null;case 13:if(Ht(nn),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Jt&&Pr!==null&&e.mode&1&&!(e.flags&128))GA(),ec(),e.flags|=98560,i=!1;else if(i=af(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(J(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));i[Ms]=e}else ec(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;er(e),i=!1}else gs!==null&&(U_(gs),gs=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||nn.current&1?xn===0&&(xn=3):R0())),e.updateQueue!==null&&(e.flags|=4),er(e),null);case 4:return nc(),P_(n,e),n===null&&md(e.stateNode.containerInfo),er(e),null;case 10:return h0(e.type._context),er(e),null;case 17:return wr(e.type)&&gg(),er(e),null;case 19:if(Ht(nn),i=e.memoizedState,i===null)return er(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)uu(i,!1);else{if(xn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Ig(n),o!==null){for(e.flags|=128,uu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ut(nn,nn.current&1|2),e.child}n=n.sibling}i.tail!==null&&fn()>sc&&(e.flags|=128,r=!0,uu(i,!1),e.lanes=4194304)}else{if(!r)if(n=Ig(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),uu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Jt)return er(e),null}else 2*fn()-i.renderingStartTime>sc&&t!==1073741824&&(e.flags|=128,r=!0,uu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=fn(),e.sibling=null,t=nn.current,Ut(nn,r?t&1|2:t&1),e):(er(e),null);case 22:case 23:return C0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ar&1073741824&&(er(e),e.subtreeFlags&6&&(e.flags|=8192)):er(e),null;case 24:return null;case 25:return null}throw Error(J(156,e.tag))}function fM(n,e){switch(l0(e),e.tag){case 1:return wr(e.type)&&gg(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return nc(),Ht(vr),Ht(ar),y0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return m0(e),null;case 13:if(Ht(nn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(J(340));ec()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ht(nn),null;case 4:return nc(),null;case 10:return h0(e.type._context),null;case 22:case 23:return C0(),null;case 24:return null;default:return null}}var uf=!1,rr=!1,gM=typeof WeakSet=="function"?WeakSet:Set,fe=null;function Dl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){un(n,e,r)}else t.current=null}function D_(n,e,t){try{t()}catch(r){un(n,e,r)}}var bE=!1;function pM(n,e){if(m_=ug,n=DA(),o0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,g=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)g=f,f=y;for(;;){if(f===n)break t;if(g===t&&++u===s&&(a=o),g===i&&++h===r&&(l=o),(y=f.nextSibling)!==null)break;f=g,g=f.parentNode}f=y}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(y_={focusedElem:n,selectionRange:t},ug=!1,fe=e;fe!==null;)if(e=fe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,fe=n;else for(;fe!==null;){e=fe;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var C=w.memoizedProps,N=w.memoizedState,A=e.stateNode,x=A.getSnapshotBeforeUpdate(e.elementType===e.type?C:us(e.type,C),N);A.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(D){un(e,e.return,D)}if(n=e.sibling,n!==null){n.return=e.return,fe=n;break}fe=e.return}return w=bE,bE=!1,w}function Uu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&D_(e,t,i)}s=s.next}while(s!==r)}}function Sp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function L_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function RC(n){var e=n.alternate;e!==null&&(n.alternate=null,RC(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ms],delete e[_d],delete e[w_],delete e[JL],delete e[XL])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function kC(n){return n.tag===5||n.tag===3||n.tag===4}function AE(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||kC(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function M_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=fg));else if(r!==4&&(n=n.child,n!==null))for(M_(n,e,t),n=n.sibling;n!==null;)M_(n,e,t),n=n.sibling}function O_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(O_(n,e,t),n=n.sibling;n!==null;)O_(n,e,t),n=n.sibling}var zn=null,hs=!1;function Ui(n,e,t){for(t=t.child;t!==null;)NC(n,e,t),t=t.sibling}function NC(n,e,t){if($s&&typeof $s.onCommitFiberUnmount=="function")try{$s.onCommitFiberUnmount(mp,t)}catch{}switch(t.tag){case 5:rr||Dl(t,e);case 6:var r=zn,s=hs;zn=null,Ui(n,e,t),zn=r,hs=s,zn!==null&&(hs?(n=zn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):zn.removeChild(t.stateNode));break;case 18:zn!==null&&(hs?(n=zn,t=t.stateNode,n.nodeType===8?ay(n.parentNode,t):n.nodeType===1&&ay(n,t),fd(n)):ay(zn,t.stateNode));break;case 4:r=zn,s=hs,zn=t.stateNode.containerInfo,hs=!0,Ui(n,e,t),zn=r,hs=s;break;case 0:case 11:case 14:case 15:if(!rr&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&D_(t,e,o),s=s.next}while(s!==r)}Ui(n,e,t);break;case 1:if(!rr&&(Dl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){un(t,e,a)}Ui(n,e,t);break;case 21:Ui(n,e,t);break;case 22:t.mode&1?(rr=(r=rr)||t.memoizedState!==null,Ui(n,e,t),rr=r):Ui(n,e,t);break;default:Ui(n,e,t)}}function CE(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new gM),e.forEach(function(r){var s=SM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function cs(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:zn=a.stateNode,hs=!1;break e;case 3:zn=a.stateNode.containerInfo,hs=!0;break e;case 4:zn=a.stateNode.containerInfo,hs=!0;break e}a=a.return}if(zn===null)throw Error(J(160));NC(i,o,s),zn=null,hs=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){un(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)PC(e,n),e=e.sibling}function PC(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(cs(e,n),Rs(n),r&4){try{Uu(3,n,n.return),Sp(3,n)}catch(C){un(n,n.return,C)}try{Uu(5,n,n.return)}catch(C){un(n,n.return,C)}}break;case 1:cs(e,n),Rs(n),r&512&&t!==null&&Dl(t,t.return);break;case 5:if(cs(e,n),Rs(n),r&512&&t!==null&&Dl(t,t.return),n.flags&32){var s=n.stateNode;try{cd(s,"")}catch(C){un(n,n.return,C)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&eA(s,i),o_(a,o);var u=o_(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?iA(s,f):h==="dangerouslySetInnerHTML"?rA(s,f):h==="children"?cd(s,f):Hv(s,h,f,u)}switch(a){case"input":t_(s,i);break;case"textarea":tA(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Vl(s,!!i.multiple,y,!1):g!==!!i.multiple&&(i.defaultValue!=null?Vl(s,!!i.multiple,i.defaultValue,!0):Vl(s,!!i.multiple,i.multiple?[]:"",!1))}s[_d]=i}catch(C){un(n,n.return,C)}}break;case 6:if(cs(e,n),Rs(n),r&4){if(n.stateNode===null)throw Error(J(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(C){un(n,n.return,C)}}break;case 3:if(cs(e,n),Rs(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{fd(e.containerInfo)}catch(C){un(n,n.return,C)}break;case 4:cs(e,n),Rs(n);break;case 13:cs(e,n),Rs(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(b0=fn())),r&4&&CE(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(rr=(u=rr)||h,cs(e,n),rr=u):cs(e,n),Rs(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(fe=n,h=n.child;h!==null;){for(f=fe=h;fe!==null;){switch(g=fe,y=g.child,g.tag){case 0:case 11:case 14:case 15:Uu(4,g,g.return);break;case 1:Dl(g,g.return);var w=g.stateNode;if(typeof w.componentWillUnmount=="function"){r=g,t=g.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(C){un(r,t,C)}}break;case 5:Dl(g,g.return);break;case 22:if(g.memoizedState!==null){kE(f);continue}}y!==null?(y.return=g,fe=y):kE(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=sA("display",o))}catch(C){un(n,n.return,C)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(C){un(n,n.return,C)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:cs(e,n),Rs(n),r&4&&CE(n);break;case 21:break;default:cs(e,n),Rs(n)}}function Rs(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(kC(t)){var r=t;break e}t=t.return}throw Error(J(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(cd(s,""),r.flags&=-33);var i=AE(n);O_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=AE(n);M_(n,a,o);break;default:throw Error(J(161))}}catch(l){un(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function mM(n,e,t){fe=n,DC(n)}function DC(n,e,t){for(var r=(n.mode&1)!==0;fe!==null;){var s=fe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||uf;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||rr;a=uf;var u=rr;if(uf=o,(rr=l)&&!u)for(fe=s;fe!==null;)o=fe,l=o.child,o.tag===22&&o.memoizedState!==null?NE(s):l!==null?(l.return=o,fe=l):NE(s);for(;i!==null;)fe=i,DC(i),i=i.sibling;fe=s,uf=a,rr=u}RE(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,fe=i):RE(n)}}function RE(n){for(;fe!==null;){var e=fe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:rr||Sp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!rr)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:us(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&fE(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}fE(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&fd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}rr||e.flags&512&&L_(e)}catch(g){un(e,e.return,g)}}if(e===n){fe=null;break}if(t=e.sibling,t!==null){t.return=e.return,fe=t;break}fe=e.return}}function kE(n){for(;fe!==null;){var e=fe;if(e===n){fe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,fe=t;break}fe=e.return}}function NE(n){for(;fe!==null;){var e=fe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Sp(4,e)}catch(l){un(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){un(e,s,l)}}var i=e.return;try{L_(e)}catch(l){un(e,i,l)}break;case 5:var o=e.return;try{L_(e)}catch(l){un(e,o,l)}}}catch(l){un(e,e.return,l)}if(e===n){fe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,fe=a;break}fe=e.return}}var yM=Math.ceil,Sg=Ai.ReactCurrentDispatcher,S0=Ai.ReactCurrentOwner,Zr=Ai.ReactCurrentBatchConfig,ft=0,Ln=null,_n=null,Gn=0,Ar=0,Ll=jo(0),xn=0,Sd=null,ba=0,Tp=0,T0=0,$u=null,gr=null,b0=0,sc=1/0,si=null,Tg=!1,V_=null,go=null,df=!1,to=null,bg=0,Bu=0,F_=null,Ff=-1,jf=0;function ur(){return ft&6?fn():Ff!==-1?Ff:Ff=fn()}function po(n){return n.mode&1?ft&2&&Gn!==0?Gn&-Gn:eM.transition!==null?(jf===0&&(jf=yA()),jf):(n=bt,n!==0||(n=window.event,n=n===void 0?16:SA(n.type)),n):1}function _s(n,e,t,r){if(50<Bu)throw Bu=0,F_=null,Error(J(185));nh(n,t,r),(!(ft&2)||n!==Ln)&&(n===Ln&&(!(ft&2)&&(Tp|=t),xn===4&&Qi(n,Gn)),Ir(n,r),t===1&&ft===0&&!(e.mode&1)&&(sc=fn()+500,Ip&&Uo()))}function Ir(n,e){var t=n.callbackNode;eL(n,e);var r=cg(n,n===Ln?Gn:0);if(r===0)t!==null&&Ux(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Ux(t),e===1)n.tag===0?ZL(PE.bind(null,n)):zA(PE.bind(null,n)),KL(function(){!(ft&6)&&Uo()}),t=null;else{switch(_A(r)){case 1:t=Xv;break;case 4:t=pA;break;case 16:t=lg;break;case 536870912:t=mA;break;default:t=lg}t=$C(t,LC.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function LC(n,e){if(Ff=-1,jf=0,ft&6)throw Error(J(327));var t=n.callbackNode;if(Bl()&&n.callbackNode!==t)return null;var r=cg(n,n===Ln?Gn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Ag(n,r);else{e=r;var s=ft;ft|=2;var i=OC();(Ln!==n||Gn!==e)&&(si=null,sc=fn()+500,ma(n,e));do try{wM();break}catch(a){MC(n,a)}while(1);d0(),Sg.current=i,ft=s,_n!==null?e=0:(Ln=null,Gn=0,e=xn)}if(e!==0){if(e===2&&(s=d_(n),s!==0&&(r=s,e=j_(n,s))),e===1)throw t=Sd,ma(n,0),Qi(n,r),Ir(n,fn()),t;if(e===6)Qi(n,r);else{if(s=n.current.alternate,!(r&30)&&!_M(s)&&(e=Ag(n,r),e===2&&(i=d_(n),i!==0&&(r=i,e=j_(n,i))),e===1))throw t=Sd,ma(n,0),Qi(n,r),Ir(n,fn()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(J(345));case 2:ea(n,gr,si);break;case 3:if(Qi(n,r),(r&130023424)===r&&(e=b0+500-fn(),10<e)){if(cg(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){ur(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=v_(ea.bind(null,n,gr,si),e);break}ea(n,gr,si);break;case 4:if(Qi(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-ys(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=fn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*yM(r/1960))-r,10<r){n.timeoutHandle=v_(ea.bind(null,n,gr,si),r);break}ea(n,gr,si);break;case 5:ea(n,gr,si);break;default:throw Error(J(329))}}}return Ir(n,fn()),n.callbackNode===t?LC.bind(null,n):null}function j_(n,e){var t=$u;return n.current.memoizedState.isDehydrated&&(ma(n,e).flags|=256),n=Ag(n,e),n!==2&&(e=gr,gr=t,e!==null&&U_(e)),n}function U_(n){gr===null?gr=n:gr.push.apply(gr,n)}function _M(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Is(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Qi(n,e){for(e&=~T0,e&=~Tp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ys(e),r=1<<t;n[t]=-1,e&=~r}}function PE(n){if(ft&6)throw Error(J(327));Bl();var e=cg(n,0);if(!(e&1))return Ir(n,fn()),null;var t=Ag(n,e);if(n.tag!==0&&t===2){var r=d_(n);r!==0&&(e=r,t=j_(n,r))}if(t===1)throw t=Sd,ma(n,0),Qi(n,e),Ir(n,fn()),t;if(t===6)throw Error(J(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ea(n,gr,si),Ir(n,fn()),null}function A0(n,e){var t=ft;ft|=1;try{return n(e)}finally{ft=t,ft===0&&(sc=fn()+500,Ip&&Uo())}}function Aa(n){to!==null&&to.tag===0&&!(ft&6)&&Bl();var e=ft;ft|=1;var t=Zr.transition,r=bt;try{if(Zr.transition=null,bt=1,n)return n()}finally{bt=r,Zr.transition=t,ft=e,!(ft&6)&&Uo()}}function C0(){Ar=Ll.current,Ht(Ll)}function ma(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,QL(t)),_n!==null)for(t=_n.return;t!==null;){var r=t;switch(l0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&gg();break;case 3:nc(),Ht(vr),Ht(ar),y0();break;case 5:m0(r);break;case 4:nc();break;case 13:Ht(nn);break;case 19:Ht(nn);break;case 10:h0(r.type._context);break;case 22:case 23:C0()}t=t.return}if(Ln=n,_n=n=mo(n.current,null),Gn=Ar=e,xn=0,Sd=null,T0=Tp=ba=0,gr=$u=null,ua!==null){for(e=0;e<ua.length;e++)if(t=ua[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}ua=null}return n}function MC(n,e){do{var t=_n;try{if(d0(),Mf.current=Eg,xg){for(var r=sn.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}xg=!1}if(Ta=0,Nn=wn=sn=null,ju=!1,Id=0,S0.current=null,t===null||t.return===null){xn=1,Sd=e,_n=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Gn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var g=h.alternate;g?(h.updateQueue=g.updateQueue,h.memoizedState=g.memoizedState,h.lanes=g.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=vE(o);if(y!==null){y.flags&=-257,wE(y,o,a,i,e),y.mode&1&&_E(i,u,e),e=y,l=u;var w=e.updateQueue;if(w===null){var C=new Set;C.add(l),e.updateQueue=C}else w.add(l);break e}else{if(!(e&1)){_E(i,u,e),R0();break e}l=Error(J(426))}}else if(Jt&&a.mode&1){var N=vE(o);if(N!==null){!(N.flags&65536)&&(N.flags|=256),wE(N,o,a,i,e),c0(rc(l,a));break e}}i=l=rc(l,a),xn!==4&&(xn=2),$u===null?$u=[i]:$u.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var A=_C(i,l,e);hE(i,A);break e;case 1:a=l;var x=i.type,R=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(go===null||!go.has(R)))){i.flags|=65536,e&=-e,i.lanes|=e;var D=vC(i,a,e);hE(i,D);break e}}i=i.return}while(i!==null)}FC(t)}catch(U){e=U,_n===t&&t!==null&&(_n=t=t.return);continue}break}while(1)}function OC(){var n=Sg.current;return Sg.current=Eg,n===null?Eg:n}function R0(){(xn===0||xn===3||xn===2)&&(xn=4),Ln===null||!(ba&268435455)&&!(Tp&268435455)||Qi(Ln,Gn)}function Ag(n,e){var t=ft;ft|=2;var r=OC();(Ln!==n||Gn!==e)&&(si=null,ma(n,e));do try{vM();break}catch(s){MC(n,s)}while(1);if(d0(),ft=t,Sg.current=r,_n!==null)throw Error(J(261));return Ln=null,Gn=0,xn}function vM(){for(;_n!==null;)VC(_n)}function wM(){for(;_n!==null&&!W2();)VC(_n)}function VC(n){var e=UC(n.alternate,n,Ar);n.memoizedProps=n.pendingProps,e===null?FC(n):_n=e,S0.current=null}function FC(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=fM(t,e),t!==null){t.flags&=32767,_n=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{xn=6,_n=null;return}}else if(t=hM(t,e,Ar),t!==null){_n=t;return}if(e=e.sibling,e!==null){_n=e;return}_n=e=n}while(e!==null);xn===0&&(xn=5)}function ea(n,e,t){var r=bt,s=Zr.transition;try{Zr.transition=null,bt=1,IM(n,e,t,r)}finally{Zr.transition=s,bt=r}return null}function IM(n,e,t,r){do Bl();while(to!==null);if(ft&6)throw Error(J(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(J(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(tL(n,i),n===Ln&&(_n=Ln=null,Gn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||df||(df=!0,$C(lg,function(){return Bl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Zr.transition,Zr.transition=null;var o=bt;bt=1;var a=ft;ft|=4,S0.current=null,pM(n,t),PC(t,n),$L(y_),ug=!!m_,y_=m_=null,n.current=t,mM(t),G2(),ft=a,bt=o,Zr.transition=i}else n.current=t;if(df&&(df=!1,to=n,bg=s),i=n.pendingLanes,i===0&&(go=null),K2(t.stateNode),Ir(n,fn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Tg)throw Tg=!1,n=V_,V_=null,n;return bg&1&&n.tag!==0&&Bl(),i=n.pendingLanes,i&1?n===F_?Bu++:(Bu=0,F_=n):Bu=0,Uo(),null}function Bl(){if(to!==null){var n=_A(bg),e=Zr.transition,t=bt;try{if(Zr.transition=null,bt=16>n?16:n,to===null)var r=!1;else{if(n=to,to=null,bg=0,ft&6)throw Error(J(331));var s=ft;for(ft|=4,fe=n.current;fe!==null;){var i=fe,o=i.child;if(fe.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(fe=u;fe!==null;){var h=fe;switch(h.tag){case 0:case 11:case 15:Uu(8,h,i)}var f=h.child;if(f!==null)f.return=h,fe=f;else for(;fe!==null;){h=fe;var g=h.sibling,y=h.return;if(RC(h),h===u){fe=null;break}if(g!==null){g.return=y,fe=g;break}fe=y}}}var w=i.alternate;if(w!==null){var C=w.child;if(C!==null){w.child=null;do{var N=C.sibling;C.sibling=null,C=N}while(C!==null)}}fe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,fe=o;else e:for(;fe!==null;){if(i=fe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Uu(9,i,i.return)}var A=i.sibling;if(A!==null){A.return=i.return,fe=A;break e}fe=i.return}}var x=n.current;for(fe=x;fe!==null;){o=fe;var R=o.child;if(o.subtreeFlags&2064&&R!==null)R.return=o,fe=R;else e:for(o=x;fe!==null;){if(a=fe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Sp(9,a)}}catch(U){un(a,a.return,U)}if(a===o){fe=null;break e}var D=a.sibling;if(D!==null){D.return=a.return,fe=D;break e}fe=a.return}}if(ft=s,Uo(),$s&&typeof $s.onPostCommitFiberRoot=="function")try{$s.onPostCommitFiberRoot(mp,n)}catch{}r=!0}return r}finally{bt=t,Zr.transition=e}}return!1}function DE(n,e,t){e=rc(t,e),e=_C(n,e,1),n=fo(n,e,1),e=ur(),n!==null&&(nh(n,1,e),Ir(n,e))}function un(n,e,t){if(n.tag===3)DE(n,n,t);else for(;e!==null;){if(e.tag===3){DE(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(go===null||!go.has(r))){n=rc(t,n),n=vC(e,n,1),e=fo(e,n,1),n=ur(),e!==null&&(nh(e,1,n),Ir(e,n));break}}e=e.return}}function xM(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=ur(),n.pingedLanes|=n.suspendedLanes&t,Ln===n&&(Gn&t)===t&&(xn===4||xn===3&&(Gn&130023424)===Gn&&500>fn()-b0?ma(n,0):T0|=t),Ir(n,e)}function jC(n,e){e===0&&(n.mode&1?(e=ef,ef<<=1,!(ef&130023424)&&(ef=4194304)):e=1);var t=ur();n=_i(n,e),n!==null&&(nh(n,e,t),Ir(n,t))}function EM(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),jC(n,t)}function SM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(e),jC(n,t)}var UC;UC=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||vr.current)pr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return pr=!1,dM(n,e,t);pr=!!(n.flags&131072)}else pr=!1,Jt&&e.flags&1048576&&qA(e,yg,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Vf(n,e),n=e.pendingProps;var s=Zl(e,ar.current);$l(e,t),s=v0(null,e,r,n,s,t);var i=w0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,wr(r)?(i=!0,pg(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,g0(e),s.updater=Ep,e.stateNode=s,s._reactInternals=e,b_(e,r,n,t),e=R_(null,e,r,!0,i,t)):(e.tag=0,Jt&&i&&a0(e),lr(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Vf(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=bM(r),n=us(r,n),s){case 0:e=C_(null,e,r,n,t);break e;case 1:e=EE(null,e,r,n,t);break e;case 11:e=IE(null,e,r,n,t);break e;case 14:e=xE(null,e,r,us(r.type,n),t);break e}throw Error(J(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:us(r,s),C_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:us(r,s),EE(n,e,r,s,t);case 3:e:{if(EC(e),n===null)throw Error(J(387));r=e.pendingProps,i=e.memoizedState,s=i.element,YA(n,e),wg(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=rc(Error(J(423)),e),e=SE(n,e,r,t,s);break e}else if(r!==s){s=rc(Error(J(424)),e),e=SE(n,e,r,t,s);break e}else for(Pr=ho(e.stateNode.containerInfo.firstChild),Dr=e,Jt=!0,gs=null,t=QA(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ec(),r===s){e=vi(n,e,t);break e}lr(n,e,r,t)}e=e.child}return e;case 5:return JA(e),n===null&&E_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,__(r,s)?o=null:i!==null&&__(r,i)&&(e.flags|=32),xC(n,e),lr(n,e,o,t),e.child;case 6:return n===null&&E_(e),null;case 13:return SC(n,e,t);case 4:return p0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=tc(e,null,r,t):lr(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:us(r,s),IE(n,e,r,s,t);case 7:return lr(n,e,e.pendingProps,t),e.child;case 8:return lr(n,e,e.pendingProps.children,t),e.child;case 12:return lr(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ut(_g,r._currentValue),r._currentValue=o,i!==null)if(Is(i.value,o)){if(i.children===s.children&&!vr.current){e=vi(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=gi(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),S_(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(J(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),S_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}lr(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,$l(e,t),s=ts(s),r=r(s),e.flags|=1,lr(n,e,r,t),e.child;case 14:return r=e.type,s=us(r,e.pendingProps),s=us(r.type,s),xE(n,e,r,s,t);case 15:return wC(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:us(r,s),Vf(n,e),e.tag=1,wr(r)?(n=!0,pg(e)):n=!1,$l(e,t),yC(e,r,s),b_(e,r,s,t),R_(null,e,r,!0,n,t);case 19:return TC(n,e,t);case 22:return IC(n,e,t)}throw Error(J(156,e.tag))};function $C(n,e){return gA(n,e)}function TM(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jr(n,e,t,r){return new TM(n,e,t,r)}function k0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function bM(n){if(typeof n=="function")return k0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Kv)return 11;if(n===Yv)return 14}return 2}function mo(n,e){var t=n.alternate;return t===null?(t=Jr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Uf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")k0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Sl:return ya(t.children,s,i,e);case Qv:o=8,s|=8;break;case Yy:return n=Jr(12,t,e,s|2),n.elementType=Yy,n.lanes=i,n;case Jy:return n=Jr(13,t,e,s),n.elementType=Jy,n.lanes=i,n;case Xy:return n=Jr(19,t,e,s),n.elementType=Xy,n.lanes=i,n;case Jb:return bp(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Kb:o=10;break e;case Yb:o=9;break e;case Kv:o=11;break e;case Yv:o=14;break e;case Wi:o=16,r=null;break e}throw Error(J(130,n==null?n:typeof n,""))}return e=Jr(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function ya(n,e,t,r){return n=Jr(7,n,r,e),n.lanes=t,n}function bp(n,e,t,r){return n=Jr(22,n,r,e),n.elementType=Jb,n.lanes=t,n.stateNode={isHidden:!1},n}function py(n,e,t){return n=Jr(6,n,null,e),n.lanes=t,n}function my(n,e,t){return e=Jr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function AM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ym(0),this.expirationTimes=Ym(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ym(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function N0(n,e,t,r,s,i,o,a,l){return n=new AM(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Jr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},g0(i),n}function CM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:El,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function BC(n){if(!n)return To;n=n._reactInternals;e:{if(Ga(n)!==n||n.tag!==1)throw Error(J(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(wr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(J(171))}if(n.tag===1){var t=n.type;if(wr(t))return BA(n,t,e)}return e}function zC(n,e,t,r,s,i,o,a,l){return n=N0(t,r,!0,n,s,i,o,a,l),n.context=BC(null),t=n.current,r=ur(),s=po(t),i=gi(r,s),i.callback=e??null,fo(t,i,s),n.current.lanes=s,nh(n,s,r),Ir(n,r),n}function Ap(n,e,t,r){var s=e.current,i=ur(),o=po(s);return t=BC(t),e.context===null?e.context=t:e.pendingContext=t,e=gi(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=fo(s,e,o),n!==null&&(_s(n,s,o,i),Lf(n,s,o)),o}function Cg(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function LE(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function P0(n,e){LE(n,e),(n=n.alternate)&&LE(n,e)}function RM(){return null}var qC=typeof reportError=="function"?reportError:function(n){console.error(n)};function D0(n){this._internalRoot=n}Cp.prototype.render=D0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(J(409));Ap(n,e,null,null)};Cp.prototype.unmount=D0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Aa(function(){Ap(null,n,null,null)}),e[yi]=null}};function Cp(n){this._internalRoot=n}Cp.prototype.unstable_scheduleHydration=function(n){if(n){var e=IA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Hi.length&&e!==0&&e<Hi[t].priority;t++);Hi.splice(t,0,n),t===0&&EA(n)}};function L0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Rp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function ME(){}function kM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Cg(o);i.call(u)}}var o=zC(e,r,n,0,null,!1,!1,"",ME);return n._reactRootContainer=o,n[yi]=o.current,md(n.nodeType===8?n.parentNode:n),Aa(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Cg(l);a.call(u)}}var l=N0(n,0,!1,null,null,!1,!1,"",ME);return n._reactRootContainer=l,n[yi]=l.current,md(n.nodeType===8?n.parentNode:n),Aa(function(){Ap(e,l,t,r)}),l}function kp(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Cg(o);a.call(l)}}Ap(e,o,n,s)}else o=kM(t,e,n,s,r);return Cg(o)}vA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Su(e.pendingLanes);t!==0&&(Zv(e,t|1),Ir(e,fn()),!(ft&6)&&(sc=fn()+500,Uo()))}break;case 13:Aa(function(){var r=_i(n,1);if(r!==null){var s=ur();_s(r,n,1,s)}}),P0(n,1)}};e0=function(n){if(n.tag===13){var e=_i(n,134217728);if(e!==null){var t=ur();_s(e,n,134217728,t)}P0(n,134217728)}};wA=function(n){if(n.tag===13){var e=po(n),t=_i(n,e);if(t!==null){var r=ur();_s(t,n,e,r)}P0(n,e)}};IA=function(){return bt};xA=function(n,e){var t=bt;try{return bt=n,e()}finally{bt=t}};l_=function(n,e,t){switch(e){case"input":if(t_(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=wp(r);if(!s)throw Error(J(90));Zb(r),t_(r,s)}}}break;case"textarea":tA(n,t);break;case"select":e=t.value,e!=null&&Vl(n,!!t.multiple,e,!1)}};lA=A0;cA=Aa;var NM={usingClientEntryPoint:!1,Events:[sh,Cl,wp,oA,aA,A0]},du={findFiberByHostInstance:ca,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PM={bundleType:du.bundleType,version:du.version,rendererPackageName:du.rendererPackageName,rendererConfig:du.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ai.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=hA(n),n===null?null:n.stateNode},findFiberByHostInstance:du.findFiberByHostInstance||RM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hf.isDisabled&&hf.supportsFiber)try{mp=hf.inject(PM),$s=hf}catch{}}$r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NM;$r.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!L0(e))throw Error(J(200));return CM(n,e,null,t)};$r.createRoot=function(n,e){if(!L0(n))throw Error(J(299));var t=!1,r="",s=qC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=N0(n,1,!1,null,null,t,!1,r,s),n[yi]=e.current,md(n.nodeType===8?n.parentNode:n),new D0(e)};$r.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(J(188)):(n=Object.keys(n).join(","),Error(J(268,n)));return n=hA(e),n=n===null?null:n.stateNode,n};$r.flushSync=function(n){return Aa(n)};$r.hydrate=function(n,e,t){if(!Rp(e))throw Error(J(200));return kp(null,n,e,!0,t)};$r.hydrateRoot=function(n,e,t){if(!L0(n))throw Error(J(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=qC;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=zC(e,null,n,1,t??null,s,!1,i,o),n[yi]=e.current,md(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Cp(e)};$r.render=function(n,e,t){if(!Rp(e))throw Error(J(200));return kp(null,n,e,!1,t)};$r.unmountComponentAtNode=function(n){if(!Rp(n))throw Error(J(40));return n._reactRootContainer?(Aa(function(){kp(null,null,n,!1,function(){n._reactRootContainer=null,n[yi]=null})}),!0):!1};$r.unstable_batchedUpdates=A0;$r.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Rp(t))throw Error(J(200));if(n==null||n._reactInternals===void 0)throw Error(J(38));return kp(n,e,t,!1,r)};$r.version="18.3.1-next-f1338f8080-20240426";function WC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(WC)}catch(n){console.error(n)}}WC(),Wb.exports=$r;var DM=Wb.exports,OE=DM;Qy.createRoot=OE.createRoot,Qy.hydrateRoot=OE.hydrateRoot;const LM="modulepreload",MM=function(n){return"/"+n},VE={},Ce=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=MM(i),i in VE)return;VE[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":LM,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},OM=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GC={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee=function(n,e){if(!n)throw Lc(e)},Lc=function(n){return new Error("Firebase Database ("+GC.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},VM=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},M0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(g=64)),r.push(t[h],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(HC(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):VM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new FM;const g=i<<2|a>>4;if(r.push(g),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const w=u<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class FM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const QC=function(n){const e=HC(n);return M0.encodeByteArray(e,!0)},Rg=function(n){return QC(n).replace(/\./g,"")},kg=function(n){try{return M0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jM(n){return KC(void 0,n)}function KC(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!UM(t)||(n[t]=KC(n[t],e[t]));return n}function UM(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $M=()=>YC().__FIREBASE_DEFAULTS__,BM=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},zM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&kg(n[1]);return e&&JSON.parse(e)},Np=()=>{try{return OM()||$M()||BM()||zM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},JC=n=>{var e,t;return(t=(e=Np())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},XC=n=>{const e=JC(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},ZC=()=>{var n;return(n=Np())==null?void 0:n.config},e1=n=>{var e;return(e=Np())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ci(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Pp(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t1(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Rg(JSON.stringify(t)),Rg(JSON.stringify(o)),a].join(".")}const zu={};function qM(){const n={prod:[],emulator:[]};for(const e of Object.keys(zu))zu[e]?n.emulator.push(e):n.prod.push(e);return n}function WM(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let FE=!1;function O0(n,e){if(typeof window>"u"||typeof document>"u"||!Ci(window.location.host)||zu[n]===e||zu[n]||FE)return;zu[n]=e;function t(g){return`__firebase__banner__${g}`}const r="__firebase__banner",i=qM().prod.length>0;function o(){const g=document.getElementById(r);g&&g.remove()}function a(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function l(g,y){g.setAttribute("width","24"),g.setAttribute("id",y),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function u(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{FE=!0,o()},g}function h(g,y){g.setAttribute("id",y),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function f(){const g=WM(r),y=t("text"),w=document.getElementById(y)||document.createElement("span"),C=t("learnmore"),N=document.getElementById(C)||document.createElement("a"),A=t("preprendIcon"),x=document.getElementById(A)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const R=g.element;a(R),h(N,C);const D=u();l(x,A),R.append(x,w,N,D),document.body.appendChild(R)}i?(w.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function V0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(En())}function n1(){var e;const n=(e=Np())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function GM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function F0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function r1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function HM(){const n=En();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function s1(){return GC.NODE_ADMIN===!0}function i1(){return!n1()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function o1(){return!n1()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Dp(){try{return typeof indexedDB=="object"}catch{return!1}}function j0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function a1(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QM="FirebaseError";class Es extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=QM,Object.setPrototypeOf(this,Es.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ha.prototype.create)}}class Ha{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?KM(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Es(s,a,r)}}function KM(n,e){return n.replace(YM,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const YM=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Td(n){return JSON.parse(n)}function In(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Td(kg(i[0])||""),t=Td(kg(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},JM=function(n){const e=l1(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},XM=function(n){const e=l1(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ca(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Ng(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Pg(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Fr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(jE(i)&&jE(o)){if(!Fr(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function jE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function bu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Au(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZM{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const g=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(g<<1|g>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const g=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=g}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function eO(n,e){const t=new tO(n,e);return t.subscribe.bind(t)}class tO{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");nO(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=yy),s.error===void 0&&(s.error=yy),s.complete===void 0&&(s.complete=yy);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nO(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function yy(){}function Ra(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rO=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,ee(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Lp=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO=1e3,iO=2,oO=4*60*60*1e3,aO=.5;function UE(n,e=sO,t=iO){const r=e*Math.pow(t,n),s=Math.round(aO*r*(Math.random()-.5)*2);return Math.min(oO,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ce(n){return n&&n._delegate?n._delegate:n}class Sr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new kr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(cO(e))try{this.getOrInitializeService({instanceIdentifier:ta})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ta){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ta){return this.instances.has(e)}getOptions(e=ta){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:lO(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ta){return this.component?this.component.multipleInstances?e:ta:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lO(n){return n===ta?void 0:n}function cO(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new $_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(rt||(rt={}));const uO={debug:rt.DEBUG,verbose:rt.VERBOSE,info:rt.INFO,warn:rt.WARN,error:rt.ERROR,silent:rt.SILENT},dO=rt.INFO,hO={[rt.DEBUG]:"log",[rt.VERBOSE]:"log",[rt.INFO]:"info",[rt.WARN]:"warn",[rt.ERROR]:"error"},fO=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=hO[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class oh{constructor(e){this.name=e,this._logLevel=dO,this._logHandler=fO,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?uO[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rt.DEBUG,...e),this._logHandler(this,rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rt.VERBOSE,...e),this._logHandler(this,rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rt.INFO,...e),this._logHandler(this,rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rt.WARN,...e),this._logHandler(this,rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rt.ERROR,...e),this._logHandler(this,rt.ERROR,...e)}}const gO=(n,e)=>e.some(t=>n instanceof t);let $E,BE;function pO(){return $E||($E=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mO(){return BE||(BE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const u1=new WeakMap,B_=new WeakMap,d1=new WeakMap,_y=new WeakMap,U0=new WeakMap;function yO(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(yo(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&u1.set(t,n)}).catch(()=>{}),U0.set(e,n),e}function _O(n){if(B_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});B_.set(n,e)}let z_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return B_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||d1.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return yo(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function vO(n){z_=n(z_)}function wO(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(vy(this),e,...t);return d1.set(r,e.sort?e.sort():[e]),yo(r)}:mO().includes(n)?function(...e){return n.apply(vy(this),e),yo(u1.get(this))}:function(...e){return yo(n.apply(vy(this),e))}}function IO(n){return typeof n=="function"?wO(n):(n instanceof IDBTransaction&&_O(n),gO(n,pO())?new Proxy(n,z_):n)}function yo(n){if(n instanceof IDBRequest)return yO(n);if(_y.has(n))return _y.get(n);const e=IO(n);return e!==n&&(_y.set(n,e),U0.set(e,n)),e}const vy=n=>U0.get(n);function h1(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=yo(o);return r&&o.addEventListener("upgradeneeded",l=>{r(yo(o.result),l.oldVersion,l.newVersion,yo(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const xO=["get","getKey","getAll","getAllKeys","count"],EO=["put","add","delete","clear"],wy=new Map;function zE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(wy.get(e))return wy.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=EO.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||xO.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return wy.set(e,i),i}vO(n=>({...n,get:(e,t,r)=>zE(e,t)||n.get(e,t,r),has:(e,t)=>!!zE(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(TO(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function TO(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const q_="@firebase/app",qE="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wi=new oh("@firebase/app"),bO="@firebase/app-compat",AO="@firebase/analytics-compat",CO="@firebase/analytics",RO="@firebase/app-check-compat",kO="@firebase/app-check",NO="@firebase/auth",PO="@firebase/auth-compat",DO="@firebase/database",LO="@firebase/data-connect",MO="@firebase/database-compat",OO="@firebase/functions",VO="@firebase/functions-compat",FO="@firebase/installations",jO="@firebase/installations-compat",UO="@firebase/messaging",$O="@firebase/messaging-compat",BO="@firebase/performance",zO="@firebase/performance-compat",qO="@firebase/remote-config",WO="@firebase/remote-config-compat",GO="@firebase/storage",HO="@firebase/storage-compat",QO="@firebase/firestore",KO="@firebase/ai",YO="@firebase/firestore-compat",JO="firebase",XO="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dg="[DEFAULT]",ZO={[q_]:"fire-core",[bO]:"fire-core-compat",[CO]:"fire-analytics",[AO]:"fire-analytics-compat",[kO]:"fire-app-check",[RO]:"fire-app-check-compat",[NO]:"fire-auth",[PO]:"fire-auth-compat",[DO]:"fire-rtdb",[LO]:"fire-data-connect",[MO]:"fire-rtdb-compat",[OO]:"fire-fn",[VO]:"fire-fn-compat",[FO]:"fire-iid",[jO]:"fire-iid-compat",[UO]:"fire-fcm",[$O]:"fire-fcm-compat",[BO]:"fire-perf",[zO]:"fire-perf-compat",[qO]:"fire-rc",[WO]:"fire-rc-compat",[GO]:"fire-gcs",[HO]:"fire-gcs-compat",[QO]:"fire-fst",[YO]:"fire-fst-compat",[KO]:"fire-vertex","fire-js":"fire-js",[JO]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bd=new Map,eV=new Map,W_=new Map;function WE(n,e){try{n.container.addComponent(e)}catch(t){wi.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function xs(n){const e=n.name;if(W_.has(e))return wi.debug(`There were multiple attempts to register component ${e}.`),!1;W_.set(e,n);for(const t of bd.values())WE(t,n);for(const t of eV.values())WE(t,n);return!0}function Js(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function tV(n,e,t=Dg){Js(n,e).clearInstance(t)}function Xt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nV={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_o=new Ha("app","Firebase",nV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Sr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _o.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ka=XO;function f1(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Dg,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw _o.create("bad-app-name",{appName:String(s)});if(t||(t=ZC()),!t)throw _o.create("no-options");const i=bd.get(s);if(i){if(Fr(t,i.options)&&Fr(r,i.config))return i;throw _o.create("duplicate-app",{appName:s})}const o=new c1(s);for(const l of W_.values())o.addComponent(l);const a=new rV(t,r,o);return bd.set(s,a),a}function ah(n=Dg){const e=bd.get(n);if(!e&&n===Dg&&ZC())return f1();if(!e)throw _o.create("no-app",{appName:n});return e}function sV(){return Array.from(bd.values())}function xr(n,e,t){let r=ZO[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),wi.warn(o.join(" "));return}xs(new Sr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iV="firebase-heartbeat-database",oV=1,Ad="firebase-heartbeat-store";let Iy=null;function g1(){return Iy||(Iy=h1(iV,oV,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ad)}catch(t){console.warn(t)}}}}).catch(n=>{throw _o.create("idb-open",{originalErrorMessage:n.message})})),Iy}async function aV(n){try{const t=(await g1()).transaction(Ad),r=await t.objectStore(Ad).get(p1(n));return await t.done,r}catch(e){if(e instanceof Es)wi.warn(e.message);else{const t=_o.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});wi.warn(t.message)}}}async function GE(n,e){try{const r=(await g1()).transaction(Ad,"readwrite");await r.objectStore(Ad).put(e,p1(n)),await r.done}catch(t){if(t instanceof Es)wi.warn(t.message);else{const r=_o.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});wi.warn(r.message)}}}function p1(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lV=1024,cV=30;class uV{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new hV(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=HE();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>cV){const o=fV(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){wi.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=HE(),{heartbeatsToSend:r,unsentEntries:s}=dV(this._heartbeatsCache.heartbeats),i=Rg(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return wi.warn(t),""}}}function HE(){return new Date().toISOString().substring(0,10)}function dV(n,e=lV){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),QE(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),QE(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class hV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Dp()?j0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await aV(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return GE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return GE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function QE(n){return Rg(JSON.stringify({version:2,heartbeats:n})).length}function fV(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gV(n){xs(new Sr("platform-logger",e=>new SO(e),"PRIVATE")),xs(new Sr("heartbeat",e=>new uV(e),"PRIVATE")),xr(q_,qE,n),xr(q_,qE,"esm2020"),xr("fire-js","")}gV("");var pV="firebase",mV="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xr(pV,mV,"app");const KE="@firebase/database",YE="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m1="";function y1(n){m1=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),In(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Td(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ss(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _1=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new yV(e)}}catch{}return new _V},ha=_1("localStorage"),G_=_1("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl=new oh("@firebase/database"),v1=function(){let n=1;return function(){return n++}}(),w1=function(n){const e=rO(n),t=new ZM;t.update(e);const r=t.digest();return M0.encodeByteArray(r)},lh=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=lh.apply(null,r):typeof r=="object"?e+=In(r):e+=r,e+=" "}return e};let _a=null,JE=!0;const I1=function(n,e){ee(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(zl.logLevel=rt.VERBOSE,_a=zl.log.bind(zl),e&&G_.set("logging_enabled",!0)):typeof n=="function"?_a=n:(_a=null,G_.remove("logging_enabled"))},Dn=function(...n){if(JE===!0&&(JE=!1,_a===null&&G_.get("logging_enabled")===!0&&I1(!0)),_a){const e=lh.apply(null,n);_a(e)}},ch=function(n){return function(...e){Dn(n,...e)}},H_=function(...n){const e="FIREBASE INTERNAL ERROR: "+lh(...n);zl.error(e)},Qs=function(...n){const e=`FIREBASE FATAL ERROR: ${lh(...n)}`;throw zl.error(e),new Error(e)},sr=function(...n){const e="FIREBASE WARNING: "+lh(...n);zl.warn(e)},vV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&sr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Mp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},wV=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},bo="[MIN_NAME]",Ii="[MAX_NAME]",Ya=function(n,e){if(n===e)return 0;if(n===bo||e===Ii)return-1;if(e===bo||n===Ii)return 1;{const t=XE(n),r=XE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},IV=function(n,e){return n===e?0:n<e?-1:1},hu=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+In(e))},$0=function(n){if(typeof n!="object"||n===null)return In(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=In(e[r]),t+=":",t+=$0(n[e[r]]);return t+="}",t},x1=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Vn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const E1=function(n){ee(!Mp(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let g=parseInt(h.substr(l,8),2).toString(16);g.length===1&&(g="0"+g),f=f+g}return f.toLowerCase()},xV=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},EV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function SV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const TV=new RegExp("^-?(0*)\\d{1,10}$"),bV=-2147483648,AV=2147483647,XE=function(n){if(TV.test(n)){const e=Number(n);if(e>=bV&&e<=AV)return e}return null},Mc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw sr("Exception was thrown by user callback.",t),e},Math.floor(0))}},CV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},qu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Xt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){sr(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kV{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Dn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',sr(e)}}class ql{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ql.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B0="5",S1="v",T1="s",b1="r",A1="f",C1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,R1="ls",k1="p",Q_="ac",N1="websocket",P1="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ha.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ha.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function NV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function L1(n,e,t){ee(typeof e=="string","typeof type must == string"),ee(typeof t=="object","typeof params must == object");let r;if(e===N1)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===P1)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);NV(n)&&(t.ns=n.namespace);const s=[];return Vn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(){this.counters_={}}incrementCounter(e,t=1){Ss(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return jM(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xy={},Ey={};function z0(n){const e=n.toString();return xy[e]||(xy[e]=new PV),xy[e]}function DV(n,e){const t=n.toString();return Ey[t]||(Ey[t]=e()),Ey[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Mc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZE="start",MV="close",OV="pLPCommand",VV="pRTLPCB",M1="id",O1="pw",V1="ser",FV="cb",jV="seg",UV="ts",$V="d",BV="dframe",F1=1870,j1=30,zV=F1-j1,qV=25e3,WV=3e4;class no{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ch(e),this.stats_=z0(t),this.urlFn=l=>(this.appCheckToken&&(l[Q_]=this.appCheckToken),L1(t,P1,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new LV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(WV)),wV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new q0((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ZE)this.id=a,this.password=l;else if(o===MV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[ZE]="t",r[V1]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[FV]=this.scriptTagHolder.uniqueCallbackIdentifier),r[S1]=B0,this.transportSessionId&&(r[T1]=this.transportSessionId),this.lastSessionId&&(r[R1]=this.lastSessionId),this.applicationId&&(r[k1]=this.applicationId),this.appCheckToken&&(r[Q_]=this.appCheckToken),typeof location<"u"&&location.hostname&&C1.test(location.hostname)&&(r[b1]=A1);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){no.forceAllow_=!0}static forceDisallow(){no.forceDisallow_=!0}static isAvailable(){return no.forceAllow_?!0:!no.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!xV()&&!EV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=In(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=QC(t),s=x1(r,zV);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[BV]="t",r[M1]=e,r[O1]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=In(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class q0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=v1(),window[OV+this.uniqueCallbackIdentifier]=e,window[VV+this.uniqueCallbackIdentifier]=t,this.myIFrame=q0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Dn("frame writing exception"),a.stack&&Dn(a.stack),Dn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Dn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[M1]=this.myID,e[O1]=this.myPW,e[V1]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+j1+r.length<=F1;){const o=this.pendingSegs.shift();r=r+"&"+jV+s+"="+o.seg+"&"+UV+s+"="+o.ts+"&"+$V+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(qV)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Dn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GV=16384,HV=45e3;let Lg=null;typeof MozWebSocket<"u"?Lg=MozWebSocket:typeof WebSocket<"u"&&(Lg=WebSocket);class Yr{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ch(this.connId),this.stats_=z0(t),this.connURL=Yr.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[S1]=B0,typeof location<"u"&&location.hostname&&C1.test(location.hostname)&&(o[b1]=A1),t&&(o[T1]=t),r&&(o[R1]=r),s&&(o[Q_]=s),i&&(o[k1]=i),L1(e,N1,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ha.set("previous_websocket_failure",!0);try{let r;s1(),this.mySock=new Lg(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Yr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Lg!==null&&!Yr.forceDisallow_}static previouslyFailed(){return ha.isInMemoryStorage||ha.get("previous_websocket_failure")===!0}markConnectionHealthy(){ha.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Td(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ee(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=In(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=x1(t,GV);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(HV))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Yr.responsesRequiredToBeHealthy=2;Yr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{static get ALL_TRANSPORTS(){return[no,Yr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Yr&&Yr.isAvailable();let r=t&&!Yr.previouslyFailed();if(e.webSocketOnly&&(t||sr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Yr];else{const s=this.transports_=[];for(const i of ic.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);ic.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ic.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QV=6e4,KV=5e3,YV=10*1024,JV=100*1024,Sy="t",eS="d",XV="s",tS="r",ZV="e",nS="o",rS="a",sS="n",iS="p",eF="h";class tF{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ch("c:"+this.id+":"),this.transportManager_=new ic(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=qu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>JV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>YV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Sy in e){const t=e[Sy];t===rS?this.upgradeIfSecondaryHealthy_():t===tS?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===nS&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=hu("t",e),r=hu("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:iS,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:rS,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:sS,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=hu("t",e),r=hu("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=hu(Sy,e);if(eS in e){const r=e[eS];if(t===eF){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===sS){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===XV?this.onConnectionShutdown_(r):t===tS?this.onReset_(r):t===ZV?H_("Server Error: "+r):t===nS?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):H_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),B0!==r&&sr("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),qu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(QV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):qu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(KV))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:iS,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ha.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $1{constructor(e){this.allowedEvents_=e,this.listeners_={},ee(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){ee(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg extends $1{static getInstance(){return new Mg}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!V0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ee(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oS=32,aS=768;class Et{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function _t(){return new Et("")}function Je(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ao(n){return n.pieces_.length-n.pieceNum_}function Mt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Et(n.pieces_,e)}function W0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function nF(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Cd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function B1(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Et(e,0)}function Zt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Et)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new Et(t,0)}function Xe(n){return n.pieceNum_>=n.pieces_.length}function cr(n,e){const t=Je(n),r=Je(e);if(t===null)return e;if(t===r)return cr(Mt(n),Mt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function rF(n,e){const t=Cd(n,0),r=Cd(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=Ya(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function G0(n,e){if(Ao(n)!==Ao(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Xr(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Ao(n)>Ao(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class sF{constructor(e,t){this.errorPrefix_=t,this.parts_=Cd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Lp(this.parts_[r]);z1(this)}}function iF(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Lp(e),z1(n)}function oF(n){const e=n.parts_.pop();n.byteLength_-=Lp(e),n.parts_.length>0&&(n.byteLength_-=1)}function z1(n){if(n.byteLength_>aS)throw new Error(n.errorPrefix_+"has a key path longer than "+aS+" bytes ("+n.byteLength_+").");if(n.parts_.length>oS)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+oS+") or object contains a cycle "+na(n))}function na(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0 extends $1{static getInstance(){return new H0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ee(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=1e3,aF=60*5*1e3,lS=30*1e3,lF=1.3,cF=3e4,uF="server_kill",cS=3;class es extends U1{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=es.nextPersistentConnectionId_++,this.log_=ch("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=fu,this.maxReconnectDelay_=aF,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!s1())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");H0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Mg.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(In(i)),ee(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new kr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ee(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ee(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;es.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ss(e,"w")){const r=Ca(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();sr(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||XM(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lS)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=JM(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),ee(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+In(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):H_("Unrecognized action received from server: "+In(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ee(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=fu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=fu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>cF&&(this.reconnectDelay_=fu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*lF)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+es.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){ee(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,g]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Dn("getToken() completed but was canceled"):(Dn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=g&&g.token,a=new tF(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{sr(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(uF)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&sr(f),l())}}}interrupt(e){Dn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Dn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ng(this.interruptReasons_)&&(this.reconnectDelay_=fu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>$0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new Et(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Dn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=cS&&(this.reconnectDelay_=lS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Dn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=cS&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+m1.replace(/\./g,"-")]=1,V0()?e["framework.cordova"]=1:r1()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Mg.getInstance().currentlyOnline();return Ng(this.interruptReasons_)&&e}}es.nextPersistentConnectionId_=0;es.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new et(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new et(bo,e),s=new et(bo,t);return this.compare(r,s)!==0}minPost(){return et.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ff;class q1 extends Op{static get __EMPTY_NODE(){return ff}static set __EMPTY_NODE(e){ff=e}compare(e,t){return Ya(e.name,t.name)}isDefinedOn(e){throw Lc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return et.MIN}maxPost(){return new et(Ii,ff)}makePost(e,t){return ee(typeof e=="string","KeyIndex indexValue must always be a string."),new et(e,ff)}toString(){return".key"}}const zs=new q1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gf=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Cr=class Cu{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Cu.RED,this.left=s??Os.EMPTY_NODE,this.right=i??Os.EMPTY_NODE}copy(e,t,r,s,i){return new Cu(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Os.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Os.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Cu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Cu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Cr.RED=!0;Cr.BLACK=!1;class dF{copy(e,t,r,s,i){return this}insert(e,t,r){return new Cr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Os=class $f{constructor(e,t=$f.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new $f(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Cr.BLACK,null,null))}remove(e){return new $f(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Cr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new gf(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new gf(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new gf(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new gf(this.root_,null,this.comparator_,!0,e)}};Os.EMPTY_NODE=new dF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hF(n,e){return Ya(n.name,e.name)}function Q0(n,e){return Ya(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K_;function fF(n){K_=n}const W1=function(n){return typeof n=="number"?"number:"+E1(n):"string:"+n},G1=function(n){if(n.isLeafNode()){const e=n.val();ee(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ss(e,".sv"),"Priority must be a string or number.")}else ee(n===K_||n.isEmpty(),"priority of unexpected type.");ee(n===K_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uS;class Rn{static set __childrenNodeConstructor(e){uS=e}static get __childrenNodeConstructor(){return uS}constructor(e,t=Rn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,ee(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),G1(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Rn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Rn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Xe(e)?this:Je(e)===".priority"?this.priorityNode_:Rn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Rn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=Je(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(ee(r!==".priority"||Ao(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Rn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Mt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+W1(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=E1(this.value_):e+=this.value_,this.lazyHash_=w1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Rn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Rn.__childrenNodeConstructor?-1:(ee(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=Rn.VALUE_TYPE_ORDER.indexOf(t),i=Rn.VALUE_TYPE_ORDER.indexOf(r);return ee(s>=0,"Unknown leaf type: "+t),ee(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Rn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let H1,Q1;function gF(n){H1=n}function pF(n){Q1=n}class mF extends Op{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?Ya(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return et.MIN}maxPost(){return new et(Ii,new Rn("[PRIORITY-POST]",Q1))}makePost(e,t){const r=H1(e);return new et(t,new Rn("[PRIORITY-POST]",r))}toString(){return".priority"}}const $t=new mF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yF=Math.log(2);class _F{constructor(e){const t=i=>parseInt(Math.log(i)/yF,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Og=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,g;if(h===0)return null;if(h===1)return f=n[l],g=t?t(f):f,new Cr(g,f.node,Cr.BLACK,null,null);{const y=parseInt(h/2,10)+l,w=s(l,y),C=s(y+1,u);return f=n[y],g=t?t(f):f,new Cr(g,f.node,Cr.BLACK,w,C)}},i=function(l){let u=null,h=null,f=n.length;const g=function(w,C){const N=f-w,A=f;f-=w;const x=s(N+1,A),R=n[N],D=t?t(R):R;y(new Cr(D,R.node,C,null,x))},y=function(w){u?(u.left=w,u=w):(h=w,u=w)};for(let w=0;w<l.count;++w){const C=l.nextBitIsOne(),N=Math.pow(2,l.count-(w+1));C?g(N,Cr.BLACK):(g(N,Cr.BLACK),g(N,Cr.RED))}return h},o=new _F(n.length),a=i(o);return new Os(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ty;const hl={};class ui{static get Default(){return ee(hl&&$t,"ChildrenNode.ts has not been loaded"),Ty=Ty||new ui({".priority":hl},{".priority":$t}),Ty}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ca(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Os?t:null}hasIndex(e){return Ss(this.indexSet_,e.toString())}addIndex(e,t){ee(e!==zs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(et.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Og(r,e.getCompare()):a=hl;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new ui(h,u)}addToIndexes(e,t){const r=Pg(this.indexes_,(s,i)=>{const o=Ca(this.indexSet_,i);if(ee(o,"Missing index implementation for "+i),s===hl)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(et.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Og(a,o.getCompare())}else return hl;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new et(e.name,a))),l.insert(e,e.node)}});return new ui(r,this.indexSet_)}removeFromIndexes(e,t){const r=Pg(this.indexes_,s=>{if(s===hl)return s;{const i=t.get(e.name);return i?s.remove(new et(e.name,i)):s}});return new ui(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gu;class Pe{static get EMPTY_NODE(){return gu||(gu=new Pe(new Os(Q0),null,ui.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&G1(this.priorityNode_),this.children_.isEmpty()&&ee(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||gu}updatePriority(e){return this.children_.isEmpty()?this:new Pe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?gu:t}}getChild(e){const t=Je(e);return t===null?this:this.getImmediateChild(t).getChild(Mt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(ee(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new et(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?gu:this.priorityNode_;return new Pe(s,o,i)}}updateChild(e,t){const r=Je(e);if(r===null)return t;{ee(Je(e)!==".priority"||Ao(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Mt(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild($t,(o,a)=>{t[o]=a.val(e),r++,i&&Pe.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+W1(this.getPriority().val())+":"),this.forEachChild($t,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":w1(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new et(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new et(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new et(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,et.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,et.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===uh?-1:0}withIndex(e){if(e===zs||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Pe(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===zs||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator($t),s=t.getIterator($t);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===zs?null:this.indexMap_.get(e.toString())}}Pe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class vF extends Pe{constructor(){super(new Os(Q0),Pe.EMPTY_NODE,ui.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Pe.EMPTY_NODE}isEmpty(){return!1}}const uh=new vF;Object.defineProperties(et,{MIN:{value:new et(bo,Pe.EMPTY_NODE)},MAX:{value:new et(Ii,uh)}});q1.__EMPTY_NODE=Pe.EMPTY_NODE;Rn.__childrenNodeConstructor=Pe;fF(uh);pF(uh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF=!0;function rn(n,e=null){if(n===null)return Pe.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),ee(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Rn(t,rn(e))}if(!(n instanceof Array)&&wF){const t=[];let r=!1;if(Vn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=rn(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new et(o,l)))}}),t.length===0)return Pe.EMPTY_NODE;const i=Og(t,hF,o=>o.name,Q0);if(r){const o=Og(t,$t.getCompare());return new Pe(i,rn(e),new ui({".priority":o},{".priority":$t}))}else return new Pe(i,rn(e),ui.Default)}else{let t=Pe.EMPTY_NODE;return Vn(n,(r,s)=>{if(Ss(n,r)&&r.substring(0,1)!=="."){const i=rn(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(rn(e))}}gF(rn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0 extends Op{constructor(e){super(),this.indexPath_=e,ee(!Xe(e)&&Je(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?Ya(e.name,t.name):i}makePost(e,t){const r=rn(e),s=Pe.EMPTY_NODE.updateChild(this.indexPath_,r);return new et(t,s)}maxPost(){const e=Pe.EMPTY_NODE.updateChild(this.indexPath_,uh);return new et(Ii,e)}toString(){return Cd(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IF extends Op{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Ya(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return et.MIN}maxPost(){return et.MAX}makePost(e,t){const r=rn(e);return new et(t,r)}toString(){return".value"}}const Y0=new IF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K1(n){return{type:"value",snapshotNode:n}}function oc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Rd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function kd(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function xF(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){ee(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Rd(t,a)):ee(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(oc(t,r)):o.trackChildChange(kd(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild($t,(s,i)=>{t.hasChild(s)||r.trackChildChange(Rd(s,i))}),t.isLeafNode()||t.forEachChild($t,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(kd(s,i,o))}else r.trackChildChange(oc(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Pe.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(e){this.indexedFilter_=new J0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Nd.getStartPost_(e),this.endPost_=Nd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new et(t,r))||(r=Pe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Pe.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Pe.EMPTY_NODE);const i=this;return t.forEachChild($t,(o,a)=>{i.matches(new et(o,a))||(s=s.updateImmediateChild(o,Pe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Nd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new et(t,r))||(r=Pe.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=Pe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Pe.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(Pe.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Pe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(g,y)=>f(y,g)}else o=this.index_.getCompare();const a=e;ee(a.numChildren()===this.limit_,"");const l=new et(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let g=s.getChildAfterChild(this.index_,u,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=s.getChildAfterChild(this.index_,g,this.reverse_);const y=g==null?1:o(g,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(kd(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(Rd(t,f));const C=a.updateImmediateChild(t,Pe.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(i!=null&&i.trackChildChange(oc(g.name,g.node)),C.updateImmediateChild(g.name,g.node)):C}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(Rd(u.name,u.node)),i.trackChildChange(oc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,Pe.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$t}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ee(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ee(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:bo}hasEnd(){return this.endSet_}getIndexEndValue(){return ee(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ee(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ii}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ee(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===$t}copy(){const e=new X0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function SF(n){return n.loadsAllData()?new J0(n.getIndex()):n.hasLimit()?new EF(n):new Nd(n)}function TF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function bF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Y_(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function AF(n,e,t){let r;return n.index_===zs||t?r=Y_(n,e,t):r=Y_(n,e,Ii),r.startAfterSet_=!0,r}function J_(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function CF(n,e,t){let r;return n.index_===zs||t?r=J_(n,e,t):r=J_(n,e,bo),r.endBeforeSet_=!0,r}function Vp(n,e){const t=n.copy();return t.index_=e,t}function dS(n){const e={};if(n.isDefault())return e;let t;if(n.index_===$t?t="$priority":n.index_===Y0?t="$value":n.index_===zs?t="$key":(ee(n.index_ instanceof K0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=In(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=In(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+In(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=In(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+In(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function hS(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==$t&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg extends U1{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(ee(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=ch("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Vg.getListenId_(e,r),a={};this.listens_[o]=a;const l=dS(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Ca(this.listens_,o)===a){let g;u?u===401?g="permission_denied":g="rest_error:"+u:g="ok",s(g,null)}})}unlisten(e,t){const r=Vg.getListenId_(e,t);delete this.listens_[r]}get(e){const t=dS(e._queryParams),r=e._path.toString(),s=new kr;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Qa(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Td(a.responseText)}catch{sr("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&sr("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(){this.rootNode_=Pe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(){return{value:null,children:new Map}}function Oc(n,e,t){if(Xe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=Je(e);n.children.has(r)||n.children.set(r,Fg());const s=n.children.get(r);e=Mt(e),Oc(s,e,t)}}function X_(n,e){if(Xe(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild($t,(r,s)=>{Oc(n,new Et(r),s)}),X_(n,e)}}else if(n.children.size>0){const t=Je(e);return e=Mt(e),n.children.has(t)&&X_(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Z_(n,e,t){n.value!==null?t(e,n.value):kF(n,(r,s)=>{const i=new Et(e.toString()+"/"+r);Z_(s,i,t)})}function kF(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Vn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fS=10*1e3,PF=30*1e3,DF=5*60*1e3;class LF{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new NF(e);const r=fS+(PF-fS)*Math.random();qu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Vn(e,(s,i)=>{i>0&&Ss(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),qu(this.reportStats_.bind(this),Math.floor(Math.random()*2*DF))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ps;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ps||(ps={}));function Z0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ew(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function tw(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=ps.ACK_USER_WRITE,this.source=Z0()}operationForChild(e){if(Xe(this.path)){if(this.affectedTree.value!=null)return ee(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Et(e));return new jg(_t(),t,this.revert)}}else return ee(Je(this.path)===e,"operationForChild called for unrelated child."),new jg(Mt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(e,t){this.source=e,this.path=t,this.type=ps.LISTEN_COMPLETE}operationForChild(e){return Xe(this.path)?new Pd(this.source,_t()):new Pd(this.source,Mt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=ps.OVERWRITE}operationForChild(e){return Xe(this.path)?new ka(this.source,_t(),this.snap.getImmediateChild(e)):new ka(this.source,Mt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=ps.MERGE}operationForChild(e){if(Xe(this.path)){const t=this.children.subtree(new Et(e));return t.isEmpty()?null:t.value?new ka(this.source,_t(),t.value):new ac(this.source,_t(),t)}else return ee(Je(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ac(this.source,Mt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Xe(e))return this.isFullyInitialized()&&!this.filtered_;const t=Je(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function OF(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(xF(o.childName,o.snapshotNode))}),pu(n,s,"child_removed",e,r,t),pu(n,s,"child_added",e,r,t),pu(n,s,"child_moved",i,r,t),pu(n,s,"child_changed",e,r,t),pu(n,s,"value",e,r,t),s}function pu(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>FF(n,a,l)),o.forEach(a=>{const l=VF(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function VF(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function FF(n,e,t){if(e.childName==null||t.childName==null)throw Lc("Should only compare child_ events.");const r=new et(e.childName,e.snapshotNode),s=new et(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fp(n,e){return{eventCache:n,serverCache:e}}function Wu(n,e,t,r){return Fp(new Co(e,t,r),n.serverCache)}function Y1(n,e,t,r){return Fp(n.eventCache,new Co(e,t,r))}function Ug(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Na(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let by;const jF=()=>(by||(by=new Os(IV)),by);class jt{static fromObject(e){let t=new jt(null);return Vn(e,(r,s)=>{t=t.set(new Et(r),s)}),t}constructor(e,t=jF()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:_t(),value:this.value};if(Xe(e))return null;{const r=Je(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Mt(e),t);return i!=null?{path:Zt(new Et(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Xe(e))return this;{const t=Je(e),r=this.children.get(t);return r!==null?r.subtree(Mt(e)):new jt(null)}}set(e,t){if(Xe(e))return new jt(t,this.children);{const r=Je(e),i=(this.children.get(r)||new jt(null)).set(Mt(e),t),o=this.children.insert(r,i);return new jt(this.value,o)}}remove(e){if(Xe(e))return this.children.isEmpty()?new jt(null):new jt(null,this.children);{const t=Je(e),r=this.children.get(t);if(r){const s=r.remove(Mt(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new jt(null):new jt(this.value,i)}else return this}}get(e){if(Xe(e))return this.value;{const t=Je(e),r=this.children.get(t);return r?r.get(Mt(e)):null}}setTree(e,t){if(Xe(e))return t;{const r=Je(e),i=(this.children.get(r)||new jt(null)).setTree(Mt(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new jt(this.value,o)}}fold(e){return this.fold_(_t(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Zt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,_t(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(Xe(e))return null;{const i=Je(e),o=this.children.get(i);return o?o.findOnPath_(Mt(e),Zt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,_t(),t)}foreachOnPath_(e,t,r){if(Xe(e))return this;{this.value&&r(t,this.value);const s=Je(e),i=this.children.get(s);return i?i.foreachOnPath_(Mt(e),Zt(t,s),r):new jt(null)}}foreach(e){this.foreach_(_t(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(Zt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(e){this.writeTree_=e}static empty(){return new vs(new jt(null))}}function Gu(n,e,t){if(Xe(e))return new vs(new jt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=cr(s,e);return i=i.updateChild(o,t),new vs(n.writeTree_.set(s,i))}else{const s=new jt(t),i=n.writeTree_.setTree(e,s);return new vs(i)}}}function ev(n,e,t){let r=n;return Vn(t,(s,i)=>{r=Gu(r,Zt(e,s),i)}),r}function gS(n,e){if(Xe(e))return vs.empty();{const t=n.writeTree_.setTree(e,new jt(null));return new vs(t)}}function tv(n,e){return Ja(n,e)!=null}function Ja(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(cr(t.path,e)):null}function pS(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild($t,(r,s)=>{e.push(new et(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new et(r,s.value))}),e}function vo(n,e){if(Xe(e))return n;{const t=Ja(n,e);return t!=null?new vs(new jt(t)):new vs(n.writeTree_.subtree(e))}}function nv(n){return n.writeTree_.isEmpty()}function lc(n,e){return J1(_t(),n.writeTree_,e)}function J1(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(ee(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=J1(Zt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Zt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jp(n,e){return tR(e,n)}function UF(n,e,t,r,s){ee(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=Gu(n.visibleWrites,e,t)),n.lastWriteId=r}function $F(n,e,t,r){ee(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=ev(n.visibleWrites,e,t),n.lastWriteId=r}function BF(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function zF(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);ee(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&qF(a,r.path)?s=!1:Xr(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return WF(n),!0;if(r.snap)n.visibleWrites=gS(n.visibleWrites,r.path);else{const a=r.children;Vn(a,l=>{n.visibleWrites=gS(n.visibleWrites,Zt(r.path,l))})}return!0}else return!1}function qF(n,e){if(n.snap)return Xr(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Xr(Zt(n.path,t),e))return!0;return!1}function WF(n){n.visibleWrites=X1(n.allWrites,GF,_t()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function GF(n){return n.visible}function X1(n,e,t){let r=vs.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)Xr(t,o)?(a=cr(t,o),r=Gu(r,a,i.snap)):Xr(o,t)&&(a=cr(o,t),r=Gu(r,_t(),i.snap.getChild(a)));else if(i.children){if(Xr(t,o))a=cr(t,o),r=ev(r,a,i.children);else if(Xr(o,t))if(a=cr(o,t),Xe(a))r=ev(r,_t(),i.children);else{const l=Ca(i.children,Je(a));if(l){const u=l.getChild(Mt(a));r=Gu(r,_t(),u)}}}else throw Lc("WriteRecord should have .snap or .children")}}return r}function Z1(n,e,t,r,s){if(!r&&!s){const i=Ja(n.visibleWrites,e);if(i!=null)return i;{const o=vo(n.visibleWrites,e);if(nv(o))return t;if(t==null&&!tv(o,_t()))return null;{const a=t||Pe.EMPTY_NODE;return lc(o,a)}}}else{const i=vo(n.visibleWrites,e);if(!s&&nv(i))return t;if(!s&&t==null&&!tv(i,_t()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Xr(u.path,e)||Xr(e,u.path))},a=X1(n.allWrites,o,e),l=t||Pe.EMPTY_NODE;return lc(a,l)}}}function HF(n,e,t){let r=Pe.EMPTY_NODE;const s=Ja(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild($t,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=vo(n.visibleWrites,e);return t.forEachChild($t,(o,a)=>{const l=lc(vo(i,new Et(o)),a);r=r.updateImmediateChild(o,l)}),pS(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=vo(n.visibleWrites,e);return pS(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function QF(n,e,t,r,s){ee(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Zt(e,t);if(tv(n.visibleWrites,i))return null;{const o=vo(n.visibleWrites,i);return nv(o)?s.getChild(t):lc(o,s.getChild(t))}}function KF(n,e,t,r){const s=Zt(e,t),i=Ja(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=vo(n.visibleWrites,s);return lc(o,r.getNode().getImmediateChild(t))}else return null}function YF(n,e){return Ja(n.visibleWrites,e)}function JF(n,e,t,r,s,i,o){let a;const l=vo(n.visibleWrites,e),u=Ja(l,_t());if(u!=null)a=u;else if(t!=null)a=lc(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),g=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=g.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=g.getNext();return h}else return[]}function XF(){return{visibleWrites:vs.empty(),allWrites:[],lastWriteId:-1}}function $g(n,e,t,r){return Z1(n.writeTree,n.treePath,e,t,r)}function nw(n,e){return HF(n.writeTree,n.treePath,e)}function mS(n,e,t,r){return QF(n.writeTree,n.treePath,e,t,r)}function Bg(n,e){return YF(n.writeTree,Zt(n.treePath,e))}function ZF(n,e,t,r,s,i){return JF(n.writeTree,n.treePath,e,t,r,s,i)}function rw(n,e,t){return KF(n.writeTree,n.treePath,e,t)}function eR(n,e){return tR(Zt(n.treePath,e),n.writeTree)}function tR(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;ee(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),ee(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,kd(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Rd(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,oc(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,kd(r,e.snapshotNode,s.oldSnap));else throw Lc("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const nR=new tj;class sw{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Co(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return rw(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Na(this.viewCache_),i=ZF(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nj(n){return{filter:n}}function rj(n,e){ee(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),ee(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function sj(n,e,t,r,s){const i=new ej;let o,a;if(t.type===ps.OVERWRITE){const u=t;u.source.fromUser?o=rv(n,e,u.path,u.snap,r,s,i):(ee(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Xe(u.path),o=zg(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===ps.MERGE){const u=t;u.source.fromUser?o=oj(n,e,u.path,u.children,r,s,i):(ee(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=sv(n,e,u.path,u.children,r,s,a,i))}else if(t.type===ps.ACK_USER_WRITE){const u=t;u.revert?o=cj(n,e,u.path,r,s,i):o=aj(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===ps.LISTEN_COMPLETE)o=lj(n,e,t.path,r,i);else throw Lc("Unknown operation type: "+t.type);const l=i.getChanges();return ij(e,o,l),{viewCache:o,changes:l}}function ij(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Ug(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(K1(Ug(e)))}}function rR(n,e,t,r,s,i){const o=e.eventCache;if(Bg(r,t)!=null)return e;{let a,l;if(Xe(t))if(ee(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Na(e),h=u instanceof Pe?u:Pe.EMPTY_NODE,f=nw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=$g(r,Na(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Je(t);if(u===".priority"){ee(Ao(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=mS(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=Mt(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const g=mS(r,t,o.getNode(),l);g!=null?f=o.getNode().getImmediateChild(u).updateChild(h,g):f=o.getNode().getImmediateChild(u)}else f=rw(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Wu(e,a,o.isFullyInitialized()||Xe(t),n.filter.filtersNodes())}}function zg(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Xe(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=Je(t);if(!l.isCompleteForPath(t)&&Ao(t)>1)return e;const w=Mt(t),N=l.getNode().getImmediateChild(y).updateChild(w,r);y===".priority"?u=h.updatePriority(l.getNode(),N):u=h.updateChild(l.getNode(),y,N,w,nR,null)}const f=Y1(e,u,l.isFullyInitialized()||Xe(t),h.filtersNodes()),g=new sw(s,f,i);return rR(n,f,t,s,g,a)}function rv(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new sw(s,e,i);if(Xe(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Wu(e,u,!0,n.filter.filtersNodes());else{const f=Je(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=Wu(e,u,a.isFullyInitialized(),a.isFiltered());else{const g=Mt(t),y=a.getNode().getImmediateChild(f);let w;if(Xe(g))w=r;else{const C=h.getCompleteChild(f);C!=null?W0(g)===".priority"&&C.getChild(B1(g)).isEmpty()?w=C:w=C.updateChild(g,r):w=Pe.EMPTY_NODE}if(y.equals(w))l=e;else{const C=n.filter.updateChild(a.getNode(),f,w,g,h,o);l=Wu(e,C,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function yS(n,e){return n.eventCache.isCompleteForChild(e)}function oj(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=Zt(t,l);yS(e,Je(h))&&(a=rv(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=Zt(t,l);yS(e,Je(h))||(a=rv(n,a,h,u,s,i,o))}),a}function _S(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function sv(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Xe(t)?u=r:u=new jt(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,g)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),w=_S(n,y,g);l=zg(n,l,new Et(f),w,s,i,o,a)}}),u.children.inorderTraversal((f,g)=>{const y=!e.serverCache.isCompleteForChild(f)&&g.value===null;if(!h.hasChild(f)&&!y){const w=e.serverCache.getNode().getImmediateChild(f),C=_S(n,w,g);l=zg(n,l,new Et(f),C,s,i,o,a)}}),l}function aj(n,e,t,r,s,i,o){if(Bg(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(Xe(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return zg(n,e,t,l.getNode().getChild(t),s,i,a,o);if(Xe(t)){let u=new jt(null);return l.getNode().forEachChild(zs,(h,f)=>{u=u.set(new Et(h),f)}),sv(n,e,t,u,s,i,a,o)}else return e}else{let u=new jt(null);return r.foreach((h,f)=>{const g=Zt(t,h);l.isCompleteForPath(g)&&(u=u.set(h,l.getNode().getChild(g)))}),sv(n,e,t,u,s,i,a,o)}}function lj(n,e,t,r,s){const i=e.serverCache,o=Y1(e,i.getNode(),i.isFullyInitialized()||Xe(t),i.isFiltered());return rR(n,o,t,r,nR,s)}function cj(n,e,t,r,s,i){let o;if(Bg(r,t)!=null)return e;{const a=new sw(r,e,s),l=e.eventCache.getNode();let u;if(Xe(t)||Je(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=$g(r,Na(e));else{const f=e.serverCache.getNode();ee(f instanceof Pe,"serverChildren would be complete if leaf node"),h=nw(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Je(t);let f=rw(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,Mt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Pe.EMPTY_NODE,Mt(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=$g(r,Na(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Bg(r,_t())!=null,Wu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new J0(r.getIndex()),i=SF(r);this.processor_=nj(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(Pe.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Pe.EMPTY_NODE,a.getNode(),null),h=new Co(l,o.isFullyInitialized(),s.filtersNodes()),f=new Co(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Fp(f,h),this.eventGenerator_=new MF(this.query_)}get query(){return this.query_}}function dj(n){return n.viewCache_.serverCache.getNode()}function hj(n){return Ug(n.viewCache_)}function fj(n,e){const t=Na(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Xe(e)&&!t.getImmediateChild(Je(e)).isEmpty())?t.getChild(e):null}function vS(n){return n.eventRegistrations_.length===0}function gj(n,e){n.eventRegistrations_.push(e)}function wS(n,e,t){const r=[];if(t){ee(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function IS(n,e,t,r){e.type===ps.MERGE&&e.source.queryId!==null&&(ee(Na(n.viewCache_),"We should always have a full cache before handling merges"),ee(Ug(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=sj(n.processor_,s,e,t,r);return rj(n.processor_,i.viewCache),ee(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,sR(n,i.changes,i.viewCache.eventCache.getNode(),null)}function pj(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild($t,(i,o)=>{r.push(oc(i,o))}),t.isFullyInitialized()&&r.push(K1(t.getNode())),sR(n,r,t.getNode(),e)}function sR(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return OF(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qg;class iR{constructor(){this.views=new Map}}function mj(n){ee(!qg,"__referenceConstructor has already been defined"),qg=n}function yj(){return ee(qg,"Reference.ts has not been loaded"),qg}function _j(n){return n.views.size===0}function iw(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return ee(i!=null,"SyncTree gave us an op for an invalid query."),IS(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(IS(o,e,t,r));return i}}function oR(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=$g(t,s?r:null),l=!1;a?l=!0:r instanceof Pe?(a=nw(t,r),l=!1):(a=Pe.EMPTY_NODE,l=!1);const u=Fp(new Co(a,l,!1),new Co(r,s,!1));return new uj(e,u)}return o}function vj(n,e,t,r,s,i){const o=oR(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),gj(o,t),pj(o,t)}function wj(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=Ro(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(wS(u,t,r)),vS(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(wS(l,t,r)),vS(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Ro(n)&&i.push(new(yj())(e._repo,e._path)),{removed:i,events:o}}function aR(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function wo(n,e){let t=null;for(const r of n.views.values())t=t||fj(r,e);return t}function lR(n,e){if(e._queryParams.loadsAllData())return Up(n);{const r=e._queryIdentifier;return n.views.get(r)}}function cR(n,e){return lR(n,e)!=null}function Ro(n){return Up(n)!=null}function Up(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wg;function Ij(n){ee(!Wg,"__referenceConstructor has already been defined"),Wg=n}function xj(){return ee(Wg,"Reference.ts has not been loaded"),Wg}let Ej=1;class xS{constructor(e){this.listenProvider_=e,this.syncPointTree_=new jt(null),this.pendingWriteTree_=XF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ow(n,e,t,r,s){return UF(n.pendingWriteTree_,e,t,r,s),s?Vc(n,new ka(Z0(),e,t)):[]}function Sj(n,e,t,r){$F(n.pendingWriteTree_,e,t,r);const s=jt.fromObject(t);return Vc(n,new ac(Z0(),e,s))}function ro(n,e,t=!1){const r=BF(n.pendingWriteTree_,e);if(zF(n.pendingWriteTree_,e)){let i=new jt(null);return r.snap!=null?i=i.set(_t(),!0):Vn(r.children,o=>{i=i.set(new Et(o),!0)}),Vc(n,new jg(r.path,i,t))}else return[]}function dh(n,e,t){return Vc(n,new ka(ew(),e,t))}function Tj(n,e,t){const r=jt.fromObject(t);return Vc(n,new ac(ew(),e,r))}function bj(n,e){return Vc(n,new Pd(ew(),e))}function Aj(n,e,t){const r=aw(n,t);if(r){const s=lw(r),i=s.path,o=s.queryId,a=cr(i,e),l=new Pd(tw(o),a);return cw(n,i,l)}else return[]}function Gg(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||cR(o,e))){const l=wj(o,e,t,r);_j(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(g=>g._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(g,y)=>Ro(y));if(h&&!f){const g=n.syncPointTree_.subtree(i);if(!g.isEmpty()){const y=kj(g);for(let w=0;w<y.length;++w){const C=y[w],N=C.query,A=fR(n,C);n.listenProvider_.startListening(Hu(N),Dd(n,N),A.hashFn,A.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(Hu(e),null):u.forEach(g=>{const y=n.queryToTagMap.get(Bp(g));n.listenProvider_.stopListening(Hu(g),y)}))}Nj(n,u)}return a}function uR(n,e,t,r){const s=aw(n,r);if(s!=null){const i=lw(s),o=i.path,a=i.queryId,l=cr(o,e),u=new ka(tw(a),l,t);return cw(n,o,u)}else return[]}function Cj(n,e,t,r){const s=aw(n,r);if(s){const i=lw(s),o=i.path,a=i.queryId,l=cr(o,e),u=jt.fromObject(t),h=new ac(tw(a),l,u);return cw(n,o,h)}else return[]}function iv(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(g,y)=>{const w=cr(g,s);i=i||wo(y,w),o=o||Ro(y)});let a=n.syncPointTree_.get(s);a?(o=o||Ro(a),i=i||wo(a,_t())):(a=new iR,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=Pe.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,w)=>{const C=wo(w,_t());C&&(i=i.updateImmediateChild(y,C))}));const u=cR(a,e);if(!u&&!e._queryParams.loadsAllData()){const g=Bp(e);ee(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");const y=Pj();n.queryToTagMap.set(g,y),n.tagToQueryMap.set(y,g)}const h=jp(n.pendingWriteTree_,s);let f=vj(a,e,t,h,i,l);if(!u&&!o&&!r){const g=lR(a,e);f=f.concat(Dj(n,e,g))}return f}function $p(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=cr(o,e),u=wo(a,l);if(u)return u});return Z1(s,e,i,t,!0)}function Rj(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=cr(u,t);r=r||wo(h,f)});let s=n.syncPointTree_.get(t);s?r=r||wo(s,_t()):(s=new iR,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Co(r,!0,!1):null,a=jp(n.pendingWriteTree_,e._path),l=oR(s,e,a,i?o.getNode():Pe.EMPTY_NODE,i);return hj(l)}function Vc(n,e){return dR(e,n.syncPointTree_,null,jp(n.pendingWriteTree_,_t()))}function dR(n,e,t,r){if(Xe(n.path))return hR(n,e,t,r);{const s=e.get(_t());t==null&&s!=null&&(t=wo(s,_t()));let i=[];const o=Je(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=eR(r,o);i=i.concat(dR(a,l,u,h))}return s&&(i=i.concat(iw(s,n,r,t))),i}}function hR(n,e,t,r){const s=e.get(_t());t==null&&s!=null&&(t=wo(s,_t()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=eR(r,o),h=n.operationForChild(o);h&&(i=i.concat(hR(h,a,l,u)))}),s&&(i=i.concat(iw(s,n,r,t))),i}function fR(n,e){const t=e.query,r=Dd(n,t);return{hashFn:()=>(dj(e)||Pe.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?Aj(n,t._path,r):bj(n,t._path);{const i=SV(s,t);return Gg(n,t,null,i)}}}}function Dd(n,e){const t=Bp(e);return n.queryToTagMap.get(t)}function Bp(n){return n._path.toString()+"$"+n._queryIdentifier}function aw(n,e){return n.tagToQueryMap.get(e)}function lw(n){const e=n.indexOf("$");return ee(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Et(n.substr(0,e))}}function cw(n,e,t){const r=n.syncPointTree_.get(e);ee(r,"Missing sync point for query tag that we're tracking");const s=jp(n.pendingWriteTree_,e);return iw(r,t,s,null)}function kj(n){return n.fold((e,t,r)=>{if(t&&Ro(t))return[Up(t)];{let s=[];return t&&(s=aR(t)),Vn(r,(i,o)=>{s=s.concat(o)}),s}})}function Hu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(xj())(n._repo,n._path):n}function Nj(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=Bp(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function Pj(){return Ej++}function Dj(n,e,t){const r=e._path,s=Dd(n,e),i=fR(n,t),o=n.listenProvider_.startListening(Hu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)ee(!Ro(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!Xe(u)&&h&&Ro(h))return[Up(h).query];{let g=[];return h&&(g=g.concat(aR(h).map(y=>y.query))),Vn(f,(y,w)=>{g=g.concat(w)}),g}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(Hu(h),Dd(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new uw(t)}node(){return this.node_}}class dw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Zt(this.path_,e);return new dw(this.syncTree_,t)}node(){return $p(this.syncTree_,this.path_)}}const Lj=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},ES=function(n,e,t){if(!n||typeof n!="object")return n;if(ee(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Mj(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Oj(n[".sv"],e);ee(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Mj=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:ee(!1,"Unexpected server value: "+n)}},Oj=function(n,e,t){n.hasOwnProperty("increment")||ee(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&ee(!1,"Unexpected increment value: "+r);const s=e.node();if(ee(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},gR=function(n,e,t,r){return fw(e,new dw(t,n),r)},hw=function(n,e,t){return fw(n,new uw(e),t)};function fw(n,e,t){const r=n.getPriority().val(),s=ES(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=ES(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Rn(a,rn(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Rn(s))),o.forEachChild($t,(a,l)=>{const u=fw(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function zp(n,e){let t=e instanceof Et?e:new Et(e),r=n,s=Je(t);for(;s!==null;){const i=Ca(r.node.children,s)||{children:{},childCount:0};r=new gw(s,r,i),t=Mt(t),s=Je(t)}return r}function Xa(n){return n.node.value}function pw(n,e){n.node.value=e,ov(n)}function pR(n){return n.node.childCount>0}function Vj(n){return Xa(n)===void 0&&!pR(n)}function qp(n,e){Vn(n.node.children,(t,r)=>{e(new gw(t,n,r))})}function mR(n,e,t,r){t&&!r&&e(n),qp(n,s=>{mR(s,e,!0,r)}),t&&r&&e(n)}function Fj(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function hh(n){return new Et(n.parent===null?n.name:hh(n.parent)+"/"+n.name)}function ov(n){n.parent!==null&&jj(n.parent,n.name,n)}function jj(n,e,t){const r=Vj(t),s=Ss(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,ov(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,ov(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uj=/[\[\].#$\/\u0000-\u001F\u007F]/,$j=/[\[\].#$\u0000-\u001F\u007F]/,Ay=10*1024*1024,Wp=function(n){return typeof n=="string"&&n.length!==0&&!Uj.test(n)},yR=function(n){return typeof n=="string"&&n.length!==0&&!$j.test(n)},Bj=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),yR(n)},Ld=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Mp(n)||n&&typeof n=="object"&&Ss(n,".sv")},Ks=function(n,e,t,r){r&&e===void 0||fh(Ra(n,"value"),e,t)},fh=function(n,e,t){const r=t instanceof Et?new sF(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+na(r));if(typeof e=="function")throw new Error(n+"contains a function "+na(r)+" with contents = "+e.toString());if(Mp(e))throw new Error(n+"contains "+e.toString()+" "+na(r));if(typeof e=="string"&&e.length>Ay/3&&Lp(e)>Ay)throw new Error(n+"contains a string greater than "+Ay+" utf8 bytes "+na(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Vn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Wp(o)))throw new Error(n+" contains an invalid key ("+o+") "+na(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);iF(r,o),fh(n,a,r),oF(r)}),s&&i)throw new Error(n+' contains ".value" child '+na(r)+" in addition to actual children.")}},zj=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Cd(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Wp(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(rF);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&Xr(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},_R=function(n,e,t,r){if(r&&e===void 0)return;const s=Ra(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Vn(e,(o,a)=>{const l=new Et(o);if(fh(s,a,Zt(t,l)),W0(l)===".priority"&&!Ld(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),zj(s,i)},mw=function(n,e,t){if(!(t&&e===void 0)){if(Mp(e))throw new Error(Ra(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ld(e))throw new Error(Ra(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},gh=function(n,e,t,r){if(!(r&&t===void 0)&&!Wp(t))throw new Error(Ra(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},yw=function(n,e,t,r){if(!(r&&t===void 0)&&!yR(t))throw new Error(Ra(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},qj=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),yw(n,e,t,r)},Vs=function(n,e){if(Je(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},vR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Wp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Bj(t))throw new Error(Ra(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Gp(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!G0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function wR(n,e,t){Gp(n,t),IR(n,r=>G0(r,e))}function jr(n,e,t){Gp(n,t),IR(n,r=>Xr(r,e)||Xr(e,r))}function IR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(Gj(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Gj(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();_a&&Dn("event: "+t.toString()),Mc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xR="repo_interrupt",Hj=25;class Qj{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Wj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fg(),this.transactionQueueTree_=new gw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Kj(n,e,t){if(n.stats_=z0(n.repoInfo_),n.forceRestClient_||CV())n.server_=new Vg(n.repoInfo_,(r,s,i,o)=>{SS(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>TS(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{In(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new es(n.repoInfo_,e,(r,s,i,o)=>{SS(n,r,s,i,o)},r=>{TS(n,r)},r=>{Yj(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=DV(n.repoInfo_,()=>new LF(n.stats_,n.server_)),n.infoData_=new RF,n.infoSyncTree_=new xS({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=dh(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),_w(n,"connected",!1),n.serverSyncTree_=new xS({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);jr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function ER(n){const t=n.infoData_.getNode(new Et(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ph(n){return Lj({timestamp:ER(n)})}function SS(n,e,t,r,s){n.dataUpdateCount++;const i=new Et(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=Pg(t,u=>rn(u));o=Cj(n.serverSyncTree_,i,l,s)}else{const l=rn(t);o=uR(n.serverSyncTree_,i,l,s)}else if(r){const l=Pg(t,u=>rn(u));o=Tj(n.serverSyncTree_,i,l)}else{const l=rn(t);o=dh(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=cc(n,i)),jr(n.eventQueue_,a,o)}function TS(n,e){_w(n,"connected",e),e===!1&&Zj(n)}function Yj(n,e){Vn(e,(t,r)=>{_w(n,t,r)})}function _w(n,e,t){const r=new Et("/.info/"+e),s=rn(t);n.infoData_.updateSnapshot(r,s);const i=dh(n.infoSyncTree_,r,s);jr(n.eventQueue_,r,i)}function Hp(n){return n.nextWriteId_++}function Jj(n,e,t){const r=Rj(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=rn(s).withIndex(e._queryParams.getIndex());iv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=dh(n.serverSyncTree_,e._path,i);else{const a=Dd(n.serverSyncTree_,e);o=uR(n.serverSyncTree_,e._path,i,a)}return jr(n.eventQueue_,e._path,o),Gg(n.serverSyncTree_,e,t,null,!0),i},s=>(Fc(n,"get for query "+In(e)+" failed: "+s),Promise.reject(new Error(s))))}function vw(n,e,t,r,s){Fc(n,"set",{path:e.toString(),value:t,priority:r});const i=ph(n),o=rn(t,r),a=$p(n.serverSyncTree_,e),l=hw(o,a,i),u=Hp(n),h=ow(n.serverSyncTree_,e,l,u,!0);Gp(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(g,y)=>{const w=g==="ok";w||sr("set at "+e+" failed: "+g);const C=ro(n.serverSyncTree_,u,!w);jr(n.eventQueue_,e,C),ko(n,s,g,y)});const f=Iw(n,e);cc(n,f),jr(n.eventQueue_,f,[])}function Xj(n,e,t,r){Fc(n,"update",{path:e.toString(),value:t});let s=!0;const i=ph(n),o={};if(Vn(t,(a,l)=>{s=!1,o[a]=gR(Zt(e,a),rn(l),n.serverSyncTree_,i)}),s)Dn("update() called with empty data.  Don't do anything."),ko(n,r,"ok",void 0);else{const a=Hp(n),l=Sj(n.serverSyncTree_,e,o,a);Gp(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||sr("update at "+e+" failed: "+u);const g=ro(n.serverSyncTree_,a,!f),y=g.length>0?cc(n,e):e;jr(n.eventQueue_,y,g),ko(n,r,u,h)}),Vn(t,u=>{const h=Iw(n,Zt(e,u));cc(n,h)}),jr(n.eventQueue_,e,[])}}function Zj(n){Fc(n,"onDisconnectEvents");const e=ph(n),t=Fg();Z_(n.onDisconnect_,_t(),(s,i)=>{const o=gR(s,i,n.serverSyncTree_,e);Oc(t,s,o)});let r=[];Z_(t,_t(),(s,i)=>{r=r.concat(dh(n.serverSyncTree_,s,i));const o=Iw(n,s);cc(n,o)}),n.onDisconnect_=Fg(),jr(n.eventQueue_,_t(),r)}function e4(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&X_(n.onDisconnect_,e),ko(n,t,r,s)})}function bS(n,e,t,r){const s=rn(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Oc(n.onDisconnect_,e,s),ko(n,r,i,o)})}function t4(n,e,t,r,s){const i=rn(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Oc(n.onDisconnect_,e,i),ko(n,s,o,a)})}function n4(n,e,t,r){if(Ng(t)){Dn("onDisconnect().update() called with empty data.  Don't do anything."),ko(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Vn(t,(o,a)=>{const l=rn(a);Oc(n.onDisconnect_,Zt(e,o),l)}),ko(n,r,s,i)})}function r4(n,e,t){let r;Je(e._path)===".info"?r=iv(n.infoSyncTree_,e,t):r=iv(n.serverSyncTree_,e,t),wR(n.eventQueue_,e._path,r)}function av(n,e,t){let r;Je(e._path)===".info"?r=Gg(n.infoSyncTree_,e,t):r=Gg(n.serverSyncTree_,e,t),wR(n.eventQueue_,e._path,r)}function SR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(xR)}function s4(n){n.persistentConnection_&&n.persistentConnection_.resume(xR)}function Fc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Dn(t,...e)}function ko(n,e,t,r){e&&Mc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function i4(n,e,t,r,s,i){Fc(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:v1(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=ww(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{fh("transaction failed: Data returned ",l,o.path),o.status=0;const u=zp(n.transactionQueueTree_,e),h=Xa(u)||[];h.push(o),pw(u,h);let f;typeof l=="object"&&l!==null&&Ss(l,".priority")?(f=Ca(l,".priority"),ee(Ld(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=($p(n.serverSyncTree_,e)||Pe.EMPTY_NODE).getPriority().val();const g=ph(n),y=rn(l,f),w=hw(y,a,g);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=w,o.currentWriteId=Hp(n);const C=ow(n.serverSyncTree_,e,w,o.currentWriteId,o.applyLocally);jr(n.eventQueue_,e,C),Qp(n,n.transactionQueueTree_)}}function ww(n,e,t){return $p(n.serverSyncTree_,e,t)||Pe.EMPTY_NODE}function Qp(n,e=n.transactionQueueTree_){if(e||Kp(n,e),Xa(e)){const t=bR(n,e);ee(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&o4(n,hh(e),t)}else pR(e)&&qp(e,t=>{Qp(n,t)})}function o4(n,e,t){const r=t.map(u=>u.currentWriteId),s=ww(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];ee(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=cr(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Fc(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let g=0;g<t.length;g++)t[g].status=2,h=h.concat(ro(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&f.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Kp(n,zp(n.transactionQueueTree_,e)),Qp(n,n.transactionQueueTree_),jr(n.eventQueue_,e,h);for(let g=0;g<f.length;g++)Mc(f[g])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{sr("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}cc(n,e)}},o)}function cc(n,e){const t=TR(n,e),r=hh(t),s=bR(n,t);return a4(n,s,r),r}function a4(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=cr(t,l.path);let h=!1,f;if(ee(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(ro(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Hj)h=!0,f="maxretry",s=s.concat(ro(n.serverSyncTree_,l.currentWriteId,!0));else{const g=ww(n,l.path,o);l.currentInputSnapshot=g;const y=e[a].update(g.val());if(y!==void 0){fh("transaction failed: Data returned ",y,l.path);let w=rn(y);typeof y=="object"&&y!=null&&Ss(y,".priority")||(w=w.updatePriority(g.getPriority()));const N=l.currentWriteId,A=ph(n),x=hw(w,g,A);l.currentOutputSnapshotRaw=w,l.currentOutputSnapshotResolved=x,l.currentWriteId=Hp(n),o.splice(o.indexOf(N),1),s=s.concat(ow(n.serverSyncTree_,l.path,x,l.currentWriteId,l.applyLocally)),s=s.concat(ro(n.serverSyncTree_,N,!0))}else h=!0,f="nodata",s=s.concat(ro(n.serverSyncTree_,l.currentWriteId,!0))}jr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Kp(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Mc(r[a]);Qp(n,n.transactionQueueTree_)}function TR(n,e){let t,r=n.transactionQueueTree_;for(t=Je(e);t!==null&&Xa(r)===void 0;)r=zp(r,t),e=Mt(e),t=Je(e);return r}function bR(n,e){const t=[];return AR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function AR(n,e,t){const r=Xa(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);qp(e,s=>{AR(n,s,t)})}function Kp(n,e){const t=Xa(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,pw(e,t.length>0?t:void 0)}qp(e,r=>{Kp(n,r)})}function Iw(n,e){const t=hh(TR(n,e)),r=zp(n.transactionQueueTree_,e);return Fj(r,s=>{Cy(n,s)}),Cy(n,r),mR(r,s=>{Cy(n,s)}),t}function Cy(n,e){const t=Xa(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(ee(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(ee(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(ro(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?pw(e,void 0):t.length=i+1,jr(n.eventQueue_,hh(e),s);for(let o=0;o<r.length;o++)Mc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l4(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function c4(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):sr(`Invalid query segment '${t}' in query '${n}'`)}return e}const lv=function(n,e){const t=u4(n),r=t.namespace;t.domain==="firebase.com"&&Qs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Qs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||vV();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new D1(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new Et(t.pathString)}},u4=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=l4(n.substring(h,f)));const g=c4(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const w=e.indexOf(".");r=e.substring(0,w).toLowerCase(),t=e.substring(w+1),i=r}"ns"in g&&(i=g.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",d4=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=AS.charAt(t%64),t=Math.floor(t/64);ee(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=AS.charAt(e[s]);return ee(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+In(this.snapshot.exportVal())}}class RR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return ee(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new kr;return e4(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Vs("OnDisconnect.remove",this._path);const e=new kr;return bS(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Vs("OnDisconnect.set",this._path),Ks("OnDisconnect.set",e,this._path,!1);const t=new kr;return bS(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Vs("OnDisconnect.setWithPriority",this._path),Ks("OnDisconnect.setWithPriority",e,this._path,!1),mw("OnDisconnect.setWithPriority",t,!1);const r=new kr;return t4(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Vs("OnDisconnect.update",this._path),_R("OnDisconnect.update",e,this._path,!1);const t=new kr;return n4(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return Xe(this._path)?null:W0(this._path)}get ref(){return new Ts(this._repo,this._path)}get _queryIdentifier(){const e=hS(this._queryParams),t=$0(e);return t==="{}"?"default":t}get _queryObject(){return hS(this._queryParams)}isEqual(e){if(e=ce(e),!(e instanceof zr))return!1;const t=this._repo===e._repo,r=G0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+nF(this._path)}}function Yp(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function $o(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===zs){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==bo)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Ii)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===$t){if(e!=null&&!Ld(e)||t!=null&&!Ld(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ee(n.getIndex()instanceof K0||n.getIndex()===Y0,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Jp(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Ts extends zr{constructor(e,t){super(e,t,new X0,!1)}get parent(){const e=B1(this._path);return e===null?null:new Ts(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Pa{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Et(e),r=uc(this.ref,e);return new Pa(this._node.getChild(t),r,$t)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Pa(s,uc(this.ref,r),$t)))}hasChild(e){const t=new Et(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ue(n,e){return n=ce(n),n._checkNotDeleted("ref"),e!==void 0?uc(n._root,e):n._root}function Pq(n,e){n=ce(n),n._checkNotDeleted("refFromURL");const t=lv(e,n._repo.repoInfo_.nodeAdmin);vR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Qs("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),ue(n,t.path.toString())}function uc(n,e){return n=ce(n),Je(n._path)===null?qj("child","path",e,!1):yw("child","path",e,!1),new Ts(n._repo,Zt(n._path,e))}function Dq(n){return n=ce(n),new h4(n._repo,n._path)}function f4(n,e){n=ce(n),Vs("push",n._path),Ks("push",e,n._path,!0);const t=ER(n._repo),r=d4(t),s=uc(n,r),i=uc(n,r);let o;return e!=null?o=Ye(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Lq(n){return Vs("remove",n._path),Ye(n,null)}function Ye(n,e){n=ce(n),Vs("set",n._path),Ks("set",e,n._path,!1);const t=new kr;return vw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Mq(n,e){n=ce(n),Vs("setPriority",n._path),mw("setPriority",e,!1);const t=new kr;return vw(n._repo,Zt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Oq(n,e,t){if(Vs("setWithPriority",n._path),Ks("setWithPriority",e,n._path,!1),mw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new kr;return vw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function Vq(n,e){_R("update",e,n._path,!1);const t=new kr;return Xj(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Fe(n){n=ce(n);const e=new xw(()=>{}),t=new mh(e);return Jj(n._repo,n,t).then(r=>new Pa(r,new Ts(n._repo,n._path),n._queryParams.getIndex()))}class mh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new CR("value",this,new Pa(e.snapshotNode,new Ts(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new RR(this,e,t):null}matches(e){return e instanceof mh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Xp{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new RR(this,e,t):null}createEvent(e,t){ee(e.childName!=null,"Child events should have a childName.");const r=uc(new Ts(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new CR(e.type,this,new Pa(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Xp?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function yh(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{av(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new xw(t,i||void 0),a=e==="value"?new mh(o):new Xp(e,o);return r4(n._repo,n,a),()=>av(n._repo,n,a)}function kR(n,e,t,r){return yh(n,"value",e,t,r)}function Fq(n,e,t,r){return yh(n,"child_added",e,t,r)}function jq(n,e,t,r){return yh(n,"child_changed",e,t,r)}function Uq(n,e,t,r){return yh(n,"child_moved",e,t,r)}function $q(n,e,t,r){return yh(n,"child_removed",e,t,r)}function Bq(n,e,t){let r=null;const s=t?new xw(t):null;e==="value"?r=new mh(s):e&&(r=new Xp(e,s)),av(n._repo,n,r)}let bs=class{},NR=class extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Ks("endAt",this._value,e._path,!0);const t=J_(e._queryParams,this._value,this._key);if(Jp(t),$o(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new zr(e._repo,e._path,t,e._orderByCalled)}};function Wq(n,e){return gh("endAt","key",e,!0),new NR(n,e)}class g4 extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Ks("endBefore",this._value,e._path,!1);const t=CF(e._queryParams,this._value,this._key);if(Jp(t),$o(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new zr(e._repo,e._path,t,e._orderByCalled)}}function Gq(n,e){return gh("endBefore","key",e,!0),new g4(n,e)}let PR=class extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Ks("startAt",this._value,e._path,!0);const t=Y_(e._queryParams,this._value,this._key);if(Jp(t),$o(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new zr(e._repo,e._path,t,e._orderByCalled)}};function Qq(n=null,e){return gh("startAt","key",e,!0),new PR(n,e)}class p4 extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Ks("startAfter",this._value,e._path,!1);const t=AF(e._queryParams,this._value,this._key);if(Jp(t),$o(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new zr(e._repo,e._path,t,e._orderByCalled)}}function Kq(n,e){return gh("startAfter","key",e,!0),new p4(n,e)}class m4 extends bs{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new zr(e._repo,e._path,TF(e._queryParams,this._limit),e._orderByCalled)}}function Yq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new m4(n)}class y4 extends bs{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new zr(e._repo,e._path,bF(e._queryParams,this._limit),e._orderByCalled)}}function Jq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new y4(n)}class _4 extends bs{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Yp(e,"orderByChild");const t=new Et(this._path);if(Xe(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new K0(t),s=Vp(e._queryParams,r);return $o(s),new zr(e._repo,e._path,s,!0)}}function Xq(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return yw("orderByChild","path",n,!1),new _4(n)}class v4 extends bs{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Yp(e,"orderByKey");const t=Vp(e._queryParams,zs);return $o(t),new zr(e._repo,e._path,t,!0)}}function Zq(){return new v4}class w4 extends bs{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Yp(e,"orderByPriority");const t=Vp(e._queryParams,$t);return $o(t),new zr(e._repo,e._path,t,!0)}}function e8(){return new w4}class I4 extends bs{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Yp(e,"orderByValue");const t=Vp(e._queryParams,Y0);return $o(t),new zr(e._repo,e._path,t,!0)}}function t8(){return new I4}class x4 extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Ks("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new NR(this._value,this._key)._apply(new PR(this._value,this._key)._apply(e))}}function n8(n,e){return gh("equalTo","key",e,!0),new x4(n,e)}function r8(n,...e){let t=ce(n);for(const r of e)t=r._apply(t);return t}mj(Ts);Ij(Ts);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4="FIREBASE_DATABASE_EMULATOR_HOST",cv={};let DR=!1;function S4(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Ci(i);n.repoInfo_=new D1(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function LR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Qs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Dn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=lv(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[E4]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=lv(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new ql(ql.OWNER):new kV(n.name,n.options,e);vR("Invalid Firebase Database URL",o),Xe(o.path)||Qs("Database URL must point to the root of a Firebase Database (not including a child path).");const f=b4(a,n,h,new RV(n,t));return new C4(f,n)}function T4(n,e){const t=cv[e];(!t||t[n.key]!==n)&&Qs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),SR(n),delete t[n.key]}function b4(n,e,t,r){let s=cv[e.name];s||(s={},cv[e.name]=s);let i=s[n.toURLString()];return i&&Qs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Qj(n,DR,t,r),s[n.toURLString()]=i,i}function A4(n){DR=n}class C4{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Kj(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ts(this._repo,_t())),this._rootInternal}_delete(){return this._rootInternal!==null&&(T4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Qs("Cannot call "+e+" on a deleted database.")}}function MR(){ic.IS_TRANSPORT_INITIALIZED&&sr("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function s8(){MR(),no.forceDisallow()}function i8(){MR(),Yr.forceDisallow(),no.forceAllow()}function R4(n=ah(),e){const t=Js(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=XC("database");r&&k4(t,...r)}return t}function k4(n,e,t,r={}){n=ce(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Fr(r,i.repoInfo_.emulatorOptions))return;Qs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Qs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new ql(ql.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:t1(r.mockUserToken,n.app.options.projectId);o=new ql(a)}Ci(e)&&(Pp(e),O0("Database",!0)),S4(i,s,r,o)}function o8(n){n=ce(n),n._checkNotDeleted("goOffline"),SR(n._repo)}function a8(n){n=ce(n),n._checkNotDeleted("goOnline"),s4(n._repo)}function l8(n,e){I1(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N4(n){y1(Ka),xs(new Sr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return LR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),xr(KE,YE,n),xr(KE,YE,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4={".sv":"timestamp"};function c8(){return P4}function u8(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function d8(n,e,t){if(n=ce(n),Vs("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new kr,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new Pa(u,new Ts(n._repo,n._path),$t),s.resolve(new D4(l,h)))},o=kR(n,()=>{});return i4(n._repo,n._path,e,i,o,r),s.promise}es.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};es.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const h8=function(n){const e=es.prototype.put;return es.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){es.prototype.put=e}},f8=function(n){A4(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g8({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){y1(t);const o=new c1("database-standalone"),a=new $_("auth-internal",o);let l;return s&&(l=new $_("app-check-internal",o),l.setComponent(new Sr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Sr("auth-internal",()=>r,"PRIVATE")),LR(n,a,l,e,i)}N4();var CS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Io,OR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,v){function b(){}b.prototype=v.prototype,T.D=v.prototype,T.prototype=new b,T.prototype.constructor=T,T.C=function(_,I,k){for(var S=Array(arguments.length-2),K=2;K<arguments.length;K++)S[K-2]=arguments[K];return v.prototype[I].apply(_,S)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,v,b){b||(b=0);var _=Array(16);if(typeof v=="string")for(var I=0;16>I;++I)_[I]=v.charCodeAt(b++)|v.charCodeAt(b++)<<8|v.charCodeAt(b++)<<16|v.charCodeAt(b++)<<24;else for(I=0;16>I;++I)_[I]=v[b++]|v[b++]<<8|v[b++]<<16|v[b++]<<24;v=T.g[0],b=T.g[1],I=T.g[2];var k=T.g[3],S=v+(k^b&(I^k))+_[0]+3614090360&4294967295;v=b+(S<<7&4294967295|S>>>25),S=k+(I^v&(b^I))+_[1]+3905402710&4294967295,k=v+(S<<12&4294967295|S>>>20),S=I+(b^k&(v^b))+_[2]+606105819&4294967295,I=k+(S<<17&4294967295|S>>>15),S=b+(v^I&(k^v))+_[3]+3250441966&4294967295,b=I+(S<<22&4294967295|S>>>10),S=v+(k^b&(I^k))+_[4]+4118548399&4294967295,v=b+(S<<7&4294967295|S>>>25),S=k+(I^v&(b^I))+_[5]+1200080426&4294967295,k=v+(S<<12&4294967295|S>>>20),S=I+(b^k&(v^b))+_[6]+2821735955&4294967295,I=k+(S<<17&4294967295|S>>>15),S=b+(v^I&(k^v))+_[7]+4249261313&4294967295,b=I+(S<<22&4294967295|S>>>10),S=v+(k^b&(I^k))+_[8]+1770035416&4294967295,v=b+(S<<7&4294967295|S>>>25),S=k+(I^v&(b^I))+_[9]+2336552879&4294967295,k=v+(S<<12&4294967295|S>>>20),S=I+(b^k&(v^b))+_[10]+4294925233&4294967295,I=k+(S<<17&4294967295|S>>>15),S=b+(v^I&(k^v))+_[11]+2304563134&4294967295,b=I+(S<<22&4294967295|S>>>10),S=v+(k^b&(I^k))+_[12]+1804603682&4294967295,v=b+(S<<7&4294967295|S>>>25),S=k+(I^v&(b^I))+_[13]+4254626195&4294967295,k=v+(S<<12&4294967295|S>>>20),S=I+(b^k&(v^b))+_[14]+2792965006&4294967295,I=k+(S<<17&4294967295|S>>>15),S=b+(v^I&(k^v))+_[15]+1236535329&4294967295,b=I+(S<<22&4294967295|S>>>10),S=v+(I^k&(b^I))+_[1]+4129170786&4294967295,v=b+(S<<5&4294967295|S>>>27),S=k+(b^I&(v^b))+_[6]+3225465664&4294967295,k=v+(S<<9&4294967295|S>>>23),S=I+(v^b&(k^v))+_[11]+643717713&4294967295,I=k+(S<<14&4294967295|S>>>18),S=b+(k^v&(I^k))+_[0]+3921069994&4294967295,b=I+(S<<20&4294967295|S>>>12),S=v+(I^k&(b^I))+_[5]+3593408605&4294967295,v=b+(S<<5&4294967295|S>>>27),S=k+(b^I&(v^b))+_[10]+38016083&4294967295,k=v+(S<<9&4294967295|S>>>23),S=I+(v^b&(k^v))+_[15]+3634488961&4294967295,I=k+(S<<14&4294967295|S>>>18),S=b+(k^v&(I^k))+_[4]+3889429448&4294967295,b=I+(S<<20&4294967295|S>>>12),S=v+(I^k&(b^I))+_[9]+568446438&4294967295,v=b+(S<<5&4294967295|S>>>27),S=k+(b^I&(v^b))+_[14]+3275163606&4294967295,k=v+(S<<9&4294967295|S>>>23),S=I+(v^b&(k^v))+_[3]+4107603335&4294967295,I=k+(S<<14&4294967295|S>>>18),S=b+(k^v&(I^k))+_[8]+1163531501&4294967295,b=I+(S<<20&4294967295|S>>>12),S=v+(I^k&(b^I))+_[13]+2850285829&4294967295,v=b+(S<<5&4294967295|S>>>27),S=k+(b^I&(v^b))+_[2]+4243563512&4294967295,k=v+(S<<9&4294967295|S>>>23),S=I+(v^b&(k^v))+_[7]+1735328473&4294967295,I=k+(S<<14&4294967295|S>>>18),S=b+(k^v&(I^k))+_[12]+2368359562&4294967295,b=I+(S<<20&4294967295|S>>>12),S=v+(b^I^k)+_[5]+4294588738&4294967295,v=b+(S<<4&4294967295|S>>>28),S=k+(v^b^I)+_[8]+2272392833&4294967295,k=v+(S<<11&4294967295|S>>>21),S=I+(k^v^b)+_[11]+1839030562&4294967295,I=k+(S<<16&4294967295|S>>>16),S=b+(I^k^v)+_[14]+4259657740&4294967295,b=I+(S<<23&4294967295|S>>>9),S=v+(b^I^k)+_[1]+2763975236&4294967295,v=b+(S<<4&4294967295|S>>>28),S=k+(v^b^I)+_[4]+1272893353&4294967295,k=v+(S<<11&4294967295|S>>>21),S=I+(k^v^b)+_[7]+4139469664&4294967295,I=k+(S<<16&4294967295|S>>>16),S=b+(I^k^v)+_[10]+3200236656&4294967295,b=I+(S<<23&4294967295|S>>>9),S=v+(b^I^k)+_[13]+681279174&4294967295,v=b+(S<<4&4294967295|S>>>28),S=k+(v^b^I)+_[0]+3936430074&4294967295,k=v+(S<<11&4294967295|S>>>21),S=I+(k^v^b)+_[3]+3572445317&4294967295,I=k+(S<<16&4294967295|S>>>16),S=b+(I^k^v)+_[6]+76029189&4294967295,b=I+(S<<23&4294967295|S>>>9),S=v+(b^I^k)+_[9]+3654602809&4294967295,v=b+(S<<4&4294967295|S>>>28),S=k+(v^b^I)+_[12]+3873151461&4294967295,k=v+(S<<11&4294967295|S>>>21),S=I+(k^v^b)+_[15]+530742520&4294967295,I=k+(S<<16&4294967295|S>>>16),S=b+(I^k^v)+_[2]+3299628645&4294967295,b=I+(S<<23&4294967295|S>>>9),S=v+(I^(b|~k))+_[0]+4096336452&4294967295,v=b+(S<<6&4294967295|S>>>26),S=k+(b^(v|~I))+_[7]+1126891415&4294967295,k=v+(S<<10&4294967295|S>>>22),S=I+(v^(k|~b))+_[14]+2878612391&4294967295,I=k+(S<<15&4294967295|S>>>17),S=b+(k^(I|~v))+_[5]+4237533241&4294967295,b=I+(S<<21&4294967295|S>>>11),S=v+(I^(b|~k))+_[12]+1700485571&4294967295,v=b+(S<<6&4294967295|S>>>26),S=k+(b^(v|~I))+_[3]+2399980690&4294967295,k=v+(S<<10&4294967295|S>>>22),S=I+(v^(k|~b))+_[10]+4293915773&4294967295,I=k+(S<<15&4294967295|S>>>17),S=b+(k^(I|~v))+_[1]+2240044497&4294967295,b=I+(S<<21&4294967295|S>>>11),S=v+(I^(b|~k))+_[8]+1873313359&4294967295,v=b+(S<<6&4294967295|S>>>26),S=k+(b^(v|~I))+_[15]+4264355552&4294967295,k=v+(S<<10&4294967295|S>>>22),S=I+(v^(k|~b))+_[6]+2734768916&4294967295,I=k+(S<<15&4294967295|S>>>17),S=b+(k^(I|~v))+_[13]+1309151649&4294967295,b=I+(S<<21&4294967295|S>>>11),S=v+(I^(b|~k))+_[4]+4149444226&4294967295,v=b+(S<<6&4294967295|S>>>26),S=k+(b^(v|~I))+_[11]+3174756917&4294967295,k=v+(S<<10&4294967295|S>>>22),S=I+(v^(k|~b))+_[2]+718787259&4294967295,I=k+(S<<15&4294967295|S>>>17),S=b+(k^(I|~v))+_[9]+3951481745&4294967295,T.g[0]=T.g[0]+v&4294967295,T.g[1]=T.g[1]+(I+(S<<21&4294967295|S>>>11))&4294967295,T.g[2]=T.g[2]+I&4294967295,T.g[3]=T.g[3]+k&4294967295}r.prototype.u=function(T,v){v===void 0&&(v=T.length);for(var b=v-this.blockSize,_=this.B,I=this.h,k=0;k<v;){if(I==0)for(;k<=b;)s(this,T,k),k+=this.blockSize;if(typeof T=="string"){for(;k<v;)if(_[I++]=T.charCodeAt(k++),I==this.blockSize){s(this,_),I=0;break}}else for(;k<v;)if(_[I++]=T[k++],I==this.blockSize){s(this,_),I=0;break}}this.h=I,this.o+=v},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var v=1;v<T.length-8;++v)T[v]=0;var b=8*this.o;for(v=T.length-8;v<T.length;++v)T[v]=b&255,b/=256;for(this.u(T),T=Array(16),v=b=0;4>v;++v)for(var _=0;32>_;_+=8)T[b++]=this.g[v]>>>_&255;return T};function i(T,v){var b=a;return Object.prototype.hasOwnProperty.call(b,T)?b[T]:b[T]=v(T)}function o(T,v){this.h=v;for(var b=[],_=!0,I=T.length-1;0<=I;I--){var k=T[I]|0;_&&k==v||(b[I]=k,_=!1)}this.g=b}var a={};function l(T){return-128<=T&&128>T?i(T,function(v){return new o([v|0],0>v?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return N(u(-T));for(var v=[],b=1,_=0;T>=b;_++)v[_]=T/b|0,b*=4294967296;return new o(v,0)}function h(T,v){if(T.length==0)throw Error("number format error: empty string");if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(T.charAt(0)=="-")return N(h(T.substring(1),v));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var b=u(Math.pow(v,8)),_=f,I=0;I<T.length;I+=8){var k=Math.min(8,T.length-I),S=parseInt(T.substring(I,I+k),v);8>k?(k=u(Math.pow(v,k)),_=_.j(k).add(u(S))):(_=_.j(b),_=_.add(u(S)))}return _}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(C(this))return-N(this).m();for(var T=0,v=1,b=0;b<this.g.length;b++){var _=this.i(b);T+=(0<=_?_:4294967296+_)*v,v*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(w(this))return"0";if(C(this))return"-"+N(this).toString(T);for(var v=u(Math.pow(T,6)),b=this,_="";;){var I=D(b,v).g;b=A(b,I.j(v));var k=((0<b.g.length?b.g[0]:b.h)>>>0).toString(T);if(b=I,w(b))return k+_;for(;6>k.length;)k="0"+k;_=k+_}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function w(T){if(T.h!=0)return!1;for(var v=0;v<T.g.length;v++)if(T.g[v]!=0)return!1;return!0}function C(T){return T.h==-1}n.l=function(T){return T=A(this,T),C(T)?-1:w(T)?0:1};function N(T){for(var v=T.g.length,b=[],_=0;_<v;_++)b[_]=~T.g[_];return new o(b,~T.h).add(g)}n.abs=function(){return C(this)?N(this):this},n.add=function(T){for(var v=Math.max(this.g.length,T.g.length),b=[],_=0,I=0;I<=v;I++){var k=_+(this.i(I)&65535)+(T.i(I)&65535),S=(k>>>16)+(this.i(I)>>>16)+(T.i(I)>>>16);_=S>>>16,k&=65535,S&=65535,b[I]=S<<16|k}return new o(b,b[b.length-1]&-2147483648?-1:0)};function A(T,v){return T.add(N(v))}n.j=function(T){if(w(this)||w(T))return f;if(C(this))return C(T)?N(this).j(N(T)):N(N(this).j(T));if(C(T))return N(this.j(N(T)));if(0>this.l(y)&&0>T.l(y))return u(this.m()*T.m());for(var v=this.g.length+T.g.length,b=[],_=0;_<2*v;_++)b[_]=0;for(_=0;_<this.g.length;_++)for(var I=0;I<T.g.length;I++){var k=this.i(_)>>>16,S=this.i(_)&65535,K=T.i(I)>>>16,vt=T.i(I)&65535;b[2*_+2*I]+=S*vt,x(b,2*_+2*I),b[2*_+2*I+1]+=k*vt,x(b,2*_+2*I+1),b[2*_+2*I+1]+=S*K,x(b,2*_+2*I+1),b[2*_+2*I+2]+=k*K,x(b,2*_+2*I+2)}for(_=0;_<v;_++)b[_]=b[2*_+1]<<16|b[2*_];for(_=v;_<2*v;_++)b[_]=0;return new o(b,0)};function x(T,v){for(;(T[v]&65535)!=T[v];)T[v+1]+=T[v]>>>16,T[v]&=65535,v++}function R(T,v){this.g=T,this.h=v}function D(T,v){if(w(v))throw Error("division by zero");if(w(T))return new R(f,f);if(C(T))return v=D(N(T),v),new R(N(v.g),N(v.h));if(C(v))return v=D(T,N(v)),new R(N(v.g),v.h);if(30<T.g.length){if(C(T)||C(v))throw Error("slowDivide_ only works with positive integers.");for(var b=g,_=v;0>=_.l(T);)b=U(b),_=U(_);var I=P(b,1),k=P(_,1);for(_=P(_,2),b=P(b,2);!w(_);){var S=k.add(_);0>=S.l(T)&&(I=I.add(b),k=S),_=P(_,1),b=P(b,1)}return v=A(T,I.j(v)),new R(I,v)}for(I=f;0<=T.l(v);){for(b=Math.max(1,Math.floor(T.m()/v.m())),_=Math.ceil(Math.log(b)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),k=u(b),S=k.j(v);C(S)||0<S.l(T);)b-=_,k=u(b),S=k.j(v);w(k)&&(k=g),I=I.add(k),T=A(T,S)}return new R(I,T)}n.A=function(T){return D(this,T).h},n.and=function(T){for(var v=Math.max(this.g.length,T.g.length),b=[],_=0;_<v;_++)b[_]=this.i(_)&T.i(_);return new o(b,this.h&T.h)},n.or=function(T){for(var v=Math.max(this.g.length,T.g.length),b=[],_=0;_<v;_++)b[_]=this.i(_)|T.i(_);return new o(b,this.h|T.h)},n.xor=function(T){for(var v=Math.max(this.g.length,T.g.length),b=[],_=0;_<v;_++)b[_]=this.i(_)^T.i(_);return new o(b,this.h^T.h)};function U(T){for(var v=T.g.length+1,b=[],_=0;_<v;_++)b[_]=T.i(_)<<1|T.i(_-1)>>>31;return new o(b,T.h)}function P(T,v){var b=v>>5;v%=32;for(var _=T.g.length-b,I=[],k=0;k<_;k++)I[k]=0<v?T.i(k+b)>>>v|T.i(k+b+1)<<32-v:T.i(k+b);return new o(I,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,OR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Io=o}).apply(typeof CS<"u"?CS:typeof self<"u"?self:typeof window<"u"?window:{});var pf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var VR,Ru,FR,Bf,uv,jR,UR,$R;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,p,m){return c==Array.prototype||c==Object.prototype||(c[p]=m.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof pf=="object"&&pf];for(var p=0;p<c.length;++p){var m=c[p];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function s(c,p){if(p)e:{var m=r;c=c.split(".");for(var E=0;E<c.length-1;E++){var M=c[E];if(!(M in m))break e;m=m[M]}c=c[c.length-1],E=m[c],p=p(E),p!=E&&p!=null&&e(m,c,{configurable:!0,writable:!0,value:p})}}function i(c,p){c instanceof String&&(c+="");var m=0,E=!1,M={next:function(){if(!E&&m<c.length){var $=m++;return{value:p($,c[$]),done:!1}}return E=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}s("Array.prototype.values",function(c){return c||function(){return i(this,function(p,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var p=typeof c;return p=p!="object"?p:c?Array.isArray(c)?"array":p:"null",p=="array"||p=="object"&&typeof c.length=="number"}function u(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function h(c,p,m){return c.call.apply(c.bind,arguments)}function f(c,p,m){if(!c)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,E),c.apply(p,M)}}return function(){return c.apply(p,arguments)}}function g(c,p,m){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function y(c,p){var m=Array.prototype.slice.call(arguments,1);return function(){var E=m.slice();return E.push.apply(E,arguments),c.apply(this,E)}}function w(c,p){function m(){}m.prototype=p.prototype,c.aa=p.prototype,c.prototype=new m,c.prototype.constructor=c,c.Qb=function(E,M,$){for(var oe=Array(arguments.length-2),Lt=2;Lt<arguments.length;Lt++)oe[Lt-2]=arguments[Lt];return p.prototype[M].apply(E,oe)}}function C(c){const p=c.length;if(0<p){const m=Array(p);for(let E=0;E<p;E++)m[E]=c[E];return m}return[]}function N(c,p){for(let m=1;m<arguments.length;m++){const E=arguments[m];if(l(E)){const M=c.length||0,$=E.length||0;c.length=M+$;for(let oe=0;oe<$;oe++)c[M+oe]=E[oe]}else c.push(E)}}class A{constructor(p,m){this.i=p,this.j=m,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function x(c){return/^[\s\xa0]*$/.test(c)}function R(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function D(c){return D[" "](c),c}D[" "]=function(){};var U=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function P(c,p,m){for(const E in c)p.call(m,c[E],E,c)}function T(c,p){for(const m in c)p.call(void 0,c[m],m,c)}function v(c){const p={};for(const m in c)p[m]=c[m];return p}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(c,p){let m,E;for(let M=1;M<arguments.length;M++){E=arguments[M];for(m in E)c[m]=E[m];for(let $=0;$<b.length;$++)m=b[$],Object.prototype.hasOwnProperty.call(E,m)&&(c[m]=E[m])}}function I(c){var p=1;c=c.split(":");const m=[];for(;0<p&&c.length;)m.push(c.shift()),p--;return c.length&&m.push(c.join(":")),m}function k(c){a.setTimeout(()=>{throw c},0)}function S(){var c=pe;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class K{constructor(){this.h=this.g=null}add(p,m){const E=vt.get();E.set(p,m),this.h?this.h.next=E:this.g=E,this.h=E}}var vt=new A(()=>new Ve,c=>c.reset());class Ve{constructor(){this.next=this.g=this.h=null}set(p,m){this.h=p,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let ln,te=!1,pe=new K,L=()=>{const c=a.Promise.resolve(void 0);ln=()=>{c.then(B)}};var B=()=>{for(var c;c=S();){try{c.h.call(c.g)}catch(m){k(m)}var p=vt;p.j(c),100>p.h&&(p.h++,c.next=p.g,p.g=c)}te=!1};function Y(){this.s=this.s,this.C=this.C}Y.prototype.s=!1,Y.prototype.ma=function(){this.s||(this.s=!0,this.N())},Y.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function X(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}X.prototype.h=function(){this.defaultPrevented=!0};var he=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};a.addEventListener("test",m,p),a.removeEventListener("test",m,p)}catch{}return c}();function Ae(c,p){if(X.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var m=this.type=c.type,E=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget){if(U){e:{try{D(p.nodeName);var M=!0;break e}catch{}M=!1}M||(p=null)}}else m=="mouseover"?p=c.fromElement:m=="mouseout"&&(p=c.toElement);this.relatedTarget=p,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:ye[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&Ae.aa.h.call(this)}}w(Ae,X);var ye={2:"touch",3:"pen",4:"mouse"};Ae.prototype.h=function(){Ae.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Le="closure_listenable_"+(1e6*Math.random()|0),Ie=0;function re(c,p,m,E,M){this.listener=c,this.proxy=null,this.src=p,this.type=m,this.capture=!!E,this.ha=M,this.key=++Ie,this.da=this.fa=!1}function ne(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function le(c){this.src=c,this.g={},this.h=0}le.prototype.add=function(c,p,m,E,M){var $=c.toString();c=this.g[$],c||(c=this.g[$]=[],this.h++);var oe=ge(c,p,E,M);return-1<oe?(p=c[oe],m||(p.fa=!1)):(p=new re(p,this.src,$,!!E,M),p.fa=m,c.push(p)),p};function _e(c,p){var m=p.type;if(m in c.g){var E=c.g[m],M=Array.prototype.indexOf.call(E,p,void 0),$;($=0<=M)&&Array.prototype.splice.call(E,M,1),$&&(ne(p),c.g[m].length==0&&(delete c.g[m],c.h--))}}function ge(c,p,m,E){for(var M=0;M<c.length;++M){var $=c[M];if(!$.da&&$.listener==p&&$.capture==!!m&&$.ha==E)return M}return-1}var z="closure_lm_"+(1e6*Math.random()|0),Se={};function Me(c,p,m,E,M){if(E&&E.once)return be(c,p,m,E,M);if(Array.isArray(p)){for(var $=0;$<p.length;$++)Me(c,p[$],m,E,M);return null}return m=Ke(m),c&&c[Le]?c.K(p,m,u(E)?!!E.capture:!!E,M):nt(c,p,m,!1,E,M)}function nt(c,p,m,E,M,$){if(!p)throw Error("Invalid event type");var oe=u(M)?!!M.capture:!!M,Lt=Rt(c);if(Lt||(c[z]=Lt=new le(c)),m=Lt.add(p,m,E,oe,$),m.proxy)return m;if(E=ve(),m.proxy=E,E.src=c,E.listener=m,c.addEventListener)he||(M=oe),M===void 0&&(M=!1),c.addEventListener(p.toString(),E,M);else if(c.attachEvent)c.attachEvent(gt(p.toString()),E);else if(c.addListener&&c.removeListener)c.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return m}function ve(){function c(m){return p.call(c.src,c.listener,m)}const p=St;return c}function be(c,p,m,E,M){if(Array.isArray(p)){for(var $=0;$<p.length;$++)be(c,p[$],m,E,M);return null}return m=Ke(m),c&&c[Le]?c.L(p,m,u(E)?!!E.capture:!!E,M):nt(c,p,m,!0,E,M)}function qe(c,p,m,E,M){if(Array.isArray(p))for(var $=0;$<p.length;$++)qe(c,p[$],m,E,M);else E=u(E)?!!E.capture:!!E,m=Ke(m),c&&c[Le]?(c=c.i,p=String(p).toString(),p in c.g&&($=c.g[p],m=ge($,m,E,M),-1<m&&(ne($[m]),Array.prototype.splice.call($,m,1),$.length==0&&(delete c.g[p],c.h--)))):c&&(c=Rt(c))&&(p=c.g[p.toString()],c=-1,p&&(c=ge(p,m,E,M)),(m=-1<c?p[c]:null)&&Ct(m))}function Ct(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[Le])_e(p.i,c);else{var m=c.type,E=c.proxy;p.removeEventListener?p.removeEventListener(m,E,c.capture):p.detachEvent?p.detachEvent(gt(m),E):p.addListener&&p.removeListener&&p.removeListener(E),(m=Rt(p))?(_e(m,c),m.h==0&&(m.src=null,p[z]=null)):ne(c)}}}function gt(c){return c in Se?Se[c]:Se[c]="on"+c}function St(c,p){if(c.da)c=!0;else{p=new Ae(p,this);var m=c.listener,E=c.ha||c.src;c.fa&&Ct(c),c=m.call(E,p)}return c}function Rt(c){return c=c[z],c instanceof le?c:null}var Qe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ke(c){return typeof c=="function"?c:(c[Qe]||(c[Qe]=function(p){return c.handleEvent(p)}),c[Qe])}function xe(){Y.call(this),this.i=new le(this),this.M=this,this.F=null}w(xe,Y),xe.prototype[Le]=!0,xe.prototype.removeEventListener=function(c,p,m,E){qe(this,c,p,m,E)};function at(c,p){var m,E=c.F;if(E)for(m=[];E;E=E.F)m.push(E);if(c=c.M,E=p.type||p,typeof p=="string")p=new X(p,c);else if(p instanceof X)p.target=p.target||c;else{var M=p;p=new X(E,c),_(p,M)}if(M=!0,m)for(var $=m.length-1;0<=$;$--){var oe=p.g=m[$];M=kt(oe,E,!0,p)&&M}if(oe=p.g=c,M=kt(oe,E,!0,p)&&M,M=kt(oe,E,!1,p)&&M,m)for($=0;$<m.length;$++)oe=p.g=m[$],M=kt(oe,E,!1,p)&&M}xe.prototype.N=function(){if(xe.aa.N.call(this),this.i){var c=this.i,p;for(p in c.g){for(var m=c.g[p],E=0;E<m.length;E++)ne(m[E]);delete c.g[p],c.h--}}this.F=null},xe.prototype.K=function(c,p,m,E){return this.i.add(String(c),p,!1,m,E)},xe.prototype.L=function(c,p,m,E){return this.i.add(String(c),p,!0,m,E)};function kt(c,p,m,E){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();for(var M=!0,$=0;$<p.length;++$){var oe=p[$];if(oe&&!oe.da&&oe.capture==m){var Lt=oe.listener,Bn=oe.ha||oe.src;oe.fa&&_e(c.i,oe),M=Lt.call(Bn,E)!==!1&&M}}return M&&!E.defaultPrevented}function Vt(c,p,m){if(typeof c=="function")m&&(c=g(c,m));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(c,p||0)}function Ft(c){c.g=Vt(()=>{c.g=null,c.i&&(c.i=!1,Ft(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class Tn extends Y{constructor(p,m){super(),this.m=p,this.l=m,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Ft(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function bn(c){Y.call(this),this.h=c,this.g={}}w(bn,Y);var jn=[];function wt(c){P(c.g,function(p,m){this.g.hasOwnProperty(m)&&Ct(p)},c),c.g={}}bn.prototype.N=function(){bn.aa.N.call(this),wt(this)},bn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xt=a.JSON.stringify,qr=a.JSON.parse,Wr=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function ct(){}ct.prototype.h=null;function dt(c){return c.h||(c.h=c.i())}function Kn(){}var Un={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function is(){X.call(this,"d")}w(is,X);function As(){X.call(this,"c")}w(As,X);var os={},Mi=null;function al(){return Mi=Mi||new xe}os.La="serverreachability";function F(c){X.call(this,os.La,c)}w(F,X);function G(c){const p=al();at(p,new F(p))}os.STAT_EVENT="statevent";function W(c,p){X.call(this,os.STAT_EVENT,c),this.stat=p}w(W,X);function ae(c){const p=al();at(p,new W(p,c))}os.Ma="timingevent";function ke(c,p){X.call(this,os.Ma,c),this.size=p}w(ke,X);function We(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},p)}function Ee(){this.g=!0}Ee.prototype.xa=function(){this.g=!1};function je(c,p,m,E,M,$){c.info(function(){if(c.g)if($)for(var oe="",Lt=$.split("&"),Bn=0;Bn<Lt.length;Bn++){var mt=Lt[Bn].split("=");if(1<mt.length){var Jn=mt[0];mt=mt[1];var Xn=Jn.split("_");oe=2<=Xn.length&&Xn[1]=="type"?oe+(Jn+"="+mt+"&"):oe+(Jn+"=redacted&")}}else oe=null;else oe=$;return"XMLHTTP REQ ("+E+") [attempt "+M+"]: "+p+`
`+m+`
`+oe})}function Ue(c,p,m,E,M,$,oe){c.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+M+"]: "+p+`
`+m+`
`+$+" "+oe})}function ht(c,p,m,E){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+$e(c,m)+(E?" "+E:"")})}function Ge(c,p){c.info(function(){return"TIMEOUT: "+p})}Ee.prototype.info=function(){};function $e(c,p){if(!c.g)return p;if(!p)return null;try{var m=JSON.parse(p);if(m){for(c=0;c<m.length;c++)if(Array.isArray(m[c])){var E=m[c];if(!(2>E.length)){var M=E[1];if(Array.isArray(M)&&!(1>M.length)){var $=M[0];if($!="noop"&&$!="stop"&&$!="close")for(var oe=1;oe<M.length;oe++)M[oe]=""}}}}return xt(m)}catch{return p}}var He={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Oe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Re;function Te(){}w(Te,ct),Te.prototype.g=function(){return new XMLHttpRequest},Te.prototype.i=function(){return{}},Re=new Te;function Ne(c,p,m,E){this.j=c,this.i=p,this.l=m,this.R=E||1,this.U=new bn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new An}function An(){this.i=null,this.g="",this.h=!1}var pt={},It={};function Ze(c,p,m){c.L=1,c.v=Uh(ti(p)),c.m=m,c.P=!0,Yn(c,null)}function Yn(c,p){c.F=Date.now(),Oi(c),c.A=ti(c.v);var m=c.A,E=c.R;Array.isArray(E)||(E=[String(E)]),ox(m.i,"t",E),c.C=0,m=c.j.J,c.h=new An,c.g=Sx(c.j,m?p:null,!c.m),0<c.O&&(c.M=new Tn(g(c.Y,c,c.g),c.O)),p=c.U,m=c.g,E=c.ca;var M="readystatechange";Array.isArray(M)||(M&&(jn[0]=M.toString()),M=jn);for(var $=0;$<M.length;$++){var oe=Me(m,M[$],E||p.handleEvent,!1,p.h||p);if(!oe)break;p.g[oe.key]=oe}p=c.H?v(c.H):{},c.m?(c.u||(c.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,p)):(c.u="GET",c.g.ea(c.A,c.u,null,p)),G(),je(c.i,c.u,c.A,c.l,c.R,c.m)}Ne.prototype.ca=function(c){c=c.target;const p=this.M;p&&ni(c)==3?p.j():this.Y(c)},Ne.prototype.Y=function(c){try{if(c==this.g)e:{const Xn=ni(this.g);var p=this.g.Ba();const ul=this.g.Z();if(!(3>Xn)&&(Xn!=3||this.g&&(this.h.h||this.g.oa()||fx(this.g)))){this.J||Xn!=4||p==7||(p==8||0>=ul?G(3):G(2)),Be(this);var m=this.g.Z();this.X=m;t:if(as(this)){var E=fx(this.g);c="";var M=E.length,$=ni(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Pt(this),lt(this);var oe="";break t}this.h.i=new a.TextDecoder}for(p=0;p<M;p++)this.h.h=!0,c+=this.h.i.decode(E[p],{stream:!($&&p==M-1)});E.length=0,this.h.g+=c,this.C=0,oe=this.h.g}else oe=this.g.oa();if(this.o=m==200,Ue(this.i,this.u,this.A,this.l,this.R,Xn,m),this.o){if(this.T&&!this.K){t:{if(this.g){var Lt,Bn=this.g;if((Lt=Bn.g?Bn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Lt)){var mt=Lt;break t}}mt=null}if(m=mt)ht(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zt(this,m);else{this.o=!1,this.s=3,ae(12),Pt(this),lt(this);break e}}if(this.P){m=!0;let ls;for(;!this.J&&this.C<oe.length;)if(ls=Xs(this,oe),ls==It){Xn==4&&(this.s=4,ae(14),m=!1),ht(this.i,this.l,null,"[Incomplete Response]");break}else if(ls==pt){this.s=4,ae(15),ht(this.i,this.l,oe,"[Invalid Chunk]"),m=!1;break}else ht(this.i,this.l,ls,null),zt(this,ls);if(as(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xn!=4||oe.length!=0||this.h.h||(this.s=1,ae(16),m=!1),this.o=this.o&&m,!m)ht(this.i,this.l,oe,"[Invalid Chunked Response]"),Pt(this),lt(this);else if(0<oe.length&&!this.W){this.W=!0;var Jn=this.j;Jn.g==this&&Jn.ba&&!Jn.M&&(Jn.j.info("Great, no buffering proxy detected. Bytes received: "+oe.length),zm(Jn),Jn.M=!0,ae(11))}}else ht(this.i,this.l,oe,null),zt(this,oe);Xn==4&&Pt(this),this.o&&!this.J&&(Xn==4?wx(this.j,this):(this.o=!1,Oi(this)))}else s2(this.g),m==400&&0<oe.indexOf("Unknown SID")?(this.s=3,ae(12)):(this.s=0,ae(13)),Pt(this),lt(this)}}}catch{}finally{}};function as(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function Xs(c,p){var m=c.C,E=p.indexOf(`
`,m);return E==-1?It:(m=Number(p.substring(m,E)),isNaN(m)?pt:(E+=1,E+m>p.length?It:(p=p.slice(E,E+m),c.C=E+m,p)))}Ne.prototype.cancel=function(){this.J=!0,Pt(this)};function Oi(c){c.S=Date.now()+c.I,$n(c,c.I)}function $n(c,p){if(c.B!=null)throw Error("WatchDog timer not null");c.B=We(g(c.ba,c),p)}function Be(c){c.B&&(a.clearTimeout(c.B),c.B=null)}Ne.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(Ge(this.i,this.A),this.L!=2&&(G(),ae(17)),Pt(this),this.s=2,lt(this)):$n(this,this.S-c)};function lt(c){c.j.G==0||c.J||wx(c.j,c)}function Pt(c){Be(c);var p=c.M;p&&typeof p.ma=="function"&&p.ma(),c.M=null,wt(c.U),c.g&&(p=c.g,c.g=null,p.abort(),p.ma())}function zt(c,p){try{var m=c.j;if(m.G!=0&&(m.g==c||Cn(m.h,c))){if(!c.K&&Cn(m.h,c)&&m.G==3){try{var E=m.Da.g.parse(p)}catch{E=null}if(Array.isArray(E)&&E.length==3){var M=E;if(M[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<c.F)Gh(m),qh(m);else break e;Bm(m),ae(18)}}else m.za=M[1],0<m.za-m.T&&37500>M[2]&&m.F&&m.v==0&&!m.C&&(m.C=We(g(m.Za,m),6e3));if(1>=ei(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Jo(m,11)}else if((c.K||m.g==c)&&Gh(m),!x(p))for(M=m.Da.g.parse(p),p=0;p<M.length;p++){let mt=M[p];if(m.T=mt[0],mt=mt[1],m.G==2)if(mt[0]=="c"){m.K=mt[1],m.ia=mt[2];const Jn=mt[3];Jn!=null&&(m.la=Jn,m.j.info("VER="+m.la));const Xn=mt[4];Xn!=null&&(m.Aa=Xn,m.j.info("SVER="+m.Aa));const ul=mt[5];ul!=null&&typeof ul=="number"&&0<ul&&(E=1.5*ul,m.L=E,m.j.info("backChannelRequestTimeoutMs_="+E)),E=m;const ls=c.g;if(ls){const Qh=ls.g?ls.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Qh){var $=E.h;$.g||Qh.indexOf("spdy")==-1&&Qh.indexOf("quic")==-1&&Qh.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(Dt($,$.h),$.h=null))}if(E.D){const qm=ls.g?ls.g.getResponseHeader("X-HTTP-Session-Id"):null;qm&&(E.ya=qm,qt(E.I,E.D,qm))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-c.F,m.j.info("Handshake RTT: "+m.R+"ms")),E=m;var oe=c;if(E.qa=Ex(E,E.J?E.ia:null,E.W),oe.K){Cs(E.h,oe);var Lt=oe,Bn=E.L;Bn&&(Lt.I=Bn),Lt.B&&(Be(Lt),Oi(Lt)),E.g=oe}else _x(E);0<m.i.length&&Wh(m)}else mt[0]!="stop"&&mt[0]!="close"||Jo(m,7);else m.G==3&&(mt[0]=="stop"||mt[0]=="close"?mt[0]=="stop"?Jo(m,7):$m(m):mt[0]!="noop"&&m.l&&m.l.ta(mt),m.v=0)}}G(4)}catch{}}var Gr=class{constructor(c,p){this.g=c,this.map=p}};function Vi(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Zs(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function ei(c){return c.h?1:c.g?c.g.size:0}function Cn(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function Dt(c,p){c.g?c.g.add(p):c.h=p}function Cs(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}Vi.prototype.cancel=function(){if(this.i=Qo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Qo(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const m of c.g.values())p=p.concat(m.D);return p}return C(c.i)}function jm(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var p=[],m=c.length,E=0;E<m;E++)p.push(c[E]);return p}p=[],m=0;for(E in c)p[m++]=c[E];return p}function Ko(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var p=[];c=c.length;for(var m=0;m<c;m++)p.push(m);return p}p=[],m=0;for(const E in c)p[m++]=E;return p}}}function ex(c,p){if(c.forEach&&typeof c.forEach=="function")c.forEach(p,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,p,void 0);else for(var m=Ko(c),E=jm(c),M=E.length,$=0;$<M;$++)p.call(void 0,E[$],m&&m[$],c)}var tx=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function WD(c,p){if(c){c=c.split("&");for(var m=0;m<c.length;m++){var E=c[m].indexOf("="),M=null;if(0<=E){var $=c[m].substring(0,E);M=c[m].substring(E+1)}else $=c[m];p($,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function Yo(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Yo){this.h=c.h,Fh(this,c.j),this.o=c.o,this.g=c.g,jh(this,c.s),this.l=c.l;var p=c.i,m=new Zc;m.i=p.i,p.g&&(m.g=new Map(p.g),m.h=p.h),nx(this,m),this.m=c.m}else c&&(p=String(c).match(tx))?(this.h=!1,Fh(this,p[1]||"",!0),this.o=Jc(p[2]||""),this.g=Jc(p[3]||"",!0),jh(this,p[4]),this.l=Jc(p[5]||"",!0),nx(this,p[6]||"",!0),this.m=Jc(p[7]||"")):(this.h=!1,this.i=new Zc(null,this.h))}Yo.prototype.toString=function(){var c=[],p=this.j;p&&c.push(Xc(p,rx,!0),":");var m=this.g;return(m||p=="file")&&(c.push("//"),(p=this.o)&&c.push(Xc(p,rx,!0),"@"),c.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&c.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(Xc(m,m.charAt(0)=="/"?QD:HD,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",Xc(m,YD)),c.join("")};function ti(c){return new Yo(c)}function Fh(c,p,m){c.j=m?Jc(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function jh(c,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);c.s=p}else c.s=null}function nx(c,p,m){p instanceof Zc?(c.i=p,JD(c.i,c.h)):(m||(p=Xc(p,KD)),c.i=new Zc(p,c.h))}function qt(c,p,m){c.i.set(p,m)}function Uh(c){return qt(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Jc(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Xc(c,p,m){return typeof c=="string"?(c=encodeURI(c).replace(p,GD),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function GD(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var rx=/[#\/\?@]/g,HD=/[#\?:]/g,QD=/[#\?]/g,KD=/[#\?@]/g,YD=/#/g;function Zc(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function Fi(c){c.g||(c.g=new Map,c.h=0,c.i&&WD(c.i,function(p,m){c.add(decodeURIComponent(p.replace(/\+/g," ")),m)}))}n=Zc.prototype,n.add=function(c,p){Fi(this),this.i=null,c=ll(this,c);var m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(p),this.h+=1,this};function sx(c,p){Fi(c),p=ll(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function ix(c,p){return Fi(c),p=ll(c,p),c.g.has(p)}n.forEach=function(c,p){Fi(this),this.g.forEach(function(m,E){m.forEach(function(M){c.call(p,M,E,this)},this)},this)},n.na=function(){Fi(this);const c=Array.from(this.g.values()),p=Array.from(this.g.keys()),m=[];for(let E=0;E<p.length;E++){const M=c[E];for(let $=0;$<M.length;$++)m.push(p[E])}return m},n.V=function(c){Fi(this);let p=[];if(typeof c=="string")ix(this,c)&&(p=p.concat(this.g.get(ll(this,c))));else{c=Array.from(this.g.values());for(let m=0;m<c.length;m++)p=p.concat(c[m])}return p},n.set=function(c,p){return Fi(this),this.i=null,c=ll(this,c),ix(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},n.get=function(c,p){return c?(c=this.V(c),0<c.length?String(c[0]):p):p};function ox(c,p,m){sx(c,p),0<m.length&&(c.i=null,c.g.set(ll(c,p),C(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(var m=0;m<p.length;m++){var E=p[m];const $=encodeURIComponent(String(E)),oe=this.V(E);for(E=0;E<oe.length;E++){var M=$;oe[E]!==""&&(M+="="+encodeURIComponent(String(oe[E]))),c.push(M)}}return this.i=c.join("&")};function ll(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function JD(c,p){p&&!c.j&&(Fi(c),c.i=null,c.g.forEach(function(m,E){var M=E.toLowerCase();E!=M&&(sx(this,E),ox(this,M,m))},c)),c.j=p}function XD(c,p){const m=new Ee;if(a.Image){const E=new Image;E.onload=y(ji,m,"TestLoadImage: loaded",!0,p,E),E.onerror=y(ji,m,"TestLoadImage: error",!1,p,E),E.onabort=y(ji,m,"TestLoadImage: abort",!1,p,E),E.ontimeout=y(ji,m,"TestLoadImage: timeout",!1,p,E),a.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=c}else p(!1)}function ZD(c,p){const m=new Ee,E=new AbortController,M=setTimeout(()=>{E.abort(),ji(m,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:E.signal}).then($=>{clearTimeout(M),$.ok?ji(m,"TestPingServer: ok",!0,p):ji(m,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(M),ji(m,"TestPingServer: error",!1,p)})}function ji(c,p,m,E,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),E(m)}catch{}}function e2(){this.g=new Wr}function t2(c,p,m){const E=m||"";try{ex(c,function(M,$){let oe=M;u(M)&&(oe=xt(M)),p.push(E+$+"="+encodeURIComponent(oe))})}catch(M){throw p.push(E+"type="+encodeURIComponent("_badmap")),M}}function $h(c){this.l=c.Ub||null,this.j=c.eb||!1}w($h,ct),$h.prototype.g=function(){return new Bh(this.l,this.j)},$h.prototype.i=function(c){return function(){return c}}({});function Bh(c,p){xe.call(this),this.D=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(Bh,xe),n=Bh.prototype,n.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=p,this.readyState=1,tu(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(p.body=c),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,eu(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,tu(this)),this.g&&(this.readyState=3,tu(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ax(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function ax(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?eu(this):tu(this),this.readyState==3&&ax(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,eu(this))},n.Qa=function(c){this.g&&(this.response=c,eu(this))},n.ga=function(){this.g&&eu(this)};function eu(c){c.readyState=4,c.l=null,c.j=null,c.v=null,tu(c)}n.setRequestHeader=function(c,p){this.u.append(c,p)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var m=p.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=p.next();return c.join(`\r
`)};function tu(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Bh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function lx(c){let p="";return P(c,function(m,E){p+=E,p+=":",p+=m,p+=`\r
`}),p}function Um(c,p,m){e:{for(E in m){var E=!1;break e}E=!0}E||(m=lx(m),typeof c=="string"?m!=null&&encodeURIComponent(String(m)):qt(c,p,m))}function cn(c){xe.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(cn,xe);var n2=/^https?$/i,r2=["POST","PUT"];n=cn.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,p,m,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Re.g(),this.v=this.o?dt(this.o):dt(Re),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch($){cx(this,$);return}if(c=m||"",m=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var M in E)m.set(M,E[M]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const $ of E.keys())m.set($,E.get($));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(m.keys()).find($=>$.toLowerCase()=="content-type"),M=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(r2,p,void 0))||E||M||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,oe]of m)this.g.setRequestHeader($,oe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{hx(this),this.u=!0,this.g.send(c),this.u=!1}catch($){cx(this,$)}};function cx(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.m=5,ux(c),zh(c)}function ux(c){c.A||(c.A=!0,at(c,"complete"),at(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,at(this,"complete"),at(this,"abort"),zh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zh(this,!0)),cn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?dx(this):this.bb())},n.bb=function(){dx(this)};function dx(c){if(c.h&&typeof o<"u"&&(!c.v[1]||ni(c)!=4||c.Z()!=2)){if(c.u&&ni(c)==4)Vt(c.Ea,0,c);else if(at(c,"readystatechange"),ni(c)==4){c.h=!1;try{const oe=c.Z();e:switch(oe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var m;if(!(m=p)){var E;if(E=oe===0){var M=String(c.D).match(tx)[1]||null;!M&&a.self&&a.self.location&&(M=a.self.location.protocol.slice(0,-1)),E=!n2.test(M?M.toLowerCase():"")}m=E}if(m)at(c,"complete"),at(c,"success");else{c.m=6;try{var $=2<ni(c)?c.g.statusText:""}catch{$=""}c.l=$+" ["+c.Z()+"]",ux(c)}}finally{zh(c)}}}}function zh(c,p){if(c.g){hx(c);const m=c.g,E=c.v[0]?()=>{}:null;c.g=null,c.v=null,p||at(c,"ready");try{m.onreadystatechange=E}catch{}}}function hx(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function ni(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<ni(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),qr(p)}};function fx(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function s2(c){const p={};c=(c.g&&2<=ni(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<c.length;E++){if(x(c[E]))continue;var m=I(c[E]);const M=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const $=p[M]||[];p[M]=$,$.push(m)}T(p,function(E){return E.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function nu(c,p,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||p}function gx(c){this.Aa=0,this.i=[],this.j=new Ee,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=nu("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=nu("baseRetryDelayMs",5e3,c),this.cb=nu("retryDelaySeedMs",1e4,c),this.Wa=nu("forwardChannelMaxRetries",2,c),this.wa=nu("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new Vi(c&&c.concurrentRequestLimit),this.Da=new e2,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=gx.prototype,n.la=8,n.G=1,n.connect=function(c,p,m,E){ae(0),this.W=c,this.H=p||{},m&&E!==void 0&&(this.H.OSID=m,this.H.OAID=E),this.F=this.X,this.I=Ex(this,null,this.W),Wh(this)};function $m(c){if(px(c),c.G==3){var p=c.U++,m=ti(c.I);if(qt(m,"SID",c.K),qt(m,"RID",p),qt(m,"TYPE","terminate"),ru(c,m),p=new Ne(c,c.j,p),p.L=2,p.v=Uh(ti(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=p.v,m=!0),m||(p.g=Sx(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Oi(p)}xx(c)}function qh(c){c.g&&(zm(c),c.g.cancel(),c.g=null)}function px(c){qh(c),c.u&&(a.clearTimeout(c.u),c.u=null),Gh(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function Wh(c){if(!Zs(c.h)&&!c.s){c.s=!0;var p=c.Ga;ln||L(),te||(ln(),te=!0),pe.add(p,c),c.B=0}}function i2(c,p){return ei(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=p.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=We(g(c.Ga,c,p),Ix(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const M=new Ne(this,this.j,c);let $=this.o;if(this.S&&($?($=v($),_($,this.S)):$=this.S),this.m!==null||this.O||(M.H=$,$=null),this.P)e:{for(var p=0,m=0;m<this.i.length;m++){t:{var E=this.i[m];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(p+=E,4096<p){p=m;break e}if(p===4096||m===this.i.length-1){p=m+1;break e}}p=1e3}else p=1e3;p=yx(this,M,p),m=ti(this.I),qt(m,"RID",c),qt(m,"CVER",22),this.D&&qt(m,"X-HTTP-Session-Id",this.D),ru(this,m),$&&(this.O?p="headers="+encodeURIComponent(String(lx($)))+"&"+p:this.m&&Um(m,this.m,$)),Dt(this.h,M),this.Ua&&qt(m,"TYPE","init"),this.P?(qt(m,"$req",p),qt(m,"SID","null"),M.T=!0,Ze(M,m,null)):Ze(M,m,p),this.G=2}}else this.G==3&&(c?mx(this,c):this.i.length==0||Zs(this.h)||mx(this))};function mx(c,p){var m;p?m=p.l:m=c.U++;const E=ti(c.I);qt(E,"SID",c.K),qt(E,"RID",m),qt(E,"AID",c.T),ru(c,E),c.m&&c.o&&Um(E,c.m,c.o),m=new Ne(c,c.j,m,c.B+1),c.m===null&&(m.H=c.o),p&&(c.i=p.D.concat(c.i)),p=yx(c,m,1e3),m.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Dt(c.h,m),Ze(m,E,p)}function ru(c,p){c.H&&P(c.H,function(m,E){qt(p,E,m)}),c.l&&ex({},function(m,E){qt(p,E,m)})}function yx(c,p,m){m=Math.min(c.i.length,m);var E=c.l?g(c.l.Na,c.l,c):null;e:{var M=c.i;let $=-1;for(;;){const oe=["count="+m];$==-1?0<m?($=M[0].g,oe.push("ofs="+$)):$=0:oe.push("ofs="+$);let Lt=!0;for(let Bn=0;Bn<m;Bn++){let mt=M[Bn].g;const Jn=M[Bn].map;if(mt-=$,0>mt)$=Math.max(0,M[Bn].g-100),Lt=!1;else try{t2(Jn,oe,"req"+mt+"_")}catch{E&&E(Jn)}}if(Lt){E=oe.join("&");break e}}}return c=c.i.splice(0,m),p.D=c,E}function _x(c){if(!c.g&&!c.u){c.Y=1;var p=c.Fa;ln||L(),te||(ln(),te=!0),pe.add(p,c),c.v=0}}function Bm(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=We(g(c.Fa,c),Ix(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,vx(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=We(g(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ae(10),qh(this),vx(this))};function zm(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function vx(c){c.g=new Ne(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var p=ti(c.qa);qt(p,"RID","rpc"),qt(p,"SID",c.K),qt(p,"AID",c.T),qt(p,"CI",c.F?"0":"1"),!c.F&&c.ja&&qt(p,"TO",c.ja),qt(p,"TYPE","xmlhttp"),ru(c,p),c.m&&c.o&&Um(p,c.m,c.o),c.L&&(c.g.I=c.L);var m=c.g;c=c.ia,m.L=1,m.v=Uh(ti(p)),m.m=null,m.P=!0,Yn(m,c)}n.Za=function(){this.C!=null&&(this.C=null,qh(this),Bm(this),ae(19))};function Gh(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function wx(c,p){var m=null;if(c.g==p){Gh(c),zm(c),c.g=null;var E=2}else if(Cn(c.h,p))m=p.D,Cs(c.h,p),E=1;else return;if(c.G!=0){if(p.o)if(E==1){m=p.m?p.m.length:0,p=Date.now()-p.F;var M=c.B;E=al(),at(E,new ke(E,m)),Wh(c)}else _x(c);else if(M=p.s,M==3||M==0&&0<p.X||!(E==1&&i2(c,p)||E==2&&Bm(c)))switch(m&&0<m.length&&(p=c.h,p.i=p.i.concat(m)),M){case 1:Jo(c,5);break;case 4:Jo(c,10);break;case 3:Jo(c,6);break;default:Jo(c,2)}}}function Ix(c,p){let m=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(m*=2),m*p}function Jo(c,p){if(c.j.info("Error code "+p),p==2){var m=g(c.fb,c),E=c.Xa;const M=!E;E=new Yo(E||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Fh(E,"https"),Uh(E),M?XD(E.toString(),m):ZD(E.toString(),m)}else ae(2);c.G=0,c.l&&c.l.sa(p),xx(c),px(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),ae(2)):(this.j.info("Failed to ping google.com"),ae(1))};function xx(c){if(c.G=0,c.ka=[],c.l){const p=Qo(c.h);(p.length!=0||c.i.length!=0)&&(N(c.ka,p),N(c.ka,c.i),c.h.i.length=0,C(c.i),c.i.length=0),c.l.ra()}}function Ex(c,p,m){var E=m instanceof Yo?ti(m):new Yo(m);if(E.g!="")p&&(E.g=p+"."+E.g),jh(E,E.s);else{var M=a.location;E=M.protocol,p=p?p+"."+M.hostname:M.hostname,M=+M.port;var $=new Yo(null);E&&Fh($,E),p&&($.g=p),M&&jh($,M),m&&($.l=m),E=$}return m=c.D,p=c.ya,m&&p&&qt(E,m,p),qt(E,"VER",c.la),ru(c,E),E}function Sx(c,p,m){if(p&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Ca&&!c.pa?new cn(new $h({eb:m})):new cn(c.pa),p.Ha(c.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tx(){}n=Tx.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Hh(){}Hh.prototype.g=function(c,p){return new br(c,p)};function br(c,p){xe.call(this),this.g=new gx(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(c?c["X-WebChannel-Client-Profile"]=p.va:c={"X-WebChannel-Client-Profile":p.va}),this.g.S=c,(c=p&&p.Sb)&&!x(c)&&(this.g.m=c),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!x(p)&&(this.g.D=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new cl(this)}w(br,xe),br.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},br.prototype.close=function(){$m(this.g)},br.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.u&&(m={},m.__data__=xt(c),c=m);p.i.push(new Gr(p.Ya++,c)),p.G==3&&Wh(p)},br.prototype.N=function(){this.g.l=null,delete this.j,$m(this.g),delete this.g,br.aa.N.call(this)};function bx(c){is.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const m in p){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}w(bx,is);function Ax(){As.call(this),this.status=1}w(Ax,As);function cl(c){this.g=c}w(cl,Tx),cl.prototype.ua=function(){at(this.g,"a")},cl.prototype.ta=function(c){at(this.g,new bx(c))},cl.prototype.sa=function(c){at(this.g,new Ax)},cl.prototype.ra=function(){at(this.g,"b")},Hh.prototype.createWebChannel=Hh.prototype.g,br.prototype.send=br.prototype.o,br.prototype.open=br.prototype.m,br.prototype.close=br.prototype.close,$R=function(){return new Hh},UR=function(){return al()},jR=os,uv={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},He.NO_ERROR=0,He.TIMEOUT=8,He.HTTP_ERROR=6,Bf=He,Oe.COMPLETE="complete",FR=Oe,Kn.EventType=Un,Un.OPEN="a",Un.CLOSE="b",Un.ERROR="c",Un.MESSAGE="d",xe.prototype.listen=xe.prototype.K,Ru=Kn,cn.prototype.listenOnce=cn.prototype.L,cn.prototype.getLastError=cn.prototype.Ka,cn.prototype.getLastErrorCode=cn.prototype.Ba,cn.prototype.getStatus=cn.prototype.Z,cn.prototype.getResponseJson=cn.prototype.Oa,cn.prototype.getResponseText=cn.prototype.oa,cn.prototype.send=cn.prototype.ea,cn.prototype.setWithCredentials=cn.prototype.Ha,VR=cn}).apply(typeof pf<"u"?pf:typeof self<"u"?self:typeof window<"u"?window:{});const RS="@firebase/firestore",kS="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Pn.UNAUTHENTICATED=new Pn(null),Pn.GOOGLE_CREDENTIALS=new Pn("google-credentials-uid"),Pn.FIRST_PARTY=new Pn("first-party-uid"),Pn.MOCK_USER=new Pn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No=new oh("@firebase/firestore");function vl(){return No.logLevel}function m8(n){No.setLogLevel(n)}function Q(n,...e){if(No.logLevel<=rt.DEBUG){const t=e.map(Ew);No.debug(`Firestore (${jc}): ${n}`,...t)}}function gn(n,...e){if(No.logLevel<=rt.ERROR){const t=e.map(Ew);No.error(`Firestore (${jc}): ${n}`,...t)}}function rs(n,...e){if(No.logLevel<=rt.WARN){const t=e.map(Ew);No.warn(`Firestore (${jc}): ${n}`,...t)}}function Ew(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function de(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,BR(n,r,t)}function BR(n,e,t){let r=`FIRESTORE (${jc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw gn(r),new Error(r)}function me(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||BR(e,s,r)}function y8(n,e){n||de(57014,e)}function ie(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends Es{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class L4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Pn.UNAUTHENTICATED))}shutdown(){}}class M4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class O4{constructor(e){this.t=e,this.currentUser=Pn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){me(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Mn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Mn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Mn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(me(typeof r.accessToken=="string",31837,{l:r}),new zR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return me(e===null||typeof e=="string",2055,{h:e}),new Pn(e)}}class V4{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Pn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class F4{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new V4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Pn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class j4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Xt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){me(this.o===void 0,3512);const r=i=>{i.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new dv(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(me(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new dv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class _8{getToken(){return Promise.resolve(new dv(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=U4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function De(n,e){return n<e?-1:n>e?1:0}function hv(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Ry(s)===Ry(i)?De(s,i):Ry(s)?1:-1}return De(n.length,e.length)}const $4=55296,B4=57343;function Ry(n){const e=n.charCodeAt(0);return e>=$4&&e<=B4}function dc(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function qR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fv="__name__";class Ds{constructor(e,t,r){t===void 0?t=0:t>e.length&&de(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&de(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ds.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ds?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Ds.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return De(e.length,t.length)}static compareSegments(e,t){const r=Ds.isNumericId(e),s=Ds.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Ds.extractNumericId(e).compare(Ds.extractNumericId(t)):hv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Io.fromString(e.substring(4,e.length-2))}}class tt extends Ds{construct(e,t,r){return new tt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new q(j.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new tt(t)}static emptyPath(){return new tt([])}}const z4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class en extends Ds{construct(e,t,r){return new en(e,t,r)}static isValidIdentifier(e){return z4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),en.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===fv}static keyField(){return new en([fv])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new q(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new q(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new q(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new q(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new en(t)}static emptyPath(){return new en([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e){this.path=e}static fromPath(e){return new se(tt.fromString(e))}static fromName(e){return new se(tt.fromString(e).popFirst(5))}static empty(){return new se(tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&tt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return tt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new tt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tw(n,e,t){if(!t)throw new q(j.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function q4(n,e,t,r){if(e===!0&&r===!0)throw new q(j.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function NS(n){if(!se.isDocumentKey(n))throw new q(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function PS(n){if(se.isDocumentKey(n))throw new q(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function WR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Zp(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":de(12329,{type:typeof n})}function st(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zp(n);throw new q(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function GR(n,e){if(e<=0)throw new q(j.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Za(n,e){if(!WR(n))throw new q(j.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new q(j.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DS=-62135596800,LS=1e6;class yt{static now(){return yt.fromMillis(Date.now())}static fromDate(e){return yt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*LS);return new yt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<DS)throw new q(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/LS}_compareTo(e){return this.seconds===e.seconds?De(this.nanoseconds,e.nanoseconds):De(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:yt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Za(e,yt._jsonSchema))return new yt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-DS;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}yt._jsonSchemaVersion="firestore/timestamp/1.0",yt._jsonSchema={type:vn("string",yt._jsonSchemaVersion),seconds:vn("number"),nanoseconds:vn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{static fromTimestamp(e){return new we(e)}static min(){return new we(new yt(0,0))}static max(){return new we(new yt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hc=-1;class fc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function gv(n){return n.fields.find(e=>e.kind===2)}function ra(n){return n.fields.filter(e=>e.kind!==2)}function W4(n,e){let t=De(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=G4(n.fields[r],e.fields[r]),t!==0)return t;return De(n.fields.length,e.fields.length)}fc.UNKNOWN_ID=-1;class va{constructor(e,t){this.fieldPath=e,this.kind=t}}function G4(n,e){const t=en.comparator(n.fieldPath,e.fieldPath);return t!==0?t:De(n.kind,e.kind)}class gc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new gc(0,Ur.min())}}function HR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=we.fromTimestamp(r===1e9?new yt(t+1,0):new yt(t,r));return new Ur(s,se.empty(),e)}function QR(n){return new Ur(n.readTime,n.key,hc)}class Ur{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ur(we.min(),se.empty(),hc)}static max(){return new Ur(we.max(),se.empty(),hc)}}function bw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=se.comparator(n.documentKey,e.documentKey),t!==0?t:De(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class YR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bo(n){if(n.code!==j.FAILED_PRECONDITION||n.message!==KR)throw n;Q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&de(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rr="SimpleDb";class em{static open(e,t,r,s){try{return new em(t,e.transaction(s,r))}catch(i){throw new Qu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Mn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Qu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Aw(r.target.error);this.S.reject(new Qu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Q(Rr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Q4(t)}}class qs{static delete(e){return Q(Rr,"Removing database:",e),ia(YC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Dp())return!1;if(qs.F())return!0;const e=En(),t=qs.M(e),r=0<t&&t<10,s=JR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,qs.M(En())===12.2&&gn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Q(Rr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Qu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new q(j.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new q(j.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Qu(e,o))},s.onupgradeneeded=i=>{Q(Rr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{Q(Rr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=em.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),O.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(Q(Rr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function JR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class H4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ia(this.U.delete())}}class Qu extends q{constructor(e,t){super(j.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function zo(n){return n.name==="IndexedDbTransactionError"}class Q4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(Q(Rr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(Q(Rr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ia(r)}add(e){return Q(Rr,"ADD",this.store.name,e,e),ia(this.store.add(e))}get(e){return ia(this.store.get(e)).next(t=>(t===void 0&&(t=null),Q(Rr,"GET",this.store.name,e,t),t))}delete(e){return Q(Rr,"DELETE",this.store.name,e),ia(this.store.delete(e))}count(){return Q(Rr,"COUNT",this.store.name),ia(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){Q(Rr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const o=Aw(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new O((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new H4(a),u=t(a.primaryKey,a.value,l);if(u instanceof O){const h=u.catch(f=>(l.done(),O.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ia(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Aw(r.target.error);t(s)}})}let MS=!1;function Aw(n){const e=qs.M(En());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new q("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return MS||(MS=!0,setTimeout(()=>{throw r},0)),r}}return n}const Ku="IndexBackfiller";class K4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Q(Ku,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();Q(Ku,`Documents written: ${t}`)}catch(t){zo(t)?Q(Ku,"Ignoring IndexedDB error during index backfill: ",t):await Bo(t)}await this.re(6e4)})}}class Y4{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return Q(Ku,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(Q(Ku,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=QR(i);bw(o,r)>0&&(r=o)}),new Ur(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}mr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xo=-1;function _h(n){return n==null}function Md(n){return n===0&&1/n==-1/0}function XR(n){return typeof n=="number"&&Number.isInteger(n)&&!Md(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hg="";function ir(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=OS(e)),e=J4(n.get(t),e);return OS(e)}function J4(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Hg:t+="";break;default:t+=i}}return t}function OS(n){return n+Hg+""}function Fs(n){const e=n.length;if(me(e>=2,64408,{path:n}),e===2)return me(n.charAt(0)===Hg&&n.charAt(1)==="",56145,{path:n}),tt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Hg,i);switch((o<0||o>t)&&de(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:de(61167,{path:n})}i=o+2}return new tt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sa="remoteDocuments",vh="owner",fl="owner",Od="mutationQueues",X4="userId",fs="mutations",VS="batchId",fa="userMutationsIndex",FS=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(n,e){return[n,ir(e)]}function ZR(n,e,t){return[n,ir(e),t]}const Z4={},pc="documentMutations",Qg="remoteDocumentsV14",e3=["prefixPath","collectionGroup","readTime","documentId"],qf="documentKeyIndex",t3=["prefixPath","collectionGroup","documentId"],ek="collectionGroupIndex",n3=["collectionGroup","readTime","prefixPath","documentId"],Vd="remoteDocumentGlobal",pv="remoteDocumentGlobalKey",mc="targets",tk="queryTargetsIndex",r3=["canonicalId","targetId"],yc="targetDocuments",s3=["targetId","path"],Cw="documentTargetsIndex",i3=["path","targetId"],Kg="targetGlobalKey",wa="targetGlobal",Fd="collectionParents",o3=["collectionId","parent"],_c="clientMetadata",a3="clientId",tm="bundles",l3="bundleId",nm="namedQueries",c3="name",Rw="indexConfiguration",u3="indexId",mv="collectionGroupIndex",d3="collectionGroup",Yu="indexState",h3=["indexId","uid"],nk="sequenceNumberIndex",f3=["uid","sequenceNumber"],Ju="indexEntries",g3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],rk="documentKeyIndex",p3=["indexId","uid","orderedDocumentKey"],rm="documentOverlays",m3=["userId","collectionPath","documentId"],yv="collectionPathOverlayIndex",y3=["userId","collectionPath","largestBatchId"],sk="collectionGroupOverlayIndex",_3=["userId","collectionGroup","largestBatchId"],kw="globals",v3="name",ik=[Od,fs,pc,sa,mc,vh,wa,yc,_c,Vd,Fd,tm,nm],w3=[...ik,rm],ok=[Od,fs,pc,Qg,mc,vh,wa,yc,_c,Vd,Fd,tm,nm,rm],ak=ok,Nw=[...ak,Rw,Yu,Ju],I3=Nw,lk=[...Nw,kw],x3=lk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v extends YR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Sn(n,e){const t=ie(n);return qs.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jS(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function qo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ck(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function uk(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t){this.comparator=e,this.root=t||qn.EMPTY}insert(e,t){return new Bt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qn.BLACK,null,null))}remove(e){return new Bt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new mf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new mf(this.root,e,this.comparator,!1)}getReverseIterator(){return new mf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new mf(this.root,e,this.comparator,!0)}}class mf{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??qn.RED,this.left=s??qn.EMPTY,this.right=i??qn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new qn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return qn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return qn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw de(43730,{key:this.key,value:this.value});if(this.right.isRed())throw de(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw de(27949);return e+(this.isRed()?0:1)}}qn.EMPTY=null,qn.RED=!0,qn.BLACK=!1;qn.EMPTY=new class{constructor(){this.size=0}get key(){throw de(57766)}get value(){throw de(16141)}get color(){throw de(16727)}get left(){throw de(29726)}get right(){throw de(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new qn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.comparator=e,this.data=new Bt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new US(this.data.getIterator())}getIteratorFrom(e){return new US(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class US{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function gl(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e){this.fields=e,e.sort(en.comparator)}static empty(){return new yr([])}unionWith(e){let t=new At(en.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new yr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return dc(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w8(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new dk("Invalid base64 string: "+i):i}}(e);return new dn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new dn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return De(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}dn.EMPTY_BYTE_STRING=new dn("");const E3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xi(n){if(me(!!n,39018),typeof n=="string"){let e=0;const t=E3.exec(n);if(me(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Yt(n.seconds),nanos:Yt(n.nanos)}}function Yt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ei(n){return typeof n=="string"?dn.fromBase64String(n):dn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="server_timestamp",fk="__type__",gk="__previous_value__",pk="__local_write_time__";function sm(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[fk])==null?void 0:r.stringValue)===hk}function im(n){const e=n.mapValue.fields[gk];return sm(e)?im(e):e}function jd(n){const e=xi(n.mapValue.fields[pk].timestampValue);return new yt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const Ud="(default)";class Da{constructor(e,t){this.projectId=e,this.database=t||Ud}static empty(){return new Da("","")}get isDefaultDatabase(){return this.database===Ud}isEqual(e){return e instanceof Da&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pw="__type__",mk="__max__",so={mapValue:{fields:{__type__:{stringValue:mk}}}},Dw="__vector__",vc="value",Wf={nullValue:"NULL_VALUE"};function Po(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?sm(n)?4:yk(n)?9007199254740991:om(n)?10:11:de(28295,{value:n})}function Ys(n,e){if(n===e)return!0;const t=Po(n);if(t!==Po(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return jd(n).isEqual(jd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=xi(s.timestampValue),a=xi(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ei(s.bytesValue).isEqual(Ei(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Yt(s.geoPointValue.latitude)===Yt(i.geoPointValue.latitude)&&Yt(s.geoPointValue.longitude)===Yt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Yt(s.integerValue)===Yt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Yt(s.doubleValue),a=Yt(i.doubleValue);return o===a?Md(o)===Md(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return dc(n.arrayValue.values||[],e.arrayValue.values||[],Ys);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(jS(o)!==jS(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ys(o[l],a[l])))return!1;return!0}(n,e);default:return de(52216,{left:n})}}function $d(n,e){return(n.values||[]).find(t=>Ys(t,e))!==void 0}function Do(n,e){if(n===e)return 0;const t=Po(n),r=Po(e);if(t!==r)return De(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return De(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Yt(i.integerValue||i.doubleValue),l=Yt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return $S(n.timestampValue,e.timestampValue);case 4:return $S(jd(n),jd(e));case 5:return hv(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ei(i),l=Ei(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=De(a[u],l[u]);if(h!==0)return h}return De(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=De(Yt(i.latitude),Yt(o.latitude));return a!==0?a:De(Yt(i.longitude),Yt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return BS(n.arrayValue,e.arrayValue);case 10:return function(i,o){var g,y,w,C;const a=i.fields||{},l=o.fields||{},u=(g=a[vc])==null?void 0:g.arrayValue,h=(y=l[vc])==null?void 0:y.arrayValue,f=De(((w=u==null?void 0:u.values)==null?void 0:w.length)||0,((C=h==null?void 0:h.values)==null?void 0:C.length)||0);return f!==0?f:BS(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===so.mapValue&&o===so.mapValue)return 0;if(i===so.mapValue)return 1;if(o===so.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=hv(l[f],h[f]);if(g!==0)return g;const y=Do(a[l[f]],u[h[f]]);if(y!==0)return y}return De(l.length,h.length)}(n.mapValue,e.mapValue);default:throw de(23264,{he:t})}}function $S(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return De(n,e);const t=xi(n),r=xi(e),s=De(t.seconds,r.seconds);return s!==0?s:De(t.nanos,r.nanos)}function BS(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Do(t[s],r[s]);if(i)return i}return De(t.length,r.length)}function wc(n){return vv(n)}function vv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=xi(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ei(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return se.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=vv(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${vv(t.fields[o])}`;return s+"}"}(n.mapValue):de(61005,{value:n})}function Gf(n){switch(Po(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=im(n);return e?16+Gf(e):16;case 5:return 2*n.stringValue.length;case 6:return Ei(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Gf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return qo(r.fields,(i,o)=>{s+=i.length+Gf(o)}),s}(n.mapValue);default:throw de(13486,{value:n})}}function La(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function wv(n){return!!n&&"integerValue"in n}function Bd(n){return!!n&&"arrayValue"in n}function zS(n){return!!n&&"nullValue"in n}function qS(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hf(n){return!!n&&"mapValue"in n}function om(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Pw])==null?void 0:r.stringValue)===Dw}function Xu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return qo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Xu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Xu(n.arrayValue.values[t]);return e}return{...n}}function yk(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===mk}const _k={mapValue:{fields:{[Pw]:{stringValue:Dw},[vc]:{arrayValue:{}}}}};function T3(n){return"nullValue"in n?Wf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?La(Da.empty(),se.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?om(n)?_k:{mapValue:{}}:de(35942,{value:n})}function b3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?La(Da.empty(),se.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?_k:"mapValue"in n?om(n)?{mapValue:{}}:so:de(61959,{value:n})}function WS(n,e){const t=Do(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function GS(n,e){const t=Do(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this.value=e}static empty(){return new Wn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Hf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xu(t)}setAll(e){let t=en.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Xu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Hf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ys(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Hf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){qo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Wn(Xu(this.value))}}function vk(n){const e=[];return qo(n.fields,(t,r)=>{const s=new en([t]);if(Hf(r)){const i=vk(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new yr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Gt(e,0,we.min(),we.min(),we.min(),Wn.empty(),0)}static newFoundDocument(e,t,r,s){return new Gt(e,1,t,we.min(),r,s,0)}static newNoDocument(e,t){return new Gt(e,2,t,we.min(),we.min(),Wn.empty(),0)}static newUnknownDocument(e,t){return new Gt(e,3,t,we.min(),we.min(),Wn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(we.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Wn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Wn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=we.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Gt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Gt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(e,t){this.position=e,this.inclusive=t}}function HS(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=se.comparator(se.fromName(o.referenceValue),t.key):r=Do(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function QS(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ys(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zd{constructor(e,t="asc"){this.field=e,this.dir=t}}function A3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{}class ot extends wk{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new C3(e,t,r):t==="array-contains"?new N3(e,r):t==="in"?new bk(e,r):t==="not-in"?new P3(e,r):t==="array-contains-any"?new D3(e,r):new ot(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new R3(e,r):new k3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Do(t,this.value)):t!==null&&Po(this.value)===Po(t)&&this.matchesComparison(Do(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return de(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Tt extends wk{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Tt(e,t)}matches(e){return Ic(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ic(n){return n.op==="and"}function Iv(n){return n.op==="or"}function Lw(n){return Ik(n)&&Ic(n)}function Ik(n){for(const e of n.filters)if(e instanceof Tt)return!1;return!0}function xv(n){if(n instanceof ot)return n.field.canonicalString()+n.op.toString()+wc(n.value);if(Lw(n))return n.filters.map(e=>xv(e)).join(",");{const e=n.filters.map(t=>xv(t)).join(",");return`${n.op}(${e})`}}function xk(n,e){return n instanceof ot?function(r,s){return s instanceof ot&&r.op===s.op&&r.field.isEqual(s.field)&&Ys(r.value,s.value)}(n,e):n instanceof Tt?function(r,s){return s instanceof Tt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&xk(o,s.filters[a]),!0):!1}(n,e):void de(19439)}function Ek(n,e){const t=n.filters.concat(e);return Tt.create(t,n.op)}function Sk(n){return n instanceof ot?function(t){return`${t.field.canonicalString()} ${t.op} ${wc(t.value)}`}(n):n instanceof Tt?function(t){return t.op.toString()+" {"+t.getFilters().map(Sk).join(" ,")+"}"}(n):"Filter"}class C3 extends ot{constructor(e,t,r){super(e,t,r),this.key=se.fromName(r.referenceValue)}matches(e){const t=se.comparator(e.key,this.key);return this.matchesComparison(t)}}class R3 extends ot{constructor(e,t){super(e,"in",t),this.keys=Tk("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class k3 extends ot{constructor(e,t){super(e,"not-in",t),this.keys=Tk("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Tk(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>se.fromName(r.referenceValue))}class N3 extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Bd(t)&&$d(t.arrayValue,this.value)}}class bk extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&$d(this.value.arrayValue,t)}}class P3 extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if($d(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!$d(this.value.arrayValue,t)}}class D3 extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Bd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>$d(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Ev(n,e=null,t=[],r=[],s=null,i=null,o=null){return new L3(n,e,t,r,s,i,o)}function Ma(n){const e=ie(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>xv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),_h(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>wc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>wc(r)).join(",")),e.Te=t}return e.Te}function wh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!A3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!xk(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!QS(n.startAt,e.startAt)&&QS(n.endAt,e.endAt)}function Yg(n){return se.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Jg(n,e){return n.filters.filter(t=>t instanceof ot&&t.field.isEqual(e))}function KS(n,e,t){let r=Wf,s=!0;for(const i of Jg(n,e)){let o=Wf,a=!0;switch(i.op){case"<":case"<=":o=T3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Wf}WS({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];WS({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function YS(n,e,t){let r=so,s=!0;for(const i of Jg(n,e)){let o=so,a=!0;switch(i.op){case">=":case">":o=b3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=so}GS({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];GS({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ak(n,e,t,r,s,i,o,a){return new Ri(n,e,t,r,s,i,o,a)}function Uc(n){return new Ri(n)}function JS(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Mw(n){return n.collectionGroup!==null}function Wl(n){const e=ie(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new At(en.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new zd(i,r))}),t.has(en.keyField().canonicalString())||e.Ie.push(new zd(en.keyField(),r))}return e.Ie}function or(n){const e=ie(n);return e.Ee||(e.Ee=Rk(e,Wl(n))),e.Ee}function Ck(n){const e=ie(n);return e.de||(e.de=Rk(e,n.explicitOrderBy)),e.de}function Rk(n,e){if(n.limitType==="F")return Ev(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new zd(s.field,i)});const t=n.endAt?new Lo(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Lo(n.startAt.position,n.startAt.inclusive):null;return Ev(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Sv(n,e){const t=n.filters.concat([e]);return new Ri(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Xg(n,e,t){return new Ri(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ih(n,e){return wh(or(n),or(e))&&n.limitType===e.limitType}function kk(n){return`${Ma(or(n))}|lt:${n.limitType}`}function wl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Sk(s)).join(", ")}]`),_h(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>wc(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>wc(s)).join(",")),`Target(${r})`}(or(n))}; limitType=${n.limitType})`}function xh(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Wl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=HS(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Wl(r),s)||r.endAt&&!function(o,a,l){const u=HS(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Wl(r),s))}(n,e)}function Nk(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Pk(n){return(e,t)=>{let r=!1;for(const s of Wl(n)){const i=M3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function M3(n,e,t){const r=n.field.isKeyField()?se.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Do(l,u):de(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return de(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){qo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return uk(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O3=new Bt(se.comparator);function _r(){return O3}const Dk=new Bt(se.comparator);function ku(...n){let e=Dk;for(const t of n)e=e.insert(t.key,t);return e}function Lk(n){let e=Dk;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function js(){return Zu()}function Mk(){return Zu()}function Zu(){return new ki(n=>n.toString(),(n,e)=>n.isEqual(e))}const V3=new Bt(se.comparator),F3=new At(se.comparator);function ze(...n){let e=F3;for(const t of n)e=e.add(t);return e}const j3=new At(De);function Ow(){return j3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Md(e)?"-0":e}}function Ok(n){return{integerValue:""+n}}function Vk(n,e){return XR(e)?Ok(e):Vw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(){this._=void 0}}function U3(n,e,t){return n instanceof xc?function(s,i){const o={fields:{[fk]:{stringValue:hk},[pk]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&sm(i)&&(i=im(i)),i&&(o.fields[gk]=i),{mapValue:o}}(t,e):n instanceof Oa?jk(n,e):n instanceof Va?Uk(n,e):function(s,i){const o=Fk(s,i),a=XS(o)+XS(s.Ae);return wv(o)&&wv(s.Ae)?Ok(a):Vw(s.serializer,a)}(n,e)}function $3(n,e,t){return n instanceof Oa?jk(n,e):n instanceof Va?Uk(n,e):t}function Fk(n,e){return n instanceof Ec?function(r){return wv(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class xc extends am{}class Oa extends am{constructor(e){super(),this.elements=e}}function jk(n,e){const t=$k(e);for(const r of n.elements)t.some(s=>Ys(s,r))||t.push(r);return{arrayValue:{values:t}}}class Va extends am{constructor(e){super(),this.elements=e}}function Uk(n,e){let t=$k(e);for(const r of n.elements)t=t.filter(s=>!Ys(s,r));return{arrayValue:{values:t}}}class Ec extends am{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function XS(n){return Yt(n.integerValue||n.doubleValue)}function $k(n){return Bd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e,t){this.field=e,this.transform=t}}function B3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Oa&&s instanceof Oa||r instanceof Va&&s instanceof Va?dc(r.elements,s.elements,Ys):r instanceof Ec&&s instanceof Ec?Ys(r.Ae,s.Ae):r instanceof xc&&s instanceof xc}(n.transform,e.transform)}class z3{constructor(e,t){this.version=e,this.transformResults=t}}class tn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new tn}static exists(e){return new tn(void 0,e)}static updateTime(e){return new tn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Qf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class lm{}function Bk(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Bc(n.key,tn.none()):new $c(n.key,n.data,tn.none());{const t=n.data,r=Wn.empty();let s=new At(en.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ni(n.key,r,new yr(s.toArray()),tn.none())}}function q3(n,e,t){n instanceof $c?function(s,i,o){const a=s.value.clone(),l=eT(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ni?function(s,i,o){if(!Qf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=eT(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(zk(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ed(n,e,t,r){return n instanceof $c?function(i,o,a,l){if(!Qf(i.precondition,o))return a;const u=i.value.clone(),h=tT(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ni?function(i,o,a,l){if(!Qf(i.precondition,o))return a;const u=tT(i.fieldTransforms,l,o),h=o.data;return h.setAll(zk(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Qf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function W3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Fk(r.transform,s||null);i!=null&&(t===null&&(t=Wn.empty()),t.set(r.field,i))}return t||null}function ZS(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&dc(r,s,(i,o)=>B3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class $c extends lm{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ni extends lm{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function zk(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function eT(n,e,t){const r=new Map;me(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,$3(o,a,t[s]))}return r}function tT(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,U3(i,o,e))}return r}class Bc extends lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Fw extends lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&q3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ed(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ed(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Mk();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=Bk(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(we.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ze())}isEqual(e){return this.batchId===e.batchId&&dc(this.mutations,e.mutations,(t,r)=>ZS(t,r))&&dc(this.baseMutations,e.baseMutations,(t,r)=>ZS(t,r))}}class Uw{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){me(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return V3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Uw(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mn,ut;function Wk(n){switch(n){case j.OK:return de(64938);case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0;default:return de(15467,{code:n})}}function Gk(n){if(n===void 0)return gn("GRPC error has no .code"),j.UNKNOWN;switch(n){case mn.OK:return j.OK;case mn.CANCELLED:return j.CANCELLED;case mn.UNKNOWN:return j.UNKNOWN;case mn.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case mn.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case mn.INTERNAL:return j.INTERNAL;case mn.UNAVAILABLE:return j.UNAVAILABLE;case mn.UNAUTHENTICATED:return j.UNAUTHENTICATED;case mn.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case mn.NOT_FOUND:return j.NOT_FOUND;case mn.ALREADY_EXISTS:return j.ALREADY_EXISTS;case mn.PERMISSION_DENIED:return j.PERMISSION_DENIED;case mn.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case mn.ABORTED:return j.ABORTED;case mn.OUT_OF_RANGE:return j.OUT_OF_RANGE;case mn.UNIMPLEMENTED:return j.UNIMPLEMENTED;case mn.DATA_LOSS:return j.DATA_LOSS;default:return de(39323,{code:n})}}(ut=mn||(mn={}))[ut.OK=0]="OK",ut[ut.CANCELLED=1]="CANCELLED",ut[ut.UNKNOWN=2]="UNKNOWN",ut[ut.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ut[ut.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ut[ut.NOT_FOUND=5]="NOT_FOUND",ut[ut.ALREADY_EXISTS=6]="ALREADY_EXISTS",ut[ut.PERMISSION_DENIED=7]="PERMISSION_DENIED",ut[ut.UNAUTHENTICATED=16]="UNAUTHENTICATED",ut[ut.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ut[ut.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ut[ut.ABORTED=10]="ABORTED",ut[ut.OUT_OF_RANGE=11]="OUT_OF_RANGE",ut[ut.UNIMPLEMENTED=12]="UNIMPLEMENTED",ut[ut.INTERNAL=13]="INTERNAL",ut[ut.UNAVAILABLE=14]="UNAVAILABLE",ut[ut.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let td=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hk(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H3=new Io([4294967295,4294967295],0);function nT(n){const e=Hk().encode(n),t=new OR;return t.update(e),new Uint8Array(t.digest())}function rT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Io([t,r],0),new Io([s,i],0)]}class Bw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Nu(`Invalid padding: ${t}`);if(r<0)throw new Nu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Nu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Nu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Io.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Io.fromNumber(r)));return s.compare(H3)===1&&(s=new Io([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=nT(e),[r,s]=rT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Bw(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=nT(e),[r,s]=rT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Nu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Th.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Sh(we.min(),s,new Bt(De),_r(),ze())}}class Th{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Th(r,t,ze(),ze(),ze())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Qk{constructor(e,t){this.targetId=e,this.Ce=t}}class Kk{constructor(e,t,r=dn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class sT{constructor(){this.ve=0,this.Fe=iT(),this.Me=dn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ze(),t=ze(),r=ze();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:de(38017,{changeType:i})}}),new Th(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=iT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,me(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Q3{constructor(e){this.Ge=e,this.ze=new Map,this.je=_r(),this.Je=yf(),this.He=yf(),this.Ye=new Bt(De)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:de(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Yg(i))if(r===0){const o=new se(i.path);this.et(t,o,Gt.newNoDocument(o,we.min()))}else me(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}td==null||td.lt(function(h,f,g,y,w){var A,x,R;const C={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},N=f.unchangedNames;return N&&(C.bloomFilter={applied:w===0,hashCount:(N==null?void 0:N.hashCount)??0,bitmapLength:((x=(A=N==null?void 0:N.bits)==null?void 0:A.bitmap)==null?void 0:x.length)??0,padding:((R=N==null?void 0:N.bits)==null?void 0:R.padding)??0,mightContain:D=>(y==null?void 0:y.mightContain(D))??!1}),C}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ei(r).toUint8Array()}catch(l){if(l instanceof dk)return rs("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Bw(o,s,i)}catch(l){return rs(l instanceof Nu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Yg(a.target)){const l=new se(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Gt.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=ze();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Sh(e,t,this.Ye,this.je,r);return this.je=_r(),this.Je=yf(),this.He=yf(),this.Ye=new Bt(De),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new sT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new At(De),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new At(De),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Q("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new sT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function yf(){return new Bt(se.comparator)}function iT(){return new Bt(se.comparator)}const K3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Y3=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),J3=(()=>({and:"AND",or:"OR"}))();class X3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Tv(n,e){return n.useProto3Json||_h(e)?e:{value:e}}function Sc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Yk(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Z3(n,e){return Sc(n,e.toTimestamp())}function pn(n){return me(!!n,49232),we.fromTimestamp(function(t){const r=xi(t);return new yt(r.seconds,r.nanos)}(n))}function zw(n,e){return bv(n,e).canonicalString()}function bv(n,e){const t=function(s){return new tt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Jk(n){const e=tt.fromString(n);return me(oN(e),10190,{key:e.toString()}),e}function qd(n,e){return zw(n.databaseId,e.path)}function Ws(n,e){const t=Jk(e);if(t.get(1)!==n.databaseId.projectId)throw new q(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new se(eN(t))}function Xk(n,e){return zw(n.databaseId,e)}function Zk(n){const e=Jk(n);return e.length===4?tt.emptyPath():eN(e)}function Av(n){return new tt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function eN(n){return me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function oT(n,e,t){return{name:qd(n,e),fields:t.value.mapValue.fields}}function cm(n,e,t){const r=Ws(n,e.name),s=pn(e.updateTime),i=e.createTime?pn(e.createTime):we.min(),o=new Wn({mapValue:{fields:e.fields}}),a=Gt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function e5(n,e){return"found"in e?function(r,s){me(!!s.found,43571),s.found.name,s.found.updateTime;const i=Ws(r,s.found.name),o=pn(s.found.updateTime),a=s.found.createTime?pn(s.found.createTime):we.min(),l=new Wn({mapValue:{fields:s.found.fields}});return Gt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){me(!!s.missing,3894),me(!!s.readTime,22933);const i=Ws(r,s.missing),o=pn(s.readTime);return Gt.newNoDocument(i,o)}(n,e):de(7234,{result:e})}function t5(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:de(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(me(h===void 0||typeof h=="string",58123),dn.fromBase64String(h||"")):(me(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),dn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?j.UNKNOWN:Gk(u.code);return new q(h,u.message||"")}(o);t=new Kk(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ws(n,r.document.name),i=pn(r.document.updateTime),o=r.document.createTime?pn(r.document.createTime):we.min(),a=new Wn({mapValue:{fields:r.document.fields}}),l=Gt.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new Kf(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ws(n,r.document),i=r.readTime?pn(r.readTime):we.min(),o=Gt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Kf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ws(n,r.document),i=r.removedTargetIds||[];t=new Kf([],i,s,null)}else{if(!("filter"in e))return de(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new G3(s,i),a=r.targetId;t=new Qk(a,o)}}return t}function Wd(n,e){let t;if(e instanceof $c)t={update:oT(n,e.key,e.value)};else if(e instanceof Bc)t={delete:qd(n,e.key)};else if(e instanceof Ni)t={update:oT(n,e.key,e.data),updateMask:a5(e.fieldMask)};else{if(!(e instanceof Fw))return de(16599,{Vt:e.type});t={verify:qd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof xc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Oa)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Va)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ec)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw de(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Z3(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:de(27497)}(n,e.precondition)),t}function Cv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?tn.updateTime(pn(i.updateTime)):i.exists!==void 0?tn.exists(i.exists):tn.none()}(e.currentDocument):tn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)me(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new xc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Oa(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Va(h)}else"increment"in a?l=new Ec(o,a.increment):de(16584,{proto:a});const u=en.fromServerFormat(a.fieldPath);return new Eh(u,l)}(n,s)):[];if(e.update){e.update.name;const s=Ws(n,e.update.name),i=new Wn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new yr(u.map(h=>en.fromServerFormat(h)))}(e.updateMask);return new Ni(s,i,o,t,r)}return new $c(s,i,t,r)}if(e.delete){const s=Ws(n,e.delete);return new Bc(s,t)}if(e.verify){const s=Ws(n,e.verify);return new Fw(s,t)}return de(1463,{proto:e})}function n5(n,e){return n&&n.length>0?(me(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?pn(s.updateTime):pn(i);return o.isEqual(we.min())&&(o=pn(i)),new z3(o,s.transformResults||[])}(t,e))):[]}function tN(n,e){return{documents:[Xk(n,e.path)]}}function um(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Xk(n,s);const i=function(u){if(u.length!==0)return iN(Tt.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(g){return{field:Ki(g.field),direction:s5(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Tv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function nN(n,e,t,r){const{ft:s,parent:i}=um(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Ki(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Ki(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function rN(n){let e=Zk(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){me(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=sN(f);return g instanceof Tt&&Lw(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(w){return new zd(Il(w.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,_h(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new Lo(y,g)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const g=!f.before,y=f.values||[];return new Lo(y,g)}(t.endAt)),Ak(e,s,o,i,a,"F",l,u)}function r5(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function sN(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Il(t.unaryFilter.field);return ot.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Il(t.unaryFilter.field);return ot.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Il(t.unaryFilter.field);return ot.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Il(t.unaryFilter.field);return ot.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return de(61313);default:return de(60726)}}(n):n.fieldFilter!==void 0?function(t){return ot.create(Il(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return de(58110);default:return de(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Tt.create(t.compositeFilter.filters.map(r=>sN(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return de(1026)}}(t.compositeFilter.op))}(n):de(30097,{filter:n})}function s5(n){return K3[n]}function i5(n){return Y3[n]}function o5(n){return J3[n]}function Ki(n){return{fieldPath:n.canonicalString()}}function Il(n){return en.fromServerFormat(n.fieldPath)}function iN(n){return n instanceof ot?function(t){if(t.op==="=="){if(qS(t.value))return{unaryFilter:{field:Ki(t.field),op:"IS_NAN"}};if(zS(t.value))return{unaryFilter:{field:Ki(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(qS(t.value))return{unaryFilter:{field:Ki(t.field),op:"IS_NOT_NAN"}};if(zS(t.value))return{unaryFilter:{field:Ki(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ki(t.field),op:i5(t.op),value:t.value}}}(n):n instanceof Tt?function(t){const r=t.getFilters().map(s=>iN(s));return r.length===1?r[0]:{compositeFilter:{op:o5(t.op),filters:r}}}(n):de(54877,{filter:n})}function a5(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function oN(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t,r,s,i=we.min(),o=we.min(),a=dn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new di(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new di(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new di(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new di(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e){this.yt=e}}function l5(n,e){let t;if(e.document)t=cm(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=se.fromSegments(e.noDocument.path),s=ja(e.noDocument.readTime);t=Gt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return de(56709);{const r=se.fromSegments(e.unknownDocument.path),s=ja(e.unknownDocument.version);t=Gt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new yt(s[0],s[1]);return we.fromTimestamp(i)}(e.readTime)),t}function aT(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Zg(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:qd(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Sc(i,o.version.toTimestamp()),createTime:Sc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Fa(e.version)};else{if(!e.isUnknownDocument())return de(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Fa(e.version)}}return r}function Zg(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Fa(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ja(n){const e=new yt(n.seconds,n.nanoseconds);return we.fromTimestamp(e)}function oa(n,e){const t=(e.baseMutations||[]).map(i=>Cv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Cv(n.yt,i)),s=yt.fromMillis(e.localWriteTimeMs);return new jw(e.batchId,s,t,r)}function Pu(n){const e=ja(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ja(n.lastLimboFreeSnapshotVersion):we.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return me(o===1,1966,{count:o}),or(Uc(Zk(i.documents[0])))}(n.query):function(i){return or(rN(i))}(n.query),new di(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,dn.fromBase64String(n.resumeToken))}function lN(n,e){const t=Fa(e.snapshotVersion),r=Fa(e.lastLimboFreeSnapshotVersion);let s;s=Yg(e.target)?tN(n.yt,e.target):um(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ma(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function dm(n){const e=rN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Xg(e,e.limit,"L"):e}function ky(n,e){return new $w(e.largestBatchId,Cv(n.yt,e.overlayMutation))}function lT(n,e){const t=e.path.lastSegment();return[n,ir(e.path.popLast()),t]}function cT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Fa(r.readTime),documentKey:ir(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5{getBundleMetadata(e,t){return uT(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ja(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return uT(e).put(function(s){return{bundleId:s.id,createTime:Fa(pn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return dT(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:dm(i.bundledQuery),readTime:ja(i.readTime)}}(r)})}saveNamedQuery(e,t){return dT(e).put(function(s){return{name:s.name,readTime:Fa(pn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function uT(n){return Sn(n,tm)}function dT(n){return Sn(n,nm)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new hm(e,r)}getOverlay(e,t){return mu(e).get(lT(this.userId,t)).next(r=>r?ky(this.serializer,r):null)}getOverlays(e,t){const r=js();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new $w(t,o);s.push(this.St(e,a))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(ir(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(mu(e).Z(yv,a))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=js(),i=ir(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return mu(e).J(yv,o).next(a=>{for(const l of a){const u=ky(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=js();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return mu(e).ee({index:sk,range:a},(l,u,h)=>{const f=ky(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return mu(e).put(function(s,i,o){const[a,l,u]=lT(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Wd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function mu(n){return Sn(n,rm)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{bt(e){return Sn(e,kw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?dn.fromUint8Array(r):dn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Yt(e.integerValue));else if("doubleValue"in e){const r=Yt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Md(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=xi(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ei(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?yk(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):om(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):de(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=vc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(Yt(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),se.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}aa.Kt=new aa;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pl=255;function d5(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function hT(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=d5(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class h5{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=hT(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=hT(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(pl),this.sn(255)}_n(){this.an(pl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===pl?(this.sn(pl),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===pl?(this.an(pl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class f5{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class g5{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class yu{constructor(){this.cn=new h5,this.ln=new f5(this.cn),this.hn=new g5(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new la(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Yf(this.En),directionalValue:Yf(this.dn),orderedDocumentKey:Yf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function $i(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=fT(n.En,e.En),t!==0?t:(t=fT(n.dn,e.dn),t!==0?t:se.comparator(n.In,e.In)))}function fT(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Yf(n){return o1()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function gT(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class pT{constructor(e){this.mn=new At((t,r)=>en.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(me(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=gv(e);if(t!==void 0&&!this.wn(t))return!1;const r=ra(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new At(en.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new va(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new va(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new va(r.field,r.dir==="asc"?0:1)));return new fc(fc.UNKNOWN_ID,this.collectionId,t,gc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cN(n){var t,r;if(me(n instanceof ot||n instanceof Tt,20012),n instanceof ot){if(n instanceof bk){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>ot.create(n.field,"==",i)))||[];return Tt.create(s,"or")}return n}const e=n.filters.map(s=>cN(s));return Tt.create(e,n.op)}function p5(n){if(n.getFilters().length===0)return[];const e=Nv(cN(n));return me(uN(e),7391),Rv(e)||kv(e)?[e]:e.getFilters()}function Rv(n){return n instanceof ot}function kv(n){return n instanceof Tt&&Lw(n)}function uN(n){return Rv(n)||kv(n)||function(t){if(t instanceof Tt&&Iv(t)){for(const r of t.getFilters())if(!Rv(r)&&!kv(r))return!1;return!0}return!1}(n)}function Nv(n){if(me(n instanceof ot||n instanceof Tt,34018),n instanceof ot)return n;if(n.filters.length===1)return Nv(n.filters[0]);const e=n.filters.map(r=>Nv(r));let t=Tt.create(e,n.op);return t=ep(t),uN(t)?t:(me(t instanceof Tt,64498),me(Ic(t),40251),me(t.filters.length>1,57927),t.filters.reduce((r,s)=>qw(r,s)))}function qw(n,e){let t;return me(n instanceof ot||n instanceof Tt,38388),me(e instanceof ot||e instanceof Tt,25473),t=n instanceof ot?e instanceof ot?function(s,i){return Tt.create([s,i],"and")}(n,e):mT(n,e):e instanceof ot?mT(e,n):function(s,i){if(me(s.filters.length>0&&i.filters.length>0,48005),Ic(s)&&Ic(i))return Ek(s,i.getFilters());const o=Iv(s)?s:i,a=Iv(s)?i:s,l=o.filters.map(u=>qw(u,a));return Tt.create(l,"or")}(n,e),ep(t)}function mT(n,e){if(Ic(e))return Ek(e,n.getFilters());{const t=e.filters.map(r=>qw(n,r));return Tt.create(t,"or")}}function ep(n){if(me(n instanceof ot||n instanceof Tt,11850),n instanceof ot)return n;const e=n.getFilters();if(e.length===1)return ep(e[0]);if(Ik(n))return n;const t=e.map(s=>ep(s)),r=[];return t.forEach(s=>{s instanceof ot?r.push(s):s instanceof Tt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Tt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5{constructor(){this.Cn=new Ww}addToCollectionParentIndex(e,t){return this.Cn.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(Ur.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(Ur.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class Ww{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new At(tt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new At(tt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yT="IndexedDbIndexManager",_f=new Uint8Array(0);class y5{constructor(e,t){this.databaseId=t,this.vn=new Ww,this.Fn=new ki(r=>Ma(r),(r,s)=>wh(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:ir(s)};return _T(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[qR(t),""],!1,!0);return _T(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Fs(o.parent))}return r})}addFieldIndex(e,t){const r=_u(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=yl(e);return i.next(a=>{o.put(cT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=_u(e),s=yl(e),i=ml(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=_u(e),r=ml(e),s=yl(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return O.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new pT(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=ml(e);let s=!0;const i=new Map;return O.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=ze();const a=[];return O.forEach(i,(l,u)=>{Q(yT,`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(D=>`${D.fieldPath}:${D.kind}`).join(",")}`}(l)} to execute ${Ma(t)}`);const h=function(R,D){const U=gv(D);if(U===void 0)return null;for(const P of Jg(R,U.fieldPath))switch(P.op){case"array-contains-any":return P.value.arrayValue.values||[];case"array-contains":return[P.value]}return null}(u,l),f=function(R,D){const U=new Map;for(const P of ra(D))for(const T of Jg(R,P.fieldPath))switch(T.op){case"==":case"in":U.set(P.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return U.set(P.fieldPath.canonicalString(),T.value),Array.from(U.values())}return null}(u,l),g=function(R,D){const U=[];let P=!0;for(const T of ra(D)){const v=T.kind===0?KS(R,T.fieldPath,R.startAt):YS(R,T.fieldPath,R.startAt);U.push(v.value),P&&(P=v.inclusive)}return new Lo(U,P)}(u,l),y=function(R,D){const U=[];let P=!0;for(const T of ra(D)){const v=T.kind===0?YS(R,T.fieldPath,R.endAt):KS(R,T.fieldPath,R.endAt);U.push(v.value),P&&(P=v.inclusive)}return new Lo(U,P)}(u,l),w=this.On(l,u,g),C=this.On(l,u,y),N=this.Nn(l,u,f),A=this.Bn(l.indexId,h,w,g.inclusive,C,y.inclusive,N);return O.forEach(A,x=>r.Y(x,t.limit).next(R=>{R.forEach(D=>{const U=se.fromSegments(D.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}return O.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=p5(Tt.create(e.filters,"and")).map(r=>Ev(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.Ln(t[f/u]):_f,y=this.kn(e,g,r[f%u],s),w=this.qn(e,g,i[f%u],o),C=a.map(N=>this.kn(e,g,N,!0));h.push(...this.createRange(y,w,C))}return h}kn(e,t,r,s){const i=new la(e,se.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new la(e,se.empty(),t,r);return s?i.An():i}xn(e,t){const r=new pT(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return O.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new At(en.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:u=u.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new yu;for(const s of ra(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);aa.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new yu;return aa.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new yu;return aa.Kt.Dt(La(this.databaseId,t),r.Pn(function(i){const o=ra(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new yu);let i=0;for(const o of ra(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&Bd(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);aa.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new yu;l.seed(a.un()),aa.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof ot&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=_u(e),s=yl(e);return(t?r.J(mv,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return O.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new gc(f.sequenceNumber,new Ur(ja(f.readTime),new se(Fs(f.documentKey)),f.largestBatchId)):gc.empty(),y=h.fields.map(([w,C])=>new va(en.fromServerFormat(w),C));return new fc(h.indexId,h.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:De(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=_u(e),i=yl(e);return this.Gn(e).next(o=>s.J(mv,IDBKeyRange.bound(t,t)).next(a=>O.forEach(a,l=>i.put(cT(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?O.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),O.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?O.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return ml(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return ml(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=ml(e);let i=new At($i);return s.ee({index:rk,range:IDBKeyRange.only([r.indexId,this.uid,Yf(this.$n(r,t))])},(o,a)=>{i=i.add(new la(r.indexId,t,gT(a.arrayValue),gT(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new At($i);const s=this.Qn(t,e);if(s==null)return r;const i=gv(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Bd(o))for(const a of o.arrayValue.values||[])r=r.add(new la(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new la(t.indexId,e.key,_f,s));return r}Jn(e,t,r,s,i){Q(yT,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,g){const y=l.getIterator(),w=u.getIterator();let C=gl(y),N=gl(w);for(;C||N;){let A=!1,x=!1;if(C&&N){const R=h(C,N);R<0?x=!0:R>0&&(A=!0)}else C!=null?x=!0:A=!0;A?(f(N),N=gl(w)):x?(g(C),C=gl(y)):(C=gl(y),N=gl(w))}}(s,i,$i,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),O.waitFor(o)}Gn(e){let t=1;return yl(e).ee({index:nk,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>$i(o,a)).filter((o,a,l)=>!a||$i(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=$i(o,e),l=$i(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,_f,se.empty()),l=s[o+1].Vn(this.uid,_f,se.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return $i(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(vT)}getMinOffset(e,t){return O.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||de(44426))).next(vT)}}function _T(n){return Sn(n,Fd)}function ml(n){return Sn(n,Ju)}function _u(n){return Sn(n,Rw)}function yl(n){return Sn(n,Yu)}function vT(n){me(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;bw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ur(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dN=41943040;class nr{static withCacheSize(e){return new nr(e,nr.DEFAULT_COLLECTION_PERCENTILE,nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hN(n,e,t){const r=n.store(fs),s=n.store(pc),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{me(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=ZR(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return O.waitFor(i).next(()=>u)}function tp(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw de(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nr.DEFAULT_COLLECTION_PERCENTILE=10,nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nr.DEFAULT=new nr(dN,nr.DEFAULT_COLLECTION_PERCENTILE,nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nr.DISABLED=new nr(-1,0,0);class fm{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){me(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new fm(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Bi(e).ee({index:fa,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=xl(e),o=Bi(e);return o.add({}).next(a=>{me(typeof a=="number",49019);const l=new jw(a,t,r,s),u=function(y,w,C){const N=C.baseMutations.map(x=>Wd(y.yt,x)),A=C.mutations.map(x=>Wd(y.yt,x));return{userId:w,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:N,mutations:A}}(this.serializer,this.userId,l),h=[];let f=new At((g,y)=>De(g.canonicalString(),y.canonicalString()));for(const g of s){const y=ZR(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,Z4))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),O.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return Bi(e).get(t).next(r=>r?(me(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),oa(this.serializer,r)):null)}er(e,t){return this.Xn[t]?O.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Bi(e).ee({index:fa,range:s},(o,a,l)=>{a.userId===this.userId&&(me(a.batchId>=r,47524,{tr:r}),i=oa(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=xo;return Bi(e).ee({index:fa,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,xo],[this.userId,Number.POSITIVE_INFINITY]);return Bi(e).J(fa,t).next(r=>r.map(s=>oa(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=zf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return xl(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,g=Fs(h);if(u===this.userId&&t.path.isEqual(g))return Bi(e).get(f).next(y=>{if(!y)throw de(61480,{nr:o,batchId:f});me(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(oa(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new At(De);const s=[];return t.forEach(i=>{const o=zf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=xl(e).ee({range:a},(u,h,f)=>{const[g,y,w]=u,C=Fs(y);g===this.userId&&i.path.isEqual(C)?r=r.add(w):f.done()});s.push(l)}),O.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=zf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new At(De);return xl(e).ee({range:o},(l,u,h)=>{const[f,g,y]=l,w=Fs(g);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Bi(e).get(i).next(o=>{if(o===null)throw de(35274,{batchId:i});me(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(oa(this.serializer,o))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return hN(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return xl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Fs(i[1]);s.push(l)}else a.done()}).next(()=>{me(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return fN(e,this.userId,t)}_r(e){return gN(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:xo,lastStreamToken:""})}}function fN(n,e,t){const r=zf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return xl(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function Bi(n){return Sn(n,fs)}function xl(n){return Sn(n,pc)}function gN(n){return Sn(n,Od)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ua(0)}static cr(){return new Ua(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Ua(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>we.fromTimestamp(new yt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>_l(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(me(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return _l(e).ee((o,a)=>{const l=Pu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return _l(e).ee((r,s)=>{const i=Pu(s);t(i)})}lr(e){return IT(e).get(Kg).next(t=>(me(t!==null,2888),t))}hr(e,t){return IT(e).put(Kg,t)}Pr(e,t){return _l(e).put(lN(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ma(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return _l(e).ee({range:s,index:tk},(o,a,l)=>{const u=Pu(a);wh(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Yi(e);return t.forEach(o=>{const a=ir(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=Yi(e);return O.forEach(t,i=>{const o=ir(i.path);return O.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Yi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Yi(e);let i=ze();return s.ee({range:r,X:!0},(o,a,l)=>{const u=Fs(o[1]),h=new se(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=ir(t.path),s=IDBKeyRange.bound([r],[qR(r)],!1,!0);let i=0;return Yi(e).ee({index:Cw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return _l(e).get(t).next(r=>r?Pu(r):null)}}function _l(n){return Sn(n,mc)}function IT(n){return Sn(n,wa)}function Yi(n){return Sn(n,yc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT="LruGarbageCollector",pN=1048576;function ET([n,e],[t,r]){const s=De(n,t);return s===0?De(e,r):s}class v5{constructor(e){this.Ir=e,this.buffer=new At(ET),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();ET(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class mN{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Q(xT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){zo(t)?Q(xT,"Ignoring IndexedDB error during garbage collection: ",t):await Bo(t)}await this.Vr(3e5)})}}class w5{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(mr.ce);const r=new v5(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Q("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(wT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wT):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(Q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),vl()<=rt.DEBUG&&Q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function yN(n,e){return new w5(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5{constructor(e,t){this.db=e,this.garbageCollector=yN(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return vf(e,r)}removeReference(e,t,r){return vf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return vf(e,t)}br(e,t){return function(s,i){let o=!1;return gN(s).te(a=>fN(s,a,i).next(l=>(l&&(o=!0),O.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,we.min()),Yi(e).delete(function(f){return[0,ir(f.path)]}(o))))});s.push(l)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return vf(e,t)}Sr(e,t){const r=Yi(e);let s,i=mr.ce;return r.ee({index:Cw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==mr.ce&&t(new se(Fs(s)),i),i=u,s=l):i=mr.ce}).next(()=>{i!==mr.ce&&t(new se(Fs(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function vf(n,e){return Yi(n).put(function(r,s){return{targetId:0,path:ir(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _N{constructor(){this.changes=new ki(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Gt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Xo(e).put(r)}removeEntry(e,t,r){return Xo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Zg(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Gt.newInvalidDocument(t);return Xo(e).ee({index:qf,range:IDBKeyRange.only(vu(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Gt.newInvalidDocument(t)};return Xo(e).ee({index:qf,range:IDBKeyRange.only(vu(t))},(s,i)=>{r={document:this.Cr(t,i),size:tp(i)}}).next(()=>r)}getEntries(e,t){let r=_r();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=_r(),s=new Bt(se.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,tp(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return O.resolve();let s=new At(bT);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(vu(s.first()),vu(s.last())),o=s.getIterator();let a=o.getNext();return Xo(e).ee({index:qf,range:i},(l,u,h)=>{const f=se.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&bT(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(vu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Zg(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xo(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=_r();for(const f of u){const g=this.Cr(se.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(xh(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=_r();const o=TT(t,r),a=TT(t,Ur.max());return Xo(e).ee({index:ek,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(se.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new E5(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ST(e).get(pv).next(t=>(me(!!t,20021),t))}Dr(e,t){return ST(e).put(pv,t)}Cr(e,t){if(t){const r=l5(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(we.min())))return r}return Gt.newInvalidDocument(e)}}function vN(n){return new x5(n)}class E5 extends _N{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new ki(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new At((i,o)=>De(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=aT(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=tp(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=aT(this.Nr.serializer,o.convertToNoDocument(we.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function ST(n){return Sn(n,Vd)}function Xo(n){return Sn(n,Qg)}function vu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function TT(n,e){const t=e.documentKey.path.toArray();return[n,Zg(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function bT(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=De(t[i],r[i]),s)return s;return s=De(t.length,r.length),s||(s=De(t[t.length-2],r[r.length-2]),s||De(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S5{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wN{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&ed(r.mutation,s,yr.empty(),yt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ze()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ze()){const s=js();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=ku();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=js();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ze()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=_r();const o=Zu(),a=function(){return Zu()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Ni)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),ed(h.mutation,u,h.mutation.getFieldMask(),yt.now())):o.set(u.key,yr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new S5(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Zu();let s=new Bt((o,a)=>o-a),i=ze();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||yr.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||ze()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=Mk();h.forEach(g=>{if(!i.has(g)){const y=Bk(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return O.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Mw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(js());let a=hc,l=i;return o.next(u=>O.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?O.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,ze())).next(h=>({batchId:a,changes:Lk(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new se(t)).next(r=>{let s=ku();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=ku();return this.indexManager.getCollectionParents(e,i).next(a=>O.forEach(a,l=>{const u=function(f,g){return new Ri(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Gt.newInvalidDocument(h)))});let a=ku();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&ed(h.mutation,u,yr.empty(),yt.now()),xh(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return O.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:pn(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:dm(s.bundledQuery),readTime:pn(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5{constructor(){this.overlays=new Bt(se.comparator),this.qr=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=js();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=js(),i=t.length+1,o=new se(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Bt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=js(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=js(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return O.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new $w(t,r));let i=this.qr.get(t);i===void 0&&(i=ze(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(){this.sessionToken=dn.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(){this.Qr=new At(kn.$r),this.Ur=new At(kn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new kn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new kn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new se(new tt([])),r=new kn(t,e),s=new kn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new se(new tt([])),r=new kn(t,e),s=new kn(t,e+1);let i=ze();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new kn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class kn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return se.comparator(e.key,t.key)||De(e.Yr,t.Yr)}static Kr(e,t){return De(e.Yr,t.Yr)||se.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new At(kn.$r)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new jw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new kn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return O.resolve(o)}lookupMutationBatch(e,t){return O.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?xo:this.tr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new kn(t,0),s=new kn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new At(De);return t.forEach(s=>{const i=new kn(s,0),o=new kn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),O.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;se.isDocumentKey(i)||(i=i.child(""));const o=new kn(new se(i),0);let a=new At(De);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),O.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){me(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return O.forEach(t.mutations,s=>{const i=new kn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new kn(t,0),s=this.Zr.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{constructor(e){this.ri=e,this.docs=function(){return new Bt(se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():Gt.newInvalidDocument(t))}getEntries(e,t){let r=_r();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Gt.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=_r();const o=t.path,a=new se(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||bw(QR(h),r)<=0||(s.has(h.key)||xh(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){de(9500)}ii(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new k5(this)}getSize(e){return O.resolve(this.size)}}class k5 extends _N{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N5{constructor(e){this.persistence=e,this.si=new ki(t=>Ma(t),wh),this.lastRemoteSnapshotVersion=we.min(),this.highestTargetId=0,this.oi=0,this._i=new Gw,this.targetCount=0,this.ai=Ua.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),O.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ua(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Pr(t),O.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{constructor(e,t){this.ui={},this.overlays={},this.ci=new mr(0),this.li=!1,this.li=!0,this.hi=new A5,this.referenceDelegate=e(this),this.Pi=new N5(this),this.indexManager=new m5,this.remoteDocumentCache=function(s){return new R5(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new aN(t),this.Ii=new T5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new b5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new C5(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Q("MemoryPersistence","Starting transaction:",e);const s=new P5(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return O.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class P5 extends YR{constructor(e){super(),this.currentSequenceNumber=e}}class gm{constructor(e){this.persistence=e,this.Ri=new Gw,this.Vi=null}static mi(e){return new gm(e)}get fi(){if(this.Vi)return this.Vi;throw de(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),O.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.fi,r=>{const s=se.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,we.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return O.or([()=>O.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class np{constructor(e,t){this.persistence=e,this.pi=new ki(r=>ir(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=yN(this,t)}static mi(e,t){return new np(e,t)}Ei(){}di(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return O.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?O.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,we.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),O.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Gf(e.data.value)),t}br(e,t,r){return O.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D5{constructor(e){this.serializer=e}k(e,t,r,s){const i=new em("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(vh)}(e),function(l){l.createObjectStore(Od,{keyPath:X4}),l.createObjectStore(fs,{keyPath:VS,autoIncrement:!0}).createIndex(fa,FS,{unique:!0}),l.createObjectStore(pc)}(e),AT(e),function(l){l.createObjectStore(sa)}(e));let o=O.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(yc),l.deleteObjectStore(mc),l.deleteObjectStore(wa)}(e),AT(e)),o=o.next(()=>function(l){const u=l.store(wa),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:we.min().toTimestamp(),targetCount:0};return u.put(Kg,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(fs).J().next(f=>{l.deleteObjectStore(fs),l.createObjectStore(fs,{keyPath:VS,autoIncrement:!0}).createIndex(fa,FS,{unique:!0});const g=u.store(fs),y=f.map(w=>g.put(w));return O.waitFor(y)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(_c,{keyPath:a3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(Vd)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(tm,{keyPath:l3})})(e),function(l){l.createObjectStore(nm,{keyPath:c3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(rm,{keyPath:m3});u.createIndex(yv,y3,{unique:!1}),u.createIndex(sk,_3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(Qg,{keyPath:e3});u.createIndex(qf,t3),u.createIndex(ek,n3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(sa))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(Rw,{keyPath:u3,autoIncrement:!0}).createIndex(mv,d3,{unique:!1}),l.createObjectStore(Yu,{keyPath:h3}).createIndex(nk,f3,{unique:!1}),l.createObjectStore(Ju,{keyPath:g3}).createIndex(rk,p3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(Yu).clear()}).next(()=>{t.objectStore(Ju).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(kw,{keyPath:v3})})(e)})),r<18&&s>=18&&o1()&&(o=o.next(()=>{t.objectStore(Yu).clear()}).next(()=>{t.objectStore(Ju).clear()})),o}wi(e){let t=0;return e.store(sa).ee((r,s)=>{t+=tp(s)}).next(()=>{const r={byteSize:t};return e.store(Vd).put(pv,r)})}yi(e){const t=e.store(Od),r=e.store(fs);return t.J().next(s=>O.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,xo],[i.userId,i.lastAcknowledgedBatchId]);return r.J(fa,o).next(a=>O.forEach(a,l=>{me(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=oa(this.serializer,l);return hN(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(yc),r=e.store(sa);return e.store(wa).get(Kg).next(s=>{const i=[];return r.ee((o,a)=>{const l=new tt(o),u=function(f){return[0,ir(f)]}(l);i.push(t.get(u).next(h=>h?O.resolve():(f=>t.put({targetId:0,path:ir(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>O.waitFor(i))})}bi(e,t){e.createObjectStore(Fd,{keyPath:o3});const r=t.store(Fd),s=new Ww,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:ir(l)})}};return t.store(sa).ee({X:!0},(o,a)=>{const l=new tt(o);return i(l.popLast())}).next(()=>t.store(pc).ee({X:!0},([o,a,l],u)=>{const h=Fs(a);return i(h.popLast())}))}Di(e){const t=e.store(mc);return t.ee((r,s)=>{const i=Pu(s),o=lN(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(sa),s=[];return r.ee((i,o)=>{const a=t.store(Qg),l=function(f){return f.document?new se(tt.fromString(f.document.name).popFirst(5)):f.noDocument?se.fromSegments(f.noDocument.path):f.unknownDocument?se.fromSegments(f.unknownDocument.path):de(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>O.waitFor(s))}Fi(e,t){const r=t.store(fs),s=vN(this.serializer),i=new Hw(gm.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??ze();oa(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),O.forEach(a,(l,u)=>{const h=new Pn(u),f=hm.wt(this.serializer,h),g=i.getIndexManager(h),y=fm.wt(h,this.serializer,g,i.referenceDelegate);return new wN(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new _v(t,mr.ce),l).next()})})}}function AT(n){n.createObjectStore(yc,{keyPath:s3}).createIndex(Cw,i3,{unique:!0}),n.createObjectStore(mc,{keyPath:"targetId"}).createIndex(tk,r3,{unique:!0}),n.createObjectStore(wa)}const zi="IndexedDbPersistence",Ny=18e5,Py=5e3,Dy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",IN="main";class Qw{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=g=>Promise.resolve(),!Qw.v())throw new q(j.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new I5(this,s),this.$i=t+IN,this.serializer=new aN(l),this.Ui=new qs(this.$i,this.Ni,new D5(this.serializer)),this.hi=new u5,this.Pi=new _5(this.referenceDelegate,this.serializer),this.remoteDocumentCache=vN(this.serializer),this.Ii=new c5,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&gn(zi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new q(j.FAILED_PRECONDITION,Dy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new mr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>wf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(zo(e))return Q(zi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Q(zi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return wu(e).get(fl).next(t=>O.resolve(this.es(t)))}ts(e){return wf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ny)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Sn(t,_c);return r.J().next(s=>{const i=this.ss(s,Ny),o=s.filter(a=>i.indexOf(a)===-1);return O.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?O.resolve(!0):wu(e).get(fl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Py)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new q(j.FAILED_PRECONDITION,Dy);return!1}}return!(!this.networkEnabled||!this.inForeground)||wf(e).J().next(r=>this.ss(r,Py).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&Q(zi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[vh,_c],e=>{const t=new _v(e,mr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>wf(e).J().next(t=>this.ss(t,Ny).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return fm.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new y5(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return hm.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){Q(zi,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?x3:l===17?lk:l===16?I3:l===15?Nw:l===14?ak:l===13?ok:l===12?w3:l===11?ik:void de(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new _v(a,this.ci?this.ci.next():mr.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw gn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new q(j.FAILED_PRECONDITION,KR);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return wu(e).get(fl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Py)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new q(j.FAILED_PRECONDITION,Dy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return wu(e).put(fl,t)}static v(){return qs.v()}Zi(e){const t=wu(e);return t.get(fl).next(r=>this.es(r)?(Q(zi,"Releasing primary lease."),t.delete(fl)):O.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(gn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;i1()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return Q(zi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return gn(zi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){gn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function wu(n){return Sn(n,vh)}function wf(n){return Sn(n,_c)}function Kw(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=ze(),s=ze();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Yw(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return i1()?8:JR(En())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new L5;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(vl()<=rt.DEBUG&&Q("QueryEngine","SDK will not create cache indexes for query:",wl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),O.resolve()):(vl()<=rt.DEBUG&&Q("QueryEngine","Query:",wl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(vl()<=rt.DEBUG&&Q("QueryEngine","The SDK decides to create cache indexes for query:",wl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,or(t))):O.resolve())}ys(e,t){if(JS(t))return O.resolve(null);let r=or(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Xg(t,null,"F"),r=or(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ze(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,Xg(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return JS(t)||s.isEqual(we.min())?O.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?O.resolve(null):(vl()<=rt.DEBUG&&Q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),wl(t)),this.vs(e,o,t,HR(s,hc)).next(a=>a))})}Ds(e,t){let r=new At(Pk(e));return t.forEach((s,i)=>{xh(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return vl()<=rt.DEBUG&&Q("QueryEngine","Using full collection scan to execute query:",wl(t)),this.ps.getDocumentsMatchingQuery(e,t,Ur.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jw="LocalStore",M5=3e8;class O5{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Bt(De),this.xs=new ki(i=>Ma(i),wh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function EN(n,e,t,r){return new O5(n,e,t,r)}async function SN(n,e){const t=ie(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ze();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function V5(n,e){const t=ie(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,g=f.keys();let y=O.resolve();return g.forEach(w=>{y=y.next(()=>h.getEntry(l,w)).next(C=>{const N=u.docVersions.get(w);me(N!==null,48541),C.version.compareTo(N)<0&&(f.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),h.addEntry(C)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ze();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function TN(n){const e=ie(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function F5(n,e){const t=ie(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(dn.EMPTY_BYTE_STRING,we.min()).withLastLimboFreeSnapshotVersion(we.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(C,N,A){return C.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=M5?!0:A.addedDocuments.size+A.modifiedDocuments.size+A.removedDocuments.size>0}(g,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let l=_r(),u=ze();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(bN(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(we.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return O.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function bN(n,e,t){let r=ze(),s=ze();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=_r();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(we.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Q(Jw,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function j5(n,e){const t=ie(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=xo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Tc(n,e){const t=ie(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new di(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function bc(n,e,t){const r=ie(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!zo(o))throw o;Q(Jw,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function rp(n,e,t){const r=ie(n);let s=we.min(),i=ze();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=ie(l),g=f.xs.get(h);return g!==void 0?O.resolve(f.Ms.get(g)):f.Pi.getTargetData(u,h)}(r,o,or(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:we.min(),t?i:ze())).next(a=>(RN(r,Nk(e),a),{documents:a,Qs:i})))}function AN(n,e){const t=ie(n),r=ie(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function CN(n,e){const t=ie(n),r=t.Os.get(e)||we.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,HR(r,hc),Number.MAX_SAFE_INTEGER)).then(s=>(RN(t,e,s),s))}function RN(n,e,t){let r=n.Os.get(e)||we.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function U5(n,e,t,r){const s=ie(n);let i=ze(),o=_r();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Tc(s,function(h){return or(Uc(tt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>bN(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function $5(n,e,t=ze()){const r=await Tc(n,or(dm(e.bundledQuery))),s=ie(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=pn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(dn.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kN="firestore_clients";function CT(n,e){return`${kN}_${n}_${e}`}const NN="firestore_mutations";function RT(n,e,t){let r=`${NN}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const PN="firestore_targets";function Ly(n,e){return`${PN}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls="SharedClientState";class sp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new q(s.error.code,s.error.message))),o?new sp(e,t,s.state,i):(gn(Ls,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class nd{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new q(r.error.code,r.error.message))),i?new nd(e,r.state,s):(gn(Ls,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ip{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Ow();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=XR(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new ip(e,i):(gn(Ls,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Xw{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Xw(t.clientId,t.onlineState):(gn(Ls,`Failed to parse online state: ${e}`),null)}}class Pv{constructor(){this.activeTargetIds=Ow()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class My{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Bt(De),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=CT(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Pv),this.ro=new RegExp(`^${kN}_${o}_([^_]*)$`),this.io=new RegExp(`^${NN}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${PN}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(CT(this.persistenceKey,r));if(s){const i=ip.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Ly(this.persistenceKey,e));if(s){const i=nd.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ly(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Q(Ls,"READ",e,t),t}setItem(e,t){Q(Ls,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Q(Ls,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(Q(Ls,"EVENT",t.key,t.newValue),t.key===this.eo)return void gn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=mr.ce;if(i!=null)try{const a=JSON.parse(i);me(typeof a=="number",30636,{So:i}),o=a}catch(a){gn(Ls,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==mr.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new sp(this.currentUser,e,t,r),i=RT(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=RT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=Ly(this.persistenceKey,e),i=new nd(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return ip.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return sp.Ws(new Pn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return nd.Ws(s,t)}uo(e){return Xw.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);Q(Ls,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=Ow();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class DN{constructor(){this.Mo=new Pv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Pv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kT="ConnectivityMonitor";class NT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Q(kT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Q(kT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let If=null;function Dv(){return If===null?If=function(){return 268435456+Math.round(2147483648*Math.random())}():If++,"0x"+If.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oy="RestConnection",z5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class q5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Ud?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=Dv(),a=this.zo(e,t.toUriEncodedString());Q(Oy,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=Ci(u);return this.Jo(e,a,l,r,h).then(f=>(Q(Oy,`Received RPC '${e}' ${o}: `,f),f),f=>{throw rs(Oy,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+jc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=z5[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr="WebChannelConnection";class G5 extends q5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=Dv();return new Promise((a,l)=>{const u=new VR;u.setWithCredentials(!0),u.listenOnce(FR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Bf.NO_ERROR:const f=u.getResponseJson();Q(tr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case Bf.TIMEOUT:Q(tr,`RPC '${e}' ${o} timed out`),l(new q(j.DEADLINE_EXCEEDED,"Request time out"));break;case Bf.HTTP_ERROR:const g=u.getStatus();if(Q(tr,`RPC '${e}' ${o} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const w=y==null?void 0:y.error;if(w&&w.status&&w.message){const C=function(A){const x=A.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(x)>=0?x:j.UNKNOWN}(w.status);l(new q(C,w.message))}else l(new q(j.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new q(j.UNAVAILABLE,"Connection failed."));break;default:de(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Q(tr,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);Q(tr,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=Dv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=$R(),a=UR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");Q(tr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let g=!1,y=!1;const w=new W5({Yo:N=>{y?Q(tr,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(g||(Q(tr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),Q(tr,`RPC '${e}' stream ${s} sending:`,N),f.send(N))},Zo:()=>f.close()}),C=(N,A,x)=>{N.listen(A,R=>{try{x(R)}catch(D){setTimeout(()=>{throw D},0)}})};return C(f,Ru.EventType.OPEN,()=>{y||(Q(tr,`RPC '${e}' stream ${s} transport opened.`),w.o_())}),C(f,Ru.EventType.CLOSE,()=>{y||(y=!0,Q(tr,`RPC '${e}' stream ${s} transport closed`),w.a_(),this.E_(f))}),C(f,Ru.EventType.ERROR,N=>{y||(y=!0,rs(tr,`RPC '${e}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),w.a_(new q(j.UNAVAILABLE,"The operation could not be completed")))}),C(f,Ru.EventType.MESSAGE,N=>{var A;if(!y){const x=N.data[0];me(!!x,16349);const R=x,D=(R==null?void 0:R.error)||((A=R[0])==null?void 0:A.error);if(D){Q(tr,`RPC '${e}' stream ${s} received error:`,D);const U=D.status;let P=function(b){const _=mn[b];if(_!==void 0)return Gk(_)}(U),T=D.message;P===void 0&&(P=j.INTERNAL,T="Unknown error status: "+U+" with message "+D.message),y=!0,w.a_(new q(P,T)),f.close()}else Q(tr,`RPC '${e}' stream ${s} received:`,x),w.u_(x)}}),C(a,jR.STAT_EVENT,N=>{N.stat===uv.PROXY?Q(tr,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===uv.NOPROXY&&Q(tr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(){return typeof window<"u"?window:null}function Jf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function el(n){return new X3(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&Q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT="PersistentStream";class MN{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Zw(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(gn(t.toString()),gn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new q(j.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Q(PT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Q(PT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class H5 extends MN{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=t5(this.serializer,e),r=function(i){if(!("targetChange"in i))return we.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?we.min():o.readTime?pn(o.readTime):we.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Av(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Yg(l)?{documents:tN(i,l)}:{query:um(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Yk(i,o.resumeToken);const u=Tv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(we.min())>0){a.readTime=Sc(i,o.snapshotVersion.toTimestamp());const u=Tv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=r5(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Av(this.serializer),t.removeTarget=e,this.q_(t)}}class Q5 extends MN{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,me(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=n5(e.writeResults,e.commitTime),r=pn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Av(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Wd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K5{}class Y5 extends K5{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new q(j.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,bv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new q(j.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,bv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(j.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class J5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(gn(t),this.aa=!1):Q("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a="RemoteStore";class X5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Wo(this)&&(Q($a,"Restarting streams for network reachability change."),await async function(l){const u=ie(l);u.Ea.add(4),await zc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await bh(u)}(this))})}),this.Ra=new J5(r,s)}}async function bh(n){if(Wo(n))for(const e of n.da)await e(!0)}async function zc(n){for(const e of n.da)await e(!1)}function pm(n,e){const t=ie(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),nI(t)?tI(t):Wc(t).O_()&&eI(t,e))}function Ac(n,e){const t=ie(n),r=Wc(t);t.Ia.delete(e),r.O_()&&ON(t,e),t.Ia.size===0&&(r.O_()?r.L_():Wo(t)&&t.Ra.set("Unknown"))}function eI(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(we.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wc(n).Y_(e)}function ON(n,e){n.Va.Ue(e),Wc(n).Z_(e)}function tI(n){n.Va=new Q3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Wc(n).start(),n.Ra.ua()}function nI(n){return Wo(n)&&!Wc(n).x_()&&n.Ia.size>0}function Wo(n){return ie(n).Ea.size===0}function VN(n){n.Va=void 0}async function Z5(n){n.Ra.set("Online")}async function e6(n){n.Ia.forEach((e,t)=>{eI(n,e)})}async function t6(n,e){VN(n),nI(n)?(n.Ra.ha(e),tI(n)):n.Ra.set("Unknown")}async function n6(n,e,t){if(n.Ra.set("Online"),e instanceof Kk&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){Q($a,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await op(n,r)}else if(e instanceof Kf?n.Va.Ze(e):e instanceof Qk?n.Va.st(e):n.Va.tt(e),!t.isEqual(we.min()))try{const r=await TN(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(dn.EMPTY_BYTE_STRING,h.snapshotVersion)),ON(i,l);const f=new di(h.target,l,u,h.sequenceNumber);eI(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Q($a,"Failed to raise snapshot:",r),await op(n,r)}}async function op(n,e,t){if(!zo(e))throw e;n.Ea.add(1),await zc(n),n.Ra.set("Offline"),t||(t=()=>TN(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Q($a,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await bh(n)})}function FN(n,e){return e().catch(t=>op(n,t,e))}async function qc(n){const e=ie(n),t=Mo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:xo;for(;r6(e);)try{const s=await j5(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,s6(e,s)}catch(s){await op(e,s)}jN(e)&&UN(e)}function r6(n){return Wo(n)&&n.Ta.length<10}function s6(n,e){n.Ta.push(e);const t=Mo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function jN(n){return Wo(n)&&!Mo(n).x_()&&n.Ta.length>0}function UN(n){Mo(n).start()}async function i6(n){Mo(n).ra()}async function o6(n){const e=Mo(n);for(const t of n.Ta)e.ea(t.mutations)}async function a6(n,e,t){const r=n.Ta.shift(),s=Uw.from(r,e,t);await FN(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await qc(n)}async function l6(n,e){e&&Mo(n).X_&&await async function(r,s){if(function(o){return Wk(o)&&o!==j.ABORTED}(s.code)){const i=r.Ta.shift();Mo(r).B_(),await FN(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await qc(r)}}(n,e),jN(n)&&UN(n)}async function DT(n,e){const t=ie(n);t.asyncQueue.verifyOperationInProgress(),Q($a,"RemoteStore received new credentials");const r=Wo(t);t.Ea.add(3),await zc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await bh(t)}async function Lv(n,e){const t=ie(n);e?(t.Ea.delete(2),await bh(t)):e||(t.Ea.add(2),await zc(t),t.Ra.set("Unknown"))}function Wc(n){return n.ma||(n.ma=function(t,r,s){const i=ie(t);return i.sa(),new H5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:Z5.bind(null,n),t_:e6.bind(null,n),r_:t6.bind(null,n),H_:n6.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),nI(n)?tI(n):n.Ra.set("Unknown")):(await n.ma.stop(),VN(n))})),n.ma}function Mo(n){return n.fa||(n.fa=function(t,r,s){const i=ie(t);return i.sa(),new Q5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:i6.bind(null,n),r_:l6.bind(null,n),ta:o6.bind(null,n),na:a6.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await qc(n)):(await n.fa.stop(),n.Ta.length>0&&(Q($a,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Mn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new rI(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gc(n,e){if(gn("AsyncQueue",`${e}: ${n}`),zo(n))return new q(j.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{static emptySet(e){return new Ia(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||se.comparator(t.key,r.key):(t,r)=>se.comparator(t.key,r.key),this.keyedMap=ku(),this.sortedSet=new Bt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ia)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ia;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LT{constructor(){this.ga=new Bt(se.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):de(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ba{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ba(e,t,Ia.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ih(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c6{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class u6{constructor(){this.queries=MT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=ie(t),i=s.queries;s.queries=MT(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new q(j.ABORTED,"Firestore shutting down"))}}function MT(){return new ki(n=>kk(n),Ih)}async function sI(n,e){const t=ie(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new c6,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Gc(o,`Initialization of query '${wl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&oI(t)}async function iI(n,e){const t=ie(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function d6(n,e){const t=ie(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&oI(t)}function h6(n,e,t){const r=ie(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function oI(n){n.Ca.forEach(e=>{e.next()})}var Mv,OT;(OT=Mv||(Mv={})).Ma="default",OT.Cache="cache";class aI{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ba(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ba.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Mv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VT{constructor(e){this.serializer=e}$s(e){return Ws(this.serializer,e)}Us(e){return e.metadata.exists?cm(this.serializer,e.document,!1):Gt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return pn(e)}}class lI{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=BN(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=tt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new VT(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||ze()).add(i);t.set(o,a)}}return t}async ja(e){const t=await U5(e,new VT(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await $5(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function BN(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(e){this.key=e}}class qN{constructor(e){this.key=e}}class WN{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ze(),this.mutatedKeys=ze(),this.eu=Pk(e),this.tu=new Ia(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new LT,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),y=xh(this.query,f)?f:null,w=!!g&&this.mutatedKeys.has(g.key),C=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let N=!1;g&&y?g.data.isEqual(y.data)?w!==C&&(r.track({type:3,doc:y}),N=!0):this.su(g,y)||(r.track({type:2,doc:y}),N=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),N=!0):g&&!y&&(r.track({type:1,doc:g}),N=!0,(l||u)&&(a=!0)),N&&(y?(o=o.add(y),i=C?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,w){const C=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de(20277,{Rt:N})}};return C(y)-C(w)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Ba(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new LT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ze(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new qN(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new zN(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=ze();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ba.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Go="SyncEngine";class f6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class g6{constructor(e){this.key=e,this.hu=!1}}class p6{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new ki(a=>kk(a),Ih),this.Iu=new Map,this.Eu=new Set,this.du=new Bt(se.comparator),this.Au=new Map,this.Ru=new Gw,this.Vu={},this.mu=new Map,this.fu=Ua.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function m6(n,e,t=!0){const r=mm(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await GN(r,e,t,!0),s}async function y6(n,e){const t=mm(n);await GN(t,e,!0,!1)}async function GN(n,e,t,r){const s=await Tc(n.localStore,or(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await cI(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&pm(n.remoteStore,s),a}async function cI(n,e,t,r,s){n.pu=(f,g,y)=>async function(C,N,A,x){let R=N.view.ru(A);R.Cs&&(R=await rp(C.localStore,N.query,!1).then(({documents:T})=>N.view.ru(T,R)));const D=x&&x.targetChanges.get(N.targetId),U=x&&x.targetMismatches.get(N.targetId)!=null,P=N.view.applyChanges(R,C.isPrimaryClient,D,U);return Ov(C,N.targetId,P.au),P.snapshot}(n,f,g,y);const i=await rp(n.localStore,e,!0),o=new WN(e,i.Qs),a=o.ru(i.documents),l=Th.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);Ov(n,t,u.au);const h=new f6(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function _6(n,e,t){const r=ie(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Ih(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await bc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Ac(r.remoteStore,s.targetId),Cc(r,s.targetId)}).catch(Bo)):(Cc(r,s.targetId),await bc(r.localStore,s.targetId,!0))}async function v6(n,e){const t=ie(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ac(t.remoteStore,r.targetId))}async function w6(n,e,t){const r=fI(n);try{const s=await function(o,a){const l=ie(o),u=yt.now(),h=a.reduce((y,w)=>y.add(w.key),ze());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let w=_r(),C=ze();return l.Ns.getEntries(y,h).next(N=>{w=N,w.forEach((A,x)=>{x.isValidDocument()||(C=C.add(A))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,w)).next(N=>{f=N;const A=[];for(const x of a){const R=W3(x,f.get(x.key).overlayedDocument);R!=null&&A.push(new Ni(x.key,R,vk(R.value.mapValue),tn.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,A,a)}).next(N=>{g=N;const A=N.applyToLocalDocumentSet(f,C);return l.documentOverlayCache.saveOverlays(y,N.batchId,A)})}).then(()=>({batchId:g.batchId,changes:Lk(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new Bt(De)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Pi(r,s.changes),await qc(r.remoteStore)}catch(s){const i=Gc(s,"Failed to persist write");t.reject(i)}}async function HN(n,e){const t=ie(n);try{const r=await F5(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(me(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?me(o.hu,14607):s.removedDocuments.size>0&&(me(o.hu,42227),o.hu=!1))}),await Pi(t,r,e)}catch(r){await Bo(r)}}function FT(n,e,t){const r=ie(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ie(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const g of f.Sa)g.va(a)&&(u=!0)}),u&&oI(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function I6(n,e,t){const r=ie(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new Bt(se.comparator);o=o.insert(i,Gt.newNoDocument(i,we.min()));const a=ze().add(i),l=new Sh(we.min(),new Map,new Bt(De),o,a);await HN(r,l),r.du=r.du.remove(i),r.Au.delete(e),hI(r)}else await bc(r.localStore,e,!1).then(()=>Cc(r,e,t)).catch(Bo)}async function x6(n,e){const t=ie(n),r=e.batch.batchId;try{const s=await V5(t.localStore,e);dI(t,r,null),uI(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Pi(t,s)}catch(s){await Bo(s)}}async function E6(n,e,t){const r=ie(n);try{const s=await function(o,a){const l=ie(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(me(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);dI(r,e,t),uI(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Pi(r,s)}catch(s){await Bo(s)}}async function S6(n,e){const t=ie(n);Wo(t.remoteStore)||Q(Go,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ie(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===xo)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Gc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function uI(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function dI(n,e,t){const r=ie(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Cc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||QN(n,r)})}function QN(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Ac(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),hI(n))}function Ov(n,e,t){for(const r of t)r instanceof zN?(n.Ru.addReference(r.key,e),T6(n,r)):r instanceof qN?(Q(Go,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||QN(n,r.key)):de(19791,{wu:r})}function T6(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Q(Go,"New document in limbo: "+t),n.Eu.add(r),hI(n))}function hI(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new se(tt.fromString(e)),r=n.fu.next();n.Au.set(r,new g6(t)),n.du=n.du.insert(t,r),pm(n.remoteStore,new di(or(Uc(t.path)),r,"TargetPurposeLimboResolution",mr.ce))}}async function Pi(n,e,t){const r=ie(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=Yw.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=ie(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>O.forEach(u,g=>O.forEach(g.Es,y=>h.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>O.forEach(g.ds,y=>h.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!zo(f))throw f;Q(Jw,"Failed to update sequence numbers: "+f)}for(const f of u){const g=f.targetId;if(!f.fromCache){const y=h.Ms.get(g),w=y.snapshotVersion,C=y.withLastLimboFreeSnapshotVersion(w);h.Ms=h.Ms.insert(g,C)}}}(r.localStore,i))}async function b6(n,e){const t=ie(n);if(!t.currentUser.isEqual(e)){Q(Go,"User change. New user:",e.toKey());const r=await SN(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new q(j.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Pi(t,r.Ls)}}function A6(n,e){const t=ie(n),r=t.Au.get(e);if(r&&r.hu)return ze().add(r.key);{let s=ze();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function C6(n,e){const t=ie(n),r=await rp(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&Ov(t,e.targetId,s.au),s}async function R6(n,e){const t=ie(n);return CN(t.localStore,e).then(r=>Pi(t,r))}async function k6(n,e,t,r){const s=ie(n),i=await function(a,l){const u=ie(a),h=ie(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(g=>g?u.localDocuments.getDocuments(f,g):O.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await qc(s.remoteStore):t==="acknowledged"||t==="rejected"?(dI(s,e,r||null),uI(s,e),function(a,l){ie(ie(a).mutationQueue).ir(l)}(s.localStore,e)):de(6720,"Unknown batchState",{Su:t}),await Pi(s,i)):Q(Go,"Cannot apply mutation batch with id: "+e)}async function N6(n,e){const t=ie(n);if(mm(t),fI(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await jT(t,r.toArray());t.gu=!0,await Lv(t.remoteStore,!0);for(const i of s)pm(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Cc(t,o),bc(t.localStore,o,!0))),Ac(t.remoteStore,o)}),await s,await jT(t,r),function(o){const a=ie(o);a.Au.forEach((l,u)=>{Ac(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new Bt(se.comparator)}(t),t.gu=!1,await Lv(t.remoteStore,!1)}}async function jT(n,e,t){const r=ie(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Tc(r.localStore,or(l[0]));for(const u of l){const h=r.Tu.get(u),f=await C6(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await AN(r.localStore,o);a=await Tc(r.localStore,u),await cI(r,KN(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function KN(n){return Ak(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function P6(n){return function(t){return ie(ie(t).persistence).Ts()}(ie(n).localStore)}async function D6(n,e,t,r){const s=ie(n);if(s.gu)return void Q(Go,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await CN(s.localStore,Nk(i[0])),a=Sh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",dn.EMPTY_BYTE_STRING);await Pi(s,o,a);break}case"rejected":await bc(s.localStore,e,!0),Cc(s,e,r);break;default:de(64155,t)}}async function L6(n,e,t){const r=mm(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){Q(Go,"Adding an already active target "+s);continue}const i=await AN(r.localStore,s),o=await Tc(r.localStore,i);await cI(r,KN(i),o.targetId,!1,o.resumeToken),pm(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await bc(r.localStore,s,!1).then(()=>{Ac(r.remoteStore,s),Cc(r,s)}).catch(Bo)}}function mm(n){const e=ie(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=HN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=A6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=I6.bind(null,e),e.Pu.H_=d6.bind(null,e.eventManager),e.Pu.yu=h6.bind(null,e.eventManager),e}function fI(n){const e=ie(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=x6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=E6.bind(null,e),e}function M6(n,e,t){const r=ie(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,w){const C=ie(y),N=pn(w.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",A=>C.Ii.getBundleMetadata(A,w.id)).then(A=>!!A&&A.createTime.compareTo(N)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(BN(l));const u=new lI(l,o.serializer);let h=await o.bu();for(;h;){const g=await u.Ga(h);g&&a._updateProgress(g),h=await o.bu()}const f=await u.ja(i.localStore);return await Pi(i,f.Ha,void 0),await function(y,w){const C=ie(y);return C.persistence.runTransaction("Save bundle","readwrite",N=>C.Ii.saveBundleMetadata(N,w))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return rs(Go,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Rc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=el(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return EN(this.persistence,new xN,e.initialUser,this.serializer)}Cu(e){return new Hw(gm.mi,this.serializer)}Du(e){return new DN}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Rc.provider={build:()=>new Rc};class gI extends Rc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){me(this.persistence.referenceDelegate instanceof np,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new mN(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?nr.withCacheSize(this.cacheSizeBytes):nr.DEFAULT;return new Hw(r=>np.mi(r,t),this.serializer)}}class pI extends Rc{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await fI(this.xu.syncEngine),await qc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return EN(this.persistence,new xN,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new mN(r,e.asyncQueue,t)}Mu(e,t){const r=new Y4(t,this.persistence);return new K4(e.asyncQueue,r)}Cu(e){const t=Kw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?nr.withCacheSize(this.cacheSizeBytes):nr.DEFAULT;return new Qw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,LN(),Jf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new DN}}class YN extends pI{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof My&&(this.sharedClientState.syncEngine={Co:k6.bind(null,t),vo:D6.bind(null,t),Fo:L6.bind(null,t),Ts:P6.bind(null,t),Do:R6.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await N6(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=LN();if(!My.v(t))throw new q(j.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Kw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new My(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Oo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>FT(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=b6.bind(null,this.syncEngine),await Lv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new u6}()}createDatastore(e){const t=el(e.databaseInfo.databaseId),r=function(i){return new G5(i)}(e.databaseInfo);return function(i,o,a,l){return new Y5(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new X5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>FT(this.syncEngine,t,0),function(){return NT.v()?new NT:new B5}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new p6(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ie(s);Q($a,"RemoteStore shutting down."),i.Ea.add(5),await zc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Oo.provider={build:()=>new Oo};function UT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):gn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O6{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Mn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new $N(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new $N(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new q(j.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new q(j.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ie(s),a={documents:i.map(f=>qd(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,tt.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const g=e5(o.serializer,f);u.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=u.get(f.toString());me(!!g,55234,{key:f}),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Bc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=se.fromPath(r);this.mutations.push(new Fw(s,this.precondition(s)))}),await async function(r,s){const i=ie(r),o={writes:s.map(a=>Wd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,tt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw de(50498,{Gu:e.constructor.name});t=we.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new q(j.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(we.min())?tn.exists(!1):tn.updateTime(t):tn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(we.min()))throw new q(j.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return tn.updateTime(t)}return tn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j6{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new Zw(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new F6(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!_h(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Wk(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vo="FirestoreClient";class U6{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Pn.UNAUTHENTICATED,this.clientId=Sw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Q(Vo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Q(Vo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Mn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Gc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Vy(n,e){n.asyncQueue.verifyOperationInProgress(),Q(Vo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await SN(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function $T(n,e){n.asyncQueue.verifyOperationInProgress();const t=await mI(n);Q(Vo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>DT(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>DT(e.remoteStore,s)),n._onlineComponents=e}async function mI(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Q(Vo,"Using user provided OfflineComponentProvider");try{await Vy(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===j.FAILED_PRECONDITION||s.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;rs("Error using user provided cache. Falling back to memory cache: "+t),await Vy(n,new Rc)}}else Q(Vo,"Using default OfflineComponentProvider"),await Vy(n,new gI(void 0));return n._offlineComponents}async function _m(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Q(Vo,"Using user provided OnlineComponentProvider"),await $T(n,n._uninitializedComponentsProvider._online)):(Q(Vo,"Using default OnlineComponentProvider"),await $T(n,new Oo))),n._onlineComponents}function JN(n){return mI(n).then(e=>e.persistence)}function Hc(n){return mI(n).then(e=>e.localStore)}function XN(n){return _m(n).then(e=>e.remoteStore)}function yI(n){return _m(n).then(e=>e.syncEngine)}function ZN(n){return _m(n).then(e=>e.datastore)}async function kc(n){const e=await _m(n),t=e.eventManager;return t.onListen=m6.bind(null,e.syncEngine),t.onUnlisten=_6.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=y6.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=v6.bind(null,e.syncEngine),t}function $6(n){return n.asyncQueue.enqueue(async()=>{const e=await JN(n),t=await XN(n);return e.setNetworkEnabled(!0),function(s){const i=ie(s);return i.Ea.delete(0),bh(i)}(t)})}function B6(n){return n.asyncQueue.enqueue(async()=>{const e=await JN(n),t=await XN(n);return e.setNetworkEnabled(!1),async function(s){const i=ie(s);i.Ea.add(0),await zc(i),i.Ra.set("Offline")}(t)})}function z6(n,e){const t=new Mn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=ie(u);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new q(j.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Gc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Hc(n),e,t)),t.promise}function eP(n,e,t={}){const r=new Mn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new ym({next:g=>{h.Nu(),o.enqueueAndForget(()=>iI(i,f));const y=g.docs.has(a);!y&&g.fromCache?u.reject(new q(j.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?u.reject(new q(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new aI(Uc(a.path),h,{includeMetadataChanges:!0,qa:!0});return sI(i,f)}(await kc(n),n.asyncQueue,e,t,r)),r.promise}function q6(n,e){const t=new Mn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await rp(s,i,!0),l=new WN(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=Gc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Hc(n),e,t)),t.promise}function tP(n,e,t={}){const r=new Mn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new ym({next:g=>{h.Nu(),o.enqueueAndForget(()=>iI(i,f)),g.fromCache&&l.source==="server"?u.reject(new q(j.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new aI(a,h,{includeMetadataChanges:!0,qa:!0});return sI(i,f)}(await kc(n),n.asyncQueue,e,t,r)),r.promise}function W6(n,e,t){const r=new Mn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await ZN(n);r.resolve(async function(o,a,l){var C;const u=ie(o),{request:h,gt:f,parent:g}=nN(u.serializer,Ck(a),l);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,g,h,1)).filter(N=>!!N.result);me(y.length===1,64727);const w=(C=y[0].result)==null?void 0:C.aggregateFields;return Object.keys(w).reduce((N,A)=>(N[f[A]]=w[A],N),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function G6(n,e){const t=new ym(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ie(s).Ca.add(i),i.next()}(await kc(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ie(s).Ca.delete(i)}(await kc(n),t))}}function H6(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?Hk().encode(o):o,function(h,f){return new O6(h,f)}(function(h,f){if(h instanceof Uint8Array)return UT(h,f);if(h instanceof ArrayBuffer)return UT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,el(e));n.asyncQueue.enqueueAndForget(async()=>{M6(await yI(n),s,r)})}function Q6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ie(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await Hc(n),e))}function nP(n,e){return function(r,s){return new V6(r,s)}(n,e)}function K6(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ie(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,g,y,w,C){f=[...f],g=[...g],f.sort(y),g.sort(y);const N=f.length,A=g.length;let x=0,R=0;for(;x<A&&R<N;){const D=y(f[R],g[x]);D<0?C(f[R++]):D>0?w(g[x++]):(x++,R++)}for(;x<A;)w(g[x++]);for(;R<N;)C(f[R++])}(u,s,W4,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>O.waitFor(a)))}(await Hc(n),e))}function Y6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ie(r).Fs.Vs=s}(await Hc(n),e))}function J6(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ie(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Hc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sP="firestore.googleapis.com",zT=!0;class qT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new q(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=sP,this.ssl=zT}else this.host=e.host,this.ssl=e.ssl??zT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=dN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<pN)throw new q(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}q4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=rP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new q(j.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new q(j.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new q(j.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ah{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new L4;switch(r.type){case"firstParty":return new F4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new q(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=BT.get(t);r&&(Q("ComponentProvider","Removing Datastore"),BT.delete(t),r.terminate())}(this),Promise.resolve()}}function X6(n,e,t,r={}){var u;n=st(n,Ah);const s=Ci(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Pp(`https://${a}`),O0("Firestore",!0)),i.host!==sP&&i.host!==a&&rs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Fr(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Pn.MOCK_USER;else{h=t1(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new q(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Pn(g)}n._authCredentials=new M4(new zR(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Fn(this.firestore,e,this._query)}}class Nt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Nt(this.firestore,e,this._key)}toJSON(){return{type:Nt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Za(t,Nt._jsonSchema))return new Nt(e,r||null,new se(tt.fromString(t.referencePath)))}}Nt._jsonSchemaVersion="firestore/documentReference/1.0",Nt._jsonSchema={type:vn("string",Nt._jsonSchemaVersion),referencePath:vn("string")};class Gs extends Fn{constructor(e,t,r){super(e,t,Uc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Nt(this.firestore,null,new se(e))}withConverter(e){return new Gs(this.firestore,e,this._path)}}function Hr(n,e,...t){if(n=ce(n),Tw("collection","path",e),n instanceof Ah){const r=tt.fromString(e,...t);return PS(r),new Gs(n,null,r)}{if(!(n instanceof Nt||n instanceof Gs))throw new q(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(tt.fromString(e,...t));return PS(r),new Gs(n.firestore,null,r)}}function I8(n,e){if(n=st(n,Ah),Tw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new q(j.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Fn(n,null,function(r){return new Ri(tt.emptyPath(),r)}(e))}function Xf(n,e,...t){if(n=ce(n),arguments.length===1&&(e=Sw.newId()),Tw("doc","path",e),n instanceof Ah){const r=tt.fromString(e,...t);return NS(r),new Nt(n,null,new se(r))}{if(!(n instanceof Nt||n instanceof Gs))throw new q(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(tt.fromString(e,...t));return NS(r),new Nt(n.firestore,n instanceof Gs?n.converter:null,new se(r))}}function x8(n,e){return n=ce(n),e=ce(e),(n instanceof Nt||n instanceof Gs)&&(e instanceof Nt||e instanceof Gs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function iP(n,e){return n=ce(n),e=ce(e),n instanceof Fn&&e instanceof Fn&&n.firestore===e.firestore&&Ih(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WT="AsyncQueue";class GT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Zw(this,"async_queue_retry"),this._c=()=>{const r=Jf();r&&Q(WT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Jf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Jf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Mn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!zo(e))throw e;Q(WT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,gn("INTERNAL UNHANDLED ERROR: ",HT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=rI.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&de(47125,{Pc:HT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function HT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Z6{constructor(){this._progressObserver={},this._taskCompletionResolver=new Mn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E8=-1;class Ot extends Ah{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new GT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new GT(e),this._firestoreClient=void 0,await e}}}function S8(n,e,t){t||(t=Ud);const r=Js(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Fr(i,e))return s;throw new q(j.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new q(j.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<pN)throw new q(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Ci(e.host)&&Pp(e.host),r.initialize({options:e,instanceIdentifier:t})}function eU(n,e){const t=typeof n=="object"?n:ah(),r=typeof n=="string"?n:e||Ud,s=Js(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=XC("firestore");i&&X6(s,...i)}return s}function an(n){if(n._terminated)throw new q(j.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||oP(n),n._firestoreClient}function oP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new S3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,rP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new U6(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function T8(n,e){rs("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return aP(n,Oo.provider,{build:r=>new pI(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function b8(n){rs("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();aP(n,Oo.provider,{build:t=>new YN(t,e.cacheSizeBytes)})}function aP(n,e,t){if((n=st(n,Ot))._firestoreClient||n._terminated)throw new q(j.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new q(j.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},oP(n)}function A8(n){if(n._initialized&&!n._terminated)throw new q(j.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Mn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!qs.v())return Promise.resolve();const s=r+IN;await qs.delete(s)}(Kw(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function C8(n){return function(t){const r=new Mn;return t.asyncQueue.enqueueAndForget(async()=>S6(await yI(t),r)),r.promise}(an(n=st(n,Ot)))}function R8(n){return $6(an(n=st(n,Ot)))}function k8(n){return B6(an(n=st(n,Ot)))}function N8(n){return tV(n.app,"firestore",n._databaseId.database),n._delete()}function QT(n,e){const t=an(n=st(n,Ot)),r=new Z6;return H6(t,n._databaseId,e,r),r}function tU(n,e){return Q6(an(n=st(n,Ot)),e).then(t=>t?new Fn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class nU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Nr(dn.fromBase64String(e))}catch(t){throw new q(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Nr(dn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Nr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Za(e,Nr._jsonSchema))return Nr.fromBase64String(e.bytes)}}Nr._jsonSchemaVersion="firestore/bytes/1.0",Nr._jsonSchema={type:vn("string",Nr._jsonSchemaVersion),bytes:vn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new en(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function P8(){return new tl(fv)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return De(this._lat,e._lat)||De(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Hs._jsonSchemaVersion}}static fromJSON(e){if(Za(e,Hs._jsonSchema))return new Hs(e.latitude,e.longitude)}}Hs._jsonSchemaVersion="firestore/geoPoint/1.0",Hs._jsonSchema={type:vn("string",Hs._jsonSchemaVersion),latitude:vn("number"),longitude:vn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ws._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Za(e,ws._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new ws(e.vectorValues);throw new q(j.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ws._jsonSchemaVersion="firestore/vectorValue/1.0",ws._jsonSchema={type:vn("string",ws._jsonSchemaVersion),vectorValues:vn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rU=/^__.*__$/;class sU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ni(e,this.data,this.fieldMask,t,this.fieldTransforms):new $c(e,this.data,t,this.fieldTransforms)}}class lP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ni(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw de(40011,{Ac:n})}}class vm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new vm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return ap(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(cP(this.Ac)&&rU.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class iU{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||el(e)}Cc(e,t,r,s=!1){return new vm({Ac:e,methodName:t,Dc:r,path:en.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rl(n){const e=n._freezeSettings(),t=el(n._databaseId);return new iU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function wm(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);SI("Data must be an object, but it was:",o,r);const a=hP(r,o);let l,u;if(i.merge)l=new yr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=Hd(e,f,t);if(!o.contains(g))throw new q(j.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);gP(h,g)||h.push(g)}l=new yr(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new sU(new Wn(a),l,u)}class Ch extends nl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ch}}function uP(n,e,t){return new vm({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class _I extends nl{_toFieldTransform(e){return new Eh(e.path,new xc)}isEqual(e){return e instanceof _I}}class vI extends nl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=uP(this,e,!0),r=this.vc.map(i=>sl(i,t)),s=new Oa(r);return new Eh(e.path,s)}isEqual(e){return e instanceof vI&&Fr(this.vc,e.vc)}}class wI extends nl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=uP(this,e,!0),r=this.vc.map(i=>sl(i,t)),s=new Va(r);return new Eh(e.path,s)}isEqual(e){return e instanceof wI&&Fr(this.vc,e.vc)}}class II extends nl{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Ec(e.serializer,Vk(e.serializer,this.Fc));return new Eh(e.path,t)}isEqual(e){return e instanceof II&&this.Fc===e.Fc}}function xI(n,e,t,r){const s=n.Cc(1,e,t);SI("Data must be an object, but it was:",s,r);const i=[],o=Wn.empty();qo(r,(l,u)=>{const h=Im(e,l,t);u=ce(u);const f=s.yc(h);if(u instanceof Ch)i.push(h);else{const g=sl(u,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new yr(i);return new lP(o,a,s.fieldTransforms)}function EI(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[Hd(e,r,t)],l=[s];if(i.length%2!=0)throw new q(j.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Hd(e,i[g])),l.push(i[g+1]);const u=[],h=Wn.empty();for(let g=a.length-1;g>=0;--g)if(!gP(u,a[g])){const y=a[g];let w=l[g];w=ce(w);const C=o.yc(y);if(w instanceof Ch)u.push(y);else{const N=sl(w,C);N!=null&&(u.push(y),h.set(y,N))}}const f=new yr(u);return new lP(h,f,o.fieldTransforms)}function dP(n,e,t,r=!1){return sl(t,n.Cc(r?4:3,e))}function sl(n,e){if(fP(n=ce(n)))return SI("Unsupported field value:",e,n),hP(n,e);if(n instanceof nl)return function(r,s){if(!cP(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=sl(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Vk(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=yt.fromDate(r);return{timestampValue:Sc(s.serializer,i)}}if(r instanceof yt){const i=new yt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Sc(s.serializer,i)}}if(r instanceof Hs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Nr)return{bytesValue:Yk(s.serializer,r._byteString)};if(r instanceof Nt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:zw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ws)return function(o,a){return{mapValue:{fields:{[Pw]:{stringValue:Dw},[vc]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return Vw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${Zp(r)}`)}(n,e)}function hP(n,e){const t={};return uk(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qo(n,(r,s)=>{const i=sl(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function fP(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof yt||n instanceof Hs||n instanceof Nr||n instanceof Nt||n instanceof nl||n instanceof ws)}function SI(n,e,t){if(!fP(t)||!WR(t)){const r=Zp(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Hd(n,e,t){if((e=ce(e))instanceof tl)return e._internalPath;if(typeof e=="string")return Im(n,e);throw ap("Field path arguments must be of type string or ",n,!1,void 0,t)}const oU=new RegExp("[~\\*/\\[\\]]");function Im(n,e,t){if(e.search(oU)>=0)throw ap(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new tl(...e.split("."))._internalPath}catch{throw ap(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ap(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new q(j.INVALID_ARGUMENT,a+n+l)}function gP(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Nt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new aU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(xm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class aU extends Qd{data(){return super.data()}}function xm(n,e){return typeof e=="string"?Im(n,e):e instanceof tl?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class TI{}class Rh extends TI{}function Ml(n,e,...t){let r=[];e instanceof TI&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Qc).length,a=i.filter(l=>l instanceof kh).length;if(o>1||o>0&&a>0)throw new q(j.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class kh extends Rh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new kh(e,t,r)}_apply(e){const t=this._parse(e);return yP(e._query,t),new Fn(e.firestore,e.converter,Sv(e._query,t))}_parse(e){const t=rl(e.firestore);return function(i,o,a,l,u,h,f){let g;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new q(j.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){YT(f,h);const w=[];for(const C of f)w.push(KT(l,i,C));g={arrayValue:{values:w}}}else g=KT(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||YT(f,h),g=dP(a,o,f,h==="in"||h==="not-in");return ot.create(u,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ol(n,e,t){const r=e,s=xm("where",n);return kh._create(s,r,t)}class Qc extends TI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Qc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Tt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)yP(o,l),o=Sv(o,l)}(e._query,t),new Fn(e.firestore,e.converter,Sv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function D8(...n){return n.forEach(e=>_P("or",e)),Qc._create("or",n)}function L8(...n){return n.forEach(e=>_P("and",e)),Qc._create("and",n)}class bI extends Rh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new bI(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new q(j.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new q(j.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zd(i,o)}(e._query,this._field,this._direction);return new Fn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ri(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function lU(n,e="asc"){const t=e,r=xm("orderBy",n);return bI._create(r,t)}class Em extends Rh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Em(e,t,r)}_apply(e){return new Fn(e.firestore,e.converter,Xg(e._query,this._limit,this._limitType))}}function M8(n){return GR("limit",n),Em._create("limit",n,"F")}function O8(n){return GR("limitToLast",n),Em._create("limitToLast",n,"L")}class Sm extends Rh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Sm(e,t,r)}_apply(e){const t=mP(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new Ri(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function V8(...n){return Sm._create("startAt",n,!0)}function F8(...n){return Sm._create("startAfter",n,!1)}class Tm extends Rh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Tm(e,t,r)}_apply(e){const t=mP(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new Ri(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function j8(...n){return Tm._create("endBefore",n,!1)}function U8(...n){return Tm._create("endAt",n,!0)}function mP(n,e,t,r){if(t[0]=ce(t[0]),t[0]instanceof Qd)return function(i,o,a,l,u){if(!l)throw new q(j.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Wl(i))if(f.field.isKeyField())h.push(La(o,l.key));else{const g=l.data.field(f.field);if(sm(g))throw new q(j.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new q(j.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(g)}return new Lo(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=rl(n.firestore);return function(o,a,l,u,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new q(j.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let w=0;w<h.length;w++){const C=h[w];if(g[w].field.isKeyField()){if(typeof C!="string")throw new q(j.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof C}`);if(!Mw(o)&&C.indexOf("/")!==-1)throw new q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${C}' contains a slash.`);const N=o.path.child(tt.fromString(C));if(!se.isDocumentKey(N))throw new q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);const A=new se(N);y.push(La(a,A))}else{const N=dP(l,u,C);y.push(N)}}return new Lo(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function KT(n,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new q(j.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Mw(e)&&t.indexOf("/")!==-1)throw new q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(tt.fromString(t));if(!se.isDocumentKey(r))throw new q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return La(n,new se(r))}if(t instanceof Nt)return La(n,t._key);throw new q(j.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zp(t)}.`)}function YT(n,e){if(!Array.isArray(n)||n.length===0)throw new q(j.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function yP(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new q(j.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new q(j.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function _P(n,e){if(!(e instanceof kh||e instanceof Qc))throw new q(j.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class vP{convertValue(e,t="none"){switch(Po(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw de(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return qo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[vc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>Yt(o.doubleValue));return new ws(t)}convertGeoPoint(e){return new Hs(Yt(e.latitude),Yt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=im(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(jd(e));default:return null}}convertTimestamp(e){const t=xi(e);return new yt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=tt.fromString(e);me(oN(r),9688,{name:e});const s=new Da(r.get(1),r.get(3)),i=new se(r.popFirst(5));return s.isEqual(t)||gn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bm(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class AI extends vP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Nt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $8(n){return new Gd("sum",Hd("sum",n))}function B8(n){return new Gd("avg",Hd("average",n))}function cU(){return new Gd("count")}function z8(n,e){var t,r;return n instanceof Gd&&e instanceof Gd&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function q8(n,e){return iP(n.query,e.query)&&Fr(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wP="NOT SUPPORTED";class io{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Lr extends Qd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Zf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(xm("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(j.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Lr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function W8(n,e,t){if(Za(e,Lr._jsonSchema)){if(e.bundle===wP)throw new q(j.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=el(n._databaseId),s=nP(e.bundle,r),i=s.Wu(),o=new lI(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new q(j.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=cm(r,a[0].document),u=new se(tt.fromString(e.bundleName));return new Lr(n,new AI(n),u,l,new io(!1,!1),t||null)}}Lr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Lr._jsonSchema={type:vn("string",Lr._jsonSchemaVersion),bundleSource:vn("string","DocumentSnapshot"),bundleName:vn("string"),bundle:vn("string")};class Zf extends Lr{data(e={}){return super.data(e)}}class Mr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new io(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Zf(this._firestore,this._userDataWriter,r.key,r,new io(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Zf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new io(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Zf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new io(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:uU(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(j.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Mr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Sw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function G8(n,e,t){if(Za(e,Mr._jsonSchema)){if(e.bundle===wP)throw new q(j.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=el(n._databaseId),s=nP(e.bundle,r),i=s.Wu(),o=new lI(s.getMetadata(),r);for(const g of i)o.Ga(g);if(o.queries.length!==1)throw new q(j.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=dm(o.queries[0].bundledQuery),l=o.documents;let u=new Ia;l.map(g=>{const y=cm(r,g.document);u=u.add(y)});const h=Ba.fromInitialDocuments(a,u,ze(),!1,!1),f=new Fn(n,t||null,a);return new Mr(n,new AI(n),f,h)}}function uU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de(61501,{type:n})}}function H8(n,e){return n instanceof Lr&&e instanceof Lr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Mr&&e instanceof Mr&&n._firestore===e._firestore&&iP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dU(n){n=st(n,Nt);const e=st(n.firestore,Ot);return eP(an(e),n._key).then(t=>CI(e,n,t))}Mr._jsonSchemaVersion="firestore/querySnapshot/1.0",Mr._jsonSchema={type:vn("string",Mr._jsonSchemaVersion),bundleSource:vn("string","QuerySnapshot"),bundleName:vn("string"),bundle:vn("string")};class Ho extends vP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Nt(this.firestore,null,t)}}function Q8(n){n=st(n,Nt);const e=st(n.firestore,Ot),t=an(e),r=new Ho(e);return z6(t,n._key).then(s=>new Lr(e,r,n._key,s,new io(s!==null&&s.hasLocalMutations,!0),n.converter))}function K8(n){n=st(n,Nt);const e=st(n.firestore,Ot);return eP(an(e),n._key,{source:"server"}).then(t=>CI(e,n,t))}function rd(n){n=st(n,Fn);const e=st(n.firestore,Ot),t=an(e),r=new Ho(e);return pP(n._query),tP(t,n._query).then(s=>new Mr(e,r,n,s))}function Y8(n){n=st(n,Fn);const e=st(n.firestore,Ot),t=an(e),r=new Ho(e);return q6(t,n._query).then(s=>new Mr(e,r,n,s))}function J8(n){n=st(n,Fn);const e=st(n.firestore,Ot),t=an(e),r=new Ho(e);return tP(t,n._query,{source:"server"}).then(s=>new Mr(e,r,n,s))}function hU(n,e,t){n=st(n,Nt);const r=st(n.firestore,Ot),s=bm(n.converter,e,t);return Nh(r,[wm(rl(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,tn.none())])}function X8(n,e,t,...r){n=st(n,Nt);const s=st(n.firestore,Ot),i=rl(s);let o;return o=typeof(e=ce(e))=="string"||e instanceof tl?EI(i,"updateDoc",n._key,e,t,r):xI(i,"updateDoc",n._key,e),Nh(s,[o.toMutation(n._key,tn.exists(!0))])}function fU(n){return Nh(st(n.firestore,Ot),[new Bc(n._key,tn.none())])}function ri(n,e){const t=st(n.firestore,Ot),r=Xf(n),s=bm(n.converter,e);return Nh(t,[wm(rl(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,tn.exists(!1))]).then(()=>r)}function JT(n,...e){var l,u,h;n=ce(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Gl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Gl(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof Nt)o=st(n.firestore,Ot),a=Uc(n._key.path),i={next:f=>{e[r]&&e[r](CI(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=st(n,Fn);o=st(f.firestore,Ot),a=f._query;const g=new Ho(o);i={next:y=>{e[r]&&e[r](new Mr(o,g,f,y))},error:e[r+1],complete:e[r+2]},pP(n._query)}return function(g,y,w,C){const N=new ym(C),A=new aI(y,N,w);return g.asyncQueue.enqueueAndForget(async()=>sI(await kc(g),A)),()=>{N.Nu(),g.asyncQueue.enqueueAndForget(async()=>iI(await kc(g),A))}}(an(o),a,s,i)}function Z8(n,e,...t){const r=ce(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const g=l[f];if(typeof g!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(g.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=g:f==="bundleName"?u.bundleName=g:f==="bundleSource"&&(u.bundleSource=g)}return u}(e);if(s.error)throw new q(j.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Gl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Gl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,g,y){let w,C=!1;return QT(u,h.bundle).then(()=>tU(u,h.bundleName)).then(A=>{A&&!C&&(y&&A.withConverter(y),w=JT(A,f||{},g))}).catch(A=>(g.error&&g.error(A),()=>{})),()=>{C||(C=!0,w&&w())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Gl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,g,y){let w,C=!1;return QT(u,h.bundle).then(()=>{if(!C){const A=new Nt(u,y||null,se.fromPath(h.bundleName));w=JT(A,f||{},g)}}).catch(A=>(g.error&&g.error(A),()=>{})),()=>{C||(C=!0,w&&w())}}(r,s,i,a,t[o])}throw new q(j.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function e7(n,e){return G6(an(n=st(n,Ot)),Gl(e)?e:{next:e})}function Nh(n,e){return function(r,s){const i=new Mn;return r.asyncQueue.enqueueAndForget(async()=>w6(await yI(r),s,i)),i.promise}(an(n),e)}function CI(n,e,t){const r=t.docs.get(e._key),s=new Ho(n);return new Lr(n,s,e._key,r,new io(t.hasPendingWrites,t.fromCache),e.converter)}function t7(n){return gU(n,{count:cU()})}function gU(n,e){const t=st(n.firestore,Ot),r=an(t),s=ck(e,(i,o)=>new qk(o,i.aggregateType,i._internalFieldPath));return W6(r,n._query,s).then(i=>function(a,l,u){const h=new Ho(a);return new nU(l,h,u)}(t,n,i))}class pU{constructor(e){this.kind="memory",this._onlineComponentProvider=Oo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new gI(void 0)}}toJSON(){return{kind:this.kind}}}class mU{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=IU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class yU{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Rc.provider}toJSON(){return{kind:this.kind}}}class _U{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new gI(e)}}toJSON(){return{kind:this.kind}}}function n7(){return new yU}function r7(n){return new _U(n==null?void 0:n.cacheSizeBytes)}function s7(n){return new pU(n)}function i7(n){return new mU(n)}class vU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Oo.provider,this._offlineComponentProvider={build:t=>new pI(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class wU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Oo.provider,this._offlineComponentProvider={build:t=>new YN(t,e==null?void 0:e.cacheSizeBytes)}}}function IU(n){return new vU(n==null?void 0:n.forceOwnership)}function o7(){return new wU}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xU={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=rl(e)}set(e,t,r){this._verifyNotCommitted();const s=oo(e,this._firestore),i=bm(s.converter,t,r),o=wm(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,tn.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=oo(e,this._firestore);let o;return o=typeof(t=ce(t))=="string"||t instanceof tl?EI(this._dataReader,"WriteBatch.update",i._key,t,r,s):xI(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,tn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=oo(e,this._firestore);return this._mutations=this._mutations.concat(new Bc(t._key,tn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new q(j.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function oo(n,e){if((n=ce(n)).firestore!==e)throw new q(j.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=rl(e)}get(e){const t=oo(e,this._firestore),r=new AI(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return de(24041);const i=s[0];if(i.isFoundDocument())return new Qd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Qd(this._firestore,r,t._key,null,t.converter);throw de(18433,{doc:i})})}set(e,t,r){const s=oo(e,this._firestore),i=bm(s.converter,t,r),o=wm(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=oo(e,this._firestore);let o;return o=typeof(t=ce(t))=="string"||t instanceof tl?EI(this._dataReader,"Transaction.update",i._key,t,r,s):xI(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=oo(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU extends SU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=oo(e,this._firestore),r=new Ho(this._firestore);return super.get(e).then(s=>new Lr(this._firestore,r,t._key,s._document,new io(!1,!1),t.converter))}}function a7(n,e,t){n=st(n,Ot);const r={...xU,...t};return function(i){if(i.maxAttempts<1)throw new q(j.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Mn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await ZN(i);new j6(i.asyncQueue,u,a,o,l).ju()}),l.promise}(an(n),s=>e(new TU(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l7(){return new Ch("deleteField")}function ds(){return new _I("serverTimestamp")}function c7(...n){return new vI("arrayUnion",n)}function u7(...n){return new wI("arrayRemove",n)}function d7(n){return new II("increment",n)}function h7(n){return new ws(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f7(n){return an(n=st(n,Ot)),new EU(n,e=>Nh(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g7(n,e){const t=an(n=st(n,Ot));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return rs("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new q(j.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=XT(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Im("setIndexConfiguration",XT(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new va(g,2)):f.order==="ASCENDING"?h.push(new va(g,0)):f.order==="DESCENDING"&&h.push(new va(g,1))}a.push(new fc(fc.UNKNOWN_ID,u,h,gc.empty()))}return a}(e);return K6(t,r)}function XT(n,e){if(typeof n[e]!="string")throw new q(j.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function p7(n){var s;n=st(n,Ot);const e=ZT.get(n);if(e)return e;if(((s=an(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new bU(n);return ZT.set(n,r),r}function m7(n){IP(n,!0)}function y7(n){IP(n,!1)}function _7(n){J6(an(n._firestore)).then(e=>Q("deleting all persistent cache indexes succeeded")).catch(e=>rs("deleting all persistent cache indexes failed",e))}function IP(n,e){Y6(an(n._firestore),e).then(t=>Q(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>rs(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const ZT=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v7(n){var r;const e=an(st(n.firestore,Ot)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:um(t,or(n._query)).ft}function w7(n,e){var i;const t=ck(e,(o,a)=>new qk(a,o.aggregateType,o._internalFieldPath)),r=an(st(n.firestore,Ot)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:nN(s,Ck(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I7{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return RI.instance.onExistenceFilterMismatch(e)}}class RI{constructor(){this.Mc=new Map}static get instance(){return xf||(xf=new RI,function(t){if(td)throw new Error("a TestingHooksSpi instance is already set");td=t}(xf)),xf}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let xf=null;(function(e,t=!0){(function(s){jc=s})(Ka),xs(new Sr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Ot(new O4(r.getProvider("auth-internal")),new j4(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new q(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Da(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),xr(RS,kS,e),xr(RS,kS,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x7={PHONE:"phone",TOTP:"totp"},E7={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},S7={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},T7={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},b7={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function xP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const A7=AU,CU=xP,EP=new Ha("auth","Firebase",xP()),C7={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lp=new oh("@firebase/auth");function RU(n,...e){lp.logLevel<=rt.WARN&&lp.warn(`Auth (${Ka}): ${n}`,...e)}function eg(n,...e){lp.logLevel<=rt.ERROR&&lp.error(`Auth (${Ka}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(n,...e){throw NI(n,...e)}function dr(n,...e){return NI(n,...e)}function kI(n,e,t){const r={...CU(),[e]:t};return new Ha("auth","Firebase",r).create(e,{appName:n.name})}function On(n){return kI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Kc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Tr(n,"argument-error"),kI(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function NI(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return EP.create(n,...e)}function Z(n,e,...t){if(!n)throw NI(e,...t)}function Us(n){const e="INTERNAL ASSERTION FAILED: "+n;throw eg(e),new Error(e)}function Si(n,e){n||Us(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function PI(){return eb()==="http:"||eb()==="https:"}function eb(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(PI()||F0()||"connection"in navigator)?navigator.onLine:!0}function NU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e,t){this.shortDelay=e,this.longDelay=t,Si(t>e,"Short delay should be less than long delay!"),this.isMobile=V0()||r1()}get(){return kU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DI(n,e){Si(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Us("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Us("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Us("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],LU=new Ph(3e4,6e4);function Qt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Kt(n,e,t,r,s={}){return TP(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Qa({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return GM()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Ci(n.emulatorConfig.host)&&(u.credentials="include"),SP.fetch()(await bP(n,n.config.apiHost,t,a),u)})}async function TP(n,e,t){n._canInitEmulator=!1;const r={...PU,...e};try{const s=new OU(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Du(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Du(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Du(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Du(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw kI(n,h,u);Tr(n,h)}}catch(s){if(s instanceof Es)throw s;Tr(n,"network-request-failed",{message:String(s)})}}async function Di(n,e,t,r,s={}){const i=await Kt(n,e,t,r,s);return"mfaPendingCredential"in i&&Tr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function bP(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?DI(n.config,s):`${n.config.apiScheme}://${s}`;return DU.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function MU(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class OU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(dr(this.auth,"network-request-failed")),LU.get())})}}function Du(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=dr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tb(n){return n!==void 0&&n.getResponse!==void 0}function nb(n){return n!==void 0&&n.enterprise!==void 0}class AP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return MU(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VU(n){return(await Kt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function CP(n,e){return Kt(n,"GET","/v2/recaptchaConfig",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FU(n,e){return Kt(n,"POST","/v1/accounts:delete",e)}async function jU(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function cp(n,e){return Kt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sd(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R7(n,e=!1){return ce(n).getIdToken(e)}async function UU(n,e=!1){const t=ce(n),r=await t.getIdToken(e),s=Am(r);Z(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:sd(Fy(s.auth_time)),issuedAtTime:sd(Fy(s.iat)),expirationTime:sd(Fy(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Fy(n){return Number(n)*1e3}function Am(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return eg("JWT malformed, contained fewer than 3 sections"),null;try{const s=kg(t);return s?JSON.parse(s):(eg("Failed to decode base64 JWT payload"),null)}catch(s){return eg("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function rb(n){const e=Am(n);return Z(e,"internal-error"),Z(typeof e.exp<"u","internal-error"),Z(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ti(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Es&&$U(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function $U({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=sd(this.lastLoginAt),this.creationTime=sd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yd(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Ti(n,cp(e,{idToken:t}));Z(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?RP(s.providerUserInfo):[],o=qU(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Vv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function zU(n){const e=ce(n);await Yd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function qU(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function RP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WU(n,e){const t=await TP(n,{},async()=>{const r=Qa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await bP(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&Ci(n.emulatorConfig.host)&&(l.credentials="include"),SP.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function GU(n,e){return Kt(n,"POST","/v2/accounts:revokeToken",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Z(e.idToken,"internal-error"),Z(typeof e.idToken<"u","internal-error"),Z(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):rb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Z(e.length!==0,"internal-error");const t=rb(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Z(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await WU(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Hl;return r&&(Z(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Z(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Z(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Hl,this.toJSON())}_performRefresh(){return Us("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qi(n,e){Z(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ms{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new BU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Vv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ti(this,this.stsTokenManager.getToken(this.auth,e));return Z(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return UU(this,e)}reload(){return zU(this)}_assign(e){this!==e&&(Z(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ms({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Z(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Yd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xt(this.auth.app))return Promise.reject(On(this.auth));const e=await this.getIdToken();return await Ti(this,FU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:g,isAnonymous:y,providerData:w,stsTokenManager:C}=t;Z(f&&C,e,"internal-error");const N=Hl.fromJSON(this.name,C);Z(typeof f=="string",e,"internal-error"),qi(r,e.name),qi(s,e.name),Z(typeof g=="boolean",e,"internal-error"),Z(typeof y=="boolean",e,"internal-error"),qi(i,e.name),qi(o,e.name),qi(a,e.name),qi(l,e.name),qi(u,e.name),qi(h,e.name);const A=new ms({uid:f,auth:e,email:s,emailVerified:g,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:N,createdAt:u,lastLoginAt:h});return w&&Array.isArray(w)&&(A.providerData=w.map(x=>({...x}))),l&&(A._redirectEventId=l),A}static async _fromIdTokenResponse(e,t,r=!1){const s=new Hl;s.updateFromServerResponse(t);const i=new ms({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Yd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Z(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?RP(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Hl;a.updateFromIdToken(r);const l=new ms({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Vv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sb=new Map;function hi(n){Si(n instanceof Function,"Expected a class definition");let e=sb.get(n);return e?(Si(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,sb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}kP.type="NONE";const ib=kP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tg(n,e,t){return`firebase:${n}:${e}:${t}`}class Ql{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=tg(this.userKey,s.apiKey,i),this.fullPersistenceKey=tg("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await cp(this.auth,{idToken:e}).catch(()=>{});return t?ms._fromGetAccountInfoResponse(this.auth,t,e):null}return ms._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ql(hi(ib),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||hi(ib);const o=tg(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const g=await cp(e,{idToken:h}).catch(()=>{});if(!g)break;f=await ms._fromGetAccountInfoResponse(e,g,h)}else f=ms._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ql(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Ql(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ob(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(LP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(NP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(OP(e))return"Blackberry";if(VP(e))return"Webos";if(PP(e))return"Safari";if((e.includes("chrome/")||DP(e))&&!e.includes("edge/"))return"Chrome";if(MP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function NP(n=En()){return/firefox\//i.test(n)}function PP(n=En()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function DP(n=En()){return/crios\//i.test(n)}function LP(n=En()){return/iemobile/i.test(n)}function MP(n=En()){return/android/i.test(n)}function OP(n=En()){return/blackberry/i.test(n)}function VP(n=En()){return/webos/i.test(n)}function LI(n=En()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function HU(n=En()){var e;return LI(n)&&!!((e=window.navigator)!=null&&e.standalone)}function QU(){return HM()&&document.documentMode===10}function FP(n=En()){return LI(n)||MP(n)||VP(n)||OP(n)||/windows phone/i.test(n)||LP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jP(n,e=[]){let t;switch(n){case"Browser":t=ob(En());break;case"Worker":t=`${ob(En())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ka}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YU(n,e={}){return Kt(n,"GET","/v2/passwordPolicy",Qt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JU=6;class XU{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??JU,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZU{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ab(this),this.idTokenSubscription=new ab(this),this.beforeStateQueue=new KU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=EP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=hi(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Ql.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await cp(this,{idToken:e}),r=await ms._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Xt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Z(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Yd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=NU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Xt(this.app))return Promise.reject(On(this));const t=e?ce(e):null;return t&&Z(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Z(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Xt(this.app)?Promise.reject(On(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Xt(this.app)?Promise.reject(On(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await YU(this),t=new XU(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ha("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await GU(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&hi(e)||this._popupRedirectResolver;Z(t,this,"argument-error"),this.redirectPersistenceManager=await Ql.create(this,[hi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Z(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Z(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Xt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&RU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function hn(n){return ce(n)}class ab{constructor(e){this.auth=e,this.observer=null,this.addObserver=eO(t=>this.observer=t)}get next(){return Z(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function e$(n){Dh=n}function MI(n){return Dh.loadJS(n)}function t$(){return Dh.recaptchaV2Script}function n$(){return Dh.recaptchaEnterpriseScript}function r$(){return Dh.gapiScript}function UP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s$=500,i$=6e4,Ef=1e12;class o${constructor(e){this.auth=e,this.counter=Ef,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new c$(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||Ef;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||Ef;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||Ef;return(r=this._widgets.get(t))==null||r.execute(),""}}class a${constructor(){this.enterprise=new l$}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class l${ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class c${constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Z(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=u$(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},i$)},s$))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function u$(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const d$="recaptcha-enterprise",id="NO_RECAPTCHA";class $P{constructor(e){this.type=d$,this.auth=hn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{CP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new AP(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;nb(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(id)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new a$().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&nb(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=n$();l.length!==0&&(l+=a),MI(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Iu(n,e,t,r=!1,s=!1){const i=new $P(n);let o;if(s)o=id;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Eo(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Iu(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Iu(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Iu(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Iu(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await Iu(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function BP(n){const e=hn(n),t=await CP(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new AP(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new $P(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h$(n,e){const t=Js(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Fr(i,e??{}))return s;Tr(s,"already-initialized")}return t.initialize({options:e})}function f$(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(hi);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function g$(n,e,t){const r=hn(n);Z(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=zP(e),{host:o,port:a}=p$(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Z(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Z(Fr(u,r.config.emulator)&&Fr(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ci(o)?(Pp(`${i}//${o}${l}`),O0("Auth",!0)):s||m$()}function zP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function p$(n){const e=zP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:lb(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:lb(o)}}}function lb(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function m$(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Us("not implemented")}_getIdTokenResponse(e){return Us("not implemented")}_linkToIdToken(e,t){return Us("not implemented")}_getReauthenticationResolver(e){return Us("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qP(n,e){return Kt(n,"POST","/v1/accounts:resetPassword",Qt(n,e))}async function y$(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function _$(n,e){return Kt(n,"POST","/v1/accounts:signUp",e)}async function v$(n,e){return Kt(n,"POST","/v1/accounts:update",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w$(n,e){return Di(n,"POST","/v1/accounts:signInWithPassword",Qt(n,e))}async function Cm(n,e){return Kt(n,"POST","/v1/accounts:sendOobCode",Qt(n,e))}async function I$(n,e){return Cm(n,e)}async function x$(n,e){return Cm(n,e)}async function E$(n,e){return Cm(n,e)}async function S$(n,e){return Cm(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T$(n,e){return Di(n,"POST","/v1/accounts:signInWithEmailLink",Qt(n,e))}async function b$(n,e){return Di(n,"POST","/v1/accounts:signInWithEmailLink",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd extends Lh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Jd(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Jd(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Eo(e,t,"signInWithPassword",w$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return T$(e,{email:this._email,oobCode:this._password});default:Tr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Eo(e,r,"signUpPassword",_$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return b$(e,{idToken:t,email:this._email,oobCode:this._password});default:Tr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pi(n,e){return Di(n,"POST","/v1/accounts:signInWithIdp",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A$="http://localhost";class bi extends Lh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new bi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Tr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new bi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return pi(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,pi(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,pi(e,t)}buildRequest(){const e={requestUri:A$,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Qa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cb(n,e){return Kt(n,"POST","/v1/accounts:sendVerificationCode",Qt(n,e))}async function C$(n,e){return Di(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,e))}async function R$(n,e){const t=await Di(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,e));if(t.temporaryProof)throw Du(n,"account-exists-with-different-credential",t);return t}const k$={USER_NOT_FOUND:"user-not-found"};async function N$(n,e){const t={...e,operation:"REAUTH"};return Di(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,t),k$)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa extends Lh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new xa({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new xa({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return C$(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return R$(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return N$(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new xa({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P$(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function D$(n){const e=bu(Au(n)).link,t=e?bu(Au(e)).deep_link_id:null,r=bu(Au(n)).deep_link_id;return(r?bu(Au(r)).link:null)||r||t||e||n}class Mh{constructor(e){const t=bu(Au(e)),r=t.apiKey??null,s=t.oobCode??null,i=P$(t.mode??null);Z(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=D$(e);try{return new Mh(t)}catch{return null}}}function k7(n){return Mh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(){this.providerId=il.PROVIDER_ID}static credential(e,t){return Jd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Mh.parseLink(t);return Z(r,"argument-error"),Jd._fromEmailAndCode(e,r.code,r.tenantId)}}il.PROVIDER_ID="password";il.EMAIL_PASSWORD_SIGN_IN_METHOD="password";il.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc extends Li{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ng extends Yc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Z("providerId"in t&&"signInMethod"in t,"argument-error"),bi._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return Z(e.idToken||e.accessToken,"argument-error"),bi._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return ng.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ng.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new ng(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji extends Yc{constructor(){super("facebook.com")}static credential(e){return bi._fromParams({providerId:Ji.PROVIDER_ID,signInMethod:Ji.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ji.credentialFromTaggedObject(e)}static credentialFromError(e){return Ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ji.credential(e.oauthAccessToken)}catch{return null}}}Ji.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ji.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai extends Yc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return bi._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ai.credential(t,r)}catch{return null}}}ai.GOOGLE_SIGN_IN_METHOD="google.com";ai.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi extends Yc{constructor(){super("github.com")}static credential(e){return bi._fromParams({providerId:Xi.PROVIDER_ID,signInMethod:Xi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xi.credentialFromTaggedObject(e)}static credentialFromError(e){return Xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xi.credential(e.oauthAccessToken)}catch{return null}}}Xi.GITHUB_SIGN_IN_METHOD="github.com";Xi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L$="http://localhost";class Xd extends Lh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return pi(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,pi(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,pi(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Xd(r,i)}static _create(e,t){return new Xd(e,t)}buildRequest(){return{requestUri:L$,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M$="saml.";class Fv extends Li{constructor(e){Z(e.startsWith(M$),"argument-error"),super(e)}static credentialFromResult(e){return Fv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Fv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Xd.fromJSON(e);return Z(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Xd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi extends Yc{constructor(){super("twitter.com")}static credential(e,t){return bi._fromParams({providerId:Zi.PROVIDER_ID,signInMethod:Zi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Zi.credentialFromTaggedObject(e)}static credentialFromError(e){return Zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Zi.credential(t,r)}catch{return null}}}Zi.TWITTER_SIGN_IN_METHOD="twitter.com";Zi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WP(n,e){return Di(n,"POST","/v1/accounts:signUp",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ms._fromIdTokenResponse(e,r,s),o=ub(r);return new ss({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=ub(r);return new ss({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function ub(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N7(n){var s;if(Xt(n.app))return Promise.reject(On(n));const e=hn(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ss({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await WP(e,{returnSecureToken:!0}),r=await ss._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up extends Es{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,up.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new up(e,t,r,s)}}function GP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?up._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HP(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P7(n,e){const t=ce(n);await Rm(!0,t,e);const{providerUserInfo:r}=await jU(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=HP(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function OI(n,e,t=!1){const r=await Ti(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ss._forOperation(n,"link",r)}async function Rm(n,e,t){await Yd(e);const r=HP(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Z(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QP(n,e,t=!1){const{auth:r}=n;if(Xt(r.app))return Promise.reject(On(r));const s="reauthenticate";try{const i=await Ti(n,GP(r,s,e,n),t);Z(i.idToken,r,"internal-error");const o=Am(i.idToken);Z(o,r,"internal-error");const{sub:a}=o;return Z(n.uid===a,r,"user-mismatch"),ss._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Tr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KP(n,e,t=!1){if(Xt(n.app))return Promise.reject(On(n));const r="signIn",s=await GP(n,r,e),i=await ss._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function VI(n,e){return KP(hn(n),e)}async function O$(n,e){const t=ce(n);return await Rm(!1,t,e.providerId),OI(t,e)}async function V$(n,e){return QP(ce(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F$(n,e){return Di(n,"POST","/v1/accounts:signInWithCustomToken",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D7(n,e){if(Xt(n.app))return Promise.reject(On(n));const t=hn(n),r=await F$(t,{token:e,returnSecureToken:!0}),s=await ss._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?FI._fromServerResponse(e,t):"totpInfo"in t?jI._fromServerResponse(e,t):Tr(e,"internal-error")}}class FI extends Oh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new FI(t)}}class jI extends Oh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new jI(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function km(n,e,t){var r;Z(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),Z(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),Z(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Z(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Z(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UI(n){const e=hn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function j$(n,e,t){const r=hn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&km(r,s,t),await Eo(r,s,"getOobCode",x$,"EMAIL_PASSWORD_PROVIDER")}async function L7(n,e,t){await qP(ce(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&UI(n),r})}async function M7(n,e){await v$(ce(n),{oobCode:e})}async function U$(n,e){const t=ce(n),r=await qP(t,{oobCode:e}),s=r.requestType;switch(Z(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Z(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Z(r.mfaInfo,t,"internal-error");default:Z(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Oh._fromServerResponse(hn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function O7(n,e){const{data:t}=await U$(ce(n),e);return t.email}async function $$(n,e,t){if(Xt(n.app))return Promise.reject(On(n));const r=hn(n),o=await Eo(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",WP,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&UI(n),l}),a=await ss._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function B$(n,e,t){return Xt(n.app)?Promise.reject(On(n)):VI(ce(n),il.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&UI(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V7(n,e,t){const r=hn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Z(a.handleCodeInApp,r,"argument-error"),a&&km(r,o,a)}i(s,t),await Eo(r,s,"getOobCode",E$,"EMAIL_PASSWORD_PROVIDER")}function F7(n,e){const t=Mh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function j7(n,e,t){if(Xt(n.app))return Promise.reject(On(n));const r=ce(n),s=il.credentialWithLink(e,t||Kd());return Z(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),VI(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z$(n,e){return Kt(n,"POST","/v1/accounts:createAuthUri",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U7(n,e){const t=PI()?Kd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await z$(ce(n),r);return s||[]}async function q$(n,e){const t=ce(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&km(t.auth,s,e);const{email:i}=await I$(t.auth,s);i!==n.email&&await n.reload()}async function $7(n,e,t){const r=ce(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&km(r.auth,i,t);const{email:o}=await S$(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W$(n,e){return Kt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B7(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=ce(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ti(r,W$(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function z7(n,e){const t=ce(n);return Xt(t.auth.app)?Promise.reject(On(t.auth)):YP(t,e,null)}function q7(n,e){return YP(ce(n),null,e)}async function YP(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Ti(n,y$(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G$(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Am(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Kl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new H$(r,t);case"github.com":return new Q$(r,t);case"google.com":return new K$(r,t);case"twitter.com":return new Y$(r,t,n.screenName||null);case"custom":case"anonymous":return new Kl(r,null);default:return new Kl(r,e,t)}}class Kl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class JP extends Kl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class H$ extends Kl{constructor(e,t){super(e,"facebook.com",t)}}class Q$ extends JP{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class K$ extends Kl{constructor(e,t){super(e,"google.com",t)}}class Y$ extends JP{constructor(e,t,r){super(e,"twitter.com",t,r)}}function W7(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:G$(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J$(n,e){return ce(n).setPersistence(e)}function G7(n){return BP(n)}async function H7(n,e){return hn(n).validatePassword(e)}function X$(n,e,t,r){return ce(n).onIdTokenChanged(e,t,r)}function Z$(n,e,t){return ce(n).beforeAuthStateChanged(e,t)}function Q7(n,e,t,r){return ce(n).onAuthStateChanged(e,t,r)}function K7(n){ce(n).useDeviceLanguage()}function Y7(n,e){return ce(n).updateCurrentUser(e)}function J7(n){return ce(n).signOut()}function X7(n,e){return hn(n).revokeAccessToken(e)}async function Z7(n){return ce(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ga("enroll",e,t)}static _fromMfaPendingCredential(e){return new ga("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return ga._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return ga._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $I{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=hn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Oh._fromServerResponse(r,a));Z(s.mfaPendingCredential,r,"internal-error");const o=ga._fromMfaPendingCredential(s.mfaPendingCredential);return new $I(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await ss._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Z(t.user,r,"internal-error"),ss._forOperation(t.user,t.operationType,u);default:Tr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function eW(n,e){var s;const t=ce(n),r=e;return Z(e.customData.operationType,t,"argument-error"),Z((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),$I._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function db(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",Qt(n,e))}function eB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Qt(n,e))}function tB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",Qt(n,e))}function nB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Qt(n,e))}function rB(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Qt(n,e))}class BI{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Oh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new BI(e)}async getSession(){return ga._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Ti(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Ti(this.user,rB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const jy=new WeakMap;function tW(n){const e=ce(n);return jy.has(e)||jy.set(e,BI._fromUser(e)),jy.get(e)}const dp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(dp,"1"),this.storage.removeItem(dp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sB=1e3,iB=10;class ZP extends XP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=FP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);QU()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,iB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},sB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ZP.type="LOCAL";const eD=ZP;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oB=1e3;function Uy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function $y(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class tD{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=$y(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return Uy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=$y(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=$y(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(g=>g.name===r);h&&t(h.value),u.deleted.find(g=>g.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=Uy(r);const i=setInterval(()=>{const a=Uy(r);a!==s&&(t(a),s=a)},oB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}tD.type="COOKIE";const nW=tD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD extends XP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}nD.type="SESSION";const rD=nD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Nm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await aB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Nm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pm(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Pm("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===u)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(){return window}function cB(n){yn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zI(){return typeof yn().WorkerGlobalScope<"u"&&typeof yn().importScripts=="function"}async function uB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function dB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function hB(){return zI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD="firebaseLocalStorageDb",fB=1,hp="firebaseLocalStorage",iD="fbase_key";class Vh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Dm(n,e){return n.transaction([hp],e?"readwrite":"readonly").objectStore(hp)}function gB(){const n=indexedDB.deleteDatabase(sD);return new Vh(n).toPromise()}function jv(){const n=indexedDB.open(sD,fB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(hp,{keyPath:iD})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(hp)?e(r):(r.close(),await gB(),e(await jv()))})})}async function hb(n,e,t){const r=Dm(n,!0).put({[iD]:e,value:t});return new Vh(r).toPromise()}async function pB(n,e){const t=Dm(n,!1).get(e),r=await new Vh(t).toPromise();return r===void 0?null:r.value}function fb(n,e){const t=Dm(n,!0).delete(e);return new Vh(t).toPromise()}const mB=800,yB=3;class oD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await jv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>yB)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return zI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Nm._getInstance(hB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await uB(),!this.activeServiceWorker)return;this.sender=new lB(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||dB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await jv();return await hb(e,dp,"1"),await fb(e,dp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>hb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>pB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>fb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Dm(s,!1).getAll();return new Vh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),mB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}oD.type="LOCAL";const _B=oD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gb(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:start",Qt(n,e))}function vB(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",Qt(n,e))}function wB(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const By=UP("rcb"),IB=new Ph(3e4,6e4);class xB{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=yn().grecaptcha)!=null&&e.render)}load(e,t=""){return Z(EB(t),e,"argument-error"),this.shouldResolveImmediately(t)&&tb(yn().grecaptcha)?Promise.resolve(yn().grecaptcha):new Promise((r,s)=>{const i=yn().setTimeout(()=>{s(dr(e,"network-request-failed"))},IB.get());yn()[By]=()=>{yn().clearTimeout(i),delete yn()[By];const a=yn().grecaptcha;if(!a||!tb(a)){s(dr(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${t$()}?${Qa({onload:By,render:"explicit",hl:t})}`;MI(o).catch(()=>{clearTimeout(i),s(dr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=yn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function EB(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class SB{async load(e){return new o$(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const od="recaptcha",TB={theme:"light",type:"image"};class rW{constructor(e,t,r={...TB}){this.parameters=r,this.type=od,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=hn(e),this.isInvisible=this.parameters.size==="invisible",Z(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Z(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new SB:new xB,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Z(!this.parameters.sitekey,this.auth,"argument-error"),Z(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Z(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=yn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Z(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Z(PI()&&!zI(),this.auth,"internal-error"),await bB(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await VU(this.auth);Z(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Z(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function bB(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=xa._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function sW(n,e,t){if(Xt(n.app))return Promise.reject(On(n));const r=hn(n),s=await Lm(r,e,ce(t));return new qI(s,i=>VI(r,i))}async function iW(n,e,t){const r=ce(n);await Rm(!1,r,"phone");const s=await Lm(r.auth,e,ce(t));return new qI(s,i=>O$(r,i))}async function oW(n,e,t){const r=ce(n);if(Xt(r.auth.app))return Promise.reject(On(r.auth));const s=await Lm(r.auth,e,ce(t));return new qI(s,i=>V$(r,i))}async function Lm(n,e,t){var r;if(!n._getRecaptchaConfig())try{await BP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){Z(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Eo(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===id){Z((t==null?void 0:t.type)===od,h,"argument-error");const g=await zy(h,f,t);return db(h,g)}return db(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{Z(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;Z(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Eo(n,a,"mfaSmsSignIn",async(f,g)=>{if(g.phoneSignInInfo.captchaResponse===id){Z((t==null?void 0:t.type)===od,f,"argument-error");const y=await zy(f,g,t);return gb(f,y)}return gb(f,g)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Eo(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===id){Z((t==null?void 0:t.type)===od,u,"argument-error");const f=await zy(u,h,t);return cb(u,f)}return cb(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function aW(n,e){const t=ce(n);if(Xt(t.auth.app))return Promise.reject(On(t.auth));await OI(t,e)}async function zy(n,e,t){Z(t.type===od,n,"argument-error");const r=await t.verify();Z(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e){this.providerId=Yl.PROVIDER_ID,this.auth=hn(e)}verifyPhoneNumber(e,t){return Lm(this.auth,e,ce(t))}static credential(e,t){return xa._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Yl.credentialFromTaggedObject(t)}static credentialFromError(e){return Yl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?xa._fromTokenResponse(t,r):null}}Yl.PROVIDER_ID="phone";Yl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(n,e){return e?hi(e):(Z(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI extends Lh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return pi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return pi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return pi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function AB(n){return KP(n.auth,new WI(n),n.bypassAuthState)}function CB(n){const{auth:e,user:t}=n;return Z(t,e,"internal-error"),QP(t,new WI(n),n.bypassAuthState)}async function RB(n){const{auth:e,user:t}=n;return Z(t,e,"internal-error"),OI(t,new WI(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aD{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return AB;case"linkViaPopup":case"linkViaRedirect":return RB;case"reauthViaPopup":case"reauthViaRedirect":return CB;default:Tr(this.auth,"internal-error")}}resolve(e){Si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kB=new Ph(2e3,1e4);async function NB(n,e,t){if(Xt(n.app))return Promise.reject(dr(n,"operation-not-supported-in-this-environment"));const r=hn(n);Kc(n,e,Li);const s=ol(r,t);return new fi(r,"signInViaPopup",e,s).executeNotNull()}async function lW(n,e,t){const r=ce(n);if(Xt(r.auth.app))return Promise.reject(dr(r.auth,"operation-not-supported-in-this-environment"));Kc(r.auth,e,Li);const s=ol(r.auth,t);return new fi(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function cW(n,e,t){const r=ce(n);Kc(r.auth,e,Li);const s=ol(r.auth,t);return new fi(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class fi extends aD{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,fi.currentPopupAction&&fi.currentPopupAction.cancel(),fi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Z(e,this.auth,"internal-error"),e}async onExecution(){Si(this.filter.length===1,"Popup operations only handle one event");const e=Pm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(dr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(dr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(dr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,kB.get())};e()}}fi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PB="pendingRedirect",rg=new Map;class DB extends aD{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=rg.get(this.auth._key());if(!e){try{const r=await LB(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}rg.set(this.auth._key(),e)}return this.bypassAuthState||rg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function LB(n,e){const t=cD(e),r=lD(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function GI(n,e){return lD(n)._set(cD(e),"true")}function MB(n,e){rg.set(n._key(),e)}function lD(n){return hi(n._redirectPersistence)}function cD(n){return tg(PB,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uW(n,e,t){return OB(n,e,t)}async function OB(n,e,t){if(Xt(n.app))return Promise.reject(On(n));const r=hn(n);Kc(n,e,Li),await r._initializationPromise;const s=ol(r,t);return await GI(s,r),s._openRedirect(r,e,"signInViaRedirect")}function dW(n,e,t){return VB(n,e,t)}async function VB(n,e,t){const r=ce(n);if(Kc(r.auth,e,Li),Xt(r.auth.app))return Promise.reject(On(r.auth));await r.auth._initializationPromise;const s=ol(r.auth,t);await GI(s,r.auth);const i=await dD(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function hW(n,e,t){return FB(n,e,t)}async function FB(n,e,t){const r=ce(n);Kc(r.auth,e,Li),await r.auth._initializationPromise;const s=ol(r.auth,t);await Rm(!1,r,e.providerId),await GI(s,r.auth);const i=await dD(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function fW(n,e){return await hn(n)._initializationPromise,uD(n,e,!1)}async function uD(n,e,t=!1){if(Xt(n.app))return Promise.reject(On(n));const r=hn(n),s=ol(r,e),o=await new DB(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function dD(n){const e=Pm(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jB=10*60*1e3;class UB{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!$B(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!hD(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(dr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jB&&this.cachedEventUids.clear(),this.cachedEventUids.has(pb(e))}saveEventToCache(e){this.cachedEventUids.add(pb(e)),this.lastProcessedEventTime=Date.now()}}function pb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function hD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function $B(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BB(n,e={}){return Kt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qB=/^https?/;async function WB(n){if(n.config.emulator)return;const{authorizedDomains:e}=await BB(n);for(const t of e)try{if(GB(t))return}catch{}Tr(n,"unauthorized-domain")}function GB(n){const e=Kd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!qB.test(t))return!1;if(zB.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB=new Ph(3e4,6e4);function mb(){const n=yn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function QB(n){return new Promise((e,t)=>{var s,i,o;function r(){mb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{mb(),t(dr(n,"network-request-failed"))},timeout:HB.get()})}if((i=(s=yn().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=yn().gapi)!=null&&o.load)r();else{const a=UP("iframefcb");return yn()[a]=()=>{gapi.load?r():t(dr(n,"network-request-failed"))},MI(`${r$()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw sg=null,e})}let sg=null;function KB(n){return sg=sg||QB(n),sg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YB=new Ph(5e3,15e3),JB="__/auth/iframe",XB="emulator/auth/iframe",ZB={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ez=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function tz(n){const e=n.config;Z(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?DI(e,XB):`https://${n.config.authDomain}/${JB}`,r={apiKey:e.apiKey,appName:n.name,v:Ka},s=ez.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Qa(r).slice(1)}`}async function nz(n){const e=await KB(n),t=yn().gapi;return Z(t,n,"internal-error"),e.open({where:document.body,url:tz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ZB,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=dr(n,"network-request-failed"),a=yn().setTimeout(()=>{i(o)},YB.get());function l(){yn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},sz=500,iz=600,oz="_blank",az="http://localhost";class yb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function lz(n,e,t,r=sz,s=iz){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...rz,width:r.toString(),height:s.toString(),top:i,left:o},u=En().toLowerCase();t&&(a=DP(u)?oz:t),NP(u)&&(e=e||az,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[y,w])=>`${g}${y}=${w},`,"");if(HU(u)&&a!=="_self")return cz(e||"",a),new yb(null);const f=window.open(e||"",a,h);Z(f,n,"popup-blocked");try{f.focus()}catch{}return new yb(f)}function cz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uz="__/auth/handler",dz="emulator/auth/handler",hz=encodeURIComponent("fac");async function _b(n,e,t,r,s,i){Z(n.config.authDomain,n,"auth-domain-config-required"),Z(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ka,eventId:s};if(e instanceof Li){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Ng(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Yc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${hz}=${encodeURIComponent(l)}`:"";return`${fz(n)}?${Qa(a).slice(1)}${u}`}function fz({config:n}){return n.emulator?DI(n,dz):`https://${n.authDomain}/${uz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy="webStorageSupport";class gz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rD,this._completeRedirectFn=uD,this._overrideRedirectResult=MB}async _openPopup(e,t,r,s){var o;Si((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await _b(e,t,r,Kd(),s);return lz(e,i,Pm())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await _b(e,t,r,Kd(),s);return cB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Si(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await nz(e),r=new UB(e);return t.register("authEvent",s=>(Z(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(qy,{type:qy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[qy];i!==void 0&&t(!!i),Tr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=WB(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return FP()||PP()||LI()}}const pz=gz;class fD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Us("unexpected MultiFactorSessionType")}}}class HI extends fD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new HI(e)}_finalizeEnroll(e,t,r){return eB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return vB(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class mz{constructor(){}static assertion(e){return HI._fromCredential(e)}}mz.FACTOR_ID="phone";class yz{static assertionForEnrollment(e,t){return Zd._fromSecret(e,t)}static assertionForSignIn(e,t){return Zd._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;Z(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await tB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return QI._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}yz.FACTOR_ID="totp";class Zd extends fD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Zd(t,void 0,e)}static _fromEnrollmentId(e,t){return new Zd(t,e)}async _finalizeEnroll(e,t,r){return Z(typeof this.secret<"u",e,"argument-error"),nB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Z(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return wB(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class QI{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new QI(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(Sf(e)||Sf(t))&&(r=!0),r&&(Sf(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),Sf(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Sf(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var vb="@firebase/auth",wb="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _z{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Z(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function wz(n){xs(new Sr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Z(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jP(n)},u=new ZU(r,s,i,l);return f$(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),xs(new Sr("auth-internal",e=>{const t=hn(e.getProvider("auth").getImmediate());return(r=>new _z(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),xr(vb,wb,vz(n)),xr(vb,wb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iz=5*60,xz=e1("authIdTokenMaxAge")||Iz;let Ib=null;const Ez=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>xz)return;const s=t==null?void 0:t.token;Ib!==s&&(Ib=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Sz(n=ah()){const e=Js(n,"auth");if(e.isInitialized())return e.getImmediate();const t=h$(n,{popupRedirectResolver:pz,persistence:[_B,eD,rD]}),r=e1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Ez(i.toString());Z$(t,o,()=>o(t.currentUser)),X$(t,a=>o(a))}}const s=JC("auth");return s&&g$(t,`http://${s}`),t}function Tz(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}e$({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=dr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Tz().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});wz("Browser");const gD="@firebase/installations",KI="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pD=1e4,mD=`w:${KI}`,yD="FIS_v2",bz="https://firebaseinstallations.googleapis.com/v1",Az=60*60*1e3,Cz="installations",Rz="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kz={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},za=new Ha(Cz,Rz,kz);function _D(n){return n instanceof Es&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vD({projectId:n}){return`${bz}/projects/${n}/installations`}function wD(n){return{token:n.token,requestStatus:2,expiresIn:Pz(n.expiresIn),creationTime:Date.now()}}async function ID(n,e){const r=(await e.json()).error;return za.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function xD({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Nz(n,{refreshToken:e}){const t=xD(n);return t.append("Authorization",Dz(e)),t}async function ED(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Pz(n){return Number(n.replace("s","000"))}function Dz(n){return`${yD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lz({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=vD(n),s=xD(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:yD,appId:n.appId,sdkVersion:mD},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await ED(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:wD(u.authToken)}}else throw await ID("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mz(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oz=/^[cdef][\w-]{21}$/,Uv="";function Vz(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=Fz(n);return Oz.test(t)?t:Uv}catch{return Uv}}function Fz(n){return Mz(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mm(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD=new Map;function bD(n,e){const t=Mm(n);AD(t,e),jz(t,e)}function AD(n,e){const t=TD.get(n);if(t)for(const r of t)r(e)}function jz(n,e){const t=Uz();t&&t.postMessage({key:n,fid:e}),$z()}let pa=null;function Uz(){return!pa&&"BroadcastChannel"in self&&(pa=new BroadcastChannel("[Firebase] FID Change"),pa.onmessage=n=>{AD(n.data.key,n.data.fid)}),pa}function $z(){TD.size===0&&pa&&(pa.close(),pa=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bz="firebase-installations-database",zz=1,qa="firebase-installations-store";let Wy=null;function YI(){return Wy||(Wy=h1(Bz,zz,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(qa)}}})),Wy}async function fp(n,e){const t=Mm(n),s=(await YI()).transaction(qa,"readwrite"),i=s.objectStore(qa),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&bD(n,e.fid),e}async function CD(n){const e=Mm(n),r=(await YI()).transaction(qa,"readwrite");await r.objectStore(qa).delete(e),await r.done}async function Om(n,e){const t=Mm(n),s=(await YI()).transaction(qa,"readwrite"),i=s.objectStore(qa),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&bD(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JI(n){let e;const t=await Om(n.appConfig,r=>{const s=qz(r),i=Wz(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Uv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function qz(n){const e=n||{fid:Vz(),registrationStatus:0};return RD(e)}function Wz(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(za.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=Gz(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Hz(n)}:{installationEntry:e}}async function Gz(n,e){try{const t=await Lz(n,e);return fp(n.appConfig,t)}catch(t){throw _D(t)&&t.customData.serverCode===409?await CD(n.appConfig):await fp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Hz(n){let e=await xb(n.appConfig);for(;e.registrationStatus===1;)await SD(100),e=await xb(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await JI(n);return r||t}return e}function xb(n){return Om(n,e=>{if(!e)throw za.create("installation-not-found");return RD(e)})}function RD(n){return Qz(n)?{fid:n.fid,registrationStatus:0}:n}function Qz(n){return n.registrationStatus===1&&n.registrationTime+pD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kz({appConfig:n,heartbeatServiceProvider:e},t){const r=Yz(n,t),s=Nz(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:mD,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await ED(()=>fetch(r,a));if(l.ok){const u=await l.json();return wD(u)}else throw await ID("Generate Auth Token",l)}function Yz(n,{fid:e}){return`${vD(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XI(n,e=!1){let t;const r=await Om(n.appConfig,i=>{if(!kD(i))throw za.create("not-registered");const o=i.authToken;if(!e&&Zz(o))return i;if(o.requestStatus===1)return t=Jz(n,e),i;{if(!navigator.onLine)throw za.create("app-offline");const a=t9(i);return t=Xz(n,a),a}});return t?await t:r.authToken}async function Jz(n,e){let t=await Eb(n.appConfig);for(;t.authToken.requestStatus===1;)await SD(100),t=await Eb(n.appConfig);const r=t.authToken;return r.requestStatus===0?XI(n,e):r}function Eb(n){return Om(n,e=>{if(!kD(e))throw za.create("not-registered");const t=e.authToken;return n9(t)?{...e,authToken:{requestStatus:0}}:e})}async function Xz(n,e){try{const t=await Kz(n,e),r={...e,authToken:t};return await fp(n.appConfig,r),t}catch(t){if(_D(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await CD(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await fp(n.appConfig,r)}throw t}}function kD(n){return n!==void 0&&n.registrationStatus===2}function Zz(n){return n.requestStatus===2&&!e9(n)}function e9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Az}function t9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function n9(n){return n.requestStatus===1&&n.requestTime+pD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r9(n){const e=n,{installationEntry:t,registrationPromise:r}=await JI(e);return r?r.catch(console.error):XI(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s9(n,e=!1){const t=n;return await i9(t),(await XI(t,e)).token}async function i9(n){const{registrationPromise:e}=await JI(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o9(n){if(!n||!n.options)throw Gy("App Configuration");if(!n.name)throw Gy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Gy(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Gy(n){return za.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ND="installations",a9="installations-internal",l9=n=>{const e=n.getProvider("app").getImmediate(),t=o9(e),r=Js(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},c9=n=>{const e=n.getProvider("app").getImmediate(),t=Js(e,ND).getImmediate();return{getId:()=>r9(t),getToken:s=>s9(t,s)}};function u9(){xs(new Sr(ND,l9,"PUBLIC")),xs(new Sr(a9,c9,"PRIVATE"))}u9();xr(gD,KI);xr(gD,KI,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gp="analytics",d9="firebase_id",h9="origin",f9=60*1e3,g9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ZI="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er=new oh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Or=new Ha("analytics","Analytics",p9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m9(n){if(!n.startsWith(ZI)){const e=Or.create("invalid-gtag-resource",{gtagURL:n});return Er.warn(e.message),""}return n}function PD(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function y9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function _9(n,e){const t=y9("firebase-js-sdk-policy",{createScriptURL:m9}),r=document.createElement("script"),s=`${ZI}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function v9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function w9(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await PD(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){Er.error(a)}n("config",s,i)}async function I9(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await PD(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Er.error(i)}}function x9(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await I9(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await w9(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Er.error(a)}}return s}function E9(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=x9(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function S9(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(ZI)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T9=30,b9=1e3;class A9{constructor(e={},t=b9){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const DD=new A9;function C9(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function R9(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:C9(t)},s=g9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw Or.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function k9(n,e=DD,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw Or.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Or.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new D9;return setTimeout(async()=>{a.abort()},t!==void 0?t:f9),LD({appId:r,apiKey:s,measurementId:i},o,a,e)}async function LD(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=DD){var a;const{appId:i,measurementId:o}=n;try{await N9(r,e)}catch(l){if(o)return Er.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await R9(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!P9(u)){if(s.deleteThrottleMetadata(i),o)return Er.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?UE(t,s.intervalMillis,T9):UE(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),Er.debug(`Calling attemptFetch again in ${h} millis`),LD(n,f,r,s)}}function N9(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(Or.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function P9(n){if(!(n instanceof Es)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class D9{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function L9(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M9(){if(Dp())try{await j0()}catch(n){return Er.warn(Or.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Er.warn(Or.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function O9(n,e,t,r,s,i,o){const a=k9(n);a.then(g=>{t[g.measurementId]=g.appId,n.options.measurementId&&g.measurementId!==n.options.measurementId&&Er.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${g.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(g=>Er.error(g)),e.push(a);const l=M9().then(g=>{if(g)return r.getId()}),[u,h]=await Promise.all([a,l]);S9(i)||_9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[h9]="firebase",f.update=!0,h!=null&&(f[d9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V9{constructor(e){this.app=e}_delete(){return delete ad[this.app.options.appId],Promise.resolve()}}let ad={},Sb=[];const Tb={};let Hy="dataLayer",F9="gtag",bb,MD,Ab=!1;function j9(){const n=[];if(F0()&&n.push("This is a browser extension environment."),a1()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=Or.create("invalid-analytics-context",{errorInfo:e});Er.warn(t.message)}}function U9(n,e,t){j9();const r=n.options.appId;if(!r)throw Or.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Er.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Or.create("no-api-key");if(ad[r]!=null)throw Or.create("already-exists",{id:r});if(!Ab){v9(Hy);const{wrappedGtag:i,gtagCore:o}=E9(ad,Sb,Tb,Hy,F9);MD=i,bb=o,Ab=!0}return ad[r]=O9(n,Sb,Tb,e,bb,Hy,t),new V9(n)}function $9(n=ah()){n=ce(n);const e=Js(n,gp);return e.isInitialized()?e.getImmediate():B9(n)}function B9(n,e={}){const t=Js(n,gp);if(t.isInitialized()){const s=t.getImmediate();if(Fr(e,t.getOptions()))return s;throw Or.create("already-initialized")}return t.initialize({options:e})}async function z9(){if(F0()||!a1()||!Dp())return!1;try{return await j0()}catch{return!1}}function q9(n,e,t,r){n=ce(n),L9(MD,ad[n.app.options.appId],e,t,r).catch(s=>Er.error(s))}const Cb="@firebase/analytics",Rb="0.10.18";function W9(){xs(new Sr(gp,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return U9(r,s,t)},"PUBLIC")),xs(new Sr("analytics-internal",n,"PRIVATE")),xr(Cb,Rb),xr(Cb,Rb,"esm2020");function n(e){try{const t=e.getProvider(gp).getImmediate();return{logEvent:(r,s,i)=>q9(t,r,s,i)}}catch(t){throw Or.create("interop-component-reg-failed",{reason:t})}}}W9();const OD={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},Vm=sV().length?ah():f1(OD),H=R4(Vm,OD.databaseURL),oi=eU(Vm),ao=Sz(Vm);console.log("✅ Firebase services initialized:",{db:!!H,firestore:!!oi,auth:!!ao});J$(ao,eD).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let G9=null;(async()=>{try{await z9()&&(G9=$9(Vm))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();class Fm{constructor(e,t){this.db=e,this.userUID=t,this.userRef=ue(e,`users/${t}`),this.statsRef=ue(e,`users/${t}/stats`),this.profileRef=ue(e,`users/${t}/profile`),this.behaviorLogRef=ue(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(`🔄 StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await Fe(this.statsRef);if(!s.exists())return console.error(`❌ StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(`🔄 StatManager: ${e} change: ${o} → ${a} (${t>0?"+":""}${t})`),console.log(`🔄 StatManager: About to write to Firebase - ${e}: ${a}`),console.log("🔄 StatManager: Writing to path:",this.statsRef.toString()),console.log("🔄 StatManager: Full stats object to write:",{...i,[e]:a});try{await Ye(this.statsRef,{...i,[e]:a}),console.log(`✅ StatManager: Successfully updated ${e} in Firebase`)}catch(l){throw console.error(`❌ StatManager: Firebase write failed for ${e}:`,l),l}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`❌ StatManager: CRITICAL ERROR updating ${e}:`,s),console.error("❌ StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await Fe(ue(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Fe(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log("🔄 StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await Fe(ue(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await Fe(ue(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log("🔄 StatManager: Last relapse exists:",t.exists()),console.log("🔄 StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),l=r.exists()?r.val():1;console.log(`🔄 StatManager: Current escalation level from Firebase: ${l}`),console.log(`🔄 StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(`🔄 StatManager: After 7+ days clean → escalation level reset to: ${s}`)):(s=l+1,console.log(`🔄 StatManager: Within ${a} days → escalation level: ${l} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(`🔄 StatManager: Escalation level ${s} → addiction increase: +${i}`),console.log("🔄 StatManager: Updating all stats in single write operation...");try{const o=await Fe(this.statsRef);if(!o.exists())return console.error("❌ StatManager: No stats found for user"),!1;const a=o.val();console.log("🔄 StatManager: Current stats before relapse:",a);const l=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(`🔄 StatManager: addictionLevel change: ${a.addictionLevel} → ${l} (+${i})`),console.log(`🔄 StatManager: mentalStrength change: ${a.mentalStrength} → ${u} (-3)`),console.log(`🔄 StatManager: triggerDefense change: ${a.triggerDefense} → ${h} (-3)`);const f={...a,addictionLevel:l,mentalStrength:u,triggerDefense:h};console.log("🔄 StatManager: Writing complete updated stats:",f),await Ye(this.statsRef,f),console.log("✅ StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error("❌ StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([Ye(ue(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),Ye(ue(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),Ye(ue(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await Ye(ue(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await Fe(ue(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Fe(ue(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await Fe(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,l=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:l,cleanWeeks:u,isCleanFor7Days:l>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await Fe(ue(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await Fe(ue(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Fe(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await Fe(ue(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),Ye(ue(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Ye(ue(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=await Fe(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<1)return;const o=await Fe(ue(this.db,`users/${this.userUID}/profile/lastActivity`));if(o.exists()){const u=new Date(o.val()),h=Math.floor((r-u)/(1e3*60*60*24));if(h>=7&&i>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${h} days since last activity`);return}}let a=null,l=null;for(let u=0;u<10;u++){const h=new Date;h.setDate(h.getDate()-u);const f=h.toDateString(),g=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${f}/logged`));if(g.exists()&&g.val()){a=u,l=h;break}}if(a===null||a>=7)if(l){const u=Math.floor((r-l)/864e5);u>=7&&i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${u} days since last activity`))}else i>=7&&(await this.updateStat("motivation",1,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${i} days since registration with no activity`))}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await f4(ue(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await Fe(ue(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await Fe(ue(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await Fe(ue(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Ye(ue(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Ye(ue(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,l=t.canAwardTriggerDefense?3:0;await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+l)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,l=t.canAwardTriggerDefense?.25:0;await Ye(ue(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+l)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await Fe(ue(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const H9=Object.freeze(Object.defineProperty({__proto__:null,default:Fm},Symbol.toStringTag,{value:"Module"}));class Jl{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=Hr(e,"matchingPool"),this.buddyPairsCollection=Hr(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:ds(),lastActive:ds(),status:"waiting"};return await hU(Xf(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await fU(Xf(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:ds(),status:"active",...r},i=await ri(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await rd(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=Xf(this.matchingPoolCollection,e),r=await dU(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async getUserBuddyPair(e){try{console.log("🔄 Firestore: Getting buddy pair for user:",e);const t=Ml(this.buddyPairsCollection,Ol("user1Id","==",e)),r=Ml(this.buddyPairsCollection,Ol("user2Id","==",e)),[s,i]=await Promise.all([rd(t),rd(r)]);let o=null;if(s.empty?i.empty||(o=i.docs[0]):o=s.docs[0],o){const a=o.data();return console.log("✅ Firestore: Found buddy pair:",o.id),{id:o.id,...a}}else return console.log("ℹ️ Firestore: No buddy pair found for user"),null}catch(t){return console.error("❌ Firestore: Error getting buddy pair:",t),null}}async testConnectivity(){try{return console.log("🧪 Firestore: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ Firestore: Service available and initialized"),!0):(console.warn("⚠️ Firestore: Service not properly initialized"),!1)}catch(e){return console.warn("⚠️ Firestore: Connectivity check failed (non-critical):",(e==null?void 0:e.message)||e),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}class Q9{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log("🚀 FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:ds(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await ri(Hr(this.firestore,this.collections.cravings),r);return console.log("✅ Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:ds(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await ri(Hr(this.firestore,this.collections.relapses),r);return console.log("✅ Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:ds(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await ri(Hr(this.firestore,this.collections.hydration),r);return console.log("✅ Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:ds(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await ri(Hr(this.firestore,this.collections.breathing),r);return console.log("✅ Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:ds(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await ri(Hr(this.firestore,this.collections.meditation),r);return console.log("✅ Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:ds(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await ri(Hr(this.firestore,this.collections.physicalActivity),r);return console.log("✅ Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:ds(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await ri(Hr(this.firestore,this.collections.moodTracking),r);return console.log("✅ Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=Ml(Hr(this.firestore,this.collections[t]),Ol("userId","==",e),lU("timestamp","desc"));r&&(i=Ml(i,Ol("timestamp",">=",yt.fromDate(new Date(r))))),s&&(i=Ml(i,Ol("timestamp","<=",yt.fromDate(new Date(s)))));const o=await rd(i),a=[];return o.forEach(l=>{var u;a.push({id:l.id,...l.data(),timestamp:((u=l.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(`✅ Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(`❌ Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(`📊 Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,l,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(y=>(console.warn("⚠️ Cravings data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(y=>(console.warn("⚠️ Relapses data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(y=>(console.warn("⚠️ Hydration data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(y=>(console.warn("⚠️ Breathing data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(y=>(console.warn("⚠️ Meditation data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(y=>(console.warn("⚠️ Physical activity data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(y=>(console.warn("⚠️ Mood data not available yet (indexes building):",y.message),[]))]),g={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(y=>y.outcome==="resisted").length,relapsed:i.filter(y=>y.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((y,w)=>y+(w.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((y,w)=>y+(w.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(y=>y.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(y=>y.achievedTarget).length,breathingExercises:l.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:l.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((y,w)=>y+(w.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,l,u,h,f),generatedAt:new Date};return console.log("📊 Behavioral analytics generated:",g),g}catch(r){throw console.error("❌ Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const l=[],u=e.filter(y=>y.outcome==="resisted").length,h=e.length;if(h>0){const y=u/h*100;l.push(`Craving resistance rate: ${y.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&l.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const g=r.filter(y=>y.achievedTarget).length;return g>0&&l.push(`Achieved hydration target on ${g} days`),l}async migrateUserData(e,t){try{console.log(`🔄 Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let l=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?yt.fromDate(new Date(h.timestamp)):ds(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await ri(Hr(this.firestore,this.collections.cravings),f),l++}catch(f){console.error(`❌ Error migrating craving ${u}:`,f)}console.log(`✅ Migrated ${l} cravings to Firestore`)}return console.log(`✅ Data migration completed for user ${e}`),!0}catch(r){throw console.error("❌ Error during data migration:",r),r}}async testConnectivity(){try{return console.log("🧪 FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn("⚠️ FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn("⚠️ FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(`📊 Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=Ml(Hr(this.db,s),Ol("userId","==",e)),o=await rd(i);r[s]=o.size}catch(i){console.warn(`⚠️ Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error("❌ Error generating basic analytics:",t),t}}}class kb{constructor(e,t){this.db=e,this.userId=t,this.statsRef=ue(e,`users/${t}/stats`),this.profileRef=ue(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{console.log(`📊 CentralizedStats: Refreshing all stats for user ${this.userId}`);const[e,t,r]=await Promise.all([Fe(this.profileRef),Fe(this.statsRef),Fe(ue(this.db,`users/${this.userId}`))]),s=e.exists()?e.val():{},i=r.exists()?r.val():{},o={...s,createdAt:s.createdAt||i.createdAt||null,quitDate:s.quitDate||i.quitDate||i.quitStartDate||null,lastQuitDate:s.lastQuitDate||i.lastQuitDate||null};if(!o.lastRelapseDate&&!o.quitDate&&o.createdAt)try{await Ye(ue(this.db,`users/${this.userId}/profile/quitDate`),o.createdAt),o.quitDate=o.createdAt,console.log(`📊 CentralizedStats: Seeded missing quitDate with createdAt for ${this.userId}: ${o.createdAt}`)}catch(x){console.warn(`⚠️ CentralizedStats: Could not seed quitDate for ${this.userId}:`,x.message)}const a=t.exists()?t.val():this.getDefaultStats(),l=this.calculateEffectiveQuitDate(o),u=this.calculateStreakFromRelapse(o),h=await this.calculateCravingsResisted(),f=await this.calculateAddictionLevel(o,l),g=this.calculateMentalStrength(a,h),y=g.strength,w=g.cravingsApplied,C=await this.checkMilestonesFromRelapse(o,a),N=await this.generateSpecialFeatures(o),A={...a,...C,streakDays:u.value,streakUnit:u.unit,streakDisplayText:u.displayText,cravingsResisted:h,addictionLevel:f,mentalStrength:y,mentalStrengthCravingsApplied:w,specialFeatures:N,lastUpdated:new Date().toISOString()};return await Ye(this.statsRef,A),console.log(`✅ CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:u.displayText,cravingsResisted:h,addictionLevel:f,mentalStrength:y,specialFeatures:(N==null?void 0:N.length)||0,effectiveQuitDate:l}),A}catch(e){throw console.error(`❌ CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||null;if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(`📊 CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(`📊 CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const l=e.lastQuitDate||e.originalQuitDate||e.quitDate||e.createdAt||null;return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${l}`),l?this.calculateStreak(l):{value:0,unit:"hours",displayText:"0 hours",streakDays:0}}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return console.log(`📊 CentralizedStats: Streak calculation for ${this.userId}:`),console.log(`  - Last relapse: ${r}`),console.log(`  - Current time: ${t.toISOString()}`),console.log(`  - Hours since relapse: ${o}`),console.log(`  - Days since relapse: ${a}`),o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([Fe(ue(this.db,`users/${this.userId}/profile/cravingsResisted`)),Fe(ue(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(`📊 CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length,console.log(`📊 CentralizedStats: Counted cravings from collection: ${r}`)}return r}catch(e){return console.warn(`⚠️ CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}calculateMentalStrength(e,t){try{const r=e.mentalStrength||50,s=e.mentalStrengthCravingsApplied||0;return console.log(`📊 CentralizedStats: Mental strength calculation for ${this.userId}: ${r} (cravings applied: ${s}/3)`),{strength:r,cravingsApplied:s}}catch(r){return console.warn(`⚠️ CentralizedStats: Could not calculate mental strength for ${this.userId}:`,r.message),{strength:e.mentalStrength||50,cravingsApplied:e.mentalStrengthCravingsApplied||0}}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([Fe(this.statsRef),Fe(ue(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Fe(ue(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(`📊 CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(`📊 CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(`📊 CentralizedStats: Days since last relapse: ${u}`),console.log(`📊 CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await Ye(ue(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const g=Math.floor(u/7),y=g*2;let w=Math.max(30,o-y);return console.log(`📊 CentralizedStats: Base addiction: ${o}, Weeks clean: ${g}, Decay: -${y}, Final: ${w}`),w}catch(r){return console.error("❌ CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},l=!1;for(const u of o)if(i>=u.days){const h=ue(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await Fe(h)).exists()){const g=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=g,l=!0,await Ye(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let l={},u=!1;for(const h of a)if(o>=h.days){const f=ue(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await Fe(f)).exists()){const y=Math.min(100,(t.mentalStrength||50)+h.bonus);l.mentalStrength=y,u=!0,await Ye(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return l}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await Fe(ue(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(`📊 CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await Fe(ue(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(`📊 CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(`⚠️ CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(`📊 CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(`📊 CentralizedStats: Generated ${o.length} personalized features:`,o);const l=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=l[Math.floor(Math.random()*l.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await Ye(ue(this.db,`users/${this.userId}/specialFeatures`),u),console.log(`📊 CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(`❌ CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=kR(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(`🔄 CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:"🎉 First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

🧠 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! 💪`},30:{title:"🏆 One Month Champion!",message:`Amazing! You've reached 30 days clean!

🧠 Mental Strength: +${e.bonus} points

You're proving your strength every day! 🌟`},90:{title:"👑 Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

🧠 Mental Strength: +${e.bonus} points

You're a true inspiration! 🎯✨`}}[e.days]||{title:"🎉 Milestone Achieved!",message:`You've reached ${t} days clean!

🧠 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(`🎉 Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(`🔄 CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=ue(this.db,`users/${this.userId}/profile/milestones`);await Ye(e,null),console.log(`✅ CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(`❌ CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(`🔄 CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([Fe(ue(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Fe(ue(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),Fe(this.statsRef)]);let o=1;if(r.exists()){const g=new Date(r.val()),y=Math.floor((e-g)/(1e3*60*60*24)),w=s.exists()?s.val():1;console.log(`🔄 CentralizedStats: Current escalation level: ${w}`),console.log(`🔄 CentralizedStats: Days since last relapse: ${y}`),y>=7?(o=1,console.log(`🔄 CentralizedStats: After 7+ days clean → escalation level reset to: ${o}`)):(o=w+1,console.log(`🔄 CentralizedStats: Within ${y} days → escalation level: ${w} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(`🔄 CentralizedStats: Escalation level ${o} → addiction increase: +${a}`);const l=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(l.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(l.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(l.triggerDefense||30)-3));console.log(`🔄 CentralizedStats: addictionLevel change: ${l.addictionLevel} → ${u} (+${a})`),console.log(`🔄 CentralizedStats: mentalStrength change: ${l.mentalStrength} → ${h} (-3)`),console.log(`🔄 CentralizedStats: triggerDefense change: ${l.triggerDefense} → ${f} (-3)`),await Promise.all([Ye(ue(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),Ye(ue(this.db,`users/${this.userId}/profile/relapseDate`),t),Ye(ue(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),Ye(ue(this.db,`users/${this.userId}/lastQuitDate`),t),Ye(ue(this.db,`users/${this.userId}/profile/lastQuitDate`),t),this.resetMilestones(),Ye(this.statsRef,{...l,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(`✅ CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(`❌ CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async getCurrentStats(){try{const e=await Fe(this.statsRef);return e.exists()?e.val():this.getDefaultStats()}catch(e){return console.error(`❌ CentralizedStats: Error getting current stats for ${this.userId}:`,e),this.getDefaultStats()}}async handleCravingResisted(){try{console.log(`🔄 CentralizedStats: Handling craving resisted for ${this.userId}`),await this.checkAndResetDailyCounter();const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsApplied||0;if(console.log(`🔄 CentralizedStats: Current mental strength cravings applied: ${t}`),t<3){const r=Math.min(100,(e.mentalStrength||50)+1),s=t+1;return await Ye(this.statsRef,{...e,mentalStrength:r,mentalStrengthCravingsApplied:s,mentalStrengthCravingsAppliedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()}),console.log(`✅ CentralizedStats: Applied +1 mental strength (${e.mentalStrength} → ${r}), cravings applied: ${s}/3`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!0,cravingsApplied:s,limitReached:s>=3}}else return console.log(`📊 CentralizedStats: Daily mental strength limit reached (${t}/3), no bonus applied`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!1,cravingsApplied:t,limitReached:!0}}catch(e){throw console.error(`❌ CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}async checkAndResetDailyCounter(){try{const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsAppliedDate,r=new Date,s=r.toDateString();if(!t){await Ye(this.statsRef,{...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()}),console.log(`✅ CentralizedStats: Initialized daily counter for ${this.userId} (reset to 0)`);return}new Date(t).toDateString()!==s&&(console.log(`🔄 CentralizedStats: New day detected, resetting daily mental strength counter for ${this.userId}`),await Ye(this.statsRef,{...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()}),console.log(`✅ CentralizedStats: Daily mental strength counter reset for ${this.userId}`))}catch(e){console.warn(`⚠️ CentralizedStats: Could not check/reset daily counter for ${this.userId}:`,e.message)}}}const K9=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=V.useState("signin"),[s,i]=V.useState(""),[o,a]=V.useState(""),[l,u]=V.useState(""),[h,f]=V.useState(!1),[g,y]=V.useState(!1),[w,C]=V.useState(""),[N,A]=V.useState(""),[x,R]=V.useState(!1);V.useEffect(()=>()=>{g&&y(!1)},[g]);const D=new ai;D.addScope("email"),D.addScope("profile"),D.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const U=()=>{i(""),a(""),u(""),C(""),A("")},P=async()=>{f(!0),y(!0),C("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:D.scopes,customParameters:D.customParameters});const I=NB(ao,D),k=new Promise((K,vt)=>{setTimeout(()=>vt(new Error("Popup timeout - please try again")),6e4)}),S=await Promise.race([I,k]);if(S&&S.user){const K=S.user;console.log("Google sign-in successful for:",K.email,"UID:",K.uid),console.log("User display name:",K.displayName),console.log("User photo URL:",K.photoURL),await new Promise(vt=>setTimeout(vt,800)),n(K)}else throw new Error("No user data received from Google authentication")}catch(I){console.error("Google sign-in error:",I),I.code==="auth/popup-closed-by-user"?C("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):I.code==="auth/popup-blocked"?C("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):I.code==="auth/cancelled-popup-request"?C("Google sign-in was cancelled. Please try again and complete the authentication process."):I.code==="auth/account-exists-with-different-credential"?C("An account already exists with this email using a different sign-in method. Please use email/password instead."):I.message==="Popup timeout - please try again"?C("Google sign-in popup timed out. Please try again and complete the account selection quickly."):I.code==="auth/network-request-failed"?C("Network error during Google sign-in. Please check your internet connection and try again."):I.code==="auth/operation-not-allowed"?C("Google sign-in is not enabled for this app. Please contact support."):C(_(I.code))}finally{f(!1),y(!1)}},T=async I=>{I.preventDefault(),f(!0),C("");try{const S=(await B$(ao,s,o)).user;console.log("Email sign-in successful for:",S.email),n(S)}catch(k){console.error("Email sign-in error:",k),C(_(k.code))}finally{f(!1)}},v=async I=>{if(I.preventDefault(),f(!0),C(""),o!==l){C("Passwords do not match"),f(!1);return}if(o.length<6){C("Password must be at least 6 characters long"),f(!1);return}try{const S=(await $$(ao,s,o)).user;console.log("Email sign-up successful for:",S.email),await q$(S),n(S)}catch(k){console.error("Email sign-up error:",k),C(_(k.code))}finally{f(!1)}},b=async I=>{if(I.preventDefault(),!s){C("Please enter your email address");return}f(!0),C("");try{await j$(ao,s),A("Password reset email sent! Check your inbox.")}catch(k){console.error("Password reset error:",k),C(_(k.code))}finally{f(!1)}},_=I=>{switch(I){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return x?d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),d.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),d.jsxs("form",{onSubmit:b,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:s,onChange:I=>i(I.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),N&&d.jsx("div",{className:"text-green-400 text-sm",children:N}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"button",onClick:()=>{R(!1),C(""),A("")},className:"flex-1 px-4 py-2 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Back to Login"}),d.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Sending...":"Send Reset Link"})]})]})]})}):d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),d.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),d.jsxs("div",{children:[g&&d.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[d.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),d.jsx("button",{onClick:P,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),d.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:g?d.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,w&&d.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[d.jsx("div",{className:"text-red-300 text-sm mb-2",children:w}),w.includes("Google sign-in")&&!g&&d.jsx("button",{onClick:P,disabled:h,className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),d.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[d.jsx("button",{onClick:()=>{r("signin"),U()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),d.jsx("button",{onClick:()=>{r("signup"),U()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&d.jsxs("form",{onSubmit:T,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signin-email",type:"email",value:s,onChange:I=>i(I.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signin-password",type:"password",value:o,onChange:I=>a(I.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("button",{type:"button",onClick:()=>R(!0),className:"text-sm text-blue-400 hover:text-blue-300",children:"Forgot your password?"})}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&d.jsxs("form",{onSubmit:v,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signup-email",type:"email",value:s,onChange:I=>i(I.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signup-password",type:"password",value:o,onChange:I=>a(I.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),d.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:I=>u(I.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),N&&d.jsx("div",{className:"text-green-400 text-sm",children:N}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Creating account...":"Create Account"})]})]})})},Y9=({offlineManager:n})=>{const[e,t]=V.useState(navigator.onLine),[r,s]=V.useState(!1),[i,o]=V.useState(0),[a,l]=V.useState(!1);return V.useEffect(()=>{const u=()=>{t(!0),s(!1),console.log("🌐 Connection restored"),n&&i>0&&(l(!0),setTimeout(()=>{l(!1),o(0)},2e3))},h=()=>{t(!1),s(!0),console.log("📡 Connection lost")};window.addEventListener("online",u),window.addEventListener("offline",h),t(navigator.onLine);const f=async()=>{if(n)try{const y=await n.getQueuedActionsCount();o(y)}catch(y){console.warn("Could not get queued actions count:",y)}};f();const g=setInterval(f,5e3);return()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),clearInterval(g)}},[n,i]),e&&a?d.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white p-3 text-center shadow-lg",children:d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),d.jsxs("span",{className:"font-medium",children:["Syncing ",i," offline actions..."]})]})}):e&&!a&&i===0||e?null:d.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),d.jsxs("span",{className:"font-medium",children:["You're offline. Some features may be limited.",i>0&&` (${i} actions queued)`]}),d.jsx("button",{onClick:()=>s(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors",children:d.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&d.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[d.jsx("p",{className:"mb-2",children:"While offline, you can:"}),d.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[d.jsx("li",{children:"• View your current stats and progress"}),d.jsx("li",{children:"• Track habits and cravings"}),d.jsx("li",{children:"• Log water intake and breathing exercises"}),d.jsx("li",{children:"• Record craving assessments and resistance"}),d.jsx("li",{children:"• Play distraction games"}),d.jsx("li",{children:"• View your profile information"})]}),d.jsxs("p",{className:"mt-2 text-yellow-200",children:["All changes will sync automatically when you're back online.",i>0&&d.jsxs("span",{className:"block mt-1 font-medium",children:["💾 ",i," action",i!==1?"s":""," queued for sync"]})]})]})]})},J9=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),d.jsx("p",{className:"text-slate-400",children:"Configure your breathing session"})]}),d.jsx("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-6 mb-6 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-12 h-12 bg-slate-700/50 rounded-xl flex items-center justify-center group-hover:bg-slate-600/50 transition-colors",children:d.jsx("span",{className:"text-2xl",children:"🫁"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:"text-white font-semibold text-lg",children:"BREATHING RATE"}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[n.inhale,"s | ",n.exhale,"s"]})]})]}),d.jsxs("div",{className:"text-right",children:[d.jsx("div",{className:"text-white font-bold text-lg",children:n.name}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[n.inhale,"s | ",n.exhale,"s"]})]})]})}),d.jsx("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-6 mb-8 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-12 h-12 bg-slate-700/50 rounded-xl flex items-center justify-center group-hover:bg-slate-600/50 transition-colors",children:d.jsx("span",{className:"text-2xl",children:"⏱️"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:"text-white font-semibold text-lg",children:"DURATION"}),d.jsx("div",{className:"text-slate-400 text-sm",children:"Session length"})]})]}),d.jsxs("div",{className:"text-right",children:[d.jsxs("div",{className:"text-white font-bold text-lg",children:[e,"min."]}),d.jsx("div",{className:"text-slate-400 text-sm",children:"Total time"})]})]})}),d.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl",children:"START EXERCISE"}),d.jsx("div",{className:"mt-6 text-center",children:d.jsx("p",{className:"text-slate-400 text-sm",children:"Find a comfortable position and prepare to relax"})})]}),X9=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),d.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),d.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>d.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),d.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&d.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:d.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),d.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},Z9=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=V.useState(n),i=2,o=10;V.useEffect(()=>{s(n)},[n]);const a=f=>{const g=parseInt(f.target.value);s(g),navigator.vibrate&&navigator.vibrate(50),console.log(`🎯 Duration picker: Selected ${g} minutes`)},l=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),d.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),d.jsxs("div",{className:"text-center mb-8",children:[d.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),d.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),d.jsx("div",{className:"mb-8",children:d.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4",autoComplete:"off"})}),d.jsx("button",{onClick:l,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),d.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},eq=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=V.useState(e*60),[g,y]=V.useState("inhale"),[w,C]=V.useState(0),[N,A]=V.useState(!1),[x,R]=V.useState(.1),[D,U]=V.useState(!1),[P,T]=V.useState(!1),v=V.useRef(null),b=V.useRef(null);V.useEffect(()=>{h===0&&N&&!P&&(console.log("🎯 Exercise completed, calling onComplete"),T(!0),t())},[h,N,P,t]);const _=()=>{console.log(`⏰ Starting main timer for ${e} minutes`),b.current&&(console.log("⚠️ Timer already exists, clearing previous timer"),clearInterval(b.current)),b.current=setInterval(()=>{f(Y=>{if(Y<=1)return console.log(`⏰ Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(b.current),b.current=null,0;const X=Y-1;return X%10===0&&console.log(`⏰ Main timer: ${X}s remaining`),X})},1e3),console.log("✅ Main timer started successfully")},I=()=>{console.log(`🚀 Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),v.current&&(console.log("⚠️ Animation already running, clearing previous animation"),cancelAnimationFrame(v.current));const Y=n.inhale+n.exhale;let X=0,he=0,Ae="inhale";console.log(`📊 Cycle duration: ${Y}s, starting animation loop...`);const ye=()=>{if(X+=16,X>=Y*1e3&&(console.log(`🔄 Breathing cycle completed, resetting to 0ms. Current phase: ${Ae}, phaseTime: ${w}`),X=0,he=0,Ae="inhale",y("inhale"),C(0)),X<n.inhale*1e3){Ae!=="inhale"&&(console.log(`🔄 Switching to INHALE phase at ${X}ms`),Ae="inhale",y("inhale"),C(0),he=0);const Le=X/(n.inhale*1e3),re=.1+k(Le)*3.9;R(re);const ne=Math.floor(Le*n.inhale);ne!==he&&(C(ne),he=ne,console.log(`⏱️ INHALE: ${ne}/${n.inhale}s (phase: ${Ae}, scale: ${re.toFixed(3)})`))}else{Ae!=="exhale"&&(console.log(`🔄 Switching to EXHALE phase at ${X}ms`),Ae="exhale",y("exhale"),C(0),he=0);const Le=(X-n.inhale*1e3)/(n.exhale*1e3),re=4-k(Le)*3.9;R(re);const ne=Math.floor(Le*n.exhale);ne!==he&&(C(ne),he=ne,console.log(`⏱️ EXHALE: ${ne}/${n.exhale}s (phase: ${Ae}, scale: ${re.toFixed(3)})`))}v.current=requestAnimationFrame(ye)};ye(),console.log("✅ Breathing cycle animation started successfully")},k=Y=>Y<.5?2*Y*Y:-1+(4-2*Y)*Y;V.useEffect(()=>(N&&(_(),I()),()=>{N&&B()}),[N]);const S=Y=>{const X=Math.floor(Y/60),he=Y%60;return`${X.toString().padStart(2,"0")}:${he.toString().padStart(2,"0")}`},K=()=>w,vt=()=>g==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",Ve=()=>g==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",ln=()=>{console.log("🔄 User clicked close button, showing confirmation popup"),U(!0)},te=()=>{console.log("🚪 User confirmed leaving exercise, cleaning up..."),B(),s?s():r()},pe=()=>{U(!1)},L=()=>{if(N){console.log("⚠️ Exercise already active, ignoring start request");return}console.log(`🎬 Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(`📊 Initial state - isActive: ${N}, progress: ${x}, currentPhase: ${g}`),R(.1),y("inhale"),C(0),f(e*60),A(!0),console.log("✅ isActive set to true, starting timers..."),setTimeout(()=>{console.log("🚀 Starting main timer and breathing cycle..."),_(),I()},0)},B=()=>{console.log("🧹 Cleaning up breathing exercise resources"),v.current&&(cancelAnimationFrame(v.current),v.current=null),b.current&&(clearInterval(b.current),b.current=null),A(!1),f(0),R(.1),y("inhale"),C(0)};return V.useEffect(()=>{N||(console.log("🎬 Component mounted, starting breathing exercise automatically"),L())},[]),d.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-6",children:[d.jsx("button",{onClick:ln,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50",title:"End breathing exercise",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"text-white text-2xl font-mono",children:S(h)})}),d.jsx("div",{className:"w-11"})," "]}),d.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[d.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),d.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${vt()} rounded-full shadow-2xl`,style:{transform:`scale(${x})`,transition:"none",boxShadow:`0 0 ${Math.max(x*40,10)}px ${Math.max(x*15,5)}px ${g==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),d.jsxs("div",{className:"p-6 text-center",children:[d.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:d.jsx("span",{className:"text-white text-lg leading-tight",children:Ve()})}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[K(),"/",g==="inhale"?n.inhale:n.exhale,"s"]})]}),d.jsx("div",{className:"px-6 pb-6",children:d.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:d.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),D&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mx-4 max-w-sm w-full border border-slate-600/50",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),d.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{onClick:te,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors",children:"Leave"}),d.jsx("button",{onClick:pe,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors",children:"Stay"})]})]})})]})},tq=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=V.useState("setup"),[o,a]=V.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[l,u]=V.useState(4),[h,f]=V.useState(!1);V.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const g=x=>{a(x),i("setup")},y=x=>{u(x),i("setup")},w=()=>{f(!0),i("exercise")},C=()=>{f(!1),i("setup"),r&&r(),e()},N=()=>{s==="exercise"&&h||e()},A=()=>{console.log("🚪 User leaving breathing exercise via close button"),e(),t&&t()};return n?d.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:N}),d.jsxs("div",{className:"relative w-full max-w-md mx-4 bg-slate-900 rounded-3xl shadow-2xl border border-slate-700/50 overflow-hidden",children:[!(s==="exercise"&&h)&&d.jsx("button",{onClick:N,className:"absolute top-4 left-4 z-10 w-8 h-8 flex items-center justify-center text-white hover:text-slate-300 transition-colors",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&d.jsx(J9,{selectedRate:o,duration:l,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:w}),s==="rate"&&d.jsx(X9,{selectedRate:o,onSelect:g,onBack:()=>i("setup")}),s==="duration"&&d.jsx(Z9,{selectedDuration:l,onSelect:y,onBack:()=>i("setup")}),s==="exercise"&&d.jsx(eq,{rate:o,duration:l,onComplete:C,onClose:N,onLeave:A})]})]}):null};var nq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const rq=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),sq=(n,e)=>{const t=V.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>V.createElement("svg",{ref:u,...nq,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${rq(n)}`,...l},[...e.map(([h,f])=>V.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var Qn=sq;const iq=Qn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),oq=Qn("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),VD=Qn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),FD=Qn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),jD=Qn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),aq=Qn("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Tf=Qn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),UD=Qn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),eh=Qn("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),lq=Qn("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),$D=Qn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),cq=Qn("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),uq=Qn("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),dq=Qn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),BD=Qn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),zD=Qn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),qD=Qn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),hq=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=V.useState(null),[i,o]=V.useState(!0),[a,l]=V.useState(30);V.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(oq,{className:"w-6 h-6 text-blue-400"}),d.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("select",{value:a,onChange:h=>l(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-2 rounded border border-slate-600",children:[d.jsx("option",{value:7,children:"Last 7 days"}),d.jsx("option",{value:30,children:"Last 30 days"}),d.jsx("option",{value:90,children:"Last 90 days"})]}),d.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:"✕"})]})]}),d.jsx("div",{className:"p-6",children:i?d.jsxs("div",{className:"text-center py-8",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(uq,{className:"w-5 h-5 text-green-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(dq,{className:"w-5 h-5 text-blue-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(VD,{className:"w-5 h-5 text-purple-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),d.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"text-orange-400",children:"💧"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),d.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),d.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>d.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🫁 Breathing Exercises"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🧘‍♀️ Meditation Sessions"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🚶‍♂️ Physical Activities"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"💧 Hydration Goals Met"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>d.jsxs("div",{className:"flex justify-between",children:[d.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),d.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),d.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>d.jsxs("p",{className:"text-gray-300 text-sm",children:["• ",h]},f)),r.insights.length===0&&d.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"📡 System Status"}),d.jsxs("div",{className:"space-y-2 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),d.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),d.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),d.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),g=document.createElement("a");g.href=f,g.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,g.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-colors",children:"Export Analytics Data"})]})]}):d.jsxs("div",{className:"text-center py-8",children:[d.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),d.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})}):d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full mx-4",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),d.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),d.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors",children:"Close"})]})})};console.log("🧪 FirestoreBuddyService import check:",!!Jl);console.log("🧪 FirestoreBuddyService type:",typeof Jl);console.log("🧪 FirestoreBuddyService constructor:",Jl==null?void 0:Jl.name);const Ps=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},bf=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},Af=n=>n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e",ks=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},fq=({onComplete:n,authUser:e})=>{const[t,r]=V.useState(1),[s,i]=V.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[o,a]=V.useState(!1),[l,u]=V.useState(!1),[h,f]=V.useState(null),[g,y]=V.useState(null),w=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:eh},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:qD},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:jD},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:FD}],C=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],N=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],A=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],x=()=>{console.log("Calculating stats with userData:",s);let _=40;s.vapePodsPerWeek<=1?_+=5:s.vapePodsPerWeek<=3?_+=15:s.vapePodsPerWeek<=5?_+=25:s.vapePodsPerWeek<=7?_+=35:_+=40;const I=s.nicotineStrength||"",k=parseInt(I.replace("mg",""))||0;k<=5?_+=0:k<=11?_+=10:k<=20?_+=20:_+=25,s.dailyPatterns.includes("Throughout the day")?_+=20:s.dailyPatterns.length>2?_+=10:_+=0,_=Math.min(_,100);let S=25;s.confidence>=9?S+=35:s.confidence>=7?S+=25:s.confidence>=4?S+=15:S+=0,s.quitAttempts==="first"?S+=15:parseInt(s.quitAttempts)<=3?S+=10:S+=5,s.copingStrategies.length>=3?S+=15:s.copingStrategies.length>=1?S+=10:S+=0,S=Math.min(S,80);let K=35;K+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[s.archetype]||0,s.confidence>=8?K+=25:s.confidence>=5?K+=15:K+=0,s.quitAttempts==="first"?K+=10:parseInt(s.quitAttempts)<=3?K+=5:K+=15,K=Math.min(K,90);let Ve=15;s.triggers.length<=2?Ve+=15:s.triggers.length<=4?Ve+=10:Ve+=5;const ln=s.triggers.includes("Drinking alcohol"),te=s.triggers.includes("Social situations");return ln&&te?Ve+=0:s.triggers.length>3?Ve+=5:Ve+=10,s.copingStrategies.length>=3?Ve+=25:s.copingStrategies.length>=1?Ve+=15:Ve+=0,s.dailyPatterns.includes("Throughout the day")?Ve+=0:s.dailyPatterns.length>2?Ve+=5:Ve+=10,Ve=Math.min(Ve,60),{addictionLevel:_,mentalStrength:S,motivation:K,triggerDefense:Ve}},R=_=>{const I=_.target.files[0];if(I){f(I);const k=new FileReader;k.onload=S=>y(S.target.result),k.readAsDataURL(I)}},D=async()=>{if(h){u(!0);try{const _=document.createElement("canvas"),I=_.getContext("2d"),k=new Image;k.onload=()=>{_.width=200,_.height=200,I.filter="contrast(1.2) saturate(1.3) brightness(1.1)",I.drawImage(k,0,0,200,200),I.globalCompositeOperation="overlay",I.fillStyle="rgba(255, 200, 200, 0.1)",I.fillRect(0,0,200,200);const S=_.toDataURL("image/png"),K={...s,avatar:S};i(K),b(K,3),u(!1)},k.src=g}catch(_){console.error("Photo processing failed:",_);const I=bf(s.avatarSeed);i(k=>({...k,avatar:I})),u(!1)}}},U=()=>{a(!0);const _=Math.random().toString(36).substring(7);(async()=>{try{const k=Ps(_),S={...s,avatarSeed:_,avatar:k};i(S),b(S,3)}catch{const S=bf(_),K={...s,avatarSeed:_,avatar:S};i(K),b(K,3)}})(),setTimeout(()=>a(!1),500)},P=async()=>{if(t<10)await b(s,t),r(t+1);else try{console.log("Completing onboarding with userData:",s);const _=x();console.log("Calculated stats:",_);const I={...s,stats:{..._,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await b(I,10),console.log("Final user data:",I),n(I)}catch(_){console.error("Error completing onboarding:",_);const k={...s,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await b(k,10)}catch(S){console.error("Failed to save fallback data to Firebase:",S)}console.log("Using fallback stats:",k),n(k)}},T=()=>{t>1&&r(t-1)},v=()=>{switch(t){case 1:return s.heroName.trim().length>0;case 2:return s.archetype!=="";case 3:return s.avatar!==null;case 4:return s.triggers.length>0;case 5:return s.dailyPatterns.length>0;case 6:return s.copingStrategies.length>0;case 7:return s.vapePodsPerWeek>0;case 8:return s.nicotineStrength!=="";case 9:return s.quitAttempts!=="";case 10:return s.confidence>0;default:return!1}},b=async(_,I)=>{if(e)try{const{ref:k,set:S}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),K=k(H,`users/${e.uid}/onboarding`);await S(k(H,`users/${e.uid}/onboarding/step${I}`),{..._,stepNumber:I,timestamp:Date.now()}),await S(k(H,`users/${e.uid}/onboarding/progress`),{currentStep:I,completedSteps:Array.from({length:I},(vt,Ve)=>Ve+1),lastUpdated:Date.now()}),console.log(`Step ${I} saved to Firebase successfully`)}catch(k){console.error(`Error saving step ${I} to Firebase:`,k)}};return V.useEffect(()=>{if(!s.avatar){const _=Ps(s.avatarSeed);i(I=>({...I,avatar:_}))}},[]),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(_=>d.jsxs("div",{className:"flex items-center flex-shrink-0",children:[d.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${_<=t?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:_<t?"✓":_}),_<10&&d.jsx("div",{className:`w-4 h-1 mx-1 ${_<t?"bg-blue-500":"bg-slate-600"}`})]},_))}),t===1&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(lq,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),d.jsx("input",{type:"text",value:s.heroName,onChange:_=>{const I={...s,heroName:_.target.value};i(I),_.target.value.trim().length>0&&b(I,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",autoComplete:"name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t===2&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(eh,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),d.jsx("div",{className:"space-y-3 mb-6",children:w.map(_=>{const I=_.icon;return d.jsx("button",{onClick:()=>{const k={...s,archetype:_.id};i(k),b(k,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.archetype===_.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 ${_.color} rounded-lg flex items-center justify-center`,children:d.jsx(I,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-white font-semibold",children:_.name}),d.jsx("p",{className:"text-gray-400 text-sm",children:_.description})]})]})},_.id)})})]}),t===3&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(zD,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:s.avatar?d.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{i(_=>({..._,avatar:bf(_.avatarSeed)}))}}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(Tf,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),d.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"hidden",id:"photo-upload",autoComplete:"photo"}),d.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),g&&d.jsx("div",{className:"mb-4",children:d.jsx("button",{onClick:D,disabled:l,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?d.jsxs(d.Fragment,{children:[d.jsx(Tf,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):d.jsx(d.Fragment,{children:"✨ Convert to Anime"})})}),d.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),d.jsx("button",{onClick:U,disabled:o,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:o?d.jsxs(d.Fragment,{children:[d.jsx(Tf,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):d.jsxs(d.Fragment,{children:[d.jsx(Tf,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),d.jsx("button",{onClick:()=>{const _=bf(s.avatarSeed),I={...s,avatar:_};i(I),b(I,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),t===4&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:C.map(_=>d.jsx("button",{onClick:()=>{const I={...s,triggers:s.triggers.includes(_)?s.triggers.filter(k=>k!==_):[...s.triggers,_]};i(I),b(I,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.triggers.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.triggers.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.triggers.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===5&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📅"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:N.map(_=>d.jsx("button",{onClick:()=>{const I={...s,dailyPatterns:s.dailyPatterns.includes(_)?s.dailyPatterns.filter(k=>k!==_):[...s.dailyPatterns,_]};i(I),b(I,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.dailyPatterns.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.dailyPatterns.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.dailyPatterns.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===6&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🛡️"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:A.map(_=>d.jsx("button",{onClick:()=>{const I={...s,copingStrategies:s.copingStrategies.includes(_)?s.copingStrategies.filter(k=>k!==_):[...s.copingStrategies,_]};i(I),b(I,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.copingStrategies.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.copingStrategies.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.copingStrategies.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===7&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🚬"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.vapePodsPerWeek,onChange:_=>{const I={...s,vapePodsPerWeek:parseFloat(_.target.value)||0};i(I),I.vapePodsPerWeek>0&&b(I,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select pods per week"}),d.jsx("option",{value:"0.5",children:"0.5 pods"}),d.jsx("option",{value:"1",children:"1 pod"}),d.jsx("option",{value:"2",children:"2 pods"}),d.jsx("option",{value:"3",children:"3 pods"}),d.jsx("option",{value:"4",children:"4 pods"}),d.jsx("option",{value:"5",children:"5 pods"}),d.jsx("option",{value:"6",children:"6 pods"}),d.jsx("option",{value:"7",children:"7 pods"}),d.jsx("option",{value:"8",children:"8+ pods"})]})})]}),t===8&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"⚡"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.nicotineStrength,onChange:_=>{const I={...s,nicotineStrength:_.target.value};i(I),I.nicotineStrength&&b(I,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select nicotine strength"}),d.jsx("option",{value:"3mg",children:"3mg"}),d.jsx("option",{value:"6mg",children:"6mg"}),d.jsx("option",{value:"12mg",children:"12mg"}),d.jsx("option",{value:"18mg",children:"18mg"}),d.jsx("option",{value:"20mg",children:"20mg"}),d.jsx("option",{value:"50mg",children:"50mg"})]})})]}),t===9&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📚"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.quitAttempts,onChange:_=>{const I={...s,quitAttempts:_.target.value};i(I),I.quitAttempts&&b(I,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select option"}),d.jsx("option",{value:"first",children:"This is my first attempt"}),d.jsx("option",{value:"1",children:"Once before"}),d.jsx("option",{value:"2",children:"Twice before"}),d.jsx("option",{value:"3",children:"3-5 times"}),d.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),t===10&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),d.jsx("input",{type:"range",min:"1",max:"10",value:s.confidence,onChange:_=>{const I={...s,confidence:parseInt(_.target.value)};i(I),b(I,10)},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${Af(s.confidence)} 0%, ${Af(s.confidence)} ${s.confidence/10*100}%, #475569 ${s.confidence/10*100}%, #475569 100%)`},autoComplete:"off"}),d.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),d.jsxs("div",{className:"text-center mt-4",children:[d.jsx("span",{className:"font-bold text-4xl",style:{color:Af(s.confidence)},children:s.confidence}),d.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),d.jsx("div",{className:"text-center mt-2",children:d.jsx("span",{className:"text-sm font-medium",style:{color:Af(s.confidence)},children:s.confidence<=3?"You can do this! 💪":s.confidence<=6?"Good confidence! 🎯":s.confidence<=9?"Great confidence! 🚀":"Excellent confidence! 🌟"})})]})]}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:T,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),d.jsxs("button",{onClick:P,disabled:!v(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${v()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[t===10?"Start Journey":"Next",d.jsx(iq,{className:"w-4 h-4"})]})]})]})})},Nb={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:eh},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:qD},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:jD},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:FD}},gq={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},Pb={WEEK_WARRIOR:{name:"Week Warrior",icon:VD,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:BD,description:"30 days clean"},LEGEND:{name:"Legend",icon:$D,description:"90 days clean"}},pq=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",mq=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Your body's dependence level - decreases with clean time, increases with relapses",impacts:["What decreases it:","• Clean time: -2 points per week","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),d.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),d.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>d.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[d.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300",children:"Got it"})]})}):null},Cf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return d.jsxs("div",{className:"mb-1 sm:mb-2",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&d.jsx("button",{onClick:()=>i(s),className:"w-3 h-3 sm:w-4 sm:h-4 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold transition-colors",title:`Learn about ${n}`,children:"i"})]}),d.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),d.jsx("div",{className:"w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:d.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},Db=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=V.useState(!1),[a,l]=V.useState(null),[u,h]=V.useState([]),[f,g]=V.useState({});if(V.useEffect(()=>{let P=!1;return(async()=>{try{if(console.log("🔄 TradingCard: Loading Special Features for user:",n==null?void 0:n.heroName,"uid:",n==null?void 0:n.uid),console.log("🔄 TradingCard: User has specialFeatures:",!!(n!=null&&n.specialFeatures)),console.log("🔄 TradingCard: User has triggers:",n==null?void 0:n.triggers),console.log("🔄 TradingCard: User has dailyPatterns:",n==null?void 0:n.dailyPatterns),console.log("🔄 TradingCard: User has copingStrategies:",n==null?void 0:n.copingStrategies),n&&n.uid)if(n.specialFeatures)console.log("✅ TradingCard: Using pre-loaded Special Features"),P||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),g({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),g(n.specialFeatures.categories||{})):(h([]),g({})));else{console.log("🔄 TradingCard: Generating new Special Features");const v=await N(n);console.log("✅ TradingCard: Generated features:",v),P||(Array.isArray(v)?(h(v),g({})):v&&v.features?(h(v.features),g(v.categories||{})):(h([]),g({})))}else console.log("⚠️ TradingCard: No user or uid, setting empty features"),P||(h([]),g({}))}catch(v){console.error("❌ TradingCard: Error loading Special Features:",v),P||(h([]),g({}))}})(),()=>{P=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),d.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),d.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const y=Nb[n.archetype];if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(Nb)),d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),d.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const w=gq[pq(n.stats.streakDays)],C=y.icon;async function N(P){if(P!=null&&P.isRealBuddy){console.log("🔄 TradingCard: Loading centralized Special Features for buddy:",P.heroName);try{const{ref:S,get:K}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),vt=S(H,`users/${P.uid}/stats`),Ve=await K(vt);if(Ve.exists()){const pe=Ve.val();if(pe.specialFeatures&&Array.isArray(pe.specialFeatures))return console.log("✅ TradingCard: Using centralized Special Features for buddy:",pe.specialFeatures),pe.specialFeatures}const ln=S(H,`users/${P.uid}/specialFeatures`),te=await K(ln);if(te.exists()){const pe=te.val();return console.log("✅ TradingCard: Using legacy Special Features for buddy:",pe),pe}}catch(S){console.warn("⚠️ TradingCard: Could not load centralized Special Features for buddy:",S.message)}return console.log("🔄 TradingCard: Generating placeholder features for buddy:",P.heroName),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let T=null;if(P.uid)try{const{ref:S,get:K}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),vt=S(H,`users/${P.uid}/specialFeatures`),Ve=await K(vt);Ve.exists()&&(T=Ve.val())}catch(S){console.error("Error fetching special features from Firebase:",S)}if(!T){const S=`specialFeatures_${P.heroName||P.id||"default"}`,K=localStorage.getItem(S);K&&(T=JSON.parse(K))}if(T){if(Array.isArray(T))return T;if(T&&T.features)return T}const v=[],b={};for(P.triggers&&P.triggers.length>0&&P.triggers.forEach(S=>{let K="";switch(S){case"Stress/anxiety":K="Stress Vaper";break;case"Social situations":K="Social Vaper";break;case"Boredom":K="Boredom Fighter";break;case"After meals":K="Habit Former";break;case"Drinking alcohol":K="Party Animal";break;case"Work breaks":K="Work Breaker";break;case"Driving":K="Driving Vaper";break;default:K="Trigger Aware"}K&&!v.includes(K)&&(v.push(K),b[K]="triggers")}),P.dailyPatterns&&P.dailyPatterns.length>0&&P.dailyPatterns.forEach(S=>{let K="";switch(S){case"Morning routine":K="Morning Struggler";break;case"Evening wind-down":K="Night Owl";break;case"Throughout the day":K="All-Day Warrior";break;default:K="Routine Builder"}K&&!v.includes(K)&&(v.push(K),b[K]="dailyPatterns")}),P.copingStrategies&&P.copingStrategies.length>0&&(P.copingStrategies.includes("Nothing - this is new to me")?(v.push("First Timer"),b["First Timer"]="copingStrategies"):P.copingStrategies.length>2?(v.push("Veteran Quitter"),b["Veteran Quitter"]="copingStrategies"):(v.push("Cold Turkey"),b["Cold Turkey"]="copingStrategies"));v.length<4;){const S=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],K=S[Math.floor(Math.random()*S.length)];v.includes(K.name)||(v.push(K.name),b[K.name]=K.category)}const _=v.slice(0,4),I={};_.forEach(S=>{I[S]=b[S]||"copingStrategies"});const k={features:_,categories:I};if(P.uid)try{const{ref:S,set:K}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),vt=S(H,`users/${P.uid}/specialFeatures`);await K(vt,k),console.log("Special features with categories saved to Firebase successfully")}catch(S){console.error("Error saving special features to Firebase:",S);const K=`specialFeatures_${P.heroName||P.id||"default"}`;localStorage.setItem(K,JSON.stringify(k))}else{const S=`specialFeatures_${P.heroName||P.id||"default"}`;localStorage.setItem(S,JSON.stringify(_))}return _}const A=n.stats.addictionLevel||50,x=n.stats.mentalStrength||50,R=n.stats.motivation||50,D=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const U=P=>{l(P),o(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`relative w-72 sm:w-80 h-[480px] sm:h-[520px] rounded-xl ${w.color} border-4 ${w.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 transform transition-all duration-300 hover:scale-105 mx-auto overflow-hidden`,children:[d.jsxs("div",{className:"text-center mb-3",children:[d.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),d.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:y.name})]}),d.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):d.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:d.jsx(C,{className:"w-12 h-12 text-white"})})}),d.jsxs("div",{className:"space-y-1 sm:space-y-2 mb-3 sm:mb-4",children:[d.jsx(Cf,{label:"Addiction",value:A,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:U}),d.jsx(Cf,{label:"Mental Strength",value:x,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:U}),d.jsx(Cf,{label:"Motivation",value:R,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:U}),d.jsx(Cf,{label:"Trigger Defense",value:D,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:U})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),d.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((P,T)=>{const v=f[P]||"copingStrategies",b=_=>{switch(_){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return d.jsx("div",{className:`px-2 py-1 ${b(v)} text-white text-xs rounded-full font-medium`,title:`${P} (${v})`,children:P},T)})})]}),d.jsxs("div",{className:"bg-black/30 rounded-lg p-2 sm:p-3 space-y-1 sm:space-y-2 mb-2 sm:mb-3 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Streak:"}),d.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const P=n.stats.streakDays;return`${P} day${P===1?"":"s"}`})(),n.stats.streakDays>0&&d.jsx("span",{className:"text-xs",children:"🔥"})]})]}),d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),d.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[(()=>n.stats.cravingsResisted||0)(),d.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&d.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((P,T)=>{var b,_;const v=((b=Pb[P])==null?void 0:b.icon)||$D;return d.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(_=Pb[P])==null?void 0:_.description,children:d.jsx(v,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},T)}),n.achievements.length>4&&d.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),d.jsx(mq,{isOpen:i,onClose:()=>o(!1),statType:a})]})},yq=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:aq},{id:"craving-support",label:"Craving Support",icon:eh},{id:"profile",label:"Profile",icon:zD},{id:"settings",label:"Explore",icon:UD}];return d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:d.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return d.jsxs("button",{onClick:()=>e(o.id),className:`flex flex-col items-center transition-colors ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[d.jsx(a,{className:"w-5 h-5"}),d.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},_q=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:l,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),d.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),d.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[h,f]=V.useState(!1),[g,y]=V.useState(null),[w,C]=V.useState(null);V.useEffect(()=>{const L=()=>{const B=document.querySelector(".battle-cards-container");B&&(window.innerWidth<1024?(B.style.flexDirection="column",B.style.gap="1rem"):(B.style.flexDirection="row",B.style.gap="3rem"))};return L(),window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]),V.useEffect(()=>{w&&n&&(async()=>{if(w&&n)try{console.log("🔄 App: Refreshing stats on page load for user:",n.uid),await w.refreshAllStats(),console.log("✅ App: Stats refreshed on page load")}catch(B){console.error("❌ App: Error refreshing stats on page load:",B)}})()},[w,n]);const N=async()=>{g&&await g.handleAchievementShare()},A=async L=>{if((L==null?void 0:L.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!L.quitDate||new Date(L.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),L.lastRelapseDate){const Y=new Date(L.lastRelapseDate),X=new Date("2025-09-18T13:56:46.584Z");L.quitDate=Y>X?L.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 3 quit date set to ${L.quitDate} (considering relapse: ${L.lastRelapseDate})`)}else L.quitDate="2025-09-18T13:56:46.584Z";if((L==null?void 0:L.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!L.quitDate||new Date(L.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),L.lastRelapseDate){const Y=new Date(L.lastRelapseDate),X=new Date("2025-09-18T13:56:46.584Z");L.quitDate=Y>X?L.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 2 quit date set to ${L.quitDate} (considering relapse: ${L.lastRelapseDate})`)}else L.quitDate="2025-09-18T13:56:46.584Z";let B={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(L!=null&&L.isRealBuddy){if(L.stats&&Object.assign(B,L.stats),L.quitDate){const Y=new Date(L.quitDate),X=ks(Y);B.streakDays=X.value,B.streakUnit=X.unit,B.streakDisplayText=X.displayText}try{const{ref:Y,get:X}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),he=Y(H,`users/${L.uid}/cravings`),Ae=await X(he);let ye=0;Ae.exists()&&(Ae.forEach(Le=>{Le.val().outcome==="resisted"&&ye++}),B.cravingsResisted=ye,console.log("🔄 Arena: Got buddy cravings resisted:",ye))}catch{console.log("⚠️ Arena: Could not read buddy cravings, using default"),B.cravingsResisted=0}return B}if(!(L!=null&&L.uid)){const Y=localStorage.getItem("quitCoachRelapseDate");if(Y){const Ae=new Date(Y),Le=new Date().getTime()-Ae.getTime(),Ie=Math.floor(Le/(1e3*3600*24));B.streakDays=Ie,B.streakUnit="days",B.streakDisplayText=`${Ie} day${Ie===1?"":"s"}`}else{const Ae=L.quitDate?new Date(L.quitDate):new Date,ye=ks(Ae);B.streakDays=ye.value,B.streakUnit=ye.unit,B.streakDisplayText=ye.displayText}const X=parseInt(localStorage.getItem("cravingWins")||0);B.cravingsResisted=X,new Date().toDateString();let he=0;for(let Ae=0;Ae<7;Ae++){const ye=new Date;ye.setDate(ye.getDate()-Ae);const Le=ye.toDateString(),Ie=localStorage.getItem(`water_${L.uid}_${Le}`);if(Ie&&parseInt(Ie)>0)he++;else break}return he>=3&&(B.mentalStrength=Math.min(80,(B.mentalStrength||50)+1)),B}try{const{ref:Y,get:X}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),he=Y(H,`users/${L.uid}/cravings`);try{const re=await X(he);let ne=0,le=0;if(re.exists()){const z=re.val();re.forEach(Se=>{const Me=Se.val();Me.outcome==="resisted"?ne++:Me.outcome==="relapsed"&&le++})}B.cravingsResisted=ne;const _e=Y(H,`users/${L.uid}/profile/cravingsResisted`),ge=await X(_e);if(ge.exists()){const z=ge.val();console.log(`🔍 Arena: Profile cravingsResisted field value: ${z}`),B.cravingsResisted=Math.max(ne,z)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const ne=Y(H,`users/${L.uid}/profile/cravingsResisted`),le=await X(ne);B.cravingsResisted=le.exists()?le.val():0}let Ae=0;const ye=Y(H,`users/${L.uid}/profile/relapseDate`),Le=await X(ye);if(Le.exists()){const re=Le.val(),ne=new Date(re),_e=new Date().getTime()-ne.getTime();Ae=Math.floor(_e/(1e3*3600*24))}else{const re=L.quitDate?new Date(L.quitDate):new Date,ne=ks(re);Ae=ne.value,B.streakUnit=ne.unit,B.streakDisplayText=ne.displayText,console.log(`🔍 Arena: Calculated streak from quit date: ${ne.displayText} (quit: ${re.toISOString()})`),console.log(`🔍 Arena: Setting streak fields - streakDays: ${Ae}, streakUnit: ${B.streakUnit}, streakDisplayText: ${B.streakDisplayText}`)}B.streakDays=Ae;let Ie=0;for(let re=0;re<7;re++){const ne=new Date;ne.setDate(ne.getDate()-re);const le=ne.toDateString(),_e=Y(H,`users/${L.uid}/profile/daily/${le}/water`),ge=await X(_e);if(ge.exists()&&ge.val()>0)Ie++;else break}Ie>=3&&(B.mentalStrength=Math.min(80,(B.mentalStrength||50)+1))}catch(Y){console.error("Error fetching profile data from Firebase:",Y);const X=localStorage.getItem("quitCoachRelapseDate");if(X){const ye=new Date(X),Ie=new Date().getTime()-ye.getTime(),re=Math.floor(Ie/(1e3*3600*24));B.streakDays=re,B.streakUnit="days",B.streakDisplayText=`${re} day${re===1?"":"s"}`}else{const ye=L.quitDate?new Date(L.quitDate):new Date,Le=ks(ye);B.streakDays=Le.value,B.streakUnit=Le.unit,B.streakDisplayText=Le.displayText}const he=parseInt(localStorage.getItem("cravingWins")||0);B.cravingsResisted=he,new Date().toDateString();let Ae=0;for(let ye=0;ye<7;ye++){const Le=new Date;Le.setDate(Le.getDate()-ye);const Ie=Le.toDateString(),re=localStorage.getItem(`water_${L.uid}_${Ie}`);if(re&&parseInt(re)>0)Ae++;else break}Ae>=3&&(B.mentalStrength=Math.min(80,(B.mentalStrength||50)+1))}if(L!=null&&L.uid&&!(L!=null&&L.isRealBuddy))try{const{ref:Y,get:X}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),he=Date.now();await new Promise(ye=>setTimeout(ye,800));const Ae=await X(Y(H,`users/${L.uid}/stats`));if(Ae.exists()){const ye=Ae.val();Object.assign(B,ye)}else Object.assign(B,L.stats),console.log("🔄 Arena: Using user.stats as fallback:",B);if(g){await g.updateAddictionFromCleanTime();const ye=await X(Y(H,`users/${L.uid}/stats`));if(ye.exists()){const Le=ye.val();if(Object.assign(B,Le),L.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||L.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(`🔄 Arena: Using Firebase stats directly for ${L.uid} - no client-side calculation`),B}}}catch(Y){console.error("Error reading/updating stats from Firebase:",Y),Object.assign(B,L.stats)}return B},[x,R]=V.useState(()=>{const L={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{...L,...n.stats}:L}),[D,U]=V.useState(()=>{const L={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return console.log("🔄 Arena: Initializing realTimeNemesisStats with default stats:",L),L});V.useEffect(()=>{e&&Object.keys(e).length>0&&(console.log("🔄 Arena: Syncing realTimeUserStats with userStats:",e),R(e))},[e]);const[P,T]=V.useState({streakDisplayText:null,streakDays:0,streakUnit:"hours"});V.useEffect(()=>{if(!(n!=null&&n.uid))return;let L=!0;return(async()=>{await(async()=>{if(L)try{const he=new Fm(H,n.uid);await he.initialize(),L&&y(he)}catch(he){console.error("Error initializing StatManager:",he)}})(),await(async()=>{if(L){if(n&&L){const he=await A(n);L&&R(he)}t&&t.uid&&L&&console.log(`🔄 Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{L=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),V.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(`🚫 Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let L=!0;console.log("🔄 Arena: Setting up real-time listener for buddy stats:",t.heroName);const Y=(async()=>{try{const{ref:X,onValue:he}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Ae=X(H,`users/${t.uid}/stats`),ye=he(Ae,re=>{if(L&&re.exists()){const ne=re.val();if(console.log("🔄 Arena: Buddy stats updated in real-time:",ne),console.log("🔍 Arena: Buddy streak display info - streakDays:",ne.streakDays,"streakUnit:",ne.streakUnit,"streakDisplayText:",ne.streakDisplayText),ne.streakDisplayText&&ne.streakUnit){const le={streakDays:ne.streakDays||0,streakUnit:ne.streakUnit,streakDisplayText:ne.streakDisplayText};T(le),console.log("🔍 Arena: Using centralized stats streak:",le.streakDisplayText)}else{let le=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(le){const _e=ks(new Date(le)),ge={streakDays:_e.value,streakUnit:_e.unit,streakDisplayText:_e.displayText};T(ge),ne.streakDays=_e.value,ne.streakUnit=_e.unit,ne.streakDisplayText=_e.displayText,console.log("🔄 Arena: Calculated buddy streak from timestamps (no centralized):",_e.displayText)}else ne.streakUnit="hours",ne.streakDisplayText="0 hours"}U(le=>(console.log("🔄 Arena: Updating buddy stats with calculated streak:",ne.streakDisplayText),{...le,...ne}))}},re=>{re.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",re)}),Le=X(H,`users/${t.uid}/profile`),Ie=he(Le,async re=>{if(L&&re.exists()){const ne=re.val();console.log("🔄 Arena: Buddy profile updated, recalculating stats..."),console.log("🔄 Arena: Preserving pre-loaded buddy stats during profile update...");const le=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(le==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||le==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Profile change for centralized buddy ${le} - keeping centralized stats intact`);else if(D&&D.addictionLevel!==50){let _e={...D};if(ne.quitDate&&ne.quitDate!==t.quitDate){const ge=new Date(ne.quitDate),z=ks(ge);_e.streakDays=z.value,_e.streakUnit=z.unit,_e.streakDisplayText=z.displayText,console.log("🔄 Arena: Updated buddy streak from profile change:",z.displayText)}else if(ne.lastRelapseDate||ne.relapseDate){const ge=new Date(ne.lastRelapseDate||ne.relapseDate),z=ks(ge);_e.streakDays=z.value,_e.streakUnit=z.unit,_e.streakDisplayText=z.displayText,T({streakDays:z.value,streakUnit:z.unit,streakDisplayText:z.displayText}),console.log("🔄 Arena: Updated buddy streak from last relapse date:",z.displayText)}else if(t!=null&&t.finalQuitDate||a!=null&&a.finalQuitDate){const ge=new Date((t==null?void 0:t.finalQuitDate)||(a==null?void 0:a.finalQuitDate)),z=ks(ge);_e.streakDays=z.value,_e.streakUnit=z.unit,_e.streakDisplayText=z.displayText,T({streakDays:z.value,streakUnit:z.unit,streakDisplayText:z.displayText}),console.log("🔄 Arena: Updated buddy streak from finalQuitDate fallback:",z.displayText)}console.log("🔄 Arena: Preserved real buddy stats during profile update:",_e),U(ge=>(console.log("🔄 Arena: Preserving locally calculated streak during profile update:",P),{...ge,..._e,...P}))}else console.log("🔄 Arena: Skipping profile update - waiting for real stats to load first")}},re=>{re.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",re)});return()=>{ye(),Ie()}}catch(X){console.error("Error setting up buddy stats listeners:",X)}})();return()=>{L=!1,Y.then(X=>{X&&typeof X=="function"&&X()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]),V.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;const L=setInterval(()=>{const B=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(!B)return;const Y=ks(new Date(B));T({streakDays:Y.value,streakUnit:Y.unit,streakDisplayText:Y.displayText}),U(X=>({...X,streakDays:Y.value,streakUnit:Y.unit,streakDisplayText:Y.displayText}))},60*1e3);return()=>clearInterval(L)},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.lastRelapseDate,a==null?void 0:a.originalQuitDate,a==null?void 0:a.lastActivity]);const v=async()=>{if(n){const L=await A(n);R(L)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const L=await A(t);U(B=>(console.log("🔄 Arena: Preserving locally calculated streak during stats calculation:",P),{...B,...L,...P}))}};V.useEffect(()=>{if(!(n!=null&&n.uid))return;const L=setInterval(v,3e4);return()=>clearInterval(L)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),V.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||v())},[t==null?void 0:t.uid]),V.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||v())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),V.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log("🔄 Arena: Loading buddy data for user:",n.uid),l(A,U,T))},[n==null?void 0:n.uid,a,i,u,T]),V.useEffect(()=>{const L=()=>{console.log("🌐 Internet connection restored")},B=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",L),window.addEventListener("offline",B),()=>{window.removeEventListener("online",L),window.removeEventListener("offline",B)}},[]);const b=L=>{if(!L||!L.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const B=L.stats.mentalStrength||50,Y=L.stats.motivation||50,X=L.stats.triggerDefense||30,he=L.stats.addictionLevel||50;return B*1.5+Y*1+X*1.2-he*1},_=b({...n,stats:x}),I=b({...t,stats:D}),k=typeof _=="number"&&!isNaN(_)?_:0,S=typeof I=="number"&&!isNaN(I)?I:0,K=k>S?"WINNING":k===S?"TIED":"LOSING",vt=()=>{if(K==="WINNING")return null;if(!x||!D)return console.warn("Stats not available for recommendations calculation"),[];const L=S-k+1,B=[],Y=(x==null?void 0:x.mentalStrength)||50,X=(x==null?void 0:x.motivation)||50,he=(x==null?void 0:x.triggerDefense)||30,Ae=(x==null?void 0:x.addictionLevel)||50,ye=(D==null?void 0:D.mentalStrength)||50,Le=(D==null?void 0:D.motivation)||50;D!=null&&D.triggerDefense;const Ie=(D==null?void 0:D.addictionLevel)||50,re=ye-Y,ne=Le-X,le=Ae-Ie,_e=[{name:"Mental Strength",multiplier:1.5,gap:re,current:Y,max:100},{name:"Trigger Defense",multiplier:1.2,gap:ne,current:he,max:100},{name:"Motivation",multiplier:1,gap:ne,current:X,max:100},{name:"Addiction",multiplier:1,gap:le,current:Ae,min:0,isReduction:!0}];if(_e.sort((ge,z)=>ge.multiplier!==z.multiplier?z.multiplier-ge.multiplier:Math.abs(z.gap)-Math.abs(ge.gap)),_e.forEach(ge=>{if(ge.isReduction){const z=Math.min(ge.current-ge.min,50),Se=z*ge.multiplier;Se>0&&B.push({stat:ge.name,change:z,action:Ve(z),priority:Se,canWin:Se>=L,isReduction:!0,efficiency:ge.multiplier,gap:ge.gap})}else{const z=Math.min(ge.max-ge.current,50),Se=z*ge.multiplier;Se>0&&B.push({stat:ge.name,change:z,action:ln(ge.name,z),priority:Se,canWin:Se>=L,efficiency:ge.multiplier,gap:ge.gap})}}),B.sort((ge,z)=>z.priority-ge.priority),B.length>0&&!B.some(ge=>ge.canWin)){const ge=te(B,L);ge&&B.unshift(ge)}return B.slice(0,3)},Ve=L=>L>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":L>=20?"Reduce nicotine intake significantly, avoid high-risk situations":L>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",ln=(L,B)=>{switch(L){case"Mental Strength":return B>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":B>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return B>=30?"Log progress daily, share achievements weekly":B>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return B>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":B>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},te=(L,B)=>{let Y=0;const X=[];for(const he of L){if(Y>=B)break;const Ae=B-Y,ye=Math.min(he.priority,Ae);ye>0&&(X.push({stat:he.stat,change:Math.ceil(ye/he.efficiency),contribution:ye}),Y+=ye)}return X.length>0?{stat:"Combination Strategy",change:Math.ceil(B),action:`Focus on: ${X.map(he=>`${he.stat} (+${he.change})`).join(", ")}`,priority:Y,canWin:Y>=B,isCombination:!0,strategy:X}:null},pe=vt()||[];return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:[d.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4",children:[d.jsxs("div",{className:`inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 rounded-full font-bold text-sm sm:text-lg shadow-xl ${K==="WINNING"?"bg-green-600":K==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[K==="WINNING"?d.jsx(BD,{className:"w-5 h-5 mr-2"}):K==="TIED"?d.jsx(eh,{className:"w-5 h-5 mr-2"}):d.jsx("span",{className:"mr-2",children:"📉"}),"You are ",K]}),d.jsx("button",{onClick:()=>f(!0),className:"w-8 h-8 sm:w-10 sm:h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Battle Algorithm Info",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"i"})}),d.jsx("button",{onClick:v,className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Refresh Stats",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"🔄"})}),d.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 p-2 rounded",children:[d.jsxs("div",{children:["User Stats: ",JSON.stringify(x)]}),d.jsxs("div",{children:["Base Stats: ",JSON.stringify(n==null?void 0:n.stats)]})]}),d.jsx("button",{onClick:v,className:"mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"🔄 Refresh Stats"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy matching test triggered...");try{await autoMatchUsers(),console.log("✅ Manual buddy matching completed")}catch(L){console.error("❌ Manual buddy matching failed:",L)}},className:"mt-2 ml-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors",children:"🔗 Test Matching"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy reload test triggered...");try{setBuddyLoadAttempted(!1),setRealBuddy(null),await l(A,U,T),console.log("✅ Manual buddy reload completed")}catch(L){console.error("❌ Manual buddy reload failed:",L)}},className:"mt-2 ml-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:"👥 Reload Buddy"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Resetting matching system...");try{const L=firestoreBuddyServiceRef.current||firestoreBuddyService;if(L){const{getDocs:B,deleteDoc:Y,doc:X}=await Ce(()=>import("./index.esm-2ad60163.js"),[]),Ae=(await B(L.buddyPairsCollection)).docs.map(le=>Y(X(oi,"buddyPairs",le.id)));await Promise.all(Ae);const Le=(await B(L.matchingPoolCollection)).docs.map(le=>Y(X(oi,"matchingPool",le.id)));await Promise.all(Le);const{ref:Ie,remove:re}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),ne=["5uSH8SA6y4eZ7jkoLEZCRJZmTGW2","KB67Yg17rkZmCa8UV1N5xIUWoK12","o4mW4BmLWOOVBybTrYcvGJ4nimA3"];for(const le of ne)try{await re(Ie(H,`users/${le}/buddyInfo`))}catch{console.log("Could not remove buddy info for:",le)}console.log("✅ Matching system reset completed"),setRealBuddy(null),setBuddyLoadAttempted(!1)}}catch(L){console.error("❌ Reset failed:",L)}},className:"mt-2 ml-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"🔄 Reset Matching"})]})}),d.jsxs("div",{className:"battle-cards-container flex flex-col lg:flex-row items-center justify-center gap-4 lg:gap-12 mb-8 w-full",children:[d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!n||!x)return console.log("🎯 TradingCard: Missing data, not rendering user card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading User..."})});const L=e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,...x};return console.log(`🎯 TradingCard: Using ${e&&Object.keys(e).length>0?"centralized":"calculated"} stats for ${n.uid}`),console.log("🎯 TradingCard: Final stats:",{streak:L.streakDisplayText,addiction:L.addictionLevel}),d.jsx(Db,{user:{...n,stats:L},showComparison:!1,nemesisUser:t})})()}),d.jsxs("div",{className:"vs-section flex flex-row lg:flex-col items-center justify-center space-x-4 lg:space-x-0 space-y-0 lg:space-y-4 flex-shrink-0",children:[d.jsx("div",{className:"vs-icon w-16 h-16 lg:w-24 lg:h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:d.jsx(cq,{className:"w-8 h-8 lg:w-12 lg:h-12 text-white"})}),d.jsx("div",{className:"bg-red-600 px-4 py-2 lg:px-8 lg:py-3 rounded-full",children:d.jsx("p",{className:"vs-text text-white font-bold text-lg lg:text-2xl",children:"VS"})})]}),d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{var B;if(!t||!D)return console.log("🎯 TradingCard: Missing data, not rendering nemesis card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Nemesis..."})});const L={...t,stats:{...t.stats,...D}};return P.streakDisplayText&&(L.stats.streakDisplayText=P.streakDisplayText,L.stats.streakDays=P.streakDays,L.stats.streakUnit=P.streakUnit),console.log("🎯 TradingCard: Buddy streak debug:",{realTimeNemesisStats:D,mergedNemesisStats:L.stats,buddyStreak:(B=L.stats)==null?void 0:B.streakDisplayText,preservedBuddyStreak:P}),d.jsx(Db,{user:L,isNemesis:!0,showComparison:!1,nemesisUser:n})})()})]}),K==="LOSING"&&pe&&pe.length>0&&d.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-4 sm:p-6 border border-slate-700",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),d.jsx("div",{className:"space-y-4",children:pe.slice(0,3).map((L,B)=>d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3 sm:p-4 border-l-4 border-blue-500",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:L.isReduction?d.jsxs(d.Fragment,{children:["🎯 Reduce your ",L.stat," by ",L.change," points!"]}):L.isCombination?d.jsxs(d.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",L.change," total points!"]}):L.isMajor?d.jsxs(d.Fragment,{children:["🎯 Major improvement needed: ",L.change," total points!"]}):d.jsxs(d.Fragment,{children:["🎯 Increase your ",L.stat," by ",L.change," points!"]})}),d.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",L.action]})]}),d.jsxs("div",{className:`font-bold text-xl sm:text-2xl sm:ml-4 ${L.isReduction?"text-green-400":L.isCombination?"text-purple-400":L.isMajor?"text-orange-400":"text-blue-400"}`,children:[L.isReduction?"-":"+",L.change]})]})},B))}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-md w-full border border-slate-600",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm transition-colors",title:"Share achievement for Motivation bonus",children:"📤 Share"}),d.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-white text-2xl",children:"×"})]})]}),d.jsxs("div",{className:"space-y-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),d.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),d.jsxs("p",{className:"text-green-400 font-mono",children:["(",x.mentalStrength||50," × 1.5) + (",x.motivation||50," × 1.0) + (",x.triggerDefense||30," × 1.2) - (",x.addictionLevel||50," × 1.0) = ",_.toFixed(1)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),d.jsxs("p",{className:"text-red-400 font-mono",children:["(",D.mentalStrength||50," × 1.5) + (",D.motivation||50," × 1.0) + (",D.triggerDefense||30," × 1.2) - (",D.addictionLevel||50," × 1.0) = ",I.toFixed(1)]})]}),d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:d.jsxs("p",{className:"text-gray-300 text-xs",children:[d.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",d.jsx("br",{}),d.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",d.jsx("br",{}),d.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",d.jsx("br",{}),d.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})},vq=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full border border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-3xl",children:i()})}),d.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),d.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),d.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})},wq=({gameType:n,onClose:e})=>{V.useState(0);const t=()=>{const s=V.useRef(null),[i,o]=V.useState([{x:12,y:12}]),[a,l]=V.useState({x:1,y:0}),[u,h]=V.useState({x:1,y:0}),[f,g]=V.useState({x:15,y:15}),[y,w]=V.useState(!1),[C,N]=V.useState(0),[A,x]=V.useState(1),R={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},D={1:5,2:5,3:10};return V.useEffect(()=>{const U=P=>{if(y){P.preventDefault(),o([{x:12,y:12}]),l({x:1,y:0}),h({x:1,y:0}),g({x:15,y:15}),w(!1),N(0),x(1);return}switch(P.key){case"ArrowUp":P.preventDefault(),a.y!==1&&h({x:0,y:-1});break;case"ArrowDown":P.preventDefault(),a.y!==-1&&h({x:0,y:1});break;case"ArrowLeft":P.preventDefault(),a.x!==1&&h({x:-1,y:0});break;case"ArrowRight":P.preventDefault(),a.x!==-1&&h({x:1,y:0});break}};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[a,y]),V.useEffect(()=>{if(y)return;const U=setInterval(()=>{o(P=>{const T={x:P[0].x+a.x,y:P[0].y+a.y};if(T.x<0&&(T.x=24),T.x>=25&&(T.x=0),T.y<0&&(T.y=24),T.y>=25&&(T.y=0),P.slice(0,-1).some(I=>I.x===T.x&&I.y===T.y))return w(!0),P;const b=T.x===f.x&&T.y===f.y;let _;return b?(N(I=>I+D[A]),g({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),_=[T,...P]):_=[T,...P.slice(0,-1)],(u.x!==a.x||u.y!==a.y)&&setTimeout(()=>{l(u)},0),_})},R[A]);return()=>clearInterval(U)},[a,u,f,y]),V.useEffect(()=>{const U=s.current;if(!U)return;const P=U.getContext("2d"),T=15,v=25;P.fillStyle="#1f2937",P.fillRect(0,0,375,375),P.strokeStyle="#374151",P.lineWidth=1;for(let b=0;b<=v;b++)P.beginPath(),P.moveTo(b*T,0),P.lineTo(b*T,375),P.stroke(),P.beginPath(),P.moveTo(0,b*T),P.lineTo(375,b*T),P.stroke();i.forEach((b,_)=>{_===0?P.fillStyle="#fbbf24":P.fillStyle="#10b981",P.fillRect(b.x*T+1,b.y*T+1,T-2,T-2)}),P.fillStyle="#ef4444",P.fillRect(f.x*T+2,f.y*T+2,T-4,T-4)},[i,f]),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"mb-4",children:d.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[d.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(U=>d.jsxs("button",{onClick:()=>x(U),className:`
                  px-4 py-2 text-sm font-mono border-2 border-green-500 transition-all
                  ${A===U?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[d.jsxs("div",{children:["Level ",U]}),d.jsxs("div",{className:"text-xs mt-1",children:[U===1&&"Normal",U===2&&"Fast",U===3&&"Insane"]})]},U))]})}),d.jsx("canvas",{ref:s,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",C," | Level: ",A]}),y&&d.jsxs("div",{className:"mt-2",children:[d.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),d.jsx("button",{onClick:()=>{o([{x:12,y:12}]),l({x:1,y:0}),h({x:1,y:0}),g({x:15,y:15}),w(!1),N(0),x(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",children:"Restart Game"})]})]})]})},r=()=>{try{return n==="snake"?d.jsx(t,{}):d.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(s){return console.error("Error rendering game:",s),d.jsxs("div",{className:"text-center text-red-600",children:[d.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),d.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm",children:"Reload Game"})]})}};return d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"🐍 Snake Game"}),d.jsx("div",{className:"flex items-center gap-4",children:d.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})})]}),d.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[500px] flex items-center justify-center relative",children:r()})]})})},Iq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,l]=V.useState(!1),[u,h]=V.useState(null),[f,g]=V.useState(!1),[y,w]=V.useState({title:"",message:"",type:"info"}),[C,N]=V.useState(null),[A,x]=V.useState(!1),[R,D]=V.useState(0),[U,P]=V.useState(!1),[T,v]=V.useState(!1),[b,_]=V.useState(1),[I,k]=V.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[S,K]=V.useState({resisted:0,relapses:0}),[vt,Ve]=V.useState(0),[ln,te]=V.useState(!1),[pe,L]=V.useState(""),B=(z,Se,Me="info")=>{console.log("🔄 showQuickActionPopup called:",{title:z,message:Se,type:Me}),w({title:z,message:Se,type:Me}),g(!0),console.log("✅ showQuickActionPopup: Popup data set and showCustomPopup set to true")};x2.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=B),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),V.useEffect(()=>n!=null&&n.uid?(D(0),(async()=>{try{const ve=new Fm(H,n.uid);await ve.initialize(),N(ve)}catch(ve){console.error("Error initializing StatManager:",ve)}})(),(async()=>{try{const ve=new Date().toDateString(),{ref:be,get:qe}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);try{const Ct=be(H,`users/${n.uid}/profile/dailyCravingLogs/${ve}`),gt=await qe(Ct);if(gt.exists()){const St=gt.val();Ve(St.count||0)}else Ve(0)}catch{const gt=`cravingLogs_${n.uid}_${ve}`,St=localStorage.getItem(gt);if(St){const Rt=JSON.parse(St);Ve(Rt.count||0)}else Ve(0)}}catch(ve){console.error("Error loading daily craving logs:",ve),Ve(0)}})(),(async()=>{try{const{ref:ve,get:be,onValue:qe,query:Ct,orderByChild:gt,startAt:St,endAt:Rt,set:Qe}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Ke=new Date,xe=new Date(Ke.getTime()-7*24*60*60*1e3),at=xe.toDateString(),kt=Ke.toDateString();try{const dt=ve(H,`users/${n.uid}/profile/cravingStats`),Kn=await be(dt);if(Kn.exists()){const Un=Kn.val();if(Un.lastUpdated&&new Date(Un.lastUpdated)>xe){K(Un);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:Vt,get:Ft,query:Tn,orderByChild:bn,startAt:jn,endAt:wt}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),xt=Vt(H,`users/${n.uid}/cravings`),qr=Tn(xt,bn("date"),jn(at),wt(kt));try{const dt=await Ft(qr);let Kn=0,Un=0;if(console.log(`🔍 Weekly Stats: Checking cravings for ${at} to ${kt}`),console.log(`🔍 Weekly Stats: Cravings snapshot exists: ${dt.exists()}`),dt.exists()){const As=dt.val();console.log("🔍 Weekly Stats: Raw cravings data:",As),dt.forEach(os=>{const Mi=os.val();console.log("🔍 Weekly Stats: Individual craving:",Mi),Mi.outcome==="resisted"?Kn++:Mi.outcome==="relapsed"&&Un++})}console.log(`🔍 Weekly Stats: Calculated - resisted: ${Kn}, relapses: ${Un}`);const is={resisted:Kn,relapses:Un,lastUpdated:Ke.toISOString()};K(is);try{const As=ve(H,`users/${n.uid}/profile/cravingStats`);await Qe(As,is)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(is))}catch{console.log("Could not query cravings, using localStorage fallback");const Kn=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');K(Kn)}const Wr=ve(H,`users/${n.uid}/profile/cravingStats`);return qe(Wr,dt=>{dt.exists()&&K(dt.val())})}catch(ve){console.error("Error loading weekly stats:",ve);const be=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');K(be)}})(),(async()=>{try{const{ref:ve,get:be,onValue:qe}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Ct=new Date().toDateString(),gt=ve(H,`users/${n.uid}/profile/daily/${Ct}/water`),St=await be(gt);if(St.exists())D(St.val()||0);else{const Qe=parseInt(localStorage.getItem(`water_${n.uid}_${Ct}`)||0);D(Qe)}return qe(gt,Qe=>{Qe.exists()&&D(Qe.val()||0)})}catch(ve){console.error("Error loading daily water from Firebase:",ve);const be=new Date().toDateString(),qe=parseInt(localStorage.getItem(`water_${n.uid}_${be}`)||0);D(qe)}})(),()=>{D(0),x(!1),K({resisted:0,relapses:0}),v(!1),_(1),k({strength:5,mood:"",context:"",outcome:""}),Ve(0),te(!1),L("")}):void 0,[n==null?void 0:n.uid]);const Y=()=>{h("snake"),l(!0)},X=()=>{h(null),l(!1)},he=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const z=Math.min(R+1,6);D(z);const Se=new Date().toDateString();if(C){if(await C.handleHydrationUpdate(z),o)try{const be=await C.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:z,targetGlasses:6,currentStreak:be}),console.log("✅ Hydration also logged to Firestore for analytics")}catch(be){console.warn("⚠️ Could not log hydration to Firestore:",be.message),await handleOfflineBehavioralLog("hydration",{glassesConsumed:z,targetGlasses:6,currentStreak:await C.checkHydrationStreak()})}else await handleOfflineBehavioralLog("hydration",{glassesConsumed:z,targetGlasses:6,currentStreak:await C.checkHydrationStreak()});z===6&&R===5&&await C.checkHydrationStreak()>=3&&(await C.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:Me,set:nt}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),ve=Me(H,`users/${n.uid}/profile/daily/${Se}/water`);await nt(ve,z),localStorage.setItem(`water_${n.uid}_${Se}`,z.toString()),console.log("Water intake updated:",z)}catch(z){console.error("Error updating water intake:",z);const Se=Math.min(R+1,6);D(Se);const Me=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${Me}`,Se.toString())}},Ae=()=>{k({strength:5,mood:"",context:"",outcome:""}),_(1),v(!0)},ye=()=>{b<4&&_(b+1)},Le=()=>{b>1&&_(b-1)},Ie=async z=>{var Se;try{const Me=new Date().toISOString(),nt=new Date().toDateString(),ve=new Date,be={...I,outcome:z,timestamp:Me,date:nt,timeOfDay:ve.getHours()<12?"morning":ve.getHours()<17?"afternoon":"evening",dayOfWeek:ve.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((ve.getDate()+new Date(ve.getFullYear(),0,1).getDay())/7),month:ve.toLocaleDateString("en-US",{month:"long"}),year:ve.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:z==="resisted",relapsed:z==="relapsed",logged:z==="logged",usedPractices:z==="resistance_practices"}},qe=new Date().toDateString(),Ct=vt+1;Ve(Ct);let gt={resisted:S.resisted,relapses:S.relapses,lastUpdated:Me},St=!1;Ct<=2&&C&&(await C.handleCravingLogged(),St=!0);const{ref:Rt,set:Qe,push:Ke,get:xe}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);if(n&&n.uid){try{const wt=Rt(H,`users/${n.uid}/profile/dailyCravingLogs/${qe}`);await Qe(wt,{count:Ct,lastUpdated:Me})}catch{const xt=`cravingLogs_${n.uid}_${qe}`;localStorage.setItem(xt,JSON.stringify({count:Ct,lastUpdated:Me}))}const kt=Rt(H,`users/${n.uid}/cravings`),Vt=Ke(kt);if(await Qe(Vt,be),o)try{await o.logCraving(n.uid,{outcome:"resisted",strength:I.strength,duration:I.duration,context:"detailed_assessment",triggers:I.triggers||[],mood:I.mood,stressLevel:I.stressLevel,copingStrategiesUsed:I.copingStrategies||[],location:I.location,socialSituation:I.socialSituation}),console.log("✅ Craving also logged to Firestore for analytics")}catch(wt){console.warn("⚠️ Could not log craving to Firestore:",wt.message),await handleOfflineBehavioralLog("craving",{outcome:"resisted",strength:I.strength,duration:I.duration,context:"detailed_assessment",triggers:I.triggers||[],mood:I.mood,stressLevel:I.stressLevel,copingStrategiesUsed:I.copingStrategies||[],location:I.location,socialSituation:I.socialSituation})}let Ft=[],Tn=[];try{const wt=Rt(H,`users/${n.uid}/profile/cravingHistory/${qe}`),xt=await xe(wt);Ft=xt.exists()?xt.val():[],Ft.push({id:Vt.key,strength:be.strength,mood:be.mood,context:be.context,outcome:be.outcome,timestamp:be.timestamp,timeOfDay:be.timeOfDay}),await Qe(wt,Ft),console.log(`📅 Daily history updated for ${qe}:`,Ft.length,"records")}catch(wt){console.warn("⚠️ Could not save to daily history:",wt)}const bn=`${ve.getFullYear()}-${String(ve.getMonth()+1).padStart(2,"0")}`;try{const wt=Rt(H,`users/${n.uid}/profile/cravingTrends/${bn}`),xt=await xe(wt);Tn=xt.exists()?xt.val():[],Tn.push({id:Vt.key,date:be.date,strength:be.strength,outcome:be.outcome,timeOfDay:be.timeOfDay}),await Qe(wt,Tn),console.log(`📊 Monthly trends updated for ${bn}:`,Tn.length,"records")}catch(wt){console.warn("⚠️ Could not save to monthly trends:",wt)}const jn=Rt(H,`users/${n.uid}/profile/cravingStats`);if(z==="resisted"){gt.resisted=S.resisted+1;let wt=null,xt=!0;if(window.centralizedStatService){console.log("🔄 Detailed Assessment: Using CentralizedStatService...");const qr=await window.centralizedStatService.getCurrentStats();((qr==null?void 0:qr.mentalStrengthCravingsApplied)||0)>=3&&(xt=!1,console.log("🔄 Detailed Assessment: Daily mental strength limit reached")),await window.centralizedStatService.handleCravingResisted(),console.log("✅ Detailed Assessment: Stats updated via CentralizedStatService")}else C&&(wt=await C.checkDailyCravingResistanceLimits(qe),await C.handleCravingResistance());be.resistanceLimits={...wt,canAwardMentalStrength:xt}}else if(z==="relapsed"){if(gt.relapses=S.relapses+1,C){console.log("🔄 Detailed Craving: Calling StatManager.handleRelapse()...");const wt=await C.handleRelapse();if(console.log("🔄 Detailed Craving: StatManager.handleRelapse() result:",wt),o)try{const xt=await C.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:xt,triggers:I.triggers||[],mood:I.mood,stressLevel:I.stressLevel,location:I.location,socialSituation:I.socialSituation,copingAttempts:I.copingStrategies||[],addictionIncrease:xt===1?4:xt===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Relapse also logged to Firestore for analytics")}catch(xt){console.warn("⚠️ Could not log relapse to Firestore:",xt.message),await handleOfflineBehavioralLog("relapse",{escalationLevel:await C.getCurrentEscalationLevel(),triggers:I.triggers||[],mood:I.mood,stressLevel:I.stressLevel,location:I.location,socialSituation:I.socialSituation,copingAttempts:I.copingStrategies||[],addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}}else console.error("❌ Detailed Craving: StatManager not available!");console.log("🔄 Detailed Craving: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Detailed Craving: Secondary stats refresh..."),refreshStats()},1500)):console.error("❌ Detailed Craving: refreshStats function not available!")}await Qe(jn,gt),K(gt),console.log("📊 Craving assessment saved to database:",{userId:n.uid,cravingId:Vt.key,data:be,databasePaths:{main:`users/${n.uid}/cravings/${Vt.key}`,dailyHistory:`users/${n.uid}/profile/cravingHistory/${qe}`,monthlyTrends:`users/${n.uid}/profile/cravingTrends/${bn}`,weeklyStats:`users/${n.uid}/profile/cravingStats`,dailyLogs:`users/${n.uid}/profile/dailyCravingLogs/${qe}`},summary:{dailyHistoryRecords:(Ft==null?void 0:Ft.length)||0,monthlyTrendsRecords:(Tn==null?void 0:Tn.length)||0,monthKey:bn,today:qe}})}const at=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");if(at.push(be),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(at)),localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(gt)),z==="resisted")if(be.resistanceLimits){const kt=be.resistanceLimits;if(!kt.canAwardMentalStrength&&!kt.canAwardTriggerDefense)w({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"});else if(!kt.canAwardMentalStrength)w({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"});else if(!kt.canAwardTriggerDefense)w({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"});else{const Vt=await((Se=window.centralizedStatService)==null?void 0:Se.getCurrentStats()),Ft=3-(((Vt==null?void 0:Vt.mentalStrengthCravingsApplied)||0)+1);Ft>0?w({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength increased by 1 point (${Ft} more today) and Trigger Defense increased by 3 points!

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}):w({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength increased by 1 point (daily max reached!) and Trigger Defense increased by 3 points!

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"})}}else w({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"});else w(z==="resistance_practices"?{title:"🛡️ Stay Strong!",message:`Stay strong! Use distraction or wellbeing practices to resist.

You earned awareness bonuses for tracking your craving!`,type:"info"}:z==="relapsed"?{title:"💪 Don't Give Up",message:`Relapses happen to everyone. The important thing is that you're here and trying again.

You still earned awareness bonuses for tracking your craving!`,type:"info"}:z==="logged"?St?{title:"📝 Craving Logged",message:`Great job tracking your craving!

You earned awareness bonuses for your self-awareness.

This helps build your Motivation and Trigger Defense.`,type:"info"}:{title:"📝 Daily Limit Reached",message:"Daily craving logging limit reached. Additional logs are recorded but won't award stat points until tomorrow.",type:"info"}:{title:"📝 Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"});g(!0),v(!1),_(1)}catch(Me){console.error("Error saving craving assessment:",Me),w({title:"Progress Recorded",message:`Your progress has been recorded locally.

Keep up the great work!`,type:"info"}),g(!0),v(!1),_(1)}},re=async()=>{try{const z=new Date().toISOString(),Se=new Date().toDateString();let Me=null;const{ref:nt,set:ve,push:be,get:qe}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);if(n&&n.uid){const St=nt(H,`users/${n.uid}/cravings`),Rt=be(St);await ve(Rt,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:z,date:Se});const Qe=nt(H,`users/${n.uid}/profile/cravingStats`),Ke={resisted:S.resisted+1,relapses:S.relapses,lastUpdated:z};if(await ve(Qe,Ke),K(Ke),window.centralizedStatService){console.log("🔄 Quick Resistance: Using CentralizedStatService...");const xe=await window.centralizedStatService.getCurrentStats(),at=(xe==null?void 0:xe.mentalStrengthCravingsApplied)||0;console.log("🔄 Quick Resistance: Current mental strength bonus before processing:",at);const kt=await window.centralizedStatService.handleCravingResisted();if(console.log("✅ Quick Resistance: Stats updated via CentralizedStatService"),kt&&kt.applied){const Vt=(at||0)+1,Ft=Math.max(0,3-Vt);console.log("🔄 Quick Resistance: Bonus applied, remaining:",Ft),Ft>0?B("Craving Resisted! 💪",`Great job! You earned +1 mental strength point. You can still earn ${Ft} more today.`,"success"):B("Craving Resisted! 💪","Excellent! You've reached the daily maximum of 3 mental strength points from craving resistance.","success")}else console.log("🔄 Quick Resistance: Daily limit reached, showing limit message"),B("Daily Mental Strength Limit Reached","You've already earned the maximum 3 mental strength points from craving resistance today. Keep up the great work! Your resistance still counts for your overall progress.","info");return}else C&&(Me=await C.checkDailyCravingResistanceLimits(Se),await C.handleCravingResistance())}const Ct=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Ct.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:z,date:Se}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Ct));const gt={resisted:S.resisted+1,relapses:S.relapses,lastUpdated:z};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(gt)),K(gt),Me?!Me.canAwardMentalStrength&&!Me.canAwardTriggerDefense?w({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):Me.canAwardMentalStrength?Me.canAwardTriggerDefense?w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):w({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):w({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),g(!0)}catch(z){console.error("Error recording quick resistance:",z),w({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),g(!0)}},ne=async()=>{try{const z=new Date().toISOString(),Se=new Date().toDateString();if(n&&n.uid){const{ref:ve,set:be,push:qe}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Ct=ve(H,`users/${n.uid}/cravings`),gt=qe(Ct);if(await be(gt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:z,date:Se}),window.centralizedStatService)console.log("🔄 Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Quick Relapse: Stats updated via CentralizedStatService"),B("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! 💪`,"warning");else if(C){console.log("🔄 Quick Relapse: Calling StatManager.handleRelapse()...");const Qe=await C.handleRelapse();if(console.log("🔄 Quick Relapse: StatManager.handleRelapse() result:",Qe),o)try{const Ke=await C.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:Ke,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:Ke===1?4:Ke===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Quick relapse also logged to Firestore for analytics")}catch(Ke){console.warn("⚠️ Could not log quick relapse to Firestore:",Ke.message),await handleOfflineBehavioralLog("relapse",{escalationLevel:await C.getCurrentEscalationLevel(),triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}try{await new Promise(kt=>setTimeout(kt,100));const{ref:Ke,get:xe}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),at=await xe(Ke(H,`users/${n.uid}/stats`));if(at.exists()){const kt=at.val();console.log("🔍 Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",kt)}else console.log("❌ Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(Ke){console.error("❌ Quick Relapse: VERIFICATION failed:",Ke)}try{const Ke=await C.getCurrentEscalationLevel();let xe=0;switch(Ke){case 1:xe=4;break;case 2:xe=6;break;default:xe=8;break}B("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

📊 Stat Changes:
• Addiction: +${xe} points
• Mental Strength: -3 points
• Trigger Defense: -3 points

Your journey continues! 💪`,"warning")}catch(Ke){console.warn("Could not get escalation level for message:",Ke),B("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! 💪`,"warning")}}else console.error("❌ Quick Relapse: StatManager not available!"),B("⚠️ Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const St=ve(H,`users/${n.uid}/profile/cravingStats`),Rt={resisted:S.resisted,relapses:S.relapses+1,lastUpdated:z};await be(St,Rt),K(Rt),console.log("🔄 Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log("ℹ️ Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)")}const Me=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Me.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:z,date:Se}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Me));const nt={resisted:S.resisted,relapses:S.relapses+1,lastUpdated:z};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(nt)),K(nt)}catch(z){console.error("Error recording quick relapse:",z),B("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! 💪`,"warning")}},le=async(z,Se=30)=>{try{if(!z)return null;const{ref:Me,get:nt,query:ve,orderByChild:be,startAt:qe,endAt:Ct}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),gt=new Date,St=new Date(gt.getTime()-Se*24*60*60*1e3),Rt=Me(H,`users/${z}/cravings`),Qe=await nt(Rt);if(!Qe.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const xe=Object.values(Qe.val()||{}).filter(ct=>{const dt=new Date(ct.timestamp);return dt>=St&&dt<=gt});if(xe.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const at=xe.filter(ct=>ct.outcome==="resisted").length,kt=xe.filter(ct=>ct.outcome==="relapsed").length,Vt=xe.length,Ft=xe.reduce((ct,dt)=>ct+(dt.strength||0),0)/Vt,Tn={},bn={},jn={},wt={};xe.forEach(ct=>{ct.mood&&(Tn[ct.mood]=(Tn[ct.mood]||0)+1),ct.context&&(bn[ct.context]=(bn[ct.context]||0)+1),ct.timeOfDay&&(jn[ct.timeOfDay]=(jn[ct.timeOfDay]||0)+1);const dt=new Date(ct.timestamp),Kn=`${dt.getFullYear()}-W${Math.ceil((dt.getDate()+new Date(dt.getFullYear(),0,1).getDay())/7)}`;wt[Kn]=(wt[Kn]||0)+1});const xt=Object.entries(Tn).sort(([,ct],[,dt])=>dt-ct).slice(0,3).map(([ct,dt])=>({mood:ct,count:dt})),qr=Object.entries(bn).sort(([,ct],[,dt])=>dt-ct).slice(0,3).map(([ct,dt])=>({context:ct,count:dt})),Wr=[];return at>kt&&Wr.push("You're successfully resisting more cravings than giving in - great job!"),Ft>7&&Wr.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),jn.afternoon>jn.morning&&jn.afternoon>jn.evening&&Wr.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),xt.length>0&&xt[0].count>Vt*.4&&Wr.push(`You often experience cravings when feeling ${xt[0].mood}. This might be a key trigger to address.`),{totalCravings:Vt,resistedCount:at,relapseCount:kt,averageStrength:Math.round(Ft*10)/10,successRate:Vt>0?Math.round(at/Vt*100):0,commonMoods:xt,commonContexts:qr,timeOfDayPatterns:jn,weeklyTrends:wt,insights:Wr,dateRange:{start:St.toDateString(),end:gt.toDateString(),days:Se}}}catch(Me){return console.error("Error getting craving insights:",Me),null}},_e=async(z,Se="json")=>{try{if(!z)return null;const{ref:Me,get:nt}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),ve=Me(H,`users/${n.uid}/cravings`),be=await nt(ve);if(!be.exists())return console.log("No craving data to export"),null;const qe=Object.values(be.val()||{});if(Se==="json"){const Ct=JSON.stringify(qe,null,2),gt=new Blob([Ct],{type:"application/json"}),St=URL.createObjectURL(gt),Rt=document.createElement("a");return Rt.href=St,Rt.download=`craving-data-${z}-${new Date().toISOString().split("T")[0]}.json`,Rt.click(),URL.revokeObjectURL(St),console.log(`Exported ${qe.length} craving records for user ${z}`),qe.length}return qe.length}catch(Me){return console.error("Error exporting craving data:",Me),null}},ge=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log("🧪 Testing craving insights...");const z=await le(n.uid,30);z?(console.log("📊 Craving Insights:",z),w({title:"📊 Your Craving Insights",message:`Last 30 days:

Total cravings: ${z.totalCravings}
Successfully resisted: ${z.resistedCount}
Relapses: ${z.relapseCount}
Success rate: ${z.successRate}%
Average intensity: ${z.averageStrength}/10

Top mood triggers: ${z.commonMoods.map(Se=>`${Se.mood} (${Se.count})`).join(", ")}
Top contexts: ${z.commonContexts.map(Se=>`${Se.context} (${Se.count})`).join(", ")}

Insights:
${z.insights.join(`
`)}`,type:"info"}),g(!0)):(console.log("No insights available"),w({title:"📊 No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),g(!0))};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsx("div",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-start gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[d.jsx("div",{className:"mb-8",children:d.jsx("button",{onClick:Ae,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-xl",children:"⚠️"}),d.jsx("span",{children:"I feel like vaping"})]})})}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsx("button",{onClick:re,className:"bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg border border-slate-500/30 hover:border-slate-400/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-green-400",children:"✅"}),d.jsx("span",{children:"I resisted craving"})]})}),d.jsx("button",{onClick:ne,className:"bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg border border-slate-500/30 hover:border-slate-400/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-red-400",children:"❌"}),d.jsx("span",{children:"I relapsed"})]})})]})]}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"📊 This Week"}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-green-400",children:"🎯"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:S.resisted}),d.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-red-400",children:"💔"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:S.relapses}),d.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"🎮 Distract Yourself"}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:Y,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg",children:"🐍 Play Snake"})})]})}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"📊 Data Analysis"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:ge,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg",children:"🔍 View Insights"}),d.jsx("button",{onClick:()=>_e(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg",children:"📥 Export Data"})]})]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"⚡ Quick Actions"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:()=>x(!0),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"💧 Hydration"}),d.jsx("button",{onClick:()=>P(!0),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🫁 Breathe"}),d.jsx("button",{onClick:async()=>{if(B("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log("✅ Physical activity (walk) logged to Firestore for analytics")}catch(z){console.warn("⚠️ Could not log physical activity to Firestore:",z.message),await handleOfflineBehavioralLog("walk",{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"})}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🚶‍♂️ Walk"}),d.jsx("button",{onClick:async()=>{if(B("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log("✅ Meditation (quick) logged to Firestore for analytics")}catch(z){console.warn("⚠️ Could not log meditation to Firestore:",z.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🧘‍♀️ Meditate"})]})]}),a&&u&&d.jsx(wq,{gameType:u,onClose:X}),d.jsx(vq,{isOpen:f,onClose:()=>g(!1),title:y.title,message:y.message,type:y.type}),A&&d.jsx(Eq,{isOpen:A,onClose:()=>x(!1),onLogWater:he,currentWater:R,userId:n.uid}),U&&d.jsx(tq,{isOpen:U,onClose:()=>P(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),T&&d.jsx(xq,{isOpen:T,onClose:()=>v(!1),step:b,cravingData:I,setCravingData:k,onNext:ye,onPrev:Le,onComplete:Ie,dailyCravingLogs:vt})]})})},xq=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:l})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"😰",label:"Stressed"},{id:"lonely",icon:"😔",label:"Lonely"},{id:"happy",icon:"😊",label:"Happy"},{id:"bored",icon:"😐",label:"Bored"},{id:"excited",icon:"🤩",label:"Excited"},{id:"down",icon:"😞",label:"Down"},{id:"angry",icon:"😠",label:"Angry"},{id:"anxious",icon:"😰",label:"Anxious"}],f=[{id:"break",icon:"☕",label:"I'm taking a break"},{id:"partying",icon:"🎉",label:"I'm partying"},{id:"drinking",icon:"🍺",label:"I'm drinking alcohol"},{id:"car",icon:"🚗",label:"I'm in a car"},{id:"coffee",icon:"☕",label:"I'm drinking coffee"},{id:"eating",icon:"🍽️",label:"I've just finished eating"},{id:"intimate",icon:"💕",label:"I've made love"},{id:"tv",icon:"📺",label:"I'm watching TV"},{id:"wake",icon:"🌅",label:"I've just woken up"}],g=()=>{switch(t){case 1:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),d.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),d.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:w=>s({...r,strength:parseInt(w.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`,autoComplete:"off"}),d.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[d.jsx("span",{children:"Not at all"}),d.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>d.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>d.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-2xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💪 I successfully resisted"}),d.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🛡️ Use resistance practices"}),d.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"📝 Just log this craving"}),d.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💔 I had a relapse"})]})});default:return null}};return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 rounded-3xl p-8 max-w-lg w-full shadow-2xl border border-slate-600/50 relative overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),d.jsxs("div",{className:"relative z-10",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>d.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),d.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),d.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",l,"/2"]})]}),d.jsx("div",{className:"mb-8",children:g()}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:"← Back"}),t<4&&d.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next →"})]}),d.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:"×"})]})]})}):null},Eq=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=V.useState(0),[a,l]=V.useState(0),[u,h]=V.useState(!1);V.useState(!1),V.useEffect(()=>{n&&s&&f()},[n,s,r]);const f=async()=>{try{const{ref:N,get:A}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),x=await g();o(x);const R=await y();l(R)}catch(N){console.error("Error loading hydration data:",N)}},g=async()=>{try{const{ref:N,get:A}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);let x=0;for(let R=0;R<7;R++){const D=new Date;D.setDate(D.getDate()-R);const U=D.toDateString(),P=await A(N(H,`users/${s}/profile/daily/${U}/water`));if(P.exists()&&P.val()>0)x++;else break}return x}catch(N){return console.error("Error checking hydration streak:",N),0}},y=async()=>{try{const{ref:N,get:A}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);let x=0;for(let R=0;R<7;R++){const D=new Date;D.setDate(D.getDate()-R);const U=D.toDateString(),P=await A(N(H,`users/${s}/profile/daily/${U}/water`));P.exists()&&P.val()>=6&&x++}return Math.min(x,3)}catch(N){return console.error("Error checking mental strength progress:",N),0}},w=()=>d.jsx("div",{className:"glasses-visual",children:[...Array(6)].map((N,A)=>{const x=A<r;return d.jsx("div",{className:`glass ${x?"filled":""}`},A)})}),C=async()=>{!s||u||r>=6||(h(!0),t(),setTimeout(async()=>{h(!1),await f()},1e3))};return!n||!s?null:d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"hydration-module",children:[d.jsxs("div",{className:"module-header",children:[d.jsxs("div",{className:"module-title",children:[d.jsx("div",{className:"water-icon",children:"💧"}),"Hydration Tracker"]}),d.jsx("p",{className:"subtitle",children:"Stay hydrated, stay strong"})]}),d.jsxs("div",{className:"progress-container",children:[d.jsxs("div",{className:"progress-header",children:[d.jsx("span",{className:"progress-text",children:"Today's Progress"}),d.jsxs("span",{className:"progress-fraction",children:[r,"/6"]})]}),w(),d.jsx("div",{className:"progress-bar",children:d.jsx("div",{className:"progress-fill",style:{width:`${r/6*100}%`}})}),d.jsxs("div",{className:"progress-percentage",children:[Math.round(r/6*100),"% Complete"]})]}),d.jsxs("div",{className:"streak-section",children:[d.jsxs("div",{className:"streak-card",children:[d.jsx("span",{className:"streak-icon",children:"🔥"}),d.jsx("div",{className:"streak-label",children:"Hydration Streak"}),d.jsxs("div",{className:"streak-value",children:[i," days"]})]}),d.jsxs("div",{className:"streak-card",children:[d.jsx("span",{className:"streak-icon",children:"💪"}),d.jsx("div",{className:"streak-label",children:"Mental Strength"}),d.jsxs("div",{className:"streak-value",children:[a,"/3"]})]})]}),r===6&&d.jsx("div",{className:"completion-message",children:"🎉 Congratulations! You've completed your daily hydration goal!"}),d.jsx("button",{onClick:C,disabled:r>=6||u,className:"log-button",children:r>=6?"🎉 Goal Complete!":u?"💧 Logging...":"💧 Log Water"}),d.jsx("button",{onClick:e,className:"done-button",children:"Done"})]})})},Sq=({user:n,onNavigate:e})=>{const[t,r]=V.useState(null),[s,i]=V.useState(!1),[o,a]=V.useState(!1),[l,u]=V.useState(!1),[h,f]=V.useState(!1),[g,y]=V.useState(null),[w,C]=V.useState(0),[N,A]=V.useState(null),[x,R]=V.useState(!1),[D,U]=V.useState([]),[P,T]=V.useState(null);V.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const le=new Fm(H,n.uid);await le.initialize(),T(le)}catch(le){console.error("Error initializing StatManager:",le)}})();const re=async()=>{try{const{ref:le,get:_e,onValue:ge}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),z=le(H,`users/${n.uid}/profile/relapseDate`),Se=await _e(z);Se.exists()&&r(new Date(Se.val()));const Me=le(H,`users/${n.uid}/profile/scheduledTriggers`),nt=await _e(Me);nt.exists()&&U(nt.val());const ve=new Date().toDateString(),be=le(H,`users/${n.uid}/profile/daily/${ve}/water`),qe=ge(be,xe=>{xe.exists()&&C(xe.val()||0)}),Ct=le(H,`users/${n.uid}/profile/daily/${ve}/mood`),gt=ge(Ct,xe=>{xe.exists()&&A(xe.val())}),St=le(H,`users/${n.uid}/profile/daily/${ve}/breathing`),Rt=ge(St,xe=>{xe.exists()&&R(xe.val()||!1)}),Qe=le(H,`users/${n.uid}/profile/scheduledTriggers`),Ke=ge(Qe,xe=>{xe.exists()&&U(xe.val()||[])});return()=>{qe(),gt(),Rt(),Ke()}}catch(le){console.error("Error loading profile data from Firebase:",le),ne()}},ne=()=>{const le=localStorage.getItem("quitCoachRelapseDate");le&&r(new Date(le));const _e=new Date().toDateString(),ge=localStorage.getItem(`water_${n.uid}_${_e}`),z=localStorage.getItem(`mood_${n.uid}_${_e}`),Se=localStorage.getItem(`breathing_${n.uid}_${_e}`);ge&&C(parseInt(ge)),z&&A(JSON.parse(z)),Se&&R(Se==="true");const Me=localStorage.getItem("scheduledTriggers");Me&&U(JSON.parse(Me))};re()},[n==null?void 0:n.uid]),V.useEffect(()=>{P&&P.trackLoggingActivity()},[P]),V.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:re,get:ne,set:le}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),_e=re(H,`users/${n.uid}/profile`),ge=await ne(_e);if(!ge.exists()||Object.keys(ge.val()).length===0){console.log("Migrating localStorage data to Firebase...");const z=localStorage.getItem("quitCoachRelapseDate");z&&(await le(re(H,`users/${n.uid}/profile/relapseDate`),z),r(new Date(z)));const Se=parseInt(localStorage.getItem("cravingWins")||0);Se>0&&await le(re(H,`users/${n.uid}/profile/cravingsResisted`),Se);for(let nt=0;nt<7;nt++){const ve=new Date;ve.setDate(ve.getDate()-nt);const be=ve.toDateString(),qe=localStorage.getItem(`water_${n.uid}_${be}`);qe&&await le(re(H,`users/${n.uid}/profile/daily/${be}/water`),parseInt(qe))}for(let nt=0;nt<7;nt++){const ve=new Date;ve.setDate(ve.getDate()-nt);const be=ve.toDateString(),qe=localStorage.getItem(`mood_${n.uid}_${be}`);qe&&await le(re(H,`users/${n.uid}/profile/daily/${be}/mood`),JSON.parse(qe))}for(let nt=0;nt<7;nt++){const ve=new Date;ve.setDate(ve.getDate()-nt);const be=ve.toDateString(),qe=localStorage.getItem(`breathing_${n.uid}_${be}`);qe&&await le(re(H,`users/${n.uid}/profile/daily/${be}/breathing`),qe==="true")}const Me=localStorage.getItem("scheduledTriggers");if(Me){const nt=JSON.parse(Me);await le(re(H,`users/${n.uid}/profile/scheduledTriggers`),nt),U(nt)}console.log("localStorage data migration to Firebase completed")}}catch(re){console.error("Error migrating localStorage data to Firebase:",re)}})()},[n==null?void 0:n.uid]);const v=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,b=()=>{const Ie=new Date,re=new Date(Ie);re.setHours(24,0,0,0);const ne=re-Ie,le=Math.floor(ne/(1e3*60*60)),_e=Math.floor(ne%(1e3*60*60)/(1e3*60)),ge=Math.floor(ne%(1e3*60)/1e3);return{hours:le,minutes:_e,seconds:ge}},[_,I]=V.useState(b()),[k,S]=V.useState(0),[K,vt]=V.useState(0),[Ve,ln]=V.useState(0),[te,pe]=V.useState(0);V.useEffect(()=>{const Ie=setInterval(()=>{I(b());const re=v(),le=new Date-re,_e=Math.floor(le/(1e3*60*60*24)),ge=Math.floor(le%(1e3*60*60*24)/(1e3*60*60)),z=Math.floor(le%(1e3*60*60)/(1e3*60)),Se=Math.floor(le%(1e3*60)/1e3);S(_e),vt(ge),ln(z),pe(Se)},1e3);return()=>clearInterval(Ie)},[t,n==null?void 0:n.quitDate]);const L=async(Ie,re)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:ne,set:le}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),_e=ne(H,`users/${n.uid}/profile/${Ie}`);return await le(_e,re),!0}catch(ne){return console.error("Error saving to Firebase:",ne),!1}},B=async()=>{const Ie=new Date;r(Ie),P&&await P.handleRelapse();const re=Ie.toISOString(),ne=await L("relapseDate",re),le=await L("lastQuitDate",re);ne||localStorage.setItem("quitCoachRelapseDate",re),le||localStorage.setItem("quitCoachLastQuitDate",re),console.log("🔄 Relapse logged - quit date reset to relapse time:",re)},X=(()=>{const Ie=new Date,re=Ie.getDay(),ne=re===0?6:re-1,le=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let _e=0;_e<=ne;_e++)le[_e].color="bg-green-500";return t&&t.toDateString()===Ie.toDateString()&&(le[ne].color="bg-red-500"),le})(),he=async Ie=>{C(Ie);const re=new Date().toDateString();P&&await P.handleHydrationUpdate(Ie),await L(`daily/${re}/water`,Ie)||localStorage.setItem(`water_${re}`,Ie.toString()),i(!1)},Ae=async Ie=>{A(Ie);const re=new Date().toDateString();await L(`daily/${re}/mood`,Ie)||localStorage.setItem(`mood_${re}`,JSON.stringify(Ie)),a(!1)},ye=async(Ie,re,ne)=>{const le={day:Ie,triggerType:re,time:ne,id:Date.now()},_e=[...D,le];U(_e),P&&await P.handleTriggerPlanning(),await L("scheduledTriggers",_e)||localStorage.setItem("scheduledTriggers",JSON.stringify(_e)),u(!1)},Le=async()=>{P&&await P.handleTriggerListUpdate()};return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-white text-lg",children:"Hello,"}),d.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),d.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:d.jsx("span",{className:"font-bold text-slate-900",children:k})})]}),d.jsxs("div",{className:"px-4 space-y-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("button",{onClick:B,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-2xl",children:"⚠️"}),d.jsx("span",{className:"text-lg",children:"RELAPSE"}),d.jsx("span",{className:"text-2xl",children:"⚠️"})]}),d.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),d.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[d.jsx("span",{className:"text-white text-sm",children:"✓"}),d.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),d.jsx("div",{className:"flex justify-between items-center mb-4",children:X.map((Ie,re)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${Ie.color}`}),d.jsx("p",{className:"text-gray-400 text-xs",children:Ie.name})]},Ie.name))})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-white text-3xl font-bold",children:[_.hours.toString().padStart(2,"0"),":",_.minutes.toString().padStart(2,"0"),":",_.seconds.toString().padStart(2,"0")]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),d.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),d.jsxs("div",{className:"flex items-baseline gap-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:k.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:K.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:Ve.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:te.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&d.jsx("div",{className:"mt-3 text-center",children:d.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),d.jsx("p",{className:"text-gray-300 text-sm",children:w>0?`${w} glasses today`:"Tap to log water intake"})]}),d.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),d.jsx("p",{className:"text-gray-300 text-sm",children:N?`You feel ${N.name.toLowerCase()}`:"How do you feel today?"})]}),d.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:D.length>0?`${D.length} triggers planned`:"Plan your trigger defense strategy"})]}),d.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:Le,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),d.jsx("div",{children:d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),d.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),d.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),d.jsx(Tq,{isOpen:s,onClose:()=>i(!1),onConfirm:he,currentWater:w}),d.jsx(bq,{isOpen:o,onClose:()=>a(!1),onSelect:Ae,selectedMood:N}),d.jsx(Aq,{isOpen:l,onClose:()=>u(!1),onSchedule:ye,scheduledTriggers:D}),d.jsx(Cq,{isOpen:h,onClose:()=>f(!1),selectedDate:g,onDateSelect:y,dailyData:{water:w,mood:N,breathing:x,relapseDate:t}})]})},Tq=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=V.useState(r);return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:o=>i(parseInt(o.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0",autoComplete:"off"}),d.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>t(s),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Confirm"})]})]})}):null},bq=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),d.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:s.map(i=>d.jsxs("button",{onClick:()=>t(i),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 ${(r==null?void 0:r.name)===i.name?"ring-2 ring-blue-400":"bg-slate-700 hover:bg-slate-600"}`,children:[d.jsx("div",{className:`w-12 h-12 ${i.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:i.icon}),d.jsx("p",{className:"text-white font-semibold",children:i.name})]},i.name))}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"})]})}):null},Aq=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=V.useState(""),[o,a]=V.useState(""),[l,u]=V.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),d.jsxs("select",{value:s,onChange:g=>i(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select a day"}),f.map(g=>d.jsx("option",{value:g,children:g},g))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),d.jsxs("select",{value:o,onChange:g=>a(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select trigger type"}),h.map(g=>d.jsx("option",{value:g,children:g},g))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),d.jsx("input",{type:"time",value:l,onChange:g=>u(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",autoComplete:"off"})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})}):null},Cq=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),d.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),d.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&d.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[d.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),d.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Close"})]})}):null,Rq=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,firestoreBuddyService:r,firestoreBuddyServiceRef:s,initializeFirestoreBuddyService:i,behavioralService:o,user:a,onShowAnalytics:l})=>d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:d.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx(UD,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),d.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"📊 Behavioral Analytics"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),d.jsx("button",{onClick:l,disabled:!o,className:`w-full py-3 rounded-lg transition-colors mb-3 ${o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:o?"📈 View Analytics Dashboard":"📈 Analytics (Service Loading...)"}),o&&d.jsx("button",{onClick:async()=>{try{await o.logCraving(a.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await o.logBreathingExercise(a.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert("✅ Test data added to Firestore for analytics demo!")}catch(u){alert("❌ Error adding test data: "+u.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition-colors text-sm",children:"🧪 Add Test Data"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:"← Back to Login"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),d.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),kq=()=>{const[n,e]=V.useState("arena"),[t,r]=V.useState("auth"),[s,i]=V.useState(null),[o,a]=V.useState(null),[l,u]=V.useState(!1),[h,f]=V.useState(!1),[g,y]=V.useState(null),[w,C]=V.useState(!0),[N,A]=V.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[x,R]=V.useState([]);V.useState(null);const[D,U]=V.useState(null),[P,T]=V.useState(null),[v,b]=V.useState(null),_=V.useRef(null),[I,k]=V.useState(null),S=async()=>{try{if(!oi){console.error("❌ Firestore instance is not available");return}const F=new Jl(oi),G=new Q9(oi),W=await F.testConnectivity(),ae=await G.testConnectivity();W?(U(F),_.current=F,console.log("✅ FirestoreBuddyService initialized successfully")):console.warn("⚠️ Firestore connectivity test failed - service not initialized"),ae?(T(G),console.log("✅ FirestoreBehavioralService initialized successfully")):console.warn("⚠️ Firestore behavioral service connectivity test failed")}catch(F){console.error("❌ Error initializing FirestoreBuddyService:",F)}},K=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),vt=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),Ve=F=>{F.relapseDate&&le(new Date(F.relapseDate)),F.dailyWater!==void 0&&ge(F.dailyWater),F.dailyMood!==void 0&&Se(F.dailyMood),F.dailyBreathing!==void 0&&nt(F.dailyBreathing),F.scheduledTriggers&&be(F.scheduledTriggers)},ln=async()=>{const F=new Date().toDateString();try{const{ref:G,set:W}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),ae=G(H,`users/${g==null?void 0:g.uid}/profile/daily/${F}/breathing`);await W(ae,!0)}catch(G){console.error("Error saving breathing exercise to Firebase:",G),localStorage.setItem(`breathing_${g==null?void 0:g.uid}_${F}`,"true")}if(I)try{await I.handleBreathingExercise();const G=await I.checkBreathingStreak(),W=Math.max(0,3-G%3),ae=G>=3&&G%3===0?`🎉 Excellent! You've completed a ${G}-day breathing streak and earned +1 Mental Strength!`:`✅ Breathing exercise completed! Current streak: ${G} days. Complete ${W} more days to earn +1 Mental Strength.`;if(showQuickActionPopup("🫁 Breathing Exercise Complete",`${ae}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),P)try{await P.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:G,mentalStrengthEarned:G>=3&&G%3===0}),console.log("✅ Breathing exercise also logged to Firestore for analytics")}catch(ke){console.warn("⚠️ Could not log breathing exercise to Firestore:",ke.message),await Ie("breathing",{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:G,mentalStrengthEarned:G>=3&&G%3===0})}}catch(G){console.warn("⚠️ Error handling breathing exercise completion:",G.message),showQuickActionPopup("🫁 Breathing Exercise Complete","✅ Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},te=(F,G)=>{const W=document.createElement("div");W.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",W.innerHTML=`
      <div class="font-bold">${F}</div>
      <div class="text-sm opacity-90">${G}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(W),setTimeout(()=>{W.parentNode&&W.parentNode.removeChild(W)},1e4)},pe=async F=>{if(!F)return!1;A({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:G,get:W,onValue:ae}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);A(Ze=>({...Ze,currentStep:"Loading profile data...",progress:20}));const ke=G(H,`users/${F}`),We=await W(ke);if(!We.exists())throw new Error("User profile not found");const Ee=We.val(),je=L(Ee);A(Ze=>({...Ze,currentStep:"Loading battle stats...",progress:40}));const Ue=G(H,`users/${F}/stats`),ht=await W(Ue),Ge=ht.exists()?B(ht.val()):K();A(Ze=>({...Ze,currentStep:"Loading habits and progress...",progress:60}));const $e=G(H,`users/${F}/profile`),He=await W($e),Oe=He.exists()?Y(He.val()):vt();A(Ze=>({...Ze,currentStep:"Loading achievements...",progress:80}));const Re=G(H,`users/${F}/profile/cravingsResisted`),Te=await W(Re),Ne=Te.exists()?Math.max(0,parseInt(Te.val())||0):0;A(Ze=>({...Ze,currentStep:"Setting up live sync...",progress:90}));const An=ae(Ue,Ze=>{if(Ze.exists()){const Yn=B(Ze.val());if(console.log("🔄 Firebase Listener: Stats changed, new stats:",Yn),St(Yn),t==="arena"&&o){console.log("🔄 Firebase Listener: Current user object:",o),console.log("🔄 Firebase Listener: user.quitDate:",o.quitDate),console.log("🔄 Firebase Listener: user.uid:",o.uid);const as={...o,stats:Yn};console.log("🔄 Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",as),console.log("🔄 Firebase Listener: updatedUser.quitDate:",as.quitDate),console.log("🔄 Firebase Listener: updatedUser.uid:",as.uid),calculateRealTimeStats(as).then(Xs=>{console.log("🔄 Firebase Listener: calculateRealTimeStats returned:",Xs),console.log("🔄 Firebase Listener: calculatedStats.streakDays:",Xs.streakDays),setRealTimeUserStats(Xs)})}}}),pt=ae($e,Ze=>{if(Ze.exists()){const Yn=Y(Ze.val());t==="profile"&&Ve(Yn)}}),It=ae(Re,Ze=>{if(Ze.exists()){const Yn=Math.max(0,parseInt(Ze.val())||0);t==="craving-support"&&Ct(Yn)}});return R([An,pt,It]),A(Ze=>({...Ze,currentStep:"Finalizing...",progress:100})),a(Ze=>({...Ze,...je,...Oe,stats:Ge})),Ve(Oe),Ct(Ne),je.onboardingCompleted&&f(!0),A({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:je,stats:Ge,profileData:Oe,cravingsResisted:Ne}),!0}catch(G){return console.error("❌ Error loading user data:",G),A({isLoading:!1,progress:0,currentStep:"Failed to load data",error:G.message,isComplete:!1}),te("Failed to load user data",G.message),!1}},L=F=>F?{uid:F.uid||"",email:F.email||"",heroName:F.heroName||"Hero",archetype:F.archetype||"The Determined",avatar:F.avatar||Ps("default"),quitDate:F.quitDate,onboardingCompleted:!!F.onboardingCompleted,updatedAt:F.updatedAt||Date.now(),...F}:X(),B=F=>F?{mentalStrength:Math.max(0,Math.min(100,parseInt(F.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(F.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(F.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(F.addictionLevel)||50)),streakDays:Math.max(0,parseInt(F.streakDays)||0),streakUnit:F.streakUnit||"hours",streakDisplayText:F.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(F.cravingsResisted)||0),...F}:K(),Y=F=>F?{dailyWater:Math.max(0,parseInt(F.dailyWater)||0),dailyMood:F.dailyMood||null,dailyBreathing:!!F.dailyBreathing,scheduledTriggers:Array.isArray(F.scheduledTriggers)?F.scheduledTriggers:[],relapseDate:F.relapseDate?new Date(F.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(F.cravingsResisted)||0),...F}:vt(),X=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:Ps("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});V.useEffect(()=>()=>{x.forEach(F=>{typeof F=="function"&&F()})},[x]);const[he,Ae]=V.useState(null);V.useEffect(()=>{(async()=>{try{const G=(await Ce(()=>import("./offlineManager-72d06f03.js"),[])).default,W=new G;Ae(W),window.refreshUserData=re,console.log("✅ Offline manager initialized")}catch(G){console.error("Error initializing offline manager:",G)}})()},[]);const ye=async F=>{if(!F)return!1;const G=await pe(F);if(G&&he&&(await he.cacheUserData(o),await he.cacheProfileData({dailyWater:_e,dailyMood:z,dailyBreathing:Me,scheduledTriggers:ve,relapseDate:ne,cravingsResisted:qe})),!G&&he){console.log("📱 Loading offline data...");const W=await he.getCachedUserData(),ae=await he.getCachedProfileData();if(W)return console.log("📱 Using offline user data"),a(W),f(W.onboardingCompleted),ae&&Ve(ae),!0}return G},Le=async()=>g!=null&&g.uid?(console.log("🔄 Refreshing user data with offline support..."),await ye(g.uid)):!1,Ie=async(F,G)=>{if(!he||!(g!=null&&g.uid))return!1;const W={...G,userId:g.uid,timestamp:Date.now()};return await he.handleOfflineBehavioralLog(F,W)},re=async()=>{if(!(g!=null&&g.uid)){te("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await Le()){const G=document.createElement("div");G.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",G.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(G),setTimeout(()=>{G.parentNode&&G.parentNode.removeChild(G)},5e3)}else te("Refresh Failed","Could not refresh data. Please try again.")},[ne,le]=V.useState(null),[_e,ge]=V.useState(0),[z,Se]=V.useState(null),[Me,nt]=V.useState(!1),[ve,be]=V.useState([]),[qe,Ct]=V.useState(0),[gt,St]=V.useState(K());V.useEffect(()=>{const F=W=>{if(W.message&&W.message.includes("content_script")){console.warn("Browser extension error (ignored):",W.message);return}if(W.message&&(W.message.includes("FrameDoesNotExistError")||W.message.includes("background.js"))){console.warn("Background frame error (ignored):",W.message);return}if(W.message&&W.message.includes("deref")){console.warn("Browser extension deref error (ignored):",W.message);return}if(W.message&&W.message.includes("chrome-extension://")){console.warn("Chrome extension URL error (ignored):",W.message);return}console.error("Global error caught:",W)},G=W=>{if(W.reason&&W.reason.message&&W.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",W.reason.message);return}if(W.reason&&W.reason.message&&(W.reason.message.includes("FrameDoesNotExistError")||W.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",W.reason.message);return}if(W.reason&&W.reason.message&&W.reason.message.includes("deref")){console.warn("Browser extension deref promise rejection (ignored):",W.reason.message);return}if(W.reason&&W.reason.message&&W.reason.message.includes("chrome-extension://")){console.warn("Chrome extension URL promise rejection (ignored):",W.reason.message);return}console.error("Unhandled promise rejection:",W.reason)};return window.addEventListener("error",F),window.addEventListener("unhandledrejection",G),()=>{window.removeEventListener("error",F),window.removeEventListener("unhandledrejection",G)}},[]),V.useEffect(()=>{(()=>{try{H&&typeof H.app<"u"&&console.log("🔥 Firebase RTDB initialized successfully")}catch(G){console.warn("⚠️ Firebase initialization check failed (non-critical):",(G==null?void 0:G.message)||G)}})()},[]),V.useEffect(()=>{let F=!0,G=null;return(async()=>{try{console.log("Initializing authentication state..."),C(!0);const ae=async Ee=>{const je=`quitDateFixed_${Ee}_v2`;if(!localStorage.getItem(je)&&!(Ee!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&Ee!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:Ue,get:ht,set:Ge}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),$e="2025-09-18T13:56:46.584Z";console.log(`🔧 One-time fix: Setting proper quit date for ${Ee}...`);const He=Ue(H,`users/${Ee}/profile`),Oe=await ht(He);let Re=$e;if(Oe.exists()){const Te=Oe.val();if(Te.lastRelapseDate){const Ne=new Date(Te.lastRelapseDate),An=new Date($e);Re=Ne>An?Te.lastRelapseDate:$e,console.log(`📅 ${Ee}: Using quit date ${Re} (considering relapse: ${Te.lastRelapseDate})`)}}await Ge(Ue(H,`users/${Ee}/quitDate`),Re),await Ge(Ue(H,`users/${Ee}/profile/quitDate`),Re),localStorage.setItem(je,"true"),console.log(`✅ One-time fix: Quit date fixed for ${Ee} in Firebase database`)}catch(Ue){console.warn(`⚠️ One-time fix failed for ${Ee}:`,Ue.message)}},{onAuthStateChanged:ke}=await Ce(()=>import("./index.esm-2bf75328.js"),[]);G=ke(ao,async Ee=>{if(F)if(console.log("Auth state changed:",Ee?`User: ${Ee.uid}`:"No user"),Ee){y(Ee),console.log("User authenticated, checking database for user data..."),(Ee.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||Ee.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(`🧹 Clearing cache for ${Ee.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(je=>{(je.includes("quitCoach")||je.includes("quitDate")||je.includes("user")||je.includes("arena"))&&localStorage.removeItem(je)})),ae(Ee.uid);try{const{ref:je,get:Ue}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),ht=je(H,`users/${Ee.uid}`),Ge=await Ue(ht);if(Ge.exists()){const $e=Ge.val();console.log("Existing user data found - auto-login successful"),(()=>{const Oe=[];for(let Re=0;Re<localStorage.length;Re++){const Te=localStorage.key(Re);Te&&(Te.startsWith("water_")||Te.startsWith("mood_")||Te.startsWith("breathing_"))&&Oe.push(Te)}Oe.forEach(Re=>localStorage.removeItem(Re)),console.log("Cleared previous user data from localStorage")})(),a($e),f(!0),r("arena");try{const Oe=await Ce(()=>Promise.resolve().then(()=>H9),void 0),Re=new Oe.default(H,Ee.uid);await Re.initialize(),k(Re),console.log("✅ StatManager initialized successfully")}catch(Oe){console.error("Error initializing StatManager:",Oe)}try{const Oe=new kb(H,Ee.uid);b(Oe),window.centralizedStatService=Oe,await Oe.refreshAllStats(),console.log("✅ CentralizedStatService initialized and stats refreshed for user:",Ee.uid),Oe.setupRealTimeListener(Re=>{console.log("🔄 Real-time stats update received:",Re),St(Re)})}catch(Oe){console.error("Error initializing CentralizedStatService:",Oe)}try{console.log("🔍 Checking if existing user needs buddy matching...");const Oe=_.current||D;if(Oe)if(await Oe.getUserBuddyPair(Ee.uid))console.log("✅ Existing user already has a buddy pair");else{console.log("🔄 Existing user has no buddy - adding to matching pool...");const Te={userId:Ee.uid,heroName:$e.heroName,archetype:$e.archetype,joinedAt:new Date().toISOString(),stats:$e.stats};await Oe.addToMatchingPool(Te),console.log("✅ Added existing user to matching pool"),setTimeout(async()=>{try{console.log("⏳ Triggering auto-matching for existing user..."),await xt()}catch(Ne){console.error("Auto-matching failed for existing user:",Ne)}},2e3)}else console.log("⚠️ FirestoreBuddyService not available for existing user buddy check")}catch(Oe){console.error("Error checking existing user buddy status:",Oe)}console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(je){console.error("Error fetching user data during auto-login:",je),r("onboarding")}}else console.log("No authenticated user - showing login screen"),y(null),a(null),f(!1),r("auth"),(()=>{const Ue=[];for(let ht=0;ht<localStorage.length;ht++){const Ge=localStorage.key(ht);Ge&&(Ge.startsWith("water_")||Ge.startsWith("mood_")||Ge.startsWith("breathing_"))&&Ue.push(Ge)}Ue.forEach(ht=>localStorage.removeItem(ht)),console.log("Cleared user-specific data from localStorage")})()});const We=setTimeout(()=>{F&&(console.warn("Auth initialization timeout - forcing to auth screen"),C(!1),r("auth"))},1e4);G&&clearTimeout(We)}catch(ae){console.error("Error initializing authentication:",ae),F&&(C(!1),r("auth"))}finally{F&&C(!1)}})(),S(),()=>{F=!1,G&&G()}},[]);const Rt=async F=>{console.log("Authentication successful, checking for existing user data...",{uid:F==null?void 0:F.uid,email:F==null?void 0:F.email});try{const{ref:G,get:W}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);console.log("Checking database for existing user data...");const ae=G(H,`users/${F.uid}`),ke=await W(ae);if(ke.exists()){const We=ke.val();if(console.log("Existing user data found - loading all user data..."),await ye(F.uid)){console.log("✅ All user data loaded successfully, going to Arena");try{const je=new kb(H,F.uid);b(je),window.centralizedStatService=je,await je.refreshAllStats(),console.log("✅ CentralizedStatService initialized for existing user:",F.uid),je.setupRealTimeListener(Ue=>{console.log("🔄 Real-time stats update received:",Ue),St(Ue)})}catch(je){console.error("Error initializing CentralizedStatService for existing user:",je)}r("arena")}else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(We);const je=!!We.onboardingCompleted;f(je),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(G){console.error("Database check failed:",G),r("onboarding")}},[Qe,Ke]=V.useState(null),[xe,at]=V.useState(!1),[kt,Vt]=V.useState(null),[Ft,Tn]=V.useState(!1),bn=async(F,G,W)=>{var ae,ke,We;if(!(!(o!=null&&o.uid)||xe)){at(!0),Vt(null),Tn(!0);try{console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!D),console.log("🔄 FirestoreBuddyService type:",typeof D);const Ee=_.current||D;if(!Ee){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await jn();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:je,query:Ue,where:ht,getDocs:Ge}=await Ce(()=>import("./index.esm-2ad60163.js"),[]),$e=je(oi,"buddyPairs"),He=Ue($e,ht("user1Id","==",o.uid)),Oe=await Ge(He);let Re=null,Te=null;if(Oe.empty){const Ne=Ue($e,ht("user2Id","==",o.uid)),An=await Ge(Ne);if(!An.empty){const pt=An.docs[0];Re={id:pt.id,...pt.data()},Te=Re.user1Id}}else{const Ne=Oe.docs[0];Re={id:Ne.id,...Ne.data()},Te=Re.user2Id}if(Re&&Te){console.log("✅ Firestore: Found buddy pair:",Re.id),console.log("🔍 Buddy pair data:",{user1Id:Re.user1Id,user2Id:Re.user2Id,user1Name:Re.user1Name,user2Name:Re.user2Name,currentUserId:o.uid,buddyUserId:Te});let Ne="Your Buddy";if(Re.user1Id===o.uid?Ne=Re.user2Name||"Your Buddy":Ne=Re.user1Name||"Your Buddy",Ne==="Your Buddy")try{const lt=(await Ee.getAllMatchingPoolUsers()).find(Pt=>Pt.userId===Te);lt&&lt.heroName&&(Ne=lt.heroName,console.log("🔍 Found buddy name from matching pool:",Ne))}catch(Be){console.log("⚠️ Could not get buddy name from matching pool:",Be.message)}if(Ne==="Your Buddy"&&(Ne=`Buddy ${Te.slice(-4)}`),console.log("🔍 Selected buddy name:",Ne),Ne!=="Your Buddy"&&Ne.startsWith("Buddy ")===!1)try{console.log("🔄 Updating buddy pair with correct names...");const{doc:Be,updateDoc:lt}=await Ce(()=>import("./index.esm-2ad60163.js"),[]),Pt=Be(oi,"buddyPairs",Re.id),zt={};Re.user1Id===o.uid?(zt.user1Name=o.heroName,zt.user2Name=Ne):(zt.user1Name=Ne,zt.user2Name=o.heroName),await lt(Pt,zt),console.log("✅ Updated buddy pair with names:",zt)}catch(Be){console.log("⚠️ Could not update buddy pair names:",Be.message)}let An={streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0};try{console.log("🔄 Attempting to get real buddy stats from Firebase...");const{ref:Be,get:lt}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Pt=Be(H,`users/${Te}/stats`),zt=await lt(Pt);if(zt.exists()){const Gr=zt.val();An={...An,...Gr},console.log("✅ Got real buddy stats from Firebase:",Gr)}else console.log("⚠️ Buddy stats not found in Firebase, using defaults")}catch(Be){console.log("⚠️ Could not read buddy stats (permission), using defaults:",Be.message)}let pt=null,It=null,Ze=null,Yn=Ps("buddy","adventurer"),as="DETERMINED";try{console.log("🔄 Loading Firebase imports for buddy profile...");const{ref:Be,get:lt}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);console.log("✅ Firebase imports loaded successfully"),console.log("🔍 Reading buddy profile fields from path:",`users/${Te}`),console.log("🔄 Firestore: Attempting to read buddy quit date from multiple locations...");const[Pt,zt,Gr,Vi,Zs,ei,Cn]=await Promise.all([lt(Be(H,`users/${Te}/avatar`)),lt(Be(H,`users/${Te}/avatarSeed`)),lt(Be(H,`users/${Te}/archetype`)),lt(Be(H,`users/${Te}/heroName`)),lt(Be(H,`users/${Te}/quitDate`)),lt(Be(H,`users/${Te}/profile/quitDate`)),lt(Be(H,`users/${Te}/profile`))]);if(console.log("🔍 Firestore: Quit date snapshots - root exists:",Zs.exists(),"profile exists:",ei.exists()),Pt.exists())Yn=Pt.val(),console.log("✅ Got buddy avatar from Firebase");else if(zt.exists()){const Dt=zt.val(),Cs=Gr.exists()?Gr.val():"adventurer";Yn=Ps(Dt,Cs),console.log("✅ Generated buddy avatar from seed:",Dt)}if(Gr.exists()&&(as=Gr.val(),console.log("✅ Got buddy archetype:",as)),Vi.exists()){const Dt=Vi.val();console.log("✅ Got buddy hero name:",Dt),Ne=Dt}if(Zs.exists())pt=Zs.val(),console.log("✅ Got buddy quit date from Firebase (root):",pt);else if(ei.exists())pt=ei.val(),console.log("✅ Got buddy quit date from Firebase (profile):",pt);else{if(console.log("⚠️ No buddy quit date found in Firebase (neither root nor profile)"),console.log("🔍 quitDateSnapshot exists:",Zs.exists()),console.log("🔍 profileQuitDateSnapshot exists:",ei.exists()),Cn.exists()){const Dt=Cn.val();console.log("🔍 Full profile data available:",Dt),Dt&&Dt.quitDate?(pt=Dt.quitDate,console.log("✅ Found buddy quit date in profile data:",pt)):console.log("⚠️ Profile exists but has no quit date field"),Dt&&Dt.lastActivity&&(Ze=Dt.lastActivity,console.log("🔍 Captured buddy lastActivity for fallback:",Ze))}else console.log("⚠️ No profile data available at all");if(Cn.exists()){const Dt=Cn.val();It=Dt.lastRelapseDate||Dt.relapseDate,console.log("🔍 Found buddy relapse date:",It)}if(!pt){if(console.log("⚠️ No quit date found, checking for createdAt timestamp..."),console.log("🔍 Buddy user ID:",Te),Cn.exists()){const Dt=Cn.val();Dt.createdAt?(pt=Dt.createdAt,console.log("✅ Using buddy createdAt as quit date:",pt)):(console.log("⚠️ No createdAt timestamp found either - not assigning fallback quit date"),pt=void 0)}else console.log("⚠️ No profile data available - not assigning fallback quit date"),pt=void 0;Te==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"?console.log("🔄 Arena: User 2 uses centralized stats - no hardcoded quit date needed"):Te==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&console.log("🔄 Arena: User 3 uses centralized stats - no hardcoded quit date needed")}}}catch(Be){console.log("⚠️ Could not read buddy profile (permission):",Be.message),console.log("🔍 Full profile error details:",Be),console.log("🔍 Trying to access path:",`users/${Te}`),console.log("🔍 Current user can read own profile, but not buddy profile")}const Xs=pt||Ze||null;let Oi=Xs;(Te==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||Te==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")&&(console.log(`🔄 Arena: Not setting quit date for centralized buddy ${Te} - using null to prevent calculations`),Oi=null);const $n={heroName:Ne,uid:Te,stats:An,quitDate:Oi,originalQuitDate:Oi,finalQuitDate:Xs,lastActivity:Ze||null,lastRelapseDate:It,achievements:[],archetype:as,avatar:Yn,userId:Te,isRealBuddy:!0,pairId:Re.id,triggers:[],dailyPatterns:[],copingStrategies:[],specialFeatures:null};console.log("🔍 Firestore: Final buddy object with quit date:",{heroName:Ne,originalQuitDate:pt,finalQuitDate:Xs,lastRelapseDate:It,hasOriginalQuitDate:!!pt,usingDefaultQuitDate:!pt,hasRelapseDate:!!It}),Ke($n),console.log("✅ Firestore: Buddy data loaded successfully"),console.log("🔍 Firestore: Buddy Special Features data:",{hasSpecialFeatures:!!$n.specialFeatures,hasTriggers:!!((ae=$n.triggers)!=null&&ae.length),hasDailyPatterns:!!((ke=$n.dailyPatterns)!=null&&ke.length),hasCopingStrategies:!!((We=$n.copingStrategies)!=null&&We.length),uid:$n.uid});try{let Be=$n.lastRelapseDate||null;if(!Be){const lt=$n.finalQuitDate;if(lt){const Pt=new Date(lt).getTime(),zt=Date.now();Math.abs(zt-Pt)<2*60*1e3||(Be=lt)}}if(!Be&&$n.lastActivity&&(Be=$n.lastActivity),Be){const lt=ks(new Date(Be)),Pt={streakDays:lt.value,streakUnit:lt.unit,streakDisplayText:lt.displayText};typeof setBuddyStreakData=="function"&&setBuddyStreakData(Pt),typeof setRealTimeNemesisStats=="function"&&setRealTimeNemesisStats(zt=>({...zt,streakDays:Pt.streakDays,streakUnit:Pt.streakUnit,streakDisplayText:Pt.streakDisplayText})),console.log("🔄 Arena: Primed buddy streak from loaded data:",Pt.streakDisplayText)}}catch(Be){console.log("⚠️ Arena: Could not prime buddy streak:",Be==null?void 0:Be.message)}console.log(`🔄 Firestore: Reading centralized buddy stats for ${Te} (read-only)`);try{try{const{ref:Be,get:lt}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Pt=await lt(Be(H,`users/${Te}/stats`));if(Pt.exists()){const zt=Pt.val(),Gr=new Date,Vi=$n.lastRelapseDate;if(Vi){const Zs=new Date(Vi),ei=Gr-Zs,Cn=Math.floor(ei/(1e3*60*60)),Dt=Math.floor(Cn/24);let Cs,Qo;Cn<24?(Cs=`${Cn} hour${Cn===1?"":"s"}`,Qo=0):(Cs=`${Dt} day${Dt===1?"":"s"}`,Qo=Dt),console.log(`🔄 Firestore: Calculated buddy streak locally: ${Cs} (${Cn} hours since relapse)`);const jm={streakDays:Qo,streakUnit:Cn<24?"hours":"days",streakDisplayText:Cs};W(jm);const Ko={...zt,streakDays:Qo,streakUnit:Cn<24?"hours":"days",streakDisplayText:Cs};console.log("🔄 Firestore: Using buddy stats with locally calculated streak:",Ko),console.log("🔄 Firestore: Buddy streak fields:",{streakDays:Ko.streakDays,streakUnit:Ko.streakUnit,streakDisplayText:Ko.streakDisplayText}),G(Ko)}else console.log("🔄 Firestore: No relapse date found for buddy, using existing stats"),G(zt)}else{console.log("⚠️ Firestore: No centralized stats found for buddy, using fallback calculation");const zt=await F($n);G(zt)}}catch(Be){console.error("❌ Error reading buddy stats:",Be);const lt=await F($n);G(lt)}}catch(Be){console.error("❌ Error reading centralized buddy stats:",Be);const lt=await F($n);G(lt)}await wt(o.uid,Te)}else console.log("ℹ️ Firestore: No buddy pair found for user"),Ke(null)}catch(Ee){console.error("❌ Firestore: Error loading buddy:",Ee),console.log("🔄 Falling back to Realtime Database buddy loading..."),await jn()}finally{at(!1)}}},jn=async()=>{var F,G,W,ae,ke,We,Ee,je,Ue,ht;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:Ge,get:$e}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),He=Ge(H,"buddyPairs"),Oe=await $e(He);if(!Oe.exists()){Ke(null);return}const Re=Oe.val();let Te=null,Ne=null;for(const[An,pt]of Object.entries(Re))if(pt.users&&Array.isArray(pt.users)&&pt.users.includes(o.uid)){Te={...pt,pairId:An},Ne=pt.users.find(It=>It!==o.uid);break}if(Te&&Ne){const An=Ge(H,`users/${Ne}`),pt=await $e(An);if(!pt.exists()){const{remove:Yn}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);await Yn(Ge(H,`buddyPairs/${Te.pairId}`)),Ke(null);return}const It=pt.val(),Ze={heroName:It.heroName||"Buddy",stats:{streakDays:((F=It.stats)==null?void 0:F.streakDays)||0,addictionLevel:((G=It.stats)==null?void 0:G.addictionLevel)||50,willpower:((W=It.stats)==null?void 0:W.mentalStrength)||50,motivation:((ae=It.stats)==null?void 0:ae.mentalStrength)||50,cravingResistance:((ke=It.stats)==null?void 0:ke.mentalStrength)||50,triggerDefense:((We=It.stats)==null?void 0:We.triggerDefense)||30,experiencePoints:((Ee=It.stats)==null?void 0:Ee.experiencePoints)||0},achievements:It.achievements||[],archetype:It.archetype||"The Determined",avatar:It.avatar||Ps(It.heroName||"buddy","adventurer"),uid:Ne,userId:Ne,lastRelapseDate:It.lastRelapseDate,isRealBuddy:!0,pairId:Te.pairId,triggers:It.triggers||[],dailyPatterns:It.dailyPatterns||[],copingStrategies:It.copingStrategies||[],specialFeatures:It.specialFeatures||null};Ke(Ze),console.log("🔍 RealtimeDB: Buddy Special Features data:",{hasSpecialFeatures:!!Ze.specialFeatures,hasTriggers:!!((je=Ze.triggers)!=null&&je.length),hasDailyPatterns:!!((Ue=Ze.dailyPatterns)!=null&&Ue.length),hasCopingStrategies:!!((ht=Ze.copingStrategies)!=null&&ht.length),uid:Ze.uid}),await wt(o.uid,Ne)}else Ke(null)}catch(Ge){console.error("Error loading buddy from Realtime Database:",Ge),Vt("Failed to load buddy data"),Ke(null)}},wt=async(F,G)=>{try{const W=_.current||D;if(W&&(Qe!=null&&Qe.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await W.removeFromMatchingPool(F),await W.removeFromMatchingPool(G);const{doc:ae,updateDoc:ke}=await Ce(()=>import("./index.esm-2ad60163.js"),[]),We=ae(oi,"buddyPairs",Qe.pairId);await ke(We,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:ae,remove:ke,set:We}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);await ke(ae(H,`matchingPool/${F}`)),await ke(ae(H,`matchingPool/${G}`)),Qe!=null&&Qe.pairId&&(await We(ae(H,`buddyPairs/${Qe.pairId}/user1RemovedFromPool`),!0),await We(ae(H,`buddyPairs/${Qe.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(W){console.error("❌ Error removing users from matching pool:",W)}};V.useEffect(()=>{Tn(!1),Ke(null)},[o==null?void 0:o.uid]),V.useEffect(()=>{o!=null&&o.uid&&!Qe&&!xe&&!Ft&&console.log("🔄 Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,Qe,xe,Ft]),V.useEffect(()=>{D&&console.log("✅ FirestoreBuddyService is now available")},[D]);const xt=async()=>{try{const F=_.current||D;if(!F){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await qr();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting NEW CHAIN PAIRING algorithm...");const G=await F.getAllMatchingPoolUsers();if(console.log("🔍 Firestore: Current matching pool state:",{totalUsers:G.length,userIds:G.map(ae=>({id:ae.userId,name:ae.heroName,joinedAt:ae.joinedAt}))}),G.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing (need 2, have",G.length,")");return}console.log(`🔄 Firestore: Found ${G.length} users in matching pool`);const W=G;if(console.log("ℹ️ Firestore: Skipping user validation to avoid permission errors"),W.sort((ae,ke)=>{const We=ae.joinedAt?new Date(ae.joinedAt).getTime():0,Ee=ke.joinedAt?new Date(ke.joinedAt).getTime():0;return We-Ee}),console.log("🔄 Firestore: Sorted users by join time (oldest first):",W.map(ae=>({userId:ae.userId,joinedAt:ae.joinedAt}))),W.length>=2){const ae=W[W.length-1],ke=W[W.length-2];if(ae.userId!==ke.userId)try{console.log(`🔄 Firestore: SEQUENTIAL PAIRING: ${ae.userId} (${ae.heroName}) pairs with ${ke.userId} (${ke.heroName})`);const We={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1,user1Name:ae.heroName||"User 1",user2Name:ke.heroName||"User 2"};console.log("🔄 Firestore: About to call createBuddyPair with data:",{arrivingUserId:ae.userId,targetUserId:ke.userId,pairData:We});const Ee=await F.createBuddyPair(ae.userId,ke.userId,We);if(console.log("🔄 Firestore: createBuddyPair returned:",Ee),Ee){const{ref:je,set:Ue}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]);if(await Ue(je(H,`users/${ke.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ae.userId,pairId:Ee,matchedAt:We.matchedAt}),await Ue(je(H,`users/${ae.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ke.userId,pairId:Ee,matchedAt:We.matchedAt}),await F.removeFromMatchingPool(ke.userId),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Created buddy pair ${Ee}`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Removed ${ke.userId} (${ke.heroName}) from matching pool`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Kept ${ae.userId} (${ae.heroName}) in matching pool for next pairing`),o!=null&&o.uid&&[ae.userId,ke.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Ge){console.error("Error reloading buddy data:",Ge)}}else console.error(`❌ Firestore: Failed to create buddy pair between ${ae.userId} and ${ke.userId}`)}catch(We){console.error(`❌ Firestore: Failed to create buddy pair between ${ae.userId} and ${ke.userId}:`,We)}else console.log("ℹ️ Firestore: Same user in pool, cannot pair")}else console.log("ℹ️ Firestore: Not enough users in pool for pairing (need 2, have",W.length,")")}catch(F){console.error("❌ Firestore: Auto-matching failed:",F),console.log("🔄 Falling back to Realtime Database auto-matching..."),await qr()}},qr=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:F,get:G,set:W,push:ae,remove:ke}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),We=F(H,"matchingPool"),Ee=await G(We);if(!Ee.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const je=Ee.val(),Ue=[];if(Object.entries(je).forEach(([$e,He])=>{typeof He=="string"?Ue.push(He):He&&typeof He=="object"?He.uid?Ue.push(He.uid):He.userId?Ue.push(He.userId):Ue.push($e):Ue.push($e)}),console.log(`🔄 Realtime Database: Found ${Ue.length} users in matching pool`),Ue.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",Ue.length,")");return}const ht=Ue;console.log("ℹ️ Realtime Database: Skipping user validation to avoid permission errors"),console.log(`🔄 Realtime Database: Valid users for pairing: ${ht.join(", ")}`);const Ge=ht.map(($e,He)=>({userId:$e,joinedAt:new Date(Date.now()-(ht.length-He)*1e3).toISOString()}));if(Ge.sort(($e,He)=>{const Oe=$e.joinedAt?new Date($e.joinedAt).getTime():0,Re=He.joinedAt?new Date(He.joinedAt).getTime():0;return Oe-Re}),console.log("🔄 Realtime Database: Sorted users by join time (oldest first):",Ge.map($e=>({userId:$e.userId,joinedAt:$e.joinedAt}))),Ge.length>=2){const $e=Ge[0],He=Ge[Ge.length-1];if($e&&He&&$e.userId!==He.userId){console.log(`🔄 Realtime Database: CHAIN PAIRING: ${He.userId} (arriving) pairs with ${$e.userId} (waiting)`);try{const Oe=ae(F(H,"buddyPairs")).key,Re={pairId:Oe,users:[He.userId,$e.userId],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await W(F(H,`buddyPairs/${Oe}`),Re),await W(F(H,`users/${$e.userId}/buddyInfo`),{hasBuddy:!0,buddyId:He.userId,pairId:Oe,matchedAt:Re.matchedAt}),await W(F(H,`users/${He.userId}/buddyInfo`),{hasBuddy:!0,buddyId:$e.userId,pairId:Oe,matchedAt:Re.matchedAt}),Object.keys(je).forEach(async Te=>{const Ne=je[Te];((Ne==null?void 0:Ne.uid)||(Ne==null?void 0:Ne.userId)||Te)===$e.userId&&(await ke(F(H,`matchingPool/${Te}`)),console.log(`✅ Realtime Database: Removed ${$e.userId} (waiting) from matching pool`))}),await W(F(H,`buddyPairs/${Oe}/user1RemovedFromPool`),!0),await W(F(H,`buddyPairs/${Oe}/user2RemovedFromPool`),!1),console.log(`✅ Realtime Database: CHAIN PAIRING: Created buddy pair ${Oe}`),console.log(`✅ Realtime Database: CHAIN PAIRING: Kept ${He.userId} (arriving) in matching pool for next pairing`)}catch(Oe){console.error("Error creating buddy pair:",Oe)}}else console.log("ℹ️ Realtime Database: Same user in pool, cannot pair")}else console.log("ℹ️ Realtime Database: Not enough users in pool for pairing (need 2, have",Ge.length,")");if(o!=null&&o.uid&&Ge.length>=2){const $e=Ge[0],He=Ge[Ge.length-1];if([He==null?void 0:He.userId,$e==null?void 0:$e.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Re){console.error("Error reloading buddy data:",Re)}}}catch(F){console.error("Error in Realtime Database auto-matching:",F)}},Wr={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},ct=()=>xe?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Ps("loading","adventurer"),isLoading:!0}:kt?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Ps("error","adventurer"),isError:!0,errorMessage:kt}:Qe||Wr,dt=async F=>{console.log("Onboarding completed with user data:",F);try{if(!F||!F.heroName||!F.stats)throw new Error("Invalid user data received from onboarding");if(!g)throw new Error("No authenticated user found");const G=new Date,W={...F,uid:g.uid,email:g.email,displayName:g.displayName||F.heroName,photoURL:g.photoURL,onboardingCompleted:!0,createdAt:G.toISOString(),updatedAt:G.getTime(),originalQuitDate:G.toISOString(),lastQuitDate:G.toISOString(),lastRelapseDate:G.toISOString(),lastActivity:G.toISOString(),daily:{[G.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",W);const{ref:ae,set:ke}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),We=ae(H,`users/${g.uid}`);await ke(We,W),console.log("Firebase save successful, updating app state..."),a(W),f(!0);try{const je=_.current||D;if(je){console.log("✅ Using Firestore for matching pool");const Ue={quitStartDate:W.quitDate||new Date().toISOString(),addictionLevel:W.stats.addictionLevel||50,triggers:W.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:W.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:g.uid,heroName:W.heroName,archetype:W.archetype,joinedAt:new Date().toISOString()};if(await je.addToMatchingPool(g.uid,Ue))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Ue,set:ht}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Ge={quitStartDate:W.quitDate||new Date().toISOString(),addictionLevel:W.stats.addictionLevel||50,triggers:W.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:W.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:g.uid,heroName:W.heroName,archetype:W.archetype,joinedAt:new Date().toISOString()};await ht(Ue(H,`matchingPool/${g.uid}`),Ge),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{console.log("⏳ Waiting 1 second before attempting auto-matching..."),await new Promise(Ue=>setTimeout(Ue,1e3)),await xt()}catch(Ue){console.error("Automatic matching failed:",Ue)}}catch(je){console.error("⚠️ Failed to add user to buddy matching pool:",je)}const Ee=await ye(g.uid);r("arena")}catch(G){console.error("Error in handleOnboardingComplete:",G);const W=new Date,ae={heroName:(F==null?void 0:F.heroName)||"Hero",archetype:(F==null?void 0:F.archetype)||"The Determined",avatar:(F==null?void 0:F.avatar)||Ps("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:W,createdAt:W.toISOString(),lastActivity:W.toISOString(),lastRelapseDate:W.toISOString(),uid:g==null?void 0:g.uid,email:g==null?void 0:g.email,onboardingCompleted:!0};if(g)try{const{ref:ke,set:We}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),Ee=ke(H,`users/${g.uid}`);await We(Ee,ae)}catch(ke){console.error("Failed to save fallback data to Firebase:",ke)}a(ae),f(!0),r("arena")}},Kn=()=>{a(null),f(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},Un=async()=>{try{console.log("Logging out user...");const{signOut:F}=await Ce(()=>import("./index.esm-2bf75328.js"),[]);await F(ao),a(null),y(null),f(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(F){console.error("Error during logout:",F),a(null),y(null),f(!1),r("auth")}},is=async()=>{if(!g){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:F,set:G,remove:W}=await Ce(()=>import("./index.esm-3abb91d7.js"),[]),ae=F(H,`users/${g.uid}`);await G(ae,null);const ke=F(H,"users");await G(ke,null);const We=F(H,"buddyPairs");await G(We,null);const Ee=F(H,"matchingPool");await G(Ee,null),console.log("All user data and buddy matching data cleared from database"),a(null),f(!1),r("onboarding"),Ke(null),at(!1),Vt(null),console.log("Account reset successful - ready for fresh onboarding")}catch(F){console.error("Error resetting account for testing:",F)}},As=F=>{console.log("Tab changed to:",F),e(F),r(F),F==="arena"&&(o!=null&&o.uid)&&(console.log("🔄 Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log("🔄 Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},os=F=>{r(F==="mood-selector"?"mood-selector":"profile")},Mi=F=>{i(F),r("profile")},al=()=>{r("profile")};return w?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?d.jsx(K9,{onAuthSuccess:Rt}):N.isLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:N.currentStep}),d.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[d.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${N.progress}%`}})}),d.jsxs("div",{className:"text-sm text-gray-400",children:[N.progress,"% Complete"]})]}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),N.error&&d.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[d.jsxs("p",{className:"text-red-300 text-sm",children:[d.jsx("span",{className:"font-semibold",children:"Error:"})," ",N.error]}),d.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:[d.jsx(Y9,{offlineManager:he}),t==="onboarding"&&d.jsx("div",{children:d.jsx(fq,{onComplete:dt,authUser:g})}),h&&o?d.jsxs(d.Fragment,{children:[t==="arena"&&d.jsx("div",{children:(()=>{try{const F=ct();return d.jsx(_q,{user:o,userStats:gt,nemesis:F,onBackToLogin:Un,onResetForTesting:is,buddyLoading:xe,buddyError:kt,realBuddy:Qe,loadRealBuddy:bn,buddyLoadAttempted:Ft})}catch(F){return console.error("Error rendering ArenaView:",F),d.jsxs("div",{className:"text-white text-center p-8",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),d.jsx("p",{className:"text-gray-300 mb-4",children:F.message}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-2 rounded hover:bg-blue-700",children:"Reload App"})]})}})()}),t==="craving-support"&&d.jsx("div",{children:d.jsx(Iq,{user:o,nemesis:ct(),onBackToLogin:Un,onResetForTesting:is,behavioralService:P,onBreathingComplete:async F=>{await ln()},setActiveTab:e})}),t==="profile"&&d.jsx("div",{children:d.jsx(Sq,{user:o,onNavigate:os})}),t==="mood-selector"&&d.jsx(MoodSelector,{onMoodSelect:Mi,onBack:al}),t==="settings"&&d.jsx(Rq,{onResetApp:Kn,onBackToLogin:Un,onResetForTesting:is,firestoreBuddyService:D,firestoreBuddyServiceRef:_,initializeFirestoreBuddyService:S,behavioralService:P,user:o,onShowAnalytics:()=>u(!0)}),l&&d.jsx(hq,{user:o,behavioralService:P,onClose:()=>u(!1)}),d.jsx(yq,{activeTab:n,onTabChange:As,dataLoadingState:N,onRefreshData:re,offlineManager:he})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),d.jsx("p",{className:"text-gray-300",children:h?"User data missing":"Onboarding not completed"}),d.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),d.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),d.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:h,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Debug State"})]})})]})};Qy.createRoot(document.getElementById("root")).render(d.jsx(kq,{}));export{Vq as $,jq as A,Uq as B,$q as C,Pa as D,Dq as E,kR as F,Xq as G,Zq as H,e8 as I,t8 as J,f4 as K,r8 as L,ue as M,Pq as N,h4 as O,Lq as P,bs as Q,Ts as R,d8 as S,D4 as T,c8 as U,Ye as V,Mq as W,Oq as X,Kq as Y,Qq as Z,g8 as _,C4 as a,P8 as a$,vP as a0,Gd as a1,nU as a2,Nr as a3,E8 as a4,Gs as a5,Nt as a6,Lr as a7,tl as a8,nl as a9,en as aA,I7 as aB,st as aC,y8 as aD,w7 as aE,v7 as aF,w8 as aG,rs as aH,q4 as aI,ri as aJ,z8 as aK,q8 as aL,L8 as aM,u7 as aN,c7 as aO,B8 as aP,A8 as aQ,Hr as aR,I8 as aS,X6 as aT,cU as aU,_7 as aV,fU as aW,l7 as aX,k8 as aY,y7 as aZ,Xf as a_,Ot as aa,q as ab,Hs as ac,Z6 as ad,bU as ae,Fn as af,Qc as ag,Rh as ah,Zf as ai,Tm as aj,kh as ak,Em as al,bI as am,Mr as an,Sm as ao,io as ap,yt as aq,TU as ar,ws as as,EU as at,Sw as au,dn as av,Da as aw,se as ax,_8 as ay,L4 as az,zr as b,Xi as b$,W8 as b0,T8 as b1,b8 as b2,R8 as b3,m7 as b4,U8 as b5,j8 as b6,an as b7,Nh as b8,gU as b9,Ml as bA,iP as bB,G8 as bC,x8 as bD,a7 as bE,ds as bF,hU as bG,g7 as bH,m8 as bI,H8 as bJ,F8 as bK,V8 as bL,$8 as bM,N8 as bN,X8 as bO,h7 as bP,C8 as bQ,Ol as bR,f7 as bS,b7 as bT,Mh as bU,Lh as bV,C7 as bW,Jd as bX,il as bY,Ji as bZ,x7 as b_,t7 as ba,dU as bb,Q8 as bc,K8 as bd,rd as be,Y8 as bf,J8 as bg,eU as bh,p7 as bi,d7 as bj,S8 as bk,M8 as bl,O8 as bm,QT as bn,n7 as bo,s7 as bp,r7 as bq,tU as br,JT as bs,Z8 as bt,e7 as bu,D8 as bv,lU as bw,i7 as bx,o7 as by,IU as bz,X0 as c,NB as c$,ai as c0,bi as c1,ng as c2,T7 as c3,xa as c4,Yl as c5,mz as c6,E7 as c7,rW as c8,Fv as c9,G7 as cA,F7 as cB,O$ as cC,iW as cD,cW as cE,hW as cF,tW as cG,Q7 as cH,X$ as cI,k7 as cJ,CU as cK,V$ as cL,oW as cM,lW as cN,dW as cO,zU as cP,X7 as cQ,q$ as cR,j$ as cS,V7 as cT,J$ as cU,N7 as cV,VI as cW,D7 as cX,B$ as cY,j7 as cZ,sW as c_,S7 as ca,yz as cb,QI as cc,Zi as cd,M7 as ce,Z$ as cf,nW as cg,eD as ch,pz as ci,rD as cj,U$ as ck,L7 as cl,g$ as cm,$$ as cn,A7 as co,Z7 as cp,U7 as cq,W7 as cr,Sz as cs,R7 as ct,UU as cu,eW as cv,fW as cw,ib as cx,_B as cy,h$ as cz,Vs as d,uW as d0,J7 as d1,P7 as d2,Y7 as d3,z7 as d4,q7 as d5,aW as d6,B7 as d7,K7 as d8,H7 as d9,$7 as da,O7 as db,Ce as dc,uc as e,f8 as f,k4 as g,h8 as h,l8 as i,Wq as j,Gq as k,n8 as l,i8 as m,s8 as n,Fe as o,R4 as p,o8 as q,LR as r,y1 as s,a8 as t,u8 as u,yw as v,Yq as w,Jq as x,Bq as y,Fq as z};
