var M2=Object.defineProperty;var O2=(n,e,t)=>e in n?M2(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var sf=(n,e,t)=>(O2(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function V2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var aA={exports:{}},Pg={},lA={exports:{}},ut={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uh=Symbol.for("react.element"),F2=Symbol.for("react.portal"),U2=Symbol.for("react.fragment"),$2=Symbol.for("react.strict_mode"),B2=Symbol.for("react.profiler"),z2=Symbol.for("react.provider"),q2=Symbol.for("react.context"),W2=Symbol.for("react.forward_ref"),G2=Symbol.for("react.suspense"),H2=Symbol.for("react.memo"),Q2=Symbol.for("react.lazy"),QS=Symbol.iterator;function K2(n){return n===null||typeof n!="object"?null:(n=QS&&n[QS]||n["@@iterator"],typeof n=="function"?n:null)}var cA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uA=Object.assign,dA={};function Vc(n,e,t){this.props=n,this.context=e,this.refs=dA,this.updater=t||cA}Vc.prototype.isReactComponent={};Vc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Vc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function hA(){}hA.prototype=Vc.prototype;function o_(n,e,t){this.props=n,this.context=e,this.refs=dA,this.updater=t||cA}var a_=o_.prototype=new hA;a_.constructor=o_;uA(a_,Vc.prototype);a_.isPureReactComponent=!0;var KS=Array.isArray,fA=Object.prototype.hasOwnProperty,l_={current:null},mA={key:!0,ref:!0,__self:!0,__source:!0};function gA(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)fA.call(e,r)&&!mA.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:uh,type:n,key:i,ref:o,props:s,_owner:l_.current}}function Y2(n,e){return{$$typeof:uh,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function c_(n){return typeof n=="object"&&n!==null&&n.$$typeof===uh}function J2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var YS=/\/+/g;function uy(n,e){return typeof n=="object"&&n!==null&&n.key!=null?J2(""+n.key):e.toString(36)}function $f(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case uh:case F2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+uy(o,0):r,KS(s)?(t="",n!=null&&(t=n.replace(YS,"$&/")+"/"),$f(s,e,t,"",function(u){return u})):s!=null&&(c_(s)&&(s=Y2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(YS,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",KS(n))for(var a=0;a<n.length;a++){i=n[a];var c=r+uy(i,a);o+=$f(i,e,t,c,s)}else if(c=K2(n),typeof c=="function")for(n=c.call(n),a=0;!(i=n.next()).done;)i=i.value,c=r+uy(i,a++),o+=$f(i,e,t,c,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function of(n,e,t){if(n==null)return n;var r=[],s=0;return $f(n,r,"","",function(i){return e.call(t,i,s++)}),r}function X2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ir={current:null},Bf={transition:null},Z2={ReactCurrentDispatcher:Ir,ReactCurrentBatchConfig:Bf,ReactCurrentOwner:l_};function pA(){throw Error("act(...) is not supported in production builds of React.")}ut.Children={map:of,forEach:function(n,e,t){of(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return of(n,function(){e++}),e},toArray:function(n){return of(n,function(e){return e})||[]},only:function(n){if(!c_(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ut.Component=Vc;ut.Fragment=U2;ut.Profiler=B2;ut.PureComponent=o_;ut.StrictMode=$2;ut.Suspense=G2;ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z2;ut.act=pA;ut.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=uA({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=l_.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(c in e)fA.call(e,c)&&!mA.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:uh,type:n.type,key:s,ref:i,props:r,_owner:o}};ut.createContext=function(n){return n={$$typeof:q2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:z2,_context:n},n.Consumer=n};ut.createElement=gA;ut.createFactory=function(n){var e=gA.bind(null,n);return e.type=n,e};ut.createRef=function(){return{current:null}};ut.forwardRef=function(n){return{$$typeof:W2,render:n}};ut.isValidElement=c_;ut.lazy=function(n){return{$$typeof:Q2,_payload:{_status:-1,_result:n},_init:X2}};ut.memo=function(n,e){return{$$typeof:H2,type:n,compare:e===void 0?null:e}};ut.startTransition=function(n){var e=Bf.transition;Bf.transition={};try{n()}finally{Bf.transition=e}};ut.unstable_act=pA;ut.useCallback=function(n,e){return Ir.current.useCallback(n,e)};ut.useContext=function(n){return Ir.current.useContext(n)};ut.useDebugValue=function(){};ut.useDeferredValue=function(n){return Ir.current.useDeferredValue(n)};ut.useEffect=function(n,e){return Ir.current.useEffect(n,e)};ut.useId=function(){return Ir.current.useId()};ut.useImperativeHandle=function(n,e,t){return Ir.current.useImperativeHandle(n,e,t)};ut.useInsertionEffect=function(n,e){return Ir.current.useInsertionEffect(n,e)};ut.useLayoutEffect=function(n,e){return Ir.current.useLayoutEffect(n,e)};ut.useMemo=function(n,e){return Ir.current.useMemo(n,e)};ut.useReducer=function(n,e,t){return Ir.current.useReducer(n,e,t)};ut.useRef=function(n){return Ir.current.useRef(n)};ut.useState=function(n){return Ir.current.useState(n)};ut.useSyncExternalStore=function(n,e,t){return Ir.current.useSyncExternalStore(n,e,t)};ut.useTransition=function(){return Ir.current.useTransition()};ut.version="18.3.1";lA.exports=ut;var P=lA.exports;const yA=V2(P);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ej=P,tj=Symbol.for("react.element"),nj=Symbol.for("react.fragment"),rj=Object.prototype.hasOwnProperty,sj=ej.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ij={key:!0,ref:!0,__self:!0,__source:!0};function vA(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)rj.call(e,r)&&!ij.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:tj,type:n,key:i,ref:o,props:s,_owner:sj.current}}Pg.Fragment=nj;Pg.jsx=vA;Pg.jsxs=vA;aA.exports=Pg;var l=aA.exports,fv={},_A={exports:{}},Zr={},wA={exports:{}},xA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Q,we){var se=Q.length;Q.push(we);e:for(;0<se;){var Ie=se-1>>>1,Ae=Q[Ie];if(0<s(Ae,we))Q[Ie]=we,Q[se]=Ae,se=Ie;else break e}}function t(Q){return Q.length===0?null:Q[0]}function r(Q){if(Q.length===0)return null;var we=Q[0],se=Q.pop();if(se!==we){Q[0]=se;e:for(var Ie=0,Ae=Q.length,j=Ae>>>1;Ie<j;){var W=2*(Ie+1)-1,de=Q[W],me=W+1,Ce=Q[me];if(0>s(de,se))me<Ae&&0>s(Ce,de)?(Q[Ie]=Ce,Q[me]=se,Ie=me):(Q[Ie]=de,Q[W]=se,Ie=W);else if(me<Ae&&0>s(Ce,se))Q[Ie]=Ce,Q[me]=se,Ie=me;else break e}}return we}function s(Q,we){var se=Q.sortIndex-we.sortIndex;return se!==0?se:Q.id-we.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],u=[],h=1,f=null,m=3,y=!1,w=!1,S=!1,k=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(Q){for(var we=t(u);we!==null;){if(we.callback===null)r(u);else if(we.startTime<=Q)r(u),we.sortIndex=we.expirationTime,e(c,we);else break;we=t(u)}}function D(Q){if(S=!1,C(Q),!w)if(t(c)!==null)w=!0,Te(U);else{var we=t(u);we!==null&&ft(D,we.startTime-Q)}}function U(Q,we){w=!1,S&&(S=!1,I(_),_=-1),y=!0;var se=m;try{for(C(we),f=t(c);f!==null&&(!(f.expirationTime>we)||Q&&!T());){var Ie=f.callback;if(typeof Ie=="function"){f.callback=null,m=f.priorityLevel;var Ae=Ie(f.expirationTime<=we);we=n.unstable_now(),typeof Ae=="function"?f.callback=Ae:f===t(c)&&r(c),C(we)}else r(c);f=t(c)}if(f!==null)var j=!0;else{var W=t(u);W!==null&&ft(D,W.startTime-we),j=!1}return j}finally{f=null,m=se,y=!1}}var L=!1,R=null,_=-1,E=5,N=-1;function T(){return!(n.unstable_now()-N<E)}function A(){if(R!==null){var Q=n.unstable_now();N=Q;var we=!0;try{we=R(!0,Q)}finally{we?v():(L=!1,R=null)}}else L=!1}var v;if(typeof x=="function")v=function(){x(A)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,ye=B.port2;B.port1.onmessage=A,v=function(){ye.postMessage(null)}}else v=function(){k(A,0)};function Te(Q){R=Q,L||(L=!0,v())}function ft(Q,we){_=k(function(){Q(n.unstable_now())},we)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Q){Q.callback=null},n.unstable_continueExecution=function(){w||y||(w=!0,Te(U))},n.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<Q?Math.floor(1e3/Q):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(Q){switch(m){case 1:case 2:case 3:var we=3;break;default:we=m}var se=m;m=we;try{return Q()}finally{m=se}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Q,we){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var se=m;m=Q;try{return we()}finally{m=se}},n.unstable_scheduleCallback=function(Q,we,se){var Ie=n.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?Ie+se:Ie):se=Ie,Q){case 1:var Ae=-1;break;case 2:Ae=250;break;case 5:Ae=1073741823;break;case 4:Ae=1e4;break;default:Ae=5e3}return Ae=se+Ae,Q={id:h++,callback:we,priorityLevel:Q,startTime:se,expirationTime:Ae,sortIndex:-1},se>Ie?(Q.sortIndex=se,e(u,Q),t(c)===null&&Q===t(u)&&(S?(I(_),_=-1):S=!0,ft(D,se-Ie))):(Q.sortIndex=Ae,e(c,Q),w||y||(w=!0,Te(U))),Q},n.unstable_shouldYield=T,n.unstable_wrapCallback=function(Q){var we=m;return function(){var se=m;m=we;try{return Q.apply(this,arguments)}finally{m=se}}}})(xA);wA.exports=xA;var oj=wA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aj=P,Kr=oj;function ee(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var SA=new Set,yd={};function Za(n,e){ic(n,e),ic(n+"Capture",e)}function ic(n,e){for(yd[n]=e,n=0;n<e.length;n++)SA.add(e[n])}var Ni=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mv=Object.prototype.hasOwnProperty,lj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,JS={},XS={};function cj(n){return mv.call(XS,n)?!0:mv.call(JS,n)?!1:lj.test(n)?XS[n]=!0:(JS[n]=!0,!1)}function uj(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function dj(n,e,t,r){if(e===null||typeof e>"u"||uj(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function br(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var sr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){sr[n]=new br(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];sr[e]=new br(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){sr[n]=new br(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){sr[n]=new br(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){sr[n]=new br(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){sr[n]=new br(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){sr[n]=new br(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){sr[n]=new br(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){sr[n]=new br(n,5,!1,n.toLowerCase(),null,!1,!1)});var u_=/[\-:]([a-z])/g;function d_(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(u_,d_);sr[e]=new br(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(u_,d_);sr[e]=new br(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(u_,d_);sr[e]=new br(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){sr[n]=new br(n,1,!1,n.toLowerCase(),null,!1,!1)});sr.xlinkHref=new br("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){sr[n]=new br(n,1,!1,n.toLowerCase(),null,!0,!0)});function h_(n,e,t,r){var s=sr.hasOwnProperty(e)?sr[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(dj(e,t,s,r)&&(t=null),r||s===null?cj(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Fi=aj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,af=Symbol.for("react.element"),Dl=Symbol.for("react.portal"),Pl=Symbol.for("react.fragment"),f_=Symbol.for("react.strict_mode"),gv=Symbol.for("react.profiler"),IA=Symbol.for("react.provider"),bA=Symbol.for("react.context"),m_=Symbol.for("react.forward_ref"),pv=Symbol.for("react.suspense"),yv=Symbol.for("react.suspense_list"),g_=Symbol.for("react.memo"),no=Symbol.for("react.lazy"),EA=Symbol.for("react.offscreen"),ZS=Symbol.iterator;function du(n){return n===null||typeof n!="object"?null:(n=ZS&&n[ZS]||n["@@iterator"],typeof n=="function"?n:null)}var hn=Object.assign,dy;function Ru(n){if(dy===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);dy=e&&e[1]||""}return`
`+dy+n}var hy=!1;function fy(n,e){if(!n||hy)return"";hy=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=o&&0<=a);break}}}finally{hy=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Ru(n):""}function hj(n){switch(n.tag){case 5:return Ru(n.type);case 16:return Ru("Lazy");case 13:return Ru("Suspense");case 19:return Ru("SuspenseList");case 0:case 2:case 15:return n=fy(n.type,!1),n;case 11:return n=fy(n.type.render,!1),n;case 1:return n=fy(n.type,!0),n;default:return""}}function vv(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Pl:return"Fragment";case Dl:return"Portal";case gv:return"Profiler";case f_:return"StrictMode";case pv:return"Suspense";case yv:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case bA:return(n.displayName||"Context")+".Consumer";case IA:return(n._context.displayName||"Context")+".Provider";case m_:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case g_:return e=n.displayName||null,e!==null?e:vv(n.type)||"Memo";case no:e=n._payload,n=n._init;try{return vv(n(e))}catch{}}return null}function fj(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vv(e);case 8:return e===f_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Po(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function TA(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function mj(n){var e=TA(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function lf(n){n._valueTracker||(n._valueTracker=mj(n))}function AA(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=TA(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function _m(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function _v(n,e){var t=e.checked;return hn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function eI(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Po(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function NA(n,e){e=e.checked,e!=null&&h_(n,"checked",e,!1)}function wv(n,e){NA(n,e);var t=Po(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?xv(n,e.type,t):e.hasOwnProperty("defaultValue")&&xv(n,e.type,Po(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function tI(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function xv(n,e,t){(e!=="number"||_m(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var ku=Array.isArray;function ql(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Po(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Sv(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ee(91));return hn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function nI(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ee(92));if(ku(t)){if(1<t.length)throw Error(ee(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Po(t)}}function CA(n,e){var t=Po(e.value),r=Po(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function rI(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function RA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Iv(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?RA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var cf,kA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(cf=cf||document.createElement("div"),cf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=cf.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function vd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Bu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gj=["Webkit","ms","Moz","O"];Object.keys(Bu).forEach(function(n){gj.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Bu[e]=Bu[n]})});function DA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Bu.hasOwnProperty(n)&&Bu[n]?(""+e).trim():e+"px"}function PA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=DA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var pj=hn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bv(n,e){if(e){if(pj[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ee(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ee(62))}}function Ev(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tv=null;function p_(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Av=null,Wl=null,Gl=null;function sI(n){if(n=fh(n)){if(typeof Av!="function")throw Error(ee(280));var e=n.stateNode;e&&(e=Vg(e),Av(n.stateNode,n.type,e))}}function jA(n){Wl?Gl?Gl.push(n):Gl=[n]:Wl=n}function LA(){if(Wl){var n=Wl,e=Gl;if(Gl=Wl=null,sI(n),e)for(n=0;n<e.length;n++)sI(e[n])}}function MA(n,e){return n(e)}function OA(){}var my=!1;function VA(n,e,t){if(my)return n(e,t);my=!0;try{return MA(n,e,t)}finally{my=!1,(Wl!==null||Gl!==null)&&(OA(),LA())}}function _d(n,e){var t=n.stateNode;if(t===null)return null;var r=Vg(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ee(231,e,typeof t));return t}var Nv=!1;if(Ni)try{var hu={};Object.defineProperty(hu,"passive",{get:function(){Nv=!0}}),window.addEventListener("test",hu,hu),window.removeEventListener("test",hu,hu)}catch{Nv=!1}function yj(n,e,t,r,s,i,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var zu=!1,wm=null,xm=!1,Cv=null,vj={onError:function(n){zu=!0,wm=n}};function _j(n,e,t,r,s,i,o,a,c){zu=!1,wm=null,yj.apply(vj,arguments)}function wj(n,e,t,r,s,i,o,a,c){if(_j.apply(this,arguments),zu){if(zu){var u=wm;zu=!1,wm=null}else throw Error(ee(198));xm||(xm=!0,Cv=u)}}function el(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function FA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function iI(n){if(el(n)!==n)throw Error(ee(188))}function xj(n){var e=n.alternate;if(!e){if(e=el(n),e===null)throw Error(ee(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return iI(s),n;if(i===r)return iI(s),e;i=i.sibling}throw Error(ee(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(ee(189))}}if(t.alternate!==r)throw Error(ee(190))}if(t.tag!==3)throw Error(ee(188));return t.stateNode.current===t?n:e}function UA(n){return n=xj(n),n!==null?$A(n):null}function $A(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=$A(n);if(e!==null)return e;n=n.sibling}return null}var BA=Kr.unstable_scheduleCallback,oI=Kr.unstable_cancelCallback,Sj=Kr.unstable_shouldYield,Ij=Kr.unstable_requestPaint,wn=Kr.unstable_now,bj=Kr.unstable_getCurrentPriorityLevel,y_=Kr.unstable_ImmediatePriority,zA=Kr.unstable_UserBlockingPriority,Sm=Kr.unstable_NormalPriority,Ej=Kr.unstable_LowPriority,qA=Kr.unstable_IdlePriority,jg=null,ei=null;function Tj(n){if(ei&&typeof ei.onCommitFiberRoot=="function")try{ei.onCommitFiberRoot(jg,n,void 0,(n.current.flags&128)===128)}catch{}}var Rs=Math.clz32?Math.clz32:Cj,Aj=Math.log,Nj=Math.LN2;function Cj(n){return n>>>=0,n===0?32:31-(Aj(n)/Nj|0)|0}var uf=64,df=4194304;function Du(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Im(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Du(a):(i&=o,i!==0&&(r=Du(i)))}else o=t&~s,o!==0?r=Du(o):i!==0&&(r=Du(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Rs(e),s=1<<t,r|=n[t],e&=~s;return r}function Rj(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kj(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-Rs(i),a=1<<o,c=s[o];c===-1?(!(a&t)||a&r)&&(s[o]=Rj(a,e)):c<=e&&(n.expiredLanes|=a),i&=~a}}function Rv(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function WA(){var n=uf;return uf<<=1,!(uf&4194240)&&(uf=64),n}function gy(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function dh(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Rs(e),n[e]=t}function Dj(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Rs(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function v_(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Rs(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var Pt=0;function GA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var HA,__,QA,KA,YA,kv=!1,hf=[],_o=null,wo=null,xo=null,wd=new Map,xd=new Map,so=[],Pj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function aI(n,e){switch(n){case"focusin":case"focusout":_o=null;break;case"dragenter":case"dragleave":wo=null;break;case"mouseover":case"mouseout":xo=null;break;case"pointerover":case"pointerout":wd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":xd.delete(e.pointerId)}}function fu(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=fh(e),e!==null&&__(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function jj(n,e,t,r,s){switch(e){case"focusin":return _o=fu(_o,n,e,t,r,s),!0;case"dragenter":return wo=fu(wo,n,e,t,r,s),!0;case"mouseover":return xo=fu(xo,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return wd.set(i,fu(wd.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,xd.set(i,fu(xd.get(i)||null,n,e,t,r,s)),!0}return!1}function JA(n){var e=ya(n.target);if(e!==null){var t=el(e);if(t!==null){if(e=t.tag,e===13){if(e=FA(t),e!==null){n.blockedOn=e,YA(n.priority,function(){QA(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function zf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Dv(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Tv=r,t.target.dispatchEvent(r),Tv=null}else return e=fh(t),e!==null&&__(e),n.blockedOn=t,!1;e.shift()}return!0}function lI(n,e,t){zf(n)&&t.delete(e)}function Lj(){kv=!1,_o!==null&&zf(_o)&&(_o=null),wo!==null&&zf(wo)&&(wo=null),xo!==null&&zf(xo)&&(xo=null),wd.forEach(lI),xd.forEach(lI)}function mu(n,e){n.blockedOn===e&&(n.blockedOn=null,kv||(kv=!0,Kr.unstable_scheduleCallback(Kr.unstable_NormalPriority,Lj)))}function Sd(n){function e(s){return mu(s,n)}if(0<hf.length){mu(hf[0],n);for(var t=1;t<hf.length;t++){var r=hf[t];r.blockedOn===n&&(r.blockedOn=null)}}for(_o!==null&&mu(_o,n),wo!==null&&mu(wo,n),xo!==null&&mu(xo,n),wd.forEach(e),xd.forEach(e),t=0;t<so.length;t++)r=so[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<so.length&&(t=so[0],t.blockedOn===null);)JA(t),t.blockedOn===null&&so.shift()}var Hl=Fi.ReactCurrentBatchConfig,bm=!0;function Mj(n,e,t,r){var s=Pt,i=Hl.transition;Hl.transition=null;try{Pt=1,w_(n,e,t,r)}finally{Pt=s,Hl.transition=i}}function Oj(n,e,t,r){var s=Pt,i=Hl.transition;Hl.transition=null;try{Pt=4,w_(n,e,t,r)}finally{Pt=s,Hl.transition=i}}function w_(n,e,t,r){if(bm){var s=Dv(n,e,t,r);if(s===null)Ey(n,e,r,Em,t),aI(n,r);else if(jj(s,n,e,t,r))r.stopPropagation();else if(aI(n,r),e&4&&-1<Pj.indexOf(n)){for(;s!==null;){var i=fh(s);if(i!==null&&HA(i),i=Dv(n,e,t,r),i===null&&Ey(n,e,r,Em,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else Ey(n,e,r,null,t)}}var Em=null;function Dv(n,e,t,r){if(Em=null,n=p_(r),n=ya(n),n!==null)if(e=el(n),e===null)n=null;else if(t=e.tag,t===13){if(n=FA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Em=n,null}function XA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bj()){case y_:return 1;case zA:return 4;case Sm:case Ej:return 16;case qA:return 536870912;default:return 16}default:return 16}}var ho=null,x_=null,qf=null;function ZA(){if(qf)return qf;var n,e=x_,t=e.length,r,s="value"in ho?ho.value:ho.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return qf=s.slice(n,1<r?1-r:void 0)}function Wf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function ff(){return!0}function cI(){return!1}function es(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ff:cI,this.isPropagationStopped=cI,this}return hn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ff)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ff)},persist:function(){},isPersistent:ff}),e}var Fc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},S_=es(Fc),hh=hn({},Fc,{view:0,detail:0}),Vj=es(hh),py,yy,gu,Lg=hn({},hh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:I_,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==gu&&(gu&&n.type==="mousemove"?(py=n.screenX-gu.screenX,yy=n.screenY-gu.screenY):yy=py=0,gu=n),py)},movementY:function(n){return"movementY"in n?n.movementY:yy}}),uI=es(Lg),Fj=hn({},Lg,{dataTransfer:0}),Uj=es(Fj),$j=hn({},hh,{relatedTarget:0}),vy=es($j),Bj=hn({},Fc,{animationName:0,elapsedTime:0,pseudoElement:0}),zj=es(Bj),qj=hn({},Fc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Wj=es(qj),Gj=hn({},Fc,{data:0}),dI=es(Gj),Hj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Kj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yj(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Kj[n])?!!e[n]:!1}function I_(){return Yj}var Jj=hn({},hh,{key:function(n){if(n.key){var e=Hj[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Wf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Qj[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:I_,charCode:function(n){return n.type==="keypress"?Wf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Wf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Xj=es(Jj),Zj=hn({},Lg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hI=es(Zj),eL=hn({},hh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:I_}),tL=es(eL),nL=hn({},Fc,{propertyName:0,elapsedTime:0,pseudoElement:0}),rL=es(nL),sL=hn({},Lg,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),iL=es(sL),oL=[9,13,27,32],b_=Ni&&"CompositionEvent"in window,qu=null;Ni&&"documentMode"in document&&(qu=document.documentMode);var aL=Ni&&"TextEvent"in window&&!qu,e1=Ni&&(!b_||qu&&8<qu&&11>=qu),fI=String.fromCharCode(32),mI=!1;function t1(n,e){switch(n){case"keyup":return oL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function n1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var jl=!1;function lL(n,e){switch(n){case"compositionend":return n1(e);case"keypress":return e.which!==32?null:(mI=!0,fI);case"textInput":return n=e.data,n===fI&&mI?null:n;default:return null}}function cL(n,e){if(jl)return n==="compositionend"||!b_&&t1(n,e)?(n=ZA(),qf=x_=ho=null,jl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return e1&&e.locale!=="ko"?null:e.data;default:return null}}var uL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!uL[n.type]:e==="textarea"}function r1(n,e,t,r){jA(r),e=Tm(e,"onChange"),0<e.length&&(t=new S_("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Wu=null,Id=null;function dL(n){m1(n,0)}function Mg(n){var e=Ol(n);if(AA(e))return n}function hL(n,e){if(n==="change")return e}var s1=!1;if(Ni){var _y;if(Ni){var wy="oninput"in document;if(!wy){var pI=document.createElement("div");pI.setAttribute("oninput","return;"),wy=typeof pI.oninput=="function"}_y=wy}else _y=!1;s1=_y&&(!document.documentMode||9<document.documentMode)}function yI(){Wu&&(Wu.detachEvent("onpropertychange",i1),Id=Wu=null)}function i1(n){if(n.propertyName==="value"&&Mg(Id)){var e=[];r1(e,Id,n,p_(n)),VA(dL,e)}}function fL(n,e,t){n==="focusin"?(yI(),Wu=e,Id=t,Wu.attachEvent("onpropertychange",i1)):n==="focusout"&&yI()}function mL(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Mg(Id)}function gL(n,e){if(n==="click")return Mg(e)}function pL(n,e){if(n==="input"||n==="change")return Mg(e)}function yL(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ls=typeof Object.is=="function"?Object.is:yL;function bd(n,e){if(Ls(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!mv.call(e,s)||!Ls(n[s],e[s]))return!1}return!0}function vI(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function _I(n,e){var t=vI(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=vI(t)}}function o1(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?o1(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function a1(){for(var n=window,e=_m();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=_m(n.document)}return e}function E_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function vL(n){var e=a1(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&o1(t.ownerDocument.documentElement,t)){if(r!==null&&E_(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=_I(t,i);var o=_I(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var _L=Ni&&"documentMode"in document&&11>=document.documentMode,Ll=null,Pv=null,Gu=null,jv=!1;function wI(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;jv||Ll==null||Ll!==_m(r)||(r=Ll,"selectionStart"in r&&E_(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Gu&&bd(Gu,r)||(Gu=r,r=Tm(Pv,"onSelect"),0<r.length&&(e=new S_("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ll)))}function mf(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ml={animationend:mf("Animation","AnimationEnd"),animationiteration:mf("Animation","AnimationIteration"),animationstart:mf("Animation","AnimationStart"),transitionend:mf("Transition","TransitionEnd")},xy={},l1={};Ni&&(l1=document.createElement("div").style,"AnimationEvent"in window||(delete Ml.animationend.animation,delete Ml.animationiteration.animation,delete Ml.animationstart.animation),"TransitionEvent"in window||delete Ml.transitionend.transition);function Og(n){if(xy[n])return xy[n];if(!Ml[n])return n;var e=Ml[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in l1)return xy[n]=e[t];return n}var c1=Og("animationend"),u1=Og("animationiteration"),d1=Og("animationstart"),h1=Og("transitionend"),f1=new Map,xI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ho(n,e){f1.set(n,e),Za(e,[n])}for(var Sy=0;Sy<xI.length;Sy++){var Iy=xI[Sy],wL=Iy.toLowerCase(),xL=Iy[0].toUpperCase()+Iy.slice(1);Ho(wL,"on"+xL)}Ho(c1,"onAnimationEnd");Ho(u1,"onAnimationIteration");Ho(d1,"onAnimationStart");Ho("dblclick","onDoubleClick");Ho("focusin","onFocus");Ho("focusout","onBlur");Ho(h1,"onTransitionEnd");ic("onMouseEnter",["mouseout","mouseover"]);ic("onMouseLeave",["mouseout","mouseover"]);ic("onPointerEnter",["pointerout","pointerover"]);ic("onPointerLeave",["pointerout","pointerover"]);Za("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Za("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Za("onBeforeInput",["compositionend","keypress","textInput","paste"]);Za("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Za("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Za("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pu));function SI(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,wj(r,e,void 0,n),n.currentTarget=null}function m1(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;SI(s,a,u),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;SI(s,a,u),i=c}}}if(xm)throw n=Cv,xm=!1,Cv=null,n}function Ht(n,e){var t=e[Fv];t===void 0&&(t=e[Fv]=new Set);var r=n+"__bubble";t.has(r)||(g1(e,n,2,!1),t.add(r))}function by(n,e,t){var r=0;e&&(r|=4),g1(t,n,r,e)}var gf="_reactListening"+Math.random().toString(36).slice(2);function Ed(n){if(!n[gf]){n[gf]=!0,SA.forEach(function(t){t!=="selectionchange"&&(SL.has(t)||by(t,!1,n),by(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[gf]||(e[gf]=!0,by("selectionchange",!1,e))}}function g1(n,e,t,r){switch(XA(e)){case 1:var s=Mj;break;case 4:s=Oj;break;default:s=w_}t=s.bind(null,e,t,n),s=void 0,!Nv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function Ey(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=ya(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}VA(function(){var u=i,h=p_(t),f=[];e:{var m=f1.get(n);if(m!==void 0){var y=S_,w=n;switch(n){case"keypress":if(Wf(t)===0)break e;case"keydown":case"keyup":y=Xj;break;case"focusin":w="focus",y=vy;break;case"focusout":w="blur",y=vy;break;case"beforeblur":case"afterblur":y=vy;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=uI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=Uj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=tL;break;case c1:case u1:case d1:y=zj;break;case h1:y=rL;break;case"scroll":y=Vj;break;case"wheel":y=iL;break;case"copy":case"cut":case"paste":y=Wj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=hI}var S=(e&4)!==0,k=!S&&n==="scroll",I=S?m!==null?m+"Capture":null:m;S=[];for(var x=u,C;x!==null;){C=x;var D=C.stateNode;if(C.tag===5&&D!==null&&(C=D,I!==null&&(D=_d(x,I),D!=null&&S.push(Td(x,D,C)))),k)break;x=x.return}0<S.length&&(m=new y(m,w,null,t,h),f.push({event:m,listeners:S}))}}if(!(e&7)){e:{if(m=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",m&&t!==Tv&&(w=t.relatedTarget||t.fromElement)&&(ya(w)||w[Ci]))break e;if((y||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,y?(w=t.relatedTarget||t.toElement,y=u,w=w?ya(w):null,w!==null&&(k=el(w),w!==k||w.tag!==5&&w.tag!==6)&&(w=null)):(y=null,w=u),y!==w)){if(S=uI,D="onMouseLeave",I="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(S=hI,D="onPointerLeave",I="onPointerEnter",x="pointer"),k=y==null?m:Ol(y),C=w==null?m:Ol(w),m=new S(D,x+"leave",y,t,h),m.target=k,m.relatedTarget=C,D=null,ya(h)===u&&(S=new S(I,x+"enter",w,t,h),S.target=C,S.relatedTarget=k,D=S),k=D,y&&w)t:{for(S=y,I=w,x=0,C=S;C;C=_l(C))x++;for(C=0,D=I;D;D=_l(D))C++;for(;0<x-C;)S=_l(S),x--;for(;0<C-x;)I=_l(I),C--;for(;x--;){if(S===I||I!==null&&S===I.alternate)break t;S=_l(S),I=_l(I)}S=null}else S=null;y!==null&&II(f,m,y,S,!1),w!==null&&k!==null&&II(f,k,w,S,!0)}}e:{if(m=u?Ol(u):window,y=m.nodeName&&m.nodeName.toLowerCase(),y==="select"||y==="input"&&m.type==="file")var U=hL;else if(gI(m))if(s1)U=pL;else{U=mL;var L=fL}else(y=m.nodeName)&&y.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(U=gL);if(U&&(U=U(n,u))){r1(f,U,t,h);break e}L&&L(n,m,u),n==="focusout"&&(L=m._wrapperState)&&L.controlled&&m.type==="number"&&xv(m,"number",m.value)}switch(L=u?Ol(u):window,n){case"focusin":(gI(L)||L.contentEditable==="true")&&(Ll=L,Pv=u,Gu=null);break;case"focusout":Gu=Pv=Ll=null;break;case"mousedown":jv=!0;break;case"contextmenu":case"mouseup":case"dragend":jv=!1,wI(f,t,h);break;case"selectionchange":if(_L)break;case"keydown":case"keyup":wI(f,t,h)}var R;if(b_)e:{switch(n){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else jl?t1(n,t)&&(_="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(_="onCompositionStart");_&&(e1&&t.locale!=="ko"&&(jl||_!=="onCompositionStart"?_==="onCompositionEnd"&&jl&&(R=ZA()):(ho=h,x_="value"in ho?ho.value:ho.textContent,jl=!0)),L=Tm(u,_),0<L.length&&(_=new dI(_,n,null,t,h),f.push({event:_,listeners:L}),R?_.data=R:(R=n1(t),R!==null&&(_.data=R)))),(R=aL?lL(n,t):cL(n,t))&&(u=Tm(u,"onBeforeInput"),0<u.length&&(h=new dI("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=R))}m1(f,e)})}function Td(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Tm(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=_d(n,t),i!=null&&r.unshift(Td(n,i,s)),i=_d(n,e),i!=null&&r.push(Td(n,i,s))),n=n.return}return r}function _l(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function II(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,s?(c=_d(t,i),c!=null&&o.unshift(Td(t,c,a))):s||(c=_d(t,i),c!=null&&o.push(Td(t,c,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var IL=/\r\n?/g,bL=/\u0000|\uFFFD/g;function bI(n){return(typeof n=="string"?n:""+n).replace(IL,`
`).replace(bL,"")}function pf(n,e,t){if(e=bI(e),bI(n)!==e&&t)throw Error(ee(425))}function Am(){}var Lv=null,Mv=null;function Ov(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Vv=typeof setTimeout=="function"?setTimeout:void 0,EL=typeof clearTimeout=="function"?clearTimeout:void 0,EI=typeof Promise=="function"?Promise:void 0,TL=typeof queueMicrotask=="function"?queueMicrotask:typeof EI<"u"?function(n){return EI.resolve(null).then(n).catch(AL)}:Vv;function AL(n){setTimeout(function(){throw n})}function Ty(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Sd(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Sd(e)}function So(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function TI(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Uc=Math.random().toString(36).slice(2),Hs="__reactFiber$"+Uc,Ad="__reactProps$"+Uc,Ci="__reactContainer$"+Uc,Fv="__reactEvents$"+Uc,NL="__reactListeners$"+Uc,CL="__reactHandles$"+Uc;function ya(n){var e=n[Hs];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ci]||t[Hs]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=TI(n);n!==null;){if(t=n[Hs])return t;n=TI(n)}return e}n=t,t=n.parentNode}return null}function fh(n){return n=n[Hs]||n[Ci],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ol(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ee(33))}function Vg(n){return n[Ad]||null}var Uv=[],Vl=-1;function Qo(n){return{current:n}}function Kt(n){0>Vl||(n.current=Uv[Vl],Uv[Vl]=null,Vl--)}function Bt(n,e){Vl++,Uv[Vl]=n.current,n.current=e}var jo={},vr=Qo(jo),Rr=Qo(!1),ka=jo;function oc(n,e){var t=n.type.contextTypes;if(!t)return jo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function kr(n){return n=n.childContextTypes,n!=null}function Nm(){Kt(Rr),Kt(vr)}function AI(n,e,t){if(vr.current!==jo)throw Error(ee(168));Bt(vr,e),Bt(Rr,t)}function p1(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ee(108,fj(n)||"Unknown",s));return hn({},t,r)}function Cm(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||jo,ka=vr.current,Bt(vr,n),Bt(Rr,Rr.current),!0}function NI(n,e,t){var r=n.stateNode;if(!r)throw Error(ee(169));t?(n=p1(n,e,ka),r.__reactInternalMemoizedMergedChildContext=n,Kt(Rr),Kt(vr),Bt(vr,n)):Kt(Rr),Bt(Rr,t)}var yi=null,Fg=!1,Ay=!1;function y1(n){yi===null?yi=[n]:yi.push(n)}function RL(n){Fg=!0,y1(n)}function Ko(){if(!Ay&&yi!==null){Ay=!0;var n=0,e=Pt;try{var t=yi;for(Pt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}yi=null,Fg=!1}catch(s){throw yi!==null&&(yi=yi.slice(n+1)),BA(y_,Ko),s}finally{Pt=e,Ay=!1}}return null}var Fl=[],Ul=0,Rm=null,km=0,is=[],os=0,Da=null,_i=1,wi="";function aa(n,e){Fl[Ul++]=km,Fl[Ul++]=Rm,Rm=n,km=e}function v1(n,e,t){is[os++]=_i,is[os++]=wi,is[os++]=Da,Da=n;var r=_i;n=wi;var s=32-Rs(r)-1;r&=~(1<<s),t+=1;var i=32-Rs(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,_i=1<<32-Rs(e)+s|t<<s|r,wi=i+n}else _i=1<<i|t<<s|r,wi=n}function T_(n){n.return!==null&&(aa(n,1),v1(n,1,0))}function A_(n){for(;n===Rm;)Rm=Fl[--Ul],Fl[Ul]=null,km=Fl[--Ul],Fl[Ul]=null;for(;n===Da;)Da=is[--os],is[os]=null,wi=is[--os],is[os]=null,_i=is[--os],is[os]=null}var Wr=null,qr=null,nn=!1,Es=null;function _1(n,e){var t=ls(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function CI(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Wr=n,qr=So(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Wr=n,qr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Da!==null?{id:_i,overflow:wi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ls(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Wr=n,qr=null,!0):!1;default:return!1}}function $v(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Bv(n){if(nn){var e=qr;if(e){var t=e;if(!CI(n,e)){if($v(n))throw Error(ee(418));e=So(t.nextSibling);var r=Wr;e&&CI(n,e)?_1(r,t):(n.flags=n.flags&-4097|2,nn=!1,Wr=n)}}else{if($v(n))throw Error(ee(418));n.flags=n.flags&-4097|2,nn=!1,Wr=n}}}function RI(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Wr=n}function yf(n){if(n!==Wr)return!1;if(!nn)return RI(n),nn=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Ov(n.type,n.memoizedProps)),e&&(e=qr)){if($v(n))throw w1(),Error(ee(418));for(;e;)_1(n,e),e=So(e.nextSibling)}if(RI(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ee(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){qr=So(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}qr=null}}else qr=Wr?So(n.stateNode.nextSibling):null;return!0}function w1(){for(var n=qr;n;)n=So(n.nextSibling)}function ac(){qr=Wr=null,nn=!1}function N_(n){Es===null?Es=[n]:Es.push(n)}var kL=Fi.ReactCurrentBatchConfig;function pu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ee(309));var r=t.stateNode}if(!r)throw Error(ee(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(ee(284));if(!t._owner)throw Error(ee(290,n))}return n}function vf(n,e){throw n=Object.prototype.toString.call(e),Error(ee(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function kI(n){var e=n._init;return e(n._payload)}function x1(n){function e(I,x){if(n){var C=I.deletions;C===null?(I.deletions=[x],I.flags|=16):C.push(x)}}function t(I,x){if(!n)return null;for(;x!==null;)e(I,x),x=x.sibling;return null}function r(I,x){for(I=new Map;x!==null;)x.key!==null?I.set(x.key,x):I.set(x.index,x),x=x.sibling;return I}function s(I,x){return I=To(I,x),I.index=0,I.sibling=null,I}function i(I,x,C){return I.index=C,n?(C=I.alternate,C!==null?(C=C.index,C<x?(I.flags|=2,x):C):(I.flags|=2,x)):(I.flags|=1048576,x)}function o(I){return n&&I.alternate===null&&(I.flags|=2),I}function a(I,x,C,D){return x===null||x.tag!==6?(x=jy(C,I.mode,D),x.return=I,x):(x=s(x,C),x.return=I,x)}function c(I,x,C,D){var U=C.type;return U===Pl?h(I,x,C.props.children,D,C.key):x!==null&&(x.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===no&&kI(U)===x.type)?(D=s(x,C.props),D.ref=pu(I,x,C),D.return=I,D):(D=Xf(C.type,C.key,C.props,null,I.mode,D),D.ref=pu(I,x,C),D.return=I,D)}function u(I,x,C,D){return x===null||x.tag!==4||x.stateNode.containerInfo!==C.containerInfo||x.stateNode.implementation!==C.implementation?(x=Ly(C,I.mode,D),x.return=I,x):(x=s(x,C.children||[]),x.return=I,x)}function h(I,x,C,D,U){return x===null||x.tag!==7?(x=Ea(C,I.mode,D,U),x.return=I,x):(x=s(x,C),x.return=I,x)}function f(I,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return x=jy(""+x,I.mode,C),x.return=I,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case af:return C=Xf(x.type,x.key,x.props,null,I.mode,C),C.ref=pu(I,null,x),C.return=I,C;case Dl:return x=Ly(x,I.mode,C),x.return=I,x;case no:var D=x._init;return f(I,D(x._payload),C)}if(ku(x)||du(x))return x=Ea(x,I.mode,C,null),x.return=I,x;vf(I,x)}return null}function m(I,x,C,D){var U=x!==null?x.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return U!==null?null:a(I,x,""+C,D);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case af:return C.key===U?c(I,x,C,D):null;case Dl:return C.key===U?u(I,x,C,D):null;case no:return U=C._init,m(I,x,U(C._payload),D)}if(ku(C)||du(C))return U!==null?null:h(I,x,C,D,null);vf(I,C)}return null}function y(I,x,C,D,U){if(typeof D=="string"&&D!==""||typeof D=="number")return I=I.get(C)||null,a(x,I,""+D,U);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case af:return I=I.get(D.key===null?C:D.key)||null,c(x,I,D,U);case Dl:return I=I.get(D.key===null?C:D.key)||null,u(x,I,D,U);case no:var L=D._init;return y(I,x,C,L(D._payload),U)}if(ku(D)||du(D))return I=I.get(C)||null,h(x,I,D,U,null);vf(x,D)}return null}function w(I,x,C,D){for(var U=null,L=null,R=x,_=x=0,E=null;R!==null&&_<C.length;_++){R.index>_?(E=R,R=null):E=R.sibling;var N=m(I,R,C[_],D);if(N===null){R===null&&(R=E);break}n&&R&&N.alternate===null&&e(I,R),x=i(N,x,_),L===null?U=N:L.sibling=N,L=N,R=E}if(_===C.length)return t(I,R),nn&&aa(I,_),U;if(R===null){for(;_<C.length;_++)R=f(I,C[_],D),R!==null&&(x=i(R,x,_),L===null?U=R:L.sibling=R,L=R);return nn&&aa(I,_),U}for(R=r(I,R);_<C.length;_++)E=y(R,I,_,C[_],D),E!==null&&(n&&E.alternate!==null&&R.delete(E.key===null?_:E.key),x=i(E,x,_),L===null?U=E:L.sibling=E,L=E);return n&&R.forEach(function(T){return e(I,T)}),nn&&aa(I,_),U}function S(I,x,C,D){var U=du(C);if(typeof U!="function")throw Error(ee(150));if(C=U.call(C),C==null)throw Error(ee(151));for(var L=U=null,R=x,_=x=0,E=null,N=C.next();R!==null&&!N.done;_++,N=C.next()){R.index>_?(E=R,R=null):E=R.sibling;var T=m(I,R,N.value,D);if(T===null){R===null&&(R=E);break}n&&R&&T.alternate===null&&e(I,R),x=i(T,x,_),L===null?U=T:L.sibling=T,L=T,R=E}if(N.done)return t(I,R),nn&&aa(I,_),U;if(R===null){for(;!N.done;_++,N=C.next())N=f(I,N.value,D),N!==null&&(x=i(N,x,_),L===null?U=N:L.sibling=N,L=N);return nn&&aa(I,_),U}for(R=r(I,R);!N.done;_++,N=C.next())N=y(R,I,_,N.value,D),N!==null&&(n&&N.alternate!==null&&R.delete(N.key===null?_:N.key),x=i(N,x,_),L===null?U=N:L.sibling=N,L=N);return n&&R.forEach(function(A){return e(I,A)}),nn&&aa(I,_),U}function k(I,x,C,D){if(typeof C=="object"&&C!==null&&C.type===Pl&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case af:e:{for(var U=C.key,L=x;L!==null;){if(L.key===U){if(U=C.type,U===Pl){if(L.tag===7){t(I,L.sibling),x=s(L,C.props.children),x.return=I,I=x;break e}}else if(L.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===no&&kI(U)===L.type){t(I,L.sibling),x=s(L,C.props),x.ref=pu(I,L,C),x.return=I,I=x;break e}t(I,L);break}else e(I,L);L=L.sibling}C.type===Pl?(x=Ea(C.props.children,I.mode,D,C.key),x.return=I,I=x):(D=Xf(C.type,C.key,C.props,null,I.mode,D),D.ref=pu(I,x,C),D.return=I,I=D)}return o(I);case Dl:e:{for(L=C.key;x!==null;){if(x.key===L)if(x.tag===4&&x.stateNode.containerInfo===C.containerInfo&&x.stateNode.implementation===C.implementation){t(I,x.sibling),x=s(x,C.children||[]),x.return=I,I=x;break e}else{t(I,x);break}else e(I,x);x=x.sibling}x=Ly(C,I.mode,D),x.return=I,I=x}return o(I);case no:return L=C._init,k(I,x,L(C._payload),D)}if(ku(C))return w(I,x,C,D);if(du(C))return S(I,x,C,D);vf(I,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,x!==null&&x.tag===6?(t(I,x.sibling),x=s(x,C),x.return=I,I=x):(t(I,x),x=jy(C,I.mode,D),x.return=I,I=x),o(I)):t(I,x)}return k}var lc=x1(!0),S1=x1(!1),Dm=Qo(null),Pm=null,$l=null,C_=null;function R_(){C_=$l=Pm=null}function k_(n){var e=Dm.current;Kt(Dm),n._currentValue=e}function zv(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Ql(n,e){Pm=n,C_=$l=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Tr=!0),n.firstContext=null)}function hs(n){var e=n._currentValue;if(C_!==n)if(n={context:n,memoizedValue:e,next:null},$l===null){if(Pm===null)throw Error(ee(308));$l=n,Pm.dependencies={lanes:0,firstContext:n}}else $l=$l.next=n;return e}var va=null;function D_(n){va===null?va=[n]:va.push(n)}function I1(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,D_(e)):(t.next=s.next,s.next=t),e.interleaved=t,Ri(n,r)}function Ri(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ro=!1;function P_(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function b1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ti(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Io(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,yt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ri(n,t)}return s=r.interleaved,s===null?(e.next=e,D_(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ri(n,t)}function Gf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,v_(n,t)}}function DI(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function jm(n,e,t,r){var s=n.updateQueue;ro=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=c))}if(i!==null){var f=s.baseState;o=0,h=u=c=null,a=i;do{var m=a.lane,y=a.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var w=n,S=a;switch(m=e,y=t,S.tag){case 1:if(w=S.payload,typeof w=="function"){f=w.call(y,f,m);break e}f=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=S.payload,m=typeof w=="function"?w.call(y,f,m):w,m==null)break e;f=hn({},f,m);break e;case 2:ro=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,m=s.effects,m===null?s.effects=[a]:m.push(a))}else y={eventTime:y,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,c=f):h=h.next=y,o|=m;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;m=a,a=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(1);if(h===null&&(c=f),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ja|=o,n.lanes=o,n.memoizedState=f}}function PI(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(ee(191,s));s.call(r)}}}var mh={},ti=Qo(mh),Nd=Qo(mh),Cd=Qo(mh);function _a(n){if(n===mh)throw Error(ee(174));return n}function j_(n,e){switch(Bt(Cd,e),Bt(Nd,n),Bt(ti,mh),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Iv(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Iv(e,n)}Kt(ti),Bt(ti,e)}function cc(){Kt(ti),Kt(Nd),Kt(Cd)}function E1(n){_a(Cd.current);var e=_a(ti.current),t=Iv(e,n.type);e!==t&&(Bt(Nd,n),Bt(ti,t))}function L_(n){Nd.current===n&&(Kt(ti),Kt(Nd))}var cn=Qo(0);function Lm(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ny=[];function M_(){for(var n=0;n<Ny.length;n++)Ny[n]._workInProgressVersionPrimary=null;Ny.length=0}var Hf=Fi.ReactCurrentDispatcher,Cy=Fi.ReactCurrentBatchConfig,Pa=0,dn=null,Dn=null,$n=null,Mm=!1,Hu=!1,Rd=0,DL=0;function ur(){throw Error(ee(321))}function O_(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ls(n[t],e[t]))return!1;return!0}function V_(n,e,t,r,s,i){if(Pa=i,dn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Hf.current=n===null||n.memoizedState===null?ML:OL,n=t(r,s),Hu){i=0;do{if(Hu=!1,Rd=0,25<=i)throw Error(ee(301));i+=1,$n=Dn=null,e.updateQueue=null,Hf.current=VL,n=t(r,s)}while(Hu)}if(Hf.current=Om,e=Dn!==null&&Dn.next!==null,Pa=0,$n=Dn=dn=null,Mm=!1,e)throw Error(ee(300));return n}function F_(){var n=Rd!==0;return Rd=0,n}function zs(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $n===null?dn.memoizedState=$n=n:$n=$n.next=n,$n}function fs(){if(Dn===null){var n=dn.alternate;n=n!==null?n.memoizedState:null}else n=Dn.next;var e=$n===null?dn.memoizedState:$n.next;if(e!==null)$n=e,Dn=n;else{if(n===null)throw Error(ee(310));Dn=n,n={memoizedState:Dn.memoizedState,baseState:Dn.baseState,baseQueue:Dn.baseQueue,queue:Dn.queue,next:null},$n===null?dn.memoizedState=$n=n:$n=$n.next=n}return $n}function kd(n,e){return typeof e=="function"?e(n):e}function Ry(n){var e=fs(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=n;var r=Dn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,u=i;do{var h=u.lane;if((Pa&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=f,o=r):c=c.next=f,dn.lanes|=h,ja|=h}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=a,Ls(r,e.memoizedState)||(Tr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,dn.lanes|=i,ja|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function ky(n){var e=fs(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Ls(i,e.memoizedState)||(Tr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function T1(){}function A1(n,e){var t=dn,r=fs(),s=e(),i=!Ls(r.memoizedState,s);if(i&&(r.memoizedState=s,Tr=!0),r=r.queue,U_(R1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||$n!==null&&$n.memoizedState.tag&1){if(t.flags|=2048,Dd(9,C1.bind(null,t,r,s,e),void 0,null),qn===null)throw Error(ee(349));Pa&30||N1(t,e,s)}return s}function N1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=dn.updateQueue,e===null?(e={lastEffect:null,stores:null},dn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function C1(n,e,t,r){e.value=t,e.getSnapshot=r,k1(e)&&D1(n)}function R1(n,e,t){return t(function(){k1(e)&&D1(n)})}function k1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ls(n,t)}catch{return!0}}function D1(n){var e=Ri(n,1);e!==null&&ks(e,n,1,-1)}function jI(n){var e=zs();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:kd,lastRenderedState:n},e.queue=n,n=n.dispatch=LL.bind(null,dn,n),[e.memoizedState,n]}function Dd(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=dn.updateQueue,e===null?(e={lastEffect:null,stores:null},dn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function P1(){return fs().memoizedState}function Qf(n,e,t,r){var s=zs();dn.flags|=n,s.memoizedState=Dd(1|e,t,void 0,r===void 0?null:r)}function Ug(n,e,t,r){var s=fs();r=r===void 0?null:r;var i=void 0;if(Dn!==null){var o=Dn.memoizedState;if(i=o.destroy,r!==null&&O_(r,o.deps)){s.memoizedState=Dd(e,t,i,r);return}}dn.flags|=n,s.memoizedState=Dd(1|e,t,i,r)}function LI(n,e){return Qf(8390656,8,n,e)}function U_(n,e){return Ug(2048,8,n,e)}function j1(n,e){return Ug(4,2,n,e)}function L1(n,e){return Ug(4,4,n,e)}function M1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function O1(n,e,t){return t=t!=null?t.concat([n]):null,Ug(4,4,M1.bind(null,e,n),t)}function $_(){}function V1(n,e){var t=fs();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&O_(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function F1(n,e){var t=fs();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&O_(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function U1(n,e,t){return Pa&21?(Ls(t,e)||(t=WA(),dn.lanes|=t,ja|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Tr=!0),n.memoizedState=t)}function PL(n,e){var t=Pt;Pt=t!==0&&4>t?t:4,n(!0);var r=Cy.transition;Cy.transition={};try{n(!1),e()}finally{Pt=t,Cy.transition=r}}function $1(){return fs().memoizedState}function jL(n,e,t){var r=Eo(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},B1(n))z1(e,t);else if(t=I1(n,e,t,r),t!==null){var s=xr();ks(t,n,r,s),q1(t,e,r)}}function LL(n,e,t){var r=Eo(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(B1(n))z1(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Ls(a,o)){var c=e.interleaved;c===null?(s.next=s,D_(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=I1(n,e,s,r),t!==null&&(s=xr(),ks(t,n,r,s),q1(t,e,r))}}function B1(n){var e=n.alternate;return n===dn||e!==null&&e===dn}function z1(n,e){Hu=Mm=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function q1(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,v_(n,t)}}var Om={readContext:hs,useCallback:ur,useContext:ur,useEffect:ur,useImperativeHandle:ur,useInsertionEffect:ur,useLayoutEffect:ur,useMemo:ur,useReducer:ur,useRef:ur,useState:ur,useDebugValue:ur,useDeferredValue:ur,useTransition:ur,useMutableSource:ur,useSyncExternalStore:ur,useId:ur,unstable_isNewReconciler:!1},ML={readContext:hs,useCallback:function(n,e){return zs().memoizedState=[n,e===void 0?null:e],n},useContext:hs,useEffect:LI,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Qf(4194308,4,M1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Qf(4194308,4,n,e)},useInsertionEffect:function(n,e){return Qf(4,2,n,e)},useMemo:function(n,e){var t=zs();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=zs();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=jL.bind(null,dn,n),[r.memoizedState,n]},useRef:function(n){var e=zs();return n={current:n},e.memoizedState=n},useState:jI,useDebugValue:$_,useDeferredValue:function(n){return zs().memoizedState=n},useTransition:function(){var n=jI(!1),e=n[0];return n=PL.bind(null,n[1]),zs().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=dn,s=zs();if(nn){if(t===void 0)throw Error(ee(407));t=t()}else{if(t=e(),qn===null)throw Error(ee(349));Pa&30||N1(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,LI(R1.bind(null,r,i,n),[n]),r.flags|=2048,Dd(9,C1.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=zs(),e=qn.identifierPrefix;if(nn){var t=wi,r=_i;t=(r&~(1<<32-Rs(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Rd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=DL++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},OL={readContext:hs,useCallback:V1,useContext:hs,useEffect:U_,useImperativeHandle:O1,useInsertionEffect:j1,useLayoutEffect:L1,useMemo:F1,useReducer:Ry,useRef:P1,useState:function(){return Ry(kd)},useDebugValue:$_,useDeferredValue:function(n){var e=fs();return U1(e,Dn.memoizedState,n)},useTransition:function(){var n=Ry(kd)[0],e=fs().memoizedState;return[n,e]},useMutableSource:T1,useSyncExternalStore:A1,useId:$1,unstable_isNewReconciler:!1},VL={readContext:hs,useCallback:V1,useContext:hs,useEffect:U_,useImperativeHandle:O1,useInsertionEffect:j1,useLayoutEffect:L1,useMemo:F1,useReducer:ky,useRef:P1,useState:function(){return ky(kd)},useDebugValue:$_,useDeferredValue:function(n){var e=fs();return Dn===null?e.memoizedState=n:U1(e,Dn.memoizedState,n)},useTransition:function(){var n=ky(kd)[0],e=fs().memoizedState;return[n,e]},useMutableSource:T1,useSyncExternalStore:A1,useId:$1,unstable_isNewReconciler:!1};function xs(n,e){if(n&&n.defaultProps){e=hn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function qv(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:hn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var $g={isMounted:function(n){return(n=n._reactInternals)?el(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=xr(),s=Eo(n),i=Ti(r,s);i.payload=e,t!=null&&(i.callback=t),e=Io(n,i,s),e!==null&&(ks(e,n,s,r),Gf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=xr(),s=Eo(n),i=Ti(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Io(n,i,s),e!==null&&(ks(e,n,s,r),Gf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=xr(),r=Eo(n),s=Ti(t,r);s.tag=2,e!=null&&(s.callback=e),e=Io(n,s,r),e!==null&&(ks(e,n,r,t),Gf(e,n,r))}};function MI(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!bd(t,r)||!bd(s,i):!0}function W1(n,e,t){var r=!1,s=jo,i=e.contextType;return typeof i=="object"&&i!==null?i=hs(i):(s=kr(e)?ka:vr.current,r=e.contextTypes,i=(r=r!=null)?oc(n,s):jo),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$g,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function OI(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&$g.enqueueReplaceState(e,e.state,null)}function Wv(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},P_(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=hs(i):(i=kr(e)?ka:vr.current,s.context=oc(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(qv(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&$g.enqueueReplaceState(s,s.state,null),jm(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function uc(n,e){try{var t="",r=e;do t+=hj(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function Dy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Gv(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var FL=typeof WeakMap=="function"?WeakMap:Map;function G1(n,e,t){t=Ti(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Fm||(Fm=!0,n0=r),Gv(n,e)},t}function H1(n,e,t){t=Ti(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){Gv(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Gv(n,e),typeof r!="function"&&(bo===null?bo=new Set([this]):bo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function VI(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new FL;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=ZL.bind(null,n,e,t),e.then(n,n))}function FI(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function UI(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Ti(-1,1),e.tag=2,Io(t,e,1))),t.lanes|=1),n)}var UL=Fi.ReactCurrentOwner,Tr=!1;function _r(n,e,t,r){e.child=n===null?S1(e,null,t,r):lc(e,n.child,t,r)}function $I(n,e,t,r,s){t=t.render;var i=e.ref;return Ql(e,s),r=V_(n,e,t,r,i,s),t=F_(),n!==null&&!Tr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ki(n,e,s)):(nn&&t&&T_(e),e.flags|=1,_r(n,e,r,s),e.child)}function BI(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!K_(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Q1(n,e,i,r,s)):(n=Xf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:bd,t(o,r)&&n.ref===e.ref)return ki(n,e,s)}return e.flags|=1,n=To(i,r),n.ref=e.ref,n.return=e,e.child=n}function Q1(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(bd(i,r)&&n.ref===e.ref)if(Tr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Tr=!0);else return e.lanes=n.lanes,ki(n,e,s)}return Hv(n,e,t,r,s)}function K1(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Bt(zl,Fr),Fr|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Bt(zl,Fr),Fr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Bt(zl,Fr),Fr|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Bt(zl,Fr),Fr|=r;return _r(n,e,s,t),e.child}function Y1(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Hv(n,e,t,r,s){var i=kr(t)?ka:vr.current;return i=oc(e,i),Ql(e,s),t=V_(n,e,t,r,i,s),r=F_(),n!==null&&!Tr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ki(n,e,s)):(nn&&r&&T_(e),e.flags|=1,_r(n,e,t,s),e.child)}function zI(n,e,t,r,s){if(kr(t)){var i=!0;Cm(e)}else i=!1;if(Ql(e,s),e.stateNode===null)Kf(n,e),W1(e,t,r),Wv(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=hs(u):(u=kr(t)?ka:vr.current,u=oc(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==u)&&OI(e,o,r,u),ro=!1;var m=e.memoizedState;o.state=m,jm(e,r,o,s),c=e.memoizedState,a!==r||m!==c||Rr.current||ro?(typeof h=="function"&&(qv(e,t,h,r),c=e.memoizedState),(a=ro||MI(e,t,a,r,m,c,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,b1(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:xs(e.type,a),o.props=u,f=e.pendingProps,m=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=hs(c):(c=kr(t)?ka:vr.current,c=oc(e,c));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||m!==c)&&OI(e,o,r,c),ro=!1,m=e.memoizedState,o.state=m,jm(e,r,o,s);var w=e.memoizedState;a!==f||m!==w||Rr.current||ro?(typeof y=="function"&&(qv(e,t,y,r),w=e.memoizedState),(u=ro||MI(e,t,u,r,m,w,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,w,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,w,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),o.props=r,o.state=w,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),r=!1)}return Qv(n,e,t,r,i,s)}function Qv(n,e,t,r,s,i){Y1(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&NI(e,t,!1),ki(n,e,i);r=e.stateNode,UL.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=lc(e,n.child,null,i),e.child=lc(e,null,a,i)):_r(n,e,a,i),e.memoizedState=r.state,s&&NI(e,t,!0),e.child}function J1(n){var e=n.stateNode;e.pendingContext?AI(n,e.pendingContext,e.pendingContext!==e.context):e.context&&AI(n,e.context,!1),j_(n,e.containerInfo)}function qI(n,e,t,r,s){return ac(),N_(s),e.flags|=256,_r(n,e,t,r),e.child}var Kv={dehydrated:null,treeContext:null,retryLane:0};function Yv(n){return{baseLanes:n,cachePool:null,transitions:null}}function X1(n,e,t){var r=e.pendingProps,s=cn.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Bt(cn,s&1),n===null)return Bv(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=qg(o,r,0,null),n=Ea(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Yv(t),e.memoizedState=Kv,n):B_(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return $L(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=To(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=To(a,i):(i=Ea(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?Yv(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=Kv,r}return i=n.child,n=i.sibling,r=To(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function B_(n,e){return e=qg({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function _f(n,e,t,r){return r!==null&&N_(r),lc(e,n.child,null,t),n=B_(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function $L(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=Dy(Error(ee(422))),_f(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=qg({mode:"visible",children:r.children},s,0,null),i=Ea(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&lc(e,n.child,null,o),e.child.memoizedState=Yv(o),e.memoizedState=Kv,i);if(!(e.mode&1))return _f(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(ee(419)),r=Dy(i,r,void 0),_f(n,e,o,r)}if(a=(o&n.childLanes)!==0,Tr||a){if(r=qn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ri(n,s),ks(r,n,s,-1))}return Q_(),r=Dy(Error(ee(421))),_f(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=eM.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,qr=So(s.nextSibling),Wr=e,nn=!0,Es=null,n!==null&&(is[os++]=_i,is[os++]=wi,is[os++]=Da,_i=n.id,wi=n.overflow,Da=e),e=B_(e,r.children),e.flags|=4096,e)}function WI(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),zv(n.return,e,t)}function Py(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function Z1(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(_r(n,e,r.children,t),r=cn.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&WI(n,t,e);else if(n.tag===19)WI(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Bt(cn,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Lm(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Py(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Lm(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Py(e,!0,t,null,i);break;case"together":Py(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Kf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ki(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ja|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ee(153));if(e.child!==null){for(n=e.child,t=To(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=To(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function BL(n,e,t){switch(e.tag){case 3:J1(e),ac();break;case 5:E1(e);break;case 1:kr(e.type)&&Cm(e);break;case 4:j_(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Bt(Dm,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Bt(cn,cn.current&1),e.flags|=128,null):t&e.child.childLanes?X1(n,e,t):(Bt(cn,cn.current&1),n=ki(n,e,t),n!==null?n.sibling:null);Bt(cn,cn.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Z1(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Bt(cn,cn.current),r)break;return null;case 22:case 23:return e.lanes=0,K1(n,e,t)}return ki(n,e,t)}var eN,Jv,tN,nN;eN=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Jv=function(){};tN=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,_a(ti.current);var i=null;switch(t){case"input":s=_v(n,s),r=_v(n,r),i=[];break;case"select":s=hn({},s,{value:void 0}),r=hn({},r,{value:void 0}),i=[];break;case"textarea":s=Sv(n,s),r=Sv(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Am)}bv(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(yd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(i||(i=[]),i.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(yd.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Ht("scroll",n),i||a===c||(i=[])):(i=i||[]).push(u,c))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};nN=function(n,e,t,r){t!==r&&(e.flags|=4)};function yu(n,e){if(!nn)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function dr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function zL(n,e,t){var r=e.pendingProps;switch(A_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dr(e),null;case 1:return kr(e.type)&&Nm(),dr(e),null;case 3:return r=e.stateNode,cc(),Kt(Rr),Kt(vr),M_(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(yf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Es!==null&&(i0(Es),Es=null))),Jv(n,e),dr(e),null;case 5:L_(e);var s=_a(Cd.current);if(t=e.type,n!==null&&e.stateNode!=null)tN(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ee(166));return dr(e),null}if(n=_a(ti.current),yf(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Hs]=e,r[Ad]=i,n=(e.mode&1)!==0,t){case"dialog":Ht("cancel",r),Ht("close",r);break;case"iframe":case"object":case"embed":Ht("load",r);break;case"video":case"audio":for(s=0;s<Pu.length;s++)Ht(Pu[s],r);break;case"source":Ht("error",r);break;case"img":case"image":case"link":Ht("error",r),Ht("load",r);break;case"details":Ht("toggle",r);break;case"input":eI(r,i),Ht("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ht("invalid",r);break;case"textarea":nI(r,i),Ht("invalid",r)}bv(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&pf(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&pf(r.textContent,a,n),s=["children",""+a]):yd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ht("scroll",r)}switch(t){case"input":lf(r),tI(r,i,!0);break;case"textarea":lf(r),rI(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Am)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=RA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Hs]=e,n[Ad]=r,eN(n,e,!1,!1),e.stateNode=n;e:{switch(o=Ev(t,r),t){case"dialog":Ht("cancel",n),Ht("close",n),s=r;break;case"iframe":case"object":case"embed":Ht("load",n),s=r;break;case"video":case"audio":for(s=0;s<Pu.length;s++)Ht(Pu[s],n);s=r;break;case"source":Ht("error",n),s=r;break;case"img":case"image":case"link":Ht("error",n),Ht("load",n),s=r;break;case"details":Ht("toggle",n),s=r;break;case"input":eI(n,r),s=_v(n,r),Ht("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=hn({},r,{value:void 0}),Ht("invalid",n);break;case"textarea":nI(n,r),s=Sv(n,r),Ht("invalid",n);break;default:s=r}bv(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?PA(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&kA(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&vd(n,c):typeof c=="number"&&vd(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(yd.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Ht("scroll",n):c!=null&&h_(n,i,c,o))}switch(t){case"input":lf(n),tI(n,r,!1);break;case"textarea":lf(n),rI(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Po(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?ql(n,!!r.multiple,i,!1):r.defaultValue!=null&&ql(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Am)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return dr(e),null;case 6:if(n&&e.stateNode!=null)nN(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ee(166));if(t=_a(Cd.current),_a(ti.current),yf(e)){if(r=e.stateNode,t=e.memoizedProps,r[Hs]=e,(i=r.nodeValue!==t)&&(n=Wr,n!==null))switch(n.tag){case 3:pf(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&pf(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Hs]=e,e.stateNode=r}return dr(e),null;case 13:if(Kt(cn),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(nn&&qr!==null&&e.mode&1&&!(e.flags&128))w1(),ac(),e.flags|=98560,i=!1;else if(i=yf(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(ee(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ee(317));i[Hs]=e}else ac(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;dr(e),i=!1}else Es!==null&&(i0(Es),Es=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||cn.current&1?jn===0&&(jn=3):Q_())),e.updateQueue!==null&&(e.flags|=4),dr(e),null);case 4:return cc(),Jv(n,e),n===null&&Ed(e.stateNode.containerInfo),dr(e),null;case 10:return k_(e.type._context),dr(e),null;case 17:return kr(e.type)&&Nm(),dr(e),null;case 19:if(Kt(cn),i=e.memoizedState,i===null)return dr(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)yu(i,!1);else{if(jn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Lm(n),o!==null){for(e.flags|=128,yu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Bt(cn,cn.current&1|2),e.child}n=n.sibling}i.tail!==null&&wn()>dc&&(e.flags|=128,r=!0,yu(i,!1),e.lanes=4194304)}else{if(!r)if(n=Lm(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),yu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!nn)return dr(e),null}else 2*wn()-i.renderingStartTime>dc&&t!==1073741824&&(e.flags|=128,r=!0,yu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=wn(),e.sibling=null,t=cn.current,Bt(cn,r?t&1|2:t&1),e):(dr(e),null);case 22:case 23:return H_(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Fr&1073741824&&(dr(e),e.subtreeFlags&6&&(e.flags|=8192)):dr(e),null;case 24:return null;case 25:return null}throw Error(ee(156,e.tag))}function qL(n,e){switch(A_(e),e.tag){case 1:return kr(e.type)&&Nm(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return cc(),Kt(Rr),Kt(vr),M_(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return L_(e),null;case 13:if(Kt(cn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ee(340));ac()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Kt(cn),null;case 4:return cc(),null;case 10:return k_(e.type._context),null;case 22:case 23:return H_(),null;case 24:return null;default:return null}}var wf=!1,mr=!1,WL=typeof WeakSet=="function"?WeakSet:Set,xe=null;function Bl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){yn(n,e,r)}else t.current=null}function Xv(n,e,t){try{t()}catch(r){yn(n,e,r)}}var GI=!1;function GL(n,e){if(Lv=bm,n=a1(),E_(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,u=0,h=0,f=n,m=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(c=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)m=f,f=y;for(;;){if(f===n)break t;if(m===t&&++u===s&&(a=o),m===i&&++h===r&&(c=o),(y=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=y}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(Mv={focusedElem:n,selectionRange:t},bm=!1,xe=e;xe!==null;)if(e=xe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,xe=n;else for(;xe!==null;){e=xe;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var S=w.memoizedProps,k=w.memoizedState,I=e.stateNode,x=I.getSnapshotBeforeUpdate(e.elementType===e.type?S:xs(e.type,S),k);I.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(D){yn(e,e.return,D)}if(n=e.sibling,n!==null){n.return=e.return,xe=n;break}xe=e.return}return w=GI,GI=!1,w}function Qu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Xv(e,t,i)}s=s.next}while(s!==r)}}function Bg(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Zv(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function rN(n){var e=n.alternate;e!==null&&(n.alternate=null,rN(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Hs],delete e[Ad],delete e[Fv],delete e[NL],delete e[CL])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function sN(n){return n.tag===5||n.tag===3||n.tag===4}function HI(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||sN(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function e0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Am));else if(r!==4&&(n=n.child,n!==null))for(e0(n,e,t),n=n.sibling;n!==null;)e0(n,e,t),n=n.sibling}function t0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(t0(n,e,t),n=n.sibling;n!==null;)t0(n,e,t),n=n.sibling}var Zn=null,Is=!1;function Ji(n,e,t){for(t=t.child;t!==null;)iN(n,e,t),t=t.sibling}function iN(n,e,t){if(ei&&typeof ei.onCommitFiberUnmount=="function")try{ei.onCommitFiberUnmount(jg,t)}catch{}switch(t.tag){case 5:mr||Bl(t,e);case 6:var r=Zn,s=Is;Zn=null,Ji(n,e,t),Zn=r,Is=s,Zn!==null&&(Is?(n=Zn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Zn.removeChild(t.stateNode));break;case 18:Zn!==null&&(Is?(n=Zn,t=t.stateNode,n.nodeType===8?Ty(n.parentNode,t):n.nodeType===1&&Ty(n,t),Sd(n)):Ty(Zn,t.stateNode));break;case 4:r=Zn,s=Is,Zn=t.stateNode.containerInfo,Is=!0,Ji(n,e,t),Zn=r,Is=s;break;case 0:case 11:case 14:case 15:if(!mr&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Xv(t,e,o),s=s.next}while(s!==r)}Ji(n,e,t);break;case 1:if(!mr&&(Bl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){yn(t,e,a)}Ji(n,e,t);break;case 21:Ji(n,e,t);break;case 22:t.mode&1?(mr=(r=mr)||t.memoizedState!==null,Ji(n,e,t),mr=r):Ji(n,e,t);break;default:Ji(n,e,t)}}function QI(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new WL),e.forEach(function(r){var s=tM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function ws(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Zn=a.stateNode,Is=!1;break e;case 3:Zn=a.stateNode.containerInfo,Is=!0;break e;case 4:Zn=a.stateNode.containerInfo,Is=!0;break e}a=a.return}if(Zn===null)throw Error(ee(160));iN(i,o,s),Zn=null,Is=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){yn(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oN(e,n),e=e.sibling}function oN(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ws(e,n),$s(n),r&4){try{Qu(3,n,n.return),Bg(3,n)}catch(S){yn(n,n.return,S)}try{Qu(5,n,n.return)}catch(S){yn(n,n.return,S)}}break;case 1:ws(e,n),$s(n),r&512&&t!==null&&Bl(t,t.return);break;case 5:if(ws(e,n),$s(n),r&512&&t!==null&&Bl(t,t.return),n.flags&32){var s=n.stateNode;try{vd(s,"")}catch(S){yn(n,n.return,S)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&NA(s,i),Ev(a,o);var u=Ev(a,i);for(o=0;o<c.length;o+=2){var h=c[o],f=c[o+1];h==="style"?PA(s,f):h==="dangerouslySetInnerHTML"?kA(s,f):h==="children"?vd(s,f):h_(s,h,f,u)}switch(a){case"input":wv(s,i);break;case"textarea":CA(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?ql(s,!!i.multiple,y,!1):m!==!!i.multiple&&(i.defaultValue!=null?ql(s,!!i.multiple,i.defaultValue,!0):ql(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ad]=i}catch(S){yn(n,n.return,S)}}break;case 6:if(ws(e,n),$s(n),r&4){if(n.stateNode===null)throw Error(ee(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(S){yn(n,n.return,S)}}break;case 3:if(ws(e,n),$s(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Sd(e.containerInfo)}catch(S){yn(n,n.return,S)}break;case 4:ws(e,n),$s(n);break;case 13:ws(e,n),$s(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(W_=wn())),r&4&&QI(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(mr=(u=mr)||h,ws(e,n),mr=u):ws(e,n),$s(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(xe=n,h=n.child;h!==null;){for(f=xe=h;xe!==null;){switch(m=xe,y=m.child,m.tag){case 0:case 11:case 14:case 15:Qu(4,m,m.return);break;case 1:Bl(m,m.return);var w=m.stateNode;if(typeof w.componentWillUnmount=="function"){r=m,t=m.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(S){yn(r,t,S)}}break;case 5:Bl(m,m.return);break;case 22:if(m.memoizedState!==null){YI(f);continue}}y!==null?(y.return=m,xe=y):YI(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=DA("display",o))}catch(S){yn(n,n.return,S)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(S){yn(n,n.return,S)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ws(e,n),$s(n),r&4&&QI(n);break;case 21:break;default:ws(e,n),$s(n)}}function $s(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(sN(t)){var r=t;break e}t=t.return}throw Error(ee(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(vd(s,""),r.flags&=-33);var i=HI(n);t0(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=HI(n);e0(n,a,o);break;default:throw Error(ee(161))}}catch(c){yn(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function HL(n,e,t){xe=n,aN(n)}function aN(n,e,t){for(var r=(n.mode&1)!==0;xe!==null;){var s=xe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||wf;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||mr;a=wf;var u=mr;if(wf=o,(mr=c)&&!u)for(xe=s;xe!==null;)o=xe,c=o.child,o.tag===22&&o.memoizedState!==null?JI(s):c!==null?(c.return=o,xe=c):JI(s);for(;i!==null;)xe=i,aN(i),i=i.sibling;xe=s,wf=a,mr=u}KI(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,xe=i):KI(n)}}function KI(n){for(;xe!==null;){var e=xe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:mr||Bg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!mr)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:xs(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&PI(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}PI(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Sd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}mr||e.flags&512&&Zv(e)}catch(m){yn(e,e.return,m)}}if(e===n){xe=null;break}if(t=e.sibling,t!==null){t.return=e.return,xe=t;break}xe=e.return}}function YI(n){for(;xe!==null;){var e=xe;if(e===n){xe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,xe=t;break}xe=e.return}}function JI(n){for(;xe!==null;){var e=xe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Bg(4,e)}catch(c){yn(e,t,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){yn(e,s,c)}}var i=e.return;try{Zv(e)}catch(c){yn(e,i,c)}break;case 5:var o=e.return;try{Zv(e)}catch(c){yn(e,o,c)}}}catch(c){yn(e,e.return,c)}if(e===n){xe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,xe=a;break}xe=e.return}}var QL=Math.ceil,Vm=Fi.ReactCurrentDispatcher,z_=Fi.ReactCurrentOwner,us=Fi.ReactCurrentBatchConfig,yt=0,qn=null,An=null,rr=0,Fr=0,zl=Qo(0),jn=0,Pd=null,ja=0,zg=0,q_=0,Ku=null,Er=null,W_=0,dc=1/0,pi=null,Fm=!1,n0=null,bo=null,xf=!1,fo=null,Um=0,Yu=0,r0=null,Yf=-1,Jf=0;function xr(){return yt&6?wn():Yf!==-1?Yf:Yf=wn()}function Eo(n){return n.mode&1?yt&2&&rr!==0?rr&-rr:kL.transition!==null?(Jf===0&&(Jf=WA()),Jf):(n=Pt,n!==0||(n=window.event,n=n===void 0?16:XA(n.type)),n):1}function ks(n,e,t,r){if(50<Yu)throw Yu=0,r0=null,Error(ee(185));dh(n,t,r),(!(yt&2)||n!==qn)&&(n===qn&&(!(yt&2)&&(zg|=t),jn===4&&io(n,rr)),Dr(n,r),t===1&&yt===0&&!(e.mode&1)&&(dc=wn()+500,Fg&&Ko()))}function Dr(n,e){var t=n.callbackNode;kj(n,e);var r=Im(n,n===qn?rr:0);if(r===0)t!==null&&oI(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&oI(t),e===1)n.tag===0?RL(XI.bind(null,n)):y1(XI.bind(null,n)),TL(function(){!(yt&6)&&Ko()}),t=null;else{switch(GA(r)){case 1:t=y_;break;case 4:t=zA;break;case 16:t=Sm;break;case 536870912:t=qA;break;default:t=Sm}t=gN(t,lN.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function lN(n,e){if(Yf=-1,Jf=0,yt&6)throw Error(ee(327));var t=n.callbackNode;if(Kl()&&n.callbackNode!==t)return null;var r=Im(n,n===qn?rr:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=$m(n,r);else{e=r;var s=yt;yt|=2;var i=uN();(qn!==n||rr!==e)&&(pi=null,dc=wn()+500,ba(n,e));do try{JL();break}catch(a){cN(n,a)}while(1);R_(),Vm.current=i,yt=s,An!==null?e=0:(qn=null,rr=0,e=jn)}if(e!==0){if(e===2&&(s=Rv(n),s!==0&&(r=s,e=s0(n,s))),e===1)throw t=Pd,ba(n,0),io(n,r),Dr(n,wn()),t;if(e===6)io(n,r);else{if(s=n.current.alternate,!(r&30)&&!KL(s)&&(e=$m(n,r),e===2&&(i=Rv(n),i!==0&&(r=i,e=s0(n,i))),e===1))throw t=Pd,ba(n,0),io(n,r),Dr(n,wn()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(ee(345));case 2:la(n,Er,pi);break;case 3:if(io(n,r),(r&130023424)===r&&(e=W_+500-wn(),10<e)){if(Im(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){xr(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Vv(la.bind(null,n,Er,pi),e);break}la(n,Er,pi);break;case 4:if(io(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-Rs(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=wn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*QL(r/1960))-r,10<r){n.timeoutHandle=Vv(la.bind(null,n,Er,pi),r);break}la(n,Er,pi);break;case 5:la(n,Er,pi);break;default:throw Error(ee(329))}}}return Dr(n,wn()),n.callbackNode===t?lN.bind(null,n):null}function s0(n,e){var t=Ku;return n.current.memoizedState.isDehydrated&&(ba(n,e).flags|=256),n=$m(n,e),n!==2&&(e=Er,Er=t,e!==null&&i0(e)),n}function i0(n){Er===null?Er=n:Er.push.apply(Er,n)}function KL(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Ls(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function io(n,e){for(e&=~q_,e&=~zg,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Rs(e),r=1<<t;n[t]=-1,e&=~r}}function XI(n){if(yt&6)throw Error(ee(327));Kl();var e=Im(n,0);if(!(e&1))return Dr(n,wn()),null;var t=$m(n,e);if(n.tag!==0&&t===2){var r=Rv(n);r!==0&&(e=r,t=s0(n,r))}if(t===1)throw t=Pd,ba(n,0),io(n,e),Dr(n,wn()),t;if(t===6)throw Error(ee(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,la(n,Er,pi),Dr(n,wn()),null}function G_(n,e){var t=yt;yt|=1;try{return n(e)}finally{yt=t,yt===0&&(dc=wn()+500,Fg&&Ko())}}function La(n){fo!==null&&fo.tag===0&&!(yt&6)&&Kl();var e=yt;yt|=1;var t=us.transition,r=Pt;try{if(us.transition=null,Pt=1,n)return n()}finally{Pt=r,us.transition=t,yt=e,!(yt&6)&&Ko()}}function H_(){Fr=zl.current,Kt(zl)}function ba(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,EL(t)),An!==null)for(t=An.return;t!==null;){var r=t;switch(A_(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Nm();break;case 3:cc(),Kt(Rr),Kt(vr),M_();break;case 5:L_(r);break;case 4:cc();break;case 13:Kt(cn);break;case 19:Kt(cn);break;case 10:k_(r.type._context);break;case 22:case 23:H_()}t=t.return}if(qn=n,An=n=To(n.current,null),rr=Fr=e,jn=0,Pd=null,q_=zg=ja=0,Er=Ku=null,va!==null){for(e=0;e<va.length;e++)if(t=va[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}va=null}return n}function cN(n,e){do{var t=An;try{if(R_(),Hf.current=Om,Mm){for(var r=dn.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Mm=!1}if(Pa=0,$n=Dn=dn=null,Hu=!1,Rd=0,z_.current=null,t===null||t.return===null){jn=1,Pd=e,An=null;break}e:{var i=n,o=t.return,a=t,c=e;if(e=rr,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=FI(o);if(y!==null){y.flags&=-257,UI(y,o,a,i,e),y.mode&1&&VI(i,u,e),e=y,c=u;var w=e.updateQueue;if(w===null){var S=new Set;S.add(c),e.updateQueue=S}else w.add(c);break e}else{if(!(e&1)){VI(i,u,e),Q_();break e}c=Error(ee(426))}}else if(nn&&a.mode&1){var k=FI(o);if(k!==null){!(k.flags&65536)&&(k.flags|=256),UI(k,o,a,i,e),N_(uc(c,a));break e}}i=c=uc(c,a),jn!==4&&(jn=2),Ku===null?Ku=[i]:Ku.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var I=G1(i,c,e);DI(i,I);break e;case 1:a=c;var x=i.type,C=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(bo===null||!bo.has(C)))){i.flags|=65536,e&=-e,i.lanes|=e;var D=H1(i,a,e);DI(i,D);break e}}i=i.return}while(i!==null)}hN(t)}catch(U){e=U,An===t&&t!==null&&(An=t=t.return);continue}break}while(1)}function uN(){var n=Vm.current;return Vm.current=Om,n===null?Om:n}function Q_(){(jn===0||jn===3||jn===2)&&(jn=4),qn===null||!(ja&268435455)&&!(zg&268435455)||io(qn,rr)}function $m(n,e){var t=yt;yt|=2;var r=uN();(qn!==n||rr!==e)&&(pi=null,ba(n,e));do try{YL();break}catch(s){cN(n,s)}while(1);if(R_(),yt=t,Vm.current=r,An!==null)throw Error(ee(261));return qn=null,rr=0,jn}function YL(){for(;An!==null;)dN(An)}function JL(){for(;An!==null&&!Sj();)dN(An)}function dN(n){var e=mN(n.alternate,n,Fr);n.memoizedProps=n.pendingProps,e===null?hN(n):An=e,z_.current=null}function hN(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=qL(t,e),t!==null){t.flags&=32767,An=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{jn=6,An=null;return}}else if(t=zL(t,e,Fr),t!==null){An=t;return}if(e=e.sibling,e!==null){An=e;return}An=e=n}while(e!==null);jn===0&&(jn=5)}function la(n,e,t){var r=Pt,s=us.transition;try{us.transition=null,Pt=1,XL(n,e,t,r)}finally{us.transition=s,Pt=r}return null}function XL(n,e,t,r){do Kl();while(fo!==null);if(yt&6)throw Error(ee(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ee(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(Dj(n,i),n===qn&&(An=qn=null,rr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||xf||(xf=!0,gN(Sm,function(){return Kl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=us.transition,us.transition=null;var o=Pt;Pt=1;var a=yt;yt|=4,z_.current=null,GL(n,t),oN(t,n),vL(Mv),bm=!!Lv,Mv=Lv=null,n.current=t,HL(t),Ij(),yt=a,Pt=o,us.transition=i}else n.current=t;if(xf&&(xf=!1,fo=n,Um=s),i=n.pendingLanes,i===0&&(bo=null),Tj(t.stateNode),Dr(n,wn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Fm)throw Fm=!1,n=n0,n0=null,n;return Um&1&&n.tag!==0&&Kl(),i=n.pendingLanes,i&1?n===r0?Yu++:(Yu=0,r0=n):Yu=0,Ko(),null}function Kl(){if(fo!==null){var n=GA(Um),e=us.transition,t=Pt;try{if(us.transition=null,Pt=16>n?16:n,fo===null)var r=!1;else{if(n=fo,fo=null,Um=0,yt&6)throw Error(ee(331));var s=yt;for(yt|=4,xe=n.current;xe!==null;){var i=xe,o=i.child;if(xe.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(xe=u;xe!==null;){var h=xe;switch(h.tag){case 0:case 11:case 15:Qu(8,h,i)}var f=h.child;if(f!==null)f.return=h,xe=f;else for(;xe!==null;){h=xe;var m=h.sibling,y=h.return;if(rN(h),h===u){xe=null;break}if(m!==null){m.return=y,xe=m;break}xe=y}}}var w=i.alternate;if(w!==null){var S=w.child;if(S!==null){w.child=null;do{var k=S.sibling;S.sibling=null,S=k}while(S!==null)}}xe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,xe=o;else e:for(;xe!==null;){if(i=xe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Qu(9,i,i.return)}var I=i.sibling;if(I!==null){I.return=i.return,xe=I;break e}xe=i.return}}var x=n.current;for(xe=x;xe!==null;){o=xe;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,xe=C;else e:for(o=x;xe!==null;){if(a=xe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Bg(9,a)}}catch(U){yn(a,a.return,U)}if(a===o){xe=null;break e}var D=a.sibling;if(D!==null){D.return=a.return,xe=D;break e}xe=a.return}}if(yt=s,Ko(),ei&&typeof ei.onPostCommitFiberRoot=="function")try{ei.onPostCommitFiberRoot(jg,n)}catch{}r=!0}return r}finally{Pt=t,us.transition=e}}return!1}function ZI(n,e,t){e=uc(t,e),e=G1(n,e,1),n=Io(n,e,1),e=xr(),n!==null&&(dh(n,1,e),Dr(n,e))}function yn(n,e,t){if(n.tag===3)ZI(n,n,t);else for(;e!==null;){if(e.tag===3){ZI(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(bo===null||!bo.has(r))){n=uc(t,n),n=H1(e,n,1),e=Io(e,n,1),n=xr(),e!==null&&(dh(e,1,n),Dr(e,n));break}}e=e.return}}function ZL(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=xr(),n.pingedLanes|=n.suspendedLanes&t,qn===n&&(rr&t)===t&&(jn===4||jn===3&&(rr&130023424)===rr&&500>wn()-W_?ba(n,0):q_|=t),Dr(n,e)}function fN(n,e){e===0&&(n.mode&1?(e=df,df<<=1,!(df&130023424)&&(df=4194304)):e=1);var t=xr();n=Ri(n,e),n!==null&&(dh(n,e,t),Dr(n,t))}function eM(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),fN(n,t)}function tM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(ee(314))}r!==null&&r.delete(e),fN(n,t)}var mN;mN=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Rr.current)Tr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Tr=!1,BL(n,e,t);Tr=!!(n.flags&131072)}else Tr=!1,nn&&e.flags&1048576&&v1(e,km,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Kf(n,e),n=e.pendingProps;var s=oc(e,vr.current);Ql(e,t),s=V_(null,e,r,n,s,t);var i=F_();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,kr(r)?(i=!0,Cm(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,P_(e),s.updater=$g,e.stateNode=s,s._reactInternals=e,Wv(e,r,n,t),e=Qv(null,e,r,!0,i,t)):(e.tag=0,nn&&i&&T_(e),_r(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Kf(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=rM(r),n=xs(r,n),s){case 0:e=Hv(null,e,r,n,t);break e;case 1:e=zI(null,e,r,n,t);break e;case 11:e=$I(null,e,r,n,t);break e;case 14:e=BI(null,e,r,xs(r.type,n),t);break e}throw Error(ee(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xs(r,s),Hv(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xs(r,s),zI(n,e,r,s,t);case 3:e:{if(J1(e),n===null)throw Error(ee(387));r=e.pendingProps,i=e.memoizedState,s=i.element,b1(n,e),jm(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=uc(Error(ee(423)),e),e=qI(n,e,r,t,s);break e}else if(r!==s){s=uc(Error(ee(424)),e),e=qI(n,e,r,t,s);break e}else for(qr=So(e.stateNode.containerInfo.firstChild),Wr=e,nn=!0,Es=null,t=S1(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ac(),r===s){e=ki(n,e,t);break e}_r(n,e,r,t)}e=e.child}return e;case 5:return E1(e),n===null&&Bv(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,Ov(r,s)?o=null:i!==null&&Ov(r,i)&&(e.flags|=32),Y1(n,e),_r(n,e,o,t),e.child;case 6:return n===null&&Bv(e),null;case 13:return X1(n,e,t);case 4:return j_(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=lc(e,null,r,t):_r(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xs(r,s),$I(n,e,r,s,t);case 7:return _r(n,e,e.pendingProps,t),e.child;case 8:return _r(n,e,e.pendingProps.children,t),e.child;case 12:return _r(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Bt(Dm,r._currentValue),r._currentValue=o,i!==null)if(Ls(i.value,o)){if(i.children===s.children&&!Rr.current){e=ki(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Ti(-1,t&-t),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),zv(i.return,t,e),a.lanes|=t;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ee(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),zv(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}_r(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ql(e,t),s=hs(s),r=r(s),e.flags|=1,_r(n,e,r,t),e.child;case 14:return r=e.type,s=xs(r,e.pendingProps),s=xs(r.type,s),BI(n,e,r,s,t);case 15:return Q1(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:xs(r,s),Kf(n,e),e.tag=1,kr(r)?(n=!0,Cm(e)):n=!1,Ql(e,t),W1(e,r,s),Wv(e,r,s,t),Qv(null,e,r,!0,n,t);case 19:return Z1(n,e,t);case 22:return K1(n,e,t)}throw Error(ee(156,e.tag))};function gN(n,e){return BA(n,e)}function nM(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ls(n,e,t,r){return new nM(n,e,t,r)}function K_(n){return n=n.prototype,!(!n||!n.isReactComponent)}function rM(n){if(typeof n=="function")return K_(n)?1:0;if(n!=null){if(n=n.$$typeof,n===m_)return 11;if(n===g_)return 14}return 2}function To(n,e){var t=n.alternate;return t===null?(t=ls(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Xf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")K_(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Pl:return Ea(t.children,s,i,e);case f_:o=8,s|=8;break;case gv:return n=ls(12,t,e,s|2),n.elementType=gv,n.lanes=i,n;case pv:return n=ls(13,t,e,s),n.elementType=pv,n.lanes=i,n;case yv:return n=ls(19,t,e,s),n.elementType=yv,n.lanes=i,n;case EA:return qg(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case IA:o=10;break e;case bA:o=9;break e;case m_:o=11;break e;case g_:o=14;break e;case no:o=16,r=null;break e}throw Error(ee(130,n==null?n:typeof n,""))}return e=ls(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Ea(n,e,t,r){return n=ls(7,n,r,e),n.lanes=t,n}function qg(n,e,t,r){return n=ls(22,n,r,e),n.elementType=EA,n.lanes=t,n.stateNode={isHidden:!1},n}function jy(n,e,t){return n=ls(6,n,null,e),n.lanes=t,n}function Ly(n,e,t){return e=ls(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function sM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gy(0),this.expirationTimes=gy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gy(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Y_(n,e,t,r,s,i,o,a,c){return n=new sM(n,e,t,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ls(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},P_(i),n}function iM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dl,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function pN(n){if(!n)return jo;n=n._reactInternals;e:{if(el(n)!==n||n.tag!==1)throw Error(ee(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(kr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ee(171))}if(n.tag===1){var t=n.type;if(kr(t))return p1(n,t,e)}return e}function yN(n,e,t,r,s,i,o,a,c){return n=Y_(t,r,!0,n,s,i,o,a,c),n.context=pN(null),t=n.current,r=xr(),s=Eo(t),i=Ti(r,s),i.callback=e??null,Io(t,i,s),n.current.lanes=s,dh(n,s,r),Dr(n,r),n}function Wg(n,e,t,r){var s=e.current,i=xr(),o=Eo(s);return t=pN(t),e.context===null?e.context=t:e.pendingContext=t,e=Ti(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Io(s,e,o),n!==null&&(ks(n,s,o,i),Gf(n,s,o)),o}function Bm(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function eb(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function J_(n,e){eb(n,e),(n=n.alternate)&&eb(n,e)}function oM(){return null}var vN=typeof reportError=="function"?reportError:function(n){console.error(n)};function X_(n){this._internalRoot=n}Gg.prototype.render=X_.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ee(409));Wg(n,e,null,null)};Gg.prototype.unmount=X_.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;La(function(){Wg(null,n,null,null)}),e[Ci]=null}};function Gg(n){this._internalRoot=n}Gg.prototype.unstable_scheduleHydration=function(n){if(n){var e=KA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<so.length&&e!==0&&e<so[t].priority;t++);so.splice(t,0,n),t===0&&JA(n)}};function Z_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Hg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function tb(){}function aM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Bm(o);i.call(u)}}var o=yN(e,r,n,0,null,!1,!1,"",tb);return n._reactRootContainer=o,n[Ci]=o.current,Ed(n.nodeType===8?n.parentNode:n),La(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Bm(c);a.call(u)}}var c=Y_(n,0,!1,null,null,!1,!1,"",tb);return n._reactRootContainer=c,n[Ci]=c.current,Ed(n.nodeType===8?n.parentNode:n),La(function(){Wg(e,c,t,r)}),c}function Qg(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=Bm(o);a.call(c)}}Wg(e,o,n,s)}else o=aM(t,e,n,s,r);return Bm(o)}HA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Du(e.pendingLanes);t!==0&&(v_(e,t|1),Dr(e,wn()),!(yt&6)&&(dc=wn()+500,Ko()))}break;case 13:La(function(){var r=Ri(n,1);if(r!==null){var s=xr();ks(r,n,1,s)}}),J_(n,1)}};__=function(n){if(n.tag===13){var e=Ri(n,134217728);if(e!==null){var t=xr();ks(e,n,134217728,t)}J_(n,134217728)}};QA=function(n){if(n.tag===13){var e=Eo(n),t=Ri(n,e);if(t!==null){var r=xr();ks(t,n,e,r)}J_(n,e)}};KA=function(){return Pt};YA=function(n,e){var t=Pt;try{return Pt=n,e()}finally{Pt=t}};Av=function(n,e,t){switch(e){case"input":if(wv(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Vg(r);if(!s)throw Error(ee(90));AA(r),wv(r,s)}}}break;case"textarea":CA(n,t);break;case"select":e=t.value,e!=null&&ql(n,!!t.multiple,e,!1)}};MA=G_;OA=La;var lM={usingClientEntryPoint:!1,Events:[fh,Ol,Vg,jA,LA,G_]},vu={findFiberByHostInstance:ya,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},cM={bundleType:vu.bundleType,version:vu.version,rendererPackageName:vu.rendererPackageName,rendererConfig:vu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=UA(n),n===null?null:n.stateNode},findFiberByHostInstance:vu.findFiberByHostInstance||oM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sf.isDisabled&&Sf.supportsFiber)try{jg=Sf.inject(cM),ei=Sf}catch{}}Zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lM;Zr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Z_(e))throw Error(ee(200));return iM(n,e,null,t)};Zr.createRoot=function(n,e){if(!Z_(n))throw Error(ee(299));var t=!1,r="",s=vN;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Y_(n,1,!1,null,null,t,!1,r,s),n[Ci]=e.current,Ed(n.nodeType===8?n.parentNode:n),new X_(e)};Zr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ee(188)):(n=Object.keys(n).join(","),Error(ee(268,n)));return n=UA(e),n=n===null?null:n.stateNode,n};Zr.flushSync=function(n){return La(n)};Zr.hydrate=function(n,e,t){if(!Hg(e))throw Error(ee(200));return Qg(null,n,e,!0,t)};Zr.hydrateRoot=function(n,e,t){if(!Z_(n))throw Error(ee(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=vN;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=yN(e,null,n,1,t??null,s,!1,i,o),n[Ci]=e.current,Ed(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Gg(e)};Zr.render=function(n,e,t){if(!Hg(e))throw Error(ee(200));return Qg(null,n,e,!1,t)};Zr.unmountComponentAtNode=function(n){if(!Hg(n))throw Error(ee(40));return n._reactRootContainer?(La(function(){Qg(null,null,n,!1,function(){n._reactRootContainer=null,n[Ci]=null})}),!0):!1};Zr.unstable_batchedUpdates=G_;Zr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Hg(t))throw Error(ee(200));if(n==null||n._reactInternals===void 0)throw Error(ee(38));return Qg(n,e,t,!1,r)};Zr.version="18.3.1-next-f1338f8080-20240426";function _N(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_N)}catch(n){console.error(n)}}_N(),_A.exports=Zr;var uM=_A.exports,nb=uM;fv.createRoot=nb.createRoot,fv.hydrateRoot=nb.hydrateRoot;const dM="modulepreload",hM=function(n){return"/"+n},rb={},Me=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=hM(i),i in rb)return;rb[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":dM,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},fM=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wN={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const re=function(n,e){if(!n)throw $c(e)},$c=function(n){return new Error("Firebase Database ("+wN.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xN=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},mM=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},ew={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,u=c?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|u>>6,y=u&63;c||(y=64,o||(m=64)),r.push(t[h],t[f],t[m],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(xN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):mM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new gM;const m=i<<2|a>>4;if(r.push(m),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const w=u<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class gM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const SN=function(n){const e=xN(n);return ew.encodeByteArray(e,!0)},zm=function(n){return SN(n).replace(/\./g,"")},qm=function(n){try{return ew.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pM(n){return IN(void 0,n)}function IN(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!yM(t)||(n[t]=IN(n[t],e[t]));return n}function yM(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vM=()=>bN().__FIREBASE_DEFAULTS__,_M=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},wM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&qm(n[1]);return e&&JSON.parse(e)},Kg=()=>{try{return fM()||vM()||_M()||wM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},EN=n=>{var e,t;return(t=(e=Kg())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},TN=n=>{const e=EN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},AN=()=>{var n;return(n=Kg())==null?void 0:n.config},NN=n=>{var e;return(e=Kg())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Yg(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[zm(JSON.stringify(t)),zm(JSON.stringify(o)),a].join(".")}const Ju={};function xM(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ju))Ju[e]?n.emulator.push(e):n.prod.push(e);return n}function SM(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let sb=!1;function tw(n,e){if(typeof window>"u"||typeof document>"u"||!Ui(window.location.host)||Ju[n]===e||Ju[n]||sb)return;Ju[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=xM().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,y){m.setAttribute("width","24"),m.setAttribute("id",y),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{sb=!0,o()},m}function h(m,y){m.setAttribute("id",y),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=SM(r),y=t("text"),w=document.getElementById(y)||document.createElement("span"),S=t("learnmore"),k=document.getElementById(S)||document.createElement("a"),I=t("preprendIcon"),x=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const C=m.element;a(C),h(k,S);const D=u();c(x,I),C.append(x,w,k,D),document.body.appendChild(C)}i?(w.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function nw(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ln())}function RN(){var e;const n=(e=Kg())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function IM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function rw(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function kN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function bM(){const n=Ln();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function DN(){return wN.NODE_ADMIN===!0}function PN(){return!RN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jN(){return!RN()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Jg(){try{return typeof indexedDB=="object"}catch{return!1}}function sw(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function LN(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EM="FirebaseError";class Os extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=EM,Object.setPrototypeOf(this,Os.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tl.prototype.create)}}class tl{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?TM(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Os(s,a,r)}}function TM(n,e){return n.replace(AM,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const AM=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jd(n){return JSON.parse(n)}function Pn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MN=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=jd(qm(i[0])||""),t=jd(qm(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},NM=function(n){const e=MN(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},CM=function(n){const e=MN(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vs(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ma(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Wm(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Gm(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Yr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(ib(i)&&ib(o)){if(!Yr(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function ib(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ju(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Lu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RM{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const m=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(m<<1|m>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const m=(s<<5|s>>>27)+u+c+h+r[f]&4294967295;c=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=m}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function kM(n,e){const t=new DM(n,e);return t.subscribe.bind(t)}class DM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");PM(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=My),s.error===void 0&&(s.error=My),s.complete===void 0&&(s.complete=My);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function PM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function My(){}function Oa(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jM=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,re(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Xg=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LM=1e3,MM=2,OM=4*60*60*1e3,VM=.5;function ob(n,e=LM,t=MM){const r=e*Math.pow(t,n),s=Math.round(VM*r*(Math.random()-.5)*2);return Math.min(OM,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(n){return n&&n._delegate?n._delegate:n}class Lr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ca="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Br;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(UM(e))try{this.getOrInitializeService({instanceIdentifier:ca})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ca){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ca){return this.instances.has(e)}getOptions(e=ca){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:FM(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ca){return this.component?this.component.multipleInstances?e:ca:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FM(n){return n===ca?void 0:n}function UM(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o0(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(lt||(lt={}));const $M={debug:lt.DEBUG,verbose:lt.VERBOSE,info:lt.INFO,warn:lt.WARN,error:lt.ERROR,silent:lt.SILENT},BM=lt.INFO,zM={[lt.DEBUG]:"log",[lt.VERBOSE]:"log",[lt.INFO]:"info",[lt.WARN]:"warn",[lt.ERROR]:"error"},qM=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=zM[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class gh{constructor(e){this.name=e,this._logLevel=BM,this._logHandler=qM,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in lt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$M[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,lt.DEBUG,...e),this._logHandler(this,lt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,lt.VERBOSE,...e),this._logHandler(this,lt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,lt.INFO,...e),this._logHandler(this,lt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,lt.WARN,...e),this._logHandler(this,lt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,lt.ERROR,...e),this._logHandler(this,lt.ERROR,...e)}}const WM=(n,e)=>e.some(t=>n instanceof t);let ab,lb;function GM(){return ab||(ab=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function HM(){return lb||(lb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const VN=new WeakMap,a0=new WeakMap,FN=new WeakMap,Oy=new WeakMap,iw=new WeakMap;function QM(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(ni(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&VN.set(t,n)}).catch(()=>{}),iw.set(e,n),e}function KM(n){if(a0.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});a0.set(n,e)}let l0={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return a0.get(n);if(e==="objectStoreNames")return n.objectStoreNames||FN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ni(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function YM(n){l0=n(l0)}function JM(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Zf(this),e,...t);return FN.set(r,e.sort?e.sort():[e]),ni(r)}:HM().includes(n)?function(...e){return n.apply(Zf(this),e),ni(VN.get(this))}:function(...e){return ni(n.apply(Zf(this),e))}}function XM(n){return typeof n=="function"?JM(n):(n instanceof IDBTransaction&&KM(n),WM(n,GM())?new Proxy(n,l0):n)}function ni(n){if(n instanceof IDBRequest)return QM(n);if(Oy.has(n))return Oy.get(n);const e=XM(n);return e!==n&&(Oy.set(n,e),iw.set(e,n)),e}const Zf=n=>iw.get(n);function ow(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=ni(o);return r&&o.addEventListener("upgradeneeded",c=>{r(ni(o.result),c.oldVersion,c.newVersion,ni(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}function ZM(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),ni(t).then(()=>{})}const eO=["get","getKey","getAll","getAllKeys","count"],tO=["put","add","delete","clear"],Vy=new Map;function cb(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Vy.get(e))return Vy.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=tO.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||eO.includes(t)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&c.done]))[0]};return Vy.set(e,i),i}YM(n=>({...n,get:(e,t,r)=>cb(e,t)||n.get(e,t,r),has:(e,t)=>!!cb(e,t)||n.has(e,t)}));const N8=Object.freeze(Object.defineProperty({__proto__:null,deleteDB:ZM,openDB:ow,unwrap:Zf,wrap:ni},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(rO(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function rO(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const c0="@firebase/app",ub="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Di=new gh("@firebase/app"),sO="@firebase/app-compat",iO="@firebase/analytics-compat",oO="@firebase/analytics",aO="@firebase/app-check-compat",lO="@firebase/app-check",cO="@firebase/auth",uO="@firebase/auth-compat",dO="@firebase/database",hO="@firebase/data-connect",fO="@firebase/database-compat",mO="@firebase/functions",gO="@firebase/functions-compat",pO="@firebase/installations",yO="@firebase/installations-compat",vO="@firebase/messaging",_O="@firebase/messaging-compat",wO="@firebase/performance",xO="@firebase/performance-compat",SO="@firebase/remote-config",IO="@firebase/remote-config-compat",bO="@firebase/storage",EO="@firebase/storage-compat",TO="@firebase/firestore",AO="@firebase/ai",NO="@firebase/firestore-compat",CO="firebase",RO="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hm="[DEFAULT]",kO={[c0]:"fire-core",[sO]:"fire-core-compat",[oO]:"fire-analytics",[iO]:"fire-analytics-compat",[lO]:"fire-app-check",[aO]:"fire-app-check-compat",[cO]:"fire-auth",[uO]:"fire-auth-compat",[dO]:"fire-rtdb",[hO]:"fire-data-connect",[fO]:"fire-rtdb-compat",[mO]:"fire-fn",[gO]:"fire-fn-compat",[pO]:"fire-iid",[yO]:"fire-iid-compat",[vO]:"fire-fcm",[_O]:"fire-fcm-compat",[wO]:"fire-perf",[xO]:"fire-perf-compat",[SO]:"fire-rc",[IO]:"fire-rc-compat",[bO]:"fire-gcs",[EO]:"fire-gcs-compat",[TO]:"fire-fst",[NO]:"fire-fst-compat",[AO]:"fire-vertex","fire-js":"fire-js",[CO]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld=new Map,DO=new Map,u0=new Map;function db(n,e){try{n.container.addComponent(e)}catch(t){Di.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ms(n){const e=n.name;if(u0.has(e))return Di.debug(`There were multiple attempts to register component ${e}.`),!1;u0.set(e,n);for(const t of Ld.values())db(t,n);for(const t of DO.values())db(t,n);return!0}function hi(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function PO(n,e,t=Hm){hi(n,e).clearInstance(t)}function rn(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jO={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ao=new tl("app","Firebase",jO);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LO{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Lr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ao.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl=RO;function UN(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Hm,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Ao.create("bad-app-name",{appName:String(s)});if(t||(t=AN()),!t)throw Ao.create("no-options");const i=Ld.get(s);if(i){if(Yr(t,i.options)&&Yr(r,i.config))return i;throw Ao.create("duplicate-app",{appName:s})}const o=new ON(s);for(const c of u0.values())o.addComponent(c);const a=new LO(t,r,o);return Ld.set(s,a),a}function ph(n=Hm){const e=Ld.get(n);if(!e&&n===Hm&&AN())return UN();if(!e)throw Ao.create("no-app",{appName:n});return e}function MO(){return Array.from(Ld.values())}function Pr(n,e,t){let r=kO[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Di.warn(o.join(" "));return}Ms(new Lr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OO="firebase-heartbeat-database",VO=1,Md="firebase-heartbeat-store";let Fy=null;function $N(){return Fy||(Fy=ow(OO,VO,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Md)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ao.create("idb-open",{originalErrorMessage:n.message})})),Fy}async function FO(n){try{const t=(await $N()).transaction(Md),r=await t.objectStore(Md).get(BN(n));return await t.done,r}catch(e){if(e instanceof Os)Di.warn(e.message);else{const t=Ao.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Di.warn(t.message)}}}async function hb(n,e){try{const r=(await $N()).transaction(Md,"readwrite");await r.objectStore(Md).put(e,BN(n)),await r.done}catch(t){if(t instanceof Os)Di.warn(t.message);else{const r=Ao.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Di.warn(r.message)}}}function BN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UO=1024,$O=30;class BO{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new qO(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=fb();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>$O){const o=WO(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Di.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=fb(),{heartbeatsToSend:r,unsentEntries:s}=zO(this._heartbeatsCache.heartbeats),i=zm(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Di.warn(t),""}}}function fb(){return new Date().toISOString().substring(0,10)}function zO(n,e=UO){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),mb(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),mb(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class qO{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Jg()?sw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await FO(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return hb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return hb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function mb(n){return zm(JSON.stringify({version:2,heartbeats:n})).length}function WO(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GO(n){Ms(new Lr("platform-logger",e=>new nO(e),"PRIVATE")),Ms(new Lr("heartbeat",e=>new BO(e),"PRIVATE")),Pr(c0,ub,n),Pr(c0,ub,"esm2020"),Pr("fire-js","")}GO("");var HO="firebase",QO="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pr(HO,QO,"app");const gb="@firebase/database",pb="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zN="";function qN(n){zN=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Pn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:jd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YO{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Vs(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WN=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new KO(e)}}catch{}return new YO},wa=WN("localStorage"),d0=WN("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yl=new gh("@firebase/database"),GN=function(){let n=1;return function(){return n++}}(),HN=function(n){const e=jM(n),t=new RM;t.update(e);const r=t.digest();return ew.encodeByteArray(r)},yh=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=yh.apply(null,r):typeof r=="object"?e+=Pn(r):e+=r,e+=" "}return e};let Ta=null,yb=!0;const QN=function(n,e){re(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Yl.logLevel=lt.VERBOSE,Ta=Yl.log.bind(Yl),e&&d0.set("logging_enabled",!0)):typeof n=="function"?Ta=n:(Ta=null,d0.remove("logging_enabled"))},zn=function(...n){if(yb===!0&&(yb=!1,Ta===null&&d0.get("logging_enabled")===!0&&QN(!0)),Ta){const e=yh.apply(null,n);Ta(e)}},vh=function(n){return function(...e){zn(n,...e)}},h0=function(...n){const e="FIREBASE INTERNAL ERROR: "+yh(...n);Yl.error(e)},ci=function(...n){const e=`FIREBASE FATAL ERROR: ${yh(...n)}`;throw Yl.error(e),new Error(e)},gr=function(...n){const e="FIREBASE WARNING: "+yh(...n);Yl.warn(e)},JO=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&gr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Zg=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},XO=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Lo="[MIN_NAME]",Pi="[MAX_NAME]",sl=function(n,e){if(n===e)return 0;if(n===Lo||e===Pi)return-1;if(e===Lo||n===Pi)return 1;{const t=vb(n),r=vb(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},ZO=function(n,e){return n===e?0:n<e?-1:1},_u=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Pn(e))},aw=function(n){if(typeof n!="object"||n===null)return Pn(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Pn(e[r]),t+=":",t+=aw(n[e[r]]);return t+="}",t},KN=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Hn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const YN=function(n){re(!Zg(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,c;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(c=0;c<64;c+=8){let m=parseInt(h.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},e4=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},t4=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function n4(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const r4=new RegExp("^-?(0*)\\d{1,10}$"),s4=-2147483648,i4=2147483647,vb=function(n){if(r4.test(n)){const e=Number(n);if(e>=s4&&e<=i4)return e}return null},Bc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw gr("Exception was thrown by user callback.",t),e},Math.floor(0))}},o4=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Xu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,rn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){gr(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(zn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',gr(e)}}class Jl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Jl.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lw="5",JN="v",XN="s",ZN="r",eC="f",tC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,nC="ls",rC="p",f0="ac",sC="websocket",iC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{constructor(e,t,r,s,i=!1,o="",a=!1,c=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=wa.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&wa.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function c4(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function aC(n,e,t){re(typeof e=="string","typeof type must == string"),re(typeof t=="object","typeof params must == object");let r;if(e===sC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===iC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);c4(n)&&(t.ns=n.namespace);const s=[];return Hn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4{constructor(){this.counters_={}}incrementCounter(e,t=1){Vs(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return pM(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uy={},$y={};function cw(n){const e=n.toString();return Uy[e]||(Uy[e]=new u4),Uy[e]}function d4(n,e){const t=n.toString();return $y[t]||($y[t]=e()),$y[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Bc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _b="start",f4="close",m4="pLPCommand",g4="pRTLPCB",lC="id",cC="pw",uC="ser",p4="cb",y4="seg",v4="ts",_4="d",w4="dframe",dC=1870,hC=30,x4=dC-hC,S4=25e3,I4=3e4;class mo{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=vh(e),this.stats_=cw(t),this.urlFn=c=>(this.appCheckToken&&(c[f0]=this.appCheckToken),aC(t,iC,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new h4(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(I4)),XO(()=>{if(this.isClosed_)return;this.scriptTagHolder=new uw((...i)=>{const[o,a,c,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===_b)this.id=a,this.password=c;else if(o===f4)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[_b]="t",r[uC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[p4]=this.scriptTagHolder.uniqueCallbackIdentifier),r[JN]=lw,this.transportSessionId&&(r[XN]=this.transportSessionId),this.lastSessionId&&(r[nC]=this.lastSessionId),this.applicationId&&(r[rC]=this.applicationId),this.appCheckToken&&(r[f0]=this.appCheckToken),typeof location<"u"&&location.hostname&&tC.test(location.hostname)&&(r[ZN]=eC);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){mo.forceAllow_=!0}static forceDisallow(){mo.forceDisallow_=!0}static isAvailable(){return mo.forceAllow_?!0:!mo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!e4()&&!t4()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Pn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=SN(t),s=KN(r,x4);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[w4]="t",r[lC]=e,r[cC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Pn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class uw{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=GN(),window[m4+this.uniqueCallbackIdentifier]=e,window[g4+this.uniqueCallbackIdentifier]=t,this.myIFrame=uw.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){zn("frame writing exception"),a.stack&&zn(a.stack),zn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||zn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[lC]=this.myID,e[cC]=this.myPW,e[uC]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+hC+r.length<=dC;){const o=this.pendingSegs.shift();r=r+"&"+y4+s+"="+o.seg+"&"+v4+s+"="+o.ts+"&"+_4+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(S4)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{zn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4=16384,E4=45e3;let Qm=null;typeof MozWebSocket<"u"?Qm=MozWebSocket:typeof WebSocket<"u"&&(Qm=WebSocket);class as{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=vh(this.connId),this.stats_=cw(t),this.connURL=as.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[JN]=lw,typeof location<"u"&&location.hostname&&tC.test(location.hostname)&&(o[ZN]=eC),t&&(o[XN]=t),r&&(o[nC]=r),s&&(o[f0]=s),i&&(o[rC]=i),aC(e,sC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,wa.set("previous_websocket_failure",!0);try{let r;DN(),this.mySock=new Qm(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){as.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Qm!==null&&!as.forceDisallow_}static previouslyFailed(){return wa.isInMemoryStorage||wa.get("previous_websocket_failure")===!0}markConnectionHealthy(){wa.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=jd(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(re(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=Pn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=KN(t,b4);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(E4))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}as.responsesRequiredToBeHealthy=2;as.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{static get ALL_TRANSPORTS(){return[mo,as]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=as&&as.isAvailable();let r=t&&!as.previouslyFailed();if(e.webSocketOnly&&(t||gr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[as];else{const s=this.transports_=[];for(const i of hc.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);hc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}hc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T4=6e4,A4=5e3,N4=10*1024,C4=100*1024,By="t",wb="d",R4="s",xb="r",k4="e",Sb="o",Ib="a",bb="n",Eb="p",D4="h";class P4{constructor(e,t,r,s,i,o,a,c,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=vh("c:"+this.id+":"),this.transportManager_=new hc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Xu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>C4?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>N4?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(By in e){const t=e[By];t===Ib?this.upgradeIfSecondaryHealthy_():t===xb?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Sb&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=_u("t",e),r=_u("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Eb,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ib,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:bb,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=_u("t",e),r=_u("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=_u(By,e);if(wb in e){const r=e[wb];if(t===D4){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===bb){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===R4?this.onConnectionShutdown_(r):t===xb?this.onReset_(r):t===k4?h0("Server Error: "+r):t===Sb?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):h0("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),lw!==r&&gr("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Xu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(T4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Xu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(A4))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Eb,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(wa.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e){this.allowedEvents_=e,this.listeners_={},re(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){re(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km extends mC{static getInstance(){return new Km}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!nw()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return re(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tb=32,Ab=768;class Nt{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function wt(){return new Nt("")}function tt(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Mo(n){return n.pieces_.length-n.pieceNum_}function Vt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Nt(n.pieces_,e)}function dw(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function j4(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Od(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function gC(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Nt(e,0)}function sn(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Nt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new Nt(t,0)}function nt(n){return n.pieceNum_>=n.pieces_.length}function wr(n,e){const t=tt(n),r=tt(e);if(t===null)return e;if(t===r)return wr(Vt(n),Vt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function L4(n,e){const t=Od(n,0),r=Od(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=sl(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function hw(n,e){if(Mo(n)!==Mo(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function cs(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Mo(n)>Mo(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class M4{constructor(e,t){this.errorPrefix_=t,this.parts_=Od(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Xg(this.parts_[r]);pC(this)}}function O4(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Xg(e),pC(n)}function V4(n){const e=n.parts_.pop();n.byteLength_-=Xg(e),n.parts_.length>0&&(n.byteLength_-=1)}function pC(n){if(n.byteLength_>Ab)throw new Error(n.errorPrefix_+"has a key path longer than "+Ab+" bytes ("+n.byteLength_+").");if(n.parts_.length>Tb)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Tb+") or object contains a cycle "+ua(n))}function ua(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw extends mC{static getInstance(){return new fw}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return re(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu=1e3,F4=60*5*1e3,Nb=30*1e3,U4=1.3,$4=3e4,B4="server_kill",Cb=3;class ds extends fC{constructor(e,t,r,s,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=ds.nextPersistentConnectionId_++,this.log_=vh("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=wu,this.maxReconnectDelay_=F4,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!DN())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");fw.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Km.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(Pn(i)),re(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Br,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),re(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),re(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const c=a.d,u=a.s;ds.warnOnListenWarnings_(c,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Vs(e,"w")){const r=Ma(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();gr(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||CM(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Nb)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=NM(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),re(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Pn(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):h0("Unrecognized action received from server: "+Pn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){re(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=wu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=wu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>$4&&(this.reconnectDelay_=wu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*U4)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+ds.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(f){re(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:c,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,m]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?zn("getToken() completed but was canceled"):(zn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=m&&m.token,a=new P4(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{gr(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(B4)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&gr(f),c())}}}interrupt(e){zn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){zn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Wm(this.interruptReasons_)&&(this.reconnectDelay_=wu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>aw(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new Nt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){zn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Cb&&(this.reconnectDelay_=Nb,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){zn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Cb&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+zN.replace(/\./g,"-")]=1,nw()?e["framework.cordova"]=1:kN()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Km.getInstance().currentlyOnline();return Wm(this.interruptReasons_)&&e}}ds.nextPersistentConnectionId_=0;ds.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new st(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new st(Lo,e),s=new st(Lo,t);return this.compare(r,s)!==0}minPost(){return st.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let If;class yC extends ep{static get __EMPTY_NODE(){return If}static set __EMPTY_NODE(e){If=e}compare(e,t){return sl(e.name,t.name)}isDefinedOn(e){throw $c("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return st.MIN}maxPost(){return new st(Pi,If)}makePost(e,t){return re(typeof e=="string","KeyIndex indexValue must always be a string."),new st(e,If)}toString(){return".key"}}const ri=new yC;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bf=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Ur=class Mu{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Mu.RED,this.left=s??Qs.EMPTY_NODE,this.right=i??Qs.EMPTY_NODE}copy(e,t,r,s,i){return new Mu(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Qs.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Qs.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Mu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Mu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Ur.RED=!0;Ur.BLACK=!1;class z4{copy(e,t,r,s,i){return this}insert(e,t,r){return new Ur(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Qs=class em{constructor(e,t=em.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new em(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ur.BLACK,null,null))}remove(e){return new em(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ur.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bf(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bf(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bf(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bf(this.root_,null,this.comparator_,!0,e)}};Qs.EMPTY_NODE=new z4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q4(n,e){return sl(n.name,e.name)}function mw(n,e){return sl(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m0;function W4(n){m0=n}const vC=function(n){return typeof n=="number"?"number:"+YN(n):"string:"+n},_C=function(n){if(n.isLeafNode()){const e=n.val();re(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Vs(e,".sv"),"Priority must be a string or number.")}else re(n===m0||n.isEmpty(),"priority of unexpected type.");re(n===m0||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rb;class Fn{static set __childrenNodeConstructor(e){Rb=e}static get __childrenNodeConstructor(){return Rb}constructor(e,t=Fn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,re(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),_C(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Fn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Fn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return nt(e)?this:tt(e)===".priority"?this.priorityNode_:Fn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Fn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=tt(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(re(r!==".priority"||Mo(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Fn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Vt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+vC(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=YN(this.value_):e+=this.value_,this.lazyHash_=HN(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Fn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Fn.__childrenNodeConstructor?-1:(re(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=Fn.VALUE_TYPE_ORDER.indexOf(t),i=Fn.VALUE_TYPE_ORDER.indexOf(r);return re(s>=0,"Unknown leaf type: "+t),re(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Fn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wC,xC;function G4(n){wC=n}function H4(n){xC=n}class Q4 extends ep{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?sl(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return st.MIN}maxPost(){return new st(Pi,new Fn("[PRIORITY-POST]",xC))}makePost(e,t){const r=wC(e);return new st(t,new Fn("[PRIORITY-POST]",r))}toString(){return".priority"}}const zt=new Q4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K4=Math.log(2);class Y4{constructor(e){const t=i=>parseInt(Math.log(i)/K4,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ym=function(n,e,t,r){n.sort(e);const s=function(c,u){const h=u-c;let f,m;if(h===0)return null;if(h===1)return f=n[c],m=t?t(f):f,new Ur(m,f.node,Ur.BLACK,null,null);{const y=parseInt(h/2,10)+c,w=s(c,y),S=s(y+1,u);return f=n[y],m=t?t(f):f,new Ur(m,f.node,Ur.BLACK,w,S)}},i=function(c){let u=null,h=null,f=n.length;const m=function(w,S){const k=f-w,I=f;f-=w;const x=s(k+1,I),C=n[k],D=t?t(C):C;y(new Ur(D,C.node,S,null,x))},y=function(w){u?(u.left=w,u=w):(h=w,u=w)};for(let w=0;w<c.count;++w){const S=c.nextBitIsOne(),k=Math.pow(2,c.count-(w+1));S?m(k,Ur.BLACK):(m(k,Ur.BLACK),m(k,Ur.RED))}return h},o=new Y4(n.length),a=i(o);return new Qs(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zy;const wl={};class xi{static get Default(){return re(wl&&zt,"ChildrenNode.ts has not been loaded"),zy=zy||new xi({".priority":wl},{".priority":zt}),zy}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ma(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Qs?t:null}hasIndex(e){return Vs(this.indexSet_,e.toString())}addIndex(e,t){re(e!==ri,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(st.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Ym(r,e.getCompare()):a=wl;const c=e.toString(),u={...this.indexSet_};u[c]=e;const h={...this.indexes_};return h[c]=a,new xi(h,u)}addToIndexes(e,t){const r=Gm(this.indexes_,(s,i)=>{const o=Ma(this.indexSet_,i);if(re(o,"Missing index implementation for "+i),s===wl)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(st.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Ym(a,o.getCompare())}else return wl;else{const a=t.get(e.name);let c=s;return a&&(c=c.remove(new st(e.name,a))),c.insert(e,e.node)}});return new xi(r,this.indexSet_)}removeFromIndexes(e,t){const r=Gm(this.indexes_,s=>{if(s===wl)return s;{const i=t.get(e.name);return i?s.remove(new st(e.name,i)):s}});return new xi(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xu;class ze{static get EMPTY_NODE(){return xu||(xu=new ze(new Qs(mw),null,xi.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&_C(this.priorityNode_),this.children_.isEmpty()&&re(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||xu}updatePriority(e){return this.children_.isEmpty()?this:new ze(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?xu:t}}getChild(e){const t=tt(e);return t===null?this:this.getImmediateChild(t).getChild(Vt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(re(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new st(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?xu:this.priorityNode_;return new ze(s,o,i)}}updateChild(e,t){const r=tt(e);if(r===null)return t;{re(tt(e)!==".priority"||Mo(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Vt(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(zt,(o,a)=>{t[o]=a.val(e),r++,i&&ze.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+vC(this.getPriority().val())+":"),this.forEachChild(zt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":HN(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new st(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new st(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new st(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,st.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,st.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===_h?-1:0}withIndex(e){if(e===ri||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ze(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ri||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(zt),s=t.getIterator(zt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ri?null:this.indexMap_.get(e.toString())}}ze.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class J4 extends ze{constructor(){super(new Qs(mw),ze.EMPTY_NODE,xi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ze.EMPTY_NODE}isEmpty(){return!1}}const _h=new J4;Object.defineProperties(st,{MIN:{value:new st(Lo,ze.EMPTY_NODE)},MAX:{value:new st(Pi,_h)}});yC.__EMPTY_NODE=ze.EMPTY_NODE;Fn.__childrenNodeConstructor=ze;W4(_h);H4(_h);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X4=!0;function un(n,e=null){if(n===null)return ze.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),re(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Fn(t,un(e))}if(!(n instanceof Array)&&X4){const t=[];let r=!1;if(Hn(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=un(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new st(o,c)))}}),t.length===0)return ze.EMPTY_NODE;const i=Ym(t,q4,o=>o.name,mw);if(r){const o=Ym(t,zt.getCompare());return new ze(i,un(e),new xi({".priority":o},{".priority":zt}))}else return new ze(i,un(e),xi.Default)}else{let t=ze.EMPTY_NODE;return Hn(n,(r,s)=>{if(Vs(n,r)&&r.substring(0,1)!=="."){const i=un(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(un(e))}}G4(un);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw extends ep{constructor(e){super(),this.indexPath_=e,re(!nt(e)&&tt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?sl(e.name,t.name):i}makePost(e,t){const r=un(e),s=ze.EMPTY_NODE.updateChild(this.indexPath_,r);return new st(t,s)}maxPost(){const e=ze.EMPTY_NODE.updateChild(this.indexPath_,_h);return new st(Pi,e)}toString(){return Od(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4 extends ep{compare(e,t){const r=e.node.compareTo(t.node);return r===0?sl(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return st.MIN}maxPost(){return st.MAX}makePost(e,t){const r=un(e);return new st(t,r)}toString(){return".value"}}const pw=new Z4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SC(n){return{type:"value",snapshotNode:n}}function fc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Vd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Fd(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function eV(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){re(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Vd(t,a)):re(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(fc(t,r)):o.trackChildChange(Fd(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(zt,(s,i)=>{t.hasChild(s)||r.trackChildChange(Vd(s,i))}),t.isLeafNode()||t.forEachChild(zt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Fd(s,i,o))}else r.trackChildChange(fc(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ze.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e){this.indexedFilter_=new yw(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ud.getStartPost_(e),this.endPost_=Ud.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new st(t,r))||(r=ze.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=ze.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ze.EMPTY_NODE);const i=this;return t.forEachChild(zt,(o,a)=>{i.matches(new st(o,a))||(s=s.updateImmediateChild(o,ze.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Ud(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new st(t,r))||(r=ze.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=ze.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=ze.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(ze.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,ze.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(m,y)=>f(y,m)}else o=this.index_.getCompare();const a=e;re(a.numChildren()===this.limit_,"");const c=new st(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const f=a.getImmediateChild(t);let m=s.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);const y=m==null?1:o(m,c);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Fd(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(Vd(t,f));const S=a.updateImmediateChild(t,ze.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(i!=null&&i.trackChildChange(fc(m.name,m.node)),S.updateImmediateChild(m.name,m.node)):S}}else return r.isEmpty()?e:h&&o(u,c)>=0?(i!=null&&(i.trackChildChange(Vd(u.name,u.node)),i.trackChildChange(fc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,ze.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=zt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return re(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return re(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Lo}hasEnd(){return this.endSet_}getIndexEndValue(){return re(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return re(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Pi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return re(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===zt}copy(){const e=new vw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function nV(n){return n.loadsAllData()?new yw(n.getIndex()):n.hasLimit()?new tV(n):new Ud(n)}function rV(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function sV(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function g0(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function iV(n,e,t){let r;return n.index_===ri||t?r=g0(n,e,t):r=g0(n,e,Pi),r.startAfterSet_=!0,r}function p0(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function oV(n,e,t){let r;return n.index_===ri||t?r=p0(n,e,t):r=p0(n,e,Lo),r.endBeforeSet_=!0,r}function tp(n,e){const t=n.copy();return t.index_=e,t}function kb(n){const e={};if(n.isDefault())return e;let t;if(n.index_===zt?t="$priority":n.index_===pw?t="$value":n.index_===ri?t="$key":(re(n.index_ instanceof gw,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Pn(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=Pn(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Pn(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Pn(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Pn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Db(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==zt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm extends fC{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(re(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=vh("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Jm.getListenId_(e,r),a={};this.listens_[o]=a;const c=kb(e._queryParams);this.restRequest_(i+".json",c,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Ma(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",s(m,null)}})}unlisten(e,t){const r=Jm.getListenId_(e,t);delete this.listens_[r]}get(e){const t=kb(e._queryParams),r=e._path.toString(),s=new Br;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+nl(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=jd(a.responseText)}catch{gr("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&gr("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aV{constructor(){this.rootNode_=ze.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xm(){return{value:null,children:new Map}}function zc(n,e,t){if(nt(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=tt(e);n.children.has(r)||n.children.set(r,Xm());const s=n.children.get(r);e=Vt(e),zc(s,e,t)}}function y0(n,e){if(nt(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(zt,(r,s)=>{zc(n,new Nt(r),s)}),y0(n,e)}}else if(n.children.size>0){const t=tt(e);return e=Vt(e),n.children.has(t)&&y0(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function v0(n,e,t){n.value!==null?t(e,n.value):lV(n,(r,s)=>{const i=new Nt(e.toString()+"/"+r);v0(s,i,t)})}function lV(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cV{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Hn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pb=10*1e3,uV=30*1e3,dV=5*60*1e3;class hV{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new cV(e);const r=Pb+(uV-Pb)*Math.random();Xu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Hn(e,(s,i)=>{i>0&&Vs(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),Xu(this.reportStats_.bind(this),Math.floor(Math.random()*2*dV))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ts;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ts||(Ts={}));function _w(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ww(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function xw(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Ts.ACK_USER_WRITE,this.source=_w()}operationForChild(e){if(nt(this.path)){if(this.affectedTree.value!=null)return re(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Nt(e));return new Zm(wt(),t,this.revert)}}else return re(tt(this.path)===e,"operationForChild called for unrelated child."),new Zm(Vt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e,t){this.source=e,this.path=t,this.type=Ts.LISTEN_COMPLETE}operationForChild(e){return nt(this.path)?new $d(this.source,wt()):new $d(this.source,Vt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Ts.OVERWRITE}operationForChild(e){return nt(this.path)?new Va(this.source,wt(),this.snap.getImmediateChild(e)):new Va(this.source,Vt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Ts.MERGE}operationForChild(e){if(nt(this.path)){const t=this.children.subtree(new Nt(e));return t.isEmpty()?null:t.value?new Va(this.source,wt(),t.value):new mc(this.source,wt(),t)}else return re(tt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new mc(this.source,Vt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(nt(e))return this.isFullyInitialized()&&!this.filtered_;const t=tt(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function mV(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(eV(o.childName,o.snapshotNode))}),Su(n,s,"child_removed",e,r,t),Su(n,s,"child_added",e,r,t),Su(n,s,"child_moved",i,r,t),Su(n,s,"child_changed",e,r,t),Su(n,s,"value",e,r,t),s}function Su(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,c)=>pV(n,a,c)),o.forEach(a=>{const c=gV(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function gV(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function pV(n,e,t){if(e.childName==null||t.childName==null)throw $c("Should only compare child_ events.");const r=new st(e.childName,e.snapshotNode),s=new st(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function np(n,e){return{eventCache:n,serverCache:e}}function Zu(n,e,t,r){return np(new Oo(e,t,r),n.serverCache)}function IC(n,e,t,r){return np(n.eventCache,new Oo(e,t,r))}function eg(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Fa(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qy;const yV=()=>(qy||(qy=new Qs(ZO)),qy);class $t{static fromObject(e){let t=new $t(null);return Hn(e,(r,s)=>{t=t.set(new Nt(r),s)}),t}constructor(e,t=yV()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:wt(),value:this.value};if(nt(e))return null;{const r=tt(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Vt(e),t);return i!=null?{path:sn(new Nt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(nt(e))return this;{const t=tt(e),r=this.children.get(t);return r!==null?r.subtree(Vt(e)):new $t(null)}}set(e,t){if(nt(e))return new $t(t,this.children);{const r=tt(e),i=(this.children.get(r)||new $t(null)).set(Vt(e),t),o=this.children.insert(r,i);return new $t(this.value,o)}}remove(e){if(nt(e))return this.children.isEmpty()?new $t(null):new $t(null,this.children);{const t=tt(e),r=this.children.get(t);if(r){const s=r.remove(Vt(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new $t(null):new $t(this.value,i)}else return this}}get(e){if(nt(e))return this.value;{const t=tt(e),r=this.children.get(t);return r?r.get(Vt(e)):null}}setTree(e,t){if(nt(e))return t;{const r=tt(e),i=(this.children.get(r)||new $t(null)).setTree(Vt(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new $t(this.value,o)}}fold(e){return this.fold_(wt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(sn(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,wt(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(nt(e))return null;{const i=tt(e),o=this.children.get(i);return o?o.findOnPath_(Vt(e),sn(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,wt(),t)}foreachOnPath_(e,t,r){if(nt(e))return this;{this.value&&r(t,this.value);const s=tt(e),i=this.children.get(s);return i?i.foreachOnPath_(Vt(e),sn(t,s),r):new $t(null)}}foreach(e){this.foreach_(wt(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(sn(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e){this.writeTree_=e}static empty(){return new Ds(new $t(null))}}function ed(n,e,t){if(nt(e))return new Ds(new $t(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=wr(s,e);return i=i.updateChild(o,t),new Ds(n.writeTree_.set(s,i))}else{const s=new $t(t),i=n.writeTree_.setTree(e,s);return new Ds(i)}}}function _0(n,e,t){let r=n;return Hn(t,(s,i)=>{r=ed(r,sn(e,s),i)}),r}function jb(n,e){if(nt(e))return Ds.empty();{const t=n.writeTree_.setTree(e,new $t(null));return new Ds(t)}}function w0(n,e){return il(n,e)!=null}function il(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(wr(t.path,e)):null}function Lb(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(zt,(r,s)=>{e.push(new st(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new st(r,s.value))}),e}function No(n,e){if(nt(e))return n;{const t=il(n,e);return t!=null?new Ds(new $t(t)):new Ds(n.writeTree_.subtree(e))}}function x0(n){return n.writeTree_.isEmpty()}function gc(n,e){return bC(wt(),n.writeTree_,e)}function bC(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(re(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=bC(sn(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(sn(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rp(n,e){return NC(e,n)}function vV(n,e,t,r,s){re(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=ed(n.visibleWrites,e,t)),n.lastWriteId=r}function _V(n,e,t,r){re(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=_0(n.visibleWrites,e,t),n.lastWriteId=r}function wV(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function xV(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);re(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&SV(a,r.path)?s=!1:cs(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return IV(n),!0;if(r.snap)n.visibleWrites=jb(n.visibleWrites,r.path);else{const a=r.children;Hn(a,c=>{n.visibleWrites=jb(n.visibleWrites,sn(r.path,c))})}return!0}else return!1}function SV(n,e){if(n.snap)return cs(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&cs(sn(n.path,t),e))return!0;return!1}function IV(n){n.visibleWrites=EC(n.allWrites,bV,wt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function bV(n){return n.visible}function EC(n,e,t){let r=Ds.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)cs(t,o)?(a=wr(t,o),r=ed(r,a,i.snap)):cs(o,t)&&(a=wr(o,t),r=ed(r,wt(),i.snap.getChild(a)));else if(i.children){if(cs(t,o))a=wr(t,o),r=_0(r,a,i.children);else if(cs(o,t))if(a=wr(o,t),nt(a))r=_0(r,wt(),i.children);else{const c=Ma(i.children,tt(a));if(c){const u=c.getChild(Vt(a));r=ed(r,wt(),u)}}}else throw $c("WriteRecord should have .snap or .children")}}return r}function TC(n,e,t,r,s){if(!r&&!s){const i=il(n.visibleWrites,e);if(i!=null)return i;{const o=No(n.visibleWrites,e);if(x0(o))return t;if(t==null&&!w0(o,wt()))return null;{const a=t||ze.EMPTY_NODE;return gc(o,a)}}}else{const i=No(n.visibleWrites,e);if(!s&&x0(i))return t;if(!s&&t==null&&!w0(i,wt()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(cs(u.path,e)||cs(e,u.path))},a=EC(n.allWrites,o,e),c=t||ze.EMPTY_NODE;return gc(a,c)}}}function EV(n,e,t){let r=ze.EMPTY_NODE;const s=il(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(zt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=No(n.visibleWrites,e);return t.forEachChild(zt,(o,a)=>{const c=gc(No(i,new Nt(o)),a);r=r.updateImmediateChild(o,c)}),Lb(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=No(n.visibleWrites,e);return Lb(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function TV(n,e,t,r,s){re(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=sn(e,t);if(w0(n.visibleWrites,i))return null;{const o=No(n.visibleWrites,i);return x0(o)?s.getChild(t):gc(o,s.getChild(t))}}function AV(n,e,t,r){const s=sn(e,t),i=il(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=No(n.visibleWrites,s);return gc(o,r.getNode().getImmediateChild(t))}else return null}function NV(n,e){return il(n.visibleWrites,e)}function CV(n,e,t,r,s,i,o){let a;const c=No(n.visibleWrites,e),u=il(c,wt());if(u!=null)a=u;else if(t!=null)a=gc(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),m=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=m.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=m.getNext();return h}else return[]}function RV(){return{visibleWrites:Ds.empty(),allWrites:[],lastWriteId:-1}}function tg(n,e,t,r){return TC(n.writeTree,n.treePath,e,t,r)}function Sw(n,e){return EV(n.writeTree,n.treePath,e)}function Mb(n,e,t,r){return TV(n.writeTree,n.treePath,e,t,r)}function ng(n,e){return NV(n.writeTree,sn(n.treePath,e))}function kV(n,e,t,r,s,i){return CV(n.writeTree,n.treePath,e,t,r,s,i)}function Iw(n,e,t){return AV(n.writeTree,n.treePath,e,t)}function AC(n,e){return NC(sn(n.treePath,e),n.writeTree)}function NC(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;re(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),re(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Fd(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Vd(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,fc(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Fd(r,e.snapshotNode,s.oldSnap));else throw $c("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const CC=new PV;class bw{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Oo(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Iw(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Fa(this.viewCache_),i=kV(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jV(n){return{filter:n}}function LV(n,e){re(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),re(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function MV(n,e,t,r,s){const i=new DV;let o,a;if(t.type===Ts.OVERWRITE){const u=t;u.source.fromUser?o=S0(n,e,u.path,u.snap,r,s,i):(re(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!nt(u.path),o=rg(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===Ts.MERGE){const u=t;u.source.fromUser?o=VV(n,e,u.path,u.children,r,s,i):(re(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=I0(n,e,u.path,u.children,r,s,a,i))}else if(t.type===Ts.ACK_USER_WRITE){const u=t;u.revert?o=$V(n,e,u.path,r,s,i):o=FV(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===Ts.LISTEN_COMPLETE)o=UV(n,e,t.path,r,i);else throw $c("Unknown operation type: "+t.type);const c=i.getChanges();return OV(e,o,c),{viewCache:o,changes:c}}function OV(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=eg(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(SC(eg(e)))}}function RC(n,e,t,r,s,i){const o=e.eventCache;if(ng(r,t)!=null)return e;{let a,c;if(nt(t))if(re(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Fa(e),h=u instanceof ze?u:ze.EMPTY_NODE,f=Sw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=tg(r,Fa(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=tt(t);if(u===".priority"){re(Mo(t)===1,"Can't have a priority with additional path components");const h=o.getNode();c=e.serverCache.getNode();const f=Mb(r,t,h,c);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=Vt(t);let f;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const m=Mb(r,t,o.getNode(),c);m!=null?f=o.getNode().getImmediateChild(u).updateChild(h,m):f=o.getNode().getImmediateChild(u)}else f=Iw(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Zu(e,a,o.isFullyInitialized()||nt(t),n.filter.filtersNodes())}}function rg(n,e,t,r,s,i,o,a){const c=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(nt(t))u=h.updateFullNode(c.getNode(),r,null);else if(h.filtersNodes()&&!c.isFiltered()){const y=c.getNode().updateChild(t,r);u=h.updateFullNode(c.getNode(),y,null)}else{const y=tt(t);if(!c.isCompleteForPath(t)&&Mo(t)>1)return e;const w=Vt(t),k=c.getNode().getImmediateChild(y).updateChild(w,r);y===".priority"?u=h.updatePriority(c.getNode(),k):u=h.updateChild(c.getNode(),y,k,w,CC,null)}const f=IC(e,u,c.isFullyInitialized()||nt(t),h.filtersNodes()),m=new bw(s,f,i);return RC(n,f,t,s,m,a)}function S0(n,e,t,r,s,i,o){const a=e.eventCache;let c,u;const h=new bw(s,e,i);if(nt(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Zu(e,u,!0,n.filter.filtersNodes());else{const f=tt(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),c=Zu(e,u,a.isFullyInitialized(),a.isFiltered());else{const m=Vt(t),y=a.getNode().getImmediateChild(f);let w;if(nt(m))w=r;else{const S=h.getCompleteChild(f);S!=null?dw(m)===".priority"&&S.getChild(gC(m)).isEmpty()?w=S:w=S.updateChild(m,r):w=ze.EMPTY_NODE}if(y.equals(w))c=e;else{const S=n.filter.updateChild(a.getNode(),f,w,m,h,o);c=Zu(e,S,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Ob(n,e){return n.eventCache.isCompleteForChild(e)}function VV(n,e,t,r,s,i,o){let a=e;return r.foreach((c,u)=>{const h=sn(t,c);Ob(e,tt(h))&&(a=S0(n,a,h,u,s,i,o))}),r.foreach((c,u)=>{const h=sn(t,c);Ob(e,tt(h))||(a=S0(n,a,h,u,s,i,o))}),a}function Vb(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function I0(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;nt(t)?u=r:u=new $t(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),w=Vb(n,y,m);c=rg(n,c,new Nt(f),w,s,i,o,a)}}),u.children.inorderTraversal((f,m)=>{const y=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!h.hasChild(f)&&!y){const w=e.serverCache.getNode().getImmediateChild(f),S=Vb(n,w,m);c=rg(n,c,new Nt(f),S,s,i,o,a)}}),c}function FV(n,e,t,r,s,i,o){if(ng(s,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(nt(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return rg(n,e,t,c.getNode().getChild(t),s,i,a,o);if(nt(t)){let u=new $t(null);return c.getNode().forEachChild(ri,(h,f)=>{u=u.set(new Nt(h),f)}),I0(n,e,t,u,s,i,a,o)}else return e}else{let u=new $t(null);return r.foreach((h,f)=>{const m=sn(t,h);c.isCompleteForPath(m)&&(u=u.set(h,c.getNode().getChild(m)))}),I0(n,e,t,u,s,i,a,o)}}function UV(n,e,t,r,s){const i=e.serverCache,o=IC(e,i.getNode(),i.isFullyInitialized()||nt(t),i.isFiltered());return RC(n,o,t,r,CC,s)}function $V(n,e,t,r,s,i){let o;if(ng(r,t)!=null)return e;{const a=new bw(r,e,s),c=e.eventCache.getNode();let u;if(nt(t)||tt(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=tg(r,Fa(e));else{const f=e.serverCache.getNode();re(f instanceof ze,"serverChildren would be complete if leaf node"),h=Sw(r,f)}h=h,u=n.filter.updateFullNode(c,h,i)}else{const h=tt(t);let f=Iw(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=c.getImmediateChild(h)),f!=null?u=n.filter.updateChild(c,h,f,Vt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(c,h,ze.EMPTY_NODE,Vt(t),a,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=tg(r,Fa(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||ng(r,wt())!=null,Zu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BV{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new yw(r.getIndex()),i=nV(r);this.processor_=jV(i);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(ze.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ze.EMPTY_NODE,a.getNode(),null),h=new Oo(c,o.isFullyInitialized(),s.filtersNodes()),f=new Oo(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=np(f,h),this.eventGenerator_=new fV(this.query_)}get query(){return this.query_}}function zV(n){return n.viewCache_.serverCache.getNode()}function qV(n){return eg(n.viewCache_)}function WV(n,e){const t=Fa(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!nt(e)&&!t.getImmediateChild(tt(e)).isEmpty())?t.getChild(e):null}function Fb(n){return n.eventRegistrations_.length===0}function GV(n,e){n.eventRegistrations_.push(e)}function Ub(n,e,t){const r=[];if(t){re(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function $b(n,e,t,r){e.type===Ts.MERGE&&e.source.queryId!==null&&(re(Fa(n.viewCache_),"We should always have a full cache before handling merges"),re(eg(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=MV(n.processor_,s,e,t,r);return LV(n.processor_,i.viewCache),re(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,kC(n,i.changes,i.viewCache.eventCache.getNode(),null)}function HV(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(zt,(i,o)=>{r.push(fc(i,o))}),t.isFullyInitialized()&&r.push(SC(t.getNode())),kC(n,r,t.getNode(),e)}function kC(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return mV(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sg;class DC{constructor(){this.views=new Map}}function QV(n){re(!sg,"__referenceConstructor has already been defined"),sg=n}function KV(){return re(sg,"Reference.ts has not been loaded"),sg}function YV(n){return n.views.size===0}function Ew(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return re(i!=null,"SyncTree gave us an op for an invalid query."),$b(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat($b(o,e,t,r));return i}}function PC(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=tg(t,s?r:null),c=!1;a?c=!0:r instanceof ze?(a=Sw(t,r),c=!1):(a=ze.EMPTY_NODE,c=!1);const u=np(new Oo(a,c,!1),new Oo(r,s,!1));return new BV(e,u)}return o}function JV(n,e,t,r,s,i){const o=PC(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),GV(o,t),HV(o,t)}function XV(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=Vo(n);if(s==="default")for(const[c,u]of n.views.entries())o=o.concat(Ub(u,t,r)),Fb(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=n.views.get(s);c&&(o=o.concat(Ub(c,t,r)),Fb(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return a&&!Vo(n)&&i.push(new(KV())(e._repo,e._path)),{removed:i,events:o}}function jC(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Co(n,e){let t=null;for(const r of n.views.values())t=t||WV(r,e);return t}function LC(n,e){if(e._queryParams.loadsAllData())return sp(n);{const r=e._queryIdentifier;return n.views.get(r)}}function MC(n,e){return LC(n,e)!=null}function Vo(n){return sp(n)!=null}function sp(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ig;function ZV(n){re(!ig,"__referenceConstructor has already been defined"),ig=n}function eF(){return re(ig,"Reference.ts has not been loaded"),ig}let tF=1;class Bb{constructor(e){this.listenProvider_=e,this.syncPointTree_=new $t(null),this.pendingWriteTree_=RV(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Tw(n,e,t,r,s){return vV(n.pendingWriteTree_,e,t,r,s),s?qc(n,new Va(_w(),e,t)):[]}function nF(n,e,t,r){_V(n.pendingWriteTree_,e,t,r);const s=$t.fromObject(t);return qc(n,new mc(_w(),e,s))}function go(n,e,t=!1){const r=wV(n.pendingWriteTree_,e);if(xV(n.pendingWriteTree_,e)){let i=new $t(null);return r.snap!=null?i=i.set(wt(),!0):Hn(r.children,o=>{i=i.set(new Nt(o),!0)}),qc(n,new Zm(r.path,i,t))}else return[]}function wh(n,e,t){return qc(n,new Va(ww(),e,t))}function rF(n,e,t){const r=$t.fromObject(t);return qc(n,new mc(ww(),e,r))}function sF(n,e){return qc(n,new $d(ww(),e))}function iF(n,e,t){const r=Aw(n,t);if(r){const s=Nw(r),i=s.path,o=s.queryId,a=wr(i,e),c=new $d(xw(o),a);return Cw(n,i,c)}else return[]}function og(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||MC(o,e))){const c=XV(o,e,t,r);YV(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=c.removed;if(a=c.events,!s){const h=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(m,y)=>Vo(y));if(h&&!f){const m=n.syncPointTree_.subtree(i);if(!m.isEmpty()){const y=lF(m);for(let w=0;w<y.length;++w){const S=y[w],k=S.query,I=UC(n,S);n.listenProvider_.startListening(td(k),Bd(n,k),I.hashFn,I.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(td(e),null):u.forEach(m=>{const y=n.queryToTagMap.get(op(m));n.listenProvider_.stopListening(td(m),y)}))}cF(n,u)}return a}function OC(n,e,t,r){const s=Aw(n,r);if(s!=null){const i=Nw(s),o=i.path,a=i.queryId,c=wr(o,e),u=new Va(xw(a),c,t);return Cw(n,o,u)}else return[]}function oF(n,e,t,r){const s=Aw(n,r);if(s){const i=Nw(s),o=i.path,a=i.queryId,c=wr(o,e),u=$t.fromObject(t),h=new mc(xw(a),c,u);return Cw(n,o,h)}else return[]}function b0(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(m,y)=>{const w=wr(m,s);i=i||Co(y,w),o=o||Vo(y)});let a=n.syncPointTree_.get(s);a?(o=o||Vo(a),i=i||Co(a,wt())):(a=new DC,n.syncPointTree_=n.syncPointTree_.set(s,a));let c;i!=null?c=!0:(c=!1,i=ze.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,w)=>{const S=Co(w,wt());S&&(i=i.updateImmediateChild(y,S))}));const u=MC(a,e);if(!u&&!e._queryParams.loadsAllData()){const m=op(e);re(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const y=uF();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}const h=rp(n.pendingWriteTree_,s);let f=JV(a,e,t,h,i,c);if(!u&&!o&&!r){const m=LC(a,e);f=f.concat(dF(n,e,m))}return f}function ip(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=wr(o,e),u=Co(a,c);if(u)return u});return TC(s,e,i,t,!0)}function aF(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=wr(u,t);r=r||Co(h,f)});let s=n.syncPointTree_.get(t);s?r=r||Co(s,wt()):(s=new DC,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Oo(r,!0,!1):null,a=rp(n.pendingWriteTree_,e._path),c=PC(s,e,a,i?o.getNode():ze.EMPTY_NODE,i);return qV(c)}function qc(n,e){return VC(e,n.syncPointTree_,null,rp(n.pendingWriteTree_,wt()))}function VC(n,e,t,r){if(nt(n.path))return FC(n,e,t,r);{const s=e.get(wt());t==null&&s!=null&&(t=Co(s,wt()));let i=[];const o=tt(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const u=t?t.getImmediateChild(o):null,h=AC(r,o);i=i.concat(VC(a,c,u,h))}return s&&(i=i.concat(Ew(s,n,r,t))),i}}function FC(n,e,t,r){const s=e.get(wt());t==null&&s!=null&&(t=Co(s,wt()));let i=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,u=AC(r,o),h=n.operationForChild(o);h&&(i=i.concat(FC(h,a,c,u)))}),s&&(i=i.concat(Ew(s,n,r,t))),i}function UC(n,e){const t=e.query,r=Bd(n,t);return{hashFn:()=>(zV(e)||ze.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?iF(n,t._path,r):sF(n,t._path);{const i=n4(s,t);return og(n,t,null,i)}}}}function Bd(n,e){const t=op(e);return n.queryToTagMap.get(t)}function op(n){return n._path.toString()+"$"+n._queryIdentifier}function Aw(n,e){return n.tagToQueryMap.get(e)}function Nw(n){const e=n.indexOf("$");return re(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Nt(n.substr(0,e))}}function Cw(n,e,t){const r=n.syncPointTree_.get(e);re(r,"Missing sync point for query tag that we're tracking");const s=rp(n.pendingWriteTree_,e);return Ew(r,t,s,null)}function lF(n){return n.fold((e,t,r)=>{if(t&&Vo(t))return[sp(t)];{let s=[];return t&&(s=jC(t)),Hn(r,(i,o)=>{s=s.concat(o)}),s}})}function td(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(eF())(n._repo,n._path):n}function cF(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=op(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function uF(){return tF++}function dF(n,e,t){const r=e._path,s=Bd(n,e),i=UC(n,t),o=n.listenProvider_.startListening(td(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)re(!Vo(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,h,f)=>{if(!nt(u)&&h&&Vo(h))return[sp(h).query];{let m=[];return h&&(m=m.concat(jC(h).map(y=>y.query))),Hn(f,(y,w)=>{m=m.concat(w)}),m}});for(let u=0;u<c.length;++u){const h=c[u];n.listenProvider_.stopListening(td(h),Bd(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Rw(t)}node(){return this.node_}}class kw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=sn(this.path_,e);return new kw(this.syncTree_,t)}node(){return ip(this.syncTree_,this.path_)}}const hF=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},zb=function(n,e,t){if(!n||typeof n!="object")return n;if(re(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return fF(n[".sv"],e,t);if(typeof n[".sv"]=="object")return mF(n[".sv"],e);re(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},fF=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:re(!1,"Unexpected server value: "+n)}},mF=function(n,e,t){n.hasOwnProperty("increment")||re(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&re(!1,"Unexpected increment value: "+r);const s=e.node();if(re(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},$C=function(n,e,t,r){return Pw(e,new kw(t,n),r)},Dw=function(n,e,t){return Pw(n,new Rw(e),t)};function Pw(n,e,t){const r=n.getPriority().val(),s=zb(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=zb(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Fn(a,un(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Fn(s))),o.forEachChild(zt,(a,c)=>{const u=Pw(c,e.getImmediateChild(a),t);u!==c&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function ap(n,e){let t=e instanceof Nt?e:new Nt(e),r=n,s=tt(t);for(;s!==null;){const i=Ma(r.node.children,s)||{children:{},childCount:0};r=new jw(s,r,i),t=Vt(t),s=tt(t)}return r}function ol(n){return n.node.value}function Lw(n,e){n.node.value=e,E0(n)}function BC(n){return n.node.childCount>0}function gF(n){return ol(n)===void 0&&!BC(n)}function lp(n,e){Hn(n.node.children,(t,r)=>{e(new jw(t,n,r))})}function zC(n,e,t,r){t&&!r&&e(n),lp(n,s=>{zC(s,e,!0,r)}),t&&r&&e(n)}function pF(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function xh(n){return new Nt(n.parent===null?n.name:xh(n.parent)+"/"+n.name)}function E0(n){n.parent!==null&&yF(n.parent,n.name,n)}function yF(n,e,t){const r=gF(t),s=Vs(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,E0(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,E0(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vF=/[\[\].#$\/\u0000-\u001F\u007F]/,_F=/[\[\].#$\u0000-\u001F\u007F]/,Wy=10*1024*1024,cp=function(n){return typeof n=="string"&&n.length!==0&&!vF.test(n)},qC=function(n){return typeof n=="string"&&n.length!==0&&!_F.test(n)},wF=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),qC(n)},zd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Zg(n)||n&&typeof n=="object"&&Vs(n,".sv")},ui=function(n,e,t,r){r&&e===void 0||Sh(Oa(n,"value"),e,t)},Sh=function(n,e,t){const r=t instanceof Nt?new M4(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ua(r));if(typeof e=="function")throw new Error(n+"contains a function "+ua(r)+" with contents = "+e.toString());if(Zg(e))throw new Error(n+"contains "+e.toString()+" "+ua(r));if(typeof e=="string"&&e.length>Wy/3&&Xg(e)>Wy)throw new Error(n+"contains a string greater than "+Wy+" utf8 bytes "+ua(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Hn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!cp(o)))throw new Error(n+" contains an invalid key ("+o+") "+ua(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);O4(r,o),Sh(n,a,r),V4(r)}),s&&i)throw new Error(n+' contains ".value" child '+ua(r)+" in addition to actual children.")}},xF=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Od(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!cp(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(L4);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&cs(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},WC=function(n,e,t,r){if(r&&e===void 0)return;const s=Oa(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Hn(e,(o,a)=>{const c=new Nt(o);if(Sh(s,a,sn(t,c)),dw(c)===".priority"&&!zd(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),xF(s,i)},Mw=function(n,e,t){if(!(t&&e===void 0)){if(Zg(e))throw new Error(Oa(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!zd(e))throw new Error(Oa(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ih=function(n,e,t,r){if(!(r&&t===void 0)&&!cp(t))throw new Error(Oa(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ow=function(n,e,t,r){if(!(r&&t===void 0)&&!qC(t))throw new Error(Oa(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},SF=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ow(n,e,t,r)},Ks=function(n,e){if(tt(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},GC=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!cp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!wF(t))throw new Error(Oa(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IF{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function up(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!hw(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function HC(n,e,t){up(n,t),QC(n,r=>hw(r,e))}function Jr(n,e,t){up(n,t),QC(n,r=>cs(r,e)||cs(e,r))}function QC(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(bF(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function bF(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Ta&&zn("event: "+t.toString()),Bc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC="repo_interrupt",EF=25;class TF{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new IF,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xm(),this.transactionQueueTree_=new jw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function AF(n,e,t){if(n.stats_=cw(n.repoInfo_),n.forceRestClient_||o4())n.server_=new Jm(n.repoInfo_,(r,s,i,o)=>{qb(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Wb(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Pn(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new ds(n.repoInfo_,e,(r,s,i,o)=>{qb(n,r,s,i,o)},r=>{Wb(n,r)},r=>{NF(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=d4(n.repoInfo_,()=>new hV(n.stats_,n.server_)),n.infoData_=new aV,n.infoSyncTree_=new Bb({startListening:(r,s,i,o)=>{let a=[];const c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=wh(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Vw(n,"connected",!1),n.serverSyncTree_=new Bb({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,c)=>{const u=o(a,c);Jr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function YC(n){const t=n.infoData_.getNode(new Nt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function bh(n){return hF({timestamp:YC(n)})}function qb(n,e,t,r,s){n.dataUpdateCount++;const i=new Nt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const c=Gm(t,u=>un(u));o=oF(n.serverSyncTree_,i,c,s)}else{const c=un(t);o=OC(n.serverSyncTree_,i,c,s)}else if(r){const c=Gm(t,u=>un(u));o=rF(n.serverSyncTree_,i,c)}else{const c=un(t);o=wh(n.serverSyncTree_,i,c)}let a=i;o.length>0&&(a=pc(n,i)),Jr(n.eventQueue_,a,o)}function Wb(n,e){Vw(n,"connected",e),e===!1&&kF(n)}function NF(n,e){Hn(e,(t,r)=>{Vw(n,t,r)})}function Vw(n,e,t){const r=new Nt("/.info/"+e),s=un(t);n.infoData_.updateSnapshot(r,s);const i=wh(n.infoSyncTree_,r,s);Jr(n.eventQueue_,r,i)}function dp(n){return n.nextWriteId_++}function CF(n,e,t){const r=aF(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=un(s).withIndex(e._queryParams.getIndex());b0(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=wh(n.serverSyncTree_,e._path,i);else{const a=Bd(n.serverSyncTree_,e);o=OC(n.serverSyncTree_,e._path,i,a)}return Jr(n.eventQueue_,e._path,o),og(n.serverSyncTree_,e,t,null,!0),i},s=>(Wc(n,"get for query "+Pn(e)+" failed: "+s),Promise.reject(new Error(s))))}function Fw(n,e,t,r,s){Wc(n,"set",{path:e.toString(),value:t,priority:r});const i=bh(n),o=un(t,r),a=ip(n.serverSyncTree_,e),c=Dw(o,a,i),u=dp(n),h=Tw(n.serverSyncTree_,e,c,u,!0);up(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(m,y)=>{const w=m==="ok";w||gr("set at "+e+" failed: "+m);const S=go(n.serverSyncTree_,u,!w);Jr(n.eventQueue_,e,S),Fo(n,s,m,y)});const f=$w(n,e);pc(n,f),Jr(n.eventQueue_,f,[])}function RF(n,e,t,r){Wc(n,"update",{path:e.toString(),value:t});let s=!0;const i=bh(n),o={};if(Hn(t,(a,c)=>{s=!1,o[a]=$C(sn(e,a),un(c),n.serverSyncTree_,i)}),s)zn("update() called with empty data.  Don't do anything."),Fo(n,r,"ok",void 0);else{const a=dp(n),c=nF(n.serverSyncTree_,e,o,a);up(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||gr("update at "+e+" failed: "+u);const m=go(n.serverSyncTree_,a,!f),y=m.length>0?pc(n,e):e;Jr(n.eventQueue_,y,m),Fo(n,r,u,h)}),Hn(t,u=>{const h=$w(n,sn(e,u));pc(n,h)}),Jr(n.eventQueue_,e,[])}}function kF(n){Wc(n,"onDisconnectEvents");const e=bh(n),t=Xm();v0(n.onDisconnect_,wt(),(s,i)=>{const o=$C(s,i,n.serverSyncTree_,e);zc(t,s,o)});let r=[];v0(t,wt(),(s,i)=>{r=r.concat(wh(n.serverSyncTree_,s,i));const o=$w(n,s);pc(n,o)}),n.onDisconnect_=Xm(),Jr(n.eventQueue_,wt(),r)}function DF(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&y0(n.onDisconnect_,e),Fo(n,t,r,s)})}function Gb(n,e,t,r){const s=un(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&zc(n.onDisconnect_,e,s),Fo(n,r,i,o)})}function PF(n,e,t,r,s){const i=un(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&zc(n.onDisconnect_,e,i),Fo(n,s,o,a)})}function jF(n,e,t,r){if(Wm(t)){zn("onDisconnect().update() called with empty data.  Don't do anything."),Fo(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Hn(t,(o,a)=>{const c=un(a);zc(n.onDisconnect_,sn(e,o),c)}),Fo(n,r,s,i)})}function LF(n,e,t){let r;tt(e._path)===".info"?r=b0(n.infoSyncTree_,e,t):r=b0(n.serverSyncTree_,e,t),HC(n.eventQueue_,e._path,r)}function T0(n,e,t){let r;tt(e._path)===".info"?r=og(n.infoSyncTree_,e,t):r=og(n.serverSyncTree_,e,t),HC(n.eventQueue_,e._path,r)}function JC(n){n.persistentConnection_&&n.persistentConnection_.interrupt(KC)}function MF(n){n.persistentConnection_&&n.persistentConnection_.resume(KC)}function Wc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),zn(t,...e)}function Fo(n,e,t,r){e&&Bc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function OF(n,e,t,r,s,i){Wc(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:GN(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Uw(n,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Sh("transaction failed: Data returned ",c,o.path),o.status=0;const u=ap(n.transactionQueueTree_,e),h=ol(u)||[];h.push(o),Lw(u,h);let f;typeof c=="object"&&c!==null&&Vs(c,".priority")?(f=Ma(c,".priority"),re(zd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(ip(n.serverSyncTree_,e)||ze.EMPTY_NODE).getPriority().val();const m=bh(n),y=un(c,f),w=Dw(y,a,m);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=w,o.currentWriteId=dp(n);const S=Tw(n.serverSyncTree_,e,w,o.currentWriteId,o.applyLocally);Jr(n.eventQueue_,e,S),hp(n,n.transactionQueueTree_)}}function Uw(n,e,t){return ip(n.serverSyncTree_,e,t)||ze.EMPTY_NODE}function hp(n,e=n.transactionQueueTree_){if(e||fp(n,e),ol(e)){const t=ZC(n,e);re(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&VF(n,xh(e),t)}else BC(e)&&lp(e,t=>{hp(n,t)})}function VF(n,e,t){const r=t.map(u=>u.currentWriteId),s=Uw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];re(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=wr(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Wc(n,"transaction put response",{path:c.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let m=0;m<t.length;m++)t[m].status=2,h=h.concat(go(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();fp(n,ap(n.transactionQueueTree_,e)),hp(n,n.transactionQueueTree_),Jr(n.eventQueue_,e,h);for(let m=0;m<f.length;m++)Bc(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{gr("transaction at "+c.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}pc(n,e)}},o)}function pc(n,e){const t=XC(n,e),r=xh(t),s=ZC(n,t);return FF(n,s,r),r}function FF(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=wr(t,c.path);let h=!1,f;if(re(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)h=!0,f=c.abortReason,s=s.concat(go(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=EF)h=!0,f="maxretry",s=s.concat(go(n.serverSyncTree_,c.currentWriteId,!0));else{const m=Uw(n,c.path,o);c.currentInputSnapshot=m;const y=e[a].update(m.val());if(y!==void 0){Sh("transaction failed: Data returned ",y,c.path);let w=un(y);typeof y=="object"&&y!=null&&Vs(y,".priority")||(w=w.updatePriority(m.getPriority()));const k=c.currentWriteId,I=bh(n),x=Dw(w,m,I);c.currentOutputSnapshotRaw=w,c.currentOutputSnapshotResolved=x,c.currentWriteId=dp(n),o.splice(o.indexOf(k),1),s=s.concat(Tw(n.serverSyncTree_,c.path,x,c.currentWriteId,c.applyLocally)),s=s.concat(go(n.serverSyncTree_,k,!0))}else h=!0,f="nodata",s=s.concat(go(n.serverSyncTree_,c.currentWriteId,!0))}Jr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}fp(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Bc(r[a]);hp(n,n.transactionQueueTree_)}function XC(n,e){let t,r=n.transactionQueueTree_;for(t=tt(e);t!==null&&ol(r)===void 0;)r=ap(r,t),e=Vt(e),t=tt(e);return r}function ZC(n,e){const t=[];return eR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function eR(n,e,t){const r=ol(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);lp(e,s=>{eR(n,s,t)})}function fp(n,e){const t=ol(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,Lw(e,t.length>0?t:void 0)}lp(e,r=>{fp(n,r)})}function $w(n,e){const t=xh(XC(n,e)),r=ap(n.transactionQueueTree_,e);return pF(r,s=>{Gy(n,s)}),Gy(n,r),zC(r,s=>{Gy(n,s)}),t}function Gy(n,e){const t=ol(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(re(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(re(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(go(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Lw(e,void 0):t.length=i+1,Jr(n.eventQueue_,xh(e),s);for(let o=0;o<r.length;o++)Bc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UF(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function $F(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):gr(`Invalid query segment '${t}' in query '${n}'`)}return e}const A0=function(n,e){const t=BF(n),r=t.namespace;t.domain==="firebase.com"&&ci(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&ci("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||JO();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new oC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new Nt(t.pathString)}},BF=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=UF(n.substring(h,f)));const m=$F(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const w=e.indexOf(".");r=e.substring(0,w).toLowerCase(),t=e.substring(w+1),i=r}"ns"in m&&(i=m.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hb="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",zF=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Hb.charAt(t%64),t=Math.floor(t/64);re(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Hb.charAt(e[s]);return re(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Pn(this.snapshot.exportVal())}}class nR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return re(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Br;return DF(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ks("OnDisconnect.remove",this._path);const e=new Br;return Gb(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ks("OnDisconnect.set",this._path),ui("OnDisconnect.set",e,this._path,!1);const t=new Br;return Gb(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ks("OnDisconnect.setWithPriority",this._path),ui("OnDisconnect.setWithPriority",e,this._path,!1),Mw("OnDisconnect.setWithPriority",t,!1);const r=new Br;return PF(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Ks("OnDisconnect.update",this._path),WC("OnDisconnect.update",e,this._path,!1);const t=new Br;return jF(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return nt(this._path)?null:dw(this._path)}get ref(){return new Fs(this._repo,this._path)}get _queryIdentifier(){const e=Db(this._queryParams),t=aw(e);return t==="{}"?"default":t}get _queryObject(){return Db(this._queryParams)}isEqual(e){if(e=he(e),!(e instanceof ts))return!1;const t=this._repo===e._repo,r=hw(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+j4(this._path)}}function mp(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Yo(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ri){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Lo)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Pi)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===zt){if(e!=null&&!zd(e)||t!=null&&!zd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(re(n.getIndex()instanceof gw||n.getIndex()===pw,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function gp(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Fs extends ts{constructor(e,t){super(e,t,new vw,!1)}get parent(){const e=gC(this._path);return e===null?null:new Fs(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Ua{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Nt(e),r=yc(this.ref,e);return new Ua(this._node.getChild(t),r,zt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Ua(s,yc(this.ref,r),zt)))}hasChild(e){const t=new Nt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Z(n,e){return n=he(n),n._checkNotDeleted("ref"),e!==void 0?yc(n._root,e):n._root}function R8(n,e){n=he(n),n._checkNotDeleted("refFromURL");const t=A0(e,n._repo.repoInfo_.nodeAdmin);GC("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&ci("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Z(n,t.path.toString())}function yc(n,e){return n=he(n),tt(n._path)===null?SF("child","path",e,!1):Ow("child","path",e,!1),new Fs(n._repo,sn(n._path,e))}function k8(n){return n=he(n),new qF(n._repo,n._path)}function rR(n,e){n=he(n),Ks("push",n._path),ui("push",e,n._path,!0);const t=YC(n._repo),r=zF(t),s=yc(n,r),i=yc(n,r);let o;return e!=null?o=Ue(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function WF(n){return Ks("remove",n._path),Ue(n,null)}function Ue(n,e){n=he(n),Ks("set",n._path),ui("set",e,n._path,!1);const t=new Br;return Fw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function D8(n,e){n=he(n),Ks("setPriority",n._path),Mw("setPriority",e,!1);const t=new Br;return Fw(n._repo,sn(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function P8(n,e,t){if(Ks("setWithPriority",n._path),ui("setWithPriority",e,n._path,!1),Mw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Br;return Fw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function GF(n,e){WC("update",e,n._path,!1);const t=new Br;return RF(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Le(n){n=he(n);const e=new Bw(()=>{}),t=new Eh(e);return CF(n._repo,n,t).then(r=>new Ua(r,new Fs(n._repo,n._path),n._queryParams.getIndex()))}class Eh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new tR("value",this,new Ua(e.snapshotNode,new Fs(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new nR(this,e,t):null}matches(e){return e instanceof Eh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class pp{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new nR(this,e,t):null}createEvent(e,t){re(e.childName!=null,"Child events should have a childName.");const r=yc(new Fs(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new tR(e.type,this,new Ua(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof pp?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Th(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const c=t,u=(h,f)=>{T0(n._repo,n,a),c(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new Bw(t,i||void 0),a=e==="value"?new Eh(o):new pp(e,o);return LF(n._repo,n,a),()=>T0(n._repo,n,a)}function zw(n,e,t,r){return Th(n,"value",e,t,r)}function j8(n,e,t,r){return Th(n,"child_added",e,t,r)}function L8(n,e,t,r){return Th(n,"child_changed",e,t,r)}function M8(n,e,t,r){return Th(n,"child_moved",e,t,r)}function O8(n,e,t,r){return Th(n,"child_removed",e,t,r)}function HF(n,e,t){let r=null;const s=t?new Bw(t):null;e==="value"?r=new Eh(s):e&&(r=new pp(e,s)),T0(n._repo,n,r)}let Us=class{},sR=class extends Us{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){ui("endAt",this._value,e._path,!0);const t=p0(e._queryParams,this._value,this._key);if(gp(t),Yo(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ts(e._repo,e._path,t,e._orderByCalled)}};function U8(n,e){return Ih("endAt","key",e,!0),new sR(n,e)}class QF extends Us{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){ui("endBefore",this._value,e._path,!1);const t=oV(e._queryParams,this._value,this._key);if(gp(t),Yo(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ts(e._repo,e._path,t,e._orderByCalled)}}function $8(n,e){return Ih("endBefore","key",e,!0),new QF(n,e)}let iR=class extends Us{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){ui("startAt",this._value,e._path,!0);const t=g0(e._queryParams,this._value,this._key);if(gp(t),Yo(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new ts(e._repo,e._path,t,e._orderByCalled)}};function z8(n=null,e){return Ih("startAt","key",e,!0),new iR(n,e)}class KF extends Us{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){ui("startAfter",this._value,e._path,!1);const t=iV(e._queryParams,this._value,this._key);if(gp(t),Yo(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new ts(e._repo,e._path,t,e._orderByCalled)}}function q8(n,e){return Ih("startAfter","key",e,!0),new KF(n,e)}class YF extends Us{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new ts(e._repo,e._path,rV(e._queryParams,this._limit),e._orderByCalled)}}function W8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new YF(n)}class JF extends Us{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new ts(e._repo,e._path,sV(e._queryParams,this._limit),e._orderByCalled)}}function G8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new JF(n)}class XF extends Us{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){mp(e,"orderByChild");const t=new Nt(this._path);if(nt(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new gw(t),s=tp(e._queryParams,r);return Yo(s),new ts(e._repo,e._path,s,!0)}}function H8(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ow("orderByChild","path",n,!1),new XF(n)}class ZF extends Us{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){mp(e,"orderByKey");const t=tp(e._queryParams,ri);return Yo(t),new ts(e._repo,e._path,t,!0)}}function Q8(){return new ZF}class e3 extends Us{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){mp(e,"orderByPriority");const t=tp(e._queryParams,zt);return Yo(t),new ts(e._repo,e._path,t,!0)}}function K8(){return new e3}class t3 extends Us{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){mp(e,"orderByValue");const t=tp(e._queryParams,pw);return Yo(t),new ts(e._repo,e._path,t,!0)}}function Y8(){return new t3}class n3 extends Us{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(ui("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new sR(this._value,this._key)._apply(new iR(this._value,this._key)._apply(e))}}function J8(n,e){return Ih("equalTo","key",e,!0),new n3(n,e)}function r3(n,...e){let t=he(n);for(const r of e)t=r._apply(t);return t}QV(Fs);ZV(Fs);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s3="FIREBASE_DATABASE_EMULATOR_HOST",N0={};let oR=!1;function i3(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Ui(i);n.repoInfo_=new oC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function aR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||ci("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),zn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=A0(i,s),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[s3]),u?(c=!0,i=`http://${u}?ns=${a.namespace}`,o=A0(i,s),a=o.repoInfo):c=!o.repoInfo.secure;const h=s&&c?new Jl(Jl.OWNER):new l4(n.name,n.options,e);GC("Invalid Firebase Database URL",o),nt(o.path)||ci("Database URL must point to the root of a Firebase Database (not including a child path).");const f=a3(a,n,h,new a4(n,t));return new c3(f,n)}function o3(n,e){const t=N0[e];(!t||t[n.key]!==n)&&ci(`Database ${e}(${n.repoInfo_}) has already been deleted.`),JC(n),delete t[n.key]}function a3(n,e,t,r){let s=N0[e.name];s||(s={},N0[e.name]=s);let i=s[n.toURLString()];return i&&ci("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new TF(n,oR,t,r),s[n.toURLString()]=i,i}function l3(n){oR=n}let c3=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(AF(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Fs(this._repo,wt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(o3(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ci("Cannot call "+e+" on a deleted database.")}};function lR(){hc.IS_TRANSPORT_INITIALIZED&&gr("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Z8(){lR(),mo.forceDisallow()}function e7(){lR(),as.forceDisallow(),mo.forceAllow()}function u3(n=ph(),e){const t=hi(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=TN("database");r&&d3(t,...r)}return t}function d3(n,e,t,r={}){n=he(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Yr(r,i.repoInfo_.emulatorOptions))return;ci("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ci('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Jl(Jl.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:CN(r.mockUserToken,n.app.options.projectId);o=new Jl(a)}Ui(e)&&(Yg(e),tw("Database",!0)),i3(i,s,r,o)}function t7(n){n=he(n),n._checkNotDeleted("goOffline"),JC(n._repo)}function n7(n){n=he(n),n._checkNotDeleted("goOnline"),MF(n._repo)}function r7(n,e){QN(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h3(n){qN(rl),Ms(new Lr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return aR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Pr(gb,pb,n),Pr(gb,pb,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f3={".sv":"timestamp"};function s7(){return f3}function i7(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m3{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function o7(n,e,t){if(n=he(n),Ks("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new Br,i=(a,c,u)=>{let h=null;a?s.reject(a):(h=new Ua(u,new Fs(n._repo,n._path),zt),s.resolve(new m3(c,h)))},o=zw(n,()=>{});return OF(n._repo,n._path,e,i,o,r),s.promise}ds.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};ds.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const a7=function(n){const e=ds.prototype.put;return ds.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){ds.prototype.put=e}},l7=function(n){l3(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c7({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){qN(t);const o=new ON("database-standalone"),a=new o0("auth-internal",o);let c;return s&&(c=new o0("app-check-internal",o),c.setComponent(new Lr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Lr("auth-internal",()=>r,"PRIVATE")),aR(n,a,c,e,i)}h3();var Qb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ro,cR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(R,_){function E(){}E.prototype=_.prototype,R.D=_.prototype,R.prototype=new E,R.prototype.constructor=R,R.C=function(N,T,A){for(var v=Array(arguments.length-2),B=2;B<arguments.length;B++)v[B-2]=arguments[B];return _.prototype[T].apply(N,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(R,_,E){E||(E=0);var N=Array(16);if(typeof _=="string")for(var T=0;16>T;++T)N[T]=_.charCodeAt(E++)|_.charCodeAt(E++)<<8|_.charCodeAt(E++)<<16|_.charCodeAt(E++)<<24;else for(T=0;16>T;++T)N[T]=_[E++]|_[E++]<<8|_[E++]<<16|_[E++]<<24;_=R.g[0],E=R.g[1],T=R.g[2];var A=R.g[3],v=_+(A^E&(T^A))+N[0]+3614090360&4294967295;_=E+(v<<7&4294967295|v>>>25),v=A+(T^_&(E^T))+N[1]+3905402710&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(E^A&(_^E))+N[2]+606105819&4294967295,T=A+(v<<17&4294967295|v>>>15),v=E+(_^T&(A^_))+N[3]+3250441966&4294967295,E=T+(v<<22&4294967295|v>>>10),v=_+(A^E&(T^A))+N[4]+4118548399&4294967295,_=E+(v<<7&4294967295|v>>>25),v=A+(T^_&(E^T))+N[5]+1200080426&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(E^A&(_^E))+N[6]+2821735955&4294967295,T=A+(v<<17&4294967295|v>>>15),v=E+(_^T&(A^_))+N[7]+4249261313&4294967295,E=T+(v<<22&4294967295|v>>>10),v=_+(A^E&(T^A))+N[8]+1770035416&4294967295,_=E+(v<<7&4294967295|v>>>25),v=A+(T^_&(E^T))+N[9]+2336552879&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(E^A&(_^E))+N[10]+4294925233&4294967295,T=A+(v<<17&4294967295|v>>>15),v=E+(_^T&(A^_))+N[11]+2304563134&4294967295,E=T+(v<<22&4294967295|v>>>10),v=_+(A^E&(T^A))+N[12]+1804603682&4294967295,_=E+(v<<7&4294967295|v>>>25),v=A+(T^_&(E^T))+N[13]+4254626195&4294967295,A=_+(v<<12&4294967295|v>>>20),v=T+(E^A&(_^E))+N[14]+2792965006&4294967295,T=A+(v<<17&4294967295|v>>>15),v=E+(_^T&(A^_))+N[15]+1236535329&4294967295,E=T+(v<<22&4294967295|v>>>10),v=_+(T^A&(E^T))+N[1]+4129170786&4294967295,_=E+(v<<5&4294967295|v>>>27),v=A+(E^T&(_^E))+N[6]+3225465664&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^E&(A^_))+N[11]+643717713&4294967295,T=A+(v<<14&4294967295|v>>>18),v=E+(A^_&(T^A))+N[0]+3921069994&4294967295,E=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(E^T))+N[5]+3593408605&4294967295,_=E+(v<<5&4294967295|v>>>27),v=A+(E^T&(_^E))+N[10]+38016083&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^E&(A^_))+N[15]+3634488961&4294967295,T=A+(v<<14&4294967295|v>>>18),v=E+(A^_&(T^A))+N[4]+3889429448&4294967295,E=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(E^T))+N[9]+568446438&4294967295,_=E+(v<<5&4294967295|v>>>27),v=A+(E^T&(_^E))+N[14]+3275163606&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^E&(A^_))+N[3]+4107603335&4294967295,T=A+(v<<14&4294967295|v>>>18),v=E+(A^_&(T^A))+N[8]+1163531501&4294967295,E=T+(v<<20&4294967295|v>>>12),v=_+(T^A&(E^T))+N[13]+2850285829&4294967295,_=E+(v<<5&4294967295|v>>>27),v=A+(E^T&(_^E))+N[2]+4243563512&4294967295,A=_+(v<<9&4294967295|v>>>23),v=T+(_^E&(A^_))+N[7]+1735328473&4294967295,T=A+(v<<14&4294967295|v>>>18),v=E+(A^_&(T^A))+N[12]+2368359562&4294967295,E=T+(v<<20&4294967295|v>>>12),v=_+(E^T^A)+N[5]+4294588738&4294967295,_=E+(v<<4&4294967295|v>>>28),v=A+(_^E^T)+N[8]+2272392833&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^E)+N[11]+1839030562&4294967295,T=A+(v<<16&4294967295|v>>>16),v=E+(T^A^_)+N[14]+4259657740&4294967295,E=T+(v<<23&4294967295|v>>>9),v=_+(E^T^A)+N[1]+2763975236&4294967295,_=E+(v<<4&4294967295|v>>>28),v=A+(_^E^T)+N[4]+1272893353&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^E)+N[7]+4139469664&4294967295,T=A+(v<<16&4294967295|v>>>16),v=E+(T^A^_)+N[10]+3200236656&4294967295,E=T+(v<<23&4294967295|v>>>9),v=_+(E^T^A)+N[13]+681279174&4294967295,_=E+(v<<4&4294967295|v>>>28),v=A+(_^E^T)+N[0]+3936430074&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^E)+N[3]+3572445317&4294967295,T=A+(v<<16&4294967295|v>>>16),v=E+(T^A^_)+N[6]+76029189&4294967295,E=T+(v<<23&4294967295|v>>>9),v=_+(E^T^A)+N[9]+3654602809&4294967295,_=E+(v<<4&4294967295|v>>>28),v=A+(_^E^T)+N[12]+3873151461&4294967295,A=_+(v<<11&4294967295|v>>>21),v=T+(A^_^E)+N[15]+530742520&4294967295,T=A+(v<<16&4294967295|v>>>16),v=E+(T^A^_)+N[2]+3299628645&4294967295,E=T+(v<<23&4294967295|v>>>9),v=_+(T^(E|~A))+N[0]+4096336452&4294967295,_=E+(v<<6&4294967295|v>>>26),v=A+(E^(_|~T))+N[7]+1126891415&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~E))+N[14]+2878612391&4294967295,T=A+(v<<15&4294967295|v>>>17),v=E+(A^(T|~_))+N[5]+4237533241&4294967295,E=T+(v<<21&4294967295|v>>>11),v=_+(T^(E|~A))+N[12]+1700485571&4294967295,_=E+(v<<6&4294967295|v>>>26),v=A+(E^(_|~T))+N[3]+2399980690&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~E))+N[10]+4293915773&4294967295,T=A+(v<<15&4294967295|v>>>17),v=E+(A^(T|~_))+N[1]+2240044497&4294967295,E=T+(v<<21&4294967295|v>>>11),v=_+(T^(E|~A))+N[8]+1873313359&4294967295,_=E+(v<<6&4294967295|v>>>26),v=A+(E^(_|~T))+N[15]+4264355552&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~E))+N[6]+2734768916&4294967295,T=A+(v<<15&4294967295|v>>>17),v=E+(A^(T|~_))+N[13]+1309151649&4294967295,E=T+(v<<21&4294967295|v>>>11),v=_+(T^(E|~A))+N[4]+4149444226&4294967295,_=E+(v<<6&4294967295|v>>>26),v=A+(E^(_|~T))+N[11]+3174756917&4294967295,A=_+(v<<10&4294967295|v>>>22),v=T+(_^(A|~E))+N[2]+718787259&4294967295,T=A+(v<<15&4294967295|v>>>17),v=E+(A^(T|~_))+N[9]+3951481745&4294967295,R.g[0]=R.g[0]+_&4294967295,R.g[1]=R.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,R.g[2]=R.g[2]+T&4294967295,R.g[3]=R.g[3]+A&4294967295}r.prototype.u=function(R,_){_===void 0&&(_=R.length);for(var E=_-this.blockSize,N=this.B,T=this.h,A=0;A<_;){if(T==0)for(;A<=E;)s(this,R,A),A+=this.blockSize;if(typeof R=="string"){for(;A<_;)if(N[T++]=R.charCodeAt(A++),T==this.blockSize){s(this,N),T=0;break}}else for(;A<_;)if(N[T++]=R[A++],T==this.blockSize){s(this,N),T=0;break}}this.h=T,this.o+=_},r.prototype.v=function(){var R=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);R[0]=128;for(var _=1;_<R.length-8;++_)R[_]=0;var E=8*this.o;for(_=R.length-8;_<R.length;++_)R[_]=E&255,E/=256;for(this.u(R),R=Array(16),_=E=0;4>_;++_)for(var N=0;32>N;N+=8)R[E++]=this.g[_]>>>N&255;return R};function i(R,_){var E=a;return Object.prototype.hasOwnProperty.call(E,R)?E[R]:E[R]=_(R)}function o(R,_){this.h=_;for(var E=[],N=!0,T=R.length-1;0<=T;T--){var A=R[T]|0;N&&A==_||(E[T]=A,N=!1)}this.g=E}var a={};function c(R){return-128<=R&&128>R?i(R,function(_){return new o([_|0],0>_?-1:0)}):new o([R|0],0>R?-1:0)}function u(R){if(isNaN(R)||!isFinite(R))return f;if(0>R)return k(u(-R));for(var _=[],E=1,N=0;R>=E;N++)_[N]=R/E|0,E*=4294967296;return new o(_,0)}function h(R,_){if(R.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(R.charAt(0)=="-")return k(h(R.substring(1),_));if(0<=R.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=u(Math.pow(_,8)),N=f,T=0;T<R.length;T+=8){var A=Math.min(8,R.length-T),v=parseInt(R.substring(T,T+A),_);8>A?(A=u(Math.pow(_,A)),N=N.j(A).add(u(v))):(N=N.j(E),N=N.add(u(v)))}return N}var f=c(0),m=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(S(this))return-k(this).m();for(var R=0,_=1,E=0;E<this.g.length;E++){var N=this.i(E);R+=(0<=N?N:4294967296+N)*_,_*=4294967296}return R},n.toString=function(R){if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(w(this))return"0";if(S(this))return"-"+k(this).toString(R);for(var _=u(Math.pow(R,6)),E=this,N="";;){var T=D(E,_).g;E=I(E,T.j(_));var A=((0<E.g.length?E.g[0]:E.h)>>>0).toString(R);if(E=T,w(E))return A+N;for(;6>A.length;)A="0"+A;N=A+N}},n.i=function(R){return 0>R?0:R<this.g.length?this.g[R]:this.h};function w(R){if(R.h!=0)return!1;for(var _=0;_<R.g.length;_++)if(R.g[_]!=0)return!1;return!0}function S(R){return R.h==-1}n.l=function(R){return R=I(this,R),S(R)?-1:w(R)?0:1};function k(R){for(var _=R.g.length,E=[],N=0;N<_;N++)E[N]=~R.g[N];return new o(E,~R.h).add(m)}n.abs=function(){return S(this)?k(this):this},n.add=function(R){for(var _=Math.max(this.g.length,R.g.length),E=[],N=0,T=0;T<=_;T++){var A=N+(this.i(T)&65535)+(R.i(T)&65535),v=(A>>>16)+(this.i(T)>>>16)+(R.i(T)>>>16);N=v>>>16,A&=65535,v&=65535,E[T]=v<<16|A}return new o(E,E[E.length-1]&-2147483648?-1:0)};function I(R,_){return R.add(k(_))}n.j=function(R){if(w(this)||w(R))return f;if(S(this))return S(R)?k(this).j(k(R)):k(k(this).j(R));if(S(R))return k(this.j(k(R)));if(0>this.l(y)&&0>R.l(y))return u(this.m()*R.m());for(var _=this.g.length+R.g.length,E=[],N=0;N<2*_;N++)E[N]=0;for(N=0;N<this.g.length;N++)for(var T=0;T<R.g.length;T++){var A=this.i(N)>>>16,v=this.i(N)&65535,B=R.i(T)>>>16,ye=R.i(T)&65535;E[2*N+2*T]+=v*ye,x(E,2*N+2*T),E[2*N+2*T+1]+=A*ye,x(E,2*N+2*T+1),E[2*N+2*T+1]+=v*B,x(E,2*N+2*T+1),E[2*N+2*T+2]+=A*B,x(E,2*N+2*T+2)}for(N=0;N<_;N++)E[N]=E[2*N+1]<<16|E[2*N];for(N=_;N<2*_;N++)E[N]=0;return new o(E,0)};function x(R,_){for(;(R[_]&65535)!=R[_];)R[_+1]+=R[_]>>>16,R[_]&=65535,_++}function C(R,_){this.g=R,this.h=_}function D(R,_){if(w(_))throw Error("division by zero");if(w(R))return new C(f,f);if(S(R))return _=D(k(R),_),new C(k(_.g),k(_.h));if(S(_))return _=D(R,k(_)),new C(k(_.g),_.h);if(30<R.g.length){if(S(R)||S(_))throw Error("slowDivide_ only works with positive integers.");for(var E=m,N=_;0>=N.l(R);)E=U(E),N=U(N);var T=L(E,1),A=L(N,1);for(N=L(N,2),E=L(E,2);!w(N);){var v=A.add(N);0>=v.l(R)&&(T=T.add(E),A=v),N=L(N,1),E=L(E,1)}return _=I(R,T.j(_)),new C(T,_)}for(T=f;0<=R.l(_);){for(E=Math.max(1,Math.floor(R.m()/_.m())),N=Math.ceil(Math.log(E)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),A=u(E),v=A.j(_);S(v)||0<v.l(R);)E-=N,A=u(E),v=A.j(_);w(A)&&(A=m),T=T.add(A),R=I(R,v)}return new C(T,R)}n.A=function(R){return D(this,R).h},n.and=function(R){for(var _=Math.max(this.g.length,R.g.length),E=[],N=0;N<_;N++)E[N]=this.i(N)&R.i(N);return new o(E,this.h&R.h)},n.or=function(R){for(var _=Math.max(this.g.length,R.g.length),E=[],N=0;N<_;N++)E[N]=this.i(N)|R.i(N);return new o(E,this.h|R.h)},n.xor=function(R){for(var _=Math.max(this.g.length,R.g.length),E=[],N=0;N<_;N++)E[N]=this.i(N)^R.i(N);return new o(E,this.h^R.h)};function U(R){for(var _=R.g.length+1,E=[],N=0;N<_;N++)E[N]=R.i(N)<<1|R.i(N-1)>>>31;return new o(E,R.h)}function L(R,_){var E=_>>5;_%=32;for(var N=R.g.length-E,T=[],A=0;A<N;A++)T[A]=0<_?R.i(A+E)>>>_|R.i(A+E+1)<<32-_:R.i(A+E);return new o(T,R.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,cR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Ro=o}).apply(typeof Qb<"u"?Qb:typeof self<"u"?self:typeof window<"u"?window:{});var Ef=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var uR,Ou,dR,tm,C0,hR,fR,mR;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,g,p){return d==Array.prototype||d==Object.prototype||(d[g]=p.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ef=="object"&&Ef];for(var g=0;g<d.length;++g){var p=d[g];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function s(d,g){if(g)e:{var p=r;d=d.split(".");for(var b=0;b<d.length-1;b++){var O=d[b];if(!(O in p))break e;p=p[O]}d=d[d.length-1],b=p[d],g=g(b),g!=b&&g!=null&&e(p,d,{configurable:!0,writable:!0,value:g})}}function i(d,g){d instanceof String&&(d+="");var p=0,b=!1,O={next:function(){if(!b&&p<d.length){var $=p++;return{value:g($,d[$]),done:!1}}return b=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(d){return d||function(){return i(this,function(g,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function c(d){var g=typeof d;return g=g!="object"?g:d?Array.isArray(d)?"array":g:"null",g=="array"||g=="object"&&typeof d.length=="number"}function u(d){var g=typeof d;return g=="object"&&d!=null||g=="function"}function h(d,g,p){return d.call.apply(d.bind,arguments)}function f(d,g,p){if(!d)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,b),d.apply(g,O)}}return function(){return d.apply(g,arguments)}}function m(d,g,p){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function y(d,g){var p=Array.prototype.slice.call(arguments,1);return function(){var b=p.slice();return b.push.apply(b,arguments),d.apply(this,b)}}function w(d,g){function p(){}p.prototype=g.prototype,d.aa=g.prototype,d.prototype=new p,d.prototype.constructor=d,d.Qb=function(b,O,$){for(var le=Array(arguments.length-2),Ot=2;Ot<arguments.length;Ot++)le[Ot-2]=arguments[Ot];return g.prototype[O].apply(b,le)}}function S(d){const g=d.length;if(0<g){const p=Array(g);for(let b=0;b<g;b++)p[b]=d[b];return p}return[]}function k(d,g){for(let p=1;p<arguments.length;p++){const b=arguments[p];if(c(b)){const O=d.length||0,$=b.length||0;d.length=O+$;for(let le=0;le<$;le++)d[O+le]=b[le]}else d.push(b)}}class I{constructor(g,p){this.i=g,this.j=p,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function x(d){return/^[\s\xa0]*$/.test(d)}function C(){var d=a.navigator;return d&&(d=d.userAgent)?d:""}function D(d){return D[" "](d),d}D[" "]=function(){};var U=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function L(d,g,p){for(const b in d)g.call(p,d[b],b,d)}function R(d,g){for(const p in d)g.call(void 0,d[p],p,d)}function _(d){const g={};for(const p in d)g[p]=d[p];return g}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(d,g){let p,b;for(let O=1;O<arguments.length;O++){b=arguments[O];for(p in b)d[p]=b[p];for(let $=0;$<E.length;$++)p=E[$],Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}}function T(d){var g=1;d=d.split(":");const p=[];for(;0<g&&d.length;)p.push(d.shift()),g--;return d.length&&p.push(d.join(":")),p}function A(d){a.setTimeout(()=>{throw d},0)}function v(){var d=we;let g=null;return d.g&&(g=d.g,d.g=d.g.next,d.g||(d.h=null),g.next=null),g}class B{constructor(){this.h=this.g=null}add(g,p){const b=ye.get();b.set(g,p),this.h?this.h.next=b:this.g=b,this.h=b}}var ye=new I(()=>new Te,d=>d.reset());class Te{constructor(){this.next=this.g=this.h=null}set(g,p){this.h=g,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let ft,Q=!1,we=new B,se=()=>{const d=a.Promise.resolve(void 0);ft=()=>{d.then(Ie)}};var Ie=()=>{for(var d;d=v();){try{d.h.call(d.g)}catch(p){A(p)}var g=ye;g.j(d),100>g.h&&(g.h++,d.next=g.g,g.g=d)}Q=!1};function Ae(){this.s=this.s,this.C=this.C}Ae.prototype.s=!1,Ae.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function j(d,g){this.type=d,this.g=this.target=g,this.defaultPrevented=!1}j.prototype.h=function(){this.defaultPrevented=!0};var W=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var d=!1,g=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const p=()=>{};a.addEventListener("test",p,g),a.removeEventListener("test",p,g)}catch{}return d}();function de(d,g){if(j.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var p=this.type=d.type,b=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=g,g=d.relatedTarget){if(U){e:{try{D(g.nodeName);var O=!0;break e}catch{}O=!1}O||(g=null)}}else p=="mouseover"?g=d.fromElement:p=="mouseout"&&(g=d.toElement);this.relatedTarget=g,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:me[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&de.aa.h.call(this)}}w(de,j);var me={2:"touch",3:"pen",4:"mouse"};de.prototype.h=function(){de.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var Ce="closure_listenable_"+(1e6*Math.random()|0),ce=0;function te(d,g,p,b,O){this.listener=d,this.proxy=null,this.src=g,this.type=p,this.capture=!!b,this.ha=O,this.key=++ce,this.da=this.fa=!1}function ve(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function fe(d){this.src=d,this.g={},this.h=0}fe.prototype.add=function(d,g,p,b,O){var $=d.toString();d=this.g[$],d||(d=this.g[$]=[],this.h++);var le=_e(d,g,b,O);return-1<le?(g=d[le],p||(g.fa=!1)):(g=new te(g,this.src,$,!!b,O),g.fa=p,d.push(g)),g};function pe(d,g){var p=g.type;if(p in d.g){var b=d.g[p],O=Array.prototype.indexOf.call(b,g,void 0),$;($=0<=O)&&Array.prototype.splice.call(b,O,1),$&&(ve(g),d.g[p].length==0&&(delete d.g[p],d.h--))}}function _e(d,g,p,b){for(var O=0;O<d.length;++O){var $=d[O];if(!$.da&&$.listener==g&&$.capture==!!p&&$.ha==b)return O}return-1}var qe="closure_lm_"+(1e6*Math.random()|0),H={};function X(d,g,p,b,O){if(b&&b.once)return De(d,g,p,b,O);if(Array.isArray(g)){for(var $=0;$<g.length;$++)X(d,g[$],p,b,O);return null}return p=ht(p),d&&d[Ce]?d.K(g,p,u(b)?!!b.capture:!!b,O):Y(d,g,p,!1,b,O)}function Y(d,g,p,b,O,$){if(!g)throw Error("Invalid event type");var le=u(O)?!!O.capture:!!O,Ot=mt(d);if(Ot||(d[qe]=Ot=new fe(d)),p=Ot.add(g,p,b,le,$),p.proxy)return p;if(b=Ve(),p.proxy=b,b.src=d,b.listener=p,d.addEventListener)W||(O=le),O===void 0&&(O=!1),d.addEventListener(g.toString(),b,O);else if(d.attachEvent)d.attachEvent(Mt(g.toString()),b);else if(d.addListener&&d.removeListener)d.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Ve(){function d(p){return g.call(d.src,d.listener,p)}const g=bt;return d}function De(d,g,p,b,O){if(Array.isArray(g)){for(var $=0;$<g.length;$++)De(d,g[$],p,b,O);return null}return p=ht(p),d&&d[Ce]?d.L(g,p,u(b)?!!b.capture:!!b,O):Y(d,g,p,!0,b,O)}function Re(d,g,p,b,O){if(Array.isArray(g))for(var $=0;$<g.length;$++)Re(d,g[$],p,b,O);else b=u(b)?!!b.capture:!!b,p=ht(p),d&&d[Ce]?(d=d.i,g=String(g).toString(),g in d.g&&($=d.g[g],p=_e($,p,b,O),-1<p&&(ve($[p]),Array.prototype.splice.call($,p,1),$.length==0&&(delete d.g[g],d.h--)))):d&&(d=mt(d))&&(g=d.g[g.toString()],d=-1,g&&(d=_e(g,p,b,O)),(p=-1<d?g[d]:null)&&xt(p))}function xt(d){if(typeof d!="number"&&d&&!d.da){var g=d.src;if(g&&g[Ce])pe(g.i,d);else{var p=d.type,b=d.proxy;g.removeEventListener?g.removeEventListener(p,b,d.capture):g.detachEvent?g.detachEvent(Mt(p),b):g.addListener&&g.removeListener&&g.removeListener(b),(p=mt(g))?(pe(p,d),p.h==0&&(p.src=null,g[qe]=null)):ve(d)}}}function Mt(d){return d in H?H[d]:H[d]="on"+d}function bt(d,g){if(d.da)d=!0;else{g=new de(g,this);var p=d.listener,b=d.ha||d.src;d.fa&&xt(d),d=p.call(b,g)}return d}function mt(d){return d=d[qe],d instanceof fe?d:null}var Et="__closure_events_fn_"+(1e9*Math.random()>>>0);function ht(d){return typeof d=="function"?d:(d[Et]||(d[Et]=function(g){return d.handleEvent(g)}),d[Et])}function Pe(){Ae.call(this),this.i=new fe(this),this.M=this,this.F=null}w(Pe,Ae),Pe.prototype[Ce]=!0,Pe.prototype.removeEventListener=function(d,g,p,b){Re(this,d,g,p,b)};function He(d,g){var p,b=d.F;if(b)for(p=[];b;b=b.F)p.push(b);if(d=d.M,b=g.type||g,typeof g=="string")g=new j(g,d);else if(g instanceof j)g.target=g.target||d;else{var O=g;g=new j(b,d),N(g,O)}if(O=!0,p)for(var $=p.length-1;0<=$;$--){var le=g.g=p[$];O=ln(le,b,!0,g)&&O}if(le=g.g=d,O=ln(le,b,!0,g)&&O,O=ln(le,b,!1,g)&&O,p)for($=0;$<p.length;$++)le=g.g=p[$],O=ln(le,b,!1,g)&&O}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var d=this.i,g;for(g in d.g){for(var p=d.g[g],b=0;b<p.length;b++)ve(p[b]);delete d.g[g],d.h--}}this.F=null},Pe.prototype.K=function(d,g,p,b){return this.i.add(String(d),g,!1,p,b)},Pe.prototype.L=function(d,g,p,b){return this.i.add(String(d),g,!0,p,b)};function ln(d,g,p,b){if(g=d.i.g[String(g)],!g)return!0;g=g.concat();for(var O=!0,$=0;$<g.length;++$){var le=g[$];if(le&&!le.da&&le.capture==p){var Ot=le.listener,Xn=le.ha||le.src;le.fa&&pe(d.i,le),O=Ot.call(Xn,b)!==!1&&O}}return O&&!b.defaultPrevented}function Wt(d,g,p){if(typeof d=="function")p&&(d=m(d,p));else if(d&&typeof d.handleEvent=="function")d=m(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:a.setTimeout(d,g||0)}function In(d){d.g=Wt(()=>{d.g=null,d.i&&(d.i=!1,In(d))},d.l);const g=d.h;d.h=null,d.m.apply(null,g)}class On extends Ae{constructor(g,p){super(),this.m=g,this.l=p,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:In(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xt(d){Ae.call(this),this.h=d,this.g={}}w(Xt,Ae);var ir=[];function mn(d){L(d.g,function(g,p){this.g.hasOwnProperty(p)&&xt(g)},d),d.g={}}Xt.prototype.N=function(){Xt.aa.N.call(this),mn(this)},Xt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Kn=a.JSON.stringify,vt=a.JSON.parse,Rt=class{stringify(d){return a.JSON.stringify(d,void 0)}parse(d){return a.JSON.parse(d,void 0)}};function bn(){}bn.prototype.h=null;function ot(d){return d.h||(d.h=d.i())}function rt(){}var Zt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ae(){j.call(this,"d")}w(ae,j);function Tt(){j.call(this,"c")}w(Tt,j);var Gt={},ns=null;function Yn(){return ns=ns||new Pe}Gt.La="serverreachability";function su(d){j.call(this,Gt.La,d)}w(su,j);function Hi(d){const g=Yn();He(g,new su(g))}Gt.STAT_EVENT="statevent";function Qh(d,g){j.call(this,Gt.STAT_EVENT,d),this.stat=g}w(Qh,j);function Vn(d){const g=Yn();He(g,new Qh(g,d))}Gt.Ma="timingevent";function Kh(d,g){j.call(this,Gt.Ma,d),this.size=g}w(Kh,j);function ra(d,g){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){d()},g)}function fi(){this.g=!0}fi.prototype.xa=function(){this.g=!1};function iu(d,g,p,b,O,$){d.info(function(){if(d.g)if($)for(var le="",Ot=$.split("&"),Xn=0;Xn<Ot.length;Xn++){var _t=Ot[Xn].split("=");if(1<_t.length){var lr=_t[0];_t=_t[1];var cr=lr.split("_");le=2<=cr.length&&cr[1]=="type"?le+(lr+"="+_t+"&"):le+(lr+"=redacted&")}}else le=null;else le=$;return"XMLHTTP REQ ("+b+") [attempt "+O+"]: "+g+`
`+p+`
`+le})}function ny(d,g,p,b,O,$,le){d.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+O+"]: "+g+`
`+p+`
`+$+" "+le})}function Qi(d,g,p,b){d.info(function(){return"XMLHTTP TEXT ("+g+"): "+sy(d,p)+(b?" "+b:"")})}function ry(d,g){d.info(function(){return"TIMEOUT: "+g})}fi.prototype.info=function(){};function sy(d,g){if(!d.g)return g;if(!g)return null;try{var p=JSON.parse(g);if(p){for(d=0;d<p.length;d++)if(Array.isArray(p[d])){var b=p[d];if(!(2>b.length)){var O=b[1];if(Array.isArray(O)&&!(1>O.length)){var $=O[0];if($!="noop"&&$!="stop"&&$!="close")for(var le=1;le<O.length;le++)O[le]=""}}}}return Kn(p)}catch{return g}}var M={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},K={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},z;function ue(){}w(ue,bn),ue.prototype.g=function(){return new XMLHttpRequest},ue.prototype.i=function(){return{}},z=new ue;function Ne(d,g,p,b){this.j=d,this.i=g,this.l=p,this.R=b||1,this.U=new Xt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Qe}function Qe(){this.i=null,this.g="",this.h=!1}var Ee={},Oe={};function Be(d,g,p){d.L=1,d.v=mi(ar(g)),d.m=p,d.P=!0,kt(d,null)}function kt(d,g){d.F=Date.now(),Ze(d),d.A=ar(d.v);var p=d.A,b=d.R;Array.isArray(b)||(b=[String(b)]),TS(p.i,"t",b),d.C=0,p=d.j.J,d.h=new Qe,d.g=qS(d.j,p?g:null,!d.m),0<d.O&&(d.M=new On(m(d.Y,d,d.g),d.O)),g=d.U,p=d.g,b=d.ca;var O="readystatechange";Array.isArray(O)||(O&&(ir[0]=O.toString()),O=ir);for(var $=0;$<O.length;$++){var le=X(p,O[$],b||g.handleEvent,!1,g.h||g);if(!le)break;g.g[le.key]=le}g=d.H?_(d.H):{},d.m?(d.u||(d.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,g)):(d.u="GET",d.g.ea(d.A,d.u,null,g)),Hi(),iu(d.i,d.u,d.A,d.l,d.R,d.m)}Ne.prototype.ca=function(d){d=d.target;const g=this.M;g&&gi(d)==3?g.j():this.Y(d)},Ne.prototype.Y=function(d){try{if(d==this.g)e:{const cr=gi(this.g);var g=this.g.Ba();const vl=this.g.Z();if(!(3>cr)&&(cr!=3||this.g&&(this.h.h||this.g.oa()||PS(this.g)))){this.J||cr!=4||g==7||(g==8||0>=vl?Hi(3):Hi(2)),$e(this);var p=this.g.Z();this.X=p;t:if(Je(this)){var b=PS(this.g);d="";var O=b.length,$=gi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){We(this),je(this);var le="";break t}this.h.i=new a.TextDecoder}for(g=0;g<O;g++)this.h.h=!0,d+=this.h.i.decode(b[g],{stream:!($&&g==O-1)});b.length=0,this.h.g+=d,this.C=0,le=this.h.g}else le=this.g.oa();if(this.o=p==200,ny(this.i,this.u,this.A,this.l,this.R,cr,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Ot,Xn=this.g;if((Ot=Xn.g?Xn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Ot)){var _t=Ot;break t}}_t=null}if(p=_t)Qi(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cn(this,p);else{this.o=!1,this.s=3,Vn(12),We(this),je(this);break e}}if(this.P){p=!0;let _s;for(;!this.J&&this.C<le.length;)if(_s=Ke(this,le),_s==Oe){cr==4&&(this.s=4,Vn(14),p=!1),Qi(this.i,this.l,null,"[Incomplete Response]");break}else if(_s==Ee){this.s=4,Vn(15),Qi(this.i,this.l,le,"[Invalid Chunk]"),p=!1;break}else Qi(this.i,this.l,_s,null),Cn(this,_s);if(Je(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),cr!=4||le.length!=0||this.h.h||(this.s=1,Vn(16),p=!1),this.o=this.o&&p,!p)Qi(this.i,this.l,le,"[Invalid Chunked Response]"),We(this),je(this);else if(0<le.length&&!this.W){this.W=!0;var lr=this.j;lr.g==this&&lr.ba&&!lr.M&&(lr.j.info("Great, no buffering proxy detected. Bytes received: "+le.length),ly(lr),lr.M=!0,Vn(11))}}else Qi(this.i,this.l,le,null),Cn(this,le);cr==4&&We(this),this.o&&!this.J&&(cr==4?US(this.j,this):(this.o=!1,Ze(this)))}else j2(this.g),p==400&&0<le.indexOf("Unknown SID")?(this.s=3,Vn(12)):(this.s=0,Vn(13)),We(this),je(this)}}}catch{}finally{}};function Je(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function Ke(d,g){var p=d.C,b=g.indexOf(`
`,p);return b==-1?Oe:(p=Number(g.substring(p,b)),isNaN(p)?Ee:(b+=1,b+p>g.length?Oe:(g=g.slice(b,b+p),d.C=b+p,g)))}Ne.prototype.cancel=function(){this.J=!0,We(this)};function Ze(d){d.S=Date.now()+d.I,Fe(d,d.I)}function Fe(d,g){if(d.B!=null)throw Error("WatchDog timer not null");d.B=ra(m(d.ba,d),g)}function $e(d){d.B&&(a.clearTimeout(d.B),d.B=null)}Ne.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(ry(this.i,this.A),this.L!=2&&(Hi(),Vn(17)),We(this),this.s=2,je(this)):Fe(this,this.S-d)};function je(d){d.j.G==0||d.J||US(d.j,d)}function We(d){$e(d);var g=d.M;g&&typeof g.ma=="function"&&g.ma(),d.M=null,mn(d.U),d.g&&(g=d.g,d.g=null,g.abort(),g.ma())}function Cn(d,g){try{var p=d.j;if(p.G!=0&&(p.g==d||rs(p.h,d))){if(!d.K&&rs(p.h,d)&&p.G==3){try{var b=p.Da.g.parse(g)}catch{b=null}if(Array.isArray(b)&&b.length==3){var O=b;if(O[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<d.F)tf(p),Zh(p);else break e;ay(p),Vn(18)}}else p.za=O[1],0<p.za-p.T&&37500>O[2]&&p.F&&p.v==0&&!p.C&&(p.C=ra(m(p.Za,p),6e3));if(1>=or(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else ia(p,11)}else if((d.K||p.g==d)&&tf(p),!x(g))for(O=p.Da.g.parse(g),g=0;g<O.length;g++){let _t=O[g];if(p.T=_t[0],_t=_t[1],p.G==2)if(_t[0]=="c"){p.K=_t[1],p.ia=_t[2];const lr=_t[3];lr!=null&&(p.la=lr,p.j.info("VER="+p.la));const cr=_t[4];cr!=null&&(p.Aa=cr,p.j.info("SVER="+p.Aa));const vl=_t[5];vl!=null&&typeof vl=="number"&&0<vl&&(b=1.5*vl,p.L=b,p.j.info("backChannelRequestTimeoutMs_="+b)),b=p;const _s=d.g;if(_s){const rf=_s.g?_s.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(rf){var $=b.h;$.g||rf.indexOf("spdy")==-1&&rf.indexOf("quic")==-1&&rf.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(ps($,$.h),$.h=null))}if(b.D){const cy=_s.g?_s.g.getResponseHeader("X-HTTP-Session-Id"):null;cy&&(b.ya=cy,pt(b.I,b.D,cy))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-d.F,p.j.info("Handshake RTT: "+p.R+"ms")),b=p;var le=d;if(b.qa=zS(b,b.J?b.ia:null,b.W),le.K){gl(b.h,le);var Ot=le,Xn=b.L;Xn&&(Ot.I=Xn),Ot.B&&($e(Ot),Ze(Ot)),b.g=le}else VS(b);0<p.i.length&&ef(p)}else _t[0]!="stop"&&_t[0]!="close"||ia(p,7);else p.G==3&&(_t[0]=="stop"||_t[0]=="close"?_t[0]=="stop"?ia(p,7):oy(p):_t[0]!="noop"&&p.l&&p.l.ta(_t),p.v=0)}}Hi(4)}catch{}}var St=class{constructor(d,g){this.g=d,this.map=g}};function At(d){this.l=d||10,a.PerformanceNavigationTiming?(d=a.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function at(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function or(d){return d.h?1:d.g?d.g.size:0}function rs(d,g){return d.h?d.h==g:d.g?d.g.has(g):!1}function ps(d,g){d.g?d.g.add(g):d.h=g}function gl(d,g){d.h&&d.h==g?d.h=null:d.g&&d.g.has(g)&&d.g.delete(g)}At.prototype.cancel=function(){if(this.i=Jn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function Jn(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let g=d.i;for(const p of d.g.values())g=g.concat(p.D);return g}return S(d.i)}function Xe(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(c(d)){for(var g=[],p=d.length,b=0;b<p;b++)g.push(d[b]);return g}g=[],p=0;for(b in d)g[p++]=d[b];return g}function It(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(c(d)||typeof d=="string"){var g=[];d=d.length;for(var p=0;p<d;p++)g.push(p);return g}g=[],p=0;for(const b in d)g[p++]=b;return g}}}function gn(d,g){if(d.forEach&&typeof d.forEach=="function")d.forEach(g,void 0);else if(c(d)||typeof d=="string")Array.prototype.forEach.call(d,g,void 0);else for(var p=It(d),b=Xe(d),O=b.length,$=0;$<O;$++)g.call(void 0,b[$],p&&p[$],d)}var en=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ss(d,g){if(d){d=d.split("&");for(var p=0;p<d.length;p++){var b=d[p].indexOf("="),O=null;if(0<=b){var $=d[p].substring(0,b);O=d[p].substring(b+1)}else $=d[p];g($,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function Or(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof Or){this.h=d.h,ys(this,d.j),this.o=d.o,this.g=d.g,Rn(this,d.s),this.l=d.l;var g=d.i,p=new ou;p.i=g.i,g.g&&(p.g=new Map(g.g),p.h=g.h),Ut(this,p),this.m=d.m}else d&&(g=String(d).match(en))?(this.h=!1,ys(this,g[1]||"",!0),this.o=sa(g[2]||""),this.g=sa(g[3]||"",!0),Rn(this,g[4]),this.l=sa(g[5]||"",!0),Ut(this,g[6]||"",!0),this.m=sa(g[7]||"")):(this.h=!1,this.i=new ou(null,this.h))}Or.prototype.toString=function(){var d=[],g=this.j;g&&d.push(vs(g,IS,!0),":");var p=this.g;return(p||g=="file")&&(d.push("//"),(g=this.o)&&d.push(vs(g,IS,!0),"@"),d.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&d.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&d.push("/"),d.push(vs(p,p.charAt(0)=="/"?b2:I2,!0))),(p=this.i.toString())&&d.push("?",p),(p=this.m)&&d.push("#",vs(p,T2)),d.join("")};function ar(d){return new Or(d)}function ys(d,g,p){d.j=p?sa(g,!0):g,d.j&&(d.j=d.j.replace(/:$/,""))}function Rn(d,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);d.s=g}else d.s=null}function Ut(d,g,p){g instanceof ou?(d.i=g,A2(d.i,d.h)):(p||(g=vs(g,E2)),d.i=new ou(g,d.h))}function pt(d,g,p){d.i.set(g,p)}function mi(d){return pt(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function sa(d,g){return d?g?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function vs(d,g,p){return typeof d=="string"?(d=encodeURI(d).replace(g,S2),p&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function S2(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var IS=/[#\/\?@]/g,I2=/[#\?:]/g,b2=/[#\?]/g,E2=/[#\?@]/g,T2=/#/g;function ou(d,g){this.h=this.g=null,this.i=d||null,this.j=!!g}function Ki(d){d.g||(d.g=new Map,d.h=0,d.i&&ss(d.i,function(g,p){d.add(decodeURIComponent(g.replace(/\+/g," ")),p)}))}n=ou.prototype,n.add=function(d,g){Ki(this),this.i=null,d=pl(this,d);var p=this.g.get(d);return p||this.g.set(d,p=[]),p.push(g),this.h+=1,this};function bS(d,g){Ki(d),g=pl(d,g),d.g.has(g)&&(d.i=null,d.h-=d.g.get(g).length,d.g.delete(g))}function ES(d,g){return Ki(d),g=pl(d,g),d.g.has(g)}n.forEach=function(d,g){Ki(this),this.g.forEach(function(p,b){p.forEach(function(O){d.call(g,O,b,this)},this)},this)},n.na=function(){Ki(this);const d=Array.from(this.g.values()),g=Array.from(this.g.keys()),p=[];for(let b=0;b<g.length;b++){const O=d[b];for(let $=0;$<O.length;$++)p.push(g[b])}return p},n.V=function(d){Ki(this);let g=[];if(typeof d=="string")ES(this,d)&&(g=g.concat(this.g.get(pl(this,d))));else{d=Array.from(this.g.values());for(let p=0;p<d.length;p++)g=g.concat(d[p])}return g},n.set=function(d,g){return Ki(this),this.i=null,d=pl(this,d),ES(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[g]),this.h+=1,this},n.get=function(d,g){return d?(d=this.V(d),0<d.length?String(d[0]):g):g};function TS(d,g,p){bS(d,g),0<p.length&&(d.i=null,d.g.set(pl(d,g),S(p)),d.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],g=Array.from(this.g.keys());for(var p=0;p<g.length;p++){var b=g[p];const $=encodeURIComponent(String(b)),le=this.V(b);for(b=0;b<le.length;b++){var O=$;le[b]!==""&&(O+="="+encodeURIComponent(String(le[b]))),d.push(O)}}return this.i=d.join("&")};function pl(d,g){return g=String(g),d.j&&(g=g.toLowerCase()),g}function A2(d,g){g&&!d.j&&(Ki(d),d.i=null,d.g.forEach(function(p,b){var O=b.toLowerCase();b!=O&&(bS(this,b),TS(this,O,p))},d)),d.j=g}function N2(d,g){const p=new fi;if(a.Image){const b=new Image;b.onload=y(Yi,p,"TestLoadImage: loaded",!0,g,b),b.onerror=y(Yi,p,"TestLoadImage: error",!1,g,b),b.onabort=y(Yi,p,"TestLoadImage: abort",!1,g,b),b.ontimeout=y(Yi,p,"TestLoadImage: timeout",!1,g,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=d}else g(!1)}function C2(d,g){const p=new fi,b=new AbortController,O=setTimeout(()=>{b.abort(),Yi(p,"TestPingServer: timeout",!1,g)},1e4);fetch(d,{signal:b.signal}).then($=>{clearTimeout(O),$.ok?Yi(p,"TestPingServer: ok",!0,g):Yi(p,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(O),Yi(p,"TestPingServer: error",!1,g)})}function Yi(d,g,p,b,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),b(p)}catch{}}function R2(){this.g=new Rt}function k2(d,g,p){const b=p||"";try{gn(d,function(O,$){let le=O;u(O)&&(le=Kn(O)),g.push(b+$+"="+encodeURIComponent(le))})}catch(O){throw g.push(b+"type="+encodeURIComponent("_badmap")),O}}function Yh(d){this.l=d.Ub||null,this.j=d.eb||!1}w(Yh,bn),Yh.prototype.g=function(){return new Jh(this.l,this.j)},Yh.prototype.i=function(d){return function(){return d}}({});function Jh(d,g){Pe.call(this),this.D=d,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(Jh,Pe),n=Jh.prototype,n.open=function(d,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=g,this.readyState=1,lu(this)},n.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(g.body=d),(this.D||a).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,au(this)),this.readyState=0},n.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,lu(this)),this.g&&(this.readyState=3,lu(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;AS(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function AS(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}n.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var g=d.value?d.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!d.done}))&&(this.response=this.responseText+=g)}d.done?au(this):lu(this),this.readyState==3&&AS(this)}},n.Ra=function(d){this.g&&(this.response=this.responseText=d,au(this))},n.Qa=function(d){this.g&&(this.response=d,au(this))},n.ga=function(){this.g&&au(this)};function au(d){d.readyState=4,d.l=null,d.j=null,d.v=null,lu(d)}n.setRequestHeader=function(d,g){this.u.append(d,g)},n.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],g=this.h.entries();for(var p=g.next();!p.done;)p=p.value,d.push(p[0]+": "+p[1]),p=g.next();return d.join(`\r
`)};function lu(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(Jh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function NS(d){let g="";return L(d,function(p,b){g+=b,g+=":",g+=p,g+=`\r
`}),g}function iy(d,g,p){e:{for(b in p){var b=!1;break e}b=!0}b||(p=NS(p),typeof d=="string"?p!=null&&encodeURIComponent(String(p)):pt(d,g,p))}function pn(d){Pe.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(pn,Pe);var D2=/^https?$/i,P2=["POST","PUT"];n=pn.prototype,n.Ha=function(d){this.J=d},n.ea=function(d,g,p,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);g=g?g.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():z.g(),this.v=this.o?ot(this.o):ot(z),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(g,String(d),!0),this.B=!1}catch($){CS(this,$);return}if(d=p||"",p=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var O in b)p.set(O,b[O]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const $ of b.keys())p.set($,b.get($));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(p.keys()).find($=>$.toLowerCase()=="content-type"),O=a.FormData&&d instanceof a.FormData,!(0<=Array.prototype.indexOf.call(P2,g,void 0))||b||O||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,le]of p)this.g.setRequestHeader($,le);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{DS(this),this.u=!0,this.g.send(d),this.u=!1}catch($){CS(this,$)}};function CS(d,g){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=g,d.m=5,RS(d),Xh(d)}function RS(d){d.A||(d.A=!0,He(d,"complete"),He(d,"error"))}n.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,He(this,"complete"),He(this,"abort"),Xh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xh(this,!0)),pn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?kS(this):this.bb())},n.bb=function(){kS(this)};function kS(d){if(d.h&&typeof o<"u"&&(!d.v[1]||gi(d)!=4||d.Z()!=2)){if(d.u&&gi(d)==4)Wt(d.Ea,0,d);else if(He(d,"readystatechange"),gi(d)==4){d.h=!1;try{const le=d.Z();e:switch(le){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var p;if(!(p=g)){var b;if(b=le===0){var O=String(d.D).match(en)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),b=!D2.test(O?O.toLowerCase():"")}p=b}if(p)He(d,"complete"),He(d,"success");else{d.m=6;try{var $=2<gi(d)?d.g.statusText:""}catch{$=""}d.l=$+" ["+d.Z()+"]",RS(d)}}finally{Xh(d)}}}}function Xh(d,g){if(d.g){DS(d);const p=d.g,b=d.v[0]?()=>{}:null;d.g=null,d.v=null,g||He(d,"ready");try{p.onreadystatechange=b}catch{}}}function DS(d){d.I&&(a.clearTimeout(d.I),d.I=null)}n.isActive=function(){return!!this.g};function gi(d){return d.g?d.g.readyState:0}n.Z=function(){try{return 2<gi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(d){if(this.g){var g=this.g.responseText;return d&&g.indexOf(d)==0&&(g=g.substring(d.length)),vt(g)}};function PS(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function j2(d){const g={};d=(d.g&&2<=gi(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<d.length;b++){if(x(d[b]))continue;var p=T(d[b]);const O=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const $=g[O]||[];g[O]=$,$.push(p)}R(g,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function cu(d,g,p){return p&&p.internalChannelParams&&p.internalChannelParams[d]||g}function jS(d){this.Aa=0,this.i=[],this.j=new fi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=cu("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=cu("baseRetryDelayMs",5e3,d),this.cb=cu("retryDelaySeedMs",1e4,d),this.Wa=cu("forwardChannelMaxRetries",2,d),this.wa=cu("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new At(d&&d.concurrentRequestLimit),this.Da=new R2,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=jS.prototype,n.la=8,n.G=1,n.connect=function(d,g,p,b){Vn(0),this.W=d,this.H=g||{},p&&b!==void 0&&(this.H.OSID=p,this.H.OAID=b),this.F=this.X,this.I=zS(this,null,this.W),ef(this)};function oy(d){if(LS(d),d.G==3){var g=d.U++,p=ar(d.I);if(pt(p,"SID",d.K),pt(p,"RID",g),pt(p,"TYPE","terminate"),uu(d,p),g=new Ne(d,d.j,g),g.L=2,g.v=mi(ar(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(g.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=g.v,p=!0),p||(g.g=qS(g.j,null),g.g.ea(g.v)),g.F=Date.now(),Ze(g)}BS(d)}function Zh(d){d.g&&(ly(d),d.g.cancel(),d.g=null)}function LS(d){Zh(d),d.u&&(a.clearTimeout(d.u),d.u=null),tf(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&a.clearTimeout(d.s),d.s=null)}function ef(d){if(!at(d.h)&&!d.s){d.s=!0;var g=d.Ga;ft||se(),Q||(ft(),Q=!0),we.add(g,d),d.B=0}}function L2(d,g){return or(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=g.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=ra(m(d.Ga,d,g),$S(d,d.B)),d.B++,!0)}n.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const O=new Ne(this,this.j,d);let $=this.o;if(this.S&&($?($=_($),N($,this.S)):$=this.S),this.m!==null||this.O||(O.H=$,$=null),this.P)e:{for(var g=0,p=0;p<this.i.length;p++){t:{var b=this.i[p];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(g+=b,4096<g){g=p;break e}if(g===4096||p===this.i.length-1){g=p+1;break e}}g=1e3}else g=1e3;g=OS(this,O,g),p=ar(this.I),pt(p,"RID",d),pt(p,"CVER",22),this.D&&pt(p,"X-HTTP-Session-Id",this.D),uu(this,p),$&&(this.O?g="headers="+encodeURIComponent(String(NS($)))+"&"+g:this.m&&iy(p,this.m,$)),ps(this.h,O),this.Ua&&pt(p,"TYPE","init"),this.P?(pt(p,"$req",g),pt(p,"SID","null"),O.T=!0,Be(O,p,null)):Be(O,p,g),this.G=2}}else this.G==3&&(d?MS(this,d):this.i.length==0||at(this.h)||MS(this))};function MS(d,g){var p;g?p=g.l:p=d.U++;const b=ar(d.I);pt(b,"SID",d.K),pt(b,"RID",p),pt(b,"AID",d.T),uu(d,b),d.m&&d.o&&iy(b,d.m,d.o),p=new Ne(d,d.j,p,d.B+1),d.m===null&&(p.H=d.o),g&&(d.i=g.D.concat(d.i)),g=OS(d,p,1e3),p.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),ps(d.h,p),Be(p,b,g)}function uu(d,g){d.H&&L(d.H,function(p,b){pt(g,b,p)}),d.l&&gn({},function(p,b){pt(g,b,p)})}function OS(d,g,p){p=Math.min(d.i.length,p);var b=d.l?m(d.l.Na,d.l,d):null;e:{var O=d.i;let $=-1;for(;;){const le=["count="+p];$==-1?0<p?($=O[0].g,le.push("ofs="+$)):$=0:le.push("ofs="+$);let Ot=!0;for(let Xn=0;Xn<p;Xn++){let _t=O[Xn].g;const lr=O[Xn].map;if(_t-=$,0>_t)$=Math.max(0,O[Xn].g-100),Ot=!1;else try{k2(lr,le,"req"+_t+"_")}catch{b&&b(lr)}}if(Ot){b=le.join("&");break e}}}return d=d.i.splice(0,p),g.D=d,b}function VS(d){if(!d.g&&!d.u){d.Y=1;var g=d.Fa;ft||se(),Q||(ft(),Q=!0),we.add(g,d),d.v=0}}function ay(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=ra(m(d.Fa,d),$S(d,d.v)),d.v++,!0)}n.Fa=function(){if(this.u=null,FS(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=ra(m(this.ab,this),d)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Vn(10),Zh(this),FS(this))};function ly(d){d.A!=null&&(a.clearTimeout(d.A),d.A=null)}function FS(d){d.g=new Ne(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var g=ar(d.qa);pt(g,"RID","rpc"),pt(g,"SID",d.K),pt(g,"AID",d.T),pt(g,"CI",d.F?"0":"1"),!d.F&&d.ja&&pt(g,"TO",d.ja),pt(g,"TYPE","xmlhttp"),uu(d,g),d.m&&d.o&&iy(g,d.m,d.o),d.L&&(d.g.I=d.L);var p=d.g;d=d.ia,p.L=1,p.v=mi(ar(g)),p.m=null,p.P=!0,kt(p,d)}n.Za=function(){this.C!=null&&(this.C=null,Zh(this),ay(this),Vn(19))};function tf(d){d.C!=null&&(a.clearTimeout(d.C),d.C=null)}function US(d,g){var p=null;if(d.g==g){tf(d),ly(d),d.g=null;var b=2}else if(rs(d.h,g))p=g.D,gl(d.h,g),b=1;else return;if(d.G!=0){if(g.o)if(b==1){p=g.m?g.m.length:0,g=Date.now()-g.F;var O=d.B;b=Yn(),He(b,new Kh(b,p)),ef(d)}else VS(d);else if(O=g.s,O==3||O==0&&0<g.X||!(b==1&&L2(d,g)||b==2&&ay(d)))switch(p&&0<p.length&&(g=d.h,g.i=g.i.concat(p)),O){case 1:ia(d,5);break;case 4:ia(d,10);break;case 3:ia(d,6);break;default:ia(d,2)}}}function $S(d,g){let p=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(p*=2),p*g}function ia(d,g){if(d.j.info("Error code "+g),g==2){var p=m(d.fb,d),b=d.Xa;const O=!b;b=new Or(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ys(b,"https"),mi(b),O?N2(b.toString(),p):C2(b.toString(),p)}else Vn(2);d.G=0,d.l&&d.l.sa(g),BS(d),LS(d)}n.fb=function(d){d?(this.j.info("Successfully pinged google.com"),Vn(2)):(this.j.info("Failed to ping google.com"),Vn(1))};function BS(d){if(d.G=0,d.ka=[],d.l){const g=Jn(d.h);(g.length!=0||d.i.length!=0)&&(k(d.ka,g),k(d.ka,d.i),d.h.i.length=0,S(d.i),d.i.length=0),d.l.ra()}}function zS(d,g,p){var b=p instanceof Or?ar(p):new Or(p);if(b.g!="")g&&(b.g=g+"."+b.g),Rn(b,b.s);else{var O=a.location;b=O.protocol,g=g?g+"."+O.hostname:O.hostname,O=+O.port;var $=new Or(null);b&&ys($,b),g&&($.g=g),O&&Rn($,O),p&&($.l=p),b=$}return p=d.D,g=d.ya,p&&g&&pt(b,p,g),pt(b,"VER",d.la),uu(d,b),b}function qS(d,g,p){if(g&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=d.Ca&&!d.pa?new pn(new Yh({eb:p})):new pn(d.pa),g.Ha(d.J),g}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function WS(){}n=WS.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function nf(){}nf.prototype.g=function(d,g){return new Vr(d,g)};function Vr(d,g){Pe.call(this),this.g=new jS(g),this.l=d,this.h=g&&g.messageUrlParams||null,d=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(d?d["X-WebChannel-Content-Type"]=g.messageContentType:d={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(d?d["X-WebChannel-Client-Profile"]=g.va:d={"X-WebChannel-Client-Profile":g.va}),this.g.S=d,(d=g&&g.Sb)&&!x(d)&&(this.g.m=d),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!x(g)&&(this.g.D=g,d=this.h,d!==null&&g in d&&(d=this.h,g in d&&delete d[g])),this.j=new yl(this)}w(Vr,Pe),Vr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Vr.prototype.close=function(){oy(this.g)},Vr.prototype.o=function(d){var g=this.g;if(typeof d=="string"){var p={};p.__data__=d,d=p}else this.u&&(p={},p.__data__=Kn(d),d=p);g.i.push(new St(g.Ya++,d)),g.G==3&&ef(g)},Vr.prototype.N=function(){this.g.l=null,delete this.j,oy(this.g),delete this.g,Vr.aa.N.call(this)};function GS(d){ae.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var g=d.__sm__;if(g){e:{for(const p in g){d=p;break e}d=void 0}(this.i=d)&&(d=this.i,g=g!==null&&d in g?g[d]:void 0),this.data=g}else this.data=d}w(GS,ae);function HS(){Tt.call(this),this.status=1}w(HS,Tt);function yl(d){this.g=d}w(yl,WS),yl.prototype.ua=function(){He(this.g,"a")},yl.prototype.ta=function(d){He(this.g,new GS(d))},yl.prototype.sa=function(d){He(this.g,new HS)},yl.prototype.ra=function(){He(this.g,"b")},nf.prototype.createWebChannel=nf.prototype.g,Vr.prototype.send=Vr.prototype.o,Vr.prototype.open=Vr.prototype.m,Vr.prototype.close=Vr.prototype.close,mR=function(){return new nf},fR=function(){return Yn()},hR=Gt,C0={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},M.NO_ERROR=0,M.TIMEOUT=8,M.HTTP_ERROR=6,tm=M,K.COMPLETE="complete",dR=K,rt.EventType=Zt,Zt.OPEN="a",Zt.CLOSE="b",Zt.ERROR="c",Zt.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,Ou=rt,pn.prototype.listenOnce=pn.prototype.L,pn.prototype.getLastError=pn.prototype.Ka,pn.prototype.getLastErrorCode=pn.prototype.Ba,pn.prototype.getStatus=pn.prototype.Z,pn.prototype.getResponseJson=pn.prototype.Oa,pn.prototype.getResponseText=pn.prototype.oa,pn.prototype.send=pn.prototype.ea,pn.prototype.setWithCredentials=pn.prototype.Ha,uR=pn}).apply(typeof Ef<"u"?Ef:typeof self<"u"?self:typeof window<"u"?window:{});const Kb="@firebase/firestore",Yb="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Bn.UNAUTHENTICATED=new Bn(null),Bn.GOOGLE_CREDENTIALS=new Bn("google-credentials-uid"),Bn.FIRST_PARTY=new Bn("first-party-uid"),Bn.MOCK_USER=new Bn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo=new gh("@firebase/firestore");function Nl(){return Uo.logLevel}function d7(n){Uo.setLogLevel(n)}function J(n,...e){if(Uo.logLevel<=lt.DEBUG){const t=e.map(qw);Uo.debug(`Firestore (${Gc}): ${n}`,...t)}}function xn(n,...e){if(Uo.logLevel<=lt.ERROR){const t=e.map(qw);Uo.error(`Firestore (${Gc}): ${n}`,...t)}}function ms(n,...e){if(Uo.logLevel<=lt.WARN){const t=e.map(qw);Uo.warn(`Firestore (${Gc}): ${n}`,...t)}}function qw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ge(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,gR(n,r,t)}function gR(n,e,t){let r=`FIRESTORE (${Gc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw xn(r),new Error(r)}function be(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||gR(e,s,r)}function h7(n,e){n||ge(57014,e)}function oe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class G extends Os{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class g3{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Bn.UNAUTHENTICATED))}shutdown(){}}class p3{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class y3{constructor(e){this.t=e,this.currentUser=Bn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){be(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new Wn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Wn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{J("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(J("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Wn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(J("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(be(typeof r.accessToken=="string",31837,{l:r}),new pR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return be(e===null||typeof e=="string",2055,{h:e}),new Bn(e)}}class v3{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Bn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class _3{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new v3(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Bn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class R0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class w3{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,rn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){be(this.o===void 0,3512);const r=i=>{i.error!=null&&J("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,J("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{J("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):J("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new R0(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(be(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new R0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class f7{getToken(){return Promise.resolve(new R0(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x3(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ww{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=x3(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Ge(n,e){return n<e?-1:n>e?1:0}function k0(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Hy(s)===Hy(i)?Ge(s,i):Hy(s)?1:-1}return Ge(n.length,e.length)}const S3=55296,I3=57343;function Hy(n){const e=n.charCodeAt(0);return e>=S3&&e<=I3}function vc(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function yR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0="__name__";class Ws{constructor(e,t,r){t===void 0?t=0:t>e.length&&ge(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ge(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ws.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ws?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Ws.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Ge(e.length,t.length)}static compareSegments(e,t){const r=Ws.isNumericId(e),s=Ws.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Ws.extractNumericId(e).compare(Ws.extractNumericId(t)):k0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ro.fromString(e.substring(4,e.length-2))}}class it extends Ws{construct(e,t,r){return new it(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new G(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new it(t)}static emptyPath(){return new it([])}}const b3=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class on extends Ws{construct(e,t,r){return new on(e,t,r)}static isValidIdentifier(e){return b3.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),on.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===D0}static keyField(){return new on([D0])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new G(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new G(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new G(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new G(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new on(t)}static emptyPath(){return new on([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(e){this.path=e}static fromPath(e){return new ie(it.fromString(e))}static fromName(e){return new ie(it.fromString(e).popFirst(5))}static empty(){return new ie(it.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&it.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return it.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ie(new it(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gw(n,e,t){if(!t)throw new G(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function E3(n,e,t,r){if(e===!0&&r===!0)throw new G(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Jb(n){if(!ie.isDocumentKey(n))throw new G(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Xb(n){if(ie.isDocumentKey(n))throw new G(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function yp(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ge(12329,{type:typeof n})}function ct(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new G(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=yp(n);throw new G(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function _R(n,e){if(e<=0)throw new G(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(n,e){const t={typeString:n};return e&&(t.value=e),t}function al(n,e){if(!vR(n))throw new G(F.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new G(F.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zb=-62135596800,eE=1e6;class et{static now(){return et.fromMillis(Date.now())}static fromDate(e){return et.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*eE);return new et(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new G(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new G(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Zb)throw new G(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new G(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/eE}_compareTo(e){return this.seconds===e.seconds?Ge(this.nanoseconds,e.nanoseconds):Ge(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:et._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(al(e,et._jsonSchema))return new et(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Zb;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}et._jsonSchemaVersion="firestore/timestamp/1.0",et._jsonSchema={type:Nn("string",et._jsonSchemaVersion),seconds:Nn("number"),nanoseconds:Nn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{static fromTimestamp(e){return new ke(e)}static min(){return new ke(new et(0,0))}static max(){return new ke(new et(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _c=-1;class wc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function P0(n){return n.fields.find(e=>e.kind===2)}function da(n){return n.fields.filter(e=>e.kind!==2)}function T3(n,e){let t=Ge(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=A3(n.fields[r],e.fields[r]),t!==0)return t;return Ge(n.fields.length,e.fields.length)}wc.UNKNOWN_ID=-1;class Aa{constructor(e,t){this.fieldPath=e,this.kind=t}}function A3(n,e){const t=on.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ge(n.kind,e.kind)}class xc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new xc(0,Xr.min())}}function wR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ke.fromTimestamp(r===1e9?new et(t+1,0):new et(t,r));return new Xr(s,ie.empty(),e)}function xR(n){return new Xr(n.readTime,n.key,_c)}class Xr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Xr(ke.min(),ie.empty(),_c)}static max(){return new Xr(ke.max(),ie.empty(),_c)}}function Hw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ie.comparator(n.documentKey,e.documentKey),t!==0?t:Ge(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class IR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jo(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==SR)throw n;J("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ge(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):V.reject(t)}static resolve(e){return new V((t,r)=>{t(e)})}static reject(e){return new V((t,r)=>{r(e)})}static waitFor(e){return new V((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},c=>r(c))}),o=!0,i===s&&t()})}static or(e){let t=V.resolve(!1);for(const r of e)t=t.next(s=>s?V.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new V((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let c=0;c<i;c++){const u=c;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new V((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $r="SimpleDb";class vp{static open(e,t,r,s){try{return new vp(t,e.transaction(s,r))}catch(i){throw new nd(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Wn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new nd(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Qw(r.target.error);this.S.reject(new nd(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(J($r,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new C3(t)}}class si{static delete(e){return J($r,"Removing database:",e),fa(bN().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Jg())return!1;if(si.F())return!0;const e=Ln(),t=si.M(e),r=0<t&&t<10,s=bR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,si.M(Ln())===12.2&&xn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(J($r,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new nd(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new G(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new G(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new nd(e,o))},s.onupgradeneeded=i=>{J($r,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{J($r,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=vp.open(this.db,e,i?"readonly":"readwrite",r),c=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),V.reject(u))).toPromise();return c.catch(()=>{}),await a.D,c}catch(a){const c=a,u=c.name!=="FirebaseError"&&o<3;if(J($r,"Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function bR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class N3{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return fa(this.U.delete())}}class nd extends G{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Xo(n){return n.name==="IndexedDbTransactionError"}class C3{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(J($r,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(J($r,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),fa(r)}add(e){return J($r,"ADD",this.store.name,e,e),fa(this.store.add(e))}get(e){return fa(this.store.get(e)).next(t=>(t===void 0&&(t=null),J($r,"GET",this.store.name,e,t),t))}delete(e){return J($r,"DELETE",this.store.name,e),fa(this.store.delete(e))}count(){return J($r,"COUNT",this.store.name),fa(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new V((o,a)=>{i.onerror=c=>{a(c.target.error)},i.onsuccess=c=>{o(c.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,c)=>{o.push(c)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new V((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){J($r,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new V((r,s)=>{t.onerror=i=>{const o=Qw(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new V((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new N3(a),u=t(a.primaryKey,a.value,c);if(u instanceof V){const h=u.catch(f=>(c.done(),V.reject(f)));r.push(h)}c.isDone?s():c.G===null?a.continue():a.continue(c.G)}}).next(()=>V.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function fa(n){return new V((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Qw(r.target.error);t(s)}})}let tE=!1;function Qw(n){const e=si.M(Ln());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new G("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tE||(tE=!0,setTimeout(()=>{throw r},0)),r}}return n}const rd="IndexBackfiller";class R3{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){J(rd,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();J(rd,`Documents written: ${t}`)}catch(t){Xo(t)?J(rd,"Ignoring IndexedDB error during index backfill: ",t):await Jo(t)}await this.re(6e4)})}}class k3{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return V.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return J(rd,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(J(rd,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=xR(i);Hw(o,r)>0&&(r=o)}),new Xr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ar.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko=-1;function Ah(n){return n==null}function qd(n){return n===0&&1/n==-1/0}function ER(n){return typeof n=="number"&&Number.isInteger(n)&&!qd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ag="";function pr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=nE(e)),e=D3(n.get(t),e);return nE(e)}function D3(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case ag:t+="";break;default:t+=i}}return t}function nE(n){return n+ag+""}function Ys(n){const e=n.length;if(be(e>=2,64408,{path:n}),e===2)return be(n.charAt(0)===ag&&n.charAt(1)==="",56145,{path:n}),it.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(ag,i);switch((o<0||o>t)&&ge(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let c;s.length===0?c=a:(s+=a,c=s,s=""),r.push(c);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ge(61167,{path:n})}i=o+2}return new it(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ha="remoteDocuments",Nh="owner",xl="owner",Wd="mutationQueues",P3="userId",bs="mutations",rE="batchId",xa="userMutationsIndex",sE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nm(n,e){return[n,pr(e)]}function TR(n,e,t){return[n,pr(e),t]}const j3={},Sc="documentMutations",lg="remoteDocumentsV14",L3=["prefixPath","collectionGroup","readTime","documentId"],rm="documentKeyIndex",M3=["prefixPath","collectionGroup","documentId"],AR="collectionGroupIndex",O3=["collectionGroup","readTime","prefixPath","documentId"],Gd="remoteDocumentGlobal",j0="remoteDocumentGlobalKey",Ic="targets",NR="queryTargetsIndex",V3=["canonicalId","targetId"],bc="targetDocuments",F3=["targetId","path"],Kw="documentTargetsIndex",U3=["path","targetId"],cg="targetGlobalKey",Na="targetGlobal",Hd="collectionParents",$3=["collectionId","parent"],Ec="clientMetadata",B3="clientId",_p="bundles",z3="bundleId",wp="namedQueries",q3="name",Yw="indexConfiguration",W3="indexId",L0="collectionGroupIndex",G3="collectionGroup",sd="indexState",H3=["indexId","uid"],CR="sequenceNumberIndex",Q3=["uid","sequenceNumber"],id="indexEntries",K3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],RR="documentKeyIndex",Y3=["indexId","uid","orderedDocumentKey"],xp="documentOverlays",J3=["userId","collectionPath","documentId"],M0="collectionPathOverlayIndex",X3=["userId","collectionPath","largestBatchId"],kR="collectionGroupOverlayIndex",Z3=["userId","collectionGroup","largestBatchId"],Jw="globals",e6="name",DR=[Wd,bs,Sc,ha,Ic,Nh,Na,bc,Ec,Gd,Hd,_p,wp],t6=[...DR,xp],PR=[Wd,bs,Sc,lg,Ic,Nh,Na,bc,Ec,Gd,Hd,_p,wp,xp],jR=PR,Xw=[...jR,Yw,sd,id],n6=Xw,LR=[...Xw,Jw],r6=LR;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0 extends IR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Mn(n,e){const t=oe(n);return si.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function MR(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function OR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e,t){this.comparator=e,this.root=t||er.EMPTY}insert(e,t){return new qt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,er.BLACK,null,null))}remove(e){return new qt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,er.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Tf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Tf(this.root,e,this.comparator,!1)}getReverseIterator(){return new Tf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Tf(this.root,e,this.comparator,!0)}}class Tf{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class er{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??er.RED,this.left=s??er.EMPTY,this.right=i??er.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new er(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return er.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return er.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,er.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,er.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ge(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ge(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ge(27949);return e+(this.isRed()?0:1)}}er.EMPTY=null,er.RED=!0,er.BLACK=!1;er.EMPTY=new class{constructor(){this.size=0}get key(){throw ge(57766)}get value(){throw ge(16141)}get color(){throw ge(16727)}get left(){throw ge(29726)}get right(){throw ge(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new er(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.comparator=e,this.data=new qt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new oE(this.data.getIterator())}getIteratorFrom(e){return new oE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new jt(this.comparator);return t.data=e,t}}class oE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Sl(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e){this.fields=e,e.sort(on.comparator)}static empty(){return new Nr([])}unionWith(e){let t=new jt(on.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Nr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return vc(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g7(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new VR("Invalid base64 string: "+i):i}}(e);return new vn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new vn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ge(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vn.EMPTY_BYTE_STRING=new vn("");const s6=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ji(n){if(be(!!n,39018),typeof n=="string"){let e=0;const t=s6.exec(n);if(be(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:tn(n.seconds),nanos:tn(n.nanos)}}function tn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Li(n){return typeof n=="string"?vn.fromBase64String(n):vn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FR="server_timestamp",UR="__type__",$R="__previous_value__",BR="__local_write_time__";function Sp(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[UR])==null?void 0:r.stringValue)===FR}function Ip(n){const e=n.mapValue.fields[$R];return Sp(e)?Ip(e):e}function Qd(n){const e=ji(n.mapValue.fields[BR].timestampValue);return new et(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i6{constructor(e,t,r,s,i,o,a,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u,this.isUsingEmulator=h}}const Kd="(default)";class $a{constructor(e,t){this.projectId=e,this.database=t||Kd}static empty(){return new $a("","")}get isDefaultDatabase(){return this.database===Kd}isEqual(e){return e instanceof $a&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zw="__type__",zR="__max__",po={mapValue:{fields:{__type__:{stringValue:zR}}}},ex="__vector__",Tc="value",sm={nullValue:"NULL_VALUE"};function $o(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Sp(n)?4:qR(n)?9007199254740991:bp(n)?10:11:ge(28295,{value:n})}function di(n,e){if(n===e)return!0;const t=$o(n);if(t!==$o(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Qd(n).isEqual(Qd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ji(s.timestampValue),a=ji(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Li(s.bytesValue).isEqual(Li(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return tn(s.geoPointValue.latitude)===tn(i.geoPointValue.latitude)&&tn(s.geoPointValue.longitude)===tn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return tn(s.integerValue)===tn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=tn(s.doubleValue),a=tn(i.doubleValue);return o===a?qd(o)===qd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return vc(n.arrayValue.values||[],e.arrayValue.values||[],di);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(iE(o)!==iE(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!di(o[c],a[c])))return!1;return!0}(n,e);default:return ge(52216,{left:n})}}function Yd(n,e){return(n.values||[]).find(t=>di(t,e))!==void 0}function Bo(n,e){if(n===e)return 0;const t=$o(n),r=$o(e);if(t!==r)return Ge(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ge(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=tn(i.integerValue||i.doubleValue),c=tn(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return aE(n.timestampValue,e.timestampValue);case 4:return aE(Qd(n),Qd(e));case 5:return k0(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Li(i),c=Li(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){const h=Ge(a[u],c[u]);if(h!==0)return h}return Ge(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ge(tn(i.latitude),tn(o.latitude));return a!==0?a:Ge(tn(i.longitude),tn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return lE(n.arrayValue,e.arrayValue);case 10:return function(i,o){var m,y,w,S;const a=i.fields||{},c=o.fields||{},u=(m=a[Tc])==null?void 0:m.arrayValue,h=(y=c[Tc])==null?void 0:y.arrayValue,f=Ge(((w=u==null?void 0:u.values)==null?void 0:w.length)||0,((S=h==null?void 0:h.values)==null?void 0:S.length)||0);return f!==0?f:lE(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===po.mapValue&&o===po.mapValue)return 0;if(i===po.mapValue)return 1;if(o===po.mapValue)return-1;const a=i.fields||{},c=Object.keys(a),u=o.fields||{},h=Object.keys(u);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const m=k0(c[f],h[f]);if(m!==0)return m;const y=Bo(a[c[f]],u[h[f]]);if(y!==0)return y}return Ge(c.length,h.length)}(n.mapValue,e.mapValue);default:throw ge(23264,{he:t})}}function aE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ge(n,e);const t=ji(n),r=ji(e),s=Ge(t.seconds,r.seconds);return s!==0?s:Ge(t.nanos,r.nanos)}function lE(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Bo(t[s],r[s]);if(i)return i}return Ge(t.length,r.length)}function Ac(n){return V0(n)}function V0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ji(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Li(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ie.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=V0(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${V0(t.fields[o])}`;return s+"}"}(n.mapValue):ge(61005,{value:n})}function im(n){switch($o(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ip(n);return e?16+im(e):16;case 5:return 2*n.stringValue.length;case 6:return Li(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+im(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Zo(r.fields,(i,o)=>{s+=i.length+im(o)}),s}(n.mapValue);default:throw ge(13486,{value:n})}}function Ba(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function F0(n){return!!n&&"integerValue"in n}function Jd(n){return!!n&&"arrayValue"in n}function cE(n){return!!n&&"nullValue"in n}function uE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function om(n){return!!n&&"mapValue"in n}function bp(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Zw])==null?void 0:r.stringValue)===ex}function od(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Zo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=od(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=od(n.arrayValue.values[t]);return e}return{...n}}function qR(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===zR}const WR={mapValue:{fields:{[Zw]:{stringValue:ex},[Tc]:{arrayValue:{}}}}};function o6(n){return"nullValue"in n?sm:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ba($a.empty(),ie.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?bp(n)?WR:{mapValue:{}}:ge(35942,{value:n})}function a6(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ba($a.empty(),ie.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?WR:"mapValue"in n?bp(n)?{mapValue:{}}:po:ge(61959,{value:n})}function dE(n,e){const t=Bo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function hE(n,e){const t=Bo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e){this.value=e}static empty(){return new nr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!om(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=od(t)}setAll(e){let t=on.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=od(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());om(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return di(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];om(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Zo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new nr(od(this.value))}}function GR(n){const e=[];return Zo(n.fields,(t,r)=>{const s=new on([t]);if(om(r)){const i=GR(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Nr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Qt(e,0,ke.min(),ke.min(),ke.min(),nr.empty(),0)}static newFoundDocument(e,t,r,s){return new Qt(e,1,t,ke.min(),r,s,0)}static newNoDocument(e,t){return new Qt(e,2,t,ke.min(),ke.min(),nr.empty(),0)}static newUnknownDocument(e,t){return new Qt(e,3,t,ke.min(),ke.min(),nr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ke.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Qt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Qt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e,t){this.position=e,this.inclusive=t}}function fE(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ie.comparator(ie.fromName(o.referenceValue),t.key):r=Bo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function mE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!di(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t="asc"){this.field=e,this.dir=t}}function l6(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{}class dt extends HR{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new c6(e,t,r):t==="array-contains"?new h6(e,r):t==="in"?new ZR(e,r):t==="not-in"?new f6(e,r):t==="array-contains-any"?new m6(e,r):new dt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new u6(e,r):new d6(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Bo(t,this.value)):t!==null&&$o(this.value)===$o(t)&&this.matchesComparison(Bo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ge(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Dt extends HR{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Dt(e,t)}matches(e){return Nc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Nc(n){return n.op==="and"}function U0(n){return n.op==="or"}function tx(n){return QR(n)&&Nc(n)}function QR(n){for(const e of n.filters)if(e instanceof Dt)return!1;return!0}function $0(n){if(n instanceof dt)return n.field.canonicalString()+n.op.toString()+Ac(n.value);if(tx(n))return n.filters.map(e=>$0(e)).join(",");{const e=n.filters.map(t=>$0(t)).join(",");return`${n.op}(${e})`}}function KR(n,e){return n instanceof dt?function(r,s){return s instanceof dt&&r.op===s.op&&r.field.isEqual(s.field)&&di(r.value,s.value)}(n,e):n instanceof Dt?function(r,s){return s instanceof Dt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&KR(o,s.filters[a]),!0):!1}(n,e):void ge(19439)}function YR(n,e){const t=n.filters.concat(e);return Dt.create(t,n.op)}function JR(n){return n instanceof dt?function(t){return`${t.field.canonicalString()} ${t.op} ${Ac(t.value)}`}(n):n instanceof Dt?function(t){return t.op.toString()+" {"+t.getFilters().map(JR).join(" ,")+"}"}(n):"Filter"}class c6 extends dt{constructor(e,t,r){super(e,t,r),this.key=ie.fromName(r.referenceValue)}matches(e){const t=ie.comparator(e.key,this.key);return this.matchesComparison(t)}}class u6 extends dt{constructor(e,t){super(e,"in",t),this.keys=XR("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class d6 extends dt{constructor(e,t){super(e,"not-in",t),this.keys=XR("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function XR(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>ie.fromName(r.referenceValue))}class h6 extends dt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Jd(t)&&Yd(t.arrayValue,this.value)}}class ZR extends dt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Yd(this.value.arrayValue,t)}}class f6 extends dt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Yd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Yd(this.value.arrayValue,t)}}class m6 extends dt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Jd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Yd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g6{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function B0(n,e=null,t=[],r=[],s=null,i=null,o=null){return new g6(n,e,t,r,s,i,o)}function za(n){const e=oe(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>$0(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ah(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ac(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ac(r)).join(",")),e.Te=t}return e.Te}function Ch(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!l6(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!KR(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!mE(n.startAt,e.startAt)&&mE(n.endAt,e.endAt)}function ug(n){return ie.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function dg(n,e){return n.filters.filter(t=>t instanceof dt&&t.field.isEqual(e))}function gE(n,e,t){let r=sm,s=!0;for(const i of dg(n,e)){let o=sm,a=!0;switch(i.op){case"<":case"<=":o=o6(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=sm}dE({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];dE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function pE(n,e,t){let r=po,s=!0;for(const i of dg(n,e)){let o=po,a=!0;switch(i.op){case">=":case">":o=a6(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=po}hE({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];hE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ek(n,e,t,r,s,i,o,a){return new $i(n,e,t,r,s,i,o,a)}function Hc(n){return new $i(n)}function yE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function nx(n){return n.collectionGroup!==null}function Xl(n){const e=oe(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new jt(on.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Xd(i,r))}),t.has(on.keyField().canonicalString())||e.Ie.push(new Xd(on.keyField(),r))}return e.Ie}function yr(n){const e=oe(n);return e.Ee||(e.Ee=nk(e,Xl(n))),e.Ee}function tk(n){const e=oe(n);return e.de||(e.de=nk(e,n.explicitOrderBy)),e.de}function nk(n,e){if(n.limitType==="F")return B0(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Xd(s.field,i)});const t=n.endAt?new zo(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new zo(n.startAt.position,n.startAt.inclusive):null;return B0(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function z0(n,e){const t=n.filters.concat([e]);return new $i(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function hg(n,e,t){return new $i(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Rh(n,e){return Ch(yr(n),yr(e))&&n.limitType===e.limitType}function rk(n){return`${za(yr(n))}|lt:${n.limitType}`}function Cl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>JR(s)).join(", ")}]`),Ah(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ac(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ac(s)).join(",")),`Target(${r})`}(yr(n))}; limitType=${n.limitType})`}function kh(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ie.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Xl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,c){const u=fE(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,Xl(r),s)||r.endAt&&!function(o,a,c){const u=fE(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,Xl(r),s))}(n,e)}function sk(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ik(n){return(e,t)=>{let r=!1;for(const s of Xl(n)){const i=p6(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function p6(n,e,t){const r=n.field.isKeyField()?ie.comparator(e.key,t.key):function(i,o,a){const c=o.data.field(i),u=a.data.field(i);return c!==null&&u!==null?Bo(c,u):ge(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ge(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Zo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return OR(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y6=new qt(ie.comparator);function Cr(){return y6}const ok=new qt(ie.comparator);function Vu(...n){let e=ok;for(const t of n)e=e.insert(t.key,t);return e}function ak(n){let e=ok;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Js(){return ad()}function lk(){return ad()}function ad(){return new Bi(n=>n.toString(),(n,e)=>n.isEqual(e))}const v6=new qt(ie.comparator),_6=new jt(ie.comparator);function Ye(...n){let e=_6;for(const t of n)e=e.add(t);return e}const w6=new jt(Ge);function rx(){return w6}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sx(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qd(e)?"-0":e}}function ck(n){return{integerValue:""+n}}function uk(n,e){return ER(e)?ck(e):sx(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ep{constructor(){this._=void 0}}function x6(n,e,t){return n instanceof Cc?function(s,i){const o={fields:{[UR]:{stringValue:FR},[BR]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Sp(i)&&(i=Ip(i)),i&&(o.fields[$R]=i),{mapValue:o}}(t,e):n instanceof qa?hk(n,e):n instanceof Wa?fk(n,e):function(s,i){const o=dk(s,i),a=vE(o)+vE(s.Ae);return F0(o)&&F0(s.Ae)?ck(a):sx(s.serializer,a)}(n,e)}function S6(n,e,t){return n instanceof qa?hk(n,e):n instanceof Wa?fk(n,e):t}function dk(n,e){return n instanceof Rc?function(r){return F0(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Cc extends Ep{}class qa extends Ep{constructor(e){super(),this.elements=e}}function hk(n,e){const t=mk(e);for(const r of n.elements)t.some(s=>di(s,r))||t.push(r);return{arrayValue:{values:t}}}class Wa extends Ep{constructor(e){super(),this.elements=e}}function fk(n,e){let t=mk(e);for(const r of n.elements)t=t.filter(s=>!di(s,r));return{arrayValue:{values:t}}}class Rc extends Ep{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function vE(n){return tn(n.integerValue||n.doubleValue)}function mk(n){return Jd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e,t){this.field=e,this.transform=t}}function I6(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof qa&&s instanceof qa||r instanceof Wa&&s instanceof Wa?vc(r.elements,s.elements,di):r instanceof Rc&&s instanceof Rc?di(r.Ae,s.Ae):r instanceof Cc&&s instanceof Cc}(n.transform,e.transform)}class b6{constructor(e,t){this.version=e,this.transformResults=t}}class an{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new an}static exists(e){return new an(void 0,e)}static updateTime(e){return new an(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function am(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Tp{}function gk(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Kc(n.key,an.none()):new Qc(n.key,n.data,an.none());{const t=n.data,r=nr.empty();let s=new jt(on.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new zi(n.key,r,new Nr(s.toArray()),an.none())}}function E6(n,e,t){n instanceof Qc?function(s,i,o){const a=s.value.clone(),c=wE(s.fieldTransforms,i,o.transformResults);a.setAll(c),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof zi?function(s,i,o){if(!am(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=wE(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(pk(s)),c.setAll(a),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ld(n,e,t,r){return n instanceof Qc?function(i,o,a,c){if(!am(i.precondition,o))return a;const u=i.value.clone(),h=xE(i.fieldTransforms,c,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof zi?function(i,o,a,c){if(!am(i.precondition,o))return a;const u=xE(i.fieldTransforms,c,o),h=o.data;return h.setAll(pk(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return am(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function T6(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=dk(r.transform,s||null);i!=null&&(t===null&&(t=nr.empty()),t.set(r.field,i))}return t||null}function _E(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&vc(r,s,(i,o)=>I6(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Qc extends Tp{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class zi extends Tp{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function pk(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function wE(n,e,t){const r=new Map;be(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,S6(o,a,t[s]))}return r}function xE(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,x6(i,o,e))}return r}class Kc extends Tp{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ix extends Tp{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&E6(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ld(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ld(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=lk();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const c=gk(o,a);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(ke.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ye())}isEqual(e){return this.batchId===e.batchId&&vc(this.mutations,e.mutations,(t,r)=>_E(t,r))&&vc(this.baseMutations,e.baseMutations,(t,r)=>_E(t,r))}}class ax{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){be(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return v6}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new ax(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A6{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var En,gt;function vk(n){switch(n){case F.OK:return ge(64938);case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0;default:return ge(15467,{code:n})}}function _k(n){if(n===void 0)return xn("GRPC error has no .code"),F.UNKNOWN;switch(n){case En.OK:return F.OK;case En.CANCELLED:return F.CANCELLED;case En.UNKNOWN:return F.UNKNOWN;case En.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case En.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case En.INTERNAL:return F.INTERNAL;case En.UNAVAILABLE:return F.UNAVAILABLE;case En.UNAUTHENTICATED:return F.UNAUTHENTICATED;case En.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case En.NOT_FOUND:return F.NOT_FOUND;case En.ALREADY_EXISTS:return F.ALREADY_EXISTS;case En.PERMISSION_DENIED:return F.PERMISSION_DENIED;case En.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case En.ABORTED:return F.ABORTED;case En.OUT_OF_RANGE:return F.OUT_OF_RANGE;case En.UNIMPLEMENTED:return F.UNIMPLEMENTED;case En.DATA_LOSS:return F.DATA_LOSS;default:return ge(39323,{code:n})}}(gt=En||(En={}))[gt.OK=0]="OK",gt[gt.CANCELLED=1]="CANCELLED",gt[gt.UNKNOWN=2]="UNKNOWN",gt[gt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",gt[gt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",gt[gt.NOT_FOUND=5]="NOT_FOUND",gt[gt.ALREADY_EXISTS=6]="ALREADY_EXISTS",gt[gt.PERMISSION_DENIED=7]="PERMISSION_DENIED",gt[gt.UNAUTHENTICATED=16]="UNAUTHENTICATED",gt[gt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",gt[gt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",gt[gt.ABORTED=10]="ABORTED",gt[gt.OUT_OF_RANGE=11]="OUT_OF_RANGE",gt[gt.UNIMPLEMENTED=12]="UNIMPLEMENTED",gt[gt.INTERNAL=13]="INTERNAL",gt[gt.UNAVAILABLE=14]="UNAVAILABLE",gt[gt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wk(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N6=new Ro([4294967295,4294967295],0);function SE(n){const e=wk().encode(n),t=new cR;return t.update(e),new Uint8Array(t.digest())}function IE(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ro([t,r],0),new Ro([s,i],0)]}class cx{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Fu(`Invalid padding: ${t}`);if(r<0)throw new Fu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Fu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Fu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ro.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Ro.fromNumber(r)));return s.compare(N6)===1&&(s=new Ro([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=SE(e),[r,s]=IE(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new cx(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=SE(e),[r,s]=IE(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Fu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,jh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ph(ke.min(),s,new qt(Ge),Cr(),Ye())}}class jh{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new jh(r,t,Ye(),Ye(),Ye())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class xk{constructor(e,t){this.targetId=e,this.Ce=t}}class Sk{constructor(e,t,r=vn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class bE{constructor(){this.ve=0,this.Fe=EE(),this.Me=vn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ye(),t=Ye(),r=Ye();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ge(38017,{changeType:i})}}),new jh(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=EE()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,be(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class C6{constructor(e){this.Ge=e,this.ze=new Map,this.je=Cr(),this.Je=Af(),this.He=Af(),this.Ye=new qt(Ge)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ge(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(ug(i))if(r===0){const o=new ie(i.path);this.et(t,o,Qt.newNoDocument(o,ke.min()))}else be(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),c=a?this.ct(a,e,o):1;if(c!==0){this.it(t);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}cd==null||cd.lt(function(h,f,m,y,w){var I,x,C;const S={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},k=f.unchangedNames;return k&&(S.bloomFilter={applied:w===0,hashCount:(k==null?void 0:k.hashCount)??0,bitmapLength:((x=(I=k==null?void 0:k.bits)==null?void 0:I.bitmap)==null?void 0:x.length)??0,padding:((C=k==null?void 0:k.bits)==null?void 0:C.padding)??0,mightContain:D=>(y==null?void 0:y.mightContain(D))??!1}),S}(o,e.Ce,this.Ge.ht(),a,c))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Li(r).toUint8Array()}catch(c){if(c instanceof VR)return ms("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new cx(o,s,i)}catch(c){return ms(c instanceof Fu?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&ug(a.target)){const c=new ie(a.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Qt.newNoDocument(c,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=Ye();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{const u=this.ot(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Ph(e,t,this.Ye,this.je,r);return this.je=Cr(),this.Je=Af(),this.He=Af(),this.Ye=new qt(Ge),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new bE,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new jt(Ge),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new jt(Ge),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||J("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new bE),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Af(){return new qt(ie.comparator)}function EE(){return new qt(ie.comparator)}const R6=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),k6=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),D6=(()=>({and:"AND",or:"OR"}))();class P6{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function q0(n,e){return n.useProto3Json||Ah(e)?e:{value:e}}function kc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ik(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function j6(n,e){return kc(n,e.toTimestamp())}function Sn(n){return be(!!n,49232),ke.fromTimestamp(function(t){const r=ji(t);return new et(r.seconds,r.nanos)}(n))}function ux(n,e){return W0(n,e).canonicalString()}function W0(n,e){const t=function(s){return new it(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function bk(n){const e=it.fromString(n);return be(Pk(e),10190,{key:e.toString()}),e}function Zd(n,e){return ux(n.databaseId,e.path)}function ii(n,e){const t=bk(e);if(t.get(1)!==n.databaseId.projectId)throw new G(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new G(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ie(Ak(t))}function Ek(n,e){return ux(n.databaseId,e)}function Tk(n){const e=bk(n);return e.length===4?it.emptyPath():Ak(e)}function G0(n){return new it(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ak(n){return be(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function TE(n,e,t){return{name:Zd(n,e),fields:t.value.mapValue.fields}}function Ap(n,e,t){const r=ii(n,e.name),s=Sn(e.updateTime),i=e.createTime?Sn(e.createTime):ke.min(),o=new nr({mapValue:{fields:e.fields}}),a=Qt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function L6(n,e){return"found"in e?function(r,s){be(!!s.found,43571),s.found.name,s.found.updateTime;const i=ii(r,s.found.name),o=Sn(s.found.updateTime),a=s.found.createTime?Sn(s.found.createTime):ke.min(),c=new nr({mapValue:{fields:s.found.fields}});return Qt.newFoundDocument(i,o,a,c)}(n,e):"missing"in e?function(r,s){be(!!s.missing,3894),be(!!s.readTime,22933);const i=ii(r,s.missing),o=Sn(s.readTime);return Qt.newNoDocument(i,o)}(n,e):ge(7234,{result:e})}function M6(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ge(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(be(h===void 0||typeof h=="string",58123),vn.fromBase64String(h||"")):(be(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),vn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?F.UNKNOWN:_k(u.code);return new G(h,u.message||"")}(o);t=new Sk(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ii(n,r.document.name),i=Sn(r.document.updateTime),o=r.document.createTime?Sn(r.document.createTime):ke.min(),a=new nr({mapValue:{fields:r.document.fields}}),c=Qt.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new lm(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ii(n,r.document),i=r.readTime?Sn(r.readTime):ke.min(),o=Qt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new lm([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ii(n,r.document),i=r.removedTargetIds||[];t=new lm([],i,s,null)}else{if(!("filter"in e))return ge(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new A6(s,i),a=r.targetId;t=new xk(a,o)}}return t}function eh(n,e){let t;if(e instanceof Qc)t={update:TE(n,e.key,e.value)};else if(e instanceof Kc)t={delete:Zd(n,e.key)};else if(e instanceof zi)t={update:TE(n,e.key,e.data),updateMask:B6(e.fieldMask)};else{if(!(e instanceof ix))return ge(16599,{Vt:e.type});t={verify:Zd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Cc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof qa)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Wa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Rc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ge(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:j6(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ge(27497)}(n,e.precondition)),t}function H0(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?an.updateTime(Sn(i.updateTime)):i.exists!==void 0?an.exists(i.exists):an.none()}(e.currentDocument):an.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let c=null;if("setToServerValue"in a)be(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),c=new Cc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];c=new qa(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];c=new Wa(h)}else"increment"in a?c=new Rc(o,a.increment):ge(16584,{proto:a});const u=on.fromServerFormat(a.fieldPath);return new Dh(u,c)}(n,s)):[];if(e.update){e.update.name;const s=ii(n,e.update.name),i=new nr({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const u=c.fieldPaths||[];return new Nr(u.map(h=>on.fromServerFormat(h)))}(e.updateMask);return new zi(s,i,o,t,r)}return new Qc(s,i,t,r)}if(e.delete){const s=ii(n,e.delete);return new Kc(s,t)}if(e.verify){const s=ii(n,e.verify);return new ix(s,t)}return ge(1463,{proto:e})}function O6(n,e){return n&&n.length>0?(be(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?Sn(s.updateTime):Sn(i);return o.isEqual(ke.min())&&(o=Sn(i)),new b6(o,s.transformResults||[])}(t,e))):[]}function Nk(n,e){return{documents:[Ek(n,e.path)]}}function Np(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Ek(n,s);const i=function(u){if(u.length!==0)return Dk(Dt.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(m){return{field:oo(m.field),direction:F6(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=q0(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function Ck(n,e,t,r){const{ft:s,parent:i}=Np(n,e),o={},a=[];let c=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+c++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:oo(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:oo(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function Rk(n){let e=Tk(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){be(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const m=kk(f);return m instanceof Dt&&tx(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(w){return new Xd(Rl(w.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Ah(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(f){const m=!!f.before,y=f.values||[];return new zo(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const m=!f.before,y=f.values||[];return new zo(y,m)}(t.endAt)),ek(e,s,o,i,a,"F",c,u)}function V6(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ge(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function kk(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Rl(t.unaryFilter.field);return dt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Rl(t.unaryFilter.field);return dt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Rl(t.unaryFilter.field);return dt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Rl(t.unaryFilter.field);return dt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ge(61313);default:return ge(60726)}}(n):n.fieldFilter!==void 0?function(t){return dt.create(Rl(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ge(58110);default:return ge(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Dt.create(t.compositeFilter.filters.map(r=>kk(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ge(1026)}}(t.compositeFilter.op))}(n):ge(30097,{filter:n})}function F6(n){return R6[n]}function U6(n){return k6[n]}function $6(n){return D6[n]}function oo(n){return{fieldPath:n.canonicalString()}}function Rl(n){return on.fromServerFormat(n.fieldPath)}function Dk(n){return n instanceof dt?function(t){if(t.op==="=="){if(uE(t.value))return{unaryFilter:{field:oo(t.field),op:"IS_NAN"}};if(cE(t.value))return{unaryFilter:{field:oo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(uE(t.value))return{unaryFilter:{field:oo(t.field),op:"IS_NOT_NAN"}};if(cE(t.value))return{unaryFilter:{field:oo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oo(t.field),op:U6(t.op),value:t.value}}}(n):n instanceof Dt?function(t){const r=t.getFilters().map(s=>Dk(s));return r.length===1?r[0]:{compositeFilter:{op:$6(t.op),filters:r}}}(n):ge(54877,{filter:n})}function B6(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Pk(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(e,t,r,s,i=ke.min(),o=ke.min(),a=vn.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new Si(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Si(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Si(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Si(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e){this.yt=e}}function z6(n,e){let t;if(e.document)t=Ap(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ie.fromSegments(e.noDocument.path),s=Ha(e.noDocument.readTime);t=Qt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ge(56709);{const r=ie.fromSegments(e.unknownDocument.path),s=Ha(e.unknownDocument.version);t=Qt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new et(s[0],s[1]);return ke.fromTimestamp(i)}(e.readTime)),t}function AE(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:fg(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Zd(i,o.key),fields:o.data.value.mapValue.fields,updateTime:kc(i,o.version.toTimestamp()),createTime:kc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ga(e.version)};else{if(!e.isUnknownDocument())return ge(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Ga(e.version)}}return r}function fg(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ga(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ha(n){const e=new et(n.seconds,n.nanoseconds);return ke.fromTimestamp(e)}function ma(n,e){const t=(e.baseMutations||[]).map(i=>H0(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>H0(n.yt,i)),s=et.fromMillis(e.localWriteTimeMs);return new ox(e.batchId,s,t,r)}function Uu(n){const e=Ha(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ha(n.lastLimboFreeSnapshotVersion):ke.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return be(o===1,1966,{count:o}),yr(Hc(Tk(i.documents[0])))}(n.query):function(i){return yr(Rk(i))}(n.query),new Si(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,vn.fromBase64String(n.resumeToken))}function Lk(n,e){const t=Ga(e.snapshotVersion),r=Ga(e.lastLimboFreeSnapshotVersion);let s;s=ug(e.target)?Nk(n.yt,e.target):Np(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:za(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Cp(n){const e=Rk({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?hg(e,e.limit,"L"):e}function Qy(n,e){return new lx(e.largestBatchId,H0(n.yt,e.overlayMutation))}function NE(n,e){const t=e.path.lastSegment();return[n,pr(e.path.popLast()),t]}function CE(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ga(r.readTime),documentKey:pr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q6{getBundleMetadata(e,t){return RE(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Ha(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return RE(e).put(function(s){return{bundleId:s.id,createTime:Ga(Sn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return kE(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Cp(i.bundledQuery),readTime:Ha(i.readTime)}}(r)})}saveNamedQuery(e,t){return kE(e).put(function(s){return{name:s.name,readTime:Ga(Sn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function RE(n){return Mn(n,_p)}function kE(n){return Mn(n,wp)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new Rp(e,r)}getOverlay(e,t){return Iu(e).get(NE(this.userId,t)).next(r=>r?Qy(this.serializer,r):null)}getOverlays(e,t){const r=Js();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new lx(t,o);s.push(this.St(e,a))}),V.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(pr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Iu(e).Z(M0,a))}),V.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Js(),i=pr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Iu(e).J(M0,o).next(a=>{for(const c of a){const u=Qy(this.serializer,c);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Js();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Iu(e).ee({index:kR,range:a},(c,u,h)=>{const f=Qy(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return Iu(e).put(function(s,i,o){const[a,c,u]=NE(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:eh(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function Iu(n){return Mn(n,xp)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W6{bt(e){return Mn(e,Jw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?vn.fromUint8Array(r):vn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(tn(e.integerValue));else if("doubleValue"in e){const r=tn(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),qd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=ji(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Li(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?qR(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):bp(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ge(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=Tc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(tn(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),ie.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}ga.Kt=new ga;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il=255;function G6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function DE(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=G6(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class H6{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=DE(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=DE(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(Il),this.sn(255)}_n(){this.an(Il),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Il?(this.sn(Il),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Il?(this.an(Il),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Q6{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class K6{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class bu{constructor(){this.cn=new H6,this.ln=new Q6(this.cn),this.hn=new K6(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new pa(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:cm(this.En),directionalValue:cm(this.dn),orderedDocumentKey:cm(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Xi(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=PE(n.En,e.En),t!==0?t:(t=PE(n.dn,e.dn),t!==0?t:ie.comparator(n.In,e.In)))}function PE(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function cm(n){return jN()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function jE(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class LE{constructor(e){this.mn=new jt((t,r)=>on.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(be(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=P0(e);if(t!==void 0&&!this.wn(t))return!1;const r=da(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const c=r[i];if(!this.Sn(a,c)||!this.bn(this.fn[o++],c))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new jt(on.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Aa(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Aa(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Aa(r.field,r.dir==="asc"?0:1)));return new wc(wc.UNKNOWN_ID,this.collectionId,t,xc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(n){var t,r;if(be(n instanceof dt||n instanceof Dt,20012),n instanceof dt){if(n instanceof ZR){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>dt.create(n.field,"==",i)))||[];return Dt.create(s,"or")}return n}const e=n.filters.map(s=>Mk(s));return Dt.create(e,n.op)}function Y6(n){if(n.getFilters().length===0)return[];const e=Y0(Mk(n));return be(Ok(e),7391),Q0(e)||K0(e)?[e]:e.getFilters()}function Q0(n){return n instanceof dt}function K0(n){return n instanceof Dt&&tx(n)}function Ok(n){return Q0(n)||K0(n)||function(t){if(t instanceof Dt&&U0(t)){for(const r of t.getFilters())if(!Q0(r)&&!K0(r))return!1;return!0}return!1}(n)}function Y0(n){if(be(n instanceof dt||n instanceof Dt,34018),n instanceof dt)return n;if(n.filters.length===1)return Y0(n.filters[0]);const e=n.filters.map(r=>Y0(r));let t=Dt.create(e,n.op);return t=mg(t),Ok(t)?t:(be(t instanceof Dt,64498),be(Nc(t),40251),be(t.filters.length>1,57927),t.filters.reduce((r,s)=>dx(r,s)))}function dx(n,e){let t;return be(n instanceof dt||n instanceof Dt,38388),be(e instanceof dt||e instanceof Dt,25473),t=n instanceof dt?e instanceof dt?function(s,i){return Dt.create([s,i],"and")}(n,e):ME(n,e):e instanceof dt?ME(e,n):function(s,i){if(be(s.filters.length>0&&i.filters.length>0,48005),Nc(s)&&Nc(i))return YR(s,i.getFilters());const o=U0(s)?s:i,a=U0(s)?i:s,c=o.filters.map(u=>dx(u,a));return Dt.create(c,"or")}(n,e),mg(t)}function ME(n,e){if(Nc(e))return YR(e,n.getFilters());{const t=e.filters.map(r=>dx(n,r));return Dt.create(t,"or")}}function mg(n){if(be(n instanceof dt||n instanceof Dt,11850),n instanceof dt)return n;const e=n.getFilters();if(e.length===1)return mg(e[0]);if(QR(n))return n;const t=e.map(s=>mg(s)),r=[];return t.forEach(s=>{s instanceof dt?r.push(s):s instanceof Dt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Dt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J6{constructor(){this.Cn=new hx}addToCollectionParentIndex(e,t){return this.Cn.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(Xr.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(Xr.min())}updateCollectionGroup(e,t,r){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class hx{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new jt(it.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new jt(it.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="IndexedDbIndexManager",Nf=new Uint8Array(0);class X6{constructor(e,t){this.databaseId=t,this.vn=new hx,this.Fn=new Bi(r=>za(r),(r,s)=>Ch(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:pr(s)};return VE(e).put(i)}return V.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[yR(t),""],!1,!0);return VE(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ys(o.parent))}return r})}addFieldIndex(e,t){const r=Eu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=El(e);return i.next(a=>{o.put(CE(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Eu(e),s=El(e),i=bl(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Eu(e),r=bl(e),s=El(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return V.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new LE(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=bl(e);let s=!0;const i=new Map;return V.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ye();const a=[];return V.forEach(i,(c,u)=>{J(OE,`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(D=>`${D.fieldPath}:${D.kind}`).join(",")}`}(c)} to execute ${za(t)}`);const h=function(C,D){const U=P0(D);if(U===void 0)return null;for(const L of dg(C,U.fieldPath))switch(L.op){case"array-contains-any":return L.value.arrayValue.values||[];case"array-contains":return[L.value]}return null}(u,c),f=function(C,D){const U=new Map;for(const L of da(D))for(const R of dg(C,L.fieldPath))switch(R.op){case"==":case"in":U.set(L.fieldPath.canonicalString(),R.value);break;case"not-in":case"!=":return U.set(L.fieldPath.canonicalString(),R.value),Array.from(U.values())}return null}(u,c),m=function(C,D){const U=[];let L=!0;for(const R of da(D)){const _=R.kind===0?gE(C,R.fieldPath,C.startAt):pE(C,R.fieldPath,C.startAt);U.push(_.value),L&&(L=_.inclusive)}return new zo(U,L)}(u,c),y=function(C,D){const U=[];let L=!0;for(const R of da(D)){const _=R.kind===0?pE(C,R.fieldPath,C.endAt):gE(C,R.fieldPath,C.endAt);U.push(_.value),L&&(L=_.inclusive)}return new zo(U,L)}(u,c),w=this.On(c,u,m),S=this.On(c,u,y),k=this.Nn(c,u,f),I=this.Bn(c.indexId,h,w,m.inclusive,S,y.inclusive,k);return V.forEach(I,x=>r.Y(x,t.limit).next(C=>{C.forEach(D=>{const U=ie.fromSegments(D.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}return V.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=Y6(Dt.create(e.filters,"and")).map(r=>B0(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const c=(t!=null?t.length:1)*Math.max(r.length,i.length),u=c/(t!=null?t.length:1),h=[];for(let f=0;f<c;++f){const m=t?this.Ln(t[f/u]):Nf,y=this.kn(e,m,r[f%u],s),w=this.qn(e,m,i[f%u],o),S=a.map(k=>this.kn(e,m,k,!0));h.push(...this.createRange(y,w,S))}return h}kn(e,t,r,s){const i=new pa(e,ie.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new pa(e,ie.empty(),t,r);return s?i.An():i}xn(e,t){const r=new LE(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return V.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(c){let u=new jt(on.comparator),h=!1;for(const f of c.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:u=u.add(m.field));for(const f of c.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new bu;for(const s of da(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);ga.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new bu;return ga.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new bu;return ga.Kt.Dt(Ba(this.databaseId,t),r.Pn(function(i){const o=da(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new bu);let i=0;for(const o of da(e)){const a=r[i++];for(const c of s)if(this.Un(t,o.fieldPath)&&Jd(a))s=this.Kn(s,o,a);else{const u=c.Pn(o.kind);ga.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const c=new bu;c.seed(a.un()),ga.Kt.Dt(o,c.Pn(t.kind)),i.push(c)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof dt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Eu(e),s=El(e);return(t?r.J(L0,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return V.forEach(i,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(h,f){const m=f?new xc(f.sequenceNumber,new Xr(Ha(f.readTime),new ie(Ys(f.documentKey)),f.largestBatchId)):xc.empty(),y=h.fields.map(([w,S])=>new Aa(on.fromServerFormat(w),S));return new wc(h.indexId,h.collectionGroup,y,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ge(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Eu(e),i=El(e);return this.Gn(e).next(o=>s.J(L0,IDBKeyRange.bound(t,t)).next(a=>V.forEach(a,c=>i.put(CE(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return V.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?V.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),V.forEach(a,c=>this.zn(e,s,c).next(u=>{const h=this.jn(i,c);return u.isEqual(h)?V.resolve():this.Jn(e,i,c,u,h)}))))})}Hn(e,t,r,s){return bl(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return bl(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=bl(e);let i=new jt(Xi);return s.ee({index:RR,range:IDBKeyRange.only([r.indexId,this.uid,cm(this.$n(r,t))])},(o,a)=>{i=i.add(new pa(r.indexId,t,jE(a.arrayValue),jE(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new jt(Xi);const s=this.Qn(t,e);if(s==null)return r;const i=P0(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Jd(o))for(const a of o.arrayValue.values||[])r=r.add(new pa(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new pa(t.indexId,e.key,Nf,s));return r}Jn(e,t,r,s,i){J(OE,"Updating index entries for document '%s'",t.key);const o=[];return function(c,u,h,f,m){const y=c.getIterator(),w=u.getIterator();let S=Sl(y),k=Sl(w);for(;S||k;){let I=!1,x=!1;if(S&&k){const C=h(S,k);C<0?x=!0:C>0&&(I=!0)}else S!=null?x=!0:I=!0;I?(f(k),k=Sl(w)):x?(m(S),S=Sl(y)):(S=Sl(y),k=Sl(w))}}(s,i,Xi,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),V.waitFor(o)}Gn(e){let t=1;return El(e).ee({index:CR,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Xi(o,a)).filter((o,a,c)=>!a||Xi(o,c[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Xi(o,e),c=Xi(o,t);if(a===0)s[0]=e.An();else if(a>0&&c<0)s.push(o),s.push(o.An());else if(c>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,Nf,ie.empty()),c=s[o+1].Vn(this.uid,Nf,ie.empty());i.push(IDBKeyRange.bound(a,c))}return i}Zn(e,t){return Xi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(FE)}getMinOffset(e,t){return V.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||ge(44426))).next(FE)}}function VE(n){return Mn(n,Hd)}function bl(n){return Mn(n,id)}function Eu(n){return Mn(n,Yw)}function El(n){return Mn(n,sd)}function FE(n){be(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Hw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Xr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Vk=41943040;class fr{static withCacheSize(e){return new fr(e,fr.DEFAULT_COLLECTION_PERCENTILE,fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fk(n,e,t){const r=n.store(bs),s=n.store(Sc),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=r.ee({range:o},(h,f,m)=>(a++,m.delete()));i.push(c.next(()=>{be(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=TR(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return V.waitFor(i).next(()=>u)}function gg(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ge(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fr.DEFAULT_COLLECTION_PERCENTILE=10,fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fr.DEFAULT=new fr(Vk,fr.DEFAULT_COLLECTION_PERCENTILE,fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fr.DISABLED=new fr(-1,0,0);class kp{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){be(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new kp(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Zi(e).ee({index:xa,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=kl(e),o=Zi(e);return o.add({}).next(a=>{be(typeof a=="number",49019);const c=new ox(a,t,r,s),u=function(y,w,S){const k=S.baseMutations.map(x=>eh(y.yt,x)),I=S.mutations.map(x=>eh(y.yt,x));return{userId:w,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:k,mutations:I}}(this.serializer,this.userId,c),h=[];let f=new jt((m,y)=>Ge(m.canonicalString(),y.canonicalString()));for(const m of s){const y=TR(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,j3))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[a]=c.keys()}),V.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return Zi(e).get(t).next(r=>r?(be(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),ma(this.serializer,r)):null)}er(e,t){return this.Xn[t]?V.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Zi(e).ee({index:xa,range:s},(o,a,c)=>{a.userId===this.userId&&(be(a.batchId>=r,47524,{tr:r}),i=ma(this.serializer,a)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=ko;return Zi(e).ee({index:xa,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,ko],[this.userId,Number.POSITIVE_INFINITY]);return Zi(e).J(xa,t).next(r=>r.map(s=>ma(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=nm(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return kl(e).ee({range:s},(o,a,c)=>{const[u,h,f]=o,m=Ys(h);if(u===this.userId&&t.path.isEqual(m))return Zi(e).get(f).next(y=>{if(!y)throw ge(61480,{nr:o,batchId:f});be(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(ma(this.serializer,y))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new jt(Ge);const s=[];return t.forEach(i=>{const o=nm(this.userId,i.path),a=IDBKeyRange.lowerBound(o),c=kl(e).ee({range:a},(u,h,f)=>{const[m,y,w]=u,S=Ys(y);m===this.userId&&i.path.isEqual(S)?r=r.add(w):f.done()});s.push(c)}),V.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=nm(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new jt(Ge);return kl(e).ee({range:o},(c,u,h)=>{const[f,m,y]=c,w=Ys(m);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Zi(e).get(i).next(o=>{if(o===null)throw ge(35274,{batchId:i});be(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(ma(this.serializer,o))}))}),V.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Fk(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),V.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return V.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return kl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const c=Ys(i[1]);s.push(c)}else a.done()}).next(()=>{be(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return Uk(e,this.userId,t)}_r(e){return $k(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ko,lastStreamToken:""})}}function Uk(n,e,t){const r=nm(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return kl(n).ee({range:i,X:!0},(a,c,u)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function Zi(n){return Mn(n,bs)}function kl(n){return Mn(n,Sc)}function $k(n){return Mn(n,Wd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Qa(0)}static cr(){return new Qa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z6{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Qa(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>ke.fromTimestamp(new et(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Tl(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(be(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Tl(e).ee((o,a)=>{const c=Uu(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>V.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Tl(e).ee((r,s)=>{const i=Uu(s);t(i)})}lr(e){return $E(e).get(cg).next(t=>(be(t!==null,2888),t))}hr(e,t){return $E(e).put(cg,t)}Pr(e,t){return Tl(e).put(Lk(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=za(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Tl(e).ee({range:s,index:NR},(o,a,c)=>{const u=Uu(a);Ch(t,u.target)&&(i=u,c.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ao(e);return t.forEach(o=>{const a=pr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),V.waitFor(s)}removeMatchingKeys(e,t,r){const s=ao(e);return V.forEach(t,i=>{const o=pr(i.path);return V.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ao(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ao(e);let i=Ye();return s.ee({range:r,X:!0},(o,a,c)=>{const u=Ys(o[1]),h=new ie(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=pr(t.path),s=IDBKeyRange.bound([r],[yR(r)],!1,!0);let i=0;return ao(e).ee({index:Kw,X:!0,range:s},([o,a],c,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return Tl(e).get(t).next(r=>r?Uu(r):null)}}function Tl(n){return Mn(n,Ic)}function $E(n){return Mn(n,Na)}function ao(n){return Mn(n,bc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BE="LruGarbageCollector",Bk=1048576;function zE([n,e],[t,r]){const s=Ge(n,t);return s===0?Ge(e,r):s}class e5{constructor(e){this.Ir=e,this.buffer=new jt(zE),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();zE(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class zk{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){J(BE,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Xo(t)?J(BE,"Ignoring IndexedDB error during garbage collection: ",t):await Jo(t)}await this.Vr(3e5)})}}class t5{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return V.resolve(Ar.ce);const r=new e5(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(J("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(UE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(J("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),UE):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(J("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),Nl()<=lt.DEBUG&&J("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(c-a)+`ms
	Removed ${f} documents in `+(u-c)+`ms
Total Duration: ${u-h}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function qk(n,e){return new t5(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5{constructor(e,t){this.db=e,this.garbageCollector=qk(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Cf(e,r)}removeReference(e,t,r){return Cf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cf(e,t)}br(e,t){return function(s,i){let o=!1;return $k(s).te(a=>Uk(s,a,i).next(c=>(c&&(o=!0),V.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const c=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ke.min()),ao(e).delete(function(f){return[0,pr(f.path)]}(o))))});s.push(c)}}).next(()=>V.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cf(e,t)}Sr(e,t){const r=ao(e);let s,i=Ar.ce;return r.ee({index:Kw},([o,a],{path:c,sequenceNumber:u})=>{o===0?(i!==Ar.ce&&t(new ie(Ys(s)),i),i=u,s=c):i=Ar.ce}).next(()=>{i!==Ar.ce&&t(new ie(Ys(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cf(n,e){return ao(n).put(function(r,s){return{targetId:0,path:pr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(){this.changes=new Bi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Qt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?V.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return oa(e).put(r)}removeEntry(e,t,r){return oa(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],fg(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Qt.newInvalidDocument(t);return oa(e).ee({index:rm,range:IDBKeyRange.only(Tu(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Qt.newInvalidDocument(t)};return oa(e).ee({index:rm,range:IDBKeyRange.only(Tu(t))},(s,i)=>{r={document:this.Cr(t,i),size:gg(i)}}).next(()=>r)}getEntries(e,t){let r=Cr();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=Cr(),s=new qt(ie.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,gg(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return V.resolve();let s=new jt(GE);t.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Tu(s.first()),Tu(s.last())),o=s.getIterator();let a=o.getNext();return oa(e).ee({index:rm,range:i},(c,u,h)=>{const f=ie.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&GE(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(Tu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),fg(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return oa(e).J(IDBKeyRange.bound(a,c,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=Cr();for(const f of u){const m=this.Cr(ie.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(kh(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Cr();const o=WE(t,r),a=WE(t,Xr.max());return oa(e).ee({index:AR,range:IDBKeyRange.bound(o,a,!0)},(c,u,h)=>{const f=this.Cr(ie.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new s5(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return qE(e).get(j0).next(t=>(be(!!t,20021),t))}Dr(e,t){return qE(e).put(j0,t)}Cr(e,t){if(t){const r=z6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ke.min())))return r}return Qt.newInvalidDocument(e)}}function Gk(n){return new r5(n)}class s5 extends Wk{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Bi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new jt((i,o)=>Ge(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const c=AE(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=gg(c);r+=u-a.size,t.push(this.Nr.addEntry(e,i,c))}else if(r-=a.size,this.trackRemovals){const c=AE(this.Nr.serializer,o.convertToNoDocument(ke.min()));t.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),V.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function qE(n){return Mn(n,Gd)}function oa(n){return Mn(n,lg)}function Tu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function WE(n,e){const t=e.documentKey.path.toArray();return[n,fg(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function GE(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ge(t[i],r[i]),s)return s;return s=Ge(t.length,r.length),s||(s=Ge(t[t.length-2],r[r.length-2]),s||Ge(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&ld(r.mutation,s,Nr.empty(),et.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ye()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ye()){const s=Js();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Vu();return i.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Js();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ye()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Cr();const o=ad(),a=function(){return ad()}();return t.forEach((c,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof zi)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),ld(h.mutation,u,h.mutation.getFieldMask(),et.now())):o.set(u.key,Nr.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new i5(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=ad();let s=new qt((o,a)=>o-a),i=Ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const u=t.get(c);if(u===null)return;let h=r.get(c)||Nr.empty();h=a.applyToLocalView(u,h),r.set(c,h);const f=(s.get(a.batchId)||Ye()).add(c);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),u=c.key,h=c.value,f=lk();h.forEach(m=>{if(!i.has(m)){const y=gk(t.get(m),r.get(m));y!==null&&f.set(m,y),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return V.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ie.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):nx(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):V.resolve(Js());let a=_c,c=i;return o.next(u=>V.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?V.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{c=c.insert(h,m)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,c,u,Ye())).next(h=>({batchId:a,changes:ak(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ie(t)).next(r=>{let s=Vu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Vu();return this.indexManager.getCollectionParents(e,i).next(a=>V.forEach(a,c=>{const u=function(f,m){return new $i(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((c,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Qt.newInvalidDocument(h)))});let a=Vu();return o.forEach((c,u)=>{const h=i.get(c);h!==void 0&&ld(h.mutation,u,Nr.empty(),et.now()),kh(t,u)&&(a=a.insert(c,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return V.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Sn(s.createTime)}}(t)),V.resolve()}getNamedQuery(e,t){return V.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:Cp(s.bundledQuery),readTime:Sn(s.readTime)}}(t)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a5{constructor(){this.overlays=new qt(ie.comparator),this.qr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Js();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),V.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),V.resolve()}getOverlaysForCollection(e,t,r){const s=Js(),i=t.length+1,o=new ie(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return V.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new qt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Js(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Js(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return V.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new lx(t,r));let i=this.qr.get(t);i===void 0&&(i=Ye(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5{constructor(){this.sessionToken=vn.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(){this.Qr=new jt(Un.$r),this.Ur=new jt(Un.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Un(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Un(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new ie(new it([])),r=new Un(t,e),s=new Un(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ie(new it([])),r=new Un(t,e),s=new Un(t,e+1);let i=Ye();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Un(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Un{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ie.comparator(e.key,t.key)||Ge(e.Yr,t.Yr)}static Kr(e,t){return Ge(e.Yr,t.Yr)||ie.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new jt(Un.$r)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ox(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Un(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,t){return V.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return V.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?ko:this.tr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Un(t,0),s=new Un(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),V.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new jt(Ge);return t.forEach(s=>{const i=new Un(s,0),o=new Un(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),V.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ie.isDocumentKey(i)||(i=i.child(""));const o=new Un(new ie(i),0);let a=new jt(Ge);return this.Zr.forEachWhile(c=>{const u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.Yr)),!0)},o),V.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){be(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return V.forEach(t.mutations,s=>{const i=new Un(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new Un(t,0),s=this.Zr.firstAfterOrEqual(r);return V.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(e){this.ri=e,this.docs=function(){return new qt(ie.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return V.resolve(r?r.document.mutableCopy():Qt.newInvalidDocument(t))}getEntries(e,t){let r=Cr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Qt.newInvalidDocument(s))}),V.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Cr();const o=t.path,a=new ie(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:u,value:{document:h}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Hw(xR(h),r)<=0||(s.has(h.key)||kh(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return V.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ge(9500)}ii(e,t){return V.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new d5(this)}getSize(e){return V.resolve(this.size)}}class d5 extends Wk{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),V.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e){this.persistence=e,this.si=new Bi(t=>za(t),Ch),this.lastRemoteSnapshotVersion=ke.min(),this.highestTargetId=0,this.oi=0,this._i=new fx,this.targetCount=0,this.ai=Qa.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),V.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Qa(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Pr(t),V.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),V.waitFor(i).next(()=>s)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return V.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),V.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),V.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return V.resolve(r)}containsKey(e,t){return V.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ar(0),this.li=!1,this.li=!0,this.hi=new l5,this.referenceDelegate=e(this),this.Pi=new h5(this),this.indexManager=new J6,this.remoteDocumentCache=function(s){return new u5(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new jk(t),this.Ii=new o5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new a5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new c5(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){J("MemoryPersistence","Starting transaction:",e);const s=new f5(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return V.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class f5 extends IR{constructor(e){super(),this.currentSequenceNumber=e}}class Dp{constructor(e){this.persistence=e,this.Ri=new fx,this.Vi=null}static mi(e){return new Dp(e)}get fi(){if(this.Vi)return this.Vi;throw ge(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),V.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),V.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.fi,r=>{const s=ie.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,ke.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return V.or([()=>V.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class pg{constructor(e,t){this.persistence=e,this.pi=new Bi(r=>pr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=qk(this,t)}static mi(e,t){return new pg(e,t)}Ei(){}di(e){return V.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return V.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?V.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,ke.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=im(e.data.value)),t}br(e,t,r){return V.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5{constructor(e){this.serializer=e}k(e,t,r,s){const i=new vp("createOrUpgrade",t);r<1&&s>=1&&(function(c){c.createObjectStore(Nh)}(e),function(c){c.createObjectStore(Wd,{keyPath:P3}),c.createObjectStore(bs,{keyPath:rE,autoIncrement:!0}).createIndex(xa,sE,{unique:!0}),c.createObjectStore(Sc)}(e),HE(e),function(c){c.createObjectStore(ha)}(e));let o=V.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(bc),c.deleteObjectStore(Ic),c.deleteObjectStore(Na)}(e),HE(e)),o=o.next(()=>function(c){const u=c.store(Na),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ke.min().toTimestamp(),targetCount:0};return u.put(cg,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(c,u){return u.store(bs).J().next(f=>{c.deleteObjectStore(bs),c.createObjectStore(bs,{keyPath:rE,autoIncrement:!0}).createIndex(xa,sE,{unique:!0});const m=u.store(bs),y=f.map(w=>m.put(w));return V.waitFor(y)})}(e,i))),o=o.next(()=>{(function(c){c.createObjectStore(Ec,{keyPath:B3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore(Gd)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(_p,{keyPath:z3})})(e),function(c){c.createObjectStore(wp,{keyPath:q3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(c){const u=c.createObjectStore(xp,{keyPath:J3});u.createIndex(M0,X3,{unique:!1}),u.createIndex(kR,Z3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(c){const u=c.createObjectStore(lg,{keyPath:L3});u.createIndex(rm,M3),u.createIndex(AR,O3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(ha))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore(Yw,{keyPath:W3,autoIncrement:!0}).createIndex(L0,G3,{unique:!1}),c.createObjectStore(sd,{keyPath:H3}).createIndex(CR,Q3,{unique:!1}),c.createObjectStore(id,{keyPath:K3}).createIndex(RR,Y3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(sd).clear()}).next(()=>{t.objectStore(id).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(Jw,{keyPath:e6})})(e)})),r<18&&s>=18&&jN()&&(o=o.next(()=>{t.objectStore(sd).clear()}).next(()=>{t.objectStore(id).clear()})),o}wi(e){let t=0;return e.store(ha).ee((r,s)=>{t+=gg(s)}).next(()=>{const r={byteSize:t};return e.store(Gd).put(j0,r)})}yi(e){const t=e.store(Wd),r=e.store(bs);return t.J().next(s=>V.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,ko],[i.userId,i.lastAcknowledgedBatchId]);return r.J(xa,o).next(a=>V.forEach(a,c=>{be(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const u=ma(this.serializer,c);return Fk(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(bc),r=e.store(ha);return e.store(Na).get(cg).next(s=>{const i=[];return r.ee((o,a)=>{const c=new it(o),u=function(f){return[0,pr(f)]}(c);i.push(t.get(u).next(h=>h?V.resolve():(f=>t.put({targetId:0,path:pr(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>V.waitFor(i))})}bi(e,t){e.createObjectStore(Hd,{keyPath:$3});const r=t.store(Hd),s=new hx,i=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:pr(c)})}};return t.store(ha).ee({X:!0},(o,a)=>{const c=new it(o);return i(c.popLast())}).next(()=>t.store(Sc).ee({X:!0},([o,a,c],u)=>{const h=Ys(a);return i(h.popLast())}))}Di(e){const t=e.store(Ic);return t.ee((r,s)=>{const i=Uu(s),o=Lk(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(ha),s=[];return r.ee((i,o)=>{const a=t.store(lg),c=function(f){return f.document?new ie(it.fromString(f.document.name).popFirst(5)):f.noDocument?ie.fromSegments(f.noDocument.path):f.unknownDocument?ie.fromSegments(f.unknownDocument.path):ge(36783)}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>V.waitFor(s))}Fi(e,t){const r=t.store(bs),s=Gk(this.serializer),i=new mx(Dp.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(c=>{let u=a.get(c.userId)??Ye();ma(this.serializer,c).keys().forEach(h=>u=u.add(h)),a.set(c.userId,u)}),V.forEach(a,(c,u)=>{const h=new Bn(u),f=Rp.wt(this.serializer,h),m=i.getIndexManager(h),y=kp.wt(h,this.serializer,m,i.referenceDelegate);return new Hk(s,y,f,m).recalculateAndSaveOverlaysForDocumentKeys(new O0(t,Ar.ce),c).next()})})}}function HE(n){n.createObjectStore(bc,{keyPath:F3}).createIndex(Kw,U3,{unique:!0}),n.createObjectStore(Ic,{keyPath:"targetId"}).createIndex(NR,V3,{unique:!0}),n.createObjectStore(Na)}const eo="IndexedDbPersistence",Ky=18e5,Yy=5e3,Jy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Qk="main";class gx{constructor(e,t,r,s,i,o,a,c,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!gx.v())throw new G(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new n5(this,s),this.$i=t+Qk,this.serializer=new jk(c),this.Ui=new si(this.$i,this.Ni,new m5(this.serializer)),this.hi=new W6,this.Pi=new Z6(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Gk(this.serializer),this.Ii=new q6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&xn(eo,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new G(F.FAILED_PRECONDITION,Jy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Ar(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Rf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(Xo(e))return J(eo,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return J(eo,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Au(e).get(xl).next(t=>V.resolve(this.es(t)))}ts(e){return Rf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ky)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Mn(t,Ec);return r.J().next(s=>{const i=this.ss(s,Ky),o=s.filter(a=>i.indexOf(a)===-1);return V.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?V.resolve(!0):Au(e).get(xl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Yy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new G(F.FAILED_PRECONDITION,Jy);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rf(e).J().next(r=>this.ss(r,Yy).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&J(eo,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Nh,Ec],e=>{const t=new O0(e,Ar.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Rf(e).J().next(t=>this.ss(t,Ky).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return kp.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new X6(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Rp.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){J(eo,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(c){return c===18?r6:c===17?LR:c===16?n6:c===15?Xw:c===14?jR:c===13?PR:c===12?t6:c===11?DR:void ge(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new O0(a,this.ci?this.ci.next():Ar.ce),t==="readwrite-primary"?this.Hi(o).next(c=>!!c||this.Yi(o)).next(c=>{if(!c)throw xn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new G(F.FAILED_PRECONDITION,SR);return r(o)}).next(c=>this.Xi(o).next(()=>c)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Au(e).get(xl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Yy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new G(F.FAILED_PRECONDITION,Jy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Au(e).put(xl,t)}static v(){return si.v()}Zi(e){const t=Au(e);return t.get(xl).next(r=>this.es(r)?(J(eo,"Releasing primary lease."),t.delete(xl)):V.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(xn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;PN()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return J(eo,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return xn(eo,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){xn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Au(n){return Mn(n,Nh)}function Rf(n){return Mn(n,Ec)}function px(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=Ye(),s=Ye();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new yx(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return PN()?8:bR(Ln())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new g5;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(Nl()<=lt.DEBUG&&J("QueryEngine","SDK will not create cache indexes for query:",Cl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),V.resolve()):(Nl()<=lt.DEBUG&&J("QueryEngine","Query:",Cl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Nl()<=lt.DEBUG&&J("QueryEngine","The SDK decides to create cache indexes for query:",Cl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yr(t))):V.resolve())}ys(e,t){if(yE(t))return V.resolve(null);let r=yr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=hg(t,null,"F"),r=yr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ye(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const u=this.Ds(t,a);return this.Cs(t,u,o,c.readTime)?this.ys(e,hg(t,null,"F")):this.vs(e,u,t,c)}))})))}ws(e,t,r,s){return yE(t)||s.isEqual(ke.min())?V.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?V.resolve(null):(Nl()<=lt.DEBUG&&J("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Cl(t)),this.vs(e,o,t,wR(s,_c)).next(a=>a))})}Ds(e,t){let r=new jt(ik(e));return t.forEach((s,i)=>{kh(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return Nl()<=lt.DEBUG&&J("QueryEngine","Using full collection scan to execute query:",Cl(t)),this.ps.getDocumentsMatchingQuery(e,t,Xr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vx="LocalStore",p5=3e8;class y5{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new qt(Ge),this.xs=new Bi(i=>za(i),Ch),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hk(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Yk(n,e,t,r){return new y5(n,e,t,r)}async function Jk(n,e){const t=oe(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let c=Ye();for(const u of s){o.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(r,c).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function v5(n,e){const t=oe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,c,u,h){const f=u.batch,m=f.keys();let y=V.resolve();return m.forEach(w=>{y=y.next(()=>h.getEntry(c,w)).next(S=>{const k=u.docVersions.get(w);be(k!==null,48541),S.version.compareTo(k)<0&&(f.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),h.addEntry(S)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=Ye();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Xk(n){const e=oe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function _5(n,e){const t=oe(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(vn.EMPTY_BYTE_STRING,ke.min()).withLastLimboFreeSnapshotVersion(ke.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(S,k,I){return S.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=p5?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(m,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let c=Cr(),u=Ye();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(Zk(i,o,e.documentUpdates).next(h=>{c=h.ks,u=h.qs})),!r.isEqual(ke.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return V.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,u)).next(()=>c)}).then(i=>(t.Ms=s,i))}function Zk(n,e,t){let r=Ye(),s=Ye();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Cr();return t.forEach((a,c)=>{const u=i.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(ke.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):J(vx,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{ks:o,qs:s}})}function w5(n,e){const t=oe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ko),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Dc(n,e){const t=oe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,V.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new Si(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function Pc(n,e,t){const r=oe(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Xo(o))throw o;J(vx,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function yg(n,e,t){const r=oe(n);let s=ke.min(),i=Ye();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,h){const f=oe(c),m=f.xs.get(h);return m!==void 0?V.resolve(f.Ms.get(m)):f.Pi.getTargetData(u,h)}(r,o,yr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:ke.min(),t?i:Ye())).next(a=>(nD(r,sk(e),a),{documents:a,Qs:i})))}function eD(n,e){const t=oe(n),r=oe(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function tD(n,e){const t=oe(n),r=t.Os.get(e)||ke.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,wR(r,_c),Number.MAX_SAFE_INTEGER)).then(s=>(nD(t,e,s),s))}function nD(n,e,t){let r=n.Os.get(e)||ke.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function x5(n,e,t,r){const s=oe(n);let i=Ye(),o=Cr();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),c=await Dc(s,function(h){return yr(Hc(it.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>Zk(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,c.targetId).next(()=>s.Pi.addMatchingKeys(u,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function S5(n,e,t=Ye()){const r=await Dc(n,yr(Cp(e.bundledQuery))),s=oe(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Sn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(vn.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD="firestore_clients";function QE(n,e){return`${rD}_${n}_${e}`}const sD="firestore_mutations";function KE(n,e,t){let r=`${sD}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const iD="firestore_targets";function Xy(n,e){return`${iD}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gs="SharedClientState";class vg{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new G(s.error.code,s.error.message))),o?new vg(e,t,s.state,i):(xn(Gs,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ud{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new G(r.error.code,r.error.message))),i?new ud(e,r.state,s):(xn(Gs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _g{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=rx();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=ER(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new _g(e,i):(xn(Gs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class _x{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new _x(t.clientId,t.onlineState):(xn(Gs,`Failed to parse online state: ${e}`),null)}}class J0{constructor(){this.activeTargetIds=rx()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Zy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new qt(Ge),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=QE(this.persistenceKey,this.Js),this.no=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new J0),this.ro=new RegExp(`^${rD}_${o}_([^_]*)$`),this.io=new RegExp(`^${sD}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${iD}_${o}_(\\d+)$`),this.oo=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this._o=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(QE(this.persistenceKey,r));if(s){const i=_g.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Xy(this.persistenceKey,e));if(s){const i=ud.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Xy(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return J(Gs,"READ",e,t),t}setItem(e,t){J(Gs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){J(Gs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(J(Gs,"EVENT",t.key,t.newValue),t.key===this.eo)return void xn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=Ar.ce;if(i!=null)try{const a=JSON.parse(i);be(typeof a=="number",30636,{So:i}),o=a}catch(a){xn(Gs,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Ar.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new vg(this.currentUser,e,t,r),i=KE(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=KE(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=Xy(this.persistenceKey,e),i=new ud(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return _g.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return vg.Ws(new Bn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return ud.Ws(s,t)}uo(e){return _x.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);J(Gs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{i.has(c)||a.push(c)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=rx();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class oD{constructor(){this.Mo=new J0,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new J0,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YE="ConnectivityMonitor";class JE{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){J(YE,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){J(YE,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kf=null;function X0(){return kf===null?kf=function(){return 268435456+Math.round(2147483648*Math.random())}():kf++,"0x"+kf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ev="RestConnection",b5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class E5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Kd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=X0(),a=this.zo(e,t.toUriEncodedString());J(ev,`Sending RPC '${e}' ${o}:`,a,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:u}=new URL(a),h=Ui(u);return this.Jo(e,a,c,r,h).then(f=>(J(ev,`Received RPC '${e}' ${o}: `,f),f),f=>{throw ms(ev,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=b5[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr="WebChannelConnection";class A5 extends E5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=X0();return new Promise((a,c)=>{const u=new uR;u.setWithCredentials(!0),u.listenOnce(dR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case tm.NO_ERROR:const f=u.getResponseJson();J(hr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case tm.TIMEOUT:J(hr,`RPC '${e}' ${o} timed out`),c(new G(F.DEADLINE_EXCEEDED,"Request time out"));break;case tm.HTTP_ERROR:const m=u.getStatus();if(J(hr,`RPC '${e}' ${o} failed with status:`,m,"response text:",u.getResponseText()),m>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const w=y==null?void 0:y.error;if(w&&w.status&&w.message){const S=function(I){const x=I.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(x)>=0?x:F.UNKNOWN}(w.status);c(new G(S,w.message))}else c(new G(F.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new G(F.UNAVAILABLE,"Connection failed."));break;default:ge(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{J(hr,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);J(hr,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=X0(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=mR(),a=fR(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const h=i.join("");J(hr,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=o.createWebChannel(h,c);this.I_(f);let m=!1,y=!1;const w=new T5({Yo:k=>{y?J(hr,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(m||(J(hr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),J(hr,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},Zo:()=>f.close()}),S=(k,I,x)=>{k.listen(I,C=>{try{x(C)}catch(D){setTimeout(()=>{throw D},0)}})};return S(f,Ou.EventType.OPEN,()=>{y||(J(hr,`RPC '${e}' stream ${s} transport opened.`),w.o_())}),S(f,Ou.EventType.CLOSE,()=>{y||(y=!0,J(hr,`RPC '${e}' stream ${s} transport closed`),w.a_(),this.E_(f))}),S(f,Ou.EventType.ERROR,k=>{y||(y=!0,ms(hr,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),w.a_(new G(F.UNAVAILABLE,"The operation could not be completed")))}),S(f,Ou.EventType.MESSAGE,k=>{var I;if(!y){const x=k.data[0];be(!!x,16349);const C=x,D=(C==null?void 0:C.error)||((I=C[0])==null?void 0:I.error);if(D){J(hr,`RPC '${e}' stream ${s} received error:`,D);const U=D.status;let L=function(E){const N=En[E];if(N!==void 0)return _k(N)}(U),R=D.message;L===void 0&&(L=F.INTERNAL,R="Unknown error status: "+U+" with message "+D.message),y=!0,w.a_(new G(L,R)),f.close()}else J(hr,`RPC '${e}' stream ${s} received:`,x),w.u_(x)}}),S(a,hR.STAT_EVENT,k=>{k.stat===C0.PROXY?J(hr,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===C0.NOPROXY&&J(hr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(){return typeof window<"u"?window:null}function um(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(n){return new P6(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wx{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&J("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XE="PersistentStream";class lD{constructor(e,t,r,s,i,o,a,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new wx(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(xn(t.toString()),xn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new G(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return J(XE,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(J(XE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class N5 extends lD{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=M6(this.serializer,e),r=function(i){if(!("targetChange"in i))return ke.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ke.min():o.readTime?Sn(o.readTime):ke.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=G0(this.serializer),t.addTarget=function(i,o){let a;const c=o.target;if(a=ug(c)?{documents:Nk(i,c)}:{query:Np(i,c).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Ik(i,o.resumeToken);const u=q0(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ke.min())>0){a.readTime=kc(i,o.snapshotVersion.toTimestamp());const u=q0(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=V6(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=G0(this.serializer),t.removeTarget=e,this.q_(t)}}class C5 extends lD{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return be(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,be(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){be(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=O6(e.writeResults,e.commitTime),r=Sn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=G0(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>eh(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{}class k5 extends R5{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new G(F.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,W0(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new G(F.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,W0(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new G(F.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class D5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(xn(t),this.aa=!1):J("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ka="RemoteStore";class P5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{ea(this)&&(J(Ka,"Restarting streams for network reachability change."),await async function(c){const u=oe(c);u.Ea.add(4),await Yc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Lh(u)}(this))})}),this.Ra=new D5(r,s)}}async function Lh(n){if(ea(n))for(const e of n.da)await e(!0)}async function Yc(n){for(const e of n.da)await e(!1)}function Pp(n,e){const t=oe(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ix(t)?Sx(t):Xc(t).O_()&&xx(t,e))}function jc(n,e){const t=oe(n),r=Xc(t);t.Ia.delete(e),r.O_()&&cD(t,e),t.Ia.size===0&&(r.O_()?r.L_():ea(t)&&t.Ra.set("Unknown"))}function xx(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ke.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Xc(n).Y_(e)}function cD(n,e){n.Va.Ue(e),Xc(n).Z_(e)}function Sx(n){n.Va=new C6({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Xc(n).start(),n.Ra.ua()}function Ix(n){return ea(n)&&!Xc(n).x_()&&n.Ia.size>0}function ea(n){return oe(n).Ea.size===0}function uD(n){n.Va=void 0}async function j5(n){n.Ra.set("Online")}async function L5(n){n.Ia.forEach((e,t)=>{xx(n,e)})}async function M5(n,e){uD(n),Ix(n)?(n.Ra.ha(e),Sx(n)):n.Ra.set("Unknown")}async function O5(n,e,t){if(n.Ra.set("Online"),e instanceof Sk&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){J(Ka,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await wg(n,r)}else if(e instanceof lm?n.Va.Ze(e):e instanceof xk?n.Va.st(e):n.Va.tt(e),!t.isEqual(ke.min()))try{const r=await Xk(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{const h=i.Ia.get(c);if(!h)return;i.Ia.set(c,h.withResumeToken(vn.EMPTY_BYTE_STRING,h.snapshotVersion)),cD(i,c);const f=new Si(h.target,c,u,h.sequenceNumber);xx(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){J(Ka,"Failed to raise snapshot:",r),await wg(n,r)}}async function wg(n,e,t){if(!Xo(e))throw e;n.Ea.add(1),await Yc(n),n.Ra.set("Offline"),t||(t=()=>Xk(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{J(Ka,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Lh(n)})}function dD(n,e){return e().catch(t=>wg(n,t,e))}async function Jc(n){const e=oe(n),t=qo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ko;for(;V5(e);)try{const s=await w5(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,F5(e,s)}catch(s){await wg(e,s)}hD(e)&&fD(e)}function V5(n){return ea(n)&&n.Ta.length<10}function F5(n,e){n.Ta.push(e);const t=qo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function hD(n){return ea(n)&&!qo(n).x_()&&n.Ta.length>0}function fD(n){qo(n).start()}async function U5(n){qo(n).ra()}async function $5(n){const e=qo(n);for(const t of n.Ta)e.ea(t.mutations)}async function B5(n,e,t){const r=n.Ta.shift(),s=ax.from(r,e,t);await dD(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Jc(n)}async function z5(n,e){e&&qo(n).X_&&await async function(r,s){if(function(o){return vk(o)&&o!==F.ABORTED}(s.code)){const i=r.Ta.shift();qo(r).B_(),await dD(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Jc(r)}}(n,e),hD(n)&&fD(n)}async function ZE(n,e){const t=oe(n);t.asyncQueue.verifyOperationInProgress(),J(Ka,"RemoteStore received new credentials");const r=ea(t);t.Ea.add(3),await Yc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Lh(t)}async function Z0(n,e){const t=oe(n);e?(t.Ea.delete(2),await Lh(t)):e||(t.Ea.add(2),await Yc(t),t.Ra.set("Unknown"))}function Xc(n){return n.ma||(n.ma=function(t,r,s){const i=oe(t);return i.sa(),new N5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:j5.bind(null,n),t_:L5.bind(null,n),r_:M5.bind(null,n),H_:O5.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Ix(n)?Sx(n):n.Ra.set("Unknown")):(await n.ma.stop(),uD(n))})),n.ma}function qo(n){return n.fa||(n.fa=function(t,r,s){const i=oe(t);return i.sa(),new C5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:U5.bind(null,n),r_:z5.bind(null,n),ta:$5.bind(null,n),na:B5.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Jc(n)):(await n.fa.stop(),n.Ta.length>0&&(J(Ka,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Wn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new bx(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new G(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Zc(n,e){if(xn("AsyncQueue",`${e}: ${n}`),Xo(n))return new G(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{static emptySet(e){return new Ca(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ie.comparator(t.key,r.key):(t,r)=>ie.comparator(t.key,r.key),this.keyedMap=Vu(),this.sortedSet=new qt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ca)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ca;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eT{constructor(){this.ga=new qt(ie.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ge(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ya{constructor(e,t,r,s,i,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ya(e,t,Ca.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Rh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class W5{constructor(){this.queries=tT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=oe(t),i=s.queries;s.queries=tT(),i.forEach((o,a)=>{for(const c of a.Sa)c.onError(r)})})(this,new G(F.ABORTED,"Firestore shutting down"))}}function tT(){return new Bi(n=>rk(n),Rh)}async function Ex(n,e){const t=oe(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new q5,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Zc(o,`Initialization of query '${Cl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Ax(t)}async function Tx(n,e){const t=oe(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function G5(n,e){const t=oe(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&Ax(t)}function H5(n,e,t){const r=oe(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Ax(n){n.Ca.forEach(e=>{e.next()})}var e_,nT;(nT=e_||(e_={})).Ma="default",nT.Cache="cache";class Nx{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ya(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ya.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==e_.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rT{constructor(e){this.serializer=e}$s(e){return ii(this.serializer,e)}Us(e){return e.metadata.exists?Ap(this.serializer,e.document,!1):Qt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Sn(e)}}class Cx{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=gD(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=it.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new rT(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ye()).add(i);t.set(o,a)}}return t}async ja(e){const t=await x5(e,new rT(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await S5(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function gD(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD{constructor(e){this.key=e}}class yD{constructor(e){this.key=e}}class vD{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ye(),this.mutatedKeys=Ye(),this.eu=ik(e),this.tu=new Ca(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new eT,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),y=kh(this.query,f)?f:null,w=!!m&&this.mutatedKeys.has(m.key),S=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let k=!1;m&&y?m.data.isEqual(y.data)?w!==S&&(r.track({type:3,doc:y}),k=!0):this.su(m,y)||(r.track({type:2,doc:y}),k=!0,(c&&this.eu(y,c)>0||u&&this.eu(y,u)<0)&&(a=!0)):!m&&y?(r.track({type:0,doc:y}),k=!0):m&&!y&&(r.track({type:1,doc:m}),k=!0,(c||u)&&(a=!0)),k&&(y?(o=o.add(y),i=S?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,w){const S=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ge(20277,{Rt:k})}};return S(y)-S(w)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,u=c!==this.Za;return this.Za=c,o.length!==0||u?{snapshot:new Ya(this.query,e.tu,i,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new eT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ye(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new yD(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new pD(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=Ye();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ya.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ta="SyncEngine";class Q5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class K5{constructor(e){this.key=e,this.hu=!1}}class Y5{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Bi(a=>rk(a),Rh),this.Iu=new Map,this.Eu=new Set,this.du=new qt(ie.comparator),this.Au=new Map,this.Ru=new fx,this.Vu={},this.mu=new Map,this.fu=Qa.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function J5(n,e,t=!0){const r=jp(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await _D(r,e,t,!0),s}async function X5(n,e){const t=jp(n);await _D(t,e,!0,!1)}async function _D(n,e,t,r){const s=await Dc(n.localStore,yr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Rx(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Pp(n.remoteStore,s),a}async function Rx(n,e,t,r,s){n.pu=(f,m,y)=>async function(S,k,I,x){let C=k.view.ru(I);C.Cs&&(C=await yg(S.localStore,k.query,!1).then(({documents:R})=>k.view.ru(R,C)));const D=x&&x.targetChanges.get(k.targetId),U=x&&x.targetMismatches.get(k.targetId)!=null,L=k.view.applyChanges(C,S.isPrimaryClient,D,U);return t_(S,k.targetId,L.au),L.snapshot}(n,f,m,y);const i=await yg(n.localStore,e,!0),o=new vD(e,i.Qs),a=o.ru(i.documents),c=jh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,c);t_(n,t,u.au);const h=new Q5(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function Z5(n,e,t){const r=oe(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Rh(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Pc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&jc(r.remoteStore,s.targetId),Lc(r,s.targetId)}).catch(Jo)):(Lc(r,s.targetId),await Pc(r.localStore,s.targetId,!0))}async function eU(n,e){const t=oe(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),jc(t.remoteStore,r.targetId))}async function tU(n,e,t){const r=jx(n);try{const s=await function(o,a){const c=oe(o),u=et.now(),h=a.reduce((y,w)=>y.add(w.key),Ye());let f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let w=Cr(),S=Ye();return c.Ns.getEntries(y,h).next(k=>{w=k,w.forEach((I,x)=>{x.isValidDocument()||(S=S.add(I))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,w)).next(k=>{f=k;const I=[];for(const x of a){const C=T6(x,f.get(x.key).overlayedDocument);C!=null&&I.push(new zi(x.key,C,GR(C.value.mapValue),an.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,I,a)}).next(k=>{m=k;const I=k.applyToLocalDocumentSet(f,S);return c.documentOverlayCache.saveOverlays(y,k.batchId,I)})}).then(()=>({batchId:m.batchId,changes:ak(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let u=o.Vu[o.currentUser.toKey()];u||(u=new qt(Ge)),u=u.insert(a,c),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await qi(r,s.changes),await Jc(r.remoteStore)}catch(s){const i=Zc(s,"Failed to persist write");t.reject(i)}}async function wD(n,e){const t=oe(n);try{const r=await _5(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(be(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?be(o.hu,14607):s.removedDocuments.size>0&&(be(o.hu,42227),o.hu=!1))}),await qi(t,r,e)}catch(r){await Jo(r)}}function sT(n,e,t){const r=oe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const c=oe(o);c.onlineState=a;let u=!1;c.queries.forEach((h,f)=>{for(const m of f.Sa)m.va(a)&&(u=!0)}),u&&Ax(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function nU(n,e,t){const r=oe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new qt(ie.comparator);o=o.insert(i,Qt.newNoDocument(i,ke.min()));const a=Ye().add(i),c=new Ph(ke.min(),new Map,new qt(Ge),o,a);await wD(r,c),r.du=r.du.remove(i),r.Au.delete(e),Px(r)}else await Pc(r.localStore,e,!1).then(()=>Lc(r,e,t)).catch(Jo)}async function rU(n,e){const t=oe(n),r=e.batch.batchId;try{const s=await v5(t.localStore,e);Dx(t,r,null),kx(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await qi(t,s)}catch(s){await Jo(s)}}async function sU(n,e,t){const r=oe(n);try{const s=await function(o,a){const c=oe(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return c.mutationQueue.lookupMutationBatch(u,a).next(f=>(be(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(u,f))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>c.localDocuments.getDocuments(u,h))})}(r.localStore,e);Dx(r,e,t),kx(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await qi(r,s)}catch(s){await Jo(s)}}async function iU(n,e){const t=oe(n);ea(t.remoteStore)||J(ta,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=oe(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===ko)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Zc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function kx(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Dx(n,e,t){const r=oe(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Lc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||xD(n,r)})}function xD(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(jc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Px(n))}function t_(n,e,t){for(const r of t)r instanceof pD?(n.Ru.addReference(r.key,e),oU(n,r)):r instanceof yD?(J(ta,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||xD(n,r.key)):ge(19791,{wu:r})}function oU(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(J(ta,"New document in limbo: "+t),n.Eu.add(r),Px(n))}function Px(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new ie(it.fromString(e)),r=n.fu.next();n.Au.set(r,new K5(t)),n.du=n.du.insert(t,r),Pp(n.remoteStore,new Si(yr(Hc(t.path)),r,"TargetPurposeLimboResolution",Ar.ce))}}async function qi(n,e,t){const r=oe(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,c)=>{o.push(r.pu(c,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(u){s.push(u);const f=yx.As(c.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(c,u){const h=oe(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>V.forEach(u,m=>V.forEach(m.Es,y=>h.persistence.referenceDelegate.addReference(f,m.targetId,y)).next(()=>V.forEach(m.ds,y=>h.persistence.referenceDelegate.removeReference(f,m.targetId,y)))))}catch(f){if(!Xo(f))throw f;J(vx,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const y=h.Ms.get(m),w=y.snapshotVersion,S=y.withLastLimboFreeSnapshotVersion(w);h.Ms=h.Ms.insert(m,S)}}}(r.localStore,i))}async function aU(n,e){const t=oe(n);if(!t.currentUser.isEqual(e)){J(ta,"User change. New user:",e.toKey());const r=await Jk(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(c=>{c.reject(new G(F.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await qi(t,r.Ls)}}function lU(n,e){const t=oe(n),r=t.Au.get(e);if(r&&r.hu)return Ye().add(r.key);{let s=Ye();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function cU(n,e){const t=oe(n),r=await yg(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&t_(t,e.targetId,s.au),s}async function uU(n,e){const t=oe(n);return tD(t.localStore,e).then(r=>qi(t,r))}async function dU(n,e,t,r){const s=oe(n),i=await function(a,c){const u=oe(a),h=oe(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,c).next(m=>m?u.localDocuments.getDocuments(f,m):V.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Jc(s.remoteStore):t==="acknowledged"||t==="rejected"?(Dx(s,e,r||null),kx(s,e),function(a,c){oe(oe(a).mutationQueue).ir(c)}(s.localStore,e)):ge(6720,"Unknown batchState",{Su:t}),await qi(s,i)):J(ta,"Cannot apply mutation batch with id: "+e)}async function hU(n,e){const t=oe(n);if(jp(t),jx(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await iT(t,r.toArray());t.gu=!0,await Z0(t.remoteStore,!0);for(const i of s)Pp(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Lc(t,o),Pc(t.localStore,o,!0))),jc(t.remoteStore,o)}),await s,await iT(t,r),function(o){const a=oe(o);a.Au.forEach((c,u)=>{jc(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new qt(ie.comparator)}(t),t.gu=!1,await Z0(t.remoteStore,!1)}}async function iT(n,e,t){const r=oe(n),s=[],i=[];for(const o of e){let a;const c=r.Iu.get(o);if(c&&c.length!==0){a=await Dc(r.localStore,yr(c[0]));for(const u of c){const h=r.Tu.get(u),f=await cU(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await eD(r.localStore,o);a=await Dc(r.localStore,u),await Rx(r,SD(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function SD(n){return ek(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function fU(n){return function(t){return oe(oe(t).persistence).Ts()}(oe(n).localStore)}async function mU(n,e,t,r){const s=oe(n);if(s.gu)return void J(ta,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await tD(s.localStore,sk(i[0])),a=Ph.createSynthesizedRemoteEventForCurrentChange(e,t==="current",vn.EMPTY_BYTE_STRING);await qi(s,o,a);break}case"rejected":await Pc(s.localStore,e,!0),Lc(s,e,r);break;default:ge(64155,t)}}async function gU(n,e,t){const r=jp(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){J(ta,"Adding an already active target "+s);continue}const i=await eD(r.localStore,s),o=await Dc(r.localStore,i);await Rx(r,SD(i),o.targetId,!1,o.resumeToken),Pp(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await Pc(r.localStore,s,!1).then(()=>{jc(r.remoteStore,s),Lc(r,s)}).catch(Jo)}}function jp(n){const e=oe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=wD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nU.bind(null,e),e.Pu.H_=G5.bind(null,e.eventManager),e.Pu.yu=H5.bind(null,e.eventManager),e}function jx(n){const e=oe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=sU.bind(null,e),e}function pU(n,e,t){const r=oe(n);(async function(i,o,a){try{const c=await o.getMetadata();if(await function(y,w){const S=oe(y),k=Sn(w.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",I=>S.Ii.getBundleMetadata(I,w.id)).then(I=>!!I&&I.createTime.compareTo(k)>=0)}(i.localStore,c))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(gD(c));const u=new Cx(c,o.serializer);let h=await o.bu();for(;h;){const m=await u.Ga(h);m&&a._updateProgress(m),h=await o.bu()}const f=await u.ja(i.localStore);return await qi(i,f.Ha,void 0),await function(y,w){const S=oe(y);return S.persistence.runTransaction("Save bundle","readwrite",k=>S.Ii.saveBundleMetadata(k,w))}(i.localStore,c),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(c){return ms(ta,`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Mc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ll(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Yk(this.persistence,new Kk,e.initialUser,this.serializer)}Cu(e){return new mx(Dp.mi,this.serializer)}Du(e){return new oD}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mc.provider={build:()=>new Mc};class Lx extends Mc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){be(this.persistence.referenceDelegate instanceof pg,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new zk(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?fr.withCacheSize(this.cacheSizeBytes):fr.DEFAULT;return new mx(r=>pg.mi(r,t),this.serializer)}}class Mx extends Mc{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await jx(this.xu.syncEngine),await Jc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return Yk(this.persistence,new Kk,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new zk(r,e.asyncQueue,t)}Mu(e,t){const r=new k3(t,this.persistence);return new R3(e.asyncQueue,r)}Cu(e){const t=px(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?fr.withCacheSize(this.cacheSizeBytes):fr.DEFAULT;return new gx(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,aD(),um(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new oD}}class ID extends Mx{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Zy&&(this.sharedClientState.syncEngine={Co:dU.bind(null,t),vo:mU.bind(null,t),Fo:gU.bind(null,t),Ts:fU.bind(null,t),Do:uU.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await hU(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=aD();if(!Zy.v(t))throw new G(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=px(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Zy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Wo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>sT(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=aU.bind(null,this.syncEngine),await Z0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new W5}()}createDatastore(e){const t=ll(e.databaseInfo.databaseId),r=function(i){return new A5(i)}(e.databaseInfo);return function(i,o,a,c){return new k5(i,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new P5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>sT(this.syncEngine,t,0),function(){return JE.v()?new JE:new I5}())}createSyncEngine(e,t){return function(s,i,o,a,c,u,h){const f=new Y5(s,i,o,a,c,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=oe(s);J(Ka,"RemoteStore shutting down."),i.Ea.add(5),await Yc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Wo.provider={build:()=>new Wo};function oT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):xn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yU{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Wn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new mD(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vU{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new mD(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new G(F.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _U{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new G(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=oe(s),a={documents:i.map(f=>Zd(o.serializer,f))},c=await o.Ho("BatchGetDocuments",o.serializer.databaseId,it.emptyPath(),a,i.length),u=new Map;c.forEach(f=>{const m=L6(o.serializer,f);u.set(m.key.toString(),m)});const h=[];return i.forEach(f=>{const m=u.get(f.toString());be(!!m,55234,{key:f}),h.push(m)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Kc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ie.fromPath(r);this.mutations.push(new ix(s,this.precondition(s)))}),await async function(r,s){const i=oe(r),o={writes:s.map(a=>eh(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,it.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ge(50498,{Gu:e.constructor.name});t=ke.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new G(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ke.min())?an.exists(!1):an.updateTime(t):an.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ke.min()))throw new G(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return an.updateTime(t)}return an.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wU{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new wx(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new _U(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!Ah(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!vk(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go="FirestoreClient";class xU{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Bn.UNAUTHENTICATED,this.clientId=Ww.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{J(Go,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(J(Go,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Zc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function tv(n,e){n.asyncQueue.verifyOperationInProgress(),J(Go,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Jk(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function aT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Ox(n);J(Go,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>ZE(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>ZE(e.remoteStore,s)),n._onlineComponents=e}async function Ox(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){J(Go,"Using user provided OfflineComponentProvider");try{await tv(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;ms("Error using user provided cache. Falling back to memory cache: "+t),await tv(n,new Mc)}}else J(Go,"Using default OfflineComponentProvider"),await tv(n,new Lx(void 0));return n._offlineComponents}async function Mp(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(J(Go,"Using user provided OnlineComponentProvider"),await aT(n,n._uninitializedComponentsProvider._online)):(J(Go,"Using default OnlineComponentProvider"),await aT(n,new Wo))),n._onlineComponents}function bD(n){return Ox(n).then(e=>e.persistence)}function eu(n){return Ox(n).then(e=>e.localStore)}function ED(n){return Mp(n).then(e=>e.remoteStore)}function Vx(n){return Mp(n).then(e=>e.syncEngine)}function TD(n){return Mp(n).then(e=>e.datastore)}async function Oc(n){const e=await Mp(n),t=e.eventManager;return t.onListen=J5.bind(null,e.syncEngine),t.onUnlisten=Z5.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=X5.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=eU.bind(null,e.syncEngine),t}function SU(n){return n.asyncQueue.enqueue(async()=>{const e=await bD(n),t=await ED(n);return e.setNetworkEnabled(!0),function(s){const i=oe(s);return i.Ea.delete(0),Lh(i)}(t)})}function IU(n){return n.asyncQueue.enqueue(async()=>{const e=await bD(n),t=await ED(n);return e.setNetworkEnabled(!1),async function(s){const i=oe(s);i.Ea.add(0),await Yc(i),i.Ra.set("Offline")}(t)})}function bU(n,e){const t=new Wn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=oe(u);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new G(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const c=Zc(a,`Failed to get document '${i} from cache`);o.reject(c)}}(await eu(n),e,t)),t.promise}function AD(n,e,t={}){const r=new Wn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const h=new Lp({next:m=>{h.Nu(),o.enqueueAndForget(()=>Tx(i,f));const y=m.docs.has(a);!y&&m.fromCache?u.reject(new G(F.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&c&&c.source==="server"?u.reject(new G(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Nx(Hc(a.path),h,{includeMetadataChanges:!0,qa:!0});return Ex(i,f)}(await Oc(n),n.asyncQueue,e,t,r)),r.promise}function EU(n,e){const t=new Wn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await yg(s,i,!0),c=new vD(i,a.Qs),u=c.ru(a.documents),h=c.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const c=Zc(a,`Failed to execute query '${i} against cache`);o.reject(c)}}(await eu(n),e,t)),t.promise}function ND(n,e,t={}){const r=new Wn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const h=new Lp({next:m=>{h.Nu(),o.enqueueAndForget(()=>Tx(i,f)),m.fromCache&&c.source==="server"?u.reject(new G(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Nx(a,h,{includeMetadataChanges:!0,qa:!0});return Ex(i,f)}(await Oc(n),n.asyncQueue,e,t,r)),r.promise}function TU(n,e,t){const r=new Wn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await TD(n);r.resolve(async function(o,a,c){var S;const u=oe(o),{request:h,gt:f,parent:m}=Ck(u.serializer,tk(a),c);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,m,h,1)).filter(k=>!!k.result);be(y.length===1,64727);const w=(S=y[0].result)==null?void 0:S.aggregateFields;return Object.keys(w).reduce((k,I)=>(k[f[I]]=w[I],k),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function AU(n,e){const t=new Lp(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){oe(s).Ca.add(i),i.next()}(await Oc(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){oe(s).Ca.delete(i)}(await Oc(n),t))}}function NU(n,e,t,r){const s=function(o,a){let c;return c=typeof o=="string"?wk().encode(o):o,function(h,f){return new yU(h,f)}(function(h,f){if(h instanceof Uint8Array)return oT(h,f);if(h instanceof ArrayBuffer)return oT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,ll(e));n.asyncQueue.enqueueAndForget(async()=>{pU(await Vx(n),s,r)})}function CU(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=oe(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await eu(n),e))}function CD(n,e){return function(r,s){return new vU(r,s)}(n,e)}function RU(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=oe(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>o.getFieldIndexes(c).next(u=>function(f,m,y,w,S){f=[...f],m=[...m],f.sort(y),m.sort(y);const k=f.length,I=m.length;let x=0,C=0;for(;x<I&&C<k;){const D=y(f[C],m[x]);D<0?S(f[C++]):D>0?w(m[x++]):(x++,C++)}for(;x<I;)w(m[x++]);for(;C<k;)S(f[C++])}(u,s,T3,h=>{a.push(o.addFieldIndex(c,h))},h=>{a.push(o.deleteFieldIndex(c,h))})).next(()=>V.waitFor(a)))}(await eu(n),e))}function kU(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){oe(r).Fs.Vs=s}(await eu(n),e))}function DU(n){return n.asyncQueue.enqueue(async()=>function(t){const r=oe(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await eu(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kD="firestore.googleapis.com",cT=!0;class uT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new G(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=kD,this.ssl=cT}else this.host=e.host,this.ssl=e.ssl??cT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Vk;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Bk)throw new G(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}E3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=RD(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Mh{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new G(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new G(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new g3;switch(r.type){case"firstParty":return new _3(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new G(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=lT.get(t);r&&(J("ComponentProvider","Removing Datastore"),lT.delete(t),r.terminate())}(this),Promise.resolve()}}function PU(n,e,t,r={}){var u;n=ct(n,Mh);const s=Ui(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Yg(`https://${a}`),tw("Firestore",!0)),i.host!==kD&&i.host!==a&&ms("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:a,ssl:s,emulatorOptions:r};if(!Yr(c,o)&&(n._setSettings(c),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Bn.MOCK_USER;else{h=CN(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new G(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Bn(m)}n._authCredentials=new p3(new pR(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Qn(this.firestore,e,this._query)}}class Lt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Lt(this.firestore,e,this._key)}toJSON(){return{type:Lt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(al(t,Lt._jsonSchema))return new Lt(e,r||null,new ie(it.fromString(t.referencePath)))}}Lt._jsonSchemaVersion="firestore/documentReference/1.0",Lt._jsonSchema={type:Nn("string",Lt._jsonSchemaVersion),referencePath:Nn("string")};class oi extends Qn{constructor(e,t,r){super(e,t,Hc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Lt(this.firestore,null,new ie(e))}withConverter(e){return new oi(this.firestore,e,this._path)}}function kn(n,e,...t){if(n=he(n),Gw("collection","path",e),n instanceof Mh){const r=it.fromString(e,...t);return Xb(r),new oi(n,null,r)}{if(!(n instanceof Lt||n instanceof oi))throw new G(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return Xb(r),new oi(n.firestore,null,r)}}function p7(n,e){if(n=ct(n,Mh),Gw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new G(F.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Qn(n,null,function(r){return new $i(it.emptyPath(),r)}(e))}function dm(n,e,...t){if(n=he(n),arguments.length===1&&(e=Ww.newId()),Gw("doc","path",e),n instanceof Mh){const r=it.fromString(e,...t);return Jb(r),new Lt(n,null,new ie(r))}{if(!(n instanceof Lt||n instanceof oi))throw new G(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return Jb(r),new Lt(n.firestore,n instanceof oi?n.converter:null,new ie(r))}}function y7(n,e){return n=he(n),e=he(e),(n instanceof Lt||n instanceof oi)&&(e instanceof Lt||e instanceof oi)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function DD(n,e){return n=he(n),e=he(e),n instanceof Qn&&e instanceof Qn&&n.firestore===e.firestore&&Rh(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dT="AsyncQueue";class hT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new wx(this,"async_queue_retry"),this._c=()=>{const r=um();r&&J(dT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=um();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=um();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Wn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Xo(e))throw e;J(dT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,xn("INTERNAL UNHANDLED ERROR: ",fT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=bx.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ge(47125,{Pc:fT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function fT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class jU{constructor(){this._progressObserver={},this._taskCompletionResolver=new Wn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v7=-1;class Ft extends Mh{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new hT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new hT(e),this._firestoreClient=void 0,await e}}}function _7(n,e,t){t||(t=Kd);const r=hi(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Yr(i,e))return s;throw new G(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new G(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Bk)throw new G(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Ui(e.host)&&Yg(e.host),r.initialize({options:e,instanceIdentifier:t})}function LU(n,e){const t=typeof n=="object"?n:ph(),r=typeof n=="string"?n:e||Kd,s=hi(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=TN("firestore");i&&PU(s,...i)}return s}function fn(n){if(n._terminated)throw new G(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||PD(n),n._firestoreClient}function PD(n){var r,s,i;const e=n._freezeSettings(),t=function(a,c,u,h){return new i6(a,c,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,RD(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new xU(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const c=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(c),_online:c}}(n._componentsProvider))}function w7(n,e){ms("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return jD(n,Wo.provider,{build:r=>new Mx(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function x7(n){ms("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();jD(n,Wo.provider,{build:t=>new ID(t,e.cacheSizeBytes)})}function jD(n,e,t){if((n=ct(n,Ft))._firestoreClient||n._terminated)throw new G(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new G(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},PD(n)}function S7(n){if(n._initialized&&!n._terminated)throw new G(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Wn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!si.v())return Promise.resolve();const s=r+Qk;await si.delete(s)}(px(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function I7(n){return function(t){const r=new Wn;return t.asyncQueue.enqueueAndForget(async()=>iU(await Vx(t),r)),r.promise}(fn(n=ct(n,Ft)))}function b7(n){return SU(fn(n=ct(n,Ft)))}function E7(n){return IU(fn(n=ct(n,Ft)))}function T7(n){return PO(n.app,"firestore",n._databaseId.database),n._delete()}function mT(n,e){const t=fn(n=ct(n,Ft)),r=new jU;return NU(t,n._databaseId,e,r),r}function MU(n,e){return CU(fn(n=ct(n,Ft)),e).then(t=>t?new Qn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class OU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new zr(vn.fromBase64String(e))}catch(t){throw new G(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new zr(vn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:zr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(al(e,zr._jsonSchema))return zr.fromBase64String(e.bytes)}}zr._jsonSchemaVersion="firestore/bytes/1.0",zr._jsonSchema={type:Nn("string",zr._jsonSchemaVersion),bytes:Nn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new G(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new on(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function A7(){return new cl(D0)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new G(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new G(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ge(this._lat,e._lat)||Ge(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ai._jsonSchemaVersion}}static fromJSON(e){if(al(e,ai._jsonSchema))return new ai(e.latitude,e.longitude)}}ai._jsonSchemaVersion="firestore/geoPoint/1.0",ai._jsonSchema={type:Nn("string",ai._jsonSchemaVersion),latitude:Nn("number"),longitude:Nn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ps._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(al(e,Ps._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Ps(e.vectorValues);throw new G(F.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ps._jsonSchemaVersion="firestore/vectorValue/1.0",Ps._jsonSchema={type:Nn("string",Ps._jsonSchemaVersion),vectorValues:Nn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VU=/^__.*__$/;class FU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new zi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qc(e,this.data,t,this.fieldTransforms)}}class LD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new zi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function MD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ge(40011,{Ac:n})}}class Op{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Op({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return xg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(MD(this.Ac)&&VU.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class UU{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ll(e)}Cc(e,t,r,s=!1){return new Op({Ac:e,methodName:t,Dc:r,path:on.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dl(n){const e=n._freezeSettings(),t=ll(n._databaseId);return new UU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Vp(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Wx("Data must be an object, but it was:",o,r);const a=FD(r,o);let c,u;if(i.merge)c=new Nr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=nh(e,f,t);if(!o.contains(m))throw new G(F.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);$D(h,m)||h.push(m)}c=new Nr(h),u=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,u=o.fieldTransforms;return new FU(new nr(a),c,u)}class Oh extends ul{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Oh}}function OD(n,e,t){return new Op({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Fx extends ul{_toFieldTransform(e){return new Dh(e.path,new Cc)}isEqual(e){return e instanceof Fx}}class Ux extends ul{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=OD(this,e,!0),r=this.vc.map(i=>hl(i,t)),s=new qa(r);return new Dh(e.path,s)}isEqual(e){return e instanceof Ux&&Yr(this.vc,e.vc)}}class $x extends ul{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=OD(this,e,!0),r=this.vc.map(i=>hl(i,t)),s=new Wa(r);return new Dh(e.path,s)}isEqual(e){return e instanceof $x&&Yr(this.vc,e.vc)}}class Bx extends ul{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Rc(e.serializer,uk(e.serializer,this.Fc));return new Dh(e.path,t)}isEqual(e){return e instanceof Bx&&this.Fc===e.Fc}}function zx(n,e,t,r){const s=n.Cc(1,e,t);Wx("Data must be an object, but it was:",s,r);const i=[],o=nr.empty();Zo(r,(c,u)=>{const h=Fp(e,c,t);u=he(u);const f=s.yc(h);if(u instanceof Oh)i.push(h);else{const m=hl(u,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new Nr(i);return new LD(o,a,s.fieldTransforms)}function qx(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[nh(e,r,t)],c=[s];if(i.length%2!=0)throw new G(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(nh(e,i[m])),c.push(i[m+1]);const u=[],h=nr.empty();for(let m=a.length-1;m>=0;--m)if(!$D(u,a[m])){const y=a[m];let w=c[m];w=he(w);const S=o.yc(y);if(w instanceof Oh)u.push(y);else{const k=hl(w,S);k!=null&&(u.push(y),h.set(y,k))}}const f=new Nr(u);return new LD(h,f,o.fieldTransforms)}function VD(n,e,t,r=!1){return hl(t,n.Cc(r?4:3,e))}function hl(n,e){if(UD(n=he(n)))return Wx("Unsupported field value:",e,n),FD(n,e);if(n instanceof ul)return function(r,s){if(!MD(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let c=hl(a,s.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=he(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return uk(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=et.fromDate(r);return{timestampValue:kc(s.serializer,i)}}if(r instanceof et){const i=new et(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:kc(s.serializer,i)}}if(r instanceof ai)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof zr)return{bytesValue:Ik(s.serializer,r._byteString)};if(r instanceof Lt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ux(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ps)return function(o,a){return{mapValue:{fields:{[Zw]:{stringValue:ex},[Tc]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return sx(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${yp(r)}`)}(n,e)}function FD(n,e){const t={};return OR(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zo(n,(r,s)=>{const i=hl(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function UD(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof et||n instanceof ai||n instanceof zr||n instanceof Lt||n instanceof ul||n instanceof Ps)}function Wx(n,e,t){if(!UD(t)||!vR(t)){const r=yp(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function nh(n,e,t){if((e=he(e))instanceof cl)return e._internalPath;if(typeof e=="string")return Fp(n,e);throw xg("Field path arguments must be of type string or ",n,!1,void 0,t)}const $U=new RegExp("[~\\*/\\[\\]]");function Fp(n,e,t){if(e.search($U)>=0)throw xg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new cl(...e.split("."))._internalPath}catch{throw xg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xg(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new G(F.INVALID_ARGUMENT,a+n+c)}function $D(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Lt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new BU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Up("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class BU extends rh{data(){return super.data()}}function Up(n,e){return typeof e=="string"?Fp(n,e):e instanceof cl?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new G(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gx{}class Vh extends Gx{}function As(n,e,...t){let r=[];e instanceof Gx&&r.push(e),r=r.concat(t),function(i){const o=i.filter(c=>c instanceof tu).length,a=i.filter(c=>c instanceof Fh).length;if(o>1||o>0&&a>0)throw new G(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Fh extends Vh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Fh(e,t,r)}_apply(e){const t=this._parse(e);return WD(e._query,t),new Qn(e.firestore,e.converter,z0(e._query,t))}_parse(e){const t=dl(e.firestore);return function(i,o,a,c,u,h,f){let m;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new G(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){pT(f,h);const w=[];for(const S of f)w.push(gT(c,i,S));m={arrayValue:{values:w}}}else m=gT(c,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||pT(f,h),m=VD(a,o,f,h==="in"||h==="not-in");return dt.create(u,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ns(n,e,t){const r=e,s=Up("where",n);return Fh._create(s,r,t)}class tu extends Gx{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new tu(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Dt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const c of a)WD(o,c),o=z0(o,c)}(e._query,t),new Qn(e.firestore,e.converter,z0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function N7(...n){return n.forEach(e=>GD("or",e)),tu._create("or",n)}function C7(...n){return n.forEach(e=>GD("and",e)),tu._create("and",n)}class Hx extends Vh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Hx(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new G(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new G(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Xd(i,o)}(e._query,this._field,this._direction);return new Qn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new $i(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function Sg(n,e="asc"){const t=e,r=Up("orderBy",n);return Hx._create(r,t)}class $p extends Vh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new $p(e,t,r)}_apply(e){return new Qn(e.firestore,e.converter,hg(e._query,this._limit,this._limitType))}}function zD(n){return _R("limit",n),$p._create("limit",n,"F")}function R7(n){return _R("limitToLast",n),$p._create("limitToLast",n,"L")}class Bp extends Vh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Bp(e,t,r)}_apply(e){const t=qD(e,this.type,this._docOrFields,this._inclusive);return new Qn(e.firestore,e.converter,function(s,i){return new $i(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function k7(...n){return Bp._create("startAt",n,!0)}function D7(...n){return Bp._create("startAfter",n,!1)}class zp extends Vh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new zp(e,t,r)}_apply(e){const t=qD(e,this.type,this._docOrFields,this._inclusive);return new Qn(e.firestore,e.converter,function(s,i){return new $i(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function P7(...n){return zp._create("endBefore",n,!1)}function j7(...n){return zp._create("endAt",n,!0)}function qD(n,e,t,r){if(t[0]=he(t[0]),t[0]instanceof rh)return function(i,o,a,c,u){if(!c)throw new G(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Xl(i))if(f.field.isKeyField())h.push(Ba(o,c.key));else{const m=c.data.field(f.field);if(Sp(m))throw new G(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const y=f.field.canonicalString();throw new G(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(m)}return new zo(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=dl(n.firestore);return function(o,a,c,u,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new G(F.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let w=0;w<h.length;w++){const S=h[w];if(m[w].field.isKeyField()){if(typeof S!="string")throw new G(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof S}`);if(!nx(o)&&S.indexOf("/")!==-1)throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${S}' contains a slash.`);const k=o.path.child(it.fromString(S));if(!ie.isDocumentKey(k))throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const I=new ie(k);y.push(Ba(a,I))}else{const k=VD(c,u,S);y.push(k)}}return new zo(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function gT(n,e,t){if(typeof(t=he(t))=="string"){if(t==="")throw new G(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nx(e)&&t.indexOf("/")!==-1)throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(it.fromString(t));if(!ie.isDocumentKey(r))throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ba(n,new ie(r))}if(t instanceof Lt)return Ba(n,t._key);throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${yp(t)}.`)}function pT(n,e){if(!Array.isArray(n)||n.length===0)throw new G(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function WD(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new G(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new G(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function GD(n,e){if(!(e instanceof Fh||e instanceof tu))throw new G(F.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class HD{convertValue(e,t="none"){switch($o(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Li(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ge(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Zo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[Tc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>tn(o.doubleValue));return new Ps(t)}convertGeoPoint(e){return new ai(tn(e.latitude),tn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ip(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Qd(e));default:return null}}convertTimestamp(e){const t=ji(e);return new et(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=it.fromString(e);be(Pk(r),9688,{name:e});const s=new $a(r.get(1),r.get(3)),i=new ie(r.popFirst(5));return s.isEqual(t)||xn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Qx extends HD{constructor(e){super(),this.firestore=e}convertBytes(e){return new zr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Lt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L7(n){return new th("sum",nh("sum",n))}function M7(n){return new th("avg",nh("average",n))}function zU(){return new th("count")}function O7(n,e){var t,r;return n instanceof th&&e instanceof th&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function V7(n,e){return DD(n.query,e.query)&&Yr(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD="NOT SUPPORTED";class yo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gr extends rh{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new hm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Up("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new G(F.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Gr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function F7(n,e,t){if(al(e,Gr._jsonSchema)){if(e.bundle===QD)throw new G(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=ll(n._databaseId),s=CD(e.bundle,r),i=s.Wu(),o=new Cx(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new G(F.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const c=Ap(r,a[0].document),u=new ie(it.fromString(e.bundleName));return new Gr(n,new Qx(n),u,c,new yo(!1,!1),t||null)}}Gr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Gr._jsonSchema={type:Nn("string",Gr._jsonSchemaVersion),bundleSource:Nn("string","DocumentSnapshot"),bundleName:Nn("string"),bundle:Nn("string")};class hm extends Gr{data(e={}){return super.data(e)}}class Hr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new yo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new hm(this._firestore,this._userDataWriter,r.key,r,new yo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new G(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const c=new hm(s._firestore,s._userDataWriter,a.doc.key,a.doc,new yo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const c=new hm(s._firestore,s._userDataWriter,a.doc.key,a.doc,new yo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:qU(a.type),doc:c,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new G(F.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Hr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ww.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function U7(n,e,t){if(al(e,Hr._jsonSchema)){if(e.bundle===QD)throw new G(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=ll(n._databaseId),s=CD(e.bundle,r),i=s.Wu(),o=new Cx(s.getMetadata(),r);for(const m of i)o.Ga(m);if(o.queries.length!==1)throw new G(F.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=Cp(o.queries[0].bundledQuery),c=o.documents;let u=new Ca;c.map(m=>{const y=Ap(r,m.document);u=u.add(y)});const h=Ya.fromInitialDocuments(a,u,Ye(),!1,!1),f=new Qn(n,t||null,a);return new Hr(n,new Qx(n),f,h)}}function qU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ge(61501,{type:n})}}function $7(n,e){return n instanceof Gr&&e instanceof Gr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Hr&&e instanceof Hr&&n._firestore===e._firestore&&DD(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WU(n){n=ct(n,Lt);const e=ct(n.firestore,Ft);return AD(fn(e),n._key).then(t=>Kx(e,n,t))}Hr._jsonSchemaVersion="firestore/querySnapshot/1.0",Hr._jsonSchema={type:Nn("string",Hr._jsonSchemaVersion),bundleSource:Nn("string","QuerySnapshot"),bundleName:Nn("string"),bundle:Nn("string")};class na extends HD{constructor(e){super(),this.firestore=e}convertBytes(e){return new zr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Lt(this.firestore,null,t)}}function B7(n){n=ct(n,Lt);const e=ct(n.firestore,Ft),t=fn(e),r=new na(e);return bU(t,n._key).then(s=>new Gr(e,r,n._key,s,new yo(s!==null&&s.hasLocalMutations,!0),n.converter))}function z7(n){n=ct(n,Lt);const e=ct(n.firestore,Ft);return AD(fn(e),n._key,{source:"server"}).then(t=>Kx(e,n,t))}function li(n){n=ct(n,Qn);const e=ct(n.firestore,Ft),t=fn(e),r=new na(e);return BD(n._query),ND(t,n._query).then(s=>new Hr(e,r,n,s))}function q7(n){n=ct(n,Qn);const e=ct(n.firestore,Ft),t=fn(e),r=new na(e);return EU(t,n._query).then(s=>new Hr(e,r,n,s))}function W7(n){n=ct(n,Qn);const e=ct(n.firestore,Ft),t=fn(e),r=new na(e);return ND(t,n._query,{source:"server"}).then(s=>new Hr(e,r,n,s))}function GU(n,e,t){n=ct(n,Lt);const r=ct(n.firestore,Ft),s=qp(n.converter,e,t);return Uh(r,[Vp(dl(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,an.none())])}function G7(n,e,t,...r){n=ct(n,Lt);const s=ct(n.firestore,Ft),i=dl(s);let o;return o=typeof(e=he(e))=="string"||e instanceof cl?qx(i,"updateDoc",n._key,e,t,r):zx(i,"updateDoc",n._key,e),Uh(s,[o.toMutation(n._key,an.exists(!0))])}function HU(n){return Uh(ct(n.firestore,Ft),[new Kc(n._key,an.none())])}function Ss(n,e){const t=ct(n.firestore,Ft),r=dm(n),s=qp(n.converter,e);return Uh(t,[Vp(dl(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,an.exists(!1))]).then(()=>r)}function yT(n,...e){var c,u,h;n=he(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Zl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Zl(e[r])){const f=e[r];e[r]=(c=f.next)==null?void 0:c.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof Lt)o=ct(n.firestore,Ft),a=Hc(n._key.path),i={next:f=>{e[r]&&e[r](Kx(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=ct(n,Qn);o=ct(f.firestore,Ft),a=f._query;const m=new na(o);i={next:y=>{e[r]&&e[r](new Hr(o,m,f,y))},error:e[r+1],complete:e[r+2]},BD(n._query)}return function(m,y,w,S){const k=new Lp(S),I=new Nx(y,k,w);return m.asyncQueue.enqueueAndForget(async()=>Ex(await Oc(m),I)),()=>{k.Nu(),m.asyncQueue.enqueueAndForget(async()=>Tx(await Oc(m),I))}}(fn(o),a,s,i)}function H7(n,e,...t){const r=he(n),s=function(c){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in c)){u.error=`snapshotJson missing required field: ${f}`;break}const m=c[f];if(typeof m!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(m.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=m:f==="bundleName"?u.bundleName=m:f==="bundleSource"&&(u.bundleSource=m)}return u}(e);if(s.error)throw new G(F.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Zl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Zl(t[o])){const c=t[o++];a={next:c.next,error:c.error,complete:c.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,y){let w,S=!1;return mT(u,h.bundle).then(()=>MU(u,h.bundleName)).then(I=>{I&&!S&&(y&&I.withConverter(y),w=yT(I,f||{},m))}).catch(I=>(m.error&&m.error(I),()=>{})),()=>{S||(S=!0,w&&w())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Zl(t[o])){const c=t[o++];a={next:c.next,error:c.error,complete:c.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,y){let w,S=!1;return mT(u,h.bundle).then(()=>{if(!S){const I=new Lt(u,y||null,ie.fromPath(h.bundleName));w=yT(I,f||{},m)}}).catch(I=>(m.error&&m.error(I),()=>{})),()=>{S||(S=!0,w&&w())}}(r,s,i,a,t[o])}throw new G(F.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function Q7(n,e){return AU(fn(n=ct(n,Ft)),Zl(e)?e:{next:e})}function Uh(n,e){return function(r,s){const i=new Wn;return r.asyncQueue.enqueueAndForget(async()=>tU(await Vx(r),s,i)),i.promise}(fn(n),e)}function Kx(n,e,t){const r=t.docs.get(e._key),s=new na(n);return new Gr(n,s,e._key,r,new yo(t.hasPendingWrites,t.fromCache),e.converter)}function K7(n){return QU(n,{count:zU()})}function QU(n,e){const t=ct(n.firestore,Ft),r=fn(t),s=MR(e,(i,o)=>new yk(o,i.aggregateType,i._internalFieldPath));return TU(r,n._query,s).then(i=>function(a,c,u){const h=new na(a);return new OU(c,h,u)}(t,n,i))}class KU{constructor(e){this.kind="memory",this._onlineComponentProvider=Wo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Lx(void 0)}}toJSON(){return{kind:this.kind}}}class YU{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=t$(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class JU{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Mc.provider}toJSON(){return{kind:this.kind}}}class XU{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Lx(e)}}toJSON(){return{kind:this.kind}}}function Y7(){return new JU}function J7(n){return new XU(n==null?void 0:n.cacheSizeBytes)}function X7(n){return new KU(n)}function Z7(n){return new YU(n)}class ZU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Wo.provider,this._offlineComponentProvider={build:t=>new Mx(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class e${constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Wo.provider,this._offlineComponentProvider={build:t=>new ID(t,e==null?void 0:e.cacheSizeBytes)}}}function t$(n){return new ZU(n==null?void 0:n.forceOwnership)}function eW(){return new e$}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n$={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r${constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=dl(e)}set(e,t,r){this._verifyNotCommitted();const s=vo(e,this._firestore),i=qp(s.converter,t,r),o=Vp(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,an.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=vo(e,this._firestore);let o;return o=typeof(t=he(t))=="string"||t instanceof cl?qx(this._dataReader,"WriteBatch.update",i._key,t,r,s):zx(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,an.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=vo(e,this._firestore);return this._mutations=this._mutations.concat(new Kc(t._key,an.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new G(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function vo(n,e){if((n=he(n)).firestore!==e)throw new G(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s${constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=dl(e)}get(e){const t=vo(e,this._firestore),r=new Qx(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return ge(24041);const i=s[0];if(i.isFoundDocument())return new rh(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new rh(this._firestore,r,t._key,null,t.converter);throw ge(18433,{doc:i})})}set(e,t,r){const s=vo(e,this._firestore),i=qp(s.converter,t,r),o=Vp(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=vo(e,this._firestore);let o;return o=typeof(t=he(t))=="string"||t instanceof cl?qx(this._dataReader,"Transaction.update",i._key,t,r,s):zx(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=vo(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i$ extends s${constructor(e,t){super(e,t),this._firestore=e}get(e){const t=vo(e,this._firestore),r=new na(this._firestore);return super.get(e).then(s=>new Gr(this._firestore,r,t._key,s._document,new yo(!1,!1),t.converter))}}function tW(n,e,t){n=ct(n,Ft);const r={...n$,...t};return function(i){if(i.maxAttempts<1)throw new G(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const c=new Wn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await TD(i);new wU(i.asyncQueue,u,a,o,c).ju()}),c.promise}(fn(n),s=>e(new i$(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nW(){return new Oh("deleteField")}function fm(){return new Fx("serverTimestamp")}function rW(...n){return new Ux("arrayUnion",n)}function sW(...n){return new $x("arrayRemove",n)}function iW(n){return new Bx("increment",n)}function oW(n){return new Ps(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aW(n){return fn(n=ct(n,Ft)),new r$(n,e=>Uh(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lW(n,e){const t=fn(n=ct(n,Ft));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return ms("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new G(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const c of o.indexes){const u=vT(c,"collectionGroup"),h=[];if(Array.isArray(c.fields))for(const f of c.fields){const m=Fp("setIndexConfiguration",vT(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Aa(m,2)):f.order==="ASCENDING"?h.push(new Aa(m,0)):f.order==="DESCENDING"&&h.push(new Aa(m,1))}a.push(new wc(wc.UNKNOWN_ID,u,h,xc.empty()))}return a}(e);return RU(t,r)}function vT(n,e){if(typeof n[e]!="string")throw new G(F.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o${constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function cW(n){var s;n=ct(n,Ft);const e=_T.get(n);if(e)return e;if(((s=fn(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new o$(n);return _T.set(n,r),r}function uW(n){KD(n,!0)}function dW(n){KD(n,!1)}function hW(n){DU(fn(n._firestore)).then(e=>J("deleting all persistent cache indexes succeeded")).catch(e=>ms("deleting all persistent cache indexes failed",e))}function KD(n,e){kU(fn(n._firestore),e).then(t=>J(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>ms(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const _T=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fW(n){var r;const e=fn(ct(n.firestore,Ft)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:Np(t,yr(n._query)).ft}function mW(n,e){var i;const t=MR(e,(o,a)=>new yk(a,o.aggregateType,o._internalFieldPath)),r=fn(ct(n.firestore,Ft)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:Ck(s,tk(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gW{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Yx.instance.onExistenceFilterMismatch(e)}}class Yx{constructor(){this.Mc=new Map}static get instance(){return Df||(Df=new Yx,function(t){if(cd)throw new Error("a TestingHooksSpi instance is already set");cd=t}(Df)),Df}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let Df=null;(function(e,t=!0){(function(s){Gc=s})(rl),Ms(new Lr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Ft(new y3(r.getProvider("auth-internal")),new w3(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new G(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $a(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Pr(Kb,Yb,e),Pr(Kb,Yb,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pW={PHONE:"phone",TOTP:"totp"},yW={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},vW={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},_W={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},wW={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a$(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function YD(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const xW=a$,l$=YD,JD=new tl("auth","Firebase",YD()),SW={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ig=new gh("@firebase/auth");function c$(n,...e){Ig.logLevel<=lt.WARN&&Ig.warn(`Auth (${rl}): ${n}`,...e)}function mm(n,...e){Ig.logLevel<=lt.ERROR&&Ig.error(`Auth (${rl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(n,...e){throw Xx(n,...e)}function Sr(n,...e){return Xx(n,...e)}function Jx(n,e,t){const r={...l$(),[e]:t};return new tl("auth","Firebase",r).create(e,{appName:n.name})}function Gn(n){return Jx(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function nu(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Mr(n,"argument-error"),Jx(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Xx(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return JD.create(n,...e)}function ne(n,e,...t){if(!n)throw Xx(e,...t)}function Xs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw mm(e),new Error(e)}function Mi(n,e){n||Xs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sh(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Zx(){return wT()==="http:"||wT()==="https:"}function wT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u$(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Zx()||rw()||"connection"in navigator)?navigator.onLine:!0}function d$(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{constructor(e,t){this.shortDelay=e,this.longDelay=t,Mi(t>e,"Short delay should be less than long delay!"),this.isMobile=nw()||kN()}get(){return u$()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(n,e){Mi(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h$={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f$=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],m$=new $h(3e4,6e4);function Yt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Jt(n,e,t,r,s={}){return ZD(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=nl({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:c,...i};return IM()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Ui(n.emulatorConfig.host)&&(u.credentials="include"),XD.fetch()(await eP(n,n.config.apiHost,t,a),u)})}async function ZD(n,e,t){n._canInitEmulator=!1;const r={...h$,...e};try{const s=new p$(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw $u(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw $u(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw $u(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw $u(n,"user-disabled",o);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Jx(n,h,u);Mr(n,h)}}catch(s){if(s instanceof Os)throw s;Mr(n,"network-request-failed",{message:String(s)})}}async function Wi(n,e,t,r,s={}){const i=await Jt(n,e,t,r,s);return"mfaPendingCredential"in i&&Mr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function eP(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?eS(n.config,s):`${n.config.apiScheme}://${s}`;return f$.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function g$(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class p${clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Sr(this.auth,"network-request-failed")),m$.get())})}}function $u(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Sr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xT(n){return n!==void 0&&n.getResponse!==void 0}function ST(n){return n!==void 0&&n.enterprise!==void 0}class tP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return g$(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y$(n){return(await Jt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function nP(n,e){return Jt(n,"GET","/v2/recaptchaConfig",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v$(n,e){return Jt(n,"POST","/v1/accounts:delete",e)}async function _$(n,e){return Jt(n,"POST","/v1/accounts:update",e)}async function bg(n,e){return Jt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IW(n,e=!1){return he(n).getIdToken(e)}async function w$(n,e=!1){const t=he(n),r=await t.getIdToken(e),s=Wp(r);ne(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:dd(nv(s.auth_time)),issuedAtTime:dd(nv(s.iat)),expirationTime:dd(nv(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function nv(n){return Number(n)*1e3}function Wp(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return mm("JWT malformed, contained fewer than 3 sections"),null;try{const s=qm(t);return s?JSON.parse(s):(mm("Failed to decode base64 JWT payload"),null)}catch(s){return mm("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function IT(n){const e=Wp(n);return ne(e,"internal-error"),ne(typeof e.exp<"u","internal-error"),ne(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oi(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Os&&x$(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function x$({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S${constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=dd(this.lastLoginAt),this.creationTime=dd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ih(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Oi(n,bg(e,{idToken:t}));ne(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?rP(s.providerUserInfo):[],o=b$(n.providerData,i),a=n.isAnonymous,c=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?c:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new n_(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function I$(n){const e=he(n);await ih(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function b$(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function rP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E$(n,e){const t=await ZD(n,{},async()=>{const r=nl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await eP(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:r};return n.emulatorConfig&&Ui(n.emulatorConfig.host)&&(c.credentials="include"),XD.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function T$(n,e){return Jt(n,"POST","/v2/accounts:revokeToken",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ne(e.idToken,"internal-error"),ne(typeof e.idToken<"u","internal-error"),ne(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):IT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ne(e.length!==0,"internal-error");const t=IT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ne(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await E$(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ec;return r&&(ne(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ne(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ne(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ec,this.toJSON())}_performRefresh(){return Xs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function to(n,e){ne(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Cs{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new S$(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new n_(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Oi(this,this.stsTokenManager.getToken(this.auth,e));return ne(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return w$(this,e)}reload(){return I$(this)}_assign(e){this!==e&&(ne(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Cs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ih(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(rn(this.auth.app))return Promise.reject(Gn(this.auth));const e=await this.getIdToken();return await Oi(this,v$(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,c=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:y,providerData:w,stsTokenManager:S}=t;ne(f&&S,e,"internal-error");const k=ec.fromJSON(this.name,S);ne(typeof f=="string",e,"internal-error"),to(r,e.name),to(s,e.name),ne(typeof m=="boolean",e,"internal-error"),ne(typeof y=="boolean",e,"internal-error"),to(i,e.name),to(o,e.name),to(a,e.name),to(c,e.name),to(u,e.name),to(h,e.name);const I=new Cs({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:k,createdAt:u,lastLoginAt:h});return w&&Array.isArray(w)&&(I.providerData=w.map(x=>({...x}))),c&&(I._redirectEventId=c),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new ec;s.updateFromServerResponse(t);const i=new Cs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ih(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ne(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?rP(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ec;a.updateFromIdToken(r);const c=new Cs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new n_(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bT=new Map;function Ii(n){Mi(n instanceof Function,"Expected a class definition");let e=bT.get(n);return e?(Mi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,bT.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}sP.type="NONE";const ET=sP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gm(n,e,t){return`firebase:${n}:${e}:${t}`}class tc{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=gm(this.userKey,s.apiKey,i),this.fullPersistenceKey=gm("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await bg(this.auth,{idToken:e}).catch(()=>{});return t?Cs._fromGetAccountInfoResponse(this.auth,t,e):null}return Cs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new tc(Ii(ET),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Ii(ET);const o=gm(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const m=await bg(e,{idToken:h}).catch(()=>{});if(!m)break;f=await Cs._fromGetAccountInfoResponse(e,m,h)}else f=Cs._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new tc(i,e,r):(i=c[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new tc(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TT(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(lP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(iP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(uP(e))return"Blackberry";if(dP(e))return"Webos";if(oP(e))return"Safari";if((e.includes("chrome/")||aP(e))&&!e.includes("edge/"))return"Chrome";if(cP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function iP(n=Ln()){return/firefox\//i.test(n)}function oP(n=Ln()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function aP(n=Ln()){return/crios\//i.test(n)}function lP(n=Ln()){return/iemobile/i.test(n)}function cP(n=Ln()){return/android/i.test(n)}function uP(n=Ln()){return/blackberry/i.test(n)}function dP(n=Ln()){return/webos/i.test(n)}function tS(n=Ln()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function A$(n=Ln()){var e;return tS(n)&&!!((e=window.navigator)!=null&&e.standalone)}function N$(){return bM()&&document.documentMode===10}function hP(n=Ln()){return tS(n)||cP(n)||dP(n)||uP(n)||/windows phone/i.test(n)||lP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(n,e=[]){let t;switch(n){case"Browser":t=TT(Ln());break;case"Worker":t=`${TT(Ln())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${rl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C${constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const c=e(i);o(c)}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R$(n,e={}){return Jt(n,"GET","/v2/passwordPolicy",Yt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k$=6;class D${constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??k$,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P${constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new AT(this),this.idTokenSubscription=new AT(this),this.beforeStateQueue=new C$(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=JD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ii(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await tc.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await bg(this,{idToken:e}),r=await Cs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(rn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ne(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ih(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=d$()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(rn(this.app))return Promise.reject(Gn(this));const t=e?he(e):null;return t&&ne(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ne(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return rn(this.app)?Promise.reject(Gn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return rn(this.app)?Promise.reject(Gn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ii(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await R$(this),t=new D$(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new tl("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await T$(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ii(e)||this._popupRedirectResolver;ne(t,this,"argument-error"),this.redirectPersistenceManager=await tc.create(this,[Ii(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ne(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(rn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&c$(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function _n(n){return he(n)}class AT{constructor(e){this.auth=e,this.observer=null,this.addObserver=kM(t=>this.observer=t)}get next(){return ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function j$(n){Bh=n}function nS(n){return Bh.loadJS(n)}function L$(){return Bh.recaptchaV2Script}function M$(){return Bh.recaptchaEnterpriseScript}function O$(){return Bh.gapiScript}function mP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V$=500,F$=6e4,Pf=1e12;class U${constructor(e){this.auth=e,this.counter=Pf,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new z$(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||Pf;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||Pf;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||Pf;return(r=this._widgets.get(t))==null||r.execute(),""}}class $${constructor(){this.enterprise=new B$}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class B${ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class z${constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ne(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=q$(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},F$)},V$))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function q$(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const W$="recaptcha-enterprise",hd="NO_RECAPTCHA";class gP{constructor(e){this.type=W$,this.auth=_n(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{nP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new tP(c);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(c=>{a(c)})})}function s(i,o,a){const c=window.grecaptcha;ST(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(hd)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new $$().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&ST(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=M$();c.length!==0&&(c+=a),nS(c).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Nu(n,e,t,r=!1,s=!1){const i=new gP(n);let o;if(s)o=hd;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const c=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Do(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Nu(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await Nu(n,e,t,t==="getOobCode");return r(n,c)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Nu(n,e,t);return r(n,a).catch(async c=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Nu(n,e,t,!1,!0);return r(n,h)}return Promise.reject(c)})}else{const a=await Nu(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function pP(n){const e=_n(n),t=await nP(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new tP(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new gP(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G$(n,e){const t=hi(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Yr(i,e??{}))return s;Mr(s,"already-initialized")}return t.initialize({options:e})}function H$(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ii);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Q$(n,e,t){const r=_n(n);ne(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=yP(e),{host:o,port:a}=K$(e),c=a===null?"":`:${a}`,u={url:`${i}//${o}${c}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){ne(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ne(Yr(u,r.config.emulator)&&Yr(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ui(o)?(Yg(`${i}//${o}${c}`),tw("Auth",!0)):s||Y$()}function yP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function K$(n){const e=yP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:NT(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:NT(o)}}}function NT(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Y$(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xs("not implemented")}_getIdTokenResponse(e){return Xs("not implemented")}_linkToIdToken(e,t){return Xs("not implemented")}_getReauthenticationResolver(e){return Xs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vP(n,e){return Jt(n,"POST","/v1/accounts:resetPassword",Yt(n,e))}async function J$(n,e){return Jt(n,"POST","/v1/accounts:update",e)}async function X$(n,e){return Jt(n,"POST","/v1/accounts:signUp",e)}async function Z$(n,e){return Jt(n,"POST","/v1/accounts:update",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eB(n,e){return Wi(n,"POST","/v1/accounts:signInWithPassword",Yt(n,e))}async function Gp(n,e){return Jt(n,"POST","/v1/accounts:sendOobCode",Yt(n,e))}async function tB(n,e){return Gp(n,e)}async function nB(n,e){return Gp(n,e)}async function rB(n,e){return Gp(n,e)}async function sB(n,e){return Gp(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iB(n,e){return Wi(n,"POST","/v1/accounts:signInWithEmailLink",Yt(n,e))}async function oB(n,e){return Wi(n,"POST","/v1/accounts:signInWithEmailLink",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh extends zh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new oh(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new oh(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Do(e,t,"signInWithPassword",eB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return iB(e,{email:this._email,oobCode:this._password});default:Mr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Do(e,r,"signUpPassword",X$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return oB(e,{idToken:t,email:this._email,oobCode:this._password});default:Mr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ai(n,e){return Wi(n,"POST","/v1/accounts:signInWithIdp",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aB="http://localhost";class Vi extends zh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Vi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Mr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Vi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ai(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ai(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ai(e,t)}buildRequest(){const e={requestUri:aB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=nl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CT(n,e){return Jt(n,"POST","/v1/accounts:sendVerificationCode",Yt(n,e))}async function lB(n,e){return Wi(n,"POST","/v1/accounts:signInWithPhoneNumber",Yt(n,e))}async function cB(n,e){const t=await Wi(n,"POST","/v1/accounts:signInWithPhoneNumber",Yt(n,e));if(t.temporaryProof)throw $u(n,"account-exists-with-different-credential",t);return t}const uB={USER_NOT_FOUND:"user-not-found"};async function dB(n,e){const t={...e,operation:"REAUTH"};return Wi(n,"POST","/v1/accounts:signInWithPhoneNumber",Yt(n,t),uB)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra extends zh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ra({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ra({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return lB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return cB(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return dB(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Ra({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hB(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function fB(n){const e=ju(Lu(n)).link,t=e?ju(Lu(e)).deep_link_id:null,r=ju(Lu(n)).deep_link_id;return(r?ju(Lu(r)).link:null)||r||t||e||n}class qh{constructor(e){const t=ju(Lu(e)),r=t.apiKey??null,s=t.oobCode??null,i=hB(t.mode??null);ne(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=fB(e);try{return new qh(t)}catch{return null}}}function bW(n){return qh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(){this.providerId=fl.PROVIDER_ID}static credential(e,t){return oh._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=qh.parseLink(t);return ne(r,"argument-error"),oh._fromEmailAndCode(e,r.code,r.tenantId)}}fl.PROVIDER_ID="password";fl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";fl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru extends Gi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class pm extends ru{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ne("providerId"in t&&"signInMethod"in t,"argument-error"),Vi._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return ne(e.idToken||e.accessToken,"argument-error"),Vi._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return pm.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return pm.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new pm(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo extends ru{constructor(){super("facebook.com")}static credential(e){return Vi._fromParams({providerId:lo.PROVIDER_ID,signInMethod:lo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lo.credentialFromTaggedObject(e)}static credentialFromError(e){return lo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lo.credential(e.oauthAccessToken)}catch{return null}}}lo.FACEBOOK_SIGN_IN_METHOD="facebook.com";lo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi extends ru{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Vi._fromParams({providerId:vi.PROVIDER_ID,signInMethod:vi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return vi.credentialFromTaggedObject(e)}static credentialFromError(e){return vi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return vi.credential(t,r)}catch{return null}}}vi.GOOGLE_SIGN_IN_METHOD="google.com";vi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co extends ru{constructor(){super("github.com")}static credential(e){return Vi._fromParams({providerId:co.PROVIDER_ID,signInMethod:co.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return co.credentialFromTaggedObject(e)}static credentialFromError(e){return co.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return co.credential(e.oauthAccessToken)}catch{return null}}}co.GITHUB_SIGN_IN_METHOD="github.com";co.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mB="http://localhost";class ah extends zh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ai(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ai(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ai(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new ah(r,i)}static _create(e,t){return new ah(e,t)}buildRequest(){return{requestUri:mB,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gB="saml.";class r_ extends Gi{constructor(e){ne(e.startsWith(gB),"argument-error"),super(e)}static credentialFromResult(e){return r_.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return r_.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=ah.fromJSON(e);return ne(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return ah._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo extends ru{constructor(){super("twitter.com")}static credential(e,t){return Vi._fromParams({providerId:uo.PROVIDER_ID,signInMethod:uo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return uo.credentialFromTaggedObject(e)}static credentialFromError(e){return uo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return uo.credential(t,r)}catch{return null}}}uo.TWITTER_SIGN_IN_METHOD="twitter.com";uo.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _P(n,e){return Wi(n,"POST","/v1/accounts:signUp",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Cs._fromIdTokenResponse(e,r,s),o=RT(r);return new gs({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=RT(r);return new gs({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function RT(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EW(n){var s;if(rn(n.app))return Promise.reject(Gn(n));const e=_n(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new gs({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await _P(e,{returnSecureToken:!0}),r=await gs._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends Os{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Eg.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Eg(e,t,r,s)}}function wP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Eg._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xP(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TW(n,e){const t=he(n);await Hp(!0,t,e);const{providerUserInfo:r}=await _$(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=xP(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function rS(n,e,t=!1){const r=await Oi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return gs._forOperation(n,"link",r)}async function Hp(n,e,t){await ih(e);const r=xP(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ne(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SP(n,e,t=!1){const{auth:r}=n;if(rn(r.app))return Promise.reject(Gn(r));const s="reauthenticate";try{const i=await Oi(n,wP(r,s,e,n),t);ne(i.idToken,r,"internal-error");const o=Wp(i.idToken);ne(o,r,"internal-error");const{sub:a}=o;return ne(n.uid===a,r,"user-mismatch"),gs._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Mr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IP(n,e,t=!1){if(rn(n.app))return Promise.reject(Gn(n));const r="signIn",s=await wP(n,r,e),i=await gs._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function sS(n,e){return IP(_n(n),e)}async function pB(n,e){const t=he(n);return await Hp(!1,t,e.providerId),rS(t,e)}async function yB(n,e){return SP(he(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vB(n,e){return Wi(n,"POST","/v1/accounts:signInWithCustomToken",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AW(n,e){if(rn(n.app))return Promise.reject(Gn(n));const t=_n(n),r=await vB(t,{token:e,returnSecureToken:!0}),s=await gs._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?iS._fromServerResponse(e,t):"totpInfo"in t?oS._fromServerResponse(e,t):Mr(e,"internal-error")}}class iS extends Wh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new iS(t)}}class oS extends Wh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new oS(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qp(n,e,t){var r;ne(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),ne(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),ne(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ne(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ne(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aS(n){const e=_n(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function _B(n,e,t){const r=_n(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Qp(r,s,t),await Do(r,s,"getOobCode",nB,"EMAIL_PASSWORD_PROVIDER")}async function NW(n,e,t){await vP(he(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&aS(n),r})}async function CW(n,e){await Z$(he(n),{oobCode:e})}async function wB(n,e){const t=he(n),r=await vP(t,{oobCode:e}),s=r.requestType;switch(ne(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ne(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ne(r.mfaInfo,t,"internal-error");default:ne(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Wh._fromServerResponse(_n(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function RW(n,e){const{data:t}=await wB(he(n),e);return t.email}async function bP(n,e,t){if(rn(n.app))return Promise.reject(Gn(n));const r=_n(n),o=await Do(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_P,"EMAIL_PASSWORD_PROVIDER").catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&aS(n),c}),a=await gs._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function EP(n,e,t){return rn(n.app)?Promise.reject(Gn(n)):sS(he(n),fl.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&aS(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kW(n,e,t){const r=_n(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){ne(a.handleCodeInApp,r,"argument-error"),a&&Qp(r,o,a)}i(s,t),await Do(r,s,"getOobCode",rB,"EMAIL_PASSWORD_PROVIDER")}function DW(n,e){const t=qh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function PW(n,e,t){if(rn(n.app))return Promise.reject(Gn(n));const r=he(n),s=fl.credentialWithLink(e,t||sh());return ne(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),sS(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xB(n,e){return Jt(n,"POST","/v1/accounts:createAuthUri",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jW(n,e){const t=Zx()?sh():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await xB(he(n),r);return s||[]}async function SB(n,e){const t=he(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Qp(t.auth,s,e);const{email:i}=await tB(t.auth,s);i!==n.email&&await n.reload()}async function LW(n,e,t){const r=he(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Qp(r.auth,i,t);const{email:o}=await sB(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IB(n,e){return Jt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MW(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=he(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Oi(r,IB(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function OW(n,e){const t=he(n);return rn(t.auth.app)?Promise.reject(Gn(t.auth)):TP(t,e,null)}function VW(n,e){return TP(he(n),null,e)}async function TP(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Oi(n,J$(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bB(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Wp(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new nc(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new EB(r,t);case"github.com":return new TB(r,t);case"google.com":return new AB(r,t);case"twitter.com":return new NB(r,t,n.screenName||null);case"custom":case"anonymous":return new nc(r,null);default:return new nc(r,e,t)}}class nc{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class AP extends nc{constructor(e,t,r,s){super(e,t,r),this.username=s}}class EB extends nc{constructor(e,t){super(e,"facebook.com",t)}}class TB extends AP{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class AB extends nc{constructor(e,t){super(e,"google.com",t)}}class NB extends AP{constructor(e,t,r){super(e,"twitter.com",t,r)}}function FW(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:bB(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NP(n,e){return he(n).setPersistence(e)}function UW(n){return pP(n)}async function $W(n,e){return _n(n).validatePassword(e)}function CB(n,e,t,r){return he(n).onIdTokenChanged(e,t,r)}function RB(n,e,t){return he(n).beforeAuthStateChanged(e,t)}function kB(n,e,t,r){return he(n).onAuthStateChanged(e,t,r)}function BW(n){he(n).useDeviceLanguage()}function zW(n,e){return he(n).updateCurrentUser(e)}function DB(n){return he(n).signOut()}function qW(n,e){return _n(n).revokeAccessToken(e)}async function WW(n){return he(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Sa("enroll",e,t)}static _fromMfaPendingCredential(e){return new Sa("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return Sa._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return Sa._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=_n(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Wh._fromServerResponse(r,a));ne(s.mfaPendingCredential,r,"internal-error");const o=Sa._fromMfaPendingCredential(s.mfaPendingCredential);return new lS(o,i,async a=>{const c=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:c.idToken,refreshToken:c.refreshToken};switch(t.operationType){case"signIn":const h=await gs._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return ne(t.user,r,"internal-error"),gs._forOperation(t.user,t.operationType,u);default:Mr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function GW(n,e){var s;const t=he(n),r=e;return ne(e.customData.operationType,t,"argument-error"),ne((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),lS._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kT(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:start",Yt(n,e))}function PB(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Yt(n,e))}function jB(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:start",Yt(n,e))}function LB(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Yt(n,e))}function MB(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Yt(n,e))}class cS{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Wh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new cS(e)}async getSession(){return Sa._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Oi(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Oi(this.user,MB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const rv=new WeakMap;function HW(n){const e=he(n);return rv.has(e)||rv.set(e,cS._fromUser(e)),rv.get(e)}const Tg="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Tg,"1"),this.storage.removeItem(Tg),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OB=1e3,VB=10;class RP extends CP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=hP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);N$()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,VB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},OB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}RP.type="LOCAL";const fd=RP;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FB=1e3;function sv(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function iv(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class kP{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=iv(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return sv(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=iv(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=iv(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(m=>m.name===r);h&&t(h.value),u.deleted.find(m=>m.name===r)&&t(null)},c=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,c),window.cookieStore.addEventListener("change",a)}let s=sv(r);const i=setInterval(()=>{const a=sv(r);a!==s&&(t(a),s=a)},FB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}kP.type="COOKIE";const QW=kP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP extends CP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}DP.type="SESSION";const md=DP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Kp(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),c=await UB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Kp.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yp(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $B{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,c)=>{const u=Yp("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(){return window}function BB(n){Tn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uS(){return typeof Tn().WorkerGlobalScope<"u"&&typeof Tn().importScripts=="function"}async function zB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function qB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function WB(){return uS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP="firebaseLocalStorageDb",GB=1,Ag="firebaseLocalStorage",jP="fbase_key";class Gh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Jp(n,e){return n.transaction([Ag],e?"readwrite":"readonly").objectStore(Ag)}function HB(){const n=indexedDB.deleteDatabase(PP);return new Gh(n).toPromise()}function s_(){const n=indexedDB.open(PP,GB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Ag,{keyPath:jP})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Ag)?e(r):(r.close(),await HB(),e(await s_()))})})}async function DT(n,e,t){const r=Jp(n,!0).put({[jP]:e,value:t});return new Gh(r).toPromise()}async function QB(n,e){const t=Jp(n,!1).get(e),r=await new Gh(t).toPromise();return r===void 0?null:r.value}function PT(n,e){const t=Jp(n,!0).delete(e);return new Gh(t).toPromise()}const KB=800,YB=3;class LP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await s_(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>YB)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return uS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Kp._getInstance(WB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await zB(),!this.activeServiceWorker)return;this.sender=new $B(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||qB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await s_();return await DT(e,Tg,"1"),await PT(e,Tg),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>DT(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>QB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>PT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Jp(s,!1).getAll();return new Gh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),KB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}LP.type="LOCAL";const JB=LP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jT(n,e){return Jt(n,"POST","/v2/accounts/mfaSignIn:start",Yt(n,e))}function XB(n,e){return Jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Yt(n,e))}function ZB(n,e){return Jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ov=mP("rcb"),ez=new $h(3e4,6e4);class tz{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=Tn().grecaptcha)!=null&&e.render)}load(e,t=""){return ne(nz(t),e,"argument-error"),this.shouldResolveImmediately(t)&&xT(Tn().grecaptcha)?Promise.resolve(Tn().grecaptcha):new Promise((r,s)=>{const i=Tn().setTimeout(()=>{s(Sr(e,"network-request-failed"))},ez.get());Tn()[ov]=()=>{Tn().clearTimeout(i),delete Tn()[ov];const a=Tn().grecaptcha;if(!a||!xT(a)){s(Sr(e,"internal-error"));return}const c=a.render;a.render=(u,h)=>{const f=c(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${L$()}?${nl({onload:ov,render:"explicit",hl:t})}`;nS(o).catch(()=>{clearTimeout(i),s(Sr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=Tn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function nz(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class rz{async load(e){return new U$(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gd="recaptcha",sz={theme:"light",type:"image"};class KW{constructor(e,t,r={...sz}){this.parameters=r,this.type=gd,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=_n(e),this.isInvisible=this.parameters.size==="invisible",ne(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ne(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new rz:new tz,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ne(!this.parameters.sitekey,this.auth,"argument-error"),ne(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ne(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Tn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ne(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ne(Zx()&&!uS(),this.auth,"internal-error"),await iz(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await y$(this.auth);ne(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ne(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function iz(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dS{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ra._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function YW(n,e,t){if(rn(n.app))return Promise.reject(Gn(n));const r=_n(n),s=await Xp(r,e,he(t));return new dS(s,i=>sS(r,i))}async function JW(n,e,t){const r=he(n);await Hp(!1,r,"phone");const s=await Xp(r.auth,e,he(t));return new dS(s,i=>pB(r,i))}async function XW(n,e,t){const r=he(n);if(rn(r.auth.app))return Promise.reject(Gn(r.auth));const s=await Xp(r.auth,e,he(t));return new dS(s,i=>yB(r,i))}async function Xp(n,e,t){var r;if(!n._getRecaptchaConfig())try{await pP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){ne(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Do(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===hd){ne((t==null?void 0:t.type)===gd,h,"argument-error");const m=await av(h,f,t);return kT(h,m)}return kT(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{ne(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;ne(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Do(n,a,"mfaSmsSignIn",async(f,m)=>{if(m.phoneSignInInfo.captchaResponse===hd){ne((t==null?void 0:t.type)===gd,f,"argument-error");const y=await av(f,m,t);return jT(f,y)}return jT(f,m)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Do(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===hd){ne((t==null?void 0:t.type)===gd,u,"argument-error");const f=await av(u,h,t);return CT(u,f)}return CT(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function ZW(n,e){const t=he(n);if(rn(t.auth.app))return Promise.reject(Gn(t.auth));await rS(t,e)}async function av(n,e,t){ne(t.type===gd,n,"argument-error");const r=await t.verify();ne(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,c=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:c}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e){this.providerId=rc.PROVIDER_ID,this.auth=_n(e)}verifyPhoneNumber(e,t){return Xp(this.auth,e,he(t))}static credential(e,t){return Ra._fromVerification(e,t)}static credentialFromResult(e){const t=e;return rc.credentialFromTaggedObject(t)}static credentialFromError(e){return rc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Ra._fromTokenResponse(t,r):null}}rc.PROVIDER_ID="phone";rc.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ml(n,e){return e?Ii(e):(ne(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hS extends zh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ai(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ai(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ai(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function oz(n){return IP(n.auth,new hS(n),n.bypassAuthState)}function az(n){const{auth:e,user:t}=n;return ne(t,e,"internal-error"),SP(t,new hS(n),n.bypassAuthState)}async function lz(n){const{auth:e,user:t}=n;return ne(t,e,"internal-error"),rS(t,new hS(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return oz;case"linkViaPopup":case"linkViaRedirect":return lz;case"reauthViaPopup":case"reauthViaRedirect":return az;default:Mr(this.auth,"internal-error")}}resolve(e){Mi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Mi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cz=new $h(2e3,1e4);async function uz(n,e,t){if(rn(n.app))return Promise.reject(Sr(n,"operation-not-supported-in-this-environment"));const r=_n(n);nu(n,e,Gi);const s=ml(r,t);return new bi(r,"signInViaPopup",e,s).executeNotNull()}async function eG(n,e,t){const r=he(n);if(rn(r.auth.app))return Promise.reject(Sr(r.auth,"operation-not-supported-in-this-environment"));nu(r.auth,e,Gi);const s=ml(r.auth,t);return new bi(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function tG(n,e,t){const r=he(n);nu(r.auth,e,Gi);const s=ml(r.auth,t);return new bi(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class bi extends MP{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,bi.currentPopupAction&&bi.currentPopupAction.cancel(),bi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ne(e,this.auth,"internal-error"),e}async onExecution(){Mi(this.filter.length===1,"Popup operations only handle one event");const e=Yp();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Sr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Sr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,bi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Sr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,cz.get())};e()}}bi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz="pendingRedirect",ym=new Map;class hz extends MP{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=ym.get(this.auth._key());if(!e){try{const r=await fz(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}ym.set(this.auth._key(),e)}return this.bypassAuthState||ym.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function fz(n,e){const t=VP(e),r=OP(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function fS(n,e){return OP(n)._set(VP(e),"true")}function mz(n,e){ym.set(n._key(),e)}function OP(n){return Ii(n._redirectPersistence)}function VP(n){return gm(dz,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nG(n,e,t){return gz(n,e,t)}async function gz(n,e,t){if(rn(n.app))return Promise.reject(Gn(n));const r=_n(n);nu(n,e,Gi),await r._initializationPromise;const s=ml(r,t);return await fS(s,r),s._openRedirect(r,e,"signInViaRedirect")}function rG(n,e,t){return pz(n,e,t)}async function pz(n,e,t){const r=he(n);if(nu(r.auth,e,Gi),rn(r.auth.app))return Promise.reject(Gn(r.auth));await r.auth._initializationPromise;const s=ml(r.auth,t);await fS(s,r.auth);const i=await UP(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function sG(n,e,t){return yz(n,e,t)}async function yz(n,e,t){const r=he(n);nu(r.auth,e,Gi),await r.auth._initializationPromise;const s=ml(r.auth,t);await Hp(!1,r,e.providerId),await fS(s,r.auth);const i=await UP(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function iG(n,e){return await _n(n)._initializationPromise,FP(n,e,!1)}async function FP(n,e,t=!1){if(rn(n.app))return Promise.reject(Gn(n));const r=_n(n),s=ml(r,e),o=await new hz(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function UP(n){const e=Yp(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vz=10*60*1e3;class _z{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!wz(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!$P(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(Sr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=vz&&this.cachedEventUids.clear(),this.cachedEventUids.has(LT(e))}saveEventToCache(e){this.cachedEventUids.add(LT(e)),this.lastProcessedEventTime=Date.now()}}function LT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $P({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function wz(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $P(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xz(n,e={}){return Jt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sz=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Iz=/^https?/;async function bz(n){if(n.config.emulator)return;const{authorizedDomains:e}=await xz(n);for(const t of e)try{if(Ez(t))return}catch{}Mr(n,"unauthorized-domain")}function Ez(n){const e=sh(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!Iz.test(t))return!1;if(Sz.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tz=new $h(3e4,6e4);function MT(){const n=Tn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Az(n){return new Promise((e,t)=>{var s,i,o;function r(){MT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{MT(),t(Sr(n,"network-request-failed"))},timeout:Tz.get()})}if((i=(s=Tn().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Tn().gapi)!=null&&o.load)r();else{const a=mP("iframefcb");return Tn()[a]=()=>{gapi.load?r():t(Sr(n,"network-request-failed"))},nS(`${O$()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw vm=null,e})}let vm=null;function Nz(n){return vm=vm||Az(n),vm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cz=new $h(5e3,15e3),Rz="__/auth/iframe",kz="emulator/auth/iframe",Dz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Pz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function jz(n){const e=n.config;ne(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?eS(e,kz):`https://${n.config.authDomain}/${Rz}`,r={apiKey:e.apiKey,appName:n.name,v:rl},s=Pz.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${nl(r).slice(1)}`}async function Lz(n){const e=await Nz(n),t=Tn().gapi;return ne(t,n,"internal-error"),e.open({where:document.body,url:jz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Dz,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Sr(n,"network-request-failed"),a=Tn().setTimeout(()=>{i(o)},Cz.get());function c(){Tn().clearTimeout(a),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Oz=500,Vz=600,Fz="_blank",Uz="http://localhost";class OT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function $z(n,e,t,r=Oz,s=Vz){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c={...Mz,width:r.toString(),height:s.toString(),top:i,left:o},u=Ln().toLowerCase();t&&(a=aP(u)?Fz:t),iP(u)&&(e=e||Uz,c.scrollbars="yes");const h=Object.entries(c).reduce((m,[y,w])=>`${m}${y}=${w},`,"");if(A$(u)&&a!=="_self")return Bz(e||"",a),new OT(null);const f=window.open(e||"",a,h);ne(f,n,"popup-blocked");try{f.focus()}catch{}return new OT(f)}function Bz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zz="__/auth/handler",qz="emulator/auth/handler",Wz=encodeURIComponent("fac");async function VT(n,e,t,r,s,i){ne(n.config.authDomain,n,"auth-domain-config-required"),ne(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:rl,eventId:s};if(e instanceof Gi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Wm(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof ru){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const c=await n._getAppCheckToken(),u=c?`#${Wz}=${encodeURIComponent(c)}`:"";return`${Gz(n)}?${nl(a).slice(1)}${u}`}function Gz({config:n}){return n.emulator?eS(n,qz):`https://${n.authDomain}/${zz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lv="webStorageSupport";class Hz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=md,this._completeRedirectFn=FP,this._overrideRedirectResult=mz}async _openPopup(e,t,r,s){var o;Mi((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await VT(e,t,r,sh(),s);return $z(e,i,Yp())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await VT(e,t,r,sh(),s);return BB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Mi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Lz(e),r=new _z(e);return t.register("authEvent",s=>(ne(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(lv,{type:lv},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[lv];i!==void 0&&t(!!i),Mr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=bz(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return hP()||oP()||tS()}}const Qz=Hz;class BP{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Xs("unexpected MultiFactorSessionType")}}}class mS extends BP{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new mS(e)}_finalizeEnroll(e,t,r){return PB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return XB(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Kz{constructor(){}static assertion(e){return mS._fromCredential(e)}}Kz.FACTOR_ID="phone";class Yz{static assertionForEnrollment(e,t){return lh._fromSecret(e,t)}static assertionForSignIn(e,t){return lh._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;ne(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await jB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return gS._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}Yz.FACTOR_ID="totp";class lh extends BP{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new lh(t,void 0,e)}static _fromEnrollmentId(e,t){return new lh(t,e)}async _finalizeEnroll(e,t,r){return ne(typeof this.secret<"u",e,"argument-error"),LB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){ne(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return ZB(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class gS{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new gS(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(jf(e)||jf(t))&&(r=!0),r&&(jf(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),jf(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function jf(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var FT="@firebase/auth",UT="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Zz(n){Ms(new Lr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ne(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fP(n)},u=new P$(r,s,i,c);return H$(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ms(new Lr("auth-internal",e=>{const t=_n(e.getProvider("auth").getImmediate());return(r=>new Jz(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Pr(FT,UT,Xz(n)),Pr(FT,UT,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e9=5*60,t9=NN("authIdTokenMaxAge")||e9;let $T=null;const n9=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>t9)return;const s=t==null?void 0:t.token;$T!==s&&($T=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function r9(n=ph()){const e=hi(n,"auth");if(e.isInitialized())return e.getImmediate();const t=G$(n,{popupRedirectResolver:Qz,persistence:[JB,fd,md]}),r=NN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=n9(i.toString());RB(t,o,()=>o(t.currentUser)),CB(t,a=>o(a))}}const s=EN("auth");return s&&Q$(t,`http://${s}`),t}function s9(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}j$({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Sr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",s9().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Zz("Browser");const zP="@firebase/installations",pS="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qP=1e4,WP=`w:${pS}`,GP="FIS_v2",i9="https://firebaseinstallations.googleapis.com/v1",o9=60*60*1e3,a9="installations",l9="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c9={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ja=new tl(a9,l9,c9);function HP(n){return n instanceof Os&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QP({projectId:n}){return`${i9}/projects/${n}/installations`}function KP(n){return{token:n.token,requestStatus:2,expiresIn:d9(n.expiresIn),creationTime:Date.now()}}async function YP(n,e){const r=(await e.json()).error;return Ja.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function JP({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function u9(n,{refreshToken:e}){const t=JP(n);return t.append("Authorization",h9(e)),t}async function XP(n){const e=await n();return e.status>=500&&e.status<600?n():e}function d9(n){return Number(n.replace("s","000"))}function h9(n){return`${GP} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f9({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=QP(n),s=JP(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:GP,appId:n.appId,sdkVersion:WP},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await XP(()=>fetch(r,a));if(c.ok){const u=await c.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:KP(u.authToken)}}else throw await YP("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZP(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m9(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g9=/^[cdef][\w-]{21}$/,i_="";function p9(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=y9(n);return g9.test(t)?t:i_}catch{return i_}}function y9(n){return m9(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zp(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e2=new Map;function t2(n,e){const t=Zp(n);n2(t,e),v9(t,e)}function n2(n,e){const t=e2.get(n);if(t)for(const r of t)r(e)}function v9(n,e){const t=_9();t&&t.postMessage({key:n,fid:e}),w9()}let Ia=null;function _9(){return!Ia&&"BroadcastChannel"in self&&(Ia=new BroadcastChannel("[Firebase] FID Change"),Ia.onmessage=n=>{n2(n.data.key,n.data.fid)}),Ia}function w9(){e2.size===0&&Ia&&(Ia.close(),Ia=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x9="firebase-installations-database",S9=1,Xa="firebase-installations-store";let cv=null;function yS(){return cv||(cv=ow(x9,S9,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Xa)}}})),cv}async function Ng(n,e){const t=Zp(n),s=(await yS()).transaction(Xa,"readwrite"),i=s.objectStore(Xa),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&t2(n,e.fid),e}async function r2(n){const e=Zp(n),r=(await yS()).transaction(Xa,"readwrite");await r.objectStore(Xa).delete(e),await r.done}async function ey(n,e){const t=Zp(n),s=(await yS()).transaction(Xa,"readwrite"),i=s.objectStore(Xa),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&t2(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vS(n){let e;const t=await ey(n.appConfig,r=>{const s=I9(r),i=b9(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===i_?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function I9(n){const e=n||{fid:p9(),registrationStatus:0};return s2(e)}function b9(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Ja.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=E9(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:T9(n)}:{installationEntry:e}}async function E9(n,e){try{const t=await f9(n,e);return Ng(n.appConfig,t)}catch(t){throw HP(t)&&t.customData.serverCode===409?await r2(n.appConfig):await Ng(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function T9(n){let e=await BT(n.appConfig);for(;e.registrationStatus===1;)await ZP(100),e=await BT(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await vS(n);return r||t}return e}function BT(n){return ey(n,e=>{if(!e)throw Ja.create("installation-not-found");return s2(e)})}function s2(n){return A9(n)?{fid:n.fid,registrationStatus:0}:n}function A9(n){return n.registrationStatus===1&&n.registrationTime+qP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N9({appConfig:n,heartbeatServiceProvider:e},t){const r=C9(n,t),s=u9(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:WP,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await XP(()=>fetch(r,a));if(c.ok){const u=await c.json();return KP(u)}else throw await YP("Generate Auth Token",c)}function C9(n,{fid:e}){return`${QP(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _S(n,e=!1){let t;const r=await ey(n.appConfig,i=>{if(!i2(i))throw Ja.create("not-registered");const o=i.authToken;if(!e&&D9(o))return i;if(o.requestStatus===1)return t=R9(n,e),i;{if(!navigator.onLine)throw Ja.create("app-offline");const a=j9(i);return t=k9(n,a),a}});return t?await t:r.authToken}async function R9(n,e){let t=await zT(n.appConfig);for(;t.authToken.requestStatus===1;)await ZP(100),t=await zT(n.appConfig);const r=t.authToken;return r.requestStatus===0?_S(n,e):r}function zT(n){return ey(n,e=>{if(!i2(e))throw Ja.create("not-registered");const t=e.authToken;return L9(t)?{...e,authToken:{requestStatus:0}}:e})}async function k9(n,e){try{const t=await N9(n,e),r={...e,authToken:t};return await Ng(n.appConfig,r),t}catch(t){if(HP(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await r2(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Ng(n.appConfig,r)}throw t}}function i2(n){return n!==void 0&&n.registrationStatus===2}function D9(n){return n.requestStatus===2&&!P9(n)}function P9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+o9}function j9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function L9(n){return n.requestStatus===1&&n.requestTime+qP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M9(n){const e=n,{installationEntry:t,registrationPromise:r}=await vS(e);return r?r.catch(console.error):_S(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O9(n,e=!1){const t=n;return await V9(t),(await _S(t,e)).token}async function V9(n){const{registrationPromise:e}=await vS(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F9(n){if(!n||!n.options)throw uv("App Configuration");if(!n.name)throw uv("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw uv(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function uv(n){return Ja.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2="installations",U9="installations-internal",$9=n=>{const e=n.getProvider("app").getImmediate(),t=F9(e),r=hi(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},B9=n=>{const e=n.getProvider("app").getImmediate(),t=hi(e,o2).getImmediate();return{getId:()=>M9(t),getToken:s=>O9(t,s)}};function z9(){Ms(new Lr(o2,$9,"PUBLIC")),Ms(new Lr(U9,B9,"PRIVATE"))}z9();Pr(zP,pS);Pr(zP,pS,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cg="analytics",q9="firebase_id",W9="origin",G9=60*1e3,H9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",wS="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jr=new gh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Qr=new tl("analytics","Analytics",Q9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K9(n){if(!n.startsWith(wS)){const e=Qr.create("invalid-gtag-resource",{gtagURL:n});return jr.warn(e.message),""}return n}function a2(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function Y9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function J9(n,e){const t=Y9("firebase-js-sdk-policy",{createScriptURL:K9}),r=document.createElement("script"),s=`${wS}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function X9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function Z9(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const c=(await a2(t)).find(u=>u.measurementId===s);c&&await e[c.appId]}}catch(a){jr.error(a)}n("config",s,i)}async function eq(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await a2(t);for(const c of o){const u=a.find(f=>f.measurementId===c),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){jr.error(i)}}function tq(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,c]=o;await eq(n,e,t,a,c)}else if(i==="config"){const[a,c]=o;await Z9(n,e,t,r,a,c)}else if(i==="consent"){const[a,c]=o;n("consent",a,c)}else if(i==="get"){const[a,c,u]=o;n("get",a,c,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){jr.error(a)}}return s}function nq(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=tq(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function rq(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(wS)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sq=30,iq=1e3;class oq{constructor(e={},t=iq){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const l2=new oq;function aq(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function lq(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:aq(t)},s=H9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const c=await i.json();(o=c.error)!=null&&o.message&&(a=c.error.message)}catch{}throw Qr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function cq(n,e=l2,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw Qr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Qr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new hq;return setTimeout(async()=>{a.abort()},t!==void 0?t:G9),c2({appId:r,apiKey:s,measurementId:i},o,a,e)}async function c2(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=l2){var a;const{appId:i,measurementId:o}=n;try{await uq(r,e)}catch(c){if(o)return jr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw c}try{const c=await lq(n);return s.deleteThrottleMetadata(i),c}catch(c){const u=c;if(!dq(u)){if(s.deleteThrottleMetadata(i),o)return jr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw c}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?ob(t,s.intervalMillis,sq):ob(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),jr.debug(`Calling attemptFetch again in ${h} millis`),c2(n,f,r,s)}}function uq(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(Qr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function dq(n){if(!(n instanceof Os)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class hq{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function fq(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mq(){if(Jg())try{await sw()}catch(n){return jr.warn(Qr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return jr.warn(Qr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function gq(n,e,t,r,s,i,o){const a=cq(n);a.then(m=>{t[m.measurementId]=m.appId,n.options.measurementId&&m.measurementId!==n.options.measurementId&&jr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>jr.error(m)),e.push(a);const c=mq().then(m=>{if(m)return r.getId()}),[u,h]=await Promise.all([a,c]);rq(i)||J9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[W9]="firebase",f.update=!0,h!=null&&(f[q9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pq{constructor(e){this.app=e}_delete(){return delete pd[this.app.options.appId],Promise.resolve()}}let pd={},qT=[];const WT={};let dv="dataLayer",yq="gtag",GT,u2,HT=!1;function vq(){const n=[];if(rw()&&n.push("This is a browser extension environment."),LN()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=Qr.create("invalid-analytics-context",{errorInfo:e});jr.warn(t.message)}}function _q(n,e,t){vq();const r=n.options.appId;if(!r)throw Qr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)jr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Qr.create("no-api-key");if(pd[r]!=null)throw Qr.create("already-exists",{id:r});if(!HT){X9(dv);const{wrappedGtag:i,gtagCore:o}=nq(pd,qT,WT,dv,yq);u2=i,GT=o,HT=!0}return pd[r]=gq(n,qT,WT,e,GT,dv,t),new pq(n)}function wq(n=ph()){n=he(n);const e=hi(n,Cg);return e.isInitialized()?e.getImmediate():xq(n)}function xq(n,e={}){const t=hi(n,Cg);if(t.isInitialized()){const s=t.getImmediate();if(Yr(e,t.getOptions()))return s;throw Qr.create("already-initialized")}return t.initialize({options:e})}async function Sq(){if(rw()||!LN()||!Jg())return!1;try{return await sw()}catch{return!1}}function Iq(n,e,t,r){n=he(n),fq(u2,pd[n.app.options.appId],e,t,r).catch(s=>jr.error(s))}const QT="@firebase/analytics",KT="0.10.18";function bq(){Ms(new Lr(Cg,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return _q(r,s,t)},"PUBLIC")),Ms(new Lr("analytics-internal",n,"PRIVATE")),Pr(QT,KT),Pr(QT,KT,"esm2020");function n(e){try{const t=e.getProvider(Cg).getImmediate();return{logEvent:(r,s,i)=>Iq(t,r,s,i)}}catch(t){throw Qr.create("interop-component-reg-failed",{reason:t})}}}bq();const d2={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},Hh=MO().length?ph():UN(d2),q=u3(Hh,d2.databaseURL),tr=LU(Hh),Ei=r9(Hh);console.log("✅ Firebase services initialized:",{db:!!q,firestore:!!tr,auth:!!Ei});NP(Ei,fd).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let h2=null;(async()=>{try{await Sq()&&(h2=wq(Hh))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();const oG=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return h2},app:Hh,auth:Ei,db:q,firestore:tr},Symbol.toStringTag,{value:"Module"}));class ty{constructor(e,t){this.db=e,this.userUID=t,this.userRef=Z(e,`users/${t}`),this.statsRef=Z(e,`users/${t}/stats`),this.profileRef=Z(e,`users/${t}/profile`),this.behaviorLogRef=Z(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(`🔄 StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await Le(this.statsRef);if(!s.exists())return console.error(`❌ StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(`🔄 StatManager: ${e} change: ${o} → ${a} (${t>0?"+":""}${t})`),console.log(`🔄 StatManager: About to write to Firebase - ${e}: ${a}`),console.log("🔄 StatManager: Writing to path:",this.statsRef.toString()),console.log("🔄 StatManager: Full stats object to write:",{...i,[e]:a});try{await Ue(this.statsRef,{...i,[e]:a}),console.log(`✅ StatManager: Successfully updated ${e} in Firebase`)}catch(c){throw console.error(`❌ StatManager: Firebase write failed for ${e}:`,c),c}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`❌ StatManager: CRITICAL ERROR updating ${e}:`,s),console.error("❌ StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await Le(Z(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Le(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log("🔄 StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await Le(Z(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await Le(Z(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log("🔄 StatManager: Last relapse exists:",t.exists()),console.log("🔄 StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),c=r.exists()?r.val():1;console.log(`🔄 StatManager: Current escalation level from Firebase: ${c}`),console.log(`🔄 StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(`🔄 StatManager: After 7+ days clean → escalation level reset to: ${s}`)):(s=c+1,console.log(`🔄 StatManager: Within ${a} days → escalation level: ${c} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(`🔄 StatManager: Escalation level ${s} → addiction increase: +${i}`),console.log("🔄 StatManager: Updating all stats in single write operation...");try{const o=await Le(this.statsRef);if(!o.exists())return console.error("❌ StatManager: No stats found for user"),!1;const a=o.val();console.log("🔄 StatManager: Current stats before relapse:",a);const c=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(`🔄 StatManager: addictionLevel change: ${a.addictionLevel} → ${c} (+${i})`),console.log(`🔄 StatManager: mentalStrength change: ${a.mentalStrength} → ${u} (-3)`),console.log(`🔄 StatManager: triggerDefense change: ${a.triggerDefense} → ${h} (-3)`);const f={...a,addictionLevel:c,mentalStrength:u,triggerDefense:h};console.log("🔄 StatManager: Writing complete updated stats:",f),await Ue(this.statsRef,f),console.log("✅ StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error("❌ StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([Ue(Z(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),Ue(Z(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),Ue(Z(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await Ue(Z(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await Le(Z(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Le(Z(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await Le(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,c=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:c,cleanWeeks:u,isCleanFor7Days:c>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await Le(Z(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await Le(Z(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Le(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const c of a)if(o>=c.days){const u=`milestone_${c.days}`;(await Le(Z(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",c.bonus,`${c.name} milestone bonus`),Ue(Z(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Ue(Z(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=await Le(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<1)return;const o=await Le(Z(this.db,`users/${this.userUID}/profile/lastActivity`));if(o.exists()){const u=new Date(o.val()),h=Math.floor((r-u)/(1e3*60*60*24));if(h>=7&&i>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${h} days since last activity`);return}}let a=null,c=null;for(let u=0;u<10;u++){const h=new Date;h.setDate(h.getDate()-u);const f=h.toDateString(),m=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${f}/logged`));if(m.exists()&&m.val()){a=u,c=h;break}}if(a===null||a>=7)if(c){const u=Math.floor((r-c)/864e5);u>=7&&i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${u} days since last activity`))}else i>=7&&(await this.updateStat("motivation",1,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${i} days since registration with no activity`))}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await rR(Z(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await Le(Z(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await Le(Z(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await Le(Z(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Ue(Z(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Ue(Z(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await Le(Z(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,c=t.canAwardTriggerDefense?3:0;await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+c)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,c=t.canAwardTriggerDefense?.25:0;await Ue(Z(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+c)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await Le(Z(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const Eq=Object.freeze(Object.defineProperty({__proto__:null,default:ty},Symbol.toStringTag,{value:"Module"}));class sc{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=kn(e,"matchingPool"),this.buddyPairsCollection=kn(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:fm(),lastActive:fm(),status:"waiting"};return await GU(dm(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await HU(dm(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:fm(),status:"active",...r},i=await Ss(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await li(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=dm(this.matchingPoolCollection,e),r=await WU(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async getUserBuddyPair(e){try{console.log("🔄 Firestore: Getting buddy pair for user:",e);const t=As(this.buddyPairsCollection,Ns("user1Id","==",e)),r=As(this.buddyPairsCollection,Ns("user2Id","==",e)),[s,i]=await Promise.all([li(t),li(r)]);let o=null;if(s.empty?i.empty||(o=i.docs[0]):o=s.docs[0],o){const a=o.data();return console.log("✅ Firestore: Found buddy pair:",o.id),{id:o.id,...a}}else return console.log("ℹ️ Firestore: No buddy pair found for user"),null}catch(t){return console.error("❌ Firestore: Error getting buddy pair:",t),null}}async testConnectivity(){try{return console.log("🧪 Firestore: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ Firestore: Service available and initialized"),!0):(console.warn("⚠️ Firestore: Service not properly initialized"),!1)}catch(e){return console.warn("⚠️ Firestore: Connectivity check failed (non-critical):",(e==null?void 0:e.message)||e),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}class f2{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log("🚀 FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:et.now(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await Ss(kn(this.firestore,this.collections.cravings),r);return console.log("✅ Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:et.now(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await Ss(kn(this.firestore,this.collections.relapses),r);return console.log("✅ Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:et.now(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await Ss(kn(this.firestore,this.collections.hydration),r);return console.log("✅ Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:et.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await Ss(kn(this.firestore,this.collections.breathing),r);return console.log("✅ Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:et.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await Ss(kn(this.firestore,this.collections.meditation),r);return console.log("✅ Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:et.now(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await Ss(kn(this.firestore,this.collections.physicalActivity),r);return console.log("✅ Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:et.now(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await Ss(kn(this.firestore,this.collections.moodTracking),r);return console.log("✅ Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=As(kn(this.firestore,this.collections[t]),Ns("userId","==",e),Sg("timestamp","desc"));r&&(i=As(i,Ns("timestamp",">=",et.fromDate(new Date(r))))),s&&(i=As(i,Ns("timestamp","<=",et.fromDate(new Date(s)))));const o=await li(i),a=[];return o.forEach(c=>{var u;a.push({id:c.id,...c.data(),timestamp:((u=c.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(`✅ Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(`❌ Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(`📊 Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,c,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(y=>(console.warn("⚠️ Cravings data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(y=>(console.warn("⚠️ Relapses data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(y=>(console.warn("⚠️ Hydration data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(y=>(console.warn("⚠️ Breathing data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(y=>(console.warn("⚠️ Meditation data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(y=>(console.warn("⚠️ Physical activity data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(y=>(console.warn("⚠️ Mood data not available yet (indexes building):",y.message),[]))]),m={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(y=>y.outcome==="resisted").length,relapsed:i.filter(y=>y.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((y,w)=>y+(w.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((y,w)=>y+(w.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(y=>y.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(y=>y.achievedTarget).length,breathingExercises:c.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:c.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((y,w)=>y+(w.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,c,u,h,f),generatedAt:new Date};return console.log("📊 Behavioral analytics generated:",m),m}catch(r){throw console.error("❌ Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const c=[],u=e.filter(y=>y.outcome==="resisted").length,h=e.length;if(h>0){const y=u/h*100;c.push(`Craving resistance rate: ${y.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&c.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const m=r.filter(y=>y.achievedTarget).length;return m>0&&c.push(`Achieved hydration target on ${m} days`),c}async migrateUserData(e,t){try{console.log(`🔄 Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await Me(()=>import("./index.esm-f161132b.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let c=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?et.fromDate(new Date(h.timestamp)):fm(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await Ss(kn(this.firestore,this.collections.cravings),f),c++}catch(f){console.error(`❌ Error migrating craving ${u}:`,f)}console.log(`✅ Migrated ${c} cravings to Firestore`)}return console.log(`✅ Data migration completed for user ${e}`),!0}catch(r){throw console.error("❌ Error during data migration:",r),r}}async testConnectivity(){try{return console.log("🧪 FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn("⚠️ FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn("⚠️ FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(`📊 Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=As(kn(this.db,s),Ns("userId","==",e)),o=await li(i);r[s]=o.size}catch(i){console.warn(`⚠️ Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error("❌ Error generating basic analytics:",t),t}}}const aG=Object.freeze(Object.defineProperty({__proto__:null,default:f2},Symbol.toStringTag,{value:"Module"}));class YT{constructor(e,t,r=null){this.db=e,this.userId=t,this.authGuard=r,this.statsRef=Z(e,`users/${t}/stats`),this.profileRef=Z(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{let e,t,r;if(this.authGuard)[e,t,r]=await Promise.all([this.authGuard.databaseGet(`users/${this.userId}/profile`),this.authGuard.databaseGet(`users/${this.userId}/stats`),this.authGuard.databaseGet(`users/${this.userId}`)]);else{const[k,I,x]=await Promise.all([Le(this.profileRef),Le(this.statsRef),Le(Z(this.db,`users/${this.userId}`))]);e=k.exists()?k.val():{},t=I.exists()?I.val():{},r=x.exists()?x.val():{}}const s={...e,createdAt:e.createdAt||r.createdAt||null,quitDate:e.quitDate||r.quitDate||r.quitStartDate||null,lastQuitDate:e.lastQuitDate||r.lastQuitDate||null};if(!s.lastRelapseDate&&!s.quitDate&&s.createdAt)try{await Ue(Z(this.db,`users/${this.userId}/profile/quitDate`),s.createdAt),s.quitDate=s.createdAt,console.log(`📊 CentralizedStats: Seeded missing quitDate with createdAt for ${this.userId}: ${s.createdAt}`)}catch(k){console.warn(`⚠️ CentralizedStats: Could not seed quitDate for ${this.userId}:`,k.message)}const i=t||this.getDefaultStats(),o=this.calculateEffectiveQuitDate(s),a=this.calculateStreakFromRelapse(s),c=await this.calculateCravingsResisted(),u=await this.calculateAddictionLevel(s,o),h=this.calculateMentalStrength(i,c),f=h.strength,m=h.cravingsApplied,y=await this.checkMilestonesFromRelapse(s,i),w=await this.generateSpecialFeatures(s),S={...i,...y,streakDays:a.value,streakUnit:a.unit,streakDisplayText:a.displayText,cravingsResisted:c,addictionLevel:u,mentalStrength:f,mentalStrengthCravingsApplied:m,specialFeatures:w,lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,S):await Ue(this.statsRef,S),console.log(`✅ CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:a.displayText,cravingsResisted:c,addictionLevel:u,mentalStrength:f,specialFeatures:(w==null?void 0:w.length)||0,effectiveQuitDate:o}),S}catch(e){throw console.error(`❌ CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||null;if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(`📊 CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(`📊 CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const c=e.lastQuitDate||e.originalQuitDate||e.quitDate||e.createdAt||null;return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${c}`),c?this.calculateStreak(c):{value:0,unit:"hours",displayText:"0 hours",streakDays:0}}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([Le(Z(this.db,`users/${this.userId}/profile/cravingsResisted`)),Le(Z(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(`📊 CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length}return r}catch(e){return console.warn(`⚠️ CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}calculateMentalStrength(e,t){try{const r=e.mentalStrength||50,s=e.mentalStrengthCravingsApplied||0;return{strength:r,cravingsApplied:s}}catch(r){return console.warn(`⚠️ CentralizedStats: Could not calculate mental strength for ${this.userId}:`,r.message),{strength:e.mentalStrength||50,cravingsApplied:e.mentalStrengthCravingsApplied||0}}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([Le(this.statsRef),Le(Z(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Le(Z(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(`📊 CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(`📊 CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(`📊 CentralizedStats: Days since last relapse: ${u}`),console.log(`📊 CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await Ue(Z(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const m=Math.floor(u/7),y=m*2;let w=Math.max(30,o-y);return console.log(`📊 CentralizedStats: Base addiction: ${o}, Weeks clean: ${m}, Decay: -${y}, Final: ${w}`),w}catch(r){return console.error("❌ CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},c=!1;for(const u of o)if(i>=u.days){const h=Z(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await Le(h)).exists()){const m=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=m,c=!0,await Ue(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let c={},u=!1;for(const h of a)if(o>=h.days){const f=Z(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await Le(f)).exists()){const y=Math.min(100,(t.mentalStrength||50)+h.bonus);c.mentalStrength=y,u=!0,await Ue(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return c}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await Le(Z(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(`📊 CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await Le(Z(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(`📊 CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(`⚠️ CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(`📊 CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(`📊 CentralizedStats: Generated ${o.length} personalized features:`,o);const c=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=c[Math.floor(Math.random()*c.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await Ue(Z(this.db,`users/${this.userId}/specialFeatures`),u),console.log(`📊 CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(`❌ CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=zw(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(`🔄 CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:"🎉 First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

🧠 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! 💪`},30:{title:"🏆 One Month Champion!",message:`Amazing! You've reached 30 days clean!

🧠 Mental Strength: +${e.bonus} points

You're proving your strength every day! 🌟`},90:{title:"👑 Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

🧠 Mental Strength: +${e.bonus} points

You're a true inspiration! 🎯✨`}}[e.days]||{title:"🎉 Milestone Achieved!",message:`You've reached ${t} days clean!

🧠 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(`🎉 Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(`🔄 CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=Z(this.db,`users/${this.userId}/profile/milestones`);await Ue(e,null),console.log(`✅ CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(`❌ CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(`🔄 CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([Le(Z(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Le(Z(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),Le(this.statsRef)]);let o=1;if(r.exists()){const m=new Date(r.val()),y=Math.floor((e-m)/(1e3*60*60*24)),w=s.exists()?s.val():1;console.log(`🔄 CentralizedStats: Current escalation level: ${w}`),console.log(`🔄 CentralizedStats: Days since last relapse: ${y}`),y>=7?(o=1,console.log(`🔄 CentralizedStats: After 7+ days clean → escalation level reset to: ${o}`)):(o=w+1,console.log(`🔄 CentralizedStats: Within ${y} days → escalation level: ${w} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(`🔄 CentralizedStats: Escalation level ${o} → addiction increase: +${a}`);const c=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(c.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(c.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(c.triggerDefense||30)-3));console.log(`🔄 CentralizedStats: addictionLevel change: ${c.addictionLevel} → ${u} (+${a})`),console.log(`🔄 CentralizedStats: mentalStrength change: ${c.mentalStrength} → ${h} (-3)`),console.log(`🔄 CentralizedStats: triggerDefense change: ${c.triggerDefense} → ${f} (-3)`),await Promise.all([Ue(Z(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),Ue(Z(this.db,`users/${this.userId}/profile/relapseDate`),t),Ue(Z(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),Ue(Z(this.db,`users/${this.userId}/lastQuitDate`),t),Ue(Z(this.db,`users/${this.userId}/profile/lastQuitDate`),t),this.resetMilestones(),Ue(this.statsRef,{...c,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(`✅ CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(`❌ CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async getCurrentStats(){try{const e=await Le(this.statsRef);return e.exists()?e.val():this.getDefaultStats()}catch(e){return console.error(`❌ CentralizedStats: Error getting current stats for ${this.userId}:`,e),this.getDefaultStats()}}async handleCravingResisted(){try{console.log(`🔄 CentralizedStats: Handling craving resisted for ${this.userId}`),await this.checkAndResetDailyCounter();const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsApplied||0;if(console.log(`🔄 CentralizedStats: Current mental strength cravings applied: ${t}`),t<3){const r=Math.min(100,(e.mentalStrength||50)+1),s=t+1,i={...e,mentalStrength:r,mentalStrengthCravingsApplied:s,mentalStrengthCravingsAppliedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,i):await Ue(this.statsRef,i),console.log(`✅ CentralizedStats: Applied +1 mental strength (${e.mentalStrength} → ${r}), cravings applied: ${s}/3`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!0,cravingsApplied:s,limitReached:s>=3}}else return console.log(`📊 CentralizedStats: Daily mental strength limit reached (${t}/3), no bonus applied`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!1,cravingsApplied:t,limitReached:!0}}catch(e){throw console.error(`❌ CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}async checkAndResetDailyCounter(){try{const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsAppliedDate,r=new Date,s=r.toDateString();if(!t){const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Ue(this.statsRef,o),console.log(`✅ CentralizedStats: Initialized daily counter for ${this.userId} (reset to 0)`);return}if(new Date(t).toDateString()!==s){console.log(`🔄 CentralizedStats: New day detected, resetting daily mental strength counter for ${this.userId}`);const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Ue(this.statsRef,o),console.log(`✅ CentralizedStats: Daily mental strength counter reset for ${this.userId}`)}}catch(e){console.warn(`⚠️ CentralizedStats: Could not check/reset daily counter for ${this.userId}:`,e.message)}}}const xS=(n,e={})=>{const{threshold:t=100,velocity:r=.5,enabled:s=!0}=e,[i,o]=P.useState(!1),[a,c]=P.useState(null),[u,h]=P.useState(0),f=P.useRef(null),m=P.useRef(0),y=P.useRef(0),w=P.useRef(0),S=P.useRef(0),k=P.useRef(0);return P.useEffect(()=>{if(!s||!f.current)return;const I=f.current;let x=!1;const C=R=>{if(!s)return;const _=R.touches[0];m.current=_.clientY,y.current=_.clientX,w.current=Date.now(),S.current=_.clientY,k.current=Date.now(),x=!0,o(!0),I.classList.add("swiping")},D=R=>{if(!x||!s)return;R.preventDefault();const _=R.touches[0],E=_.clientY-m.current,N=_.clientX-y.current;Math.abs(N)>Math.abs(E)||(h(E),E>0?(c("down"),I.style.transform=`translateY(${Math.min(E,t*1.5)}px)`,I.style.opacity=Math.max(.3,1-E/(t*2))):E<0&&(c("up"),I.style.transform=`translateY(${Math.max(E,-t*1.5)}px)`,I.style.opacity=Math.max(.3,1-Math.abs(E)/(t*2))),S.current=_.clientY,k.current=Date.now())},U=R=>{if(!x||!s)return;x=!1,o(!1);const E=R.changedTouches[0].clientY-m.current,N=Date.now()-w.current,T=Math.abs(E)/N;I.style.transform="",I.style.opacity="",I.classList.remove("swiping"),(Math.abs(E)>t||T>r)&&(E>0&&a==="down"?L("down"):E<0&&a==="up"&&L("up")),c(null),h(0)},L=R=>{I.classList.add(`swipe-${R}`),setTimeout(()=>{typeof n=="function"&&n()},200)};return I.addEventListener("touchstart",C,{passive:!1}),I.addEventListener("touchmove",D,{passive:!1}),I.addEventListener("touchend",U,{passive:!0}),()=>{I.removeEventListener("touchstart",C),I.removeEventListener("touchmove",D),I.removeEventListener("touchend",U)}},[s,t,r,a]),{modalRef:f,isSwipping:i,swipeDirection:a,swipeDistance:u,classes:`modal-swipe-dismiss ${i?"swiping":""} ${a?`swipe-${a}`:""}`}};var Tq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Aq=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Nq=(n,e)=>{const t=P.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...c},u)=>P.createElement("svg",{ref:u,...Tq,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${Aq(n)}`,...c},[...e.map(([h,f])=>P.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var Ct=Nq;const Rg=Ct("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),ch=Ct("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Cq=Ct("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),kg=Ct("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Rq=Ct("Bug",[["rect",{width:"8",height:"14",x:"8",y:"6",rx:"4",key:"hq8nra"}],["path",{d:"m19 7-3 2",key:"fmg8ec"}],["path",{d:"m5 7 3 2",key:"dkxqes"}],["path",{d:"m19 19-3-2",key:"1hbhi4"}],["path",{d:"m5 19 3-2",key:"dvt2ee"}],["path",{d:"M20 13h-4",key:"1agfp2"}],["path",{d:"M4 13h4",key:"1bwh8b"}],["path",{d:"m10 4 1 2",key:"1pot59"}],["path",{d:"m14 4-1 2",key:"m8sn0o"}]]),m2=Ct("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),JT=Ct("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),kq=Ct("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Dg=Ct("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),g2=Ct("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Dq=Ct("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),p2=Ct("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),y2=Ct("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),XT=Ct("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Lf=Ct("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Zs=Ct("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),v2=Ct("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),js=Ct("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Pq=Ct("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Mf=Ct("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),_2=Ct("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),jq=Ct("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),Lq=Ct("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Mq=Ct("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),w2=Ct("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Oq=Ct("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),x2=Ct("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),SS=Ct("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),hv=Ct("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Vq=Ct("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Fq=({isOpen:n,onClose:e})=>{var k,I,x,C,D,U,L,R,_,E,N,T,A,v,B,ye,Te,ft,Q,we;const[t,r]=P.useState(null),[s,i]=P.useState([]),[o,a]=P.useState(!1),[c,u]=P.useState("overview"),[h,f]=P.useState(!0);P.useEffect(()=>{if(!n)return;const se=()=>{if(window.performanceIntegrationService){const Ie=window.performanceIntegrationService.getMetricsSummary(),Ae=window.performanceIntegrationService.getRecentAlerts(20);r(Ie),i(Ae)}};if(se(),h){const Ie=setInterval(se,5e3);return()=>clearInterval(Ie)}},[n,h]);const m=async se=>{if(window.stressTestService){a(!0);try{let Ie;switch(se){case"database":Ie=await window.stressTestService.databaseLoadTest({concurrentUsers:5,operationsPerUser:3});break;case"auth":Ie=await window.stressTestService.authLoadTest({concurrentAttempts:10});break;case"offline":Ie=await window.stressTestService.offlineOnlineTest({transitionCount:3});break;case"memory":Ie=await window.stressTestService.memoryUsageTest({iterations:50});break;default:throw new Error("Unknown test type")}console.log("✅ Stress test completed:",Ie)}catch(Ie){console.error("❌ Stress test failed:",Ie)}finally{a(!1)}}},y=()=>{window.performanceIntegrationService&&(window.performanceIntegrationService.clearAllMetrics(),r(null),i([]))},w=se=>se.includes("slow")?l.jsx(kq,{className:"w-4 h-4 text-yellow-500"}):se.includes("failure")||se.includes("error")?l.jsx(ch,{className:"w-4 h-4 text-red-500"}):l.jsx(JT,{className:"w-4 h-4 text-green-500"}),S=se=>se.includes("slow")?"bg-yellow-50 border-yellow-200":se.includes("failure")||se.includes("error")?"bg-red-50 border-red-200":"bg-green-50 border-green-200";return n?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx(Rg,{className:"w-6 h-6 text-blue-600"}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Performance Dashboard"})]}),l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsxs("button",{onClick:()=>f(!h),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${h?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[l.jsx(Zs,{className:`w-4 h-4 ${h?"animate-spin":""}`}),l.jsx("span",{children:"Auto Refresh"})]}),l.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:l.jsx(Vq,{className:"w-6 h-6"})})]})]}),l.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview",icon:kg},{id:"database",label:"Database",icon:Dg},{id:"auth",label:"Authentication",icon:js},{id:"offline",label:"Offline Queue",icon:hv},{id:"alerts",label:"Alerts",icon:ch}].map(se=>{const Ie=se.icon;return l.jsxs("button",{onClick:()=>u(se.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${c===se.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[l.jsx(Ie,{className:"w-4 h-4"}),l.jsx("span",{children:se.label})]},se.id)})}),l.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[c==="overview"&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Database Queries"}),l.jsx("p",{className:"text-2xl font-bold text-blue-900",children:((k=t==null?void 0:t.database)==null?void 0:k.totalQueries)||0})]}),l.jsx(Dg,{className:"w-8 h-8 text-blue-500"})]}),l.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Avg: ",((I=t==null?void 0:t.database)==null?void 0:I.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-green-600",children:"Auth Success Rate"}),l.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[((x=t==null?void 0:t.authentication)==null?void 0:x.successRate)||0,"%"]})]}),l.jsx(js,{className:"w-8 h-8 text-green-500"})]}),l.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[((C=t==null?void 0:t.authentication)==null?void 0:C.totalAttempts)||0," attempts"]})]}),l.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Offline Operations"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:((D=t==null?void 0:t.offlineQueue)==null?void 0:D.totalOperations)||0})]}),l.jsx(hv,{className:"w-8 h-8 text-purple-500"})]}),l.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["Success: ",((U=t==null?void 0:t.offlineQueue)==null?void 0:U.successRate)||0,"%"]})]}),l.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Page Loads"}),l.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((L=t==null?void 0:t.general)==null?void 0:L.totalPageLoads)||0})]}),l.jsx(Rg,{className:"w-8 h-8 text-orange-500"})]}),l.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Avg: ",((R=t==null?void 0:t.general)==null?void 0:R.averagePageLoadTime)||0,"ms"]})]})]}),l.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Stress Testing"}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("button",{onClick:()=>m("database"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Mf,{className:"w-4 h-4"}):l.jsx(Lf,{className:"w-4 h-4"}),l.jsx("span",{children:"Database Load"})]}),l.jsxs("button",{onClick:()=>m("auth"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Mf,{className:"w-4 h-4"}):l.jsx(Lf,{className:"w-4 h-4"}),l.jsx("span",{children:"Auth Load"})]}),l.jsxs("button",{onClick:()=>m("offline"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Mf,{className:"w-4 h-4"}):l.jsx(Lf,{className:"w-4 h-4"}),l.jsx("span",{children:"Offline/Online"})]}),l.jsxs("button",{onClick:()=>m("memory"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Mf,{className:"w-4 h-4"}):l.jsx(Lf,{className:"w-4 h-4"}),l.jsx("span",{children:"Memory Usage"})]})]}),o&&l.jsx("div",{className:"mt-4 text-center",children:l.jsxs("div",{className:"inline-flex items-center space-x-2 text-blue-600",children:[l.jsx(Zs,{className:"w-4 h-4 animate-spin"}),l.jsx("span",{children:"Running stress test..."})]})})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Clear All Metrics"}),l.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),c==="database"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Database Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Query Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Queries:"}),l.jsx("span",{className:"font-medium",children:((_=t==null?void 0:t.database)==null?void 0:_.totalQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((E=t==null?void 0:t.database)==null?void 0:E.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Queries:"}),l.jsx("span",{className:"font-medium text-yellow-600",children:((N=t==null?void 0:t.database)==null?void 0:N.slowQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Query Rate:"}),l.jsxs("span",{className:"font-medium",children:[((T=t==null?void 0:t.database)==null?void 0:T.slowQueryRate)||0,"%"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Trends"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(kg,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Performance trends will be displayed here"})]})]})]})]}),c==="auth"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Authentication Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Auth Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Attempts:"}),l.jsx("span",{className:"font-medium",children:((A=t==null?void 0:t.authentication)==null?void 0:A.totalAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((v=t==null?void 0:t.authentication)==null?void 0:v.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Failed Attempts:"}),l.jsx("span",{className:"font-medium text-red-600",children:((B=t==null?void 0:t.authentication)==null?void 0:B.failedAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((ye=t==null?void 0:t.authentication)==null?void 0:ye.averageLoginTime)||0,"ms"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Attempts"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(js,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Recent authentication attempts will be displayed here"})]})]})]})]}),c==="offline"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Offline Queue Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Operations:"}),l.jsx("span",{className:"font-medium",children:((Te=t==null?void 0:t.offlineQueue)==null?void 0:Te.totalOperations)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((ft=t==null?void 0:t.offlineQueue)==null?void 0:ft.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Failed Operations:"}),l.jsx("span",{className:"font-medium text-red-600",children:((Q=t==null?void 0:t.offlineQueue)==null?void 0:Q.failedOperations)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((we=t==null?void 0:t.offlineQueue)==null?void 0:we.averageProcessTime)||0,"ms"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Status"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(hv,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Offline queue status will be displayed here"})]})]})]})]}),c==="alerts"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Alerts"}),l.jsx("div",{className:"space-y-3",children:s.length===0?l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(JT,{className:"w-12 h-12 mx-auto mb-2 text-green-400"}),l.jsx("p",{children:"No alerts at this time"})]}):s.map((se,Ie)=>l.jsx("div",{className:`p-4 rounded-lg border ${S(se.type)}`,children:l.jsxs("div",{className:"flex items-start space-x-3",children:[w(se.type),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h4",{className:"font-medium text-gray-900 capitalize",children:se.type.replace(/_/g," ")}),l.jsx("span",{className:"text-xs text-gray-500",children:new Date(se.timestamp).toLocaleTimeString()})]}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:JSON.stringify(se.data,null,2)})]})]})},Ie))})]})]})]})}):null};class Uq{constructor(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[],this.thresholds={slowQuery:1e3,slowLogin:3e3,slowOperation:2e3,slowPageLoad:5e3},this.isEnabled=!0,this.maxMetricsHistory=1e3}startTimer(e){return{operationId:e,startTime:performance.now(),timestamp:new Date().toISOString()}}endTimer(e,t,r,s={}){if(!this.isEnabled)return;const o=performance.now()-e.startTime,a={operationId:e.operationId,operation:r,duration:o,timestamp:e.timestamp,endTime:new Date().toISOString(),metadata:s};if(this.metrics[t]){this.metrics[t].operations=this.metrics[t].operations||[],this.metrics[t].operations.push(a),this.metrics[t].totalOperations=(this.metrics[t].totalOperations||0)+1;const c=this.metrics[t].operations.reduce((h,f)=>h+f.duration,0);this.metrics[t].averageProcessTime=c/this.metrics[t].operations.length;const u=this.thresholds[`slow${t.charAt(0).toUpperCase()+t.slice(1)}`]||this.thresholds.slowOperation;o>u&&(this.metrics[t].slowOperations=(this.metrics[t].slowOperations||0)+1,this.createAlert("slow_operation",{category:t,operation:r,duration:o,threshold:u})),this.metrics[t].operations.length>this.maxMetricsHistory&&(this.metrics[t].operations=this.metrics[t].operations.slice(-this.maxMetricsHistory))}return a}recordDatabaseQuery(e,t,r={}){if(!this.isEnabled)return;const s={operation:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.database.queries.push(s),this.metrics.database.totalQueries++;const i=this.metrics.database.queries.reduce((o,a)=>o+a.duration,0);this.metrics.database.averageQueryTime=i/this.metrics.database.queries.length,t>this.thresholds.slowQuery&&(this.metrics.database.slowQueries++,this.createAlert("slow_query",{operation:e,duration:t,threshold:this.thresholds.slowQuery})),this.metrics.database.queries.length>this.maxMetricsHistory&&(this.metrics.database.queries=this.metrics.database.queries.slice(-this.maxMetricsHistory))}recordAuthAttempt(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.authentication.loginAttempts.push(i),this.metrics.authentication.totalAttempts++,r||(this.metrics.authentication.failedAttempts++,this.createAlert("auth_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.authentication.loginAttempts.reduce((a,c)=>a+c.duration,0);this.metrics.authentication.averageLoginTime=o/this.metrics.authentication.loginAttempts.length,t>this.thresholds.slowLogin&&this.createAlert("slow_login",{operation:e,duration:t,threshold:this.thresholds.slowLogin}),this.metrics.authentication.loginAttempts.length>this.maxMetricsHistory&&(this.metrics.authentication.loginAttempts=this.metrics.authentication.loginAttempts.slice(-this.maxMetricsHistory))}recordOfflineOperation(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.offlineQueue.operations.push(i),this.metrics.offlineQueue.totalOperations++,r||(this.metrics.offlineQueue.failedOperations++,this.createAlert("offline_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.offlineQueue.operations.reduce((a,c)=>a+c.duration,0);this.metrics.offlineQueue.averageProcessTime=o/this.metrics.offlineQueue.operations.length,t>this.thresholds.slowOperation&&this.createAlert("slow_offline_operation",{operation:e,duration:t,threshold:this.thresholds.slowOperation}),this.metrics.offlineQueue.operations.length>this.maxMetricsHistory&&(this.metrics.offlineQueue.operations=this.metrics.offlineQueue.operations.slice(-this.maxMetricsHistory))}recordPageLoad(e,t,r={}){if(!this.isEnabled)return;const s={page:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.general.pageLoads.push(s),this.metrics.general.totalPageLoads++;const i=this.metrics.general.pageLoads.reduce((o,a)=>o+a.duration,0);this.metrics.general.averagePageLoadTime=i/this.metrics.general.pageLoads.length,t>this.thresholds.slowPageLoad&&this.createAlert("slow_page_load",{page:e,duration:t,threshold:this.thresholds.slowPageLoad}),this.metrics.general.pageLoads.length>this.maxMetricsHistory&&(this.metrics.general.pageLoads=this.metrics.general.pageLoads.slice(-this.maxMetricsHistory))}createAlert(e,t){const r={id:Date.now()+Math.random(),type:e,data:t,timestamp:new Date().toISOString(),severity:this.getAlertSeverity(e)};return this.alerts.push(r),this.alerts.length>100&&(this.alerts=this.alerts.slice(-100)),r}getAlertSeverity(e){return{slow_query:"warning",slow_login:"warning",slow_operation:"warning",slow_offline_operation:"warning",slow_page_load:"warning",auth_failure:"error",offline_failure:"error"}[e]||"info"}getMetricsSummary(){return{database:{totalQueries:this.metrics.database.totalQueries,averageQueryTime:Math.round(this.metrics.database.averageQueryTime),slowQueries:this.metrics.database.slowQueries,slowQueryRate:this.metrics.database.totalQueries>0?(this.metrics.database.slowQueries/this.metrics.database.totalQueries*100).toFixed(2):0},authentication:{totalAttempts:this.metrics.authentication.totalAttempts,averageLoginTime:Math.round(this.metrics.authentication.averageLoginTime),failedAttempts:this.metrics.authentication.failedAttempts,successRate:this.metrics.authentication.totalAttempts>0?((this.metrics.authentication.totalAttempts-this.metrics.authentication.failedAttempts)/this.metrics.authentication.totalAttempts*100).toFixed(2):0},offlineQueue:{totalOperations:this.metrics.offlineQueue.totalOperations,averageProcessTime:Math.round(this.metrics.offlineQueue.averageProcessTime),failedOperations:this.metrics.offlineQueue.failedOperations,successRate:this.metrics.offlineQueue.totalOperations>0?((this.metrics.offlineQueue.totalOperations-this.metrics.offlineQueue.failedOperations)/this.metrics.offlineQueue.totalOperations*100).toFixed(2):0},general:{totalPageLoads:this.metrics.general.totalPageLoads,averagePageLoadTime:Math.round(this.metrics.general.averagePageLoadTime)},alerts:{total:this.alerts.length,recent:this.alerts.slice(-10),byType:this.getAlertsByType()}}}getAlertsByType(){const e={};return this.alerts.forEach(t=>{e[t.type]=(e[t.type]||0)+1}),e}clearMetrics(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[]}setEnabled(e){this.isEnabled=e}updateThresholds(e){this.thresholds={...this.thresholds,...e}}exportMetrics(){return{metrics:this.metrics,alerts:this.alerts,thresholds:this.thresholds,exportedAt:new Date().toISOString()}}}const Se=new Uq;class $q{constructor(){this.originalMethods={ref:Z,get:Le,set:Ue,push:rR,update:GF,remove:WF,onValue:zw,off:HF,query:r3}}ref(e,t){const r=Se.startTimer(`ref_${t}`),s=this.originalMethods.ref(e,t);return Se.endTimer(r,"database","ref",{path:t}),s}async get(e){const t=Se.startTimer(`get_${e.key||"unknown"}`);try{const r=await this.originalMethods.get(e);return Se.endTimer(t,"database","get",{path:e.key||"unknown",success:!0,hasData:r.exists()}),r}catch(r){throw Se.endTimer(t,"database","get",{path:e.key||"unknown",success:!1,error:r.message}),r}}async set(e,t){const r=Se.startTimer(`set_${e.key||"unknown"}`);try{const s=await this.originalMethods.set(e,t);return Se.endTimer(r,"database","set",{path:e.key||"unknown",success:!0,dataSize:JSON.stringify(t).length}),s}catch(s){throw Se.endTimer(r,"database","set",{path:e.key||"unknown",success:!1,error:s.message}),s}}push(e){const t=Se.startTimer(`push_${e.key||"unknown"}`),r=this.originalMethods.push(e);return Se.endTimer(t,"database","push",{path:e.key||"unknown",newKey:r.key}),r}async update(e,t){const r=Se.startTimer(`update_${e.key||"unknown"}`);try{const s=await this.originalMethods.update(e,t);return Se.endTimer(r,"database","update",{path:e.key||"unknown",success:!0,updateCount:Object.keys(t).length}),s}catch(s){throw Se.endTimer(r,"database","update",{path:e.key||"unknown",success:!1,error:s.message}),s}}async remove(e){const t=Se.startTimer(`remove_${e.key||"unknown"}`);try{const r=await this.originalMethods.remove(e);return Se.endTimer(t,"database","remove",{path:e.key||"unknown",success:!0}),r}catch(r){throw Se.endTimer(t,"database","remove",{path:e.key||"unknown",success:!1,error:r.message}),r}}onValue(e,t,r,s){const i=Se.startTimer(`onValue_${e.key||"unknown"}`),o=a=>{Se.endTimer(i,"database","onValue",{path:e.key||"unknown",success:!0,hasData:a.exists()}),t(a)};return this.originalMethods.onValue(e,o,r,s)}off(e,t){const r=Se.startTimer(`off_${e.key||"unknown"}`),s=this.originalMethods.off(e,t);return Se.endTimer(r,"database","off",{path:e.key||"unknown"}),s}query(e,...t){const r=Se.startTimer(`query_${e.key||"unknown"}`),s=this.originalMethods.query(e,...t);return Se.endTimer(r,"database","query",{path:e.key||"unknown",constraintCount:t.length}),s}async trackOperation(e,t,r={}){const s=Se.startTimer(e);try{const i=await t();return Se.endTimer(s,"database",e,{...r,success:!0}),i}catch(i){throw Se.endTimer(s,"database",e,{...r,success:!1,error:i.message}),i}}getDatabaseMetrics(){return Se.getMetricsSummary().database}getSlowQueries(e=10){return Se.metrics.database.queries.filter(t=>t.duration>Se.thresholds.slowQuery).sort((t,r)=>r.duration-t.duration).slice(0,e)}getRecentQueries(e=20){return Se.metrics.database.queries.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}}const Of=new $q;class Bq{constructor(){this.originalMethods={signInWithEmailAndPassword:EP,createUserWithEmailAndPassword:bP,signOut:DB,onAuthStateChanged:kB,setPersistence:NP,browserLocalPersistence:fd,browserSessionPersistence:md}}async signInWithEmailAndPassword(e,t,r){const s=Se.startTimer(`signIn_${t}`);try{const i=await this.originalMethods.signInWithEmailAndPassword(e,t,r);return Se.recordAuthAttempt("signIn",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw Se.recordAuthAttempt("signIn",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async createUserWithEmailAndPassword(e,t,r){const s=Se.startTimer(`createUser_${t}`);try{const i=await this.originalMethods.createUserWithEmailAndPassword(e,t,r);return Se.recordAuthAttempt("createUser",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw Se.recordAuthAttempt("createUser",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async signOut(e){const t=Se.startTimer("signOut");try{const r=await this.originalMethods.signOut(e);return Se.recordAuthAttempt("signOut",t.duration,!0,{method:"signOut"}),r}catch(r){throw Se.recordAuthAttempt("signOut",t.duration,!1,{error:r.code,method:"signOut"}),r}}onAuthStateChanged(e,t,r,s){const i=Se.startTimer("onAuthStateChanged"),o=u=>{const h=performance.now()-i.startTime;Se.recordAuthAttempt("authStateChange",h,!0,{hasUser:!!u,uid:u==null?void 0:u.uid,method:"onAuthStateChanged"}),typeof t=="function"?t(u):t&&t.next&&t.next(u)},a=u=>{const h=performance.now()-i.startTime;Se.recordAuthAttempt("authStateChange",h,!1,{error:(u==null?void 0:u.code)||"unknown",method:"onAuthStateChanged"}),u&&typeof u=="function"?u(u):u&&u.error&&u.error(u)},c=()=>{const u=performance.now()-i.startTime;Se.recordAuthAttempt("authStateChange",u,!0,{method:"onAuthStateChanged",completed:!0}),s&&typeof s=="function"?s():s&&s.complete&&s.complete()};return this.originalMethods.onAuthStateChanged(e,o,a,c)}async setPersistence(e,t){const r=Se.startTimer("setPersistence");try{const s=await this.originalMethods.setPersistence(e,t);return Se.recordAuthAttempt("setPersistence",r.duration,!0,{persistence:t===fd?"local":t===md?"session":"unknown"}),s}catch(s){throw Se.recordAuthAttempt("setPersistence",r.duration,!1,{error:s.code,persistence:t===fd?"local":t===md?"session":"unknown"}),s}}async trackAuthOperation(e,t,r={}){const s=Se.startTimer(e);try{const i=await t();return Se.recordAuthAttempt(e,s.duration,!0,r),i}catch(i){throw Se.recordAuthAttempt(e,s.duration,!1,{...r,error:i.code||i.message}),i}}getAuthMetrics(){return Se.getMetricsSummary().authentication}getFailedAttempts(e=10){return Se.metrics.authentication.loginAttempts.filter(t=>!t.success).sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getRecentAttempts(e=20){return Se.metrics.authentication.loginAttempts.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getSlowOperations(e=10){return Se.metrics.authentication.loginAttempts.filter(t=>t.duration>Se.thresholds.slowLogin).sort((t,r)=>r.duration-t.duration).slice(0,e)}getSuccessRateByOperation(){const e={};return Se.metrics.authentication.loginAttempts.forEach(t=>{e[t.operation]||(e[t.operation]={total:0,successful:0}),e[t.operation].total++,t.success&&e[t.operation].successful++}),Object.keys(e).forEach(t=>{const r=e[t];r.successRate=r.total>0?(r.successful/r.total*100).toFixed(2):0}),e}}const Al=new Bq;class zq{constructor(){this.isRunning=!1,this.activeTests=new Map,this.testResults=[]}async runStressTest(e,t={}){if(this.isRunning)throw new Error("Stress test already running");this.isRunning=!0;const r=Date.now().toString();try{console.log(`🧪 Starting stress test: ${e.name}`);const s=await this.executeScenario(e,t);return this.testResults.push({id:r,scenario:e.name,startTime:new Date().toISOString(),endTime:new Date().toISOString(),duration:s.duration,success:s.success,metrics:s.metrics,errors:s.errors}),console.log(`✅ Stress test completed: ${e.name}`),s}catch(s){throw console.error(`❌ Stress test failed: ${e.name}`,s),s}finally{this.isRunning=!1}}async executeScenario(e,t){const r=performance.now(),s=[],i={operations:0,successfulOperations:0,failedOperations:0,averageResponseTime:0,maxResponseTime:0,minResponseTime:1/0};try{await e.execute(t,{onOperation:(c,u,h)=>{i.operations++,h?i.successfulOperations++:i.failedOperations++,i.averageResponseTime=(i.averageResponseTime+u)/2,i.maxResponseTime=Math.max(i.maxResponseTime,u),i.minResponseTime=Math.min(i.minResponseTime,u)},onError:c=>{s.push({message:c.message,timestamp:new Date().toISOString(),stack:c.stack})}});const a=performance.now()-r;return{success:s.length===0,duration:a,metrics:i,errors:s}}catch(o){const c=performance.now()-r;return s.push({message:o.message,timestamp:new Date().toISOString(),stack:o.stack}),{success:!1,duration:c,metrics:i,errors:s}}}async databaseLoadTest(e={}){const{concurrentUsers:t=10,operationsPerUser:r=5,operationDelay:s=100}=e,i={name:"Database Load Test",execute:async(o,a)=>{const c=[];for(let u=0;u<t;u++){const h=this.simulateUserDatabaseOperations(`test_user_${u}`,r,s,a);c.push(h)}await Promise.all(c)}};return this.runStressTest(i,e)}async simulateUserDatabaseOperations(e,t,r,s){for(let i=0;i<t;i++)try{const o=performance.now(),a=[()=>this.simulateReadOperation(e,i),()=>this.simulateWriteOperation(e,i),()=>this.simulateUpdateOperation(e,i),()=>this.simulateQueryOperation(e,i)],c=a[i%a.length];await c();const u=performance.now()-o;s.onOperation(`db_operation_${i}`,u,!0),r>0&&await new Promise(h=>setTimeout(h,r))}catch(o){const a=performance.now()-startTime;s.onOperation(`db_operation_${i}`,a,!1),s.onError(o)}}async simulateReadOperation(e,t){const r=Z(q,`stress_test/${e}/read_${t}`);await Le(r)}async simulateWriteOperation(e,t){const r=Z(q,`stress_test/${e}/write_${t}`);await Ue(r,{data:`test_data_${t}`,timestamp:Date.now(),index:t})}async simulateUpdateOperation(e,t){const r=Z(q,`stress_test/${e}/update_${t}`);await Ue(r,{data:`updated_data_${t}`,timestamp:Date.now(),index:t,updated:!0})}async simulateQueryOperation(e,t){const r=Z(q,`stress_test/${e}`);await Le(r)}async authLoadTest(e={}){const{concurrentAttempts:t=20,delayBetweenAttempts:r=50}=e,s={name:"Authentication Load Test",execute:async(i,o)=>{const a=[];for(let c=0;c<t;c++){const u=this.simulateAuthAttempt(c,r,o);a.push(u)}await Promise.all(a)}};return this.runStressTest(s,e)}async simulateAuthAttempt(e,t,r){try{const s=performance.now();await new Promise(a=>setTimeout(a,Math.random()*1e3+100));const i=performance.now()-s,o=Math.random()>.1;r.onOperation(`auth_attempt_${e}`,i,o),o||r.onError(new Error(`Simulated auth failure ${e}`)),t>0&&await new Promise(a=>setTimeout(a,t))}catch(s){r.onError(s)}}async offlineOnlineTest(e={}){const{transitionCount:t=5,offlineDuration:r=2e3,onlineDuration:s=2e3}=e,i={name:"Offline/Online Transition Test",execute:async(o,a)=>{for(let c=0;c<t;c++)a.onOperation(`offline_transition_${c}`,0,!0),await new Promise(u=>setTimeout(u,r)),a.onOperation(`online_transition_${c}`,0,!0),await new Promise(u=>setTimeout(u,s))}};return this.runStressTest(i,e)}async memoryUsageTest(e={}){const{iterations:t=100,dataSize:r=1e3}=e,s={name:"Memory Usage Test",execute:async(i,o)=>{for(let a=0;a<t;a++){const c=performance.now();new Array(r).fill(0).map((h,f)=>({id:f,data:`test_data_${a}_${f}`,timestamp:Date.now()}));const u=performance.now()-c;o.onOperation(`memory_allocation_${a}`,u,!0)}}};return this.runStressTest(s,e)}getTestResults(e=10){return this.testResults.sort((t,r)=>new Date(r.startTime)-new Date(t.startTime)).slice(0,e)}clearTestResults(){this.testResults=[]}getPerformanceSummary(){return Se.getMetricsSummary()}stopAllTests(){this.isRunning=!1,this.activeTests.clear()}isTestRunning(){return this.isRunning}}const Cu=new zq;class qq{constructor(){this.isInitialized=!1,this.originalFirebaseMethods=null,this.originalAuthMethods=null}initialize(){if(this.isInitialized){console.log("Performance monitoring already initialized");return}try{this.storeOriginalMethods(),Se.setEnabled(!0),typeof window<"u"&&(window.performanceMonitor=Se,window.databasePerformanceWrapper=Of,window.authPerformanceWrapper=Al,window.stressTestService=Cu,window.performanceIntegrationService=this),this.isInitialized=!0,console.log("✅ Performance monitoring system initialized")}catch(e){throw console.error("❌ Failed to initialize performance monitoring:",e),e}}storeOriginalMethods(){}getMetricsSummary(){return Se.getMetricsSummary()}getRecentAlerts(e=20){return Se.alerts.slice(-e)}clearAllMetrics(){Se.clearMetrics(),Cu.clearTestResults()}getDatabaseMetrics(){return Of.getDatabaseMetrics()}getAuthMetrics(){return Al.getAuthMetrics()}getStressTestResults(e=10){return Cu.getTestResults(e)}async runStressTest(e,t={}){return await Cu.runStressTest(e,t)}getAlertsByType(){return Se.getAlertsByType()}getSlowOperations(e="database",t=10){switch(e){case"database":return Of.getSlowQueries(t);case"auth":return Al.getSlowOperations(t);default:return[]}}getRecentOperations(e="database",t=20){switch(e){case"database":return Of.getRecentQueries(t);case"auth":return Al.getRecentAttempts(t);default:return[]}}getFailedOperations(e="auth",t=10){switch(e){case"auth":return Al.getFailedAttempts(t);default:return[]}}getSuccessRatesByOperation(e="auth"){switch(e){case"auth":return Al.getSuccessRateByOperation();default:return{}}}setMonitoringEnabled(e){Se.setEnabled(e)}updateThresholds(e){Se.updateThresholds(e)}exportPerformanceData(){return{metrics:Se.exportMetrics(),stressTests:Cu.getTestResults(),exportedAt:new Date().toISOString(),version:"1.0.0"}}getPerformanceHealthScore(){const e=this.getMetricsSummary();let t=100;e.database.slowQueryRate>10?t-=20:e.database.slowQueryRate>5&&(t-=10),e.authentication.successRate<90?t-=15:e.authentication.successRate<95&&(t-=5),e.offlineQueue.successRate<90&&(t-=10),e.general.averagePageLoadTime>3e3?t-=15:e.general.averagePageLoadTime>2e3&&(t-=5);const s=this.getRecentAlerts(10).filter(i=>i.severity==="error").length;return t-=s*5,Math.max(0,Math.min(100,t))}getPerformanceRecommendations(){const e=[],t=this.getMetricsSummary();return this.getPerformanceHealthScore()<70&&e.push({type:"critical",message:"Performance health is below 70%. Consider optimizing database queries and reducing load.",action:"Review slow queries and optimize database operations"}),t.database.slowQueryRate>10&&e.push({type:"warning",message:`High slow query rate: ${t.database.slowQueryRate}%. Consider adding database indexes.`,action:"Add database indexes for frequently queried fields"}),t.authentication.successRate<95&&e.push({type:"warning",message:`Low authentication success rate: ${t.authentication.successRate}%. Check for auth issues.`,action:"Review authentication flow and error handling"}),t.general.averagePageLoadTime>2e3&&e.push({type:"info",message:`Slow page load times: ${t.general.averagePageLoadTime}ms average. Consider optimizing assets.`,action:"Optimize images, reduce bundle size, and implement lazy loading"}),t.offlineQueue.failedOperations>0&&e.push({type:"info",message:`${t.offlineQueue.failedOperations} offline operations failed. Check sync reliability.`,action:"Review offline queue error handling and retry logic"}),e}startContinuousMonitoring(e=3e4){this.monitoringInterval&&clearInterval(this.monitoringInterval),this.monitoringInterval=setInterval(()=>{const t=this.getPerformanceHealthScore(),r=this.getPerformanceRecommendations();t<50?console.warn("🚨 Critical performance issues detected:",r):t<80&&console.warn("⚠️ Performance warnings:",r)},e)}stopContinuousMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}getSystemStatus(){return{isInitialized:this.isInitialized,isMonitoring:Se.isEnabled,healthScore:this.getPerformanceHealthScore(),lastUpdate:new Date().toISOString(),recommendations:this.getPerformanceRecommendations()}}}const Wq=new qq;class Gq extends yA.Component{constructor(t){super(t);sf(this,"handleRetry",()=>{this.setState(t=>({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:t.retryCount+1}))});sf(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}),window.location&&(window.location.href="/")});sf(this,"handleReportBug",()=>{var r,s,i;const t={errorId:this.state.errorId,message:(r=this.state.error)==null?void 0:r.message,stack:(s=this.state.error)==null?void 0:s.stack,componentStack:(i=this.state.errorInfo)==null?void 0:i.componentStack,userAgent:navigator.userAgent,url:window.location.href,timestamp:new Date().toISOString()};navigator.clipboard.writeText(JSON.stringify(t,null,2)).then(()=>{alert("Error details copied to clipboard. Please share this with the development team.")}).catch(()=>{alert(`Error ID: ${this.state.errorId}

Please report this error to the development team.`)})});this.state={hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorId:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(t,r){this.setState({error:t,errorInfo:r}),this.logError(t,r)}logError(t,r){window.errorLoggingService&&window.errorLoggingService.logError("react_error_boundary",{message:t.message,stack:t.stack,componentStack:r.componentStack,errorId:this.state.errorId,retryCount:this.state.retryCount,severity:"critical"})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-900 via-red-800 to-red-900 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 text-center",children:[l.jsx("div",{className:"flex justify-center mb-4",children:l.jsx(ch,{className:"w-16 h-16 text-red-500"})}),l.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Oops! Something went wrong"}),l.jsx("p",{className:"text-gray-600 mb-6",children:"We're sorry, but something unexpected happened. Don't worry, your data is safe."}),this.state.errorId&&l.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mb-6",children:[l.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Error ID:"}),l.jsx("p",{className:"font-mono text-xs text-gray-800 break-all",children:this.state.errorId})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("button",{onClick:this.handleRetry,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(Zs,{className:"w-4 h-4"}),l.jsx("span",{children:"Try Again"})]}),l.jsxs("button",{onClick:this.handleReset,className:"w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(y2,{className:"w-4 h-4"}),l.jsx("span",{children:"Go to Home"})]}),l.jsxs("button",{onClick:this.handleReportBug,className:"w-full bg-orange-600 hover:bg-orange-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(Rq,{className:"w-4 h-4"}),l.jsx("span",{children:"Report Bug"})]})]}),this.state.retryCount>0&&l.jsxs("p",{className:"text-xs text-gray-500 mt-4",children:["Retry attempt: ",this.state.retryCount]}),!1]})}):this.props.children}}const Hq=({isOpen:n,onClose:e})=>{var L,R,_,E,N,T,A,v,B,ye,Te,ft,Q,we,se,Ie,Ae,j,W,de,me,Ce,ce,te,ve,fe,pe,_e,qe,H,X,Y,Ve,De,Re,xt,Mt,bt,mt,Et,ht,Pe,He,ln,Wt,In,On,Xt,ir,mn,Kn,vt,Rt,bn,ot,rt,Zt;const[t,r]=P.useState("overview"),[s,i]=P.useState(null),[o,a]=P.useState(!0),[c,u]=P.useState(!0),[h,f]=P.useState(!1),m=async()=>{if(n){f(!0);try{const ae=await y();i(ae)}catch(ae){console.error("❌ BetaMonitoringDashboard: Error refreshing data:",ae)}finally{f(!1)}}},y=async()=>({timestamp:new Date().toISOString(),userMetrics:await w(),systemHealth:await S(),errorStats:await k(),performanceMetrics:await I(),privacyCompliance:await x(),rateLimiting:await C(),dataBackup:await D()}),w=async()=>{var Gt;if(!window.privacyProtectionService)return null;const ae=window.privacyProtectionService.getPrivacySettings(),Tt=window.privacyProtectionService.getAuditLog();return{hasConsent:ae.hasConsent,privacyMode:ae.isPrivacyModeEnabled,dataRetentionDays:ae.dataRetentionDays,auditEvents:Tt.length,lastConsentUpdate:(Gt=Tt.find(ns=>ns.eventType==="consent_granted"))==null?void 0:Gt.timestamp}},S=async()=>{if(!window.gracefulDegradationService)return null;const ae=window.gracefulDegradationService.getServiceStatus();return{firebase:ae.firebase,firestore:ae.firestore,offline:ae.offline,degradationMode:ae.degradationMode,fallbackDataCount:ae.fallbackDataCount}},k=async()=>{if(!window.errorLoggingService)return null;const ae=window.errorLoggingService.getErrorQueueStatus(),Tt=await window.errorLoggingService.getRecentErrors(10);return{queueLength:ae.queueLength,isOnline:ae.isOnline,errorCounts:ae.errorCounts,recentErrors:Tt.slice(0,5),criticalErrors:Tt.filter(Gt=>Gt.severity==="critical").length}},I=async()=>{if(!window.performanceIntegrationService)return null;const ae=window.performanceIntegrationService.getMetricsSummary(),Tt=window.performanceIntegrationService.getPerformanceHealthScore(),Gt=window.performanceIntegrationService.getPerformanceRecommendations();return{healthScore:Tt,database:ae.database,authentication:ae.authentication,offlineQueue:ae.offlineQueue,general:ae.general,recommendations:Gt.slice(0,3)}},x=async()=>{if(!window.privacyProtectionService)return null;const ae=window.privacyProtectionService.getPrivacySettings();return{anonymizationEnabled:ae.anonymizationEnabled,encryptionEnabled:ae.encryptionEnabled,dataRetentionCompliant:ae.dataRetentionDays<=30,consentValid:ae.hasConsent,gdprCompliant:ae.hasConsent&&ae.anonymizationEnabled}},C=async()=>{if(!window.rateLimitingService)return null;const ae=window.rateLimitingService.getRateLimitStatus(),Tt=window.rateLimitingService.getSuspiciousUsers(),Gt=window.rateLimitingService.getBlockedUsers();return{isBlocked:(ae==null?void 0:ae.isBlocked)||!1,isSuspicious:(ae==null?void 0:ae.isSuspicious)||!1,suspiciousUserCount:Tt.length,blockedUserCount:Gt.length,limits:(ae==null?void 0:ae.limits)||{}}},D=async()=>{if(!window.dataBackupService)return null;const ae=window.dataBackupService.getBackupStatus(),Tt=await window.dataBackupService.getBackupHistory(5);return{isEnabled:ae.isEnabled,lastBackupTime:ae.lastBackupTime,backupCount:ae.backupCount,nextBackupIn:ae.nextBackupIn,recentBackups:Tt}};P.useEffect(()=>{if(n&&(m(),c)){const ae=setInterval(m,3e4);return()=>clearInterval(ae)}},[n,c]);const U=async()=>{try{const Tt={...await y(),exportMetadata:{exportedAt:new Date().toISOString(),version:"1.0.0",privacyMode:o}},Gt=new Blob([JSON.stringify(Tt,null,2)],{type:"application/json"}),ns=URL.createObjectURL(Gt),Yn=document.createElement("a");Yn.href=ns,Yn.download=`beta-monitoring-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Yn),Yn.click(),document.body.removeChild(Yn),URL.revokeObjectURL(ns)}catch(ae){console.error("❌ BetaMonitoringDashboard: Error exporting data:",ae),alert("Error exporting data. Please try again.")}};return n?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx(js,{className:"w-6 h-6 text-blue-600"}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Beta Monitoring Dashboard"}),o&&l.jsxs("div",{className:"flex items-center space-x-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs",children:[l.jsx(XT,{className:"w-3 h-3"}),l.jsx("span",{children:"Privacy Mode"})]})]}),l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsxs("button",{onClick:()=>a(!o),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${o?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[o?l.jsx(XT,{className:"w-4 h-4"}):l.jsx(Oq,{className:"w-4 h-4"}),l.jsx("span",{children:o?"Privacy On":"Privacy Off"})]}),l.jsxs("button",{onClick:()=>u(!c),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${c?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[l.jsx(Zs,{className:`w-4 h-4 ${c?"animate-spin":""}`}),l.jsx("span",{children:"Auto Refresh"})]}),l.jsxs("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:[l.jsx("span",{className:"sr-only",children:"Close"}),l.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]})]}),l.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview",icon:kg},{id:"users",label:"Users",icon:SS},{id:"system",label:"System",icon:Rg},{id:"errors",label:"Errors",icon:ch},{id:"privacy",label:"Privacy",icon:js},{id:"performance",label:"Performance",icon:Dg}].map(ae=>{const Tt=ae.icon;return l.jsxs("button",{onClick:()=>r(ae.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${t===ae.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[l.jsx(Tt,{className:"w-4 h-4"}),l.jsx("span",{children:ae.label})]},ae.id)})}),l.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[h&&l.jsxs("div",{className:"flex items-center justify-center py-8",children:[l.jsx(Zs,{className:"w-6 h-6 animate-spin text-blue-600"}),l.jsx("span",{className:"ml-2 text-gray-600",children:"Loading monitoring data..."})]}),!h&&s&&l.jsxs(l.Fragment,{children:[t==="overview"&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-600",children:"System Health"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[((L=s.performanceMetrics)==null?void 0:L.healthScore)||0,"%"]})]}),l.jsx(Rg,{className:"w-8 h-8 text-blue-500"})]})}),l.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-green-600",children:"Privacy Compliance"}),l.jsx("p",{className:"text-2xl font-bold text-green-900",children:(R=s.privacyCompliance)!=null&&R.gdprCompliant?"100%":"0%"})]}),l.jsx(js,{className:"w-8 h-8 text-green-500"})]})}),l.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Error Rate"}),l.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((_=s.errorStats)==null?void 0:_.criticalErrors)||0})]}),l.jsx(ch,{className:"w-8 h-8 text-orange-500"})]})}),l.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Backup Status"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(E=s.dataBackup)!=null&&E.isEnabled?"Active":"Inactive"})]}),l.jsx(Dg,{className:"w-8 h-8 text-purple-500"})]})})]}),l.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),l.jsxs("div",{className:"flex flex-wrap gap-3",children:[l.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[l.jsx(Zs,{className:"w-4 h-4"}),l.jsx("span",{children:"Refresh Data"})]}),l.jsxs("button",{onClick:U,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[l.jsx(Dq,{className:"w-4 h-4"}),l.jsx("span",{children:"Export Data"})]})]})]})]}),t==="users"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"User Metrics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Privacy Status"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Consent Given:"}),l.jsx("span",{className:`font-medium ${(N=s.userMetrics)!=null&&N.hasConsent?"text-green-600":"text-red-600"}`,children:(T=s.userMetrics)!=null&&T.hasConsent?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Privacy Mode:"}),l.jsx("span",{className:`font-medium ${(A=s.userMetrics)!=null&&A.privacyMode?"text-green-600":"text-red-600"}`,children:(v=s.userMetrics)!=null&&v.privacyMode?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Data Retention:"}),l.jsxs("span",{className:"font-medium",children:[((B=s.userMetrics)==null?void 0:B.dataRetentionDays)||0," days"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Rate Limiting"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"User Blocked:"}),l.jsx("span",{className:`font-medium ${(ye=s.rateLimiting)!=null&&ye.isBlocked?"text-red-600":"text-green-600"}`,children:(Te=s.rateLimiting)!=null&&Te.isBlocked?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Suspicious Activity:"}),l.jsx("span",{className:`font-medium ${(ft=s.rateLimiting)!=null&&ft.isSuspicious?"text-orange-600":"text-green-600"}`,children:(Q=s.rateLimiting)!=null&&Q.isSuspicious?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Suspicious Users:"}),l.jsx("span",{className:"font-medium",children:((we=s.rateLimiting)==null?void 0:we.suspiciousUserCount)||0})]})]})]})]})]}),t==="system"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Health"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Service Status"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Firebase:"}),l.jsx("span",{className:`font-medium ${((se=s.systemHealth)==null?void 0:se.firebase)==="healthy"?"text-green-600":"text-red-600"}`,children:((Ie=s.systemHealth)==null?void 0:Ie.firebase)||"Unknown"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Firestore:"}),l.jsx("span",{className:`font-medium ${((Ae=s.systemHealth)==null?void 0:Ae.firestore)==="healthy"?"text-green-600":"text-red-600"}`,children:((j=s.systemHealth)==null?void 0:j.firestore)||"Unknown"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Offline Mode:"}),l.jsx("span",{className:`font-medium ${(W=s.systemHealth)!=null&&W.offline?"text-orange-600":"text-green-600"}`,children:(de=s.systemHealth)!=null&&de.offline?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Degradation Mode:"}),l.jsx("span",{className:`font-medium ${(me=s.systemHealth)!=null&&me.degradationMode?"text-orange-600":"text-green-600"}`,children:(Ce=s.systemHealth)!=null&&Ce.degradationMode?"Active":"Inactive"})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Data Backup"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Backup Enabled:"}),l.jsx("span",{className:`font-medium ${(ce=s.dataBackup)!=null&&ce.isEnabled?"text-green-600":"text-red-600"}`,children:(te=s.dataBackup)!=null&&te.isEnabled?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Backup Count:"}),l.jsx("span",{className:"font-medium",children:((ve=s.dataBackup)==null?void 0:ve.backupCount)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Last Backup:"}),l.jsx("span",{className:"font-medium text-xs",children:(fe=s.dataBackup)!=null&&fe.lastBackupTime?new Date(s.dataBackup.lastBackupTime).toLocaleString():"Never"})]})]})]})]})]}),t==="errors"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Error Statistics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Error Queue"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Queue Length:"}),l.jsx("span",{className:"font-medium",children:((pe=s.errorStats)==null?void 0:pe.queueLength)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Online Status:"}),l.jsx("span",{className:`font-medium ${(_e=s.errorStats)!=null&&_e.isOnline?"text-green-600":"text-red-600"}`,children:(qe=s.errorStats)!=null&&qe.isOnline?"Online":"Offline"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Critical Errors:"}),l.jsx("span",{className:"font-medium text-red-600",children:((H=s.errorStats)==null?void 0:H.criticalErrors)||0})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Errors"}),l.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:((Y=(X=s.errorStats)==null?void 0:X.recentErrors)==null?void 0:Y.length)>0?s.errorStats.recentErrors.map((ae,Tt)=>l.jsxs("div",{className:"text-xs p-2 bg-gray-50 rounded",children:[l.jsx("div",{className:"font-medium",children:ae.type}),l.jsx("div",{className:"text-gray-600",children:ae.message}),l.jsx("div",{className:"text-gray-500",children:new Date(ae.timestamp).toLocaleString()})]},Tt)):l.jsx("div",{className:"text-gray-500 text-sm",children:"No recent errors"})})]})]})]}),t==="privacy"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Privacy Compliance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Privacy Settings"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Anonymization:"}),l.jsx("span",{className:`font-medium ${(Ve=s.privacyCompliance)!=null&&Ve.anonymizationEnabled?"text-green-600":"text-red-600"}`,children:(De=s.privacyCompliance)!=null&&De.anonymizationEnabled?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Encryption:"}),l.jsx("span",{className:`font-medium ${(Re=s.privacyCompliance)!=null&&Re.encryptionEnabled?"text-green-600":"text-red-600"}`,children:(xt=s.privacyCompliance)!=null&&xt.encryptionEnabled?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Data Retention:"}),l.jsx("span",{className:`font-medium ${(Mt=s.privacyCompliance)!=null&&Mt.dataRetentionCompliant?"text-green-600":"text-red-600"}`,children:(bt=s.privacyCompliance)!=null&&bt.dataRetentionCompliant?"Compliant":"Non-compliant"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"GDPR Compliant:"}),l.jsx("span",{className:`font-medium ${(mt=s.privacyCompliance)!=null&&mt.gdprCompliant?"text-green-600":"text-red-600"}`,children:(Et=s.privacyCompliance)!=null&&Et.gdprCompliant?"Yes":"No"})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"User Consent"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Consent Valid:"}),l.jsx("span",{className:`font-medium ${(ht=s.privacyCompliance)!=null&&ht.consentValid?"text-green-600":"text-red-600"}`,children:(Pe=s.privacyCompliance)!=null&&Pe.consentValid?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Audit Events:"}),l.jsx("span",{className:"font-medium",children:((He=s.userMetrics)==null?void 0:He.auditEvents)||0})]})]})]})]})]}),t==="performance"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Metrics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Database Performance"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Queries:"}),l.jsx("span",{className:"font-medium",children:((Wt=(ln=s.performanceMetrics)==null?void 0:ln.database)==null?void 0:Wt.totalQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((On=(In=s.performanceMetrics)==null?void 0:In.database)==null?void 0:On.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Queries:"}),l.jsx("span",{className:"font-medium text-orange-600",children:((ir=(Xt=s.performanceMetrics)==null?void 0:Xt.database)==null?void 0:ir.slowQueries)||0})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Authentication Performance"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Attempts:"}),l.jsx("span",{className:"font-medium",children:((Kn=(mn=s.performanceMetrics)==null?void 0:mn.authentication)==null?void 0:Kn.totalAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((Rt=(vt=s.performanceMetrics)==null?void 0:vt.authentication)==null?void 0:Rt.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((ot=(bn=s.performanceMetrics)==null?void 0:bn.authentication)==null?void 0:ot.averageLoginTime)||0,"ms"]})]})]})]})]}),((Zt=(rt=s.performanceMetrics)==null?void 0:rt.recommendations)==null?void 0:Zt.length)>0&&l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Recommendations"}),l.jsx("div",{className:"space-y-2",children:s.performanceMetrics.recommendations.map((ae,Tt)=>l.jsxs("div",{className:`p-3 rounded-lg ${ae.type==="critical"?"bg-red-50 border border-red-200":ae.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:[l.jsx("div",{className:"font-medium text-sm",children:ae.message}),l.jsx("div",{className:"text-xs text-gray-600 mt-1",children:ae.action})]},Tt))})]})]})]})]})]})}):null};class Qq{constructor(){this.backupInterval=null,this.isBackupEnabled=!0,this.maxBackupRetries=3,this.backupRetryDelay=5e3,this.lastBackupTime=null,this.backupHistory=[]}initialize(e){if(!e){console.error("❌ DataBackupService: User ID required for initialization");return}this.userId=e,this.startAutomaticBackups(),console.log("✅ DataBackupService: Initialized for user",e)}startAutomaticBackups(){this.backupInterval&&clearInterval(this.backupInterval),this.backupInterval=setInterval(()=>{this.performBackup("scheduled")},30*60*1e3),this.performBackup("initial")}stopAutomaticBackups(){this.backupInterval&&(clearInterval(this.backupInterval),this.backupInterval=null)}async performBackup(e="manual"){if(!this.userId)return console.error("❌ DataBackupService: User ID not set"),!1;const t=`backup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=Date.now();try{console.log(`🔄 DataBackupService: Starting backup ${t} (trigger: ${e})`);const s=await this.collectUserData(),i={id:t,userId:this.userId,timestamp:new Date().toISOString(),trigger:e,dataSize:JSON.stringify(s).length,version:"1.0.0",status:"in_progress"};return await this.storeBackup(i,s),i.status="completed",i.duration=Date.now()-r,await this.updateBackupStatus(i),this.backupHistory.push(i),this.lastBackupTime=new Date,console.log(`✅ DataBackupService: Backup ${t} completed in ${i.duration}ms`),!0}catch(s){console.error(`❌ DataBackupService: Backup ${t} failed:`,s);const i={id:t,userId:this.userId,timestamp:new Date().toISOString(),trigger:e,status:"failed",error:s.message,duration:Date.now()-r};return this.backupHistory.push(i),!1}}async collectUserData(){const e={profile:null,stats:null,behavioralData:[],settings:null,backupMetadata:{collectedAt:new Date().toISOString(),version:"1.0.0"}};try{const t=Z(q,`users/${this.userId}/profile`),r=await Le(t);r.exists()&&(e.profile=r.val());const s=Z(q,`users/${this.userId}/stats`),i=await Le(s);i.exists()&&(e.stats=i.val());const o=As(kn(tr,"behavioral_cravings"),Ns("userId","==",this.userId),Sg("timestamp","desc"),zD(100)),a=await li(o);e.behavioralData=a.docs.map(h=>({id:h.id,...h.data()}));const c=Z(q,`users/${this.userId}/settings`),u=await Le(c);return u.exists()&&(e.settings=u.val()),e}catch(t){throw console.error("❌ DataBackupService: Error collecting user data:",t),t}}async storeBackup(e,t){try{const r=Z(q,`backups/${this.userId}/${e.id}`);await Ue(r,e);const s=Z(q,`backup_data/${this.userId}/${e.id}`);await Ue(s,t),console.log(`✅ DataBackupService: Backup data stored for ${e.id}`)}catch(r){throw console.error("❌ DataBackupService: Error storing backup:",r),r}}async updateBackupStatus(e){try{const t=Z(q,`backups/${this.userId}/${e.id}`);await Ue(t,e)}catch(t){console.error("❌ DataBackupService: Error updating backup status:",t)}}async restoreFromBackup(e){if(!this.userId)throw new Error("User ID not set");try{console.log(`🔄 DataBackupService: Restoring from backup ${e}`);const t=Z(q,`backup_data/${this.userId}/${e}`),r=await Le(t);if(!r.exists())throw new Error("Backup data not found");const s=r.val();if(s.profile){const i=Z(q,`users/${this.userId}/profile`);await Ue(i,s.profile)}if(s.stats){const i=Z(q,`users/${this.userId}/stats`);await Ue(i,s.stats)}if(s.settings){const i=Z(q,`users/${this.userId}/settings`);await Ue(i,s.settings)}return console.log(`✅ DataBackupService: Successfully restored from backup ${e}`),!0}catch(t){throw console.error(`❌ DataBackupService: Error restoring from backup ${e}:`,t),t}}async getBackupHistory(e=10){if(!this.userId)return[];try{const t=Z(q,`backups/${this.userId}`),r=await Le(t);return r.exists()?Object.values(r.val()).sort((i,o)=>new Date(o.timestamp)-new Date(i.timestamp)).slice(0,e):[]}catch(t){return console.error("❌ DataBackupService: Error getting backup history:",t),[]}}async cleanupOldBackups(){if(this.userId)try{const e=await this.getBackupHistory(50);if(e.length>10){const t=e.slice(10);for(const r of t){const s=Z(q,`backups/${this.userId}/${r.id}`);await Ue(s,null);const i=Z(q,`backup_data/${this.userId}/${r.id}`);await Ue(i,null)}console.log(`✅ DataBackupService: Cleaned up ${t.length} old backups`)}}catch(e){console.error("❌ DataBackupService: Error cleaning up old backups:",e)}}getBackupStatus(){return{isEnabled:this.isBackupEnabled,lastBackupTime:this.lastBackupTime,backupCount:this.backupHistory.length,nextBackupIn:this.backupInterval?"30 minutes":"disabled"}}setBackupEnabled(e){this.isBackupEnabled=e,e&&this.userId?this.startAutomaticBackups():this.stopAutomaticBackups()}async exportBackupData(e){if(!this.userId)throw new Error("User ID not set");try{const t=Z(q,`backup_data/${this.userId}/${e}`),r=await Le(t);if(!r.exists())throw new Error("Backup data not found");return{...r.val(),exportMetadata:{exportedAt:new Date().toISOString(),backupId:e,userId:this.userId,version:"1.0.0"}}}catch(t){throw console.error("❌ DataBackupService: Error exporting backup data:",t),t}}}const ZT=new Qq;class Kq{constructor(){this.isPrivacyModeEnabled=!0,this.dataRetentionDays=30,this.anonymizationEnabled=!0,this.consentRequired=!0,this.encryptionEnabled=!0,this.auditLog=[]}initialize(e){this.userId=e,this.setupPrivacyControls(),console.log("✅ PrivacyProtectionService: Initialized for user",e)}setupPrivacyControls(){this.getUserConsent()||this.requestConsent(),this.setupDataRetentionTimer(),this.setupAnonymization()}getUserConsent(){const e=localStorage.getItem(`privacy_consent_${this.userId}`);return e?JSON.parse(e):null}requestConsent(){const e={dataCollection:!0,analytics:!0,behavioralTracking:!0,dataRetention:this.dataRetentionDays,anonymization:this.anonymizationEnabled,timestamp:new Date().toISOString(),version:"1.0.0"};return localStorage.setItem(`privacy_consent_request_${this.userId}`,JSON.stringify(e)),this.logPrivacyEvent("consent_requested",{userId:this.anonymizeUserId(this.userId),timestamp:new Date().toISOString()}),e}recordConsent(e){const t={...e,grantedAt:new Date().toISOString(),userId:this.userId};localStorage.setItem(`privacy_consent_${this.userId}`,JSON.stringify(t)),this.logPrivacyEvent("consent_granted",{userId:this.anonymizeUserId(this.userId),dataCollection:t.dataCollection,analytics:t.analytics,behavioralTracking:t.behavioralTracking}),console.log("✅ PrivacyProtectionService: User consent recorded")}anonymizeUserId(e){if(!this.anonymizationEnabled)return e;let t=0;for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);t=(t<<5)-t+s,t=t&t}return`user_${Math.abs(t).toString(36)}`}anonymizeData(e,t=[]){if(!this.anonymizationEnabled)return e;const r={...e};return[...["email","name","phone","address"],...t].forEach(o=>{r[o]&&(r[o]=this.anonymizeString(r[o]))}),r}anonymizeString(e){return!e||typeof e!="string"?e:e.length<=3?"*".repeat(e.length):e.charAt(0)+"*".repeat(e.length-2)+e.charAt(e.length-1)}encryptData(e){if(!this.encryptionEnabled)return e;try{return{encrypted:!0,data:btoa(JSON.stringify(e)),timestamp:new Date().toISOString()}}catch(t){return console.error("❌ PrivacyProtectionService: Encryption failed:",t),e}}decryptData(e){if(!e.encrypted)return e;try{return JSON.parse(atob(e.data))}catch(t){return console.error("❌ PrivacyProtectionService: Decryption failed:",t),e}}sanitizeData(e){const t={...e};return["password","ssn","creditCard","bankAccount"].forEach(s=>{delete t[s]}),this.anonymizationEnabled?this.anonymizeData(t):t}setupDataRetentionTimer(){setInterval(()=>{this.cleanupExpiredData()},60*60*1e3)}async cleanupExpiredData(){try{const e=new Date;e.setDate(e.getDate()-this.dataRetentionDays),this.cleanupLocalStorage(e),this.logPrivacyEvent("data_cleanup",{userId:this.anonymizeUserId(this.userId),cutoffDate:e.toISOString(),retentionDays:this.dataRetentionDays}),console.log("✅ PrivacyProtectionService: Expired data cleaned up")}catch(e){console.error("❌ PrivacyProtectionService: Error cleaning up expired data:",e)}}cleanupLocalStorage(e){["offline_userData","offline_profileData","offline_cachedStats","behavioral_logs","session_data"].forEach(r=>{try{const s=localStorage.getItem(r);if(s){const i=JSON.parse(s);i.timestamp&&new Date(i.timestamp)<e&&(localStorage.removeItem(r),console.log(`🗑️ PrivacyProtectionService: Cleaned up expired ${r}`))}}catch(s){console.warn(`⚠️ PrivacyProtectionService: Error cleaning up ${r}:`,s)}})}setupAnonymization(){const e=console.log;console.log=(...t)=>{const r=t.map(s=>typeof s=="object"&&s!==null?this.anonymizeData(s):s);e.apply(console,r)}}logPrivacyEvent(e,t){const r={id:Date.now().toString(),eventType:e,data:this.anonymizeData(t),timestamp:new Date().toISOString(),userId:this.anonymizeUserId(this.userId)};this.auditLog.push(r),this.auditLog.length>100&&(this.auditLog=this.auditLog.slice(-100)),localStorage.setItem(`privacy_audit_${this.userId}`,JSON.stringify(this.auditLog))}getAuditLog(){return this.auditLog}async exportUserData(){if(!this.userId)throw new Error("User ID not set");try{return{profile:this.getStoredData("profile"),stats:this.getStoredData("stats"),behavioralData:this.getStoredData("behavioralData"),settings:this.getStoredData("settings"),auditLog:this.auditLog,exportMetadata:{exportedAt:new Date().toISOString(),userId:this.anonymizeUserId(this.userId),version:"1.0.0",dataRetentionDays:this.dataRetentionDays}}}catch(e){throw console.error("❌ PrivacyProtectionService: Error exporting user data:",e),e}}getStoredData(e){try{const t=localStorage.getItem(`offline_${e}`);return t?JSON.parse(t):null}catch(t){return console.warn(`⚠️ PrivacyProtectionService: Error getting ${e}:`,t),null}}async deleteAllUserData(){if(!this.userId)throw new Error("User ID not set");try{return[`privacy_consent_${this.userId}`,`privacy_consent_request_${this.userId}`,`privacy_audit_${this.userId}`,"offline_userData","offline_profileData","offline_cachedStats","behavioral_logs","session_data"].forEach(t=>{localStorage.removeItem(t)}),this.logPrivacyEvent("data_deletion",{userId:this.anonymizeUserId(this.userId),deletedAt:new Date().toISOString()}),console.log("✅ PrivacyProtectionService: All user data deleted"),!0}catch(e){throw console.error("❌ PrivacyProtectionService: Error deleting user data:",e),e}}getPrivacySettings(){return{isPrivacyModeEnabled:this.isPrivacyModeEnabled,dataRetentionDays:this.dataRetentionDays,anonymizationEnabled:this.anonymizationEnabled,consentRequired:this.consentRequired,encryptionEnabled:this.encryptionEnabled,hasConsent:!!this.getUserConsent()}}updatePrivacySettings(e){e.dataRetentionDays&&(this.dataRetentionDays=e.dataRetentionDays),typeof e.anonymizationEnabled=="boolean"&&(this.anonymizationEnabled=e.anonymizationEnabled),typeof e.encryptionEnabled=="boolean"&&(this.encryptionEnabled=e.encryptionEnabled),this.logPrivacyEvent("settings_updated",{userId:this.anonymizeUserId(this.userId),settings:this.anonymizeData(e)})}isDataCollectionAllowed(){const e=this.getUserConsent();return e&&e.dataCollection}isAnalyticsAllowed(){const e=this.getUserConsent();return e&&e.analytics}isBehavioralTrackingAllowed(){const e=this.getUserConsent();return e&&e.behavioralTracking}}const eA=new Kq;class Yq{constructor(){this.errorQueue=[],this.isOnline=navigator.onLine,this.maxRetries=3,this.retryDelay=5e3,this.errorThresholds={critical:5,warning:20,info:100},this.errorCounts={critical:0,warning:0,info:0,lastReset:Date.now()},this.setupErrorHandlers()}initialize(e){this.userId=e,this.setupNetworkListeners(),this.startErrorProcessing(),console.log("✅ ErrorLoggingService: Initialized for user",e)}setupErrorHandlers(){window.addEventListener("error",e=>{var t;this.logError("javascript_error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:(t=e.error)==null?void 0:t.stack,severity:"critical"})}),window.addEventListener("unhandledrejection",e=>{var t,r;this.logError("unhandled_promise_rejection",{reason:(t=e.reason)==null?void 0:t.toString(),stack:(r=e.reason)==null?void 0:r.stack,severity:"critical"})})}setupNetworkListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.processErrorQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1})}startErrorProcessing(){setInterval(()=>{this.processErrorQueue()},3e4),setInterval(()=>{this.resetErrorCounts()},60*60*1e3)}logError(e,t){const r={id:this.generateErrorId(),type:e,userId:this.userId,timestamp:new Date().toISOString(),severity:t.severity||"info",data:this.sanitizeErrorData(t),userAgent:navigator.userAgent,url:window.location.href,sessionId:this.getSessionId(),version:"1.0.0"};this.shouldLogError(r)&&(this.errorQueue.push(r),this.isOnline&&this.processErrorQueue())}generateErrorId(){return`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}sanitizeErrorData(e){const t={...e};return["password","token","key","secret","ssn","email"].forEach(s=>{t[s]&&(t[s]="[REDACTED]")}),Object.keys(t).forEach(s=>{typeof t[s]=="string"&&t[s].length>1e3&&(t[s]=t[s].substring(0,1e3)+"...[TRUNCATED]")}),t}shouldLogError(e){const t=e.severity,r=this.errorThresholds[t];return r?(Date.now()-this.errorCounts.lastReset>60*60*1e3&&this.resetErrorCounts(),this.errorCounts[t]<r):!0}resetErrorCounts(){this.errorCounts={critical:0,warning:0,info:0,lastReset:Date.now()}}async processErrorQueue(){if(!this.isOnline||this.errorQueue.length===0)return;const e=[...this.errorQueue];this.errorQueue=[];for(const t of e)try{await this.sendErrorToServer(t),this.errorCounts[t.severity]++}catch(r){console.error("❌ ErrorLoggingService: Failed to send error to server:",r),this.errorQueue.push(t)}}async sendErrorToServer(e){try{await Ss(kn(tr,"error_logs"),e);const t=Z(q,`error_logs/${this.userId}/${e.id}`);await Ue(t,e),console.log(`✅ ErrorLoggingService: Error ${e.id} sent to server`)}catch(t){throw console.error("❌ ErrorLoggingService: Error sending to server:",t),t}}getSessionId(){let e=sessionStorage.getItem("session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("session_id",e)),e}logCustomError(e,t,r="info",s={}){this.logError(e,{message:t,severity:r,...s})}logApiError(e,t,r,s,i={}){this.logError("api_error",{endpoint:e,method:t,status:r,response:this.sanitizeErrorData(s),requestData:this.sanitizeErrorData(i),severity:r>=500?"critical":r>=400?"warning":"info"})}logAuthError(e,t,r={}){this.logError("auth_error",{errorType:e,message:t,severity:"critical",...r})}logDatabaseError(e,t,r={}){this.logError("database_error",{operation:e,message:t.message,code:t.code,queryData:this.sanitizeErrorData(r),severity:"critical"})}logPerformanceError(e,t,r,s={}){this.logError("performance_error",{operation:e,duration:t,threshold:r,severity:"warning",...s})}async getErrorStatistics(e=24){try{const t=new Date;t.setHours(t.getHours()-e);const r=As(kn(tr,"error_logs"),Ns("userId","==",this.userId),Ns("timestamp",">=",t.toISOString()),Sg("timestamp","desc")),i=(await li(r)).docs.map(a=>a.data()),o={total:i.length,bySeverity:{critical:i.filter(a=>a.severity==="critical").length,warning:i.filter(a=>a.severity==="warning").length,info:i.filter(a=>a.severity==="info").length},byType:{},recentErrors:i.slice(0,10),timeRange:`${e} hours`};return i.forEach(a=>{o.byType[a.type]=(o.byType[a.type]||0)+1}),o}catch(t){return console.error("❌ ErrorLoggingService: Error getting statistics:",t),null}}async getRecentErrors(e=20){try{const t=As(kn(tr,"error_logs"),Ns("userId","==",this.userId),Sg("timestamp","desc"),e(e));return(await li(t)).docs.map(s=>s.data())}catch(t){return console.error("❌ ErrorLoggingService: Error getting recent errors:",t),[]}}async clearOldErrors(e=7){try{const t=new Date;t.setDate(t.getDate()-e),console.log(`🗑️ ErrorLoggingService: Would clear errors older than ${e} days`)}catch(t){console.error("❌ ErrorLoggingService: Error clearing old errors:",t)}}getErrorQueueStatus(){return{queueLength:this.errorQueue.length,isOnline:this.isOnline,errorCounts:this.errorCounts,thresholds:this.errorThresholds}}setErrorThresholds(e){this.errorThresholds={...this.errorThresholds,...e}}async exportErrorData(e=24){try{const t=await this.getRecentErrors(1e3),r=new Date;r.setHours(r.getHours()-e);const s=t.filter(i=>new Date(i.timestamp)>=r);return{errors:s,exportMetadata:{exportedAt:new Date().toISOString(),userId:this.userId,timeRange:`${e} hours`,totalErrors:s.length,version:"1.0.0"}}}catch(t){throw console.error("❌ ErrorLoggingService: Error exporting error data:",t),t}}}const tA=new Yq;class Jq{constructor(){this.serviceStatus={firebase:"unknown",firestore:"unknown",auth:"unknown",offline:!1},this.fallbackData=new Map,this.retryAttempts=new Map,this.maxRetries=3,this.retryDelay=2e3,this.degradationMode=!1,this.setupServiceMonitoring()}initialize(e){this.userId=e,this.setupFallbackData(),this.startServiceHealthChecks(),console.log("✅ GracefulDegradationService: Initialized for user",e)}setupServiceMonitoring(){window.addEventListener("online",()=>{this.serviceStatus.offline=!1,this.attemptServiceRecovery()}),window.addEventListener("offline",()=>{this.serviceStatus.offline=!0,this.enableDegradationMode()}),this.monitorFirebaseConnection()}monitorFirebaseConnection(){setInterval(async()=>{await this.checkFirebaseHealth()},3e4)}async checkFirebaseHealth(){try{const e=Z(q,"health_check");await Le(e),this.serviceStatus.firebase="healthy"}catch(e){this.serviceStatus.firebase="unhealthy",this.handleServiceFailure("firebase",e)}try{const e=As(kn(tr,"health_check"),zD(1));await li(e),this.serviceStatus.firestore="healthy"}catch(e){this.serviceStatus.firestore="unhealthy",this.handleServiceFailure("firestore",e)}}handleServiceFailure(e,t){console.warn(`⚠️ GracefulDegradationService: ${e} service failure:`,t),(e==="firebase"||e==="firestore")&&this.enableDegradationMode(),window.errorLoggingService&&window.errorLoggingService.logError("service_failure",{service:e,error:t.message,severity:"warning"})}enableDegradationMode(){this.degradationMode=!0,console.log("🔄 GracefulDegradationService: Degradation mode enabled"),this.notifyUserOfDegradation()}disableDegradationMode(){this.degradationMode=!1,console.log("✅ GracefulDegradationService: Degradation mode disabled")}notifyUserOfDegradation(){window.showQuickActionPopup&&window.showQuickActionPopup("Service Temporarily Unavailable","Some features may be limited while we restore full service. Your data is safe.","info")}setupFallbackData(){this.loadCachedData()}loadCachedData(){try{const e={profile:this.getCachedData("offline_profileData"),stats:this.getCachedData("offline_cachedStats"),userData:this.getCachedData("offline_userData")};Object.entries(e).forEach(([t,r])=>{r&&this.fallbackData.set(t,r)}),console.log("✅ GracefulDegradationService: Cached data loaded")}catch(e){console.error("❌ GracefulDegradationService: Error loading cached data:",e)}}getCachedData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.warn(`⚠️ GracefulDegradationService: Error getting cached ${e}:`,t),null}}startServiceHealthChecks(){this.checkFirebaseHealth(),setInterval(()=>{this.checkFirebaseHealth()},6e4)}async attemptServiceRecovery(){console.log("🔄 GracefulDegradationService: Attempting service recovery..."),await this.checkFirebaseHealth(),this.serviceStatus.firebase==="healthy"&&this.serviceStatus.firestore==="healthy"&&(this.disableDegradationMode(),this.syncCachedData())}async syncCachedData(){if(console.log("🔄 GracefulDegradationService: Syncing cached data..."),window.offlineManager)try{await window.offlineManager.syncOperations(),console.log("✅ GracefulDegradationService: Cached data synced")}catch(e){console.error("❌ GracefulDegradationService: Error syncing cached data:",e)}}async getDataWithFallback(e,t,r){try{if(!this.degradationMode&&this.serviceStatus.firebase==="healthy"){const i=Z(q,t),o=await Le(i);if(o.exists()){const a=o.val();return this.fallbackData.set(r,a),a}}const s=this.fallbackData.get(r);return s?(console.log(`📱 GracefulDegradationService: Using cached ${e} data`),s):this.getDefaultData(e)}catch(s){console.warn(`⚠️ GracefulDegradationService: Error getting ${e}:`,s);const i=this.fallbackData.get(r);return i||this.getDefaultData(e)}}async setDataWithFallback(e,t,r,s){try{if(!this.degradationMode&&this.serviceStatus.firebase==="healthy"){const i=Z(q,t);await Ue(i,r),console.log(`✅ GracefulDegradationService: ${e} data saved to Firebase`)}else console.log(`📱 GracefulDegradationService: ${e} data cached (offline mode)`);return this.fallbackData.set(s,r),this.cacheData(s,r),!0}catch(i){return console.warn(`⚠️ GracefulDegradationService: Error setting ${e}:`,i),this.fallbackData.set(s,r),this.cacheData(s,r),!1}}cacheData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(r){console.warn(`⚠️ GracefulDegradationService: Error caching ${e}:`,r)}}getDefaultData(e){return{profile:{heroName:"Anonymous Hero",archetype:"DETERMINED",avatar:null,quitDate:new Date().toISOString(),triggers:[],dailyPatterns:[],copingStrategies:[]},stats:{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0,experiencePoints:0},userData:{email:"",displayName:"Anonymous User",photoURL:null,lastLogin:new Date().toISOString()}}[e]||{}}getServiceStatus(){return{...this.serviceStatus,degradationMode:this.degradationMode,fallbackDataCount:this.fallbackData.size,retryAttempts:Object.fromEntries(this.retryAttempts)}}isServiceAvailable(e){return this.serviceStatus.offline?!1:this.serviceStatus[e]==="healthy"}async getUserProfile(){return this.getDataWithFallback("profile",`users/${this.userId}/profile`,"profile")}async setUserProfile(e){return this.setDataWithFallback("profile",`users/${this.userId}/profile`,e,"profile")}async getUserStats(){return this.getDataWithFallback("stats",`users/${this.userId}/stats`,"stats")}async setUserStats(e){return this.setDataWithFallback("stats",`users/${this.userId}/stats`,e,"stats")}async getBehavioralData(e=10){try{if(!this.degradationMode&&this.serviceStatus.firestore==="healthy"){const r=As(kn(tr,"behavioral_cravings"),Ns("userId","==",this.userId),e(e));return(await li(r)).docs.map(i=>({id:i.id,...i.data()}))}return(this.fallbackData.get("behavioralData")||[]).slice(0,e)}catch(t){return console.warn("⚠️ GracefulDegradationService: Error getting behavioral data:",t),this.fallbackData.get("behavioralData")||[]}}async setBehavioralData(e){try{!this.degradationMode&&this.serviceStatus.firestore==="healthy"?(await Ss(kn(tr,"behavioral_cravings"),e),console.log("✅ GracefulDegradationService: Behavioral data saved to Firestore")):console.log("📱 GracefulDegradationService: Behavioral data cached (offline mode)");const t=this.fallbackData.get("behavioralData")||[];return t.unshift(e),this.fallbackData.set("behavioralData",t.slice(0,100)),!0}catch(t){return console.warn("⚠️ GracefulDegradationService: Error setting behavioral data:",t),!1}}async forceRecovery(){console.log("🔄 GracefulDegradationService: Forcing service recovery..."),await this.checkFirebaseHealth(),await this.attemptServiceRecovery()}}const nA=new Jq;class Xq{constructor(){this.rateLimits={apiCalls:{limit:60,window:6e4},authAttempts:{limit:5,window:6e4},databaseWrites:{limit:30,window:6e4},databaseReads:{limit:100,window:6e4},behavioralLogs:{limit:50,window:36e5},stressTests:{limit:3,window:36e5},errorReports:{limit:10,window:6e4},profileUpdates:{limit:10,window:36e5}},this.userLimits=new Map,this.globalLimits=new Map,this.blockedUsers=new Set,this.suspiciousActivity=new Map,this.setupRateLimitCleanup()}initialize(e){this.userId=e,this.initializeUserLimits(),console.log("✅ RateLimitingService: Initialized for user",e)}initializeUserLimits(){if(!this.userId)return;const e={apiCalls:[],authAttempts:[],databaseWrites:[],databaseReads:[],behavioralLogs:[],stressTests:[],errorReports:[],profileUpdates:[]};this.userLimits.set(this.userId,e)}isAllowed(e,t=null){const r=t||this.userId;if(!r)return console.error("❌ RateLimitingService: User ID required for rate limiting"),!1;if(this.blockedUsers.has(r))return console.warn(`🚫 RateLimitingService: User ${r} is blocked`),!1;if(this.isSuspiciousUser(r))return console.warn(`⚠️ RateLimitingService: User ${r} has suspicious activity`),!1;const s=this.rateLimits[e];if(!s)return console.warn(`⚠️ RateLimitingService: Unknown action: ${e}`),!0;const i=this.userLimits.get(r);if(!i)return this.initializeUserLimits(),!0;const o=Date.now(),a=o-s.window;return i[e]=i[e].filter(c=>c>a),i[e].length>=s.limit?(this.recordRateLimitExceeded(e,r),!1):(i[e].push(o),this.userLimits.set(r,i),!0)}recordRateLimitExceeded(e,t){console.warn(`🚫 RateLimitingService: Rate limit exceeded for ${e} by user ${t}`),window.errorLoggingService&&window.errorLoggingService.logError("rate_limit_exceeded",{action:e,userId:t,severity:"warning"}),this.trackSuspiciousActivity(t,e)}trackSuspiciousActivity(e,t){this.suspiciousActivity.has(e)||this.suspiciousActivity.set(e,[]);const r=this.suspiciousActivity.get(e);r.push({action:t,timestamp:Date.now()}),r.length>10&&r.splice(0,r.length-10),this.suspiciousActivity.set(e,r),this.checkForBlocking(e)}checkForBlocking(e){const t=this.suspiciousActivity.get(e)||[],r=Date.now();t.filter(i=>r-i.timestamp<3e5).length>5&&this.blockUser(e,"Excessive rate limit violations")}blockUser(e,t){this.blockedUsers.add(e),console.warn(`🚫 RateLimitingService: User ${e} blocked. Reason: ${t}`),window.errorLoggingService&&window.errorLoggingService.logError("user_blocked",{userId:e,reason:t,severity:"critical"});const r=JSON.parse(localStorage.getItem("blocked_users")||"[]");r.push({userId:e,reason:t,timestamp:Date.now()}),localStorage.setItem("blocked_users",JSON.stringify(r))}unblockUser(e){this.blockedUsers.delete(e),console.log(`✅ RateLimitingService: User ${e} unblocked`);const r=JSON.parse(localStorage.getItem("blocked_users")||"[]").filter(s=>s.userId!==e);localStorage.setItem("blocked_users",JSON.stringify(r))}isSuspiciousUser(e){const t=this.suspiciousActivity.get(e)||[],r=Date.now();return t.filter(i=>r-i.timestamp<6e5).length>3}getRemainingAttempts(e,t=null){const r=t||this.userId;if(!r)return 0;const s=this.rateLimits[e];if(!s)return 0;const i=this.userLimits.get(r);if(!i)return s.limit;const a=Date.now()-s.window;return i[e]=i[e].filter(c=>c>a),Math.max(0,s.limit-i[e].length)}getTimeUntilReset(e,t=null){const r=t||this.userId;if(!r)return 0;const s=this.rateLimits[e];if(!s)return 0;const i=this.userLimits.get(r);if(!i||i[e].length===0)return 0;const a=Math.min(...i[e])+s.window;return Math.max(0,a-Date.now())}setupRateLimitCleanup(){setInterval(()=>{this.cleanupOldEntries()},5*60*1e3),this.loadBlockedUsers()}cleanupOldEntries(){const e=Date.now();this.userLimits.forEach((t,r)=>{Object.keys(t).forEach(s=>{const i=this.rateLimits[s];if(i){const o=e-i.window;t[s]=t[s].filter(a=>a>o)}})}),this.suspiciousActivity.forEach((t,r)=>{const s=t.filter(i=>e-i.timestamp<36e5);s.length===0?this.suspiciousActivity.delete(r):this.suspiciousActivity.set(r,s)})}loadBlockedUsers(){try{const e=JSON.parse(localStorage.getItem("blocked_users")||"[]"),t=Date.now();e.forEach(r=>{t-r.timestamp<24*60*60*1e3&&this.blockedUsers.add(r.userId)})}catch(e){console.error("❌ RateLimitingService: Error loading blocked users:",e)}}getRateLimitStatus(e=null){const t=e||this.userId;if(!t)return null;const r={userId:t,isBlocked:this.blockedUsers.has(t),isSuspicious:this.isSuspiciousUser(t),limits:{}};return Object.keys(this.rateLimits).forEach(s=>{r.limits[s]={remaining:this.getRemainingAttempts(s,t),resetIn:this.getTimeUntilReset(s,t),limit:this.rateLimits[s].limit,window:this.rateLimits[s].window}}),r}updateRateLimits(e){this.rateLimits={...this.rateLimits,...e},console.log("✅ RateLimitingService: Rate limits updated")}resetUserLimits(e=null){const t=e||this.userId;t&&(this.userLimits.delete(t),this.suspiciousActivity.delete(t),this.unblockUser(t),console.log(`✅ RateLimitingService: Limits reset for user ${t}`))}getSuspiciousUsers(){const e=[];return this.suspiciousActivity.forEach((t,r)=>{t.length>0&&e.push({userId:r,activityCount:t.length,lastActivity:Math.max(...t.map(s=>s.timestamp)),activities:t.slice(-5)})}),e.sort((t,r)=>r.activityCount-t.activityCount)}getBlockedUsers(){return Array.from(this.blockedUsers)}canPerformAction(e,t=null){var a;const r=t||this.userId;if(!r)return{allowed:!1,reason:"User ID required",remaining:0,resetIn:0};const s=this.isAllowed(e,r),i=this.getRemainingAttempts(e,r),o=this.getTimeUntilReset(e,r);return{allowed:s,reason:s?"Allowed":"Rate limit exceeded",remaining:i,resetIn:o,limit:((a=this.rateLimits[e])==null?void 0:a.limit)||0}}}const rA=new Xq,Zq=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=P.useState("signin"),[s,i]=P.useState(""),[o,a]=P.useState(""),[c,u]=P.useState(""),[h,f]=P.useState(!1),[m,y]=P.useState(!1),[w,S]=P.useState(""),[k,I]=P.useState(""),[x,C]=P.useState(!1);P.useEffect(()=>()=>{m&&y(!1)},[m]);const D=new vi;D.addScope("email"),D.addScope("profile"),D.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const U=()=>{i(""),a(""),u(""),S(""),I("")},L=async()=>{f(!0),y(!0),S("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:D.scopes,customParameters:D.customParameters});const T=uz(Ei,D),A=new Promise((B,ye)=>{setTimeout(()=>ye(new Error("Popup timeout - please try again")),6e4)}),v=await Promise.race([T,A]);if(v&&v.user){const B=v.user;console.log("Google sign-in successful for:",B.email,"UID:",B.uid),console.log("User display name:",B.displayName),console.log("User photo URL:",B.photoURL),await new Promise(ye=>setTimeout(ye,800)),n(B)}else throw new Error("No user data received from Google authentication")}catch(T){console.error("Google sign-in error:",T),T.code==="auth/popup-closed-by-user"?S("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):T.code==="auth/popup-blocked"?S("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):T.code==="auth/cancelled-popup-request"?S("Google sign-in was cancelled. Please try again and complete the authentication process."):T.code==="auth/account-exists-with-different-credential"?S("An account already exists with this email using a different sign-in method. Please use email/password instead."):T.message==="Popup timeout - please try again"?S("Google sign-in popup timed out. Please try again and complete the account selection quickly."):T.code==="auth/network-request-failed"?S("Network error during Google sign-in. Please check your internet connection and try again."):T.code==="auth/operation-not-allowed"?S("Google sign-in is not enabled for this app. Please contact support."):S(N(T.code))}finally{f(!1),y(!1)}},R=async T=>{T.preventDefault(),f(!0),S("");try{const v=(await EP(Ei,s,o)).user;console.log("Email sign-in successful for:",v.email),n(v)}catch(A){console.error("Email sign-in error:",A),S(N(A.code))}finally{f(!1)}},_=async T=>{if(T.preventDefault(),f(!0),S(""),o!==c){S("Passwords do not match"),f(!1);return}if(o.length<6){S("Password must be at least 6 characters long"),f(!1);return}try{const v=(await bP(Ei,s,o)).user;console.log("Email sign-up successful for:",v.email),await SB(v),n(v)}catch(A){console.error("Email sign-up error:",A),S(N(A.code))}finally{f(!1)}},E=async T=>{if(T.preventDefault(),!s){S("Please enter your email address");return}f(!0),S("");try{await _B(Ei,s),I("Password reset email sent! Check your inbox.")}catch(A){console.error("Password reset error:",A),S(N(A.code))}finally{f(!1)}},N=T=>{switch(T){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return x?l.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),l.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),l.jsxs("form",{onSubmit:E,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"email",type:"email",value:s,onChange:T=>i(T.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),w&&l.jsx("div",{className:"text-red-400 text-sm",children:w}),k&&l.jsx("div",{className:"text-green-400 text-sm",children:k}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{type:"button",onClick:()=>{C(!1),S(""),I("")},className:"flex-1 px-4 py-3 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 min-h-[44px]",children:"Back to Login"}),l.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-3 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Sending...":"Send Reset Link"})]})]})]})}):l.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),l.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),l.jsxs("div",{children:[m&&l.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[l.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),l.jsx("button",{onClick:L,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):l.jsxs(l.Fragment,{children:[l.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[l.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),l.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),l.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),l.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),l.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:m?l.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,w&&l.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[l.jsx("div",{className:"text-red-300 text-sm mb-2",children:w}),w.includes("Google sign-in")&&!m&&l.jsx("button",{onClick:L,disabled:h,className:"w-full px-3 py-3 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50 min-h-[44px]",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 flex items-center",children:l.jsx("div",{className:"w-full border-t border-gray-600"})}),l.jsx("div",{className:"relative flex justify-center text-sm",children:l.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),l.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[l.jsx("button",{onClick:()=>{r("signin"),U()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),l.jsx("button",{onClick:()=>{r("signup"),U()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&l.jsxs("form",{onSubmit:R,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"signin-email",type:"email",value:s,onChange:T=>i(T.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),l.jsx("input",{id:"signin-password",type:"password",value:o,onChange:T=>a(T.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("button",{type:"button",onClick:()=>C(!0),className:"text-sm text-blue-400 hover:text-blue-300 py-2 px-2 min-h-[44px] min-w-[44px]",children:"Forgot your password?"})}),w&&l.jsx("div",{className:"text-red-400 text-sm",children:w}),l.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&l.jsxs("form",{onSubmit:_,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"signup-email",type:"email",value:s,onChange:T=>i(T.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),l.jsx("input",{id:"signup-password",type:"password",value:o,onChange:T=>a(T.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),l.jsx("input",{id:"confirm-password",type:"password",value:c,onChange:T=>u(T.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),w&&l.jsx("div",{className:"text-red-400 text-sm",children:w}),k&&l.jsx("div",{className:"text-green-400 text-sm",children:k}),l.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Creating account...":"Create Account"})]})]})})},e8=({offlineManager:n})=>{const[e,t]=P.useState(navigator.onLine),[r,s]=P.useState(!1),[i,o]=P.useState(0),[a,c]=P.useState(!1);return P.useEffect(()=>{const u=()=>{t(!0),s(!1),console.log("🌐 Connection restored"),n&&i>0&&(c(!0),setTimeout(()=>{c(!1),o(0)},2e3))},h=()=>{t(!1),s(!0),console.log("📡 Connection lost")};window.addEventListener("online",u),window.addEventListener("offline",h),t(navigator.onLine);const f=async()=>{if(n)try{const y=await n.getQueuedActionsCount();o(y)}catch(y){console.warn("Could not get queued actions count:",y)}};f();const m=setInterval(f,5e3);return()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),clearInterval(m)}},[n,i]),e&&a?l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white p-3 text-center shadow-lg",children:l.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[l.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),l.jsxs("span",{className:"font-medium",children:["Syncing ",i," offline actions..."]})]})}):e&&!a&&i===0||e?null:l.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[l.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),l.jsxs("span",{className:"font-medium",children:["You're offline. Some features may be limited.",i>0&&` (${i} actions queued)`]}),l.jsx("button",{onClick:()=>s(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&l.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[l.jsx("p",{className:"mb-2",children:"While offline, you can:"}),l.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[l.jsx("li",{children:"• View your current stats and progress"}),l.jsx("li",{children:"• Track habits and cravings"}),l.jsx("li",{children:"• Log water intake and breathing exercises"}),l.jsx("li",{children:"• Record craving assessments and resistance"}),l.jsx("li",{children:"• Play distraction games"}),l.jsx("li",{children:"• View your profile information"})]}),l.jsxs("p",{className:"mt-2 text-yellow-200",children:["All changes will sync automatically when you're back online.",i>0&&l.jsxs("span",{className:"block mt-1 font-medium",children:["💾 ",i," action",i!==1?"s":""," queued for sync"]})]})]})]})},t8=({offlineManager:n})=>{const[e,t]=P.useState({isOnline:navigator.onLine,queuedOperations:0,failedOperations:0,syncInProgress:!1,lastSyncTime:null}),[r,s]=P.useState(!1),[i,o]=P.useState(0),[a,c]=P.useState(null);P.useEffect(()=>{if(!n||!n.progressManager)return;const S=C=>{o(C.progress),c(C.currentOperation)},k=C=>{t(D=>({...D,syncInProgress:C.status==="syncing",lastSyncTime:C.endTime||D.lastSyncTime}))};n.progressManager.addProgressCallback(S),n.progressManager.addStatusCallback(k);const I=()=>{const C=n.getStatus();t(D=>({...D,isOnline:C.isOnline,queuedOperations:C.queue.queuedOperations,failedOperations:C.queue.failedOperations,syncInProgress:C.queue.syncInProgress}))};I();const x=setInterval(I,1e3);return()=>{n&&n.progressManager&&(n.progressManager.removeProgressCallback(S),n.progressManager.removeStatusCallback(k)),clearInterval(x)}},[n]);const u=async()=>{n&&await n.retryFailedOperations()},h=async()=>{n&&await n.attemptSync()},f=S=>{if(!S)return"Never";const I=Date.now()-S,x=Math.floor(I/6e4),C=Math.floor(x/60),D=Math.floor(C/24);return D>0?`${D}d ago`:C>0?`${C}h ago`:x>0?`${x}m ago`:"Just now"},m=()=>e.isOnline?e.failedOperations>0?"text-red-600":e.queuedOperations>0?"text-blue-600":"text-green-600":"text-yellow-600",y=()=>e.isOnline?e.syncInProgress?"🔄":e.failedOperations>0?"⚠️":e.queuedOperations>0?"⏳":"✅":"📡",w=()=>e.isOnline?e.syncInProgress?"Syncing...":e.failedOperations>0?`${e.failedOperations} failed`:e.queuedOperations>0?`${e.queuedOperations} queued`:"Synced":"Offline";return n?l.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[l.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${m()}`,onClick:()=>s(!r),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:y()}),l.jsx("div",{className:"text-sm font-medium",children:w()}),e.syncInProgress&&l.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"})]}),e.syncInProgress&&l.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:l.jsx("div",{className:"bg-current h-1 rounded-full transition-all duration-300",style:{width:`${i}%`}})})]}),r&&l.jsxs("div",{className:"absolute top-16 right-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsx("h3",{className:"font-semibold text-gray-800",children:"Sync Status"}),l.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),l.jsxs("div",{className:"mb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("span",{className:`w-2 h-2 rounded-full ${e.isOnline?"bg-green-500":"bg-yellow-500"}`}),l.jsx("span",{className:"text-sm font-medium",children:e.isOnline?"Online":"Offline"})]}),l.jsxs("div",{className:"text-xs text-gray-500",children:["Last sync: ",f(e.lastSyncTime)]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Queue Status"}),l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Queued:"}),l.jsx("span",{className:"text-blue-600",children:e.queuedOperations})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Failed:"}),l.jsx("span",{className:"text-red-600",children:e.failedOperations})]})]})]}),a&&l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Current Operation"}),l.jsxs("div",{className:"text-xs text-gray-600",children:[a.type," - ",Math.round(i),"%"]})]}),l.jsxs("div",{className:"flex gap-2",children:[e.failedOperations>0&&l.jsx("button",{onClick:u,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Retry Failed"}),e.queuedOperations>0&&e.isOnline&&l.jsx("button",{onClick:h,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Sync Now"})]}),l.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:l.jsx("div",{className:"text-xs text-gray-500",children:l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Success Rate:"}),l.jsxs("span",{children:[n.getStatus().sync.successRate,"%"]})]})})})]})]}):null},n8=({sessionManager:n,authGuard:e})=>{const[t,r]=P.useState({isActive:!1,duration:0,timeUntilTimeout:0,timeUntilWarning:0}),[s,i]=P.useState(!1),[o,a]=P.useState(!1);P.useEffect(()=>{if(!n)return;const S=()=>{const I=n.getSessionInfo();r(I),a(I.timeUntilWarning<=0&&I.timeUntilTimeout>0)};S();const k=setInterval(S,1e3);return()=>clearInterval(k)},[n]);const c=S=>{if(S<=0)return"0:00";const k=Math.floor(S/60),I=S%60;return`${k}:${I.toString().padStart(2,"0")}`},u=S=>S<60?`${S}s`:S<3600?`${Math.floor(S/60)}m`:`${Math.floor(S/3600)}h ${Math.floor(S%3600/60)}m`,h=()=>t.isActive?o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600":"text-gray-500",f=()=>t.isActive?o?"⚠️":t.timeUntilTimeout<=60?"🔴":"🟢":"⏸️",m=()=>t.isActive?o?"Warning":t.timeUntilTimeout<=60?"Expiring":"Active":"Inactive",y=()=>{n&&n.extendSession()},w=async()=>{if(e)try{await e.logout()}catch(S){console.error("Logout failed:",S)}};return t.isActive?l.jsxs("div",{className:"fixed top-4 left-4 z-50",children:[l.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${h()}`,onClick:()=>i(!s),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:f()}),l.jsx("div",{className:"text-sm font-medium",children:m()}),t.timeUntilTimeout>0&&l.jsx("div",{className:"text-xs opacity-75",children:c(t.timeUntilTimeout)})]}),t.timeUntilTimeout>0&&l.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:l.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${o?"bg-yellow-500":t.timeUntilTimeout<=60?"bg-red-500":"bg-green-500"}`,style:{width:`${Math.max(0,Math.min(100,t.timeUntilTimeout/1800*100))}%`}})})]}),s&&l.jsxs("div",{className:"absolute top-16 left-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsx("h3",{className:"font-semibold text-gray-800",children:"Session Status"}),l.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Session Duration"}),l.jsx("div",{className:"text-lg font-mono text-gray-900",children:u(t.duration)})]}),t.timeUntilTimeout>0&&l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Time Until Timeout"}),l.jsx("div",{className:`text-lg font-mono ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-gray-900"}`,children:c(t.timeUntilTimeout)})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Status"}),l.jsx("div",{className:`text-sm font-medium ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600"}`,children:m()})]}),l.jsxs("div",{className:"flex gap-2",children:[o&&l.jsx("button",{onClick:y,className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Extend Session"}),l.jsx("button",{onClick:w,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Logout"})]}),e&&l.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:l.jsxs("div",{className:"text-xs text-gray-500",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Operations:"}),l.jsx("span",{children:e.getOperationStats().total})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Success Rate:"}),l.jsxs("span",{children:[e.getOperationStats().successRate,"%"]})]})]})})]})]}):null},r8=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>l.jsxs("div",{className:"p-4 sm:p-6",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),l.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your breathing session"})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:[l.jsxs("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[l.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[l.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:l.jsx("span",{className:"text-lg",children:"🫁"})}),l.jsx("div",{className:"text-white font-semibold text-sm",children:"BREATHING RATE"})]}),l.jsx("div",{className:"text-white font-bold text-sm",children:n.name}),l.jsxs("div",{className:"text-slate-400 text-xs",children:[n.inhale,"s | ",n.exhale,"s"]})]}),l.jsxs("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[l.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[l.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:l.jsx("span",{className:"text-lg",children:"⏱️"})}),l.jsx("div",{className:"text-white font-semibold text-sm",children:"DURATION"})]}),l.jsxs("div",{className:"text-white font-bold text-sm",children:[e,"min."]}),l.jsx("div",{className:"text-slate-400 text-xs",children:"Total time"})]})]}),l.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-base sm:text-lg py-3 sm:py-4 px-4 sm:px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl min-h-[44px]",children:"START EXERCISE"}),l.jsx("div",{className:"mt-4 sm:mt-6 text-center",children:l.jsx("p",{className:"text-slate-400 text-xs sm:text-sm",children:"Find a comfortable position and prepare to relax"})})]}),s8=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return l.jsxs("div",{className:"p-8",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),l.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),l.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>l.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"text-left",children:[l.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),l.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&l.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:l.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:l.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),l.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},i8=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=P.useState(n),i=2,o=10;P.useEffect(()=>{s(n)},[n]);const a=f=>{const m=parseInt(f.target.value);s(m),navigator.vibrate&&navigator.vibrate(50),console.log(`🎯 Duration picker: Selected ${m} minutes`)},c=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return l.jsxs("div",{className:"p-8",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),l.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),l.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),l.jsx("div",{className:"mb-8",children:l.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4",autoComplete:"off"})}),l.jsx("button",{onClick:c,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),l.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},o8=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=P.useState(e*60),[m,y]=P.useState("inhale"),[w,S]=P.useState(0),[k,I]=P.useState(!1),[x,C]=P.useState(.1),[D,U]=P.useState(!1),[L,R]=P.useState(!1),_=P.useRef(null),E=P.useRef(null);P.useEffect(()=>{h===0&&k&&!L&&(console.log("🎯 Exercise completed, calling onComplete"),R(!0),t())},[h,k,L,t]);const N=()=>{console.log(`⏰ Starting main timer for ${e} minutes`),E.current&&(console.log("⚠️ Timer already exists, clearing previous timer"),clearInterval(E.current)),E.current=setInterval(()=>{f(Ae=>{if(Ae<=1)return console.log(`⏰ Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(E.current),E.current=null,0;const j=Ae-1;return j%10===0&&console.log(`⏰ Main timer: ${j}s remaining`),j})},1e3),console.log("✅ Main timer started successfully")},T=()=>{console.log(`🚀 Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),_.current&&(console.log("⚠️ Animation already running, clearing previous animation"),cancelAnimationFrame(_.current));const Ae=n.inhale+n.exhale;let j=0,W=0,de="inhale";console.log(`📊 Cycle duration: ${Ae}s, starting animation loop...`);const me=()=>{if(j+=16,j>=Ae*1e3&&(console.log(`🔄 Breathing cycle completed, resetting to 0ms. Current phase: ${de}, phaseTime: ${w}`),j=0,W=0,de="inhale",y("inhale"),S(0)),j<n.inhale*1e3){de!=="inhale"&&(console.log(`🔄 Switching to INHALE phase at ${j}ms`),de="inhale",y("inhale"),S(0),W=0);const Ce=j/(n.inhale*1e3),te=.1+A(Ce)*3.9;C(te);const ve=Math.floor(Ce*n.inhale);ve!==W&&(S(ve),W=ve,console.log(`⏱️ INHALE: ${ve}/${n.inhale}s (phase: ${de}, scale: ${te.toFixed(3)})`))}else{de!=="exhale"&&(console.log(`🔄 Switching to EXHALE phase at ${j}ms`),de="exhale",y("exhale"),S(0),W=0);const Ce=(j-n.inhale*1e3)/(n.exhale*1e3),te=4-A(Ce)*3.9;C(te);const ve=Math.floor(Ce*n.exhale);ve!==W&&(S(ve),W=ve,console.log(`⏱️ EXHALE: ${ve}/${n.exhale}s (phase: ${de}, scale: ${te.toFixed(3)})`))}_.current=requestAnimationFrame(me)};me(),console.log("✅ Breathing cycle animation started successfully")},A=Ae=>Ae<.5?2*Ae*Ae:-1+(4-2*Ae)*Ae;P.useEffect(()=>(k&&(N(),T()),()=>{k&&Ie()}),[k]);const v=Ae=>{const j=Math.floor(Ae/60),W=Ae%60;return`${j.toString().padStart(2,"0")}:${W.toString().padStart(2,"0")}`},B=()=>w,ye=()=>m==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",Te=()=>m==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",ft=()=>{console.log("🔄 User clicked close button, showing confirmation popup"),U(!0)},Q=()=>{console.log("🚪 User confirmed leaving exercise, cleaning up..."),Ie(),s?s():r()},we=()=>{U(!1)},se=()=>{if(k){console.log("⚠️ Exercise already active, ignoring start request");return}console.log(`🎬 Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(`📊 Initial state - isActive: ${k}, progress: ${x}, currentPhase: ${m}`),C(.1),y("inhale"),S(0),f(e*60),I(!0),console.log("✅ isActive set to true, starting timers..."),setTimeout(()=>{console.log("🚀 Starting main timer and breathing cycle..."),N(),T()},0)},Ie=()=>{console.log("🧹 Cleaning up breathing exercise resources"),_.current&&(cancelAnimationFrame(_.current),_.current=null),E.current&&(clearInterval(E.current),E.current=null),I(!1),f(0),C(.1),y("inhale"),S(0)};return P.useEffect(()=>{k||(console.log("🎬 Component mounted, starting breathing exercise automatically"),se())},[]),l.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[l.jsxs("div",{className:"flex items-center justify-between p-6",children:[l.jsx("button",{onClick:ft,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50 min-h-[44px] min-w-[44px]",title:"End breathing exercise",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"text-white text-2xl font-mono",children:v(h)})}),l.jsx("div",{className:"w-11"})," "]}),l.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[l.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),l.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${ye()} rounded-full shadow-2xl`,style:{transform:`scale(${x})`,transition:"none",boxShadow:`0 0 ${Math.max(x*40,10)}px ${Math.max(x*15,5)}px ${m==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),l.jsxs("div",{className:"p-6 text-center",children:[l.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:l.jsx("span",{className:"text-white text-lg leading-tight",children:Te()})}),l.jsxs("div",{className:"text-slate-400 text-sm",children:[B(),"/",m==="inhale"?n.inhale:n.exhale,"s"]})]}),l.jsx("div",{className:"px-6 pb-6",children:l.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:l.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),D&&l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600/50 max-w-sm",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),l.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{onClick:Q,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Leave"}),l.jsx("button",{onClick:we,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Stay"})]})]})})})]})},a8=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=P.useState("setup"),[o,a]=P.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[c,u]=P.useState(4),[h,f]=P.useState(!1);P.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const m=x=>{a(x),i("setup")},y=x=>{u(x),i("setup")},w=()=>{f(!0),i("exercise")},S=()=>{f(!1),i("setup"),r&&r(),e()},k=()=>{s==="exercise"&&h||e()},I=()=>{console.log("🚪 User leaving breathing exercise via close button"),e(),t&&t()};return n?l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:k}),l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-900 border-slate-700/50 max-w-md sm:max-w-2xl mx-auto w-full",children:[!(s==="exercise"&&h)&&l.jsx("button",{onClick:k,className:"absolute top-4 left-4 z-10 w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors min-h-[44px] min-w-[44px]",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&l.jsx(r8,{selectedRate:o,duration:c,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:w}),s==="rate"&&l.jsx(s8,{selectedRate:o,onSelect:m,onBack:()=>i("setup")}),s==="duration"&&l.jsx(i8,{selectedDuration:c,onSelect:y,onBack:()=>i("setup")}),s==="exercise"&&l.jsx(o8,{rate:o,duration:c,onComplete:S,onClose:k,onLeave:I})]})})]}):null},l8=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=P.useState(null),[i,o]=P.useState(!0),[a,c]=P.useState(30);P.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content bg-slate-800 max-w-4xl",children:l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(kg,{className:"w-6 h-6 text-blue-400"}),l.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("select",{value:a,onChange:h=>c(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-3 rounded border border-slate-600 min-h-[44px]",children:[l.jsx("option",{value:7,children:"Last 7 days"}),l.jsx("option",{value:30,children:"Last 30 days"}),l.jsx("option",{value:90,children:"Last 90 days"})]}),l.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"✕"})]})]}),l.jsx("div",{className:"p-6",children:i?l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Lq,{className:"w-5 h-5 text-green-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),l.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Mq,{className:"w-5 h-5 text-blue-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),l.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(m2,{className:"w-5 h-5 text-purple-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),l.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("span",{className:"text-orange-400",children:"💧"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),l.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),l.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),l.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),l.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>l.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:"🫁 Breathing Exercises"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:"🧘‍♀️ Meditation Sessions"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:"🚶‍♂️ Physical Activities"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:"💧 Hydration Goals Met"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>l.jsxs("div",{className:"flex justify-between",children:[l.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),l.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),l.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>l.jsxs("p",{className:"text-gray-300 text-sm",children:["• ",h]},f)),r.insights.length===0&&l.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"📡 System Status"}),l.jsxs("div",{className:"space-y-2 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),l.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),l.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),l.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),m=document.createElement("a");m.href=f,m.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,m.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Export Analytics Data"})]})]}):l.jsxs("div",{className:"text-center py-8",children:[l.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),l.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})})})}):l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 p-6",children:[l.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),l.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),l.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Close"})]})})})};console.log("🧪 FirestoreBuddyService import check:",!!sc);console.log("🧪 FirestoreBuddyService type:",typeof sc);console.log("🧪 FirestoreBuddyService constructor:",sc==null?void 0:sc.name);const qs=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},Vf=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},Ff=n=>n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e",Bs=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},c8=({onComplete:n,authUser:e,pwaInstallAvailable:t,promptInstall:r})=>{const[s,i]=P.useState(1),[o,a]=P.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[c,u]=P.useState(!1),[h,f]=P.useState(!1),[m,y]=P.useState(null),[w,S]=P.useState(null),k=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:js},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:SS},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:p2},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:g2}],I=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],x=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],C=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],D=()=>{console.log("Calculating stats with userData:",o);let A=40;o.vapePodsPerWeek<=1?A+=5:o.vapePodsPerWeek<=3?A+=15:o.vapePodsPerWeek<=5?A+=25:o.vapePodsPerWeek<=7?A+=35:A+=40;const v=o.nicotineStrength||"",B=parseInt(v.replace("mg",""))||0;B<=5?A+=0:B<=11?A+=10:B<=20?A+=20:A+=25,o.dailyPatterns.includes("Throughout the day")?A+=20:o.dailyPatterns.length>2?A+=10:A+=0,A=Math.min(A,100);let ye=25;o.confidence>=9?ye+=35:o.confidence>=7?ye+=25:o.confidence>=4?ye+=15:ye+=0,o.quitAttempts==="first"?ye+=15:parseInt(o.quitAttempts)<=3?ye+=10:ye+=5,o.copingStrategies.length>=3?ye+=15:o.copingStrategies.length>=1?ye+=10:ye+=0,ye=Math.min(ye,80);let Te=35;Te+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[o.archetype]||0,o.confidence>=8?Te+=25:o.confidence>=5?Te+=15:Te+=0,o.quitAttempts==="first"?Te+=10:parseInt(o.quitAttempts)<=3?Te+=5:Te+=15,Te=Math.min(Te,90);let Q=15;o.triggers.length<=2?Q+=15:o.triggers.length<=4?Q+=10:Q+=5;const we=o.triggers.includes("Drinking alcohol"),se=o.triggers.includes("Social situations");return we&&se?Q+=0:o.triggers.length>3?Q+=5:Q+=10,o.copingStrategies.length>=3?Q+=25:o.copingStrategies.length>=1?Q+=15:Q+=0,o.dailyPatterns.includes("Throughout the day")?Q+=0:o.dailyPatterns.length>2?Q+=5:Q+=10,Q=Math.min(Q,60),{addictionLevel:A,mentalStrength:ye,motivation:Te,triggerDefense:Q}},U=A=>{const v=A.target.files[0];if(v){y(v);const B=new FileReader;B.onload=ye=>S(ye.target.result),B.readAsDataURL(v)}},L=async()=>{if(m){f(!0);try{const A=document.createElement("canvas"),v=A.getContext("2d"),B=new Image;B.onload=()=>{A.width=200,A.height=200,v.filter="contrast(1.2) saturate(1.3) brightness(1.1)",v.drawImage(B,0,0,200,200),v.globalCompositeOperation="overlay",v.fillStyle="rgba(255, 200, 200, 0.1)",v.fillRect(0,0,200,200);const ye=A.toDataURL("image/png"),Te={...o,avatar:ye};a(Te),T(Te,3),f(!1)},B.src=w}catch(A){console.error("Photo processing failed:",A);const v=Vf(o.avatarSeed);a(B=>({...B,avatar:v})),f(!1)}}},R=()=>{u(!0);const A=Math.random().toString(36).substring(7);(async()=>{try{const B=qs(A),ye={...o,avatarSeed:A,avatar:B};a(ye),T(ye,3)}catch{const ye=Vf(A),Te={...o,avatarSeed:A,avatar:ye};a(Te),T(Te,3)}})(),setTimeout(()=>u(!1),500)},_=async()=>{if(s<10)await T(o,s),i(s+1);else try{console.log("Completing onboarding with userData:",o);const A=D();console.log("Calculated stats:",A);const v={...o,stats:{...A,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await T(v,10),console.log("Final user data:",v),n(v)}catch(A){console.error("Error completing onboarding:",A);const B={...o,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await T(B,10)}catch(ye){console.error("Failed to save fallback data to Firebase:",ye)}console.log("Using fallback stats:",B),n(B)}},E=()=>{s>1&&i(s-1)},N=()=>{switch(s){case 1:return o.heroName.trim().length>0;case 2:return o.archetype!=="";case 3:return o.avatar!==null;case 4:return o.triggers.length>0;case 5:return o.dailyPatterns.length>0;case 6:return o.copingStrategies.length>0;case 7:return o.vapePodsPerWeek>0;case 8:return o.nicotineStrength!=="";case 9:return o.quitAttempts!=="";case 10:return o.confidence>0;default:return!1}},T=async(A,v)=>{if(e)try{const{ref:B,set:ye}=await Me(()=>import("./index.esm-f161132b.js"),[]),Te=B(q,`users/${e.uid}/onboarding`);await ye(B(q,`users/${e.uid}/onboarding/step${v}`),{...A,stepNumber:v,timestamp:Date.now()}),await ye(B(q,`users/${e.uid}/onboarding/progress`),{currentStep:v,completedSteps:Array.from({length:v},(ft,Q)=>Q+1),lastUpdated:Date.now()}),console.log(`Step ${v} saved to Firebase successfully`)}catch(B){console.error(`Error saving step ${v} to Firebase:`,B)}};return P.useEffect(()=>{if(!o.avatar){const A=qs(o.avatarSeed);a(v=>({...v,avatar:A}))}},[]),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[t&&l.jsxs("div",{className:"mb-4 p-3 rounded-lg border border-blue-600 bg-blue-900/40 text-blue-100 flex items-center justify-between",children:[l.jsx("div",{className:"mr-3",children:"Install QuitArena for a faster, full-screen experience."}),l.jsx("button",{onClick:r,className:"px-4 py-3 rounded-md bg-blue-600 hover:bg-blue-500 text-white text-sm font-semibold min-h-[44px] min-w-[44px]",children:"Install"})]}),l.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(A=>l.jsxs("div",{className:"flex items-center flex-shrink-0",children:[l.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${A<=s?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:A<s?"✓":A}),A<10&&l.jsx("div",{className:`w-4 h-1 mx-1 ${A<s?"bg-blue-500":"bg-slate-600"}`})]},A))}),s===1&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(Pq,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),l.jsx("input",{type:"text",value:o.heroName,onChange:A=>{const v={...o,heroName:A.target.value};a(v),A.target.value.trim().length>0&&T(v,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",autoComplete:"name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s===2&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(js,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),l.jsx("div",{className:"space-y-3 mb-6",children:k.map(A=>{const v=A.icon;return l.jsx("button",{onClick:()=>{const B={...o,archetype:A.id};a(B),T(B,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.archetype===A.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-10 h-10 ${A.color} rounded-lg flex items-center justify-center`,children:l.jsx(v,{className:"w-5 h-5 text-white"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-white font-semibold",children:A.name}),l.jsx("p",{className:"text-gray-400 text-sm",children:A.description})]})]})},A.id)})})]}),s===3&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(x2,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:o.avatar?l.jsx("img",{src:o.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{a(A=>({...A,avatar:Vf(A.avatarSeed)}))}}):l.jsx("div",{className:"w-full h-full flex items-center justify-center",children:l.jsx(Zs,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),l.jsx("input",{type:"file",accept:"image/*",onChange:U,className:"hidden",id:"photo-upload",autoComplete:"photo"}),l.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),w&&l.jsx("div",{className:"mb-4",children:l.jsx("button",{onClick:L,disabled:h,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:h?l.jsxs(l.Fragment,{children:[l.jsx(Zs,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):l.jsx(l.Fragment,{children:"✨ Convert to Anime"})})}),l.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),l.jsx("button",{onClick:R,disabled:c,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:c?l.jsxs(l.Fragment,{children:[l.jsx(Zs,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):l.jsxs(l.Fragment,{children:[l.jsx(Zs,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),l.jsx("button",{onClick:()=>{const A=Vf(o.avatarSeed),v={...o,avatar:A};a(v),T(v,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),s===4&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:"🎯"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:I.map(A=>l.jsx("button",{onClick:()=>{const v={...o,triggers:o.triggers.includes(A)?o.triggers.filter(B=>B!==A):[...o.triggers,A]};a(v),T(v,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.triggers.includes(A)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.triggers.includes(A)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.triggers.includes(A)&&l.jsx("span",{className:"text-white text-sm",children:"✓"})}),l.jsx("span",{className:"text-white font-semibold",children:A})]})},A))})]}),s===5&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:"📅"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:x.map(A=>l.jsx("button",{onClick:()=>{const v={...o,dailyPatterns:o.dailyPatterns.includes(A)?o.dailyPatterns.filter(B=>B!==A):[...o.dailyPatterns,A]};a(v),T(v,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.dailyPatterns.includes(A)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.dailyPatterns.includes(A)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.dailyPatterns.includes(A)&&l.jsx("span",{className:"text-white text-sm",children:"✓"})}),l.jsx("span",{className:"text-white font-semibold",children:A})]})},A))})]}),s===6&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:"🛡️"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:C.map(A=>l.jsx("button",{onClick:()=>{const v={...o,copingStrategies:o.copingStrategies.includes(A)?o.copingStrategies.filter(B=>B!==A):[...o.copingStrategies,A]};a(v),T(v,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.copingStrategies.includes(A)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.copingStrategies.includes(A)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.copingStrategies.includes(A)&&l.jsx("span",{className:"text-white text-sm",children:"✓"})}),l.jsx("span",{className:"text-white font-semibold",children:A})]})},A))})]}),s===7&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:"🚬"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:o.vapePodsPerWeek,onChange:A=>{const v={...o,vapePodsPerWeek:parseFloat(A.target.value)||0};a(v),v.vapePodsPerWeek>0&&T(v,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select pods per week"}),l.jsx("option",{value:"0.5",children:"0.5 pods"}),l.jsx("option",{value:"1",children:"1 pod"}),l.jsx("option",{value:"2",children:"2 pods"}),l.jsx("option",{value:"3",children:"3 pods"}),l.jsx("option",{value:"4",children:"4 pods"}),l.jsx("option",{value:"5",children:"5 pods"}),l.jsx("option",{value:"6",children:"6 pods"}),l.jsx("option",{value:"7",children:"7 pods"}),l.jsx("option",{value:"8",children:"8+ pods"})]})})]}),s===8&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:"⚡"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:o.nicotineStrength,onChange:A=>{const v={...o,nicotineStrength:A.target.value};a(v),v.nicotineStrength&&T(v,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select nicotine strength"}),l.jsx("option",{value:"3mg",children:"3mg"}),l.jsx("option",{value:"6mg",children:"6mg"}),l.jsx("option",{value:"12mg",children:"12mg"}),l.jsx("option",{value:"18mg",children:"18mg"}),l.jsx("option",{value:"20mg",children:"20mg"}),l.jsx("option",{value:"50mg",children:"50mg"})]})})]}),s===9&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:"📚"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:o.quitAttempts,onChange:A=>{const v={...o,quitAttempts:A.target.value};a(v),v.quitAttempts&&T(v,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select option"}),l.jsx("option",{value:"first",children:"This is my first attempt"}),l.jsx("option",{value:"1",children:"Once before"}),l.jsx("option",{value:"2",children:"Twice before"}),l.jsx("option",{value:"3",children:"3-5 times"}),l.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),s===10&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:"🎯"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),l.jsx("input",{type:"range",min:"1",max:"10",value:o.confidence,onChange:A=>{const v={...o,confidence:parseInt(A.target.value)};a(v),T(v,10)},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${Ff(o.confidence)} 0%, ${Ff(o.confidence)} ${o.confidence/10*100}%, #475569 ${o.confidence/10*100}%, #475569 100%)`},autoComplete:"off"}),l.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),l.jsxs("div",{className:"text-center mt-4",children:[l.jsx("span",{className:"font-bold text-4xl",style:{color:Ff(o.confidence)},children:o.confidence}),l.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),l.jsx("div",{className:"text-center mt-2",children:l.jsx("span",{className:"text-sm font-medium",style:{color:Ff(o.confidence)},children:o.confidence<=3?"You can do this! 💪":o.confidence<=6?"Good confidence! 🎯":o.confidence<=9?"Great confidence! 🚀":"Excellent confidence! 🌟"})})]})]}),l.jsxs("div",{className:"flex justify-between",children:[s>1&&l.jsx("button",{onClick:E,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),l.jsxs("button",{onClick:_,disabled:!N(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${N()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[s===10?"Start Journey":"Next",l.jsx(Cq,{className:"w-4 h-4"})]})]})]})})},sA={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:js},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:SS},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:p2},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:g2}},u8={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},iA={WEEK_WARRIOR:{name:"Week Warrior",icon:m2,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:w2,description:"30 days clean"},LEGEND:{name:"Legend",icon:_2,description:"90 days clean"}},d8=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",h8=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Your body's dependence level - decreases with clean time, increases with relapses",impacts:["What decreases it:","• Clean time: -2 points per week","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),l.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),l.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>l.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[l.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),l.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300 min-h-[44px]",children:"Got it"})]})})]}):null},Uf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return l.jsxs("div",{className:"mb-0.5 sm:mb-1",children:[l.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&l.jsx("button",{onClick:()=>i(s),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{fontSize:"4px"},title:`Learn about ${n}`,children:"i"})]}),l.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),l.jsx("div",{className:"stat-bar-interactive w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:l.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},oA=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=P.useState(!1),[a,c]=P.useState(null),[u,h]=P.useState([]),[f,m]=P.useState({});if(P.useEffect(()=>{let L=!1;return(async()=>{try{if(n&&n.uid)if(n.specialFeatures)L||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),m({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),m(n.specialFeatures.categories||{})):(h([]),m({})));else{const _=await k(n);L||(Array.isArray(_)?(h(_),m({})):_&&_.features?(h(_.features),m(_.categories||{})):(h([]),m({})))}else L||(h([]),m({}))}catch(_){console.error("❌ TradingCard: Error loading Special Features:",_),L||(h([]),m({}))}})(),()=>{L=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),l.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),l.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const y=sA[n.archetype];if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(sA)),l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsxs("div",{children:[l.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),l.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const w=u8[d8(n.stats.streakDays)],S=y.icon;async function k(L){if(L!=null&&L.isRealBuddy){try{const{ref:v,get:B}=await Me(()=>import("./index.esm-f161132b.js"),[]),ye=v(q,`users/${L.uid}/stats`),Te=await B(ye);if(Te.exists()){const we=Te.val();if(we.specialFeatures&&Array.isArray(we.specialFeatures))return we.specialFeatures}const ft=v(q,`users/${L.uid}/specialFeatures`),Q=await B(ft);if(Q.exists())return Q.val()}catch(v){console.warn("⚠️ TradingCard: Could not load centralized Special Features for buddy:",v.message)}return["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let R=null;if(L.uid)try{const{ref:v,get:B}=await Me(()=>import("./index.esm-f161132b.js"),[]),ye=v(q,`users/${L.uid}/specialFeatures`),Te=await B(ye);Te.exists()&&(R=Te.val())}catch(v){console.error("Error fetching special features from Firebase:",v)}if(!R){const v=`specialFeatures_${L.heroName||L.id||"default"}`,B=localStorage.getItem(v);B&&(R=JSON.parse(B))}if(R){if(Array.isArray(R))return R;if(R&&R.features)return R}const _=[],E={};for(L.triggers&&L.triggers.length>0&&L.triggers.forEach(v=>{let B="";switch(v){case"Stress/anxiety":B="Stress Vaper";break;case"Social situations":B="Social Vaper";break;case"Boredom":B="Boredom Fighter";break;case"After meals":B="Habit Former";break;case"Drinking alcohol":B="Party Animal";break;case"Work breaks":B="Work Breaker";break;case"Driving":B="Driving Vaper";break;default:B="Trigger Aware"}B&&!_.includes(B)&&(_.push(B),E[B]="triggers")}),L.dailyPatterns&&L.dailyPatterns.length>0&&L.dailyPatterns.forEach(v=>{let B="";switch(v){case"Morning routine":B="Morning Struggler";break;case"Evening wind-down":B="Night Owl";break;case"Throughout the day":B="All-Day Warrior";break;default:B="Routine Builder"}B&&!_.includes(B)&&(_.push(B),E[B]="dailyPatterns")}),L.copingStrategies&&L.copingStrategies.length>0&&(L.copingStrategies.includes("Nothing - this is new to me")?(_.push("First Timer"),E["First Timer"]="copingStrategies"):L.copingStrategies.length>2?(_.push("Veteran Quitter"),E["Veteran Quitter"]="copingStrategies"):(_.push("Cold Turkey"),E["Cold Turkey"]="copingStrategies"));_.length<4;){const v=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],B=v[Math.floor(Math.random()*v.length)];_.includes(B.name)||(_.push(B.name),E[B.name]=B.category)}const N=_.slice(0,4),T={};N.forEach(v=>{T[v]=E[v]||"copingStrategies"});const A={features:N,categories:T};if(L.uid)try{const{ref:v,set:B}=await Me(()=>import("./index.esm-f161132b.js"),[]),ye=v(q,`users/${L.uid}/specialFeatures`);await B(ye,A),console.log("Special features with categories saved to Firebase successfully")}catch(v){console.error("Error saving special features to Firebase:",v);const B=`specialFeatures_${L.heroName||L.id||"default"}`;localStorage.setItem(B,JSON.stringify(A))}else{const v=`specialFeatures_${L.heroName||L.id||"default"}`;localStorage.setItem(v,JSON.stringify(N))}return N}const I=n.stats.addictionLevel||50,x=n.stats.mentalStrength||50,C=n.stats.motivation||50,D=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const U=L=>{c(L),o(!0)};return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:`touch-card relative w-72 sm:w-80 min-h-[480px] sm:min-h-[520px] rounded-xl ${w.color} border-4 ${w.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 mx-auto`,children:[l.jsxs("div",{className:"text-center mb-3",children:[l.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),l.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:y.name})]}),l.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?l.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):l.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:l.jsx(S,{className:"w-12 h-12 text-white"})})}),l.jsxs("div",{className:"mb-2 sm:mb-3",children:[l.jsx(Uf,{label:"Addiction",value:I,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:U}),l.jsx(Uf,{label:"Mental Strength",value:x,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:U}),l.jsx(Uf,{label:"Motivation",value:C,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:U}),l.jsx(Uf,{label:"Trigger Defense",value:D,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:U})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),l.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((L,R)=>{const _=f[L]||"copingStrategies",E=N=>{switch(N){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return l.jsx("div",{className:`px-2 py-1 ${E(_)} text-white text-xs rounded-full font-medium`,title:`${L} (${_})`,children:L},R)})})]}),l.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-2 sm:left-3 right-2 sm:right-3 bg-black/30 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 backdrop-blur-sm",children:[l.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[l.jsx("span",{className:"text-gray-300",children:"Streak:"}),l.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const L=n.stats.streakDays;return`${L} day${L===1?"":"s"}`})(),n.stats.streakDays>0&&l.jsx("span",{className:"text-xs",children:"🔥"})]})]}),l.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[l.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),l.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,l.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&l.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((L,R)=>{var E,N;const _=((E=iA[L])==null?void 0:E.icon)||_2;return l.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(N=iA[L])==null?void 0:N.description,children:l.jsx(_,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},R)}),n.achievements.length>4&&l.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),l.jsx(h8,{isOpen:i,onClose:()=>o(!1),statType:a})]})},f8=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:y2},{id:"craving-support",label:"Craving Support",icon:js},{id:"profile",label:"Profile",icon:x2},{id:"settings",label:"Explore",icon:v2}];return l.jsx(l.Fragment,{children:l.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:l.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,c=n===o.id;return l.jsxs("button",{onClick:()=>e(o.id),className:`tab-interactive flex flex-col items-center min-h-[44px] min-w-[44px] justify-center ${c?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[l.jsx(a,{className:"w-5 h-5"}),l.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},m8=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:c,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),l.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),l.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[h,f]=P.useState(!1),[m,y]=P.useState(null),[w,S]=P.useState(null);P.useEffect(()=>{const j=()=>{const W=document.querySelector(".battle-cards-container");W&&(window.innerWidth<1024?(W.style.flexDirection="column",W.style.gap="1rem"):(W.style.flexDirection="row",W.style.gap="3rem"))};return j(),window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]),P.useEffect(()=>{w&&n&&(async()=>{if(w&&n)try{console.log("🔄 App: Refreshing stats on page load for user:",n.uid),await w.refreshAllStats(),console.log("✅ App: Stats refreshed on page load")}catch(W){console.error("❌ App: Error refreshing stats on page load:",W)}})()},[w,n]);const k=async()=>{m&&await m.handleAchievementShare()},I=async j=>{if((j==null?void 0:j.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!j.quitDate||new Date(j.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),j.lastRelapseDate){const de=new Date(j.lastRelapseDate),me=new Date("2025-09-18T13:56:46.584Z");j.quitDate=de>me?j.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 3 quit date set to ${j.quitDate} (considering relapse: ${j.lastRelapseDate})`)}else j.quitDate="2025-09-18T13:56:46.584Z";if((j==null?void 0:j.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!j.quitDate||new Date(j.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),j.lastRelapseDate){const de=new Date(j.lastRelapseDate),me=new Date("2025-09-18T13:56:46.584Z");j.quitDate=de>me?j.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 2 quit date set to ${j.quitDate} (considering relapse: ${j.lastRelapseDate})`)}else j.quitDate="2025-09-18T13:56:46.584Z";let W={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(j!=null&&j.isRealBuddy){if(j.stats&&Object.assign(W,j.stats),j.quitDate){const de=new Date(j.quitDate),me=Bs(de);W.streakDays=me.value,W.streakUnit=me.unit,W.streakDisplayText=me.displayText}try{const{ref:de,get:me}=await Me(()=>import("./index.esm-f161132b.js"),[]),Ce=de(q,`users/${j.uid}/cravings`),ce=await me(Ce);let te=0;ce.exists()&&(ce.forEach(ve=>{ve.val().outcome==="resisted"&&te++}),W.cravingsResisted=te)}catch{console.log("⚠️ Arena: Could not read buddy cravings, using default"),W.cravingsResisted=0}return W}if(!(j!=null&&j.uid)){const de=localStorage.getItem("quitCoachRelapseDate");if(de){const ce=new Date(de),ve=new Date().getTime()-ce.getTime(),fe=Math.floor(ve/(1e3*3600*24));W.streakDays=fe,W.streakUnit="days",W.streakDisplayText=`${fe} day${fe===1?"":"s"}`}else{const ce=j.quitDate?new Date(j.quitDate):new Date,te=Bs(ce);W.streakDays=te.value,W.streakUnit=te.unit,W.streakDisplayText=te.displayText}const me=parseInt(localStorage.getItem("cravingWins")||0);W.cravingsResisted=me,new Date().toDateString();let Ce=0;for(let ce=0;ce<7;ce++){const te=new Date;te.setDate(te.getDate()-ce);const ve=te.toDateString(),fe=localStorage.getItem(`water_${j.uid}_${ve}`);if(fe&&parseInt(fe)>0)Ce++;else break}return Ce>=3&&(W.mentalStrength=Math.min(80,(W.mentalStrength||50)+1)),W}try{const{ref:de,get:me}=await Me(()=>import("./index.esm-f161132b.js"),[]),Ce=de(q,`users/${j.uid}/cravings`);try{const pe=await me(Ce);let _e=0,qe=0;if(pe.exists()){const Y=pe.val();pe.forEach(Ve=>{const De=Ve.val();De.outcome==="resisted"?_e++:De.outcome==="relapsed"&&qe++})}W.cravingsResisted=_e;const H=de(q,`users/${j.uid}/profile/cravingsResisted`),X=await me(H);if(X.exists()){const Y=X.val();console.log(`🔍 Arena: Profile cravingsResisted field value: ${Y}`),W.cravingsResisted=Math.max(_e,Y)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const _e=de(q,`users/${j.uid}/profile/cravingsResisted`),qe=await me(_e);W.cravingsResisted=qe.exists()?qe.val():0}let ce=0;const te=de(q,`users/${j.uid}/profile/relapseDate`),ve=await me(te);if(ve.exists()){const pe=ve.val(),_e=new Date(pe),H=new Date().getTime()-_e.getTime();ce=Math.floor(H/(1e3*3600*24))}else{const pe=j.quitDate?new Date(j.quitDate):new Date,_e=Bs(pe);ce=_e.value,W.streakUnit=_e.unit,W.streakDisplayText=_e.displayText,console.log(`🔍 Arena: Calculated streak from quit date: ${_e.displayText} (quit: ${pe.toISOString()})`),console.log(`🔍 Arena: Setting streak fields - streakDays: ${ce}, streakUnit: ${W.streakUnit}, streakDisplayText: ${W.streakDisplayText}`)}W.streakDays=ce;let fe=0;for(let pe=0;pe<7;pe++){const _e=new Date;_e.setDate(_e.getDate()-pe);const qe=_e.toDateString(),H=de(q,`users/${j.uid}/profile/daily/${qe}/water`),X=await me(H);if(X.exists()&&X.val()>0)fe++;else break}fe>=3&&(W.mentalStrength=Math.min(80,(W.mentalStrength||50)+1))}catch(de){console.error("Error fetching profile data from Firebase:",de);const me=localStorage.getItem("quitCoachRelapseDate");if(me){const te=new Date(me),fe=new Date().getTime()-te.getTime(),pe=Math.floor(fe/(1e3*3600*24));W.streakDays=pe,W.streakUnit="days",W.streakDisplayText=`${pe} day${pe===1?"":"s"}`}else{const te=j.quitDate?new Date(j.quitDate):new Date,ve=Bs(te);W.streakDays=ve.value,W.streakUnit=ve.unit,W.streakDisplayText=ve.displayText}const Ce=parseInt(localStorage.getItem("cravingWins")||0);W.cravingsResisted=Ce,new Date().toDateString();let ce=0;for(let te=0;te<7;te++){const ve=new Date;ve.setDate(ve.getDate()-te);const fe=ve.toDateString(),pe=localStorage.getItem(`water_${j.uid}_${fe}`);if(pe&&parseInt(pe)>0)ce++;else break}ce>=3&&(W.mentalStrength=Math.min(80,(W.mentalStrength||50)+1))}if(j!=null&&j.uid&&!(j!=null&&j.isRealBuddy))try{const{ref:de,get:me}=await Me(()=>import("./index.esm-f161132b.js"),[]),Ce=Date.now();await new Promise(te=>setTimeout(te,800));const ce=await me(de(q,`users/${j.uid}/stats`));if(ce.exists()){const te=ce.val();Object.assign(W,te)}else Object.assign(W,j.stats),console.log("🔄 Arena: Using user.stats as fallback:",W);if(m){await m.updateAddictionFromCleanTime();const te=await me(de(q,`users/${j.uid}/stats`));if(te.exists()){const ve=te.val();if(Object.assign(W,ve),j.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||j.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(`🔄 Arena: Using Firebase stats directly for ${j.uid} - no client-side calculation`),W}}}catch(de){console.error("Error reading/updating stats from Firebase:",de),Object.assign(W,j.stats)}return W},[x,C]=P.useState(()=>{const j={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{...j,...n.stats}:j}),[D,U]=P.useState(()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0}));P.useEffect(()=>{e&&Object.keys(e).length>0&&C(e)},[e]);const[L,R]=P.useState({streakDisplayText:null,streakDays:0,streakUnit:"hours"}),[_,E]=P.useState({}),N=async()=>{if(n&&window.centralizedStatService)try{const j=await window.centralizedStatService.getCurrentStats();return E(j),j}catch(j){return console.warn("🔄 Arena: Could not fetch latest stats from CentralizedStatService:",j),null}return null};P.useEffect(()=>{N();const j=setInterval(N,3e4);return()=>clearInterval(j)},[n]),P.useEffect(()=>{typeof window<"u"&&(window.refreshArenaStats=N,window.setLatestUserStats=E)},[n]),P.useEffect(()=>{if(!(n!=null&&n.uid))return;let j=!0;return(async()=>{await(async()=>{if(j)try{const Ce=new ty(q,n.uid);await Ce.initialize(),j&&y(Ce)}catch(Ce){console.error("Error initializing StatManager:",Ce)}})(),await(async()=>{if(j){if(n&&j){const Ce=await I(n);j&&C(Ce)}t&&t.uid&&j&&console.log(`🔄 Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{j=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),P.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(`🚫 Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let j=!0;const de=(async()=>{try{const{ref:me,onValue:Ce}=await Me(()=>import("./index.esm-f161132b.js"),[]),ce=me(q,`users/${t.uid}/stats`),te=Ce(ce,pe=>{if(j&&pe.exists()){const _e=pe.val();if(_e.streakDisplayText&&_e.streakUnit){const qe={streakDays:_e.streakDays||0,streakUnit:_e.streakUnit,streakDisplayText:_e.streakDisplayText};R(qe)}else{let qe=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(qe){const H=Bs(new Date(qe)),X={streakDays:H.value,streakUnit:H.unit,streakDisplayText:H.displayText};R(X),_e.streakDays=H.value,_e.streakUnit=H.unit,_e.streakDisplayText=H.displayText}else _e.streakUnit="hours",_e.streakDisplayText="0 hours"}U(qe=>({...qe,..._e}))}},pe=>{pe.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",pe)}),ve=me(q,`users/${t.uid}/profile`),fe=Ce(ve,async pe=>{if(j&&pe.exists()){const _e=pe.val(),qe=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(!(qe==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||qe==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")){if(D&&D.addictionLevel!==50){let H={...D};if(_e.quitDate&&_e.quitDate!==t.quitDate){const X=new Date(_e.quitDate),Y=Bs(X);H.streakDays=Y.value,H.streakUnit=Y.unit,H.streakDisplayText=Y.displayText}else if(_e.lastRelapseDate||_e.relapseDate){const X=new Date(_e.lastRelapseDate||_e.relapseDate),Y=Bs(X);H.streakDays=Y.value,H.streakUnit=Y.unit,H.streakDisplayText=Y.displayText,R({streakDays:Y.value,streakUnit:Y.unit,streakDisplayText:Y.displayText})}else if(t!=null&&t.finalQuitDate||a!=null&&a.finalQuitDate){const X=new Date((t==null?void 0:t.finalQuitDate)||(a==null?void 0:a.finalQuitDate)),Y=Bs(X);H.streakDays=Y.value,H.streakUnit=Y.unit,H.streakDisplayText=Y.displayText,R({streakDays:Y.value,streakUnit:Y.unit,streakDisplayText:Y.displayText})}U(X=>({...X,...H,...L}))}}}},pe=>{pe.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",pe)});return()=>{te(),fe()}}catch(me){console.error("Error setting up buddy stats listeners:",me)}})();return()=>{j=!1,de.then(me=>{me&&typeof me=="function"&&me()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]),P.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;const j=setInterval(()=>{const W=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(!W)return;const de=Bs(new Date(W));R({streakDays:de.value,streakUnit:de.unit,streakDisplayText:de.displayText}),U(me=>({...me,streakDays:de.value,streakUnit:de.unit,streakDisplayText:de.displayText}))},60*1e3);return()=>clearInterval(j)},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.lastRelapseDate,a==null?void 0:a.originalQuitDate,a==null?void 0:a.lastActivity]);const T=async()=>{if(n){const j=await I(n);C(j)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const j=await I(t);U(W=>(console.log("🔄 Arena: Preserving locally calculated streak during stats calculation:",L),{...W,...j,...L}))}};P.useEffect(()=>{if(!(n!=null&&n.uid))return;const j=setInterval(T,3e4);return()=>clearInterval(j)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),P.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||T())},[t==null?void 0:t.uid]),P.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||T())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),P.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log("🔄 Arena: Loading buddy data for user:",n.uid),c(I,U,R))},[n==null?void 0:n.uid,a,i,u,R]),P.useEffect(()=>{const j=()=>{console.log("🌐 Internet connection restored")},W=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",j),window.addEventListener("offline",W),()=>{window.removeEventListener("online",j),window.removeEventListener("offline",W)}},[]);const A=j=>{if(!j||!j.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const W=j.stats.mentalStrength||50,de=j.stats.motivation||50,me=j.stats.triggerDefense||30,Ce=j.stats.addictionLevel||50;return W*1.5+de*1+me*1.2-Ce*1},v=A({...n,stats:x}),B=A({...t,stats:D}),ye=typeof v=="number"&&!isNaN(v)?v:0,Te=typeof B=="number"&&!isNaN(B)?B:0,ft=ye>Te?"WINNING":ye===Te?"TIED":"LOSING",Q=()=>{if(ft==="WINNING")return null;if(!x||!D)return console.warn("Stats not available for recommendations calculation"),[];const j=Te-ye+1,W=[],de=(x==null?void 0:x.mentalStrength)||50,me=(x==null?void 0:x.motivation)||50,Ce=(x==null?void 0:x.triggerDefense)||30,ce=(x==null?void 0:x.addictionLevel)||50,te=(D==null?void 0:D.mentalStrength)||50,ve=(D==null?void 0:D.motivation)||50;D!=null&&D.triggerDefense;const fe=(D==null?void 0:D.addictionLevel)||50,pe=te-de,_e=ve-me,qe=ce-fe,H=[{name:"Mental Strength",multiplier:1.5,gap:pe,current:de,max:100},{name:"Trigger Defense",multiplier:1.2,gap:_e,current:Ce,max:100},{name:"Motivation",multiplier:1,gap:_e,current:me,max:100},{name:"Addiction",multiplier:1,gap:qe,current:ce,min:0,isReduction:!0}];if(H.sort((X,Y)=>X.multiplier!==Y.multiplier?Y.multiplier-X.multiplier:Math.abs(Y.gap)-Math.abs(X.gap)),H.forEach(X=>{if(X.isReduction){const Y=Math.min(X.current-X.min,50),Ve=Y*X.multiplier;Ve>0&&W.push({stat:X.name,change:Y,action:we(Y),priority:Ve,canWin:Ve>=j,isReduction:!0,efficiency:X.multiplier,gap:X.gap})}else{const Y=Math.min(X.max-X.current,50),Ve=Y*X.multiplier;Ve>0&&W.push({stat:X.name,change:Y,action:se(X.name,Y),priority:Ve,canWin:Ve>=j,efficiency:X.multiplier,gap:X.gap})}}),W.sort((X,Y)=>Y.priority-X.priority),W.length>0&&!W.some(X=>X.canWin)){const X=Ie(W,j);X&&W.unshift(X)}return W.slice(0,3)},we=j=>j>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":j>=20?"Reduce nicotine intake significantly, avoid high-risk situations":j>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",se=(j,W)=>{switch(j){case"Mental Strength":return W>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":W>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return W>=30?"Log progress daily, share achievements weekly":W>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return W>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":W>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},Ie=(j,W)=>{let de=0;const me=[];for(const Ce of j){if(de>=W)break;const ce=W-de,te=Math.min(Ce.priority,ce);te>0&&(me.push({stat:Ce.stat,change:Math.ceil(te/Ce.efficiency),contribution:te}),de+=te)}return me.length>0?{stat:"Combination Strategy",change:Math.ceil(W),action:`Focus on: ${me.map(Ce=>`${Ce.stat} (+${Ce.change})`).join(", ")}`,priority:de,canWin:de>=W,isCombination:!0,strategy:me}:null},Ae=Q()||[];return l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:[l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsx("div",{className:"text-center mb-6",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4",children:[l.jsxs("div",{className:`inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 rounded-full font-bold text-sm sm:text-lg shadow-xl ${ft==="WINNING"?"bg-green-600":ft==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[ft==="WINNING"?l.jsx(w2,{className:"w-5 h-5 mr-2"}):ft==="TIED"?l.jsx(js,{className:"w-5 h-5 mr-2"}):l.jsx("span",{className:"mr-2",children:"📉"}),"You are ",ft]}),l.jsx("button",{onClick:()=>f(!0),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center shadow-lg",style:{fontSize:"4px"},title:"Battle Algorithm Info",children:l.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"i"})}),l.jsx("button",{onClick:T,className:"touch-interactive ripple-effect w-11 h-11 sm:w-12 sm:h-12 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center shadow-lg min-h-[44px] min-w-[44px]",title:"Refresh Stats",children:l.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"🔄"})}),l.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 p-2 rounded",children:[l.jsxs("div",{children:["User Stats: ",JSON.stringify(x)]}),l.jsxs("div",{children:["Base Stats: ",JSON.stringify(n==null?void 0:n.stats)]})]}),l.jsx("button",{onClick:T,className:"mt-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Refresh Stats"}),l.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy matching test triggered...");try{await autoMatchUsers(),console.log("✅ Manual buddy matching completed")}catch(j){console.error("❌ Manual buddy matching failed:",j)}},className:"mt-2 ml-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔗 Test Matching"}),l.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy reload test triggered...");try{setBuddyLoadAttempted(!1),setRealBuddy(null),await c(I,U,R),console.log("✅ Manual buddy reload completed")}catch(j){console.error("❌ Manual buddy reload failed:",j)}},className:"mt-2 ml-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors min-h-[44px]",children:"👥 Reload Buddy"}),l.jsx("button",{onClick:async()=>{console.log("🧪 Resetting matching system...");try{const j=firestoreBuddyServiceRef.current||firestoreBuddyService;if(j){const{getDocs:W,deleteDoc:de,doc:me}=await Me(()=>import("./index.esm-27af3a4d.js"),[]),ce=(await W(j.buddyPairsCollection)).docs.map(qe=>de(me(tr,"buddyPairs",qe.id)));await Promise.all(ce);const ve=(await W(j.matchingPoolCollection)).docs.map(qe=>de(me(tr,"matchingPool",qe.id)));await Promise.all(ve);const{ref:fe,remove:pe}=await Me(()=>import("./index.esm-f161132b.js"),[]),_e=["5uSH8SA6y4eZ7jkoLEZCRJZmTGW2","KB67Yg17rkZmCa8UV1N5xIUWoK12","o4mW4BmLWOOVBybTrYcvGJ4nimA3"];for(const qe of _e)try{await pe(fe(q,`users/${qe}/buddyInfo`))}catch{console.log("Could not remove buddy info for:",qe)}console.log("✅ Matching system reset completed"),setRealBuddy(null),setBuddyLoadAttempted(!1)}}catch(j){console.error("❌ Reset failed:",j)}},className:"mt-2 ml-2 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Reset Matching"})]})}),l.jsxs("div",{className:"battle-cards-container flex flex-col lg:flex-row items-center justify-center gap-4 lg:gap-12 mb-8 w-full",children:[l.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!n||!x)return console.log("🎯 TradingCard: Missing data, not rendering user card"),l.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsx("div",{className:"animate-pulse",children:"Loading User..."})});const j=_&&Object.keys(_).length>0?{...n.stats,..._}:e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,...x};return l.jsx(oA,{user:{...n,stats:j},showComparison:!1,nemesisUser:t},`user-${n.uid}-${n.lastRelapseRefresh||Date.now()}`)})()}),l.jsxs("div",{className:"vs-section flex flex-row lg:flex-col items-center justify-center space-x-4 lg:space-x-0 space-y-0 lg:space-y-4 flex-shrink-0",children:[l.jsx("div",{className:"vs-icon w-16 h-16 lg:w-24 lg:h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:l.jsx(jq,{className:"w-8 h-8 lg:w-12 lg:h-12 text-white"})}),l.jsx("div",{className:"bg-red-600 px-4 py-2 lg:px-8 lg:py-3 rounded-full",children:l.jsx("p",{className:"vs-text text-white font-bold text-lg lg:text-2xl",children:"VS"})})]}),l.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!t||!D)return console.log("🎯 TradingCard: Missing data, not rendering nemesis card"),l.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsx("div",{className:"animate-pulse",children:"Loading Nemesis..."})});const j={...t,stats:{...t.stats,...D}};return L.streakDisplayText&&(j.stats.streakDisplayText=L.streakDisplayText,j.stats.streakDays=L.streakDays,j.stats.streakUnit=L.streakUnit),l.jsx(oA,{user:j,isNemesis:!0,showComparison:!1,nemesisUser:n},`buddy-${t.uid}-${n.lastRelapseRefresh||Date.now()}`)})()})]}),ft==="LOSING"&&Ae&&Ae.length>0&&l.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-4 sm:p-6 border border-slate-700",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),l.jsx("div",{className:"space-y-4",children:Ae.slice(0,3).map((j,W)=>l.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3 sm:p-4 border-l-4 border-blue-500",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:j.isReduction?l.jsxs(l.Fragment,{children:["🎯 Reduce your ",j.stat," by ",j.change," points!"]}):j.isCombination?l.jsxs(l.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",j.change," total points!"]}):j.isMajor?l.jsxs(l.Fragment,{children:["🎯 Major improvement needed: ",j.change," total points!"]}):l.jsxs(l.Fragment,{children:["🎯 Increase your ",j.stat," by ",j.change," points!"]})}),l.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",j.action]})]}),l.jsxs("div",{className:`font-bold text-xl sm:text-2xl sm:ml-4 ${j.isReduction?"text-green-400":j.isCombination?"text-purple-400":j.isMajor?"text-orange-400":"text-blue-400"}`,children:[j.isReduction?"-":"+",j.change]})]})},W))}),l.jsx("div",{className:"text-center mt-4",children:l.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),h&&l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>f(!1)}),l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600 p-6",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg text-sm transition-colors min-h-[44px] min-w-[44px]",title:"Share achievement for Motivation bonus",children:"📤 Share"}),l.jsx("button",{onClick:()=>f(!1),className:"modal-close-enhanced text-gray-400 hover:text-white text-2xl w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"×"})]})]}),l.jsxs("div",{className:"space-y-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),l.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),l.jsxs("p",{className:"text-green-400 font-mono",children:["(",x.mentalStrength||50," × 1.5) + (",x.motivation||50," × 1.0) + (",x.triggerDefense||30," × 1.2) - (",x.addictionLevel||50," × 1.0) = ",v.toFixed(1)]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),l.jsxs("p",{className:"text-red-400 font-mono",children:["(",D.mentalStrength||50," × 1.5) + (",D.motivation||50," × 1.0) + (",D.triggerDefense||30," × 1.2) - (",D.addictionLevel||50," × 1.0) = ",B.toFixed(1)]})]}),l.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:l.jsxs("p",{className:"text-gray-300 text-xs",children:[l.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",l.jsx("br",{}),l.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",l.jsx("br",{}),l.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",l.jsx("br",{}),l.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})]})},g8=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content bg-slate-800 border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-3xl",children:i()})}),l.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),l.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),l.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})]})},p8=({gameType:n,onClose:e})=>{const[t,r]=P.useState(0),{modalRef:s,classes:i}=xS(e,{threshold:100,velocity:.5,enabled:!0}),o=()=>{const c=P.useRef(null),[u,h]=P.useState([{x:12,y:12}]),[f,m]=P.useState({x:1,y:0}),[y,w]=P.useState({x:1,y:0}),[S,k]=P.useState({x:15,y:15}),[I,x]=P.useState(!1),[C,D]=P.useState(0),[U,L]=P.useState(1),R={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},_={1:5,2:5,3:10};return P.useEffect(()=>{const E=N=>{if(I){N.preventDefault(),h([{x:12,y:12}]),m({x:1,y:0}),w({x:1,y:0}),k({x:15,y:15}),x(!1),D(0),L(1);return}switch(N.key){case"ArrowUp":N.preventDefault(),f.y!==1&&w({x:0,y:-1});break;case"ArrowDown":N.preventDefault(),f.y!==-1&&w({x:0,y:1});break;case"ArrowLeft":N.preventDefault(),f.x!==1&&w({x:-1,y:0});break;case"ArrowRight":N.preventDefault(),f.x!==-1&&w({x:1,y:0});break}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[f,I]),P.useEffect(()=>{if(I)return;const E=setInterval(()=>{h(N=>{const T={x:N[0].x+f.x,y:N[0].y+f.y};if(T.x<0&&(T.x=24),T.x>=25&&(T.x=0),T.y<0&&(T.y=24),T.y>=25&&(T.y=0),N.slice(0,-1).some(ye=>ye.x===T.x&&ye.y===T.y))return x(!0),N;const v=T.x===S.x&&T.y===S.y;let B;return v?(D(ye=>ye+_[U]),k({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),B=[T,...N]):B=[T,...N.slice(0,-1)],(y.x!==f.x||y.y!==f.y)&&setTimeout(()=>{m(y)},0),B})},R[U]);return()=>clearInterval(E)},[f,y,S,I]),P.useEffect(()=>{const E=c.current;if(!E)return;const N=E.getContext("2d"),T=15,A=25;N.fillStyle="#1f2937",N.fillRect(0,0,375,375),N.strokeStyle="#374151",N.lineWidth=1;for(let v=0;v<=A;v++)N.beginPath(),N.moveTo(v*T,0),N.lineTo(v*T,375),N.stroke(),N.beginPath(),N.moveTo(0,v*T),N.lineTo(375,v*T),N.stroke();u.forEach((v,B)=>{B===0?N.fillStyle="#fbbf24":N.fillStyle="#10b981",N.fillRect(v.x*T+1,v.y*T+1,T-2,T-2)}),N.fillStyle="#ef4444",N.fillRect(S.x*T+2,S.y*T+2,T-4,T-4)},[u,S]),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"mb-4",children:l.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[l.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(E=>l.jsxs("button",{onClick:()=>L(E),className:`
                  px-4 py-3 text-sm font-mono border-2 border-green-500 transition-all min-h-[44px]
                  ${U===E?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[l.jsxs("div",{children:["Level ",E]}),l.jsxs("div",{className:"text-xs mt-1",children:[E===1&&"Normal",E===2&&"Fast",E===3&&"Insane"]})]},E))]})}),l.jsx("canvas",{ref:c,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),l.jsxs("div",{className:"mt-4",children:[l.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",C," | Level: ",U]}),I&&l.jsxs("div",{className:"mt-2",children:[l.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),l.jsx("button",{onClick:()=>{h([{x:12,y:12}]),m({x:1,y:0}),w({x:1,y:0}),k({x:15,y:15}),x(!1),D(0),L(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Restart Game"})]})]})]})},a=()=>{try{return n==="snake"?l.jsx(o,{}):l.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(c){return console.error("Error rendering game:",c),l.jsxs("div",{className:"text-center text-red-600",children:[l.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),l.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),l.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Reload Game"})]})}};return l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:s,className:`modal-content bg-white max-w-4xl ${i}`,role:"dialog","aria-modal":"true","aria-labelledby":"game-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4 p-4",children:[l.jsx("h3",{id:"game-modal-title",className:"text-xl font-bold text-gray-800",children:"🐍 Snake Game"}),l.jsx("button",{onClick:e,className:"modal-close-button","aria-label":"Close game modal",children:"×"})]}),l.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center relative mx-4",children:a()}),l.jsxs("div",{className:"p-4",children:[l.jsx("div",{className:"flex justify-center items-center gap-4 mb-4",children:l.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:["Score: ",t]})}),l.jsx("div",{className:"modal-actions",children:l.jsx("button",{onClick:e,className:"modal-button modal-button-primary",children:"Close Game"})})]})]})]})})})},y8=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,c]=P.useState(!1),[u,h]=P.useState(null),[f,m]=P.useState(!1),[y,w]=P.useState({title:"",message:"",type:"info"}),[S,k]=P.useState(null),[I,x]=P.useState(!1),[C,D]=P.useState(0),[U,L]=P.useState(!1),[R,_]=P.useState(!1),[E,N]=P.useState(1),[T,A]=P.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[v,B]=P.useState({resisted:0,relapses:0}),[ye,Te]=P.useState(0),[ft,Q]=P.useState(!1),[we,se]=P.useState(""),Ie=(H,X,Y="info")=>{console.log("🔄 showQuickActionPopup called:",{title:H,message:X,type:Y}),w({title:H,message:X,type:Y}),m(!0),console.log("✅ showQuickActionPopup: Popup data set and showCustomPopup set to true")};yA.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=Ie),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),P.useEffect(()=>n!=null&&n.uid?(D(0),(async()=>{try{const De=new ty(q,n.uid);await De.initialize(),k(De)}catch(De){console.error("Error initializing StatManager:",De)}})(),(async()=>{try{const De=new Date().toDateString(),{ref:Re,get:xt}=await Me(()=>import("./index.esm-f161132b.js"),[]);try{const Mt=Re(q,`users/${n.uid}/profile/dailyCravingLogs/${De}`),bt=await xt(Mt);if(bt.exists()){const mt=bt.val();Te(mt.count||0)}else Te(0)}catch{const bt=`cravingLogs_${n.uid}_${De}`,mt=localStorage.getItem(bt);if(mt){const Et=JSON.parse(mt);Te(Et.count||0)}else Te(0)}}catch(De){console.error("Error loading daily craving logs:",De),Te(0)}})(),(async()=>{try{const{ref:De,get:Re,onValue:xt,query:Mt,orderByChild:bt,startAt:mt,endAt:Et,set:ht}=await Me(()=>import("./index.esm-f161132b.js"),[]),Pe=new Date,He=new Date(Pe.getTime()-7*24*60*60*1e3),ln=He.toDateString(),Wt=Pe.toDateString();try{const rt=De(q,`users/${n.uid}/profile/cravingStats`),Zt=await Re(rt);if(Zt.exists()){const ae=Zt.val();if(ae.lastUpdated&&new Date(ae.lastUpdated)>He){B(ae);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:In,get:On,query:Xt,orderByChild:ir,startAt:mn,endAt:Kn}=await Me(()=>import("./index.esm-f161132b.js"),[]),vt=In(q,`users/${n.uid}/cravings`),Rt=Xt(vt,ir("date"),mn(ln),Kn(Wt));try{const rt=await On(Rt);let Zt=0,ae=0;if(console.log(`🔍 Weekly Stats: Checking cravings for ${ln} to ${Wt}`),console.log(`🔍 Weekly Stats: Cravings snapshot exists: ${rt.exists()}`),rt.exists()){const Gt=rt.val();console.log("🔍 Weekly Stats: Raw cravings data:",Gt),rt.forEach(ns=>{const Yn=ns.val();console.log("🔍 Weekly Stats: Individual craving:",Yn),Yn.outcome==="resisted"?Zt++:Yn.outcome==="relapsed"&&ae++})}console.log(`🔍 Weekly Stats: Calculated - resisted: ${Zt}, relapses: ${ae}`);const Tt={resisted:Zt,relapses:ae,lastUpdated:Pe.toISOString()};B(Tt);try{const Gt=De(q,`users/${n.uid}/profile/cravingStats`);await ht(Gt,Tt)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Tt))}catch{console.log("Could not query cravings, using localStorage fallback");const Zt=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');B(Zt)}const bn=De(q,`users/${n.uid}/profile/cravingStats`);return xt(bn,rt=>{rt.exists()&&B(rt.val())})}catch(De){console.error("Error loading weekly stats:",De);const Re=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');B(Re)}})(),(async()=>{try{const{ref:De,get:Re,onValue:xt}=await Me(()=>import("./index.esm-f161132b.js"),[]),Mt=new Date().toDateString(),bt=De(q,`users/${n.uid}/profile/daily/${Mt}/water`),mt=await Re(bt);if(mt.exists())D(mt.val()||0);else{const ht=parseInt(localStorage.getItem(`water_${n.uid}_${Mt}`)||0);D(ht)}return xt(bt,ht=>{ht.exists()&&D(ht.val()||0)})}catch(De){console.error("Error loading daily water from Firebase:",De);const Re=new Date().toDateString(),xt=parseInt(localStorage.getItem(`water_${n.uid}_${Re}`)||0);D(xt)}})(),()=>{D(0),x(!1),B({resisted:0,relapses:0}),_(!1),N(1),A({strength:5,mood:"",context:"",outcome:""}),Te(0),Q(!1),se("")}):void 0,[n==null?void 0:n.uid]);const Ae=()=>{h("snake"),c(!0)},j=()=>{h(null),c(!1)},W=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const H=Math.min(C+1,6);D(H);const X=new Date().toDateString();if(S){if(await S.handleHydrationUpdate(H),o)try{const Re=await S.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:H,targetGlasses:6,currentStreak:Re}),console.log("✅ Hydration also logged to Firestore for analytics")}catch(Re){console.warn("⚠️ Could not log hydration to Firestore:",Re.message),await ce("hydration",{glassesConsumed:H,targetGlasses:6,currentStreak:await S.checkHydrationStreak()})}else await ce("hydration",{glassesConsumed:H,targetGlasses:6,currentStreak:await S.checkHydrationStreak()});H===6&&C===5&&await S.checkHydrationStreak()>=3&&(await S.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:Y,set:Ve}=await Me(()=>import("./index.esm-f161132b.js"),[]),De=Y(q,`users/${n.uid}/profile/daily/${X}/water`);await Ve(De,H),localStorage.setItem(`water_${n.uid}_${X}`,H.toString()),console.log("Water intake updated:",H)}catch(H){console.error("Error updating water intake:",H);const X=Math.min(C+1,6);D(X);const Y=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${Y}`,X.toString())}},de=()=>{A({strength:5,mood:"",context:"",outcome:""}),N(1),_(!0)},me=()=>{E<4&&N(E+1)},Ce=()=>{E>1&&N(E-1)},ce=async(H,X)=>{if(!window.offlineManager||!(authUser!=null&&authUser.uid))return!1;const Y={...X,userId:authUser.uid,timestamp:Date.now()};return await window.offlineManager.handleOfflineBehavioralLog(H,Y)},te=async H=>{let X,Y,Ve;try{Ve=new Date().toISOString();const De=new Date().toDateString(),Re=new Date;X={...T,outcome:H,timestamp:Ve,date:De,timeOfDay:Re.getHours()<12?"morning":Re.getHours()<17?"afternoon":"evening",dayOfWeek:Re.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((Re.getDate()+new Date(Re.getFullYear(),0,1).getDay())/7),month:Re.toLocaleDateString("en-US",{month:"long"}),year:Re.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:H==="resisted",relapsed:H==="relapsed",logged:H==="logged",usedPractices:H==="resistance_practices"}};const xt=new Date().toDateString(),Mt=ye+1;Te(Mt),Y={resisted:v.resisted,relapses:v.relapses,lastUpdated:Ve};let bt=!1;if(Mt<=2&&S)try{const Rt=await S.handleCravingLogged();Rt&&Rt.applied&&(bt=!0,console.log("✅ Awareness bonus awarded for craving tracking"))}catch(Rt){console.warn("⚠️ Could not award awareness bonus:",Rt)}if(H==="resisted"){if(Y.resisted=v.resisted+1,S){console.log("🔄 Detailed Craving: Calling StatManager.handleCravingResistance()...");const Rt=await S.handleCravingResistance();console.log("🔄 Detailed Craving: StatManager.handleCravingResistance() result:",Rt)}window.centralizedStatService&&(console.log("🔄 Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleCravingResisted(),console.log("✅ Detailed Craving: Stats updated via CentralizedStatService"))}else if(H==="relapsed"){if(Y.relapses=v.relapses+1,S){console.log("🔄 Detailed Craving: Calling StatManager.handleRelapse()...");const Rt=await S.handleRelapse();console.log("🔄 Detailed Craving: StatManager.handleRelapse() result:",Rt)}window.centralizedStatService&&(console.log("🔄 Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Detailed Craving: Stats updated via CentralizedStatService"))}const{ref:mt,set:Et,push:ht,get:Pe}=await Me(()=>import("./index.esm-f161132b.js"),[]),He=mt(q,`users/${n.uid}/profile/cravingStats`);await Et(He,Y);const ln=mt(q,`users/${n.uid}/cravings`),Wt=ht(ln);if(await Et(Wt,X),o)try{await o.logCraving(n.uid,{outcome:H,strength:T.strength,duration:T.duration,context:"detailed_assessment",triggers:T.triggers||[],mood:T.mood,stressLevel:T.stressLevel,copingStrategiesUsed:T.copingStrategies||[],location:T.location,socialSituation:T.socialSituation}),console.log("✅ Craving also logged to Firestore for analytics")}catch(Rt){console.warn("⚠️ Could not log craving to Firestore:",Rt.message),ce&&await ce("craving",{outcome:H,strength:T.strength,duration:T.duration,context:"detailed_assessment",triggers:T.triggers||[],mood:T.mood,stressLevel:T.stressLevel,copingStrategiesUsed:T.copingStrategies||[],location:T.location,socialSituation:T.socialSituation})}const In=mt(q,`users/${n.uid}/profile/cravingHistory/${xt}`),On=await Pe(In);let Xt=On.exists()?On.val():[];Xt.push({...X,id:Wt.key,timestamp:Ve}),Xt.length>30&&(Xt=Xt.slice(-30)),await Et(In,Xt),console.log(`📅 Daily history updated for ${xt}:`,Xt.length,"records");const ir=Re.toISOString().substring(0,7),mn=mt(q,`users/${n.uid}/profile/cravingTrends/${ir}`),Kn=await Pe(mn);let vt=Kn.exists()?Kn.val():[];vt.push({...X,id:Wt.key,timestamp:Ve}),vt.length>365&&(vt=vt.slice(-365)),await Et(mn,vt),console.log(`📊 Monthly trends updated for ${ir}:`,vt.length,"records"),B(Y),w(H==="resisted"?{title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}:H==="relapsed"?{title:"🌟 New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your awareness and tracking skills are improving with each experience. Keep going!`,type:"success"}:{title:"📝 Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"}),m(!0),_(!1),N(1)}catch(De){if(console.error("Error saving craving assessment:",De),X){const Re=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Re.push(X),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Re))}if(Y){const Re=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');Re.resisted=Y.resisted,Re.relapses=Y.relapses,Re.lastUpdated=Ve,localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Re))}w(H==="resisted"?{title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:H==="relapsed"?{title:"🌟 New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:{title:"📝 Progress Recorded",message:"Your progress has been recorded locally and will sync when the connection is restored.",type:"info"}),m(!0),_(!1),N(1)}},ve=async()=>{try{const H=new Date().toISOString(),X=new Date().toDateString();let Y=null;const{ref:Ve,set:De,push:Re,get:xt}=await Me(()=>import("./index.esm-f161132b.js"),[]);if(n&&n.uid){const mt=Ve(q,`users/${n.uid}/cravings`),Et=Re(mt);await De(Et,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:H,date:X});const ht=Ve(q,`users/${n.uid}/profile/cravingStats`),Pe={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:H};if(await De(ht,Pe),B(Pe),window.centralizedStatService){console.log("🔄 Quick Resistance: Using CentralizedStatService...");const He=await window.centralizedStatService.getCurrentStats(),ln=(He==null?void 0:He.mentalStrengthCravingsApplied)||0;console.log("🔄 Quick Resistance: Current mental strength bonus before processing:",ln);const Wt=await window.centralizedStatService.handleCravingResisted();if(console.log("✅ Quick Resistance: Stats updated via CentralizedStatService"),Wt&&Wt.applied){const In=Wt.cravingsApplied||0,On=Math.max(0,3-In);console.log("🔄 Quick Resistance: Bonus applied, remaining:",On),On>0?Ie("Craving Resisted! 💪",`Great job! You earned +1 mental strength point. You can still earn ${On} more today.`,"success"):Ie("Craving Resisted! 💪","Excellent! You've reached the daily maximum of 3 mental strength points from craving resistance.","success")}else console.log("🔄 Quick Resistance: Daily limit reached, showing limit message"),Ie("Daily Mental Strength Limit Reached","You've already earned the maximum 3 mental strength points from craving resistance today. Keep up the great work! Your resistance still counts for your overall progress.","info");typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Resistance: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Resistance: Secondary Arena stats refresh..."),window.refreshArenaStats()},1e3));return}else S&&(Y=await S.checkDailyCravingResistanceLimits(X),await S.handleCravingResistance())}const Mt=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Mt.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:H,date:X}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Mt));const bt={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:H};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(bt)),B(bt),Y?!Y.canAwardMentalStrength&&!Y.canAwardTriggerDefense?w({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):Y.canAwardMentalStrength?Y.canAwardTriggerDefense?w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):w({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):w({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),m(!0)}catch(H){console.error("Error recording quick resistance:",H),w({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),m(!0)}},fe=async()=>{try{const H=new Date().toISOString(),X=new Date().toDateString();if(n&&n.uid){const{ref:De,set:Re,push:xt}=await Me(()=>import("./index.esm-f161132b.js"),[]),Mt=De(q,`users/${n.uid}/cravings`),bt=xt(Mt);if(await Re(bt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:H,date:X}),window.centralizedStatService)console.log("🔄 Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Quick Relapse: Stats updated via CentralizedStatService"),Ie("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! 💪`,"warning");else if(S){console.log("🔄 Quick Relapse: Calling StatManager.handleRelapse()...");const ht=await S.handleRelapse();if(console.log("🔄 Quick Relapse: StatManager.handleRelapse() result:",ht),o)try{const Pe=await S.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:Pe,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:Pe===1?4:Pe===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Quick relapse also logged to Firestore for analytics")}catch(Pe){console.warn("⚠️ Could not log quick relapse to Firestore:",Pe.message),await ce("relapse",{escalationLevel:await S.getCurrentEscalationLevel(),triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}try{await new Promise(Wt=>setTimeout(Wt,100));const{ref:Pe,get:He}=await Me(()=>import("./index.esm-f161132b.js"),[]),ln=await He(Pe(q,`users/${n.uid}/stats`));if(ln.exists()){const Wt=ln.val();console.log("🔍 Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",Wt)}else console.log("❌ Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(Pe){console.error("❌ Quick Relapse: VERIFICATION failed:",Pe)}try{const Pe=await S.getCurrentEscalationLevel();let He=0;switch(Pe){case 1:He=4;break;case 2:He=6;break;default:He=8;break}Ie("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

📊 Stat Changes:
• Addiction: +${He} points
• Mental Strength: -3 points
• Trigger Defense: -3 points

Your journey continues! 💪`,"warning")}catch(Pe){console.warn("Could not get escalation level for message:",Pe),Ie("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! 💪`,"warning")}}else console.error("❌ Quick Relapse: StatManager not available!"),Ie("⚠️ Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const mt=De(q,`users/${n.uid}/profile/cravingStats`),Et={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:H};await Re(mt,Et),B(Et),console.log("🔄 Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log("ℹ️ Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)"),typeof window.refreshArenaStats=="function"?(console.log("🔄 Quick Relapse: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3)):console.warn("⚠️ Quick Relapse: window.refreshArenaStats not available"),console.log("🔄 Quick Relapse: Triggering immediate PWA refresh..."),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Relapse: Immediate Arena stats refresh..."),window.refreshArenaStats()),typeof setUser=="function"&&setUser(ht=>({...ht,lastRelapseRefresh:Date.now()})),setStatsUpdateTrigger(ht=>ht+1),window.centralizedStatService&&window.centralizedStatService.getCurrentStats().then(ht=>{console.log("🔄 Quick Relapse: Fetched latest stats after relapse:",ht),typeof window.setLatestUserStats=="function"&&window.setLatestUserStats(ht)}).catch(ht=>{console.error("❌ Quick Relapse: Failed to fetch latest stats:",ht)}),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats(),window.dispatchEvent(new Event("resize"))},100),setTimeout(()=>{console.log("🔄 Quick Relapse: Tertiary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats()},500)}const Y=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Y.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:H,date:X}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Y));const Ve={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:H};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Ve)),B(Ve)}catch(H){console.error("Error recording quick relapse:",H),Ie("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! 💪`,"warning")}},pe=async(H,X=30)=>{try{if(!H)return null;const{ref:Y,get:Ve,query:De,orderByChild:Re,startAt:xt,endAt:Mt}=await Me(()=>import("./index.esm-f161132b.js"),[]),bt=new Date,mt=new Date(bt.getTime()-X*24*60*60*1e3),Et=Y(q,`users/${H}/cravings`),ht=await Ve(Et);if(!ht.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const He=Object.values(ht.val()||{}).filter(ot=>{const rt=new Date(ot.timestamp);return rt>=mt&&rt<=bt});if(He.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const ln=He.filter(ot=>ot.outcome==="resisted").length,Wt=He.filter(ot=>ot.outcome==="relapsed").length,In=He.length,On=He.reduce((ot,rt)=>ot+(rt.strength||0),0)/In,Xt={},ir={},mn={},Kn={};He.forEach(ot=>{ot.mood&&(Xt[ot.mood]=(Xt[ot.mood]||0)+1),ot.context&&(ir[ot.context]=(ir[ot.context]||0)+1),ot.timeOfDay&&(mn[ot.timeOfDay]=(mn[ot.timeOfDay]||0)+1);const rt=new Date(ot.timestamp),Zt=`${rt.getFullYear()}-W${Math.ceil((rt.getDate()+new Date(rt.getFullYear(),0,1).getDay())/7)}`;Kn[Zt]=(Kn[Zt]||0)+1});const vt=Object.entries(Xt).sort(([,ot],[,rt])=>rt-ot).slice(0,3).map(([ot,rt])=>({mood:ot,count:rt})),Rt=Object.entries(ir).sort(([,ot],[,rt])=>rt-ot).slice(0,3).map(([ot,rt])=>({context:ot,count:rt})),bn=[];return ln>Wt&&bn.push("You're successfully resisting more cravings than giving in - great job!"),On>7&&bn.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),mn.afternoon>mn.morning&&mn.afternoon>mn.evening&&bn.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),vt.length>0&&vt[0].count>In*.4&&bn.push(`You often experience cravings when feeling ${vt[0].mood}. This might be a key trigger to address.`),{totalCravings:In,resistedCount:ln,relapseCount:Wt,averageStrength:Math.round(On*10)/10,successRate:In>0?Math.round(ln/In*100):0,commonMoods:vt,commonContexts:Rt,timeOfDayPatterns:mn,weeklyTrends:Kn,insights:bn,dateRange:{start:mt.toDateString(),end:bt.toDateString(),days:X}}}catch(Y){return console.error("Error getting craving insights:",Y),null}},_e=async(H,X="json")=>{try{if(!H)return null;const{ref:Y,get:Ve}=await Me(()=>import("./index.esm-f161132b.js"),[]),De=Y(q,`users/${n.uid}/cravings`),Re=await Ve(De);if(!Re.exists())return console.log("No craving data to export"),null;const xt=Object.values(Re.val()||{});if(X==="json"){const Mt=JSON.stringify(xt,null,2),bt=new Blob([Mt],{type:"application/json"}),mt=URL.createObjectURL(bt),Et=document.createElement("a");return Et.href=mt,Et.download=`craving-data-${H}-${new Date().toISOString().split("T")[0]}.json`,Et.click(),URL.revokeObjectURL(mt),console.log(`Exported ${xt.length} craving records for user ${H}`),xt.length}return xt.length}catch(Y){return console.error("Error exporting craving data:",Y),null}},qe=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log("🧪 Testing craving insights...");const H=await pe(n.uid,30);H?(console.log("📊 Craving Insights:",H),w({title:"📊 Your Craving Insights",message:`Last 30 days:

Total cravings: ${H.totalCravings}
Successfully resisted: ${H.resistedCount}
Relapses: ${H.relapseCount}
Success rate: ${H.successRate}%
Average intensity: ${H.averageStrength}/10

Top mood triggers: ${H.commonMoods.map(X=>`${X.mood} (${X.count})`).join(", ")}
Top contexts: ${H.commonContexts.map(X=>`${X.context} (${X.count})`).join(", ")}

Insights:
${H.insights.join(`
`)}`,type:"info"}),m(!0)):(console.log("No insights available"),w({title:"📊 No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),m(!0))};return l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[l.jsx("div",{className:"mb-8",children:l.jsxs("div",{className:"flex justify-start gap-3",children:[l.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[l.jsx("div",{className:"mb-8",children:l.jsx("button",{onClick:de,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-xl",children:"⚠️"}),l.jsx("span",{children:"I feel like vaping"})]})})}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsx("button",{onClick:ve,className:"btn-success touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-green-400",children:"✅"}),l.jsx("span",{children:"I resisted craving"})]})}),l.jsx("button",{onClick:fe,className:"btn-danger touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-red-400",children:"❌"}),l.jsx("span",{children:"I relapsed"})]})})]})]}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"📊 This Week"}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[l.jsx("div",{className:"text-2xl mb-3 text-green-400",children:"🎯"}),l.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.resisted}),l.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),l.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[l.jsx("div",{className:"text-2xl mb-3 text-red-400",children:"💔"}),l.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.relapses}),l.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),l.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"🎮 Distract Yourself"}),l.jsx("div",{className:"flex justify-center",children:l.jsx("button",{onClick:Ae,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🐍 Play Snake"})})]})}),l.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"📊 Data Analysis"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx("button",{onClick:qe,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg min-h-[44px]",children:"🔍 View Insights"}),l.jsx("button",{onClick:()=>_e(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg min-h-[44px]",children:"📥 Export Data"})]})]})}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"⚡ Quick Actions"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx("button",{onClick:()=>x(!0),className:"btn-primary touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"💧 Hydration"}),l.jsx("button",{onClick:()=>L(!0),className:"breathing-button touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🫁 Breathe"}),l.jsx("button",{onClick:async()=>{if(Ie("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log("✅ Physical activity (walk) logged to Firestore for analytics")}catch(H){console.warn("⚠️ Could not log physical activity to Firestore:",H.message),await ce("walk",{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"})}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🚶‍♂️ Walk"}),l.jsx("button",{onClick:async()=>{if(Ie("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log("✅ Meditation (quick) logged to Firestore for analytics")}catch(H){console.warn("⚠️ Could not log meditation to Firestore:",H.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🧘‍♀️ Meditate"})]})]}),a&&u&&l.jsx(p8,{gameType:u,onClose:j}),l.jsx(g8,{isOpen:f,onClose:()=>m(!1),title:y.title,message:y.message,type:y.type}),I&&l.jsx(_8,{isOpen:I,onClose:()=>x(!1),onLogWater:W,currentWater:C,userId:n.uid}),U&&l.jsx(a8,{isOpen:U,onClose:()=>L(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),R&&l.jsx(v8,{isOpen:R,onClose:()=>_(!1),step:E,cravingData:T,setCravingData:A,onNext:me,onPrev:Ce,onComplete:te,dailyCravingLogs:ye})]})})},v8=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:c})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"😰",label:"Stressed"},{id:"lonely",icon:"😔",label:"Lonely"},{id:"happy",icon:"😊",label:"Happy"},{id:"bored",icon:"😐",label:"Bored"},{id:"excited",icon:"🤩",label:"Excited"},{id:"down",icon:"😞",label:"Down"},{id:"angry",icon:"😠",label:"Angry"},{id:"anxious",icon:"😰",label:"Anxious"}],f=[{id:"break",icon:"☕",label:"I'm taking a break"},{id:"partying",icon:"🎉",label:"I'm partying"},{id:"drinking",icon:"🍺",label:"I'm drinking alcohol"},{id:"car",icon:"🚗",label:"I'm in a car"},{id:"coffee",icon:"☕",label:"I'm drinking coffee"},{id:"eating",icon:"🍽️",label:"I've just finished eating"},{id:"intimate",icon:"💕",label:"I've made love"},{id:"tv",icon:"📺",label:"I'm watching TV"},{id:"wake",icon:"🌅",label:"I've just woken up"}],m=()=>{switch(t){case 1:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),l.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),l.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:w=>s({...r,strength:parseInt(w.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`,autoComplete:"off"}),l.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[l.jsx("span",{children:"Not at all"}),l.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>l.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[l.jsx("div",{className:"text-3xl mb-2",children:y.icon}),l.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>l.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[l.jsx("div",{className:"text-2xl mb-2",children:y.icon}),l.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return l.jsx("div",{className:"text-center",children:l.jsxs("div",{className:"space-y-4",children:[l.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💪 I successfully resisted"}),l.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🛡️ Use resistance practices"}),l.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"📝 Just log this craving"}),l.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💔 I had a relapse"})]})});default:return null}};return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 border-slate-600/50 relative overflow-hidden max-w-lg",children:[l.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),l.jsxs("div",{className:"relative z-10",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>l.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),l.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),l.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",c,"/2"]})]}),l.jsx("div",{className:"mb-8",children:m()}),l.jsxs("div",{className:"flex justify-between",children:[t>1&&l.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:"← Back"}),t<4&&l.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next →"})]}),l.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:"×"})]})]})})}):null},_8=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=P.useState(0),[a,c]=P.useState(0),[u,h]=P.useState(!1);P.useState(!1),P.useEffect(()=>{n&&s&&f()},[n,s,r]);const f=async()=>{try{const{ref:k,get:I}=await Me(()=>import("./index.esm-f161132b.js"),[]),x=await m();o(x);const C=await y();c(C)}catch(k){console.error("Error loading hydration data:",k)}},m=async()=>{try{const{ref:k,get:I}=await Me(()=>import("./index.esm-f161132b.js"),[]);let x=0;for(let C=0;C<7;C++){const D=new Date;D.setDate(D.getDate()-C);const U=D.toDateString(),L=await I(k(q,`users/${s}/profile/daily/${U}/water`));if(L.exists()&&L.val()>0)x++;else break}return x}catch(k){return console.error("Error checking hydration streak:",k),0}},y=async()=>{try{const{ref:k,get:I}=await Me(()=>import("./index.esm-f161132b.js"),[]);let x=0;for(let C=0;C<7;C++){const D=new Date;D.setDate(D.getDate()-C);const U=D.toDateString(),L=await I(k(q,`users/${s}/profile/daily/${U}/water`));L.exists()&&L.val()>=6&&x++}return Math.min(x,3)}catch(k){return console.error("Error checking mental strength progress:",k),0}},w=()=>l.jsx("div",{className:"glasses-visual",children:[...Array(6)].map((k,I)=>{const x=I<r;return l.jsx("div",{className:`glass ${x?"filled":""}`},I)})}),S=async()=>{!s||u||r>=6||(h(!0),t(),setTimeout(async()=>{h(!1),await f()},1e3))};return!n||!s?null:l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content",children:l.jsxs("div",{className:"hydration-module",children:[l.jsxs("div",{className:"module-header",children:[l.jsxs("div",{className:"module-title",children:[l.jsx("div",{className:"water-icon",children:"💧"}),"Hydration Tracker"]}),l.jsx("p",{className:"subtitle",children:"Stay hydrated, stay strong"})]}),l.jsxs("div",{className:"progress-container",children:[l.jsxs("div",{className:"progress-header",children:[l.jsx("span",{className:"progress-text",children:"Today's Progress"}),l.jsxs("span",{className:"progress-fraction",children:[r,"/6"]})]}),w(),l.jsx("div",{className:"progress-bar",children:l.jsx("div",{className:"progress-fill",style:{width:`${r/6*100}%`}})}),l.jsxs("div",{className:"progress-percentage",children:[Math.round(r/6*100),"% Complete"]})]}),l.jsxs("div",{className:"streak-section",children:[l.jsxs("div",{className:"streak-card",children:[l.jsx("span",{className:"streak-icon",children:"🔥"}),l.jsx("div",{className:"streak-label",children:"Hydration Streak"}),l.jsxs("div",{className:"streak-value",children:[i," days"]})]}),l.jsxs("div",{className:"streak-card",children:[l.jsx("span",{className:"streak-icon",children:"💪"}),l.jsx("div",{className:"streak-label",children:"Mental Strength"}),l.jsxs("div",{className:"streak-value",children:[a,"/3"]})]})]}),r===6&&l.jsx("div",{className:"completion-message",children:"🎉 Congratulations! You've completed your daily hydration goal!"}),l.jsx("button",{onClick:S,disabled:r>=6||u,className:"log-button",children:r>=6?"🎉 Goal Complete!":u?"💧 Logging...":"💧 Log Water"}),l.jsx("button",{onClick:e,className:"done-button",children:"Done"})]})})})})},w8=({user:n,onNavigate:e})=>{const[t,r]=P.useState(null),[s,i]=P.useState(!1),[o,a]=P.useState(!1),[c,u]=P.useState(!1),[h,f]=P.useState(!1),[m,y]=P.useState(null),[w,S]=P.useState(0),[k,I]=P.useState(null),[x,C]=P.useState(!1),[D,U]=P.useState([]),[L,R]=P.useState(null);P.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const fe=new ty(q,n.uid);await fe.initialize(),R(fe)}catch(fe){console.error("Error initializing StatManager:",fe)}})();const te=async()=>{try{const{ref:fe,get:pe,onValue:_e}=await Me(()=>import("./index.esm-f161132b.js"),[]),qe=fe(q,`users/${n.uid}/profile/relapseDate`),H=await pe(qe);H.exists()&&r(new Date(H.val()));const X=fe(q,`users/${n.uid}/profile/scheduledTriggers`),Y=await pe(X);Y.exists()&&U(Y.val());const Ve=new Date().toDateString(),De=fe(q,`users/${n.uid}/profile/daily/${Ve}/water`),Re=_e(De,Pe=>{Pe.exists()&&S(Pe.val()||0)}),xt=fe(q,`users/${n.uid}/profile/daily/${Ve}/mood`),Mt=_e(xt,Pe=>{Pe.exists()&&I(Pe.val())}),bt=fe(q,`users/${n.uid}/profile/daily/${Ve}/breathing`),mt=_e(bt,Pe=>{Pe.exists()&&C(Pe.val()||!1)}),Et=fe(q,`users/${n.uid}/profile/scheduledTriggers`),ht=_e(Et,Pe=>{Pe.exists()&&U(Pe.val()||[])});return()=>{Re(),Mt(),mt(),ht()}}catch(fe){console.error("Error loading profile data from Firebase:",fe),ve()}},ve=()=>{const fe=localStorage.getItem("quitCoachRelapseDate");fe&&r(new Date(fe));const pe=new Date().toDateString(),_e=localStorage.getItem(`water_${n.uid}_${pe}`),qe=localStorage.getItem(`mood_${n.uid}_${pe}`),H=localStorage.getItem(`breathing_${n.uid}_${pe}`);_e&&S(parseInt(_e)),qe&&I(JSON.parse(qe)),H&&C(H==="true");const X=localStorage.getItem("scheduledTriggers");X&&U(JSON.parse(X))};te()},[n==null?void 0:n.uid]),P.useEffect(()=>{L&&L.trackLoggingActivity()},[L]),P.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:te,get:ve,set:fe}=await Me(()=>import("./index.esm-f161132b.js"),[]),pe=te(q,`users/${n.uid}/profile`),_e=await ve(pe);if(!_e.exists()||Object.keys(_e.val()).length===0){console.log("Migrating localStorage data to Firebase...");const qe=localStorage.getItem("quitCoachRelapseDate");qe&&(await fe(te(q,`users/${n.uid}/profile/relapseDate`),qe),r(new Date(qe)));const H=parseInt(localStorage.getItem("cravingWins")||0);H>0&&await fe(te(q,`users/${n.uid}/profile/cravingsResisted`),H);for(let Y=0;Y<7;Y++){const Ve=new Date;Ve.setDate(Ve.getDate()-Y);const De=Ve.toDateString(),Re=localStorage.getItem(`water_${n.uid}_${De}`);Re&&await fe(te(q,`users/${n.uid}/profile/daily/${De}/water`),parseInt(Re))}for(let Y=0;Y<7;Y++){const Ve=new Date;Ve.setDate(Ve.getDate()-Y);const De=Ve.toDateString(),Re=localStorage.getItem(`mood_${n.uid}_${De}`);Re&&await fe(te(q,`users/${n.uid}/profile/daily/${De}/mood`),JSON.parse(Re))}for(let Y=0;Y<7;Y++){const Ve=new Date;Ve.setDate(Ve.getDate()-Y);const De=Ve.toDateString(),Re=localStorage.getItem(`breathing_${n.uid}_${De}`);Re&&await fe(te(q,`users/${n.uid}/profile/daily/${De}/breathing`),Re==="true")}const X=localStorage.getItem("scheduledTriggers");if(X){const Y=JSON.parse(X);await fe(te(q,`users/${n.uid}/profile/scheduledTriggers`),Y),U(Y)}console.log("localStorage data migration to Firebase completed")}}catch(te){console.error("Error migrating localStorage data to Firebase:",te)}})()},[n==null?void 0:n.uid]);const _=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,E=()=>{const ce=new Date,te=new Date(ce);te.setHours(24,0,0,0);const ve=te-ce,fe=Math.floor(ve/(1e3*60*60)),pe=Math.floor(ve%(1e3*60*60)/(1e3*60)),_e=Math.floor(ve%(1e3*60)/1e3);return{hours:fe,minutes:pe,seconds:_e}},[N,T]=P.useState(E()),[A,v]=P.useState(0),[B,ye]=P.useState(0),[Te,ft]=P.useState(0),[Q,we]=P.useState(0);P.useEffect(()=>{const ce=setInterval(()=>{T(E());const te=_(),fe=new Date-te,pe=Math.floor(fe/(1e3*60*60*24)),_e=Math.floor(fe%(1e3*60*60*24)/(1e3*60*60)),qe=Math.floor(fe%(1e3*60*60)/(1e3*60)),H=Math.floor(fe%(1e3*60)/1e3);v(pe),ye(_e),ft(qe),we(H)},1e3);return()=>clearInterval(ce)},[t,n==null?void 0:n.quitDate]);const se=async(ce,te)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:ve,set:fe}=await Me(()=>import("./index.esm-f161132b.js"),[]),pe=ve(q,`users/${n.uid}/profile/${ce}`);return await fe(pe,te),!0}catch(ve){return console.error("Error saving to Firebase:",ve),!1}},Ie=async()=>{const ce=new Date;r(ce),L&&await L.handleRelapse();const te=ce.toISOString(),ve=await se("relapseDate",te),fe=await se("lastQuitDate",te);ve||localStorage.setItem("quitCoachRelapseDate",te),fe||localStorage.setItem("quitCoachLastQuitDate",te),console.log("🔄 Relapse logged - quit date reset to relapse time:",te)},j=(()=>{const ce=new Date,te=ce.getDay(),ve=te===0?6:te-1,fe=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let pe=0;pe<=ve;pe++)fe[pe].color="bg-green-500";return t&&t.toDateString()===ce.toDateString()&&(fe[ve].color="bg-red-500"),fe})(),W=async ce=>{S(ce);const te=new Date().toDateString();L&&await L.handleHydrationUpdate(ce),await se(`daily/${te}/water`,ce)||localStorage.setItem(`water_${te}`,ce.toString()),i(!1)},de=async ce=>{I(ce);const te=new Date().toDateString();await se(`daily/${te}/mood`,ce)||localStorage.setItem(`mood_${te}`,JSON.stringify(ce)),a(!1)},me=async(ce,te,ve)=>{const fe={day:ce,triggerType:te,time:ve,id:Date.now()},pe=[...D,fe];U(pe),L&&await L.handleTriggerPlanning(),await se("scheduledTriggers",pe)||localStorage.setItem("scheduledTriggers",JSON.stringify(pe)),u(!1)},Ce=async()=>{L&&await L.handleTriggerListUpdate()};return l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[l.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?l.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):l.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white text-lg",children:"Hello,"}),l.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),l.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:l.jsx("span",{className:"font-bold text-slate-900",children:A})})]}),l.jsxs("div",{className:"px-4 space-y-6",children:[l.jsx("div",{className:"mb-6",children:l.jsxs("button",{onClick:Ie,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-2xl",children:"⚠️"}),l.jsx("span",{className:"text-lg",children:"RELAPSE"}),l.jsx("span",{className:"text-2xl",children:"⚠️"})]}),l.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),l.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[l.jsx("span",{className:"text-white text-sm",children:"✓"}),l.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),l.jsx("div",{className:"flex justify-between items-center mb-4",children:j.map((ce,te)=>l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${ce.color}`}),l.jsx("p",{className:"text-gray-400 text-xs",children:ce.name})]},ce.name))})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"text-white text-3xl font-bold",children:[N.hours.toString().padStart(2,"0"),":",N.minutes.toString().padStart(2,"0"),":",N.seconds.toString().padStart(2,"0")]}),l.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),l.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),l.jsxs("div",{className:"flex items-baseline gap-4",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:A.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:B.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:Te.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:Q.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&l.jsx("div",{className:"mt-3 text-center",children:l.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),l.jsx("p",{className:"text-gray-300 text-sm",children:w>0?`${w} glasses today`:"Tap to log water intake"})]}),l.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),l.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),l.jsx("p",{className:"text-gray-300 text-sm",children:k?`You feel ${k.name.toLowerCase()}`:"How do you feel today?"})]}),l.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),l.jsx("p",{className:"text-gray-300 text-sm",children:D.length>0?`${D.length} triggers planned`:"Plan your trigger defense strategy"})]}),l.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),l.jsx("button",{onClick:Ce,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),l.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),l.jsx("div",{children:l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),l.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),l.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),l.jsx(x8,{isOpen:s,onClose:()=>i(!1),onConfirm:W,currentWater:w}),l.jsx(S8,{isOpen:o,onClose:()=>a(!1),onSelect:de,selectedMood:k}),l.jsx(I8,{isOpen:c,onClose:()=>u(!1),onSchedule:me,scheduledTriggers:D}),l.jsx(b8,{isOpen:h,onClose:()=>f(!1),selectedDate:m,onDateSelect:y,dailyData:{water:w,mood:k,breathing:x,relapseDate:t}})]})},x8=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=P.useState(r),{modalRef:o,classes:a}=xS(e,{threshold:80,velocity:.4,enabled:!0});return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:o,className:`modal-content bg-slate-800 border-slate-700 ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"water-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"text-center mb-6 p-4",children:[l.jsx("h3",{id:"water-modal-title",className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),l.jsx("div",{className:"mb-6 px-4",children:l.jsxs("div",{className:"form-group",children:[l.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:c=>i(parseInt(c.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0",autoComplete:"off","aria-label":"Number of glasses of water"}),l.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]})}),l.jsxs("div",{className:"modal-actions px-4 pb-4",children:[l.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"}),l.jsx("button",{onClick:()=>t(s),className:"modal-button modal-button-primary",children:"Confirm"})]})]})]})})}):null},S8=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}],{modalRef:i,classes:o}=xS(e,{threshold:80,velocity:.4,enabled:!0});return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:i,className:`modal-content bg-slate-800 border-slate-700 ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"text-center mb-6 p-4",children:[l.jsx("h3",{id:"mood-modal-title",className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),l.jsx("div",{className:"modal-grid modal-grid-2 gap-3 mb-6 px-4",children:s.map(a=>l.jsxs("button",{onClick:()=>t(a),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 min-h-[44px] ${(r==null?void 0:r.name)===a.name?"ring-2 ring-blue-400 bg-blue-600":"bg-slate-700 hover:bg-slate-600"}`,"aria-pressed":(r==null?void 0:r.name)===a.name,"aria-label":`Select ${a.name} mood`,children:[l.jsx("div",{className:`w-12 h-12 ${a.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:a.icon}),l.jsx("p",{className:"text-white font-semibold",children:a.name})]},a.name))}),l.jsx("div",{className:"modal-actions px-4 pb-4",children:l.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"})})]})]})})}):null},I8=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=P.useState(""),[o,a]=P.useState(""),[c,u]=P.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),l.jsxs("div",{className:"space-y-4 mb-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),l.jsxs("select",{value:s,onChange:m=>i(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select a day"}),f.map(m=>l.jsx("option",{value:m,children:m},m))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),l.jsxs("select",{value:o,onChange:m=>a(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select trigger type"}),h.map(m=>l.jsx("option",{value:m,children:m},m))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),l.jsx("input",{type:"time",value:c,onChange:m=>u(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",autoComplete:"off"})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),l.jsx("button",{onClick:()=>{s&&o&&c&&t(s,o,c)},disabled:!s||!o||!c,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})})}):null},b8=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),l.jsxs("div",{className:"space-y-4 mb-6",children:[l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),l.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),l.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),l.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&l.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[l.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),l.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),l.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors min-h-[44px]",children:"Close"})]})})}):null,E8=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,firestoreBuddyService:r,firestoreBuddyServiceRef:s,initializeFirestoreBuddyService:i,behavioralService:o,user:a,onShowAnalytics:c,onShowPerformanceDashboard:u,onShowBetaMonitoring:h})=>l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:l.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx(v2,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),l.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"📊 Behavioral Analytics"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),l.jsx("button",{onClick:c,disabled:!o,className:`w-full py-3 rounded-lg transition-colors mb-3 ${o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:o?"📈 View Analytics Dashboard":"📈 Analytics (Service Loading...)"}),o&&l.jsx("button",{onClick:async()=>{try{await o.logCraving(a.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await o.logBreathingExercise(a.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert("✅ Test data added to Firestore for analytics demo!")}catch(f){alert("❌ Error adding test data: "+f.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition-colors text-sm min-h-[44px]",children:"🧪 Add Test Data"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"⚡ Performance Monitoring"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Monitor app performance and run stress tests"}),l.jsx("button",{onClick:u,className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors mb-3 min-h-[44px]",children:"📊 Open Performance Dashboard"}),l.jsx("p",{className:"text-gray-500 text-xs",children:"View database performance, authentication metrics, offline queue status, and run stress tests"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"🛡️ Beta Safety Monitoring"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Monitor safety measures and beta testing metrics"}),l.jsx("button",{onClick:h,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors mb-3 min-h-[44px]",children:"🔒 Open Beta Monitoring Dashboard"}),l.jsx("p",{className:"text-gray-500 text-xs",children:"View data backup status, privacy compliance, error logs, rate limiting, and system health"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),l.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:"← Back to Login"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),l.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),l.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),l.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),T8=()=>{const[n,e]=P.useState("arena"),[t,r]=P.useState("auth"),[s,i]=P.useState(null),[o,a]=P.useState(null),[c,u]=P.useState(!1),[h,f]=P.useState(!1),[m,y]=P.useState(!1),[w,S]=P.useState(!1),[k,I]=P.useState(null),[x,C]=P.useState(!0),[D,U]=P.useState(!1),[L,R]=P.useState(0),[_,E]=P.useState(!1),[N,T]=P.useState(0),[A,v]=P.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[B,ye]=P.useState([]);P.useState(null);const[Te,ft]=P.useState(null),[Q,we]=P.useState(null),[se,Ie]=P.useState(null),Ae=P.useRef(null),[j,W]=P.useState(null);P.useEffect(()=>{const M=z=>{window.deferredPrompt=z,U(!0),console.log("📲 PWA: beforeinstallprompt captured (App state set)")},K=()=>{U(!1),console.log("✅ PWA installed (App state cleared)")};return window.addEventListener("beforeinstallprompt",M),window.addEventListener("appinstalled",K),()=>{window.removeEventListener("beforeinstallprompt",M),window.removeEventListener("appinstalled",K)}},[]),P.useEffect(()=>{let M=0,K=0,z=!1;const ue=80,Ne=Oe=>{M=Oe.touches[0].clientY,z=!1},Qe=Oe=>{if(window.scrollY>0)return;K=Oe.touches[0].clientY;const Be=K-M;Be>0&&(z=!0,Oe.preventDefault(),T(Math.min(Be,ue*1.5)))},Ee=async()=>{if(!z)return;K-M>ue?(E(!0),T(0),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Pull-to-refresh: Refreshing stats..."),await window.refreshArenaStats()),typeof refreshStats=="function"&&(console.log("🔄 Pull-to-refresh: Calling main refresh..."),refreshStats()),setTimeout(()=>{E(!1)},1e3)):T(0),z=!1};return document.addEventListener("touchstart",Ne,{passive:!1}),document.addEventListener("touchmove",Qe,{passive:!1}),document.addEventListener("touchend",Ee,{passive:!1}),()=>{document.removeEventListener("touchstart",Ne),document.removeEventListener("touchmove",Qe),document.removeEventListener("touchend",Ee)}},[]);const de=async()=>{try{if(window.promptPWAInstall){const z=await window.promptPWAInstall();z&&z.outcome==="accepted"&&U(!1);return}const M=window.deferredPrompt;if(!M)return;M.prompt();const K=await M.userChoice;window.deferredPrompt=null,K.outcome==="accepted"&&U(!1)}catch(M){console.warn("PWA install prompt failed:",M==null?void 0:M.message)}},me=async()=>{try{if(!tr){console.error("❌ Firestore instance is not available");return}const M=new sc(tr),K=new f2(tr),z=await M.testConnectivity(),ue=await K.testConnectivity();z?(ft(M),Ae.current=M,console.log("✅ FirestoreBuddyService initialized successfully")):console.warn("⚠️ Firestore connectivity test failed - service not initialized"),ue?(we(K),console.log("✅ FirestoreBehavioralService initialized successfully")):console.warn("⚠️ Firestore behavioral service connectivity test failed")}catch(M){console.error("❌ Error initializing FirestoreBuddyService:",M)}},Ce=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),ce=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),te=M=>{M.relapseDate&&bt(new Date(M.relapseDate)),M.dailyWater!==void 0&&Et(M.dailyWater),M.dailyMood!==void 0&&Pe(M.dailyMood),M.dailyBreathing!==void 0&&ln(M.dailyBreathing),M.scheduledTriggers&&In(M.scheduledTriggers)},ve=async()=>{const M=new Date().toDateString();try{const{ref:K,set:z}=await Me(()=>import("./index.esm-f161132b.js"),[]),ue=K(q,`users/${k==null?void 0:k.uid}/profile/daily/${M}/breathing`);await z(ue,!0)}catch(K){console.error("Error saving breathing exercise to Firebase:",K),localStorage.setItem(`breathing_${k==null?void 0:k.uid}_${M}`,"true")}if(j)try{await j.handleBreathingExercise();const K=await j.checkBreathingStreak(),z=Math.max(0,3-K%3),ue=K>=3&&K%3===0?`🎉 Excellent! You've completed a ${K}-day breathing streak and earned +1 Mental Strength!`:`✅ Breathing exercise completed! Current streak: ${K} days. Complete ${z} more days to earn +1 Mental Strength.`;if(showQuickActionPopup("🫁 Breathing Exercise Complete",`${ue}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),Q)try{await Q.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:K,mentalStrengthEarned:K>=3&&K%3===0}),console.log("✅ Breathing exercise also logged to Firestore for analytics")}catch(Ne){console.warn("⚠️ Could not log breathing exercise to Firestore:",Ne.message),await handleOfflineBehavioralLog("breathing",{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:K,mentalStrengthEarned:K>=3&&K%3===0})}}catch(K){console.warn("⚠️ Error handling breathing exercise completion:",K.message),showQuickActionPopup("🫁 Breathing Exercise Complete","✅ Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},fe=(M,K)=>{const z=document.createElement("div");z.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",z.innerHTML=`
      <div class="font-bold">${M}</div>
      <div class="text-sm opacity-90">${K}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(z),setTimeout(()=>{z.parentNode&&z.parentNode.removeChild(z)},1e4)},pe=async M=>{if(!M)return!1;v({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:K,get:z,onValue:ue}=await Me(()=>import("./index.esm-f161132b.js"),[]);v(at=>({...at,currentStep:"Loading profile data...",progress:20}));const Ne=K(q,`users/${M}`),Qe=await z(Ne);if(!Qe.exists())throw new Error("User profile not found");const Ee=Qe.val(),Oe=_e(Ee);v(at=>({...at,currentStep:"Loading battle stats...",progress:40}));const Be=K(q,`users/${M}/stats`),kt=await z(Be),Je=kt.exists()?qe(kt.val()):Ce();v(at=>({...at,currentStep:"Loading habits and progress...",progress:60}));const Ke=K(q,`users/${M}/profile`),Ze=await z(Ke),Fe=Ze.exists()?H(Ze.val()):ce();v(at=>({...at,currentStep:"Loading achievements...",progress:80}));const $e=K(q,`users/${M}/profile/cravingsResisted`),je=await z($e),We=je.exists()?Math.max(0,parseInt(je.val())||0):0;v(at=>({...at,currentStep:"Setting up live sync...",progress:90}));const Cn=ue(Be,at=>{if(at.exists()){const or=qe(at.val());if(console.log("🔄 Firebase Listener: Stats changed, new stats:",or),mn(or),t==="arena"&&o){console.log("🔄 Firebase Listener: Current user object:",o),console.log("🔄 Firebase Listener: user.quitDate:",o.quitDate),console.log("🔄 Firebase Listener: user.uid:",o.uid);const rs={...o,stats:or};console.log("🔄 Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",rs),console.log("🔄 Firebase Listener: updatedUser.quitDate:",rs.quitDate),console.log("🔄 Firebase Listener: updatedUser.uid:",rs.uid),calculateRealTimeStats(rs).then(ps=>{console.log("🔄 Firebase Listener: calculateRealTimeStats returned:",ps),console.log("🔄 Firebase Listener: calculatedStats.streakDays:",ps.streakDays),setRealTimeUserStats(ps)})}}}),St=ue(Ke,at=>{if(at.exists()){const or=H(at.val());t==="profile"&&te(or)}}),At=ue($e,at=>{if(at.exists()){const or=Math.max(0,parseInt(at.val())||0);t==="craving-support"&&Xt(or)}});return ye([Cn,St,At]),v(at=>({...at,currentStep:"Finalizing...",progress:100})),a(at=>({...at,...Oe,...Fe,stats:Je})),te(Fe),Xt(We),Oe.onboardingCompleted&&S(!0),v({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:Oe,stats:Je,profileData:Fe,cravingsResisted:We}),!0}catch(K){return console.error("❌ Error loading user data:",K),v({isLoading:!1,progress:0,currentStep:"Failed to load data",error:K.message,isComplete:!1}),fe("Failed to load user data",K.message),!1}},_e=M=>M?{uid:M.uid||"",email:M.email||"",heroName:M.heroName||"Hero",archetype:M.archetype||"The Determined",avatar:M.avatar||qs("default"),quitDate:M.quitDate,onboardingCompleted:!!M.onboardingCompleted,updatedAt:M.updatedAt||Date.now(),...M}:X(),qe=M=>M?{mentalStrength:Math.max(0,Math.min(100,parseInt(M.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(M.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(M.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(M.addictionLevel)||50)),streakDays:Math.max(0,parseInt(M.streakDays)||0),streakUnit:M.streakUnit||"hours",streakDisplayText:M.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(M.cravingsResisted)||0),...M}:Ce(),H=M=>M?{dailyWater:Math.max(0,parseInt(M.dailyWater)||0),dailyMood:M.dailyMood||null,dailyBreathing:!!M.dailyBreathing,scheduledTriggers:Array.isArray(M.scheduledTriggers)?M.scheduledTriggers:[],relapseDate:M.relapseDate?new Date(M.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(M.cravingsResisted)||0),...M}:ce(),X=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:qs("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});P.useEffect(()=>()=>{B.forEach(M=>{typeof M=="function"&&M()})},[B]);const[Y,Ve]=P.useState(null);P.useEffect(()=>{const M=async()=>{try{const z=(await Me(()=>import("./offlineManager-6a0291dc.js"),[])).default,ue=new z;Ve(ue),window.offlineManager=ue,window.refreshUserData=xt,console.log("✅ Offline manager initialized")}catch(z){console.error("Error initializing offline manager:",z)}},K=async()=>{try{const z=(await Me(()=>import("./authGuard-cbba6f5b.js"),[])).default,ue=(await Me(()=>import("./sessionManager-00d6303e.js"),[])).default,Ne=new z,Qe=new ue;window.authGuard=Ne,window.sessionManager=Qe,console.log("✅ Auth services initialized")}catch(z){console.error("❌ Failed to initialize auth services:",z)}};M(),K()},[]);const De=async M=>{if(!M)return!1;const K=await pe(M);if(K&&Y&&(await Y.cacheUserData(o),await Y.cacheProfileData({dailyWater:mt,dailyMood:ht,dailyBreathing:He,scheduledTriggers:Wt,relapseDate:Mt,cravingsResisted:On})),!K&&Y){console.log("📱 Loading offline data...");const z=await Y.getCachedUserData(),ue=await Y.getCachedProfileData();if(z)return console.log("📱 Using offline user data"),a(z),S(z.onboardingCompleted),ue&&te(ue),!0}return K},Re=async()=>k!=null&&k.uid?(console.log("🔄 Refreshing user data with offline support..."),await De(k.uid)):!1,xt=async()=>{if(!(k!=null&&k.uid)){fe("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await Re()){const K=document.createElement("div");K.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",K.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(K),setTimeout(()=>{K.parentNode&&K.parentNode.removeChild(K)},5e3)}else fe("Refresh Failed","Could not refresh data. Please try again.")},[Mt,bt]=P.useState(null),[mt,Et]=P.useState(0),[ht,Pe]=P.useState(null),[He,ln]=P.useState(!1),[Wt,In]=P.useState([]),[On,Xt]=P.useState(0),[ir,mn]=P.useState(Ce());P.useEffect(()=>{const M=z=>{if(z.message&&z.message.includes("content_script")){console.warn("Browser extension error (ignored):",z.message);return}if(z.message&&(z.message.includes("FrameDoesNotExistError")||z.message.includes("background.js"))){console.warn("Background frame error (ignored):",z.message);return}if(z.message&&z.message.includes("deref")){console.warn("Browser extension deref error (ignored):",z.message);return}if(z.message&&z.message.includes("chrome-extension://")){console.warn("Chrome extension URL error (ignored):",z.message);return}console.error("Global error caught:",z)},K=z=>{if(z.reason&&z.reason.message&&z.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&(z.reason.message.includes("FrameDoesNotExistError")||z.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&z.reason.message.includes("deref")){console.warn("Browser extension deref promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&z.reason.message.includes("chrome-extension://")){console.warn("Chrome extension URL promise rejection (ignored):",z.reason.message);return}console.error("Unhandled promise rejection:",z.reason)};return window.addEventListener("error",M),window.addEventListener("unhandledrejection",K),()=>{window.removeEventListener("error",M),window.removeEventListener("unhandledrejection",K)}},[]),P.useEffect(()=>{(()=>{try{q&&typeof q.app<"u"&&console.log("🔥 Firebase RTDB initialized successfully")}catch(K){console.warn("⚠️ Firebase initialization check failed (non-critical):",(K==null?void 0:K.message)||K)}})()},[]),P.useEffect(()=>{let M=!0,K=null;return(async()=>{try{console.log("Initializing authentication state..."),C(!0);const ue=async Ee=>{const Oe=`quitDateFixed_${Ee}_v2`;if(!localStorage.getItem(Oe)&&!(Ee!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&Ee!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:Be,get:kt,set:Je}=await Me(()=>import("./index.esm-f161132b.js"),[]),Ke="2025-09-18T13:56:46.584Z";console.log(`🔧 One-time fix: Setting proper quit date for ${Ee}...`);const Ze=Be(q,`users/${Ee}/profile`),Fe=await kt(Ze);let $e=Ke;if(Fe.exists()){const je=Fe.val();if(je.lastRelapseDate){const We=new Date(je.lastRelapseDate),Cn=new Date(Ke);$e=We>Cn?je.lastRelapseDate:Ke,console.log(`📅 ${Ee}: Using quit date ${$e} (considering relapse: ${je.lastRelapseDate})`)}}await Je(Be(q,`users/${Ee}/quitDate`),$e),await Je(Be(q,`users/${Ee}/profile/quitDate`),$e),localStorage.setItem(Oe,"true"),console.log(`✅ One-time fix: Quit date fixed for ${Ee} in Firebase database`)}catch(Be){console.warn(`⚠️ One-time fix failed for ${Ee}:`,Be.message)}},{onAuthStateChanged:Ne}=await Me(()=>import("./index.esm-47346572.js"),[]);K=Ne(Ei,async Ee=>{if(M)if(console.log("Auth state changed:",Ee?`User: ${Ee.uid}`:"No user"),Ee){I(Ee),console.log("User authenticated, checking database for user data..."),(Ee.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||Ee.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(`🧹 Clearing cache for ${Ee.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(Oe=>{(Oe.includes("quitCoach")||Oe.includes("quitDate")||Oe.includes("user")||Oe.includes("arena"))&&localStorage.removeItem(Oe)})),ue(Ee.uid);try{const{ref:Oe,get:Be}=await Me(()=>import("./index.esm-f161132b.js"),[]),kt=Oe(q,`users/${Ee.uid}`),Je=await Be(kt);if(Je.exists()){const Ke=Je.val();console.log("Existing user data found - auto-login successful"),(()=>{const Fe=[];for(let $e=0;$e<localStorage.length;$e++){const je=localStorage.key($e);je&&(je.startsWith("water_")||je.startsWith("mood_")||je.startsWith("breathing_"))&&Fe.push(je)}Fe.forEach($e=>localStorage.removeItem($e)),console.log("Cleared previous user data from localStorage")})(),a(Ke),S(!0),r("arena");try{const Fe=await Me(()=>Promise.resolve().then(()=>Eq),void 0),$e=new Fe.default(q,Ee.uid);await $e.initialize(),W($e),console.log("✅ StatManager initialized successfully")}catch(Fe){console.error("Error initializing StatManager:",Fe)}try{const Fe=new YT(q,Ee.uid,window.authGuard);Ie(Fe),window.centralizedStatService=Fe,await Fe.refreshAllStats(),console.log("✅ CentralizedStatService initialized and stats refreshed for user:",Ee.uid),Fe.setupRealTimeListener($e=>{console.log("🔄 Real-time stats update received:",$e),mn($e)})}catch(Fe){console.error("Error initializing CentralizedStatService:",Fe)}try{Wq.initialize(),console.log("✅ Performance monitoring system initialized")}catch(Fe){console.error("Error initializing performance monitoring:",Fe)}try{ZT.initialize(Ee.uid),window.dataBackupService=ZT,console.log("✅ Data backup service initialized"),eA.initialize(Ee.uid),window.privacyProtectionService=eA,console.log("✅ Privacy protection service initialized"),tA.initialize(Ee.uid),window.errorLoggingService=tA,console.log("✅ Error logging service initialized"),nA.initialize(Ee.uid),window.gracefulDegradationService=nA,console.log("✅ Graceful degradation service initialized"),rA.initialize(Ee.uid),window.rateLimitingService=rA,console.log("✅ Rate limiting service initialized")}catch(Fe){console.error("Error initializing safety services:",Fe)}try{console.log("🔍 Checking if existing user needs buddy matching...");const Fe=Ae.current||Te;if(Fe)if(await Fe.getUserBuddyPair(Ee.uid))console.log("✅ Existing user already has a buddy pair");else{console.log("🔄 Existing user has no buddy - adding to matching pool...");const je={userId:Ee.uid,heroName:Ke.heroName,archetype:Ke.archetype,joinedAt:new Date().toISOString(),stats:Ke.stats};await Fe.addToMatchingPool(je),console.log("✅ Added existing user to matching pool"),setTimeout(async()=>{try{console.log("⏳ Triggering auto-matching for existing user..."),await su()}catch(We){console.error("Auto-matching failed for existing user:",We)}},2e3)}else console.log("⚠️ FirestoreBuddyService not available for existing user buddy check")}catch(Fe){console.error("Error checking existing user buddy status:",Fe)}console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Oe){console.error("Error fetching user data during auto-login:",Oe),r("onboarding")}}else console.log("No authenticated user - showing login screen"),I(null),a(null),S(!1),r("auth"),(()=>{const Be=[];for(let kt=0;kt<localStorage.length;kt++){const Je=localStorage.key(kt);Je&&(Je.startsWith("water_")||Je.startsWith("mood_")||Je.startsWith("breathing_"))&&Be.push(Je)}Be.forEach(kt=>localStorage.removeItem(kt)),console.log("Cleared user-specific data from localStorage")})()});const Qe=setTimeout(()=>{M&&(console.warn("Auth initialization timeout - forcing to auth screen"),C(!1),r("auth"))},1e4);K&&clearTimeout(Qe)}catch(ue){console.error("Error initializing authentication:",ue),M&&(C(!1),r("auth"))}finally{M&&C(!1)}})(),me(),()=>{M=!1,K&&K()}},[]);const Kn=async M=>{console.log("Authentication successful, checking for existing user data...",{uid:M==null?void 0:M.uid,email:M==null?void 0:M.email});try{const{ref:K,get:z}=await Me(()=>import("./index.esm-f161132b.js"),[]);console.log("Checking database for existing user data...");const ue=K(q,`users/${M.uid}`),Ne=await z(ue);if(Ne.exists()){const Qe=Ne.val();if(console.log("Existing user data found - loading all user data..."),await De(M.uid)){console.log("✅ All user data loaded successfully, going to Arena");try{const Oe=new YT(q,M.uid,window.authGuard);Ie(Oe),window.centralizedStatService=Oe,await Oe.refreshAllStats(),console.log("✅ CentralizedStatService initialized for existing user:",M.uid),Oe.setupRealTimeListener(Be=>{console.log("🔄 Real-time stats update received:",Be),mn(Be)})}catch(Oe){console.error("Error initializing CentralizedStatService for existing user:",Oe)}r("arena")}else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(Qe);const Oe=!!Qe.onboardingCompleted;S(Oe),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(K){console.error("Database check failed:",K),r("onboarding")}},[vt,Rt]=P.useState(null),[bn,ot]=P.useState(!1),[rt,Zt]=P.useState(null),[ae,Tt]=P.useState(!1),Gt=async(M,K,z)=>{var ue,Ne,Qe;if(!(!(o!=null&&o.uid)||bn)){ot(!0),Zt(null),Tt(!0);try{console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!Te),console.log("🔄 FirestoreBuddyService type:",typeof Te);const Ee=Ae.current||Te;if(!Ee){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await ns();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:Oe,query:Be,where:kt,getDocs:Je}=await Me(()=>import("./index.esm-27af3a4d.js"),[]),Ke=Oe(tr,"buddyPairs"),Ze=Be(Ke,kt("user1Id","==",o.uid)),Fe=await Je(Ze);let $e=null,je=null;if(Fe.empty){const We=Be(Ke,kt("user2Id","==",o.uid)),Cn=await Je(We);if(!Cn.empty){const St=Cn.docs[0];$e={id:St.id,...St.data()},je=$e.user1Id}}else{const We=Fe.docs[0];$e={id:We.id,...We.data()},je=$e.user2Id}if($e&&je){console.log("✅ Firestore: Found buddy pair:",$e.id),console.log("🔍 Buddy pair data:",{user1Id:$e.user1Id,user2Id:$e.user2Id,user1Name:$e.user1Name,user2Name:$e.user2Name,currentUserId:o.uid,buddyUserId:je});let We="Your Buddy";if($e.user1Id===o.uid?We=$e.user2Name||"Your Buddy":We=$e.user1Name||"Your Buddy",We==="Your Buddy")try{const It=(await Ee.getAllMatchingPoolUsers()).find(gn=>gn.userId===je);It&&It.heroName&&(We=It.heroName,console.log("🔍 Found buddy name from matching pool:",We))}catch(Xe){console.log("⚠️ Could not get buddy name from matching pool:",Xe.message)}if(We==="Your Buddy"&&(We=`Buddy ${je.slice(-4)}`),console.log("🔍 Selected buddy name:",We),We!=="Your Buddy"&&We.startsWith("Buddy ")===!1)try{console.log("🔄 Updating buddy pair with correct names...");const{doc:Xe,updateDoc:It}=await Me(()=>import("./index.esm-27af3a4d.js"),[]),gn=Xe(tr,"buddyPairs",$e.id),en={};$e.user1Id===o.uid?(en.user1Name=o.heroName,en.user2Name=We):(en.user1Name=We,en.user2Name=o.heroName),await It(gn,en),console.log("✅ Updated buddy pair with names:",en)}catch(Xe){console.log("⚠️ Could not update buddy pair names:",Xe.message)}let Cn={streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0};try{console.log("🔄 Attempting to get real buddy stats from Firebase...");const{ref:Xe,get:It}=await Me(()=>import("./index.esm-f161132b.js"),[]),gn=Xe(q,`users/${je}/stats`),en=await It(gn);if(en.exists()){const ss=en.val();Cn={...Cn,...ss},console.log("✅ Got real buddy stats from Firebase:",ss)}else console.log("⚠️ Buddy stats not found in Firebase, using defaults")}catch(Xe){console.log("⚠️ Could not read buddy stats (permission), using defaults:",Xe.message)}let St=null,At=null,at=null,or=qs("buddy","adventurer"),rs="DETERMINED";try{console.log("🔄 Loading Firebase imports for buddy profile...");const{ref:Xe,get:It}=await Me(()=>import("./index.esm-f161132b.js"),[]);console.log("✅ Firebase imports loaded successfully"),console.log("🔍 Reading buddy profile fields from path:",`users/${je}`),console.log("🔄 Firestore: Attempting to read buddy quit date from multiple locations...");const[gn,en,ss,Or,ar,ys,Rn]=await Promise.all([It(Xe(q,`users/${je}/avatar`)),It(Xe(q,`users/${je}/avatarSeed`)),It(Xe(q,`users/${je}/archetype`)),It(Xe(q,`users/${je}/heroName`)),It(Xe(q,`users/${je}/quitDate`)),It(Xe(q,`users/${je}/profile/quitDate`)),It(Xe(q,`users/${je}/profile`))]);if(console.log("🔍 Firestore: Quit date snapshots - root exists:",ar.exists(),"profile exists:",ys.exists()),gn.exists())or=gn.val(),console.log("✅ Got buddy avatar from Firebase");else if(en.exists()){const Ut=en.val(),pt=ss.exists()?ss.val():"adventurer";or=qs(Ut,pt),console.log("✅ Generated buddy avatar from seed:",Ut)}if(ss.exists()&&(rs=ss.val(),console.log("✅ Got buddy archetype:",rs)),Or.exists()){const Ut=Or.val();console.log("✅ Got buddy hero name:",Ut),We=Ut}if(ar.exists())St=ar.val(),console.log("✅ Got buddy quit date from Firebase (root):",St);else if(ys.exists())St=ys.val(),console.log("✅ Got buddy quit date from Firebase (profile):",St);else{if(console.log("⚠️ No buddy quit date found in Firebase (neither root nor profile)"),console.log("🔍 quitDateSnapshot exists:",ar.exists()),console.log("🔍 profileQuitDateSnapshot exists:",ys.exists()),Rn.exists()){const Ut=Rn.val();console.log("🔍 Full profile data available:",Ut),Ut&&Ut.quitDate?(St=Ut.quitDate,console.log("✅ Found buddy quit date in profile data:",St)):console.log("⚠️ Profile exists but has no quit date field"),Ut&&Ut.lastActivity&&(at=Ut.lastActivity,console.log("🔍 Captured buddy lastActivity for fallback:",at))}else console.log("⚠️ No profile data available at all");if(Rn.exists()){const Ut=Rn.val();At=Ut.lastRelapseDate||Ut.relapseDate,console.log("🔍 Found buddy relapse date:",At)}if(!St){if(console.log("⚠️ No quit date found, checking for createdAt timestamp..."),console.log("🔍 Buddy user ID:",je),Rn.exists()){const Ut=Rn.val();Ut.createdAt?(St=Ut.createdAt,console.log("✅ Using buddy createdAt as quit date:",St)):(console.log("⚠️ No createdAt timestamp found either - not assigning fallback quit date"),St=void 0)}else console.log("⚠️ No profile data available - not assigning fallback quit date"),St=void 0;je==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"?console.log("🔄 Arena: User 2 uses centralized stats - no hardcoded quit date needed"):je==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&console.log("🔄 Arena: User 3 uses centralized stats - no hardcoded quit date needed")}}}catch(Xe){console.log("⚠️ Could not read buddy profile (permission):",Xe.message),console.log("🔍 Full profile error details:",Xe),console.log("🔍 Trying to access path:",`users/${je}`),console.log("🔍 Current user can read own profile, but not buddy profile")}const ps=St||at||null;let gl=ps;(je==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||je==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")&&(console.log(`🔄 Arena: Not setting quit date for centralized buddy ${je} - using null to prevent calculations`),gl=null);const Jn={heroName:We,uid:je,stats:Cn,quitDate:gl,originalQuitDate:gl,finalQuitDate:ps,lastActivity:at||null,lastRelapseDate:At,achievements:[],archetype:rs,avatar:or,userId:je,isRealBuddy:!0,pairId:$e.id,triggers:[],dailyPatterns:[],copingStrategies:[],specialFeatures:null};console.log("🔍 Firestore: Final buddy object with quit date:",{heroName:We,originalQuitDate:St,finalQuitDate:ps,lastRelapseDate:At,hasOriginalQuitDate:!!St,usingDefaultQuitDate:!St,hasRelapseDate:!!At}),Rt(Jn),console.log("✅ Firestore: Buddy data loaded successfully"),console.log("🔍 Firestore: Buddy Special Features data:",{hasSpecialFeatures:!!Jn.specialFeatures,hasTriggers:!!((ue=Jn.triggers)!=null&&ue.length),hasDailyPatterns:!!((Ne=Jn.dailyPatterns)!=null&&Ne.length),hasCopingStrategies:!!((Qe=Jn.copingStrategies)!=null&&Qe.length),uid:Jn.uid});try{let Xe=Jn.lastRelapseDate||null;if(!Xe){const It=Jn.finalQuitDate;if(It){const gn=new Date(It).getTime(),en=Date.now();Math.abs(en-gn)<2*60*1e3||(Xe=It)}}if(!Xe&&Jn.lastActivity&&(Xe=Jn.lastActivity),Xe){const It=Bs(new Date(Xe)),gn={streakDays:It.value,streakUnit:It.unit,streakDisplayText:It.displayText};typeof setBuddyStreakData=="function"&&setBuddyStreakData(gn),typeof setRealTimeNemesisStats=="function"&&setRealTimeNemesisStats(en=>({...en,streakDays:gn.streakDays,streakUnit:gn.streakUnit,streakDisplayText:gn.streakDisplayText})),console.log("🔄 Arena: Primed buddy streak from loaded data:",gn.streakDisplayText)}}catch(Xe){console.log("⚠️ Arena: Could not prime buddy streak:",Xe==null?void 0:Xe.message)}console.log(`🔄 Firestore: Reading centralized buddy stats for ${je} (read-only)`);try{try{const{ref:Xe,get:It}=await Me(()=>import("./index.esm-f161132b.js"),[]),gn=await It(Xe(q,`users/${je}/stats`));if(gn.exists()){const en=gn.val(),ss=new Date,Or=Jn.lastRelapseDate;if(Or){const ar=new Date(Or),ys=ss-ar,Rn=Math.floor(ys/(1e3*60*60)),Ut=Math.floor(Rn/24);let pt,mi;Rn<24?(pt=`${Rn} hour${Rn===1?"":"s"}`,mi=0):(pt=`${Ut} day${Ut===1?"":"s"}`,mi=Ut),console.log(`🔄 Firestore: Calculated buddy streak locally: ${pt} (${Rn} hours since relapse)`);const sa={streakDays:mi,streakUnit:Rn<24?"hours":"days",streakDisplayText:pt};z(sa);const vs={...en,streakDays:mi,streakUnit:Rn<24?"hours":"days",streakDisplayText:pt};console.log("🔄 Firestore: Using buddy stats with locally calculated streak:",vs),console.log("🔄 Firestore: Buddy streak fields:",{streakDays:vs.streakDays,streakUnit:vs.streakUnit,streakDisplayText:vs.streakDisplayText}),K(vs)}else console.log("🔄 Firestore: No relapse date found for buddy, using existing stats"),K(en)}else{console.log("⚠️ Firestore: No centralized stats found for buddy, using fallback calculation");const en=await M(Jn);K(en)}}catch(Xe){console.error("❌ Error reading buddy stats:",Xe);const It=await M(Jn);K(It)}}catch(Xe){console.error("❌ Error reading centralized buddy stats:",Xe);const It=await M(Jn);K(It)}await Yn(o.uid,je)}else console.log("ℹ️ Firestore: No buddy pair found for user"),Rt(null)}catch(Ee){console.error("❌ Firestore: Error loading buddy:",Ee),console.log("🔄 Falling back to Realtime Database buddy loading..."),await ns()}finally{ot(!1)}}},ns=async()=>{var M,K,z,ue,Ne,Qe,Ee,Oe,Be,kt;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:Je,get:Ke}=await Me(()=>import("./index.esm-f161132b.js"),[]),Ze=Je(q,"buddyPairs"),Fe=await Ke(Ze);if(!Fe.exists()){Rt(null);return}const $e=Fe.val();let je=null,We=null;for(const[Cn,St]of Object.entries($e))if(St.users&&Array.isArray(St.users)&&St.users.includes(o.uid)){je={...St,pairId:Cn},We=St.users.find(At=>At!==o.uid);break}if(je&&We){const Cn=Je(q,`users/${We}`),St=await Ke(Cn);if(!St.exists()){const{remove:or}=await Me(()=>import("./index.esm-f161132b.js"),[]);await or(Je(q,`buddyPairs/${je.pairId}`)),Rt(null);return}const At=St.val(),at={heroName:At.heroName||"Buddy",stats:{streakDays:((M=At.stats)==null?void 0:M.streakDays)||0,addictionLevel:((K=At.stats)==null?void 0:K.addictionLevel)||50,willpower:((z=At.stats)==null?void 0:z.mentalStrength)||50,motivation:((ue=At.stats)==null?void 0:ue.mentalStrength)||50,cravingResistance:((Ne=At.stats)==null?void 0:Ne.mentalStrength)||50,triggerDefense:((Qe=At.stats)==null?void 0:Qe.triggerDefense)||30,experiencePoints:((Ee=At.stats)==null?void 0:Ee.experiencePoints)||0},achievements:At.achievements||[],archetype:At.archetype||"The Determined",avatar:At.avatar||qs(At.heroName||"buddy","adventurer"),uid:We,userId:We,lastRelapseDate:At.lastRelapseDate,isRealBuddy:!0,pairId:je.pairId,triggers:At.triggers||[],dailyPatterns:At.dailyPatterns||[],copingStrategies:At.copingStrategies||[],specialFeatures:At.specialFeatures||null};Rt(at),console.log("🔍 RealtimeDB: Buddy Special Features data:",{hasSpecialFeatures:!!at.specialFeatures,hasTriggers:!!((Oe=at.triggers)!=null&&Oe.length),hasDailyPatterns:!!((Be=at.dailyPatterns)!=null&&Be.length),hasCopingStrategies:!!((kt=at.copingStrategies)!=null&&kt.length),uid:at.uid}),await Yn(o.uid,We)}else Rt(null)}catch(Je){console.error("Error loading buddy from Realtime Database:",Je),Zt("Failed to load buddy data"),Rt(null)}},Yn=async(M,K)=>{try{const z=Ae.current||Te;if(z&&(vt!=null&&vt.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await z.removeFromMatchingPool(M),await z.removeFromMatchingPool(K);const{doc:ue,updateDoc:Ne}=await Me(()=>import("./index.esm-27af3a4d.js"),[]),Qe=ue(tr,"buddyPairs",vt.pairId);await Ne(Qe,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:ue,remove:Ne,set:Qe}=await Me(()=>import("./index.esm-f161132b.js"),[]);await Ne(ue(q,`matchingPool/${M}`)),await Ne(ue(q,`matchingPool/${K}`)),vt!=null&&vt.pairId&&(await Qe(ue(q,`buddyPairs/${vt.pairId}/user1RemovedFromPool`),!0),await Qe(ue(q,`buddyPairs/${vt.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(z){console.error("❌ Error removing users from matching pool:",z)}};P.useEffect(()=>{Tt(!1),Rt(null)},[o==null?void 0:o.uid]),P.useEffect(()=>{o!=null&&o.uid&&!vt&&!bn&&!ae&&console.log("🔄 Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,vt,bn,ae]),P.useEffect(()=>{Te&&console.log("✅ FirestoreBuddyService is now available")},[Te]);const su=async()=>{try{const M=Ae.current||Te;if(!M){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Hi();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting NEW CHAIN PAIRING algorithm...");const K=await M.getAllMatchingPoolUsers();if(console.log("🔍 Firestore: Current matching pool state:",{totalUsers:K.length,userIds:K.map(ue=>({id:ue.userId,name:ue.heroName,joinedAt:ue.joinedAt}))}),K.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing (need 2, have",K.length,")");return}console.log(`🔄 Firestore: Found ${K.length} users in matching pool`);const z=K;if(console.log("ℹ️ Firestore: Skipping user validation to avoid permission errors"),z.sort((ue,Ne)=>{const Qe=ue.joinedAt?new Date(ue.joinedAt).getTime():0,Ee=Ne.joinedAt?new Date(Ne.joinedAt).getTime():0;return Qe-Ee}),console.log("🔄 Firestore: Sorted users by join time (oldest first):",z.map(ue=>({userId:ue.userId,joinedAt:ue.joinedAt}))),z.length>=2){const ue=z[z.length-1],Ne=z[z.length-2];if(ue.userId!==Ne.userId)try{console.log(`🔄 Firestore: SEQUENTIAL PAIRING: ${ue.userId} (${ue.heroName}) pairs with ${Ne.userId} (${Ne.heroName})`);const Qe={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1,user1Name:ue.heroName||"User 1",user2Name:Ne.heroName||"User 2"};console.log("🔄 Firestore: About to call createBuddyPair with data:",{arrivingUserId:ue.userId,targetUserId:Ne.userId,pairData:Qe});const Ee=await M.createBuddyPair(ue.userId,Ne.userId,Qe);if(console.log("🔄 Firestore: createBuddyPair returned:",Ee),Ee){const{ref:Oe,set:Be}=await Me(()=>import("./index.esm-f161132b.js"),[]);if(await Be(Oe(q,`users/${Ne.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ue.userId,pairId:Ee,matchedAt:Qe.matchedAt}),await Be(Oe(q,`users/${ue.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ne.userId,pairId:Ee,matchedAt:Qe.matchedAt}),await M.removeFromMatchingPool(Ne.userId),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Created buddy pair ${Ee}`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Removed ${Ne.userId} (${Ne.heroName}) from matching pool`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Kept ${ue.userId} (${ue.heroName}) in matching pool for next pairing`),o!=null&&o.uid&&[ue.userId,Ne.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Je){console.error("Error reloading buddy data:",Je)}}else console.error(`❌ Firestore: Failed to create buddy pair between ${ue.userId} and ${Ne.userId}`)}catch(Qe){console.error(`❌ Firestore: Failed to create buddy pair between ${ue.userId} and ${Ne.userId}:`,Qe)}else console.log("ℹ️ Firestore: Same user in pool, cannot pair")}else console.log("ℹ️ Firestore: Not enough users in pool for pairing (need 2, have",z.length,")")}catch(M){console.error("❌ Firestore: Auto-matching failed:",M),console.log("🔄 Falling back to Realtime Database auto-matching..."),await Hi()}},Hi=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:M,get:K,set:z,push:ue,remove:Ne}=await Me(()=>import("./index.esm-f161132b.js"),[]),Qe=M(q,"matchingPool"),Ee=await K(Qe);if(!Ee.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const Oe=Ee.val(),Be=[];if(Object.entries(Oe).forEach(([Ke,Ze])=>{typeof Ze=="string"?Be.push(Ze):Ze&&typeof Ze=="object"?Ze.uid?Be.push(Ze.uid):Ze.userId?Be.push(Ze.userId):Be.push(Ke):Be.push(Ke)}),console.log(`🔄 Realtime Database: Found ${Be.length} users in matching pool`),Be.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",Be.length,")");return}const kt=Be;console.log("ℹ️ Realtime Database: Skipping user validation to avoid permission errors"),console.log(`🔄 Realtime Database: Valid users for pairing: ${kt.join(", ")}`);const Je=kt.map((Ke,Ze)=>({userId:Ke,joinedAt:new Date(Date.now()-(kt.length-Ze)*1e3).toISOString()}));if(Je.sort((Ke,Ze)=>{const Fe=Ke.joinedAt?new Date(Ke.joinedAt).getTime():0,$e=Ze.joinedAt?new Date(Ze.joinedAt).getTime():0;return Fe-$e}),console.log("🔄 Realtime Database: Sorted users by join time (oldest first):",Je.map(Ke=>({userId:Ke.userId,joinedAt:Ke.joinedAt}))),Je.length>=2){const Ke=Je[0],Ze=Je[Je.length-1];if(Ke&&Ze&&Ke.userId!==Ze.userId){console.log(`🔄 Realtime Database: CHAIN PAIRING: ${Ze.userId} (arriving) pairs with ${Ke.userId} (waiting)`);try{const Fe=ue(M(q,"buddyPairs")).key,$e={pairId:Fe,users:[Ze.userId,Ke.userId],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await z(M(q,`buddyPairs/${Fe}`),$e),await z(M(q,`users/${Ke.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ze.userId,pairId:Fe,matchedAt:$e.matchedAt}),await z(M(q,`users/${Ze.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ke.userId,pairId:Fe,matchedAt:$e.matchedAt}),Object.keys(Oe).forEach(async je=>{const We=Oe[je];((We==null?void 0:We.uid)||(We==null?void 0:We.userId)||je)===Ke.userId&&(await Ne(M(q,`matchingPool/${je}`)),console.log(`✅ Realtime Database: Removed ${Ke.userId} (waiting) from matching pool`))}),await z(M(q,`buddyPairs/${Fe}/user1RemovedFromPool`),!0),await z(M(q,`buddyPairs/${Fe}/user2RemovedFromPool`),!1),console.log(`✅ Realtime Database: CHAIN PAIRING: Created buddy pair ${Fe}`),console.log(`✅ Realtime Database: CHAIN PAIRING: Kept ${Ze.userId} (arriving) in matching pool for next pairing`)}catch(Fe){console.error("Error creating buddy pair:",Fe)}}else console.log("ℹ️ Realtime Database: Same user in pool, cannot pair")}else console.log("ℹ️ Realtime Database: Not enough users in pool for pairing (need 2, have",Je.length,")");if(o!=null&&o.uid&&Je.length>=2){const Ke=Je[0],Ze=Je[Je.length-1];if([Ze==null?void 0:Ze.userId,Ke==null?void 0:Ke.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch($e){console.error("Error reloading buddy data:",$e)}}}catch(M){console.error("Error in Realtime Database auto-matching:",M)}},Qh={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},Vn=()=>bn?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:qs("loading","adventurer"),isLoading:!0}:rt?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:qs("error","adventurer"),isError:!0,errorMessage:rt}:vt||Qh,Kh=async M=>{console.log("Onboarding completed with user data:",M);try{if(!M||!M.heroName||!M.stats)throw new Error("Invalid user data received from onboarding");if(!k)throw new Error("No authenticated user found");const K=new Date,z={...M,uid:k.uid,email:k.email,displayName:k.displayName||M.heroName,photoURL:k.photoURL,onboardingCompleted:!0,createdAt:K.toISOString(),updatedAt:K.getTime(),originalQuitDate:K.toISOString(),lastQuitDate:K.toISOString(),lastRelapseDate:K.toISOString(),lastActivity:K.toISOString(),daily:{[K.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",z);const{ref:ue,set:Ne}=await Me(()=>import("./index.esm-f161132b.js"),[]),Qe=ue(q,`users/${k.uid}`);await Ne(Qe,z),console.log("Firebase save successful, updating app state..."),a(z),S(!0);try{const Oe=Ae.current||Te;if(Oe){console.log("✅ Using Firestore for matching pool");const Be={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:k.uid,heroName:z.heroName,archetype:z.archetype,joinedAt:new Date().toISOString()};if(await Oe.addToMatchingPool(k.uid,Be))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Be,set:kt}=await Me(()=>import("./index.esm-f161132b.js"),[]),Je={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:k.uid,heroName:z.heroName,archetype:z.archetype,joinedAt:new Date().toISOString()};await kt(Be(q,`matchingPool/${k.uid}`),Je),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{console.log("⏳ Waiting 1 second before attempting auto-matching..."),await new Promise(Be=>setTimeout(Be,1e3)),await su()}catch(Be){console.error("Automatic matching failed:",Be)}}catch(Oe){console.error("⚠️ Failed to add user to buddy matching pool:",Oe)}const Ee=await De(k.uid);r("arena")}catch(K){console.error("Error in handleOnboardingComplete:",K);const z=new Date,ue={heroName:(M==null?void 0:M.heroName)||"Hero",archetype:(M==null?void 0:M.archetype)||"The Determined",avatar:(M==null?void 0:M.avatar)||qs("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:z,createdAt:z.toISOString(),lastActivity:z.toISOString(),lastRelapseDate:z.toISOString(),uid:k==null?void 0:k.uid,email:k==null?void 0:k.email,onboardingCompleted:!0};if(k)try{const{ref:Ne,set:Qe}=await Me(()=>import("./index.esm-f161132b.js"),[]),Ee=Ne(q,`users/${k.uid}`);await Qe(Ee,ue)}catch(Ne){console.error("Failed to save fallback data to Firebase:",Ne)}a(ue),S(!0),r("arena")}},ra=()=>{a(null),S(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},fi=async()=>{try{console.log("Logging out user...");const{signOut:M}=await Me(()=>import("./index.esm-47346572.js"),[]);await M(Ei),a(null),I(null),S(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(M){console.error("Error during logout:",M),a(null),I(null),S(!1),r("auth")}},iu=async()=>{if(!k){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:M,set:K,remove:z}=await Me(()=>import("./index.esm-f161132b.js"),[]),ue=M(q,`users/${k.uid}`);await K(ue,null);const Ne=M(q,"users");await K(Ne,null);const Qe=M(q,"buddyPairs");await K(Qe,null);const Ee=M(q,"matchingPool");await K(Ee,null),console.log("All user data and buddy matching data cleared from database"),a(null),S(!1),r("onboarding"),Rt(null),ot(!1),Zt(null),console.log("Account reset successful - ready for fresh onboarding")}catch(M){console.error("Error resetting account for testing:",M)}},ny=M=>{console.log("Tab changed to:",M),e(M),r(M),M==="arena"&&(o!=null&&o.uid)&&(console.log("🔄 Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log("🔄 Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},Qi=M=>{r(M==="mood-selector"?"mood-selector":"profile")},ry=M=>{i(M),r("profile")},sy=()=>{r("profile")};return x?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),l.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),l.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),l.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:l.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),l.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?l.jsx(Zq,{onAuthSuccess:Kn}):A.isLoading?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),l.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),l.jsx("p",{className:"text-xl text-gray-300 mb-4",children:A.currentStep}),l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[l.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:l.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${A.progress}%`}})}),l.jsxs("div",{className:"text-sm text-gray-400",children:[A.progress,"% Complete"]})]}),l.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:l.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),A.error&&l.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[l.jsxs("p",{className:"text-red-300 text-sm",children:[l.jsx("span",{className:"font-semibold",children:"Error:"})," ",A.error]}),l.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),l.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):l.jsx(Gq,{children:l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative",children:[N>0&&l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white text-center py-2 transition-transform duration-200",style:{transform:`translateY(${Math.max(0,N-60)}px)`},children:N>80?"Release to refresh":"Pull to refresh"}),_&&l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-green-600 text-white text-center py-2",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),l.jsx("span",{children:"Refreshing..."})]})}),l.jsx(e8,{offlineManager:Y}),l.jsx(t8,{offlineManager:Y}),l.jsx(n8,{sessionManager:window.sessionManager,authGuard:window.authGuard}),t==="onboarding"&&l.jsx("div",{children:l.jsx(c8,{onComplete:Kh,authUser:k,pwaInstallAvailable:D,promptInstall:de})}),w&&o?l.jsxs(l.Fragment,{children:[t==="arena"&&l.jsx("div",{children:(()=>{try{const M=Vn();return l.jsx(m8,{user:o,userStats:ir,nemesis:M,onBackToLogin:fi,onResetForTesting:iu,buddyLoading:bn,buddyError:rt,realBuddy:vt,loadRealBuddy:Gt,buddyLoadAttempted:ae},`arena-${o.uid}-${L}`)}catch(M){return console.error("Error rendering ArenaView:",M),l.jsxs("div",{className:"text-white text-center p-8",children:[l.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),l.jsx("p",{className:"text-gray-300 mb-4",children:M.message}),l.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-3 rounded hover:bg-blue-700 min-h-[44px]",children:"Reload App"})]})}})()}),t==="craving-support"&&l.jsx("div",{children:l.jsx(y8,{user:o,nemesis:Vn(),onBackToLogin:fi,onResetForTesting:iu,behavioralService:Q,onBreathingComplete:async M=>{await ve()},setActiveTab:e})}),t==="profile"&&l.jsx("div",{children:l.jsx(w8,{user:o,onNavigate:Qi})}),t==="mood-selector"&&l.jsx(MoodSelector,{onMoodSelect:ry,onBack:sy}),t==="settings"&&l.jsx(E8,{onResetApp:ra,onBackToLogin:fi,onResetForTesting:iu,firestoreBuddyService:Te,firestoreBuddyServiceRef:Ae,initializeFirestoreBuddyService:me,behavioralService:Q,user:o,onShowAnalytics:()=>u(!0),onShowPerformanceDashboard:()=>f(!0),onShowBetaMonitoring:()=>y(!0)}),c&&l.jsx(l8,{user:o,behavioralService:Q,onClose:()=>u(!1)}),h&&l.jsx(Fq,{isOpen:h,onClose:()=>f(!1)}),m&&l.jsx(Hq,{isOpen:m,onClose:()=>y(!1)}),l.jsx(f8,{activeTab:n,onTabChange:ny,dataLoadingState:A,onRefreshData:xt,offlineManager:Y})]}):l.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),l.jsx("p",{className:"text-gray-300",children:w?"User data missing":"Onboarding not completed"}),l.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),l.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),l.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:w,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 min-h-[44px]",children:"Debug State"})]})})]})})};fv.createRoot(document.getElementById("root")).render(l.jsx(T8,{}));export{GF as $,L8 as A,M8 as B,O8 as C,Ua as D,k8 as E,zw as F,H8 as G,Q8 as H,K8 as I,Y8 as J,rR as K,r3 as L,Z as M,R8 as N,qF as O,WF as P,Us as Q,Fs as R,o7 as S,m3 as T,s7 as U,Ue as V,D8 as W,P8 as X,q8 as Y,z8 as Z,c7 as _,c3 as a,A7 as a$,HD as a0,th as a1,OU as a2,zr as a3,v7 as a4,oi as a5,Lt as a6,Gr as a7,cl as a8,ul as a9,on as aA,gW as aB,ct as aC,h7 as aD,mW as aE,fW as aF,g7 as aG,ms as aH,E3 as aI,Ss as aJ,O7 as aK,V7 as aL,C7 as aM,sW as aN,rW as aO,M7 as aP,S7 as aQ,kn as aR,p7 as aS,PU as aT,zU as aU,hW as aV,HU as aW,nW as aX,E7 as aY,dW as aZ,dm as a_,Ft as aa,G as ab,ai as ac,jU as ad,o$ as ae,Qn as af,tu as ag,Vh as ah,hm as ai,zp as aj,Fh as ak,$p as al,Hx as am,Hr as an,Bp as ao,yo as ap,et as aq,i$ as ar,Ps as as,r$ as at,Ww as au,vn as av,$a as aw,ie as ax,f7 as ay,g3 as az,ts as b,co as b$,F7 as b0,w7 as b1,x7 as b2,b7 as b3,uW as b4,j7 as b5,P7 as b6,fn as b7,Uh as b8,QU as b9,As as bA,DD as bB,U7 as bC,y7 as bD,tW as bE,fm as bF,GU as bG,lW as bH,d7 as bI,$7 as bJ,D7 as bK,k7 as bL,L7 as bM,T7 as bN,G7 as bO,oW as bP,I7 as bQ,Ns as bR,aW as bS,wW as bT,qh as bU,zh as bV,SW as bW,oh as bX,fl as bY,lo as bZ,pW as b_,K7 as ba,WU as bb,B7 as bc,z7 as bd,li as be,q7 as bf,W7 as bg,LU as bh,cW as bi,iW as bj,_7 as bk,zD as bl,R7 as bm,mT as bn,Y7 as bo,X7 as bp,J7 as bq,MU as br,yT as bs,H7 as bt,Q7 as bu,N7 as bv,Sg as bw,Z7 as bx,eW as by,t$ as bz,vw as c,uz as c$,vi as c0,Vi as c1,pm as c2,_W as c3,Ra as c4,rc as c5,Kz as c6,yW as c7,KW as c8,r_ as c9,UW as cA,DW as cB,pB as cC,JW as cD,tG as cE,sG as cF,HW as cG,kB as cH,CB as cI,bW as cJ,l$ as cK,yB as cL,XW as cM,eG as cN,rG as cO,I$ as cP,qW as cQ,SB as cR,_B as cS,kW as cT,NP as cU,EW as cV,sS as cW,AW as cX,EP as cY,PW as cZ,YW as c_,vW as ca,Yz as cb,gS as cc,uo as cd,CW as ce,RB as cf,QW as cg,fd as ch,Qz as ci,md as cj,wB as ck,NW as cl,Q$ as cm,bP as cn,xW as co,WW as cp,jW as cq,FW as cr,r9 as cs,IW as ct,w$ as cu,GW as cv,iG as cw,ET as cx,JB as cy,G$ as cz,Ks as d,nG as d0,DB as d1,TW as d2,zW as d3,OW as d4,VW as d5,ZW as d6,MW as d7,BW as d8,$W as d9,LW as da,RW as db,Ei as dc,q as dd,tr as de,Me as df,N8 as dg,oG as dh,aG as di,yc as e,l7 as f,d3 as g,a7 as h,r7 as i,U8 as j,$8 as k,J8 as l,e7 as m,Z8 as n,Le as o,u3 as p,t7 as q,aR as r,qN as s,n7 as t,i7 as u,Ow as v,W8 as w,G8 as x,HF as y,j8 as z};
